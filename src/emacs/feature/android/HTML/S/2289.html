<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>
<html xmlns='http://www.w3.org/1999/xhtml'>
<head>
<title>src/xterm.c</title>
<meta name='robots' content='noindex,nofollow' />
<meta name='generator' content='GLOBAL-6.6.7' />
<meta http-equiv='Content-Style-Type' content='text/css' />
<link rel='stylesheet' type='text/css' href='../style.css' />
</head>
<body>
<a id='TOP' name='TOP'></a><h2 class='header'><a href='../mains.html'>root</a>/<a href='../files/4790.html'>src</a>/xterm.c</h2>
<em class='comment'>/* [&lt;][&gt;]<a href='#L900'>[^]</a><a href='#L12428'>[v]</a>[top]<a href='#BOTTOM'>[bottom]</a><a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</em>
<hr />
<h2 class='header'>DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href='#L900' title='Defined at 900.'>x_defer_selection_requests</a></li>
<li><a href='#L947' title='Defined at 947.'>x_release_selection_requests</a></li>
<li><a href='#L953' title='Defined at 953.'>x_release_selection_requests_and_flush</a></li>
<li><a href='#L1766' title='Defined at 1766.'>xm_side_effect_from_action</a></li>
<li><a href='#L1781' title='Defined at 1781.'>xm_operations_from_actions</a></li>
<li><a href='#L1803' title='Defined at 1803.'>xm_read_targets_table_header</a></li>
<li><a href='#L1828' title='Defined at 1828.'>xm_read_targets_table_rec</a></li>
<li><a href='#L1861' title='Defined at 1861.'>xm_find_targets_table_idx</a></li>
<li><a href='#L1886' title='Defined at 1886.'>x_atoms_compare</a></li>
<li><a href='#L1892' title='Defined at 1892.'>xm_write_targets_table</a></li>
<li><a href='#L1939' title='Defined at 1939.'>xm_write_drag_initiator_info</a></li>
<li><a href='#L1963' title='Defined at 1963.'>xm_drag_window_error_handler</a></li>
<li><a href='#L1972' title='Defined at 1972.'>xm_drag_window_io_error_handler</a></li>
<li><a href='#L1982' title='Defined at 1982.'>x_special_window_exists_p</a></li>
<li><a href='#L2017' title='Defined at 2017.'>xm_get_drag_window_1</a></li>
<li><a href='#L2168' title='Defined at 2168.'>xm_get_drag_window</a></li>
<li><a href='#L2178' title='Defined at 2178.'>xm_setup_dnd_targets</a></li>
<li><a href='#L2405' title='Defined at 2405.'>xm_get_drag_atom_1</a></li>
<li><a href='#L2514' title='Defined at 2514.'>xm_get_drag_atom</a></li>
<li><a href='#L2528' title='Defined at 2528.'>xm_setup_drag_info</a></li>
<li><a href='#L2565' title='Defined at 2565.'>xm_send_drop_message</a></li>
<li><a href='#L2590' title='Defined at 2590.'>xm_send_top_level_enter_message</a></li>
<li><a href='#L2617' title='Defined at 2617.'>xm_send_drag_motion_message</a></li>
<li><a href='#L2648' title='Defined at 2648.'>xm_send_top_level_leave_message</a></li>
<li><a href='#L2707' title='Defined at 2707.'>xm_read_drop_start_reply</a></li>
<li><a href='#L2738' title='Defined at 2738.'>xm_read_drop_start_message</a></li>
<li><a href='#L2776' title='Defined at 2776.'>xm_read_drag_receiver_info</a></li>
<li><a href='#L2832' title='Defined at 2832.'>xm_read_drag_motion_message</a></li>
<li><a href='#L2866' title='Defined at 2866.'>xm_read_drag_motion_reply</a></li>
<li><a href='#L2899' title='Defined at 2899.'>x_dnd_send_xm_leave_for_drop</a></li>
<li><a href='#L2918' title='Defined at 2918.'>x_dnd_free_toplevels</a></li>
<li><a href='#L3015' title='Defined at 3015.'>x_dnd_compute_toplevels</a></li>
<li><a href='#L3611' title='Defined at 3611.'>x_dnd_io_error_handler</a></li>
<li><a href='#L3628' title='Defined at 3628.'>x_dnd_get_proxy_proto</a></li>
<li><a href='#L3694' title='Defined at 3694.'>x_dnd_get_target_window_2</a></li>
<li><a href='#L3715' title='Defined at 3715.'>x_dnd_get_target_window_1</a></li>
<li><a href='#L3812' title='Defined at 3812.'>x_dnd_get_wm_state_and_proto</a></li>
<li><a href='#L3977' title='Defined at 3977.'>x_dnd_do_unsupported_drop</a></li>
<li><a href='#L4073' title='Defined at 4073.'>x_dnd_send_unsupported_drop</a></li>
<li><a href='#L4119' title='Defined at 4119.'>x_dnd_fill_empty_target</a></li>
<li><a href='#L4131' title='Defined at 4131.'>x_dnd_get_target_window</a></li>
<li><a href='#L4460' title='Defined at 4460.'>x_dnd_get_window_proxy</a></li>
<li><a href='#L4502' title='Defined at 4502.'>x_dnd_get_window_proto</a></li>
<li><a href='#L4536' title='Defined at 4536.'>x_dnd_send_enter</a></li>
<li><a href='#L4574' title='Defined at 4574.'>x_dnd_send_position</a></li>
<li><a href='#L4649' title='Defined at 4649.'>x_dnd_send_leave</a></li>
<li><a href='#L4673' title='Defined at 4673.'>x_dnd_send_drop</a></li>
<li><a href='#L4707' title='Defined at 4707.'>x_dnd_do_drop</a></li>
<li><a href='#L4720' title='Defined at 4720.'>x_set_dnd_targets</a></li>
<li><a href='#L4735' title='Defined at 4735.'>x_free_dnd_targets</a></li>
<li><a href='#L4749' title='Defined at 4749.'>x_clear_dnd_variables</a></li>
<li><a href='#L4756' title='Defined at 4756.'>x_free_dnd_toplevels</a></li>
<li><a href='#L4770' title='Defined at 4770.'>x_restore_events_after_dnd</a></li>
<li><a href='#L4803' title='Defined at 4803.'>x_dnd_cancel_dnd_early</a></li>
<li><a href='#L4858' title='Defined at 4858.'>x_dnd_cleanup_drag_and_drop</a></li>
<li><a href='#L4924' title='Defined at 4924.'>x_dnd_note_self_position</a></li>
<li><a href='#L4945' title='Defined at 4945.'>x_dnd_note_self_wheel</a></li>
<li><a href='#L4973' title='Defined at 4973.'>x_dnd_note_self_drop</a></li>
<li><a href='#L5056' title='Defined at 5056.'>x_flush</a></li>
<li><a href='#L5071' title='Defined at 5071.'>x_drop_xrender_surfaces</a></li>
<li><a href='#L5089' title='Defined at 5089.'>x_xr_ensure_picture</a></li>
<li><a href='#L5125' title='Defined at 5125.'>record_event</a></li>
<li><a href='#L5139' title='Defined at 5139.'>xi_frame_selected_for</a></li>
<li><a href='#L5161' title='Defined at 5161.'>x_toolkit_position</a></li>
<li><a href='#L5198' title='Defined at 5198.'>x_update_opaque_region</a></li>
<li><a href='#L5251' title='Defined at 5251.'>x_gc_free_ext_data_private</a></li>
<li><a href='#L5259' title='Defined at 5259.'>x_gc_get_ext_data</a></li>
<li><a href='#L5285' title='Defined at 5285.'>x_extension_initialize</a></li>
<li><a href='#L5308' title='Defined at 5308.'>xi_convert_button_state</a></li>
<li><a href='#L5330' title='Defined at 5330.'>xi_convert_event_state</a></li>
<li><a href='#L5347' title='Defined at 5347.'>xi_convert_event_keyboard_state</a></li>
<li><a href='#L5355' title='Defined at 5355.'>x_free_xi_devices</a></li>
<li><a href='#L5430' title='Defined at 5430.'>xi_populate_scroll_valuator</a></li>
<li><a href='#L5447' title='Defined at 5447.'>xi_populate_device_from_info</a></li>
<li><a href='#L5646' title='Defined at 5646.'>x_cache_xi_devices</a></li>
<li><a href='#L5688' title='Defined at 5688.'>x_get_scroll_valuator_delta</a></li>
<li><a href='#L5732' title='Defined at 5732.'>xi_device_from_id</a></li>
<li><a href='#L5746' title='Defined at 5746.'>xi_link_touch_point</a></li>
<li><a href='#L5763' title='Defined at 5763.'>xi_unlink_touch_point</a></li>
<li><a href='#L5791' title='Defined at 5791.'>xi_unlink_touch_points</a></li>
<li><a href='#L5817' title='Defined at 5817.'>xi_find_touch_point</a></li>
<li><a href='#L5835' title='Defined at 5835.'>xi_reset_scroll_valuators_for_device_id</a></li>
<li><a href='#L5867' title='Defined at 5867.'>x_cr_destroy_frame_context</a></li>
<li><a href='#L5877' title='Defined at 5877.'>x_cr_update_surface_desired_size</a></li>
<li><a href='#L5889' title='Defined at 5889.'>x_cr_gc_clip</a></li>
<li><a href='#L5908' title='Defined at 5908.'>x_begin_cr_clip</a></li>
<li><a href='#L5940' title='Defined at 5940.'>x_end_cr_clip</a></li>
<li><a href='#L5950' title='Defined at 5950.'>x_set_cr_source_with_gc_foreground</a></li>
<li><a href='#L5980' title='Defined at 5980.'>x_set_cr_source_with_gc_background</a></li>
<li><a href='#L6014' title='Defined at 6014.'>x_cr_destroy_xlib_surface</a></li>
<li><a href='#L6025' title='Defined at 6025.'>x_try_cr_xlib_drawable</a></li>
<li><a href='#L6090' title='Defined at 6090.'>x_end_cr_xlib_drawable</a></li>
<li><a href='#L6130' title='Defined at 6130.'>x_cr_define_fringe_bitmap</a></li>
<li><a href='#L6168' title='Defined at 6168.'>x_cr_destroy_fringe_bitmap</a></li>
<li><a href='#L6183' title='Defined at 6183.'>x_cr_draw_image</a></li>
<li><a href='#L6219' title='Defined at 6219.'>x_cr_draw_frame</a></li>
<li><a href='#L6234' title='Defined at 6234.'>x_cr_accumulate_data</a></li>
<li><a href='#L6245' title='Defined at 6245.'>x_cr_destroy</a></li>
<li><a href='#L6253' title='Defined at 6253.'>x_cr_export_frames</a></li>
<li><a href='#L6349' title='Defined at 6349.'>x_xr_apply_ext_clip</a></li>
<li><a href='#L6363' title='Defined at 6363.'>x_xr_reset_ext_clip</a></li>
<li><a href='#L6374' title='Defined at 6374.'>x_set_clip_rectangles</a></li>
<li><a href='#L6390' title='Defined at 6390.'>x_reset_clip_rectangles</a></li>
<li><a href='#L6406' title='Defined at 6406.'>x_xrender_color_from_gc_foreground</a></li>
<li><a href='#L6436' title='Defined at 6436.'>x_xrender_color_from_gc_background</a></li>
<li><a href='#L6466' title='Defined at 6466.'>x_fill_rectangle</a></li>
<li><a href='#L6577' title='Defined at 6577.'>x_clear_rectangle</a></li>
<li><a href='#L6625' title='Defined at 6625.'>x_draw_rectangle</a></li>
<li><a href='#L6643' title='Defined at 6643.'>x_clear_window</a></li>
<li><a href='#L6671' title='Defined at 6671.'>x_fill_trapezoid_for_relief</a></li>
<li><a href='#L6696' title='Defined at 6696.'>x_erase_corners_for_relief</a></li>
<li><a href='#L6729' title='Defined at 6729.'>x_draw_horizontal_wave</a></li>
<li><a href='#L6774' title='Defined at 6774.'>x_display_info_for_display</a></li>
<li><a href='#L6786' title='Defined at 6786.'>x_find_topmost_parent</a></li>
<li><a href='#L6811' title='Defined at 6811.'>x_set_frame_alpha</a></li>
<li><a href='#L6880' title='Defined at 6880.'>x_if_event</a></li>
<li><a href='#L6931' title='Defined at 6931.'>x_sync_get_monotonic_time</a></li>
<li><a href='#L6953' title='Defined at 6953.'>x_sync_current_monotonic_time</a></li>
<li><a href='#L6969' title='Defined at 6969.'>x_sync_note_frame_times</a></li>
<li><a href='#L6994' title='Defined at 6994.'>x_sync_is_frame_drawn_event</a></li>
<li><a href='#L7017' title='Defined at 7017.'>x_sync_wait_for_frame_drawn_event</a></li>
<li><a href='#L7072' title='Defined at 7072.'>x_sync_update_begin</a></li>
<li><a href='#L7139' title='Defined at 7139.'>x_sync_trigger_fence</a></li>
<li><a href='#L7166' title='Defined at 7166.'>x_sync_init_fences</a></li>
<li><a href='#L7199' title='Defined at 7199.'>x_sync_free_fences</a></li>
<li><a href='#L7216' title='Defined at 7216.'>x_sync_update_finish</a></li>
<li><a href='#L7260' title='Defined at 7260.'>x_sync_handle_frame_drawn</a></li>
<li><a href='#L7295' title='Defined at 7295.'>x_update_begin</a></li>
<li><a href='#L7319' title='Defined at 7319.'>x_draw_vertical_window_border</a></li>
<li><a href='#L7340' title='Defined at 7340.'>x_draw_window_divider</a></li>
<li><a href='#L7402' title='Defined at 7402.'>show_back_buffer</a></li>
<li><a href='#L7445' title='Defined at 7445.'>x_flip_and_flush</a></li>
<li><a href='#L7473' title='Defined at 7473.'>x_update_end</a></li>
<li><a href='#L7500' title='Defined at 7500.'>XTframe_up_to_date</a></li>
<li><a href='#L7551' title='Defined at 7551.'>XTbuffer_flipping_unblocked_hook</a></li>
<li><a href='#L7569' title='Defined at 7569.'>x_clear_under_internal_border</a></li>
<li><a href='#L7621' title='Defined at 7621.'>x_after_update_window_line</a></li>
<li><a href='#L7690' title='Defined at 7690.'>x_premultiply_pixel</a></li>
<li><a href='#L7721' title='Defined at 7721.'>x_draw_fringe_bitmap</a></li>
<li><a href='#L7929' title='Defined at 7929.'>x_display_set_last_user_time</a></li>
<li><a href='#L8023' title='Defined at 8023.'>x_set_gtk_user_time</a></li>
<li><a href='#L8048' title='Defined at 8048.'>x_create_special_window</a></li>
<li><a href='#L8068' title='Defined at 8068.'>x_update_frame_user_time_window</a></li>
<li><a href='#L8137' title='Defined at 8137.'>x_set_last_user_time_from_lisp</a></li>
<li><a href='#L8148' title='Defined at 8148.'>x_set_cursor_gc</a></li>
<li><a href='#L8203' title='Defined at 8203.'>x_set_mouse_face_gc</a></li>
<li><a href='#L8243' title='Defined at 8243.'>x_set_mode_line_face_gc</a></li>
<li><a href='#L8254' title='Defined at 8254.'>x_set_glyph_string_gc</a></li>
<li><a href='#L8296' title='Defined at 8296.'>x_set_glyph_string_clipping</a></li>
<li><a href='#L8312' title='Defined at 8312.'>x_set_glyph_string_clipping_exactly</a></li>
<li><a href='#L8330' title='Defined at 8330.'>x_compute_glyph_string_overhangs</a></li>
<li><a href='#L8364' title='Defined at 8364.'>x_clear_glyph_string_rect</a></li>
<li><a href='#L8372' title='Defined at 8372.'>x_clear_point</a></li>
<li><a href='#L8402' title='Defined at 8402.'>x_draw_glyph_string_background</a></li>
<li><a href='#L8446' title='Defined at 8446.'>x_draw_glyph_string_foreground</a></li>
<li><a href='#L8540' title='Defined at 8540.'>x_draw_composite_glyph_string_foreground</a></li>
<li><a href='#L8650' title='Defined at 8650.'>x_draw_glyphless_glyph_string_foreground</a></li>
<li><a href='#L8740' title='Defined at 8740.'>x_frame_of_widget</a></li>
<li><a href='#L8776' title='Defined at 8776.'>x_alloc_lighter_color_for_widget</a></li>
<li><a href='#L8822' title='Defined at 8822.'>cvt_string_to_pixel</a></li>
<li><a href='#L8908' title='Defined at 8908.'>cvt_pixel_dtor</a></li>
<li><a href='#L8938' title='Defined at 8938.'>x_color_cells</a></li>
<li><a href='#L8972' title='Defined at 8972.'>x_query_colors</a></li>
<li><a href='#L9040' title='Defined at 9040.'>x_query_frame_background_color</a></li>
<li><a href='#L9074' title='Defined at 9074.'>x_hash_string_ignore_case</a></li>
<li><a href='#L9095' title='Defined at 9095.'>x_parse_color</a></li>
<li><a href='#L9214' title='Defined at 9214.'>x_alloc_nearest_color_1</a></li>
<li><a href='#L9360' title='Defined at 9360.'>x_alloc_nearest_color</a></li>
<li><a href='#L9384' title='Defined at 9384.'>x_copy_color</a></li>
<li><a href='#L9430' title='Defined at 9430.'>x_alloc_lighter_color</a></li>
<li><a href='#L9507' title='Defined at 9507.'>x_setup_relief_color</a></li>
<li><a href='#L9552' title='Defined at 9552.'>x_setup_relief_colors</a></li>
<li><a href='#L9585' title='Defined at 9585.'>x_fill_triangle</a></li>
<li><a href='#L9599' title='Defined at 9599.'>x_make_point</a></li>
<li><a href='#L9610' title='Defined at 9610.'>x_inside_rect_p</a></li>
<li><a href='#L9636' title='Defined at 9636.'>x_draw_relief_rect</a></li>
<li><a href='#L9838' title='Defined at 9838.'>x_draw_box_rect</a></li>
<li><a href='#L9879' title='Defined at 9879.'>x_draw_glyph_string_box</a></li>
<li><a href='#L9948' title='Defined at 9948.'>x_composite_image</a></li>
<li><a href='#L10005' title='Defined at 10005.'>x_draw_image_foreground</a></li>
<li><a href='#L10128' title='Defined at 10128.'>x_draw_image_relief</a></li>
<li><a href='#L10222' title='Defined at 10222.'>x_draw_image_foreground_1</a></li>
<li><a href='#L10304' title='Defined at 10304.'>x_draw_glyph_string_bg_rect</a></li>
<li><a href='#L10335' title='Defined at 10335.'>x_draw_image_glyph_string</a></li>
<li><a href='#L10475' title='Defined at 10475.'>x_draw_stretch_glyph_string</a></li>
<li><a href='#L10586' title='Defined at 10586.'>x_get_scale_factor</a></li>
<li><a href='#L10613' title='Defined at 10613.'>x_draw_underwave</a></li>
<li><a href='#L10686' title='Defined at 10686.'>x_draw_glyph_string</a></li>
<li><a href='#L11041' title='Defined at 11041.'>x_shift_glyphs_for_insert</a></li>
<li><a href='#L11056' title='Defined at 11056.'>x_delete_glyphs</a></li>
<li><a href='#L11067' title='Defined at 11067.'>x_clear_area1</a></li>
<li><a href='#L11076' title='Defined at 11076.'>x_clear_area</a></li>
<li><a href='#L11136' title='Defined at 11136.'>x_clear_frame</a></li>
<li><a href='#L11159' title='Defined at 11159.'>x_send_hourglass_message</a></li>
<li><a href='#L11181' title='Defined at 11181.'>x_show_hourglass</a></li>
<li><a href='#L11263' title='Defined at 11263.'>x_hide_hourglass</a></li>
<li><a href='#L11283' title='Defined at 11283.'>XTflash</a></li>
<li><a href='#L11400' title='Defined at 11400.'>XTring_bell</a></li>
<li><a href='#L11439' title='Defined at 11439.'>x_ins_del_lines</a></li>
<li><a href='#L11448' title='Defined at 11448.'>x_scroll_run</a></li>
<li><a href='#L11658' title='Defined at 11658.'>x_frame_highlight</a></li>
<li><a href='#L11683' title='Defined at 11683.'>x_frame_unhighlight</a></li>
<li><a href='#L11713' title='Defined at 11713.'>x_new_focus_frame</a></li>
<li><a href='#L11766' title='Defined at 11766.'>x_fixes_pointer_blanking_supported</a></li>
<li><a href='#L11779' title='Defined at 11779.'>xfixes_toggle_visible_pointer</a></li>
<li><a href='#L11793' title='Defined at 11793.'>make_invisible_cursor</a></li>
<li><a href='#L11825' title='Defined at 11825.'>x_toggle_visible_pointer</a></li>
<li><a href='#L11867' title='Defined at 11867.'>XTtoggle_invisible_pointer</a></li>
<li><a href='#L11888' title='Defined at 11888.'>x_focus_changed</a></li>
<li><a href='#L11957' title='Defined at 11957.'>x_window_to_frame</a></li>
<li><a href='#L12010' title='Defined at 12010.'>x_tooltip_window_to_frame</a></li>
<li><a href='#L12075' title='Defined at 12075.'>x_any_window_to_frame</a></li>
<li><a href='#L12131' title='Defined at 12131.'>x_menubar_window_to_frame</a></li>
<li><a href='#L12174' title='Defined at 12174.'>x_top_window_to_frame</a></li>
<li><a href='#L12214' title='Defined at 12214.'>x_top_window_to_frame</a></li>
<li><a href='#L12220' title='Defined at 12220.'>x_next_event_from_any_display</a></li>
<li><a href='#L12268' title='Defined at 12268.'>x_handle_pending_selection_requests_1</a></li>
<li><a href='#L12284' title='Defined at 12284.'>x_handle_pending_selection_requests</a></li>
<li><a href='#L12298' title='Defined at 12298.'>x_push_selection_request</a></li>
<li><a href='#L12309' title='Defined at 12309.'>x_detect_pending_selection_requests</a></li>
<li><a href='#L12315' title='Defined at 12315.'>x_clear_dnd_action</a></li>
<li><a href='#L12322' title='Defined at 12322.'>x_dnd_delete_action_list</a></li>
<li><a href='#L12345' title='Defined at 12345.'>x_dnd_lose_ownership</a></li>
<li><a href='#L12361' title='Defined at 12361.'>x_dnd_process_quit</a></li>
<li><a href='#L12428' title='Defined at 12428.'>x_dnd_begin_drag_and_drop</a></li>
</ol>
<hr />
<pre>
<a id='L1' name='L1'></a>     1 <em class='comment'>/* X Communication module for terminals which understand the X protocol.</em>
<a id='L2' name='L2'></a>     2 <em class='comment'></em>
<a id='L3' name='L3'></a>     3 <em class='comment'>Copyright (C) 1989, 1993-2023 Free Software Foundation, Inc.</em>
<a id='L4' name='L4'></a>     4 <em class='comment'></em>
<a id='L5' name='L5'></a>     5 <em class='comment'>This file is part of GNU Emacs.</em>
<a id='L6' name='L6'></a>     6 <em class='comment'></em>
<a id='L7' name='L7'></a>     7 <em class='comment'>GNU Emacs is free software: you can redistribute it and/or modify</em>
<a id='L8' name='L8'></a>     8 <em class='comment'>it under the terms of the GNU General Public License as published by</em>
<a id='L9' name='L9'></a>     9 <em class='comment'>the Free Software Foundation, either version 3 of the License, or (at</em>
<a id='L10' name='L10'></a>    10 <em class='comment'>your option) any later version.</em>
<a id='L11' name='L11'></a>    11 <em class='comment'></em>
<a id='L12' name='L12'></a>    12 <em class='comment'>GNU Emacs is distributed in the hope that it will be useful,</em>
<a id='L13' name='L13'></a>    13 <em class='comment'>but WITHOUT ANY WARRANTY; without even the implied warranty of</em>
<a id='L14' name='L14'></a>    14 <em class='comment'>MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</em>
<a id='L15' name='L15'></a>    15 <em class='comment'>GNU General Public License for more details.</em>
<a id='L16' name='L16'></a>    16 <em class='comment'></em>
<a id='L17' name='L17'></a>    17 <em class='comment'>You should have received a copy of the GNU General Public License</em>
<a id='L18' name='L18'></a>    18 <em class='comment'>along with GNU Emacs.  If not, see &lt;https://www.gnu.org/licenses/&gt;.  */</em>
<a id='L19' name='L19'></a>    19 
<a id='L20' name='L20'></a>    20 <em class='comment'>/* New display code by Gerd Moellmann &lt;gerd@gnu.org&gt;.  */</em>
<a id='L21' name='L21'></a>    21 <em class='comment'>/* Xt features made by Fred Pierresteguy.  */</em>
<a id='L22' name='L22'></a>    22 
<a id='L23' name='L23'></a>    23 <em class='comment'>/* X window system support for GNU Emacs</em>
<a id='L24' name='L24'></a>    24 <em class='comment'></em>
<a id='L25' name='L25'></a>    25 <em class='comment'>   This file is part of the X window system support for GNU Emacs.  It</em>
<a id='L26' name='L26'></a>    26 <em class='comment'>   contains subroutines comprising the redisplay interface, setting up</em>
<a id='L27' name='L27'></a>    27 <em class='comment'>   scroll bars and widgets, and handling input.</em>
<a id='L28' name='L28'></a>    28 <em class='comment'></em>
<a id='L29' name='L29'></a>    29 <em class='comment'>   X WINDOW SYSTEM</em>
<a id='L30' name='L30'></a>    30 <em class='comment'></em>
<a id='L31' name='L31'></a>    31 <em class='comment'>   The X Window System is a windowing system for bitmap graphics</em>
<a id='L32' name='L32'></a>    32 <em class='comment'>   displays which originated at MIT in 1984.  Version 11, which is</em>
<a id='L33' name='L33'></a>    33 <em class='comment'>   currently supported by Emacs, first appeared in September 1987.</em>
<a id='L34' name='L34'></a>    34 <em class='comment'></em>
<a id='L35' name='L35'></a>    35 <em class='comment'>   X has a long history and has been developed by many different</em>
<a id='L36' name='L36'></a>    36 <em class='comment'>   organizations over the years; at present, it is being primarily</em>
<a id='L37' name='L37'></a>    37 <em class='comment'>   developed by the X.Org Foundation.  It is the main window system</em>
<a id='L38' name='L38'></a>    38 <em class='comment'>   that Emacs is developed and tested against, and X version 10 was</em>
<a id='L39' name='L39'></a>    39 <em class='comment'>   the first window system that Emacs was ported to.  As a consequence</em>
<a id='L40' name='L40'></a>    40 <em class='comment'>   of its age and wide availability, X contains many idiosyncrasies,</em>
<a id='L41' name='L41'></a>    41 <em class='comment'>   but that has not prevented it from becoming the dominant free</em>
<a id='L42' name='L42'></a>    42 <em class='comment'>   window system, and the platform of reference for all GUI code in</em>
<a id='L43' name='L43'></a>    43 <em class='comment'>   Emacs.</em>
<a id='L44' name='L44'></a>    44 <em class='comment'></em>
<a id='L45' name='L45'></a>    45 <em class='comment'>   Some of what is explained below also applies to the other window</em>
<a id='L46' name='L46'></a>    46 <em class='comment'>   systems that Emacs supports, to varying degrees.  YMMV.</em>
<a id='L47' name='L47'></a>    47 <em class='comment'></em>
<a id='L48' name='L48'></a>    48 <em class='comment'>   INPUT</em>
<a id='L49' name='L49'></a>    49 <em class='comment'></em>
<a id='L50' name='L50'></a>    50 <em class='comment'>   Emacs handles input by running pselect in a loop, which returns</em>
<a id='L51' name='L51'></a>    51 <em class='comment'>   whenever there is input available on the connection to the X</em>
<a id='L52' name='L52'></a>    52 <em class='comment'>   server.  On some systems, Emacs also arranges for any new input on</em>
<a id='L53' name='L53'></a>    53 <em class='comment'>   that connection to send an asynchronous signal.  Whenever pselect</em>
<a id='L54' name='L54'></a>    54 <em class='comment'>   returns, or such a signal is received and input is not blocked,</em>
<a id='L55' name='L55'></a>    55 <em class='comment'>   XTread_socket is called and translates X11 events read by Xlib into</em>
<a id='L56' name='L56'></a>    56 <em class='comment'>   struct input_events, which are then stored in the keyboard buffer,</em>
<a id='L57' name='L57'></a>    57 <em class='comment'>   to be processed and acted upon at some later time.  The function</em>
<a id='L58' name='L58'></a>    58 <em class='comment'>   handle_one_xevent is responsible for handling core events after</em>
<a id='L59' name='L59'></a>    59 <em class='comment'>   they are filtered, and filtering X Input Extension events.  It also</em>
<a id='L60' name='L60'></a>    60 <em class='comment'>   performs actions on some special events, such as updating the</em>
<a id='L61' name='L61'></a>    61 <em class='comment'>   dimensions of a frame after a ConfigureNotify is sent by the X</em>
<a id='L62' name='L62'></a>    62 <em class='comment'>   server to inform us that it changed.</em>
<a id='L63' name='L63'></a>    63 <em class='comment'></em>
<a id='L64' name='L64'></a>    64 <em class='comment'>   Before such events are translated, an Emacs build with</em>
<a id='L65' name='L65'></a>    65 <em class='comment'>   internationalization enabled (the default since X11R6) will filter</em>
<a id='L66' name='L66'></a>    66 <em class='comment'>   events through an X Input Method (XIM) or GTK, which might decide</em>
<a id='L67' name='L67'></a>    67 <em class='comment'>   to intercept the event and send a different one in its place, for</em>
<a id='L68' name='L68'></a>    68 <em class='comment'>   reasons such as enabling the user to insert international</em>
<a id='L69' name='L69'></a>    69 <em class='comment'>   characters that aren't on his keyboard by typing a sequence of</em>
<a id='L70' name='L70'></a>    70 <em class='comment'>   characters which are.  See the function x_filter_event and its</em>
<a id='L71' name='L71'></a>    71 <em class='comment'>   callers for more details.</em>
<a id='L72' name='L72'></a>    72 <em class='comment'></em>
<a id='L73' name='L73'></a>    73 <em class='comment'>   Events that cause Emacs to quit are treated specially by the code</em>
<a id='L74' name='L74'></a>    74 <em class='comment'>   that stores them in the keyboard buffer and generally cause an</em>
<a id='L75' name='L75'></a>    75 <em class='comment'>   immediate interrupt.  Such an interrupt can lead to a longjmp from</em>
<a id='L76' name='L76'></a>    76 <em class='comment'>   the code that stored the keyboard event, which isn't safe inside</em>
<a id='L77' name='L77'></a>    77 <em class='comment'>   XTread_socket.  To avoid this problem, XTread_socket is provided a</em>
<a id='L78' name='L78'></a>    78 <em class='comment'>   special event buffer named hold_quit.  When a quit event is</em>
<a id='L79' name='L79'></a>    79 <em class='comment'>   encountered, it is stored inside this special buffer, which will</em>
<a id='L80' name='L80'></a>    80 <em class='comment'>   cause the keyboard code that called XTread_socket to store it at a</em>
<a id='L81' name='L81'></a>    81 <em class='comment'>   later time when it is safe to do so.</em>
<a id='L82' name='L82'></a>    82 <em class='comment'></em>
<a id='L83' name='L83'></a>    83 <em class='comment'>   handle_one_xevent will generally have to determine which frame an</em>
<a id='L84' name='L84'></a>    84 <em class='comment'>   event should be attributed to.  This is not easy, because events</em>
<a id='L85' name='L85'></a>    85 <em class='comment'>   can come from multiple X windows, and a frame can also have</em>
<a id='L86' name='L86'></a>    86 <em class='comment'>   multiple windows.  handle_one_xevent usually calls the function</em>
<a id='L87' name='L87'></a>    87 <em class='comment'>   x_any_window_to_frame, which searches for a frame by toplevel</em>
<a id='L88' name='L88'></a>    88 <em class='comment'>   window and widget windows.  There are also some other functions for</em>
<a id='L89' name='L89'></a>    89 <em class='comment'>   searching by specific types of window, such as</em>
<a id='L90' name='L90'></a>    90 <em class='comment'>   x_top_window_to_frame (which only searches for frames by toplevel</em>
<a id='L91' name='L91'></a>    91 <em class='comment'>   window), and x_menubar_window_to_frame (which will only search</em>
<a id='L92' name='L92'></a>    92 <em class='comment'>   through frame menu bars).</em>
<a id='L93' name='L93'></a>    93 <em class='comment'></em>
<a id='L94' name='L94'></a>    94 <em class='comment'>   INPUT FOCUS</em>
<a id='L95' name='L95'></a>    95 <em class='comment'></em>
<a id='L96' name='L96'></a>    96 <em class='comment'>   Under X, the window where keyboard input is sent is not always</em>
<a id='L97' name='L97'></a>    97 <em class='comment'>   explicitly defined.  When there is a focus window, it receives what</em>
<a id='L98' name='L98'></a>    98 <em class='comment'>   is referred to as "explicit focus", but when there is none, it</em>
<a id='L99' name='L99'></a>    99 <em class='comment'>   receives "implicit focus" whenever the pointer enters it, and loses</em>
<a id='L100' name='L100'></a>   100 <em class='comment'>   that focus when the pointer leaves.  When the toplevel window of a</em>
<a id='L101' name='L101'></a>   101 <em class='comment'>   frame receives an explicit focus event (FocusIn or FocusOut), we</em>
<a id='L102' name='L102'></a>   102 <em class='comment'>   treat that frame as having the current input focus, but when there</em>
<a id='L103' name='L103'></a>   103 <em class='comment'>   is no focus window, we treat each frame as having the input focus</em>
<a id='L104' name='L104'></a>   104 <em class='comment'>   whenever the pointer enters it, and undo that treatment when the</em>
<a id='L105' name='L105'></a>   105 <em class='comment'>   pointer leaves it.  See the callers of x_detect_focus_change for</em>
<a id='L106' name='L106'></a>   106 <em class='comment'>   more details.</em>
<a id='L107' name='L107'></a>   107 <em class='comment'></em>
<a id='L108' name='L108'></a>   108 <em class='comment'>   REDISPLAY</em>
<a id='L109' name='L109'></a>   109 <em class='comment'></em>
<a id='L110' name='L110'></a>   110 <em class='comment'>   The redisplay engine communicates with X through the "redisplay</em>
<a id='L111' name='L111'></a>   111 <em class='comment'>   interface", which is a structure containing pointers to functions</em>
<a id='L112' name='L112'></a>   112 <em class='comment'>   which output graphics to a frame.</em>
<a id='L113' name='L113'></a>   113 <em class='comment'></em>
<a id='L114' name='L114'></a>   114 <em class='comment'>   Some of the functions included in the redisplay interface include</em>
<a id='L115' name='L115'></a>   115 <em class='comment'>   `x_clear_frame_area', which is called by the display engine when it</em>
<a id='L116' name='L116'></a>   116 <em class='comment'>   determines that a part of the display has to be cleared,</em>
<a id='L117' name='L117'></a>   117 <em class='comment'>   x_draw_window_cursor, which is called to perform the calculations</em>
<a id='L118' name='L118'></a>   118 <em class='comment'>   necessary to display the cursor glyph with a special "highlight"</em>
<a id='L119' name='L119'></a>   119 <em class='comment'>   (more on that later) and to set the input method spot location.</em>
<a id='L120' name='L120'></a>   120 <em class='comment'></em>
<a id='L121' name='L121'></a>   121 <em class='comment'>   Most of the actual display is performed by the function</em>
<a id='L122' name='L122'></a>   122 <em class='comment'>   `x_draw_glyph_string', also included in the redisplay interface.</em>
<a id='L123' name='L123'></a>   123 <em class='comment'>   It takes a list of glyphs of the same type and face, computes the</em>
<a id='L124' name='L124'></a>   124 <em class='comment'>   correct graphics context for the string through the function</em>
<a id='L125' name='L125'></a>   125 <em class='comment'>   `x_set_glyph_string_gc', and draws whichever glyphs it might</em>
<a id='L126' name='L126'></a>   126 <em class='comment'>   contain, along with decorations such as the box face, underline and</em>
<a id='L127' name='L127'></a>   127 <em class='comment'>   overline.  That list is referred to as a "glyph string".</em>
<a id='L128' name='L128'></a>   128 <em class='comment'></em>
<a id='L129' name='L129'></a>   129 <em class='comment'>   GRAPHICS CONTEXTS</em>
<a id='L130' name='L130'></a>   130 <em class='comment'></em>
<a id='L131' name='L131'></a>   131 <em class='comment'>   A graphics context ("GC") is an X server-side object which contains</em>
<a id='L132' name='L132'></a>   132 <em class='comment'>   drawing attributes such as fill style, stipple, and foreground and</em>
<a id='L133' name='L133'></a>   133 <em class='comment'>   background pixel values.</em>
<a id='L134' name='L134'></a>   134 <em class='comment'></em>
<a id='L135' name='L135'></a>   135 <em class='comment'>   Usually, one graphics context is computed for each face when it is</em>
<a id='L136' name='L136'></a>   136 <em class='comment'>   about to be displayed for the first time, and this graphics context</em>
<a id='L137' name='L137'></a>   137 <em class='comment'>   is the one which is used for future X drawing operations in a glyph</em>
<a id='L138' name='L138'></a>   138 <em class='comment'>   string with that face.  (See `prepare_face_for_display' in</em>
<a id='L139' name='L139'></a>   139 <em class='comment'>   xfaces.c).</em>
<a id='L140' name='L140'></a>   140 <em class='comment'></em>
<a id='L141' name='L141'></a>   141 <em class='comment'>   However, when drawing glyph strings for special display elements</em>
<a id='L142' name='L142'></a>   142 <em class='comment'>   such as the cursor, or mouse sensitive text, different GCs may be</em>
<a id='L143' name='L143'></a>   143 <em class='comment'>   used.  When displaying the cursor, for example, the frame's cursor</em>
<a id='L144' name='L144'></a>   144 <em class='comment'>   graphics context is used for the common case where the cursor is</em>
<a id='L145' name='L145'></a>   145 <em class='comment'>   drawn with the default font, and the colors of the string's face</em>
<a id='L146' name='L146'></a>   146 <em class='comment'>   are the same as the default face.  In all other cases, a temporary</em>
<a id='L147' name='L147'></a>   147 <em class='comment'>   graphics context is created with the foreground and background</em>
<a id='L148' name='L148'></a>   148 <em class='comment'>   colors of the cursor face adjusted to ensure that the cursor can be</em>
<a id='L149' name='L149'></a>   149 <em class='comment'>   distinguished from its surroundings and that the text inside the</em>
<a id='L150' name='L150'></a>   150 <em class='comment'>   cursor stays visible.</em>
<a id='L151' name='L151'></a>   151 <em class='comment'></em>
<a id='L152' name='L152'></a>   152 <em class='comment'>   Various graphics contexts are also calculated when the frame is</em>
<a id='L153' name='L153'></a>   153 <em class='comment'>   created by the function `x_make_gcs' in xfns.c, and are adjusted</em>
<a id='L154' name='L154'></a>   154 <em class='comment'>   whenever the foreground or background colors change.  The "normal"</em>
<a id='L155' name='L155'></a>   155 <em class='comment'>   graphics context is used for operations performed without a face,</em>
<a id='L156' name='L156'></a>   156 <em class='comment'>   and always corresponds to the foreground and background colors of</em>
<a id='L157' name='L157'></a>   157 <em class='comment'>   the frame's default face, the "reverse" graphics context is used to</em>
<a id='L158' name='L158'></a>   158 <em class='comment'>   draw text in inverse video, and the cursor graphics context is used</em>
<a id='L159' name='L159'></a>   159 <em class='comment'>   to display the cursor in the most common case.</em>
<a id='L160' name='L160'></a>   160 <em class='comment'></em>
<a id='L161' name='L161'></a>   161 <em class='comment'>   N.B. that some of the other window systems supported by use an</em>
<a id='L162' name='L162'></a>   162 <em class='comment'>   emulation of graphics contexts to hold the foreground and</em>
<a id='L163' name='L163'></a>   163 <em class='comment'>   background colors used in a glyph string, while the some others</em>
<a id='L164' name='L164'></a>   164 <em class='comment'>   ports compute those colors directly based on the colors of the</em>
<a id='L165' name='L165'></a>   165 <em class='comment'>   string's face and its highlight, but only on X are graphics</em>
<a id='L166' name='L166'></a>   166 <em class='comment'>   contexts a data structure inherent to the window system.</em>
<a id='L167' name='L167'></a>   167 <em class='comment'></em>
<a id='L168' name='L168'></a>   168 <em class='comment'>   COLOR ALLOCATION</em>
<a id='L169' name='L169'></a>   169 <em class='comment'></em>
<a id='L170' name='L170'></a>   170 <em class='comment'>   In (and only in) X, pixel values for colors are not guaranteed to</em>
<a id='L171' name='L171'></a>   171 <em class='comment'>   correspond to their individual components.  The rules for</em>
<a id='L172' name='L172'></a>   172 <em class='comment'>   converting colors into pixel values are defined by the visual class</em>
<a id='L173' name='L173'></a>   173 <em class='comment'>   of each display opened by Emacs.  When a display is opened, a</em>
<a id='L174' name='L174'></a>   174 <em class='comment'>   suitable visual is obtained from the X server, and a colormap is</em>
<a id='L175' name='L175'></a>   175 <em class='comment'>   created based on that visual, which is then used for each frame</em>
<a id='L176' name='L176'></a>   176 <em class='comment'>   created.</em>
<a id='L177' name='L177'></a>   177 <em class='comment'></em>
<a id='L178' name='L178'></a>   178 <em class='comment'>   The colormap is then used by the X server to convert pixel values</em>
<a id='L179' name='L179'></a>   179 <em class='comment'>   from a frame created by Emacs into actual colors which are output</em>
<a id='L180' name='L180'></a>   180 <em class='comment'>   onto the physical display.</em>
<a id='L181' name='L181'></a>   181 <em class='comment'></em>
<a id='L182' name='L182'></a>   182 <em class='comment'>   When the visual class is TrueColor, the colormap will be indexed</em>
<a id='L183' name='L183'></a>   183 <em class='comment'>   based on the red, green, and blue (RGB) components of the pixel</em>
<a id='L184' name='L184'></a>   184 <em class='comment'>   values, and the colormap will be statically allocated so as to</em>
<a id='L185' name='L185'></a>   185 <em class='comment'>   contain linear ramps for each component.  As such, most of the</em>
<a id='L186' name='L186'></a>   186 <em class='comment'>   color allocation described below is bypassed, and the pixel values</em>
<a id='L187' name='L187'></a>   187 <em class='comment'>   are computed directly from the color.</em>
<a id='L188' name='L188'></a>   188 <em class='comment'></em>
<a id='L189' name='L189'></a>   189 <em class='comment'>   Otherwise, each time Emacs wants a pixel value that corresponds to</em>
<a id='L190' name='L190'></a>   190 <em class='comment'>   a color, Emacs has to ask the X server to obtain the pixel value</em>
<a id='L191' name='L191'></a>   191 <em class='comment'>   that corresponds to a "color cell" containing the color (or a close</em>
<a id='L192' name='L192'></a>   192 <em class='comment'>   approximation) from the colormap.  Exactly how this is accomplished</em>
<a id='L193' name='L193'></a>   193 <em class='comment'>   further depends on the visual class, since some visuals have</em>
<a id='L194' name='L194'></a>   194 <em class='comment'>   immutable colormaps which contain color cells with pre-defined</em>
<a id='L195' name='L195'></a>   195 <em class='comment'>   values, while others have colormaps where the color cells are</em>
<a id='L196' name='L196'></a>   196 <em class='comment'>   dynamically allocated by individual X clients.</em>
<a id='L197' name='L197'></a>   197 <em class='comment'></em>
<a id='L198' name='L198'></a>   198 <em class='comment'>   With visuals that have a visual class of StaticColor and StaticGray</em>
<a id='L199' name='L199'></a>   199 <em class='comment'>   (where the former is the case), the X server is asked to procure</em>
<a id='L200' name='L200'></a>   200 <em class='comment'>   the pixel value of a color cell that contains the closest</em>
<a id='L201' name='L201'></a>   201 <em class='comment'>   approximation of the color which Emacs wants.  On the other hand,</em>
<a id='L202' name='L202'></a>   202 <em class='comment'>   when the visual class is DirectColor, PseudoColor, or GrayScale,</em>
<a id='L203' name='L203'></a>   203 <em class='comment'>   where color cells are dynamically allocated by clients, Emacs asks</em>
<a id='L204' name='L204'></a>   204 <em class='comment'>   the X server to allocate a color cell containing the desired color,</em>
<a id='L205' name='L205'></a>   205 <em class='comment'>   and uses its pixel value.</em>
<a id='L206' name='L206'></a>   206 <em class='comment'></em>
<a id='L207' name='L207'></a>   207 <em class='comment'>   (If the color already exists, the X server returns an existing color</em>
<a id='L208' name='L208'></a>   208 <em class='comment'>   cell, but increases its reference count, so it still has to be</em>
<a id='L209' name='L209'></a>   209 <em class='comment'>   freed afterwards.)</em>
<a id='L210' name='L210'></a>   210 <em class='comment'></em>
<a id='L211' name='L211'></a>   211 <em class='comment'>   Otherwise, if no color could be allocated (due to the colormap</em>
<a id='L212' name='L212'></a>   212 <em class='comment'>   being full), Emacs looks for a color cell inside the colormap</em>
<a id='L213' name='L213'></a>   213 <em class='comment'>   closest to the desired color, and uses its pixel value instead.</em>
<a id='L214' name='L214'></a>   214 <em class='comment'></em>
<a id='L215' name='L215'></a>   215 <em class='comment'>   Since the capacity of a colormap is finite, X clients have to take</em>
<a id='L216' name='L216'></a>   216 <em class='comment'>   special precautions in order to not allocate too many color cells</em>
<a id='L217' name='L217'></a>   217 <em class='comment'>   that are never used.  Emacs allocates its color cells when a face</em>
<a id='L218' name='L218'></a>   218 <em class='comment'>   is being realized or when a frame changes its foreground and</em>
<a id='L219' name='L219'></a>   219 <em class='comment'>   background colors, and releases them alongside the face or frame.</em>
<a id='L220' name='L220'></a>   220 <em class='comment'>   See calls to `unload_color' and `load_color' in xterm.c, xfaces.c</em>
<a id='L221' name='L221'></a>   221 <em class='comment'>   and xfns.c for more details.</em>
<a id='L222' name='L222'></a>   222 <em class='comment'></em>
<a id='L223' name='L223'></a>   223 <em class='comment'>   The driving logic behind color allocation is in</em>
<a id='L224' name='L224'></a>   224 <em class='comment'>   `x_alloc_nearest_color_1', while the optimization for TrueColor</em>
<a id='L225' name='L225'></a>   225 <em class='comment'>   visuals is in `x_make_truecolor_pixel'.  Also see `x_query_colors`,</em>
<a id='L226' name='L226'></a>   226 <em class='comment'>   which is used to determine the color values for given pixel</em>
<a id='L227' name='L227'></a>   227 <em class='comment'>   values.</em>
<a id='L228' name='L228'></a>   228 <em class='comment'></em>
<a id='L229' name='L229'></a>   229 <em class='comment'>   In other window systems supported by Emacs, color allocation is</em>
<a id='L230' name='L230'></a>   230 <em class='comment'>   handled by the window system itself, to whom Emacs simply passes 24</em>
<a id='L231' name='L231'></a>   231 <em class='comment'>   (or 32-bit) RGB values.</em>
<a id='L232' name='L232'></a>   232 <em class='comment'></em>
<a id='L233' name='L233'></a>   233 <em class='comment'>   OPTIONAL FEATURES</em>
<a id='L234' name='L234'></a>   234 <em class='comment'></em>
<a id='L235' name='L235'></a>   235 <em class='comment'>   While X servers and client libraries tend to come with many</em>
<a id='L236' name='L236'></a>   236 <em class='comment'>   extensions to the core X11R6 protocol, dependencies on anything</em>
<a id='L237' name='L237'></a>   237 <em class='comment'>   other than the core X11R6 protocol and Xlib should be optional at</em>
<a id='L238' name='L238'></a>   238 <em class='comment'>   both compile-time and runtime.  Emacs should also not crash</em>
<a id='L239' name='L239'></a>   239 <em class='comment'>   regardless of what combination of X server and client-side features</em>
<a id='L240' name='L240'></a>   240 <em class='comment'>   are present.  For example, if you are developing a feature that</em>
<a id='L241' name='L241'></a>   241 <em class='comment'>   will need Xfixes, then add a test in configure.ac for the library</em>
<a id='L242' name='L242'></a>   242 <em class='comment'>   at compile-time which defines `HAVE_XFIXES', like this:</em>
<a id='L243' name='L243'></a>   243 <em class='comment'></em>
<a id='L244' name='L244'></a>   244 <em class='comment'>     ### Use Xfixes (-lXfixes) if available</em>
<a id='L245' name='L245'></a>   245 <em class='comment'>     HAVE_XFIXES=no</em>
<a id='L246' name='L246'></a>   246 <em class='comment'>     if test "${HAVE_X11}" = "yes"; then</em>
<a id='L247' name='L247'></a>   247 <em class='comment'>       XFIXES_REQUIRED=4.0.0</em>
<a id='L248' name='L248'></a>   248 <em class='comment'>       XFIXES_MODULES="xfixes &gt;= $XFIXES_REQUIRED"</em>
<a id='L249' name='L249'></a>   249 <em class='comment'>       EMACS_CHECK_MODULES([XFIXES], [$XFIXES_MODULES])</em>
<a id='L250' name='L250'></a>   250 <em class='comment'>       if test $HAVE_XFIXES = no; then</em>
<a id='L251' name='L251'></a>   251 <em class='comment'>         # Test old way in case pkg-config doesn't have it (older machines).</em>
<a id='L252' name='L252'></a>   252 <em class='comment'>         AC_CHECK_HEADER([X11/extensions/Xfixes.h],</em>
<a id='L253' name='L253'></a>   253 <em class='comment'>           [AC_CHECK_LIB([Xfixes], [XFixesHideCursor], [HAVE_XFIXES=yes])])</em>
<a id='L254' name='L254'></a>   254 <em class='comment'>         if test $HAVE_XFIXES = yes; then</em>
<a id='L255' name='L255'></a>   255 <em class='comment'>           XFIXES_LIBS=-lXfixes</em>
<a id='L256' name='L256'></a>   256 <em class='comment'>         fi</em>
<a id='L257' name='L257'></a>   257 <em class='comment'>       fi</em>
<a id='L258' name='L258'></a>   258 <em class='comment'>       if test $HAVE_XFIXES = yes; then</em>
<a id='L259' name='L259'></a>   259 <em class='comment'>         AC_DEFINE([HAVE_XFIXES], [1],</em>
<a id='L260' name='L260'></a>   260 <em class='comment'>           [Define to 1 if you have the Xfixes extension.])</em>
<a id='L261' name='L261'></a>   261 <em class='comment'>       fi</em>
<a id='L262' name='L262'></a>   262 <em class='comment'>     fi</em>
<a id='L263' name='L263'></a>   263 <em class='comment'>     AC_SUBST([XFIXES_CFLAGS])</em>
<a id='L264' name='L264'></a>   264 <em class='comment'>     AC_SUBST([XFIXES_LIBS])</em>
<a id='L265' name='L265'></a>   265 <em class='comment'></em>
<a id='L266' name='L266'></a>   266 <em class='comment'>  Then, make sure to adjust CFLAGS and LIBES in src/Makefile.in and</em>
<a id='L267' name='L267'></a>   267 <em class='comment'>  add the new XFIXES_CFLAGS and XFIXES_LIBS variables to</em>
<a id='L268' name='L268'></a>   268 <em class='comment'>  msdos/sed1v2.inp.  (The latter has to be adjusted for any new</em>
<a id='L269' name='L269'></a>   269 <em class='comment'>  variables that are included in CFLAGS and LIBES even if the</em>
<a id='L270' name='L270'></a>   270 <em class='comment'>  libraries are not used by the MS-DOS port.)</em>
<a id='L271' name='L271'></a>   271 <em class='comment'></em>
<a id='L272' name='L272'></a>   272 <em class='comment'>  Finally, add some fields in `struct x_display_info' which specify</em>
<a id='L273' name='L273'></a>   273 <em class='comment'>  the major and minor versions of the extension, and whether or not to</em>
<a id='L274' name='L274'></a>   274 <em class='comment'>  support them.  They (and their accessors) should be protected by the</em>
<a id='L275' name='L275'></a>   275 <em class='comment'>  `HAVE_XFIXES' preprocessor conditional.  Then, these fields should</em>
<a id='L276' name='L276'></a>   276 <em class='comment'>  be set in `x_term_init', and all Xfixes calls must be protected by</em>
<a id='L277' name='L277'></a>   277 <em class='comment'>  not only the preprocessor conditional, but also by checks against</em>
<a id='L278' name='L278'></a>   278 <em class='comment'>  those variables.</em>
<a id='L279' name='L279'></a>   279 <em class='comment'></em>
<a id='L280' name='L280'></a>   280 <em class='comment'>  X TOOLKIT SUPPORT</em>
<a id='L281' name='L281'></a>   281 <em class='comment'></em>
<a id='L282' name='L282'></a>   282 <em class='comment'>  Emacs supports being built with many different toolkits (and also no</em>
<a id='L283' name='L283'></a>   283 <em class='comment'>  toolkit at all), which provide decorations such as menu bars and</em>
<a id='L284' name='L284'></a>   284 <em class='comment'>  scroll bars, along with handy features like file panels, dialog</em>
<a id='L285' name='L285'></a>   285 <em class='comment'>  boxes, font panels, and popup menus.  Those configurations can</em>
<a id='L286' name='L286'></a>   286 <em class='comment'>  roughly be classified as belonging to one of three categories:</em>
<a id='L287' name='L287'></a>   287 <em class='comment'></em>
<a id='L288' name='L288'></a>   288 <em class='comment'>    - Using no toolkit at all.</em>
<a id='L289' name='L289'></a>   289 <em class='comment'>    - Using the X Toolkit Intrinsics (Xt).</em>
<a id='L290' name='L290'></a>   290 <em class='comment'>    - Using GTK.</em>
<a id='L291' name='L291'></a>   291 <em class='comment'></em>
<a id='L292' name='L292'></a>   292 <em class='comment'>  The no toolkit configuration is the simplest: no toolkit widgets are</em>
<a id='L293' name='L293'></a>   293 <em class='comment'>  used, Emacs uses its own implementation of scroll bars, and the</em>
<a id='L294' name='L294'></a>   294 <em class='comment'>  XMenu library that came with X11R2 and earlier versions of X is used</em>
<a id='L295' name='L295'></a>   295 <em class='comment'>  for popup menus.  There is also no complicated window structure to</em>
<a id='L296' name='L296'></a>   296 <em class='comment'>  speak of.</em>
<a id='L297' name='L297'></a>   297 <em class='comment'></em>
<a id='L298' name='L298'></a>   298 <em class='comment'>  The Xt configurations come in either the Lucid or Motif flavors.</em>
<a id='L299' name='L299'></a>   299 <em class='comment'>  The former utilizes Emacs's own Xt-based Lucid widget library for</em>
<a id='L300' name='L300'></a>   300 <em class='comment'>  menus, and Xaw (or derivatives such as neXTaw and Xaw3d) for dialog</em>
<a id='L301' name='L301'></a>   301 <em class='comment'>  boxes and, optionally, scroll bars.  It does not support file</em>
<a id='L302' name='L302'></a>   302 <em class='comment'>  panels.  The latter uses either Motif or LessTif for menu bars,</em>
<a id='L303' name='L303'></a>   303 <em class='comment'>  popup menus, dialogs and file panels.</em>
<a id='L304' name='L304'></a>   304 <em class='comment'></em>
<a id='L305' name='L305'></a>   305 <em class='comment'>  The GTK configurations come in the GTK+ 2 or GTK 3 configurations,</em>
<a id='L306' name='L306'></a>   306 <em class='comment'>  where the toolkit provides all the aforementioned decorations and</em>
<a id='L307' name='L307'></a>   307 <em class='comment'>  features.  They work mostly the same, though GTK 3 has various small</em>
<a id='L308' name='L308'></a>   308 <em class='comment'>  annoyances that complicate maintenance.</em>
<a id='L309' name='L309'></a>   309 <em class='comment'></em>
<a id='L310' name='L310'></a>   310 <em class='comment'>  All of those configurations have various special technicalities</em>
<a id='L311' name='L311'></a>   311 <em class='comment'>  about event handling and the layout of windows inside a frame that</em>
<a id='L312' name='L312'></a>   312 <em class='comment'>  must be kept in mind when writing X code which is run on all of</em>
<a id='L313' name='L313'></a>   313 <em class='comment'>  them.</em>
<a id='L314' name='L314'></a>   314 <em class='comment'></em>
<a id='L315' name='L315'></a>   315 <em class='comment'>  The no toolkit configuration has no noteworthy aspects about the</em>
<a id='L316' name='L316'></a>   316 <em class='comment'>  layout of windows inside a frame, since each frame has only one</em>
<a id='L317' name='L317'></a>   317 <em class='comment'>  associated window aside from scroll bars.  However, in the Xt</em>
<a id='L318' name='L318'></a>   318 <em class='comment'>  configurations, every widget is a separate window, and there are</em>
<a id='L319' name='L319'></a>   319 <em class='comment'>  quite a few widgets.  The "outer widget", a widget of class</em>
<a id='L320' name='L320'></a>   320 <em class='comment'>  ApplicationShell, is the top-level window of a frame.  Its window is</em>
<a id='L321' name='L321'></a>   321 <em class='comment'>  accessed via the macro `FRAME_OUTER_WINDOW'.  The "edit widget", a</em>
<a id='L322' name='L322'></a>   322 <em class='comment'>  widget class of EmacsFrame, is a child of the outer widget that</em>
<a id='L323' name='L323'></a>   323 <em class='comment'>  controls the size of a frame as known to Emacs, and is the widget</em>
<a id='L324' name='L324'></a>   324 <em class='comment'>  that Emacs draws to during display operations.  The "menu bar</em>
<a id='L325' name='L325'></a>   325 <em class='comment'>  widget" is the widget holding the menu bar.</em>
<a id='L326' name='L326'></a>   326 <em class='comment'></em>
<a id='L327' name='L327'></a>   327 <em class='comment'>  Special care must be taken when performing operations on a frame.</em>
<a id='L328' name='L328'></a>   328 <em class='comment'>  Properties that are used by the window manager, for example, must be</em>
<a id='L329' name='L329'></a>   329 <em class='comment'>  set on the outer widget.  Drawing, on the other hand, must be done</em>
<a id='L330' name='L330'></a>   330 <em class='comment'>  to the edit widget, and button press events on the menu bar widget</em>
<a id='L331' name='L331'></a>   331 <em class='comment'>  must be redirected and not sent to Xt until the Lisp code is run to</em>
<a id='L332' name='L332'></a>   332 <em class='comment'>  update the menu bar.</em>
<a id='L333' name='L333'></a>   333 <em class='comment'></em>
<a id='L334' name='L334'></a>   334 <em class='comment'>  The EmacsFrame widget is specific to Emacs and is implemented in</em>
<a id='L335' name='L335'></a>   335 <em class='comment'>  widget.c.  See that file for more details.</em>
<a id='L336' name='L336'></a>   336 <em class='comment'></em>
<a id='L337' name='L337'></a>   337 <em class='comment'>  In the GTK configurations, GTK widgets do not necessarily correspond</em>
<a id='L338' name='L338'></a>   338 <em class='comment'>  to X windows, since the toolkit might decide to keep only a</em>
<a id='L339' name='L339'></a>   339 <em class='comment'>  client-side record of the widgets for performance reasons.</em>
<a id='L340' name='L340'></a>   340 <em class='comment'></em>
<a id='L341' name='L341'></a>   341 <em class='comment'>  Because the GtkFixed widget that holds the "edit area" might not</em>
<a id='L342' name='L342'></a>   342 <em class='comment'>  correspond to an X window, drawing operations may be directly</em>
<a id='L343' name='L343'></a>   343 <em class='comment'>  performed on the outer window, with special care taken to not</em>
<a id='L344' name='L344'></a>   344 <em class='comment'>  overwrite the surrounding GTK widgets.  This also means that the</em>
<a id='L345' name='L345'></a>   345 <em class='comment'>  only important window for most purposes is the outer window, which</em>
<a id='L346' name='L346'></a>   346 <em class='comment'>  on GTK builds can usually be accessed using the macro</em>
<a id='L347' name='L347'></a>   347 <em class='comment'>  `FRAME_X_WINDOW'.</em>
<a id='L348' name='L348'></a>   348 <em class='comment'></em>
<a id='L349' name='L349'></a>   349 <em class='comment'>  How `handle_one_xevent' is called also depends on the configuration.</em>
<a id='L350' name='L350'></a>   350 <em class='comment'>  Without a toolkit, Emacs performs all event processing by itself,</em>
<a id='L351' name='L351'></a>   351 <em class='comment'>  running XPending and XNextEvent in a loop whenever there is input,</em>
<a id='L352' name='L352'></a>   352 <em class='comment'>  passing the event to `handle_one_xevent'.</em>
<a id='L353' name='L353'></a>   353 <em class='comment'></em>
<a id='L354' name='L354'></a>   354 <em class='comment'>  When using Xt, the same is performed, but `handle_one_xevent' may</em>
<a id='L355' name='L355'></a>   355 <em class='comment'>  also decide to call XtDispatchEvent on an event after Emacs finishes</em>
<a id='L356' name='L356'></a>   356 <em class='comment'>  processing it.</em>
<a id='L357' name='L357'></a>   357 <em class='comment'></em>
<a id='L358' name='L358'></a>   358 <em class='comment'>  When using GTK, however, `handle_one_xevent' is called from an event</em>
<a id='L359' name='L359'></a>   359 <em class='comment'>  filter installed on the GTK event loop.  Unless the event filter</em>
<a id='L360' name='L360'></a>   360 <em class='comment'>  elects to drop the event, it will be passed to GTK right after</em>
<a id='L361' name='L361'></a>   361 <em class='comment'>  leaving the event filter.</em>
<a id='L362' name='L362'></a>   362 <em class='comment'></em>
<a id='L363' name='L363'></a>   363 <em class='comment'>  Fortunately, `handle_one_xevent' is provided a `*finish' parameter</em>
<a id='L364' name='L364'></a>   364 <em class='comment'>  that abstracts away all these details.  If it is `X_EVENT_DROP',</em>
<a id='L365' name='L365'></a>   365 <em class='comment'>  then the event will not be dispatched to Xt or utilized by GTK.</em>
<a id='L366' name='L366'></a>   366 <em class='comment'>  Code inside `handle_one_xevent' should thus avoid making assumptions</em>
<a id='L367' name='L367'></a>   367 <em class='comment'>  about the event dispatch mechanism and use that parameter</em>
<a id='L368' name='L368'></a>   368 <em class='comment'>  instead.</em>
<a id='L369' name='L369'></a>   369 <em class='comment'></em>
<a id='L370' name='L370'></a>   370 <em class='comment'>  FRAME RESIZING</em>
<a id='L371' name='L371'></a>   371 <em class='comment'></em>
<a id='L372' name='L372'></a>   372 <em class='comment'>  In the following explanations "frame size" refers to the "native</em>
<a id='L373' name='L373'></a>   373 <em class='comment'>  size" of a frame as reported by the (frame.h) macros</em>
<a id='L374' name='L374'></a>   374 <em class='comment'>  FRAME_PIXEL_WIDTH and FRAME_PIXEL_HEIGHT.  These specify the size of</em>
<a id='L375' name='L375'></a>   375 <em class='comment'>  a frame as the values passed to/received from a toolkit and the</em>
<a id='L376' name='L376'></a>   376 <em class='comment'>  window manager.  The "text size" Emacs Lisp code uses in functions</em>
<a id='L377' name='L377'></a>   377 <em class='comment'>  like 'set-frame-size' or sees in the ‘width’ and 'height' frame</em>
<a id='L378' name='L378'></a>   378 <em class='comment'>  parameters is only loosely related to the native size.  The</em>
<a id='L379' name='L379'></a>   379 <em class='comment'>  necessary translations are provided by the macros</em>
<a id='L380' name='L380'></a>   380 <em class='comment'>  FRAME_TEXT_TO_PIXEL_WIDTH and FRAME_TEXT_TO_PIXEL_HEIGHT as well as</em>
<a id='L381' name='L381'></a>   381 <em class='comment'>  FRAME_PIXEL_TO_TEXT_WIDTH and FRAME_PIXEL_TO_TEXT_HEIGHT (in</em>
<a id='L382' name='L382'></a>   382 <em class='comment'>  frame.h).</em>
<a id='L383' name='L383'></a>   383 <em class='comment'></em>
<a id='L384' name='L384'></a>   384 <em class='comment'>  Lisp functions may ask for resizing a frame either explicitly, using</em>
<a id='L385' name='L385'></a>   385 <em class='comment'>  one of the interfaces provided for that purpose like, for example,</em>
<a id='L386' name='L386'></a>   386 <em class='comment'>  'set-frame-size' or changing the 'height' or 'width' parameter of</em>
<a id='L387' name='L387'></a>   387 <em class='comment'>  that frame, or implicitly, for example, by turning off/on or</em>
<a id='L388' name='L388'></a>   388 <em class='comment'>  changing the width of fringes or scroll bars for that frame.  Any</em>
<a id='L389' name='L389'></a>   389 <em class='comment'>  such request passes through the routine 'adjust_frame_size' (in</em>
<a id='L390' name='L390'></a>   390 <em class='comment'>  frame.c) which decides, among others, whether the native frame size</em>
<a id='L391' name='L391'></a>   391 <em class='comment'>  would really change and whether it is allowed to change it at that</em>
<a id='L392' name='L392'></a>   392 <em class='comment'>  moment.  Only if 'adjust_frame_size' decides that the corresponding</em>
<a id='L393' name='L393'></a>   393 <em class='comment'>  terminal's 'set_window_size_hook' may be run, it will dispatch</em>
<a id='L394' name='L394'></a>   394 <em class='comment'>  execution to the appropriate function which, for X builds, is</em>
<a id='L395' name='L395'></a>   395 <em class='comment'>  'x_set_window_size' in this file.</em>
<a id='L396' name='L396'></a>   396 <em class='comment'></em>
<a id='L397' name='L397'></a>   397 <em class='comment'>  For GTK builds, 'x_set_window_size' calls 'xg_frame_set_char_size'</em>
<a id='L398' name='L398'></a>   398 <em class='comment'>  in gtkutil.c if the frame has an edit widget and</em>
<a id='L399' name='L399'></a>   399 <em class='comment'>  'x_set_window_size_1' in this file otherwise.  For non-GTK builds,</em>
<a id='L400' name='L400'></a>   400 <em class='comment'>  'x_set_window_size' always calls 'x_set_window_size_1' directly.</em>
<a id='L401' name='L401'></a>   401 <em class='comment'></em>
<a id='L402' name='L402'></a>   402 <em class='comment'>  'xg_frame_set_char_size' calls the GTK function 'gtk_window_resize'</em>
<a id='L403' name='L403'></a>   403 <em class='comment'>  for the frame's outer widget; x_set_window_size_1 calls the Xlib</em>
<a id='L404' name='L404'></a>   404 <em class='comment'>  function 'XResizeWindow' instead.  In either case, if Emacs thinks</em>
<a id='L405' name='L405'></a>   405 <em class='comment'>  that the frame is visible, it will wait for a ConfigureNotify event</em>
<a id='L406' name='L406'></a>   406 <em class='comment'>  (see below) to occur within a timeout of 'x-wait-for-event-timeout'</em>
<a id='L407' name='L407'></a>   407 <em class='comment'>  (the default is 0.1 seconds).  If Emacs thinks that the frame is not</em>
<a id='L408' name='L408'></a>   408 <em class='comment'>  visible, it calls 'adjust_frame_size' to run 'resize_frame_windows'</em>
<a id='L409' name='L409'></a>   409 <em class='comment'>  (see below) and hopes for the best.</em>
<a id='L410' name='L410'></a>   410 <em class='comment'></em>
<a id='L411' name='L411'></a>   411 <em class='comment'>  Note that if Emacs receives a ConfigureEvent in response to an</em>
<a id='L412' name='L412'></a>   412 <em class='comment'>  earlier resize request, the sizes specified by that event are not</em>
<a id='L413' name='L413'></a>   413 <em class='comment'>  necessarily the sizes Emacs requested.  Window manager and toolkit</em>
<a id='L414' name='L414'></a>   414 <em class='comment'>  may override any of the requested sizes for their own reasons.</em>
<a id='L415' name='L415'></a>   415 <em class='comment'></em>
<a id='L416' name='L416'></a>   416 <em class='comment'>  On X, size notifications are received as ConfigureNotify events.</em>
<a id='L417' name='L417'></a>   417 <em class='comment'>  The expected reaction to such an event on the Emacs side is to</em>
<a id='L418' name='L418'></a>   418 <em class='comment'>  resize all Emacs windows that are on the frame referred to by the</em>
<a id='L419' name='L419'></a>   419 <em class='comment'>  event.  Since resizing Emacs windows and redisplaying their buffers</em>
<a id='L420' name='L420'></a>   420 <em class='comment'>  is a costly operation, Emacs may collapse several subsequent</em>
<a id='L421' name='L421'></a>   421 <em class='comment'>  ConfigureNotify events into one to avoid that Emacs falls behind in</em>
<a id='L422' name='L422'></a>   422 <em class='comment'>  user interactions like resizing a frame by dragging one of its</em>
<a id='L423' name='L423'></a>   423 <em class='comment'>  borders with the mouse.</em>
<a id='L424' name='L424'></a>   424 <em class='comment'></em>
<a id='L425' name='L425'></a>   425 <em class='comment'>  Each ConfigureEvent event specifies a window, a width and a height.</em>
<a id='L426' name='L426'></a>   426 <em class='comment'>  The event loop uses 'x_top_window_to_frame' to associate the window</em>
<a id='L427' name='L427'></a>   427 <em class='comment'>  with its frame.  Once the frame has been identified, on GTK the</em>
<a id='L428' name='L428'></a>   428 <em class='comment'>  event is dispatched to 'xg_frame_resized'.  On Motif/Lucid</em>
<a id='L429' name='L429'></a>   429 <em class='comment'>  'x_window' has installed 'EmacsFrameResize' as the routine that</em>
<a id='L430' name='L430'></a>   430 <em class='comment'>  handles resize events.  In either case, these routines end up</em>
<a id='L431' name='L431'></a>   431 <em class='comment'>  calling the function 'change_frame_size' in dispnew.c.  On</em>
<a id='L432' name='L432'></a>   432 <em class='comment'>  non-toolkit builds the effect is to call 'change_frame_size'</em>
<a id='L433' name='L433'></a>   433 <em class='comment'>  directly from the event loop.  In either case, the value true is</em>
<a id='L434' name='L434'></a>   434 <em class='comment'>  passed as the DELAY argument.</em>
<a id='L435' name='L435'></a>   435 <em class='comment'></em>
<a id='L436' name='L436'></a>   436 <em class='comment'>  'change_frame_size' is the central function to decide whether it is</em>
<a id='L437' name='L437'></a>   437 <em class='comment'>  safe to process a resize request immediately or it has to be delayed</em>
<a id='L438' name='L438'></a>   438 <em class='comment'>  (usually because its DELAY argument is true).  Since resizing a</em>
<a id='L439' name='L439'></a>   439 <em class='comment'>  frame's windows may run arbitrary Lisp code, Emacs cannot generally</em>
<a id='L440' name='L440'></a>   440 <em class='comment'>  process resize requests during redisplay and therefore has to queue</em>
<a id='L441' name='L441'></a>   441 <em class='comment'>  them.  If processing the event must be delayed, the new sizes (that</em>
<a id='L442' name='L442'></a>   442 <em class='comment'>  is, the ones requested by the ConfigureEvent) are stored in the</em>
<a id='L443' name='L443'></a>   443 <em class='comment'>  new_width and new_height slots of the respective frame structure,</em>
<a id='L444' name='L444'></a>   444 <em class='comment'>  possibly replacing ones that have been stored there upon the receipt</em>
<a id='L445' name='L445'></a>   445 <em class='comment'>  of a preceding ConfigureEvent.</em>
<a id='L446' name='L446'></a>   446 <em class='comment'></em>
<a id='L447' name='L447'></a>   447 <em class='comment'>  Delayed size changes are applied eventually upon calls of the</em>
<a id='L448' name='L448'></a>   448 <em class='comment'>  function 'do_pending_window_change' (in dispnew.c) which is called</em>
<a id='L449' name='L449'></a>   449 <em class='comment'>  by the redisplay code at suitable spots where it's safe to change</em>
<a id='L450' name='L450'></a>   450 <em class='comment'>  sizes.  'do_pending_window_change' calls 'change_frame_size' with</em>
<a id='L451' name='L451'></a>   451 <em class='comment'>  its DELAY argument false in the hope that it is now safe to call the</em>
<a id='L452' name='L452'></a>   452 <em class='comment'>  function 'resize_frame_windows' (in window.c) which is in charge of</em>
<a id='L453' name='L453'></a>   453 <em class='comment'>  adjusting the sizes of all Emacs windows on the frame accordingly.</em>
<a id='L454' name='L454'></a>   454 <em class='comment'>  Note that if 'resize_frame_windows' decides that the windows of a</em>
<a id='L455' name='L455'></a>   455 <em class='comment'>  frame do not fit into the constraints set up by the new frame sizes,</em>
<a id='L456' name='L456'></a>   456 <em class='comment'>  it will resize the windows to some minimum sizes with the effect</em>
<a id='L457' name='L457'></a>   457 <em class='comment'>  that parts of the frame at the right and bottom will appear clipped</em>
<a id='L458' name='L458'></a>   458 <em class='comment'>  off.</em>
<a id='L459' name='L459'></a>   459 <em class='comment'></em>
<a id='L460' name='L460'></a>   460 <em class='comment'>  In addition to explicitly passing width and height values in</em>
<a id='L461' name='L461'></a>   461 <em class='comment'>  functions like 'gtk_window_resize' or 'XResizeWindow', Emacs also</em>
<a id='L462' name='L462'></a>   462 <em class='comment'>  sets window manager size hints - a more implicit form of asking for</em>
<a id='L463' name='L463'></a>   463 <em class='comment'>  the size Emacs would like its frames to assume.  Some of these hints</em>
<a id='L464' name='L464'></a>   464 <em class='comment'>  only restate the size and the position explicitly requested for a</em>
<a id='L465' name='L465'></a>   465 <em class='comment'>  frame.  Another hint specifies the increments in which the window</em>
<a id='L466' name='L466'></a>   466 <em class='comment'>  manager should resize a frame to - either set to the default</em>
<a id='L467' name='L467'></a>   467 <em class='comment'>  character size of a frame or to one pixel for a non-nil value of</em>
<a id='L468' name='L468'></a>   468 <em class='comment'>  'frame-resize-pixelwise'.  See the function 'x_wm_set_size_hint' -</em>
<a id='L469' name='L469'></a>   469 <em class='comment'>  in gtkutil.c for GTK and in this file for other builds - for the</em>
<a id='L470' name='L470'></a>   470 <em class='comment'>  details.</em>
<a id='L471' name='L471'></a>   471 <em class='comment'></em>
<a id='L472' name='L472'></a>   472 <em class='comment'>  We have not discussed here a number of special issues like, for</em>
<a id='L473' name='L473'></a>   473 <em class='comment'>  example, how to handle size requests and notifications for maximized</em>
<a id='L474' name='L474'></a>   474 <em class='comment'>  and fullscreen frames or how to resize child frames.  Some of these</em>
<a id='L475' name='L475'></a>   475 <em class='comment'>  require special treatment depending on the desktop or window manager</em>
<a id='L476' name='L476'></a>   476 <em class='comment'>  used.</em>
<a id='L477' name='L477'></a>   477 <em class='comment'></em>
<a id='L478' name='L478'></a>   478 <em class='comment'>  One thing that might come handy when investigating problems wrt</em>
<a id='L479' name='L479'></a>   479 <em class='comment'>  resizing frames is the variable 'frame-size-history'.  Setting this</em>
<a id='L480' name='L480'></a>   480 <em class='comment'>  to a non-nil value, will cause Emacs to start recording frame size</em>
<a id='L481' name='L481'></a>   481 <em class='comment'>  adjustments, usually specified by the function that asked for an</em>
<a id='L482' name='L482'></a>   482 <em class='comment'>  adjustment, a sizes part that records the old and new values of the</em>
<a id='L483' name='L483'></a>   483 <em class='comment'>  frame's width and height and maybe some additional information.  The</em>
<a id='L484' name='L484'></a>   484 <em class='comment'>  internal function `frame--size-history' can then be used to display</em>
<a id='L485' name='L485'></a>   485 <em class='comment'>  the value of this variable in a more readable form.</em>
<a id='L486' name='L486'></a>   486 <em class='comment'></em>
<a id='L487' name='L487'></a>   487 <em class='comment'>  FRAME RESIZE SYNCHRONIZATION</em>
<a id='L488' name='L488'></a>   488 <em class='comment'></em>
<a id='L489' name='L489'></a>   489 <em class='comment'>  The X window system operates asynchronously.  That is to say, the</em>
<a id='L490' name='L490'></a>   490 <em class='comment'>  window manager and X server might think a window has been resized</em>
<a id='L491' name='L491'></a>   491 <em class='comment'>  before Emacs has a chance to process the ConfigureNotify event that</em>
<a id='L492' name='L492'></a>   492 <em class='comment'>  was sent.</em>
<a id='L493' name='L493'></a>   493 <em class='comment'></em>
<a id='L494' name='L494'></a>   494 <em class='comment'>  When a compositing manager is present, and the X server and Emacs</em>
<a id='L495' name='L495'></a>   495 <em class='comment'>  both support the X synchronization extension, the semi-standard</em>
<a id='L496' name='L496'></a>   496 <em class='comment'>  frame synchronization protocol can be used to notify the compositing</em>
<a id='L497' name='L497'></a>   497 <em class='comment'>  manager of when Emacs has actually finished redisplaying the</em>
<a id='L498' name='L498'></a>   498 <em class='comment'>  contents of a frame after a resize.  The compositing manager will</em>
<a id='L499' name='L499'></a>   499 <em class='comment'>  customarily then postpone displaying the contents of the frame until</em>
<a id='L500' name='L500'></a>   500 <em class='comment'>  the redisplay is complete.</em>
<a id='L501' name='L501'></a>   501 <em class='comment'></em>
<a id='L502' name='L502'></a>   502 <em class='comment'>  Emacs announces support for this protocol by creating an X</em>
<a id='L503' name='L503'></a>   503 <em class='comment'>  server-side counter object, and setting it as the</em>
<a id='L504' name='L504'></a>   504 <em class='comment'>  `_NET_WM_SYNC_REQUEST_COUNTER' property of the frame's top-level</em>
<a id='L505' name='L505'></a>   505 <em class='comment'>  window.  The window manager then initiates the synchronized resize</em>
<a id='L506' name='L506'></a>   506 <em class='comment'>  process by sending Emacs a ClientMessage event before the</em>
<a id='L507' name='L507'></a>   507 <em class='comment'>  ConfigureNotify event where:</em>
<a id='L508' name='L508'></a>   508 <em class='comment'></em>
<a id='L509' name='L509'></a>   509 <em class='comment'>    type = ClientMessage</em>
<a id='L510' name='L510'></a>   510 <em class='comment'>    window = the respective client window</em>
<a id='L511' name='L511'></a>   511 <em class='comment'>    message_type = WM_PROTOCOLS</em>
<a id='L512' name='L512'></a>   512 <em class='comment'>    format = 32</em>
<a id='L513' name='L513'></a>   513 <em class='comment'>    data.l[0] = _NET_WM_SYNC_REQUEST</em>
<a id='L514' name='L514'></a>   514 <em class='comment'>    data.l[1] = timestamp</em>
<a id='L515' name='L515'></a>   515 <em class='comment'>    data.l[2] = low 32 bits of a provided frame counter value</em>
<a id='L516' name='L516'></a>   516 <em class='comment'>    data.l[3] = high 32 bits of a provided frame counter value</em>
<a id='L517' name='L517'></a>   517 <em class='comment'>    data.l[4] = 1 if the extended frame counter should be updated,</em>
<a id='L518' name='L518'></a>   518 <em class='comment'>    otherwise 0</em>
<a id='L519' name='L519'></a>   519 <em class='comment'></em>
<a id='L520' name='L520'></a>   520 <em class='comment'>  Upon receiving such an event, Emacs constructs and saves a counter</em>
<a id='L521' name='L521'></a>   521 <em class='comment'>  value from the provided low and high 32 bits.  Then, when the</em>
<a id='L522' name='L522'></a>   522 <em class='comment'>  display engine tells us that a frame has been completely updated</em>
<a id='L523' name='L523'></a>   523 <em class='comment'>  (presumably because of a redisplay caused by a ConfigureNotify</em>
<a id='L524' name='L524'></a>   524 <em class='comment'>  event), we set the counter to the saved value, telling the</em>
<a id='L525' name='L525'></a>   525 <em class='comment'>  compositing manager that the contents of the window now accurately</em>
<a id='L526' name='L526'></a>   526 <em class='comment'>  reflect the new size.  The compositing manager will then display the</em>
<a id='L527' name='L527'></a>   527 <em class='comment'>  contents of the window, and the window manager might also postpone</em>
<a id='L528' name='L528'></a>   528 <em class='comment'>  updating the window decorations until this moment.</em>
<a id='L529' name='L529'></a>   529 <em class='comment'></em>
<a id='L530' name='L530'></a>   530 <em class='comment'>  DRAG AND DROP</em>
<a id='L531' name='L531'></a>   531 <em class='comment'></em>
<a id='L532' name='L532'></a>   532 <em class='comment'>  Drag and drop in Emacs is implemented in two ways, depending on</em>
<a id='L533' name='L533'></a>   533 <em class='comment'>  which side initiated the drag-and-drop operation.  When another X</em>
<a id='L534' name='L534'></a>   534 <em class='comment'>  client initiates a drag, and the user drops something on Emacs, a</em>
<a id='L535' name='L535'></a>   535 <em class='comment'>  `drag-n-drop-event' is sent with the contents of the ClientMessage,</em>
<a id='L536' name='L536'></a>   536 <em class='comment'>  and further processing (i.e. retrieving selection contents and</em>
<a id='L537' name='L537'></a>   537 <em class='comment'>  replying to the initiating client) is performed from Lisp inside</em>
<a id='L538' name='L538'></a>   538 <em class='comment'>  `x-dnd.el'.</em>
<a id='L539' name='L539'></a>   539 <em class='comment'></em>
<a id='L540' name='L540'></a>   540 <em class='comment'>  However, dragging contents from Emacs is implemented almost entirely</em>
<a id='L541' name='L541'></a>   541 <em class='comment'>  in C.  X Windows has several competing drag-and-drop protocols, of</em>
<a id='L542' name='L542'></a>   542 <em class='comment'>  which Emacs supports two on the C level: the XDND protocol (see</em>
<a id='L543' name='L543'></a>   543 <em class='comment'>  https://freedesktop.org/wiki/Specifications/XDND) and the Motif drag</em>
<a id='L544' name='L544'></a>   544 <em class='comment'>  and drop protocols.  These protocols are based on the initiator</em>
<a id='L545' name='L545'></a>   545 <em class='comment'>  owning a special selection, specifying an action the recipient</em>
<a id='L546' name='L546'></a>   546 <em class='comment'>  should perform, grabbing the mouse, and sending various different</em>
<a id='L547' name='L547'></a>   547 <em class='comment'>  client messages to the toplevel window underneath the mouse as it</em>
<a id='L548' name='L548'></a>   548 <em class='comment'>  moves, or when buttons are released.</em>
<a id='L549' name='L549'></a>   549 <em class='comment'></em>
<a id='L550' name='L550'></a>   550 <em class='comment'>  The Lisp interface to drag-and-drop is synchronous, and involves</em>
<a id='L551' name='L551'></a>   551 <em class='comment'>  running a nested event loop with some global state until the drag</em>
<a id='L552' name='L552'></a>   552 <em class='comment'>  finishes.  When the mouse moves, Emacs looks up the toplevel window</em>
<a id='L553' name='L553'></a>   553 <em class='comment'>  underneath the pointer (the target window) either using a cache</em>
<a id='L554' name='L554'></a>   554 <em class='comment'>  provided by window managers that support the</em>
<a id='L555' name='L555'></a>   555 <em class='comment'>  _NET_WM_CLIENT_LIST_STACKING root window property, or by calling</em>
<a id='L556' name='L556'></a>   556 <em class='comment'>  XTranslateCoordinates in a loop until a toplevel window is found,</em>
<a id='L557' name='L557'></a>   557 <em class='comment'>  and sends various entry, exit, or motion events to the window</em>
<a id='L558' name='L558'></a>   558 <em class='comment'>  containing a list of targets the special selection can be converted</em>
<a id='L559' name='L559'></a>   559 <em class='comment'>  to, and the chosen action that the recipient should perform.  The</em>
<a id='L560' name='L560'></a>   560 <em class='comment'>  recipient can then send messages in reply detailing the action it</em>
<a id='L561' name='L561'></a>   561 <em class='comment'>  has actually chosen to perform.  Finally, when the mouse buttons are</em>
<a id='L562' name='L562'></a>   562 <em class='comment'>  released over the recipient window, Emacs sends a "drop" message to</em>
<a id='L563' name='L563'></a>   563 <em class='comment'>  the target window, waits for a reply, and returns the action</em>
<a id='L564' name='L564'></a>   564 <em class='comment'>  selected by the recipient to the Lisp code that initiated the</em>
<a id='L565' name='L565'></a>   565 <em class='comment'>  drag-and-drop operation.</em>
<a id='L566' name='L566'></a>   566 <em class='comment'></em>
<a id='L567' name='L567'></a>   567 <em class='comment'>  When a drop happens on a window not supporting any protocol</em>
<a id='L568' name='L568'></a>   568 <em class='comment'>  implemented on the C level, the function inside</em>
<a id='L569' name='L569'></a>   569 <em class='comment'>  `x-dnd-unsupported-drop-function' is called with some parameters of</em>
<a id='L570' name='L570'></a>   570 <em class='comment'>  the drop.  If it returns non-nil, then Emacs tries to simulate a</em>
<a id='L571' name='L571'></a>   571 <em class='comment'>  drop happening with the primary selection and synthetic button</em>
<a id='L572' name='L572'></a>   572 <em class='comment'>  events (see `x_dnd_do_unsupported_drop').  That function implements</em>
<a id='L573' name='L573'></a>   573 <em class='comment'>  the OffiX drag-and-drop protocol by default.  See</em>
<a id='L574' name='L574'></a>   574 <em class='comment'>  `x-dnd-handle-unsupported-drop' in `x-dnd.el' for more details.</em>
<a id='L575' name='L575'></a>   575 <em class='comment'></em>
<a id='L576' name='L576'></a>   576 <em class='comment'>  DISPLAY ERROR HANDLING</em>
<a id='L577' name='L577'></a>   577 <em class='comment'></em>
<a id='L578' name='L578'></a>   578 <em class='comment'>  While error handling under X was originally designed solely as a</em>
<a id='L579' name='L579'></a>   579 <em class='comment'>  mechanism for the X server to report fatal errors to clients, most</em>
<a id='L580' name='L580'></a>   580 <em class='comment'>  clients (including Emacs) have adopted a system of "error traps" to</em>
<a id='L581' name='L581'></a>   581 <em class='comment'>  handle or discard these errors as they arrive.  Discarding errors is</em>
<a id='L582' name='L582'></a>   582 <em class='comment'>  usually necessary when Emacs performs an X request that might fail:</em>
<a id='L583' name='L583'></a>   583 <em class='comment'>  for example, sending a message to a window that may no longer exist,</em>
<a id='L584' name='L584'></a>   584 <em class='comment'>  or might not exist at all.  Handling errors is then necessary when</em>
<a id='L585' name='L585'></a>   585 <em class='comment'>  the detailed error must be reported to another piece of code: for</em>
<a id='L586' name='L586'></a>   586 <em class='comment'>  example, as a Lisp error.</em>
<a id='L587' name='L587'></a>   587 <em class='comment'></em>
<a id='L588' name='L588'></a>   588 <em class='comment'>  It is not acceptable for Emacs to crash when it is sent invalid data</em>
<a id='L589' name='L589'></a>   589 <em class='comment'>  by another client, or by Lisp.  As a result, errors must be caught</em>
<a id='L590' name='L590'></a>   590 <em class='comment'>  around Xlib functions generating requests containing resource</em>
<a id='L591' name='L591'></a>   591 <em class='comment'>  identifiers that could potentially be invalid, such as window or</em>
<a id='L592' name='L592'></a>   592 <em class='comment'>  atom identifiers provided in a client message from another program,</em>
<a id='L593' name='L593'></a>   593 <em class='comment'>  or a child window ID obtained through XTranslateCoordinates that may</em>
<a id='L594' name='L594'></a>   594 <em class='comment'>  refer to a window that has been deleted in the meantime.</em>
<a id='L595' name='L595'></a>   595 <em class='comment'></em>
<a id='L596' name='L596'></a>   596 <em class='comment'>  There are two sets of functions used to perform this "error</em>
<a id='L597' name='L597'></a>   597 <em class='comment'>  trapping".  Which one should be used depends on what kind of</em>
<a id='L598' name='L598'></a>   598 <em class='comment'>  processing must be done on the error.  The first consists of the</em>
<a id='L599' name='L599'></a>   599 <em class='comment'>  functions `x_ignore_errors_for_next_request' and</em>
<a id='L600' name='L600'></a>   600 <em class='comment'>  `x_stop_ignoring_errors', which ignore errors generated by requests</em>
<a id='L601' name='L601'></a>   601 <em class='comment'>  made in between a call to the first function and a corresponding</em>
<a id='L602' name='L602'></a>   602 <em class='comment'>  call to the second.  They should be used for simple asynchronous</em>
<a id='L603' name='L603'></a>   603 <em class='comment'>  requests that do not require a reply from the X server: using them</em>
<a id='L604' name='L604'></a>   604 <em class='comment'>  instead of the second set improves performance, as they simply</em>
<a id='L605' name='L605'></a>   605 <em class='comment'>  record a range of request serials to ignore errors from, instead of</em>
<a id='L606' name='L606'></a>   606 <em class='comment'>  synchronizing with the X server to handle errors.</em>
<a id='L607' name='L607'></a>   607 <em class='comment'></em>
<a id='L608' name='L608'></a>   608 <em class='comment'>  The second set consists of the following functions:</em>
<a id='L609' name='L609'></a>   609 <em class='comment'></em>
<a id='L610' name='L610'></a>   610 <em class='comment'>    - x_catch_errors_with_handler</em>
<a id='L611' name='L611'></a>   611 <em class='comment'>    - x_catch_errors</em>
<a id='L612' name='L612'></a>   612 <em class='comment'>    - x_uncatch_errors_after_check</em>
<a id='L613' name='L613'></a>   613 <em class='comment'>    - x_uncatch_errors</em>
<a id='L614' name='L614'></a>   614 <em class='comment'>    - x_check_errors</em>
<a id='L615' name='L615'></a>   615 <em class='comment'>    - x_had_errors_p</em>
<a id='L616' name='L616'></a>   616 <em class='comment'>    - x_clear_errors</em>
<a id='L617' name='L617'></a>   617 <em class='comment'></em>
<a id='L618' name='L618'></a>   618 <em class='comment'>  Callers using this set should consult the comment(s) on top of the</em>
<a id='L619' name='L619'></a>   619 <em class='comment'>  aformentioned functions.  They should not be used when the requests</em>
<a id='L620' name='L620'></a>   620 <em class='comment'>  being made do not require roundtrips to the X server, and obtaining</em>
<a id='L621' name='L621'></a>   621 <em class='comment'>  the details of any error generated is unecessary, as</em>
<a id='L622' name='L622'></a>   622 <em class='comment'>  `x_uncatch_errors' will always synchronize with the X server, which</em>
<a id='L623' name='L623'></a>   623 <em class='comment'>  is a potentially slow operation.  */</em>
<a id='L624' name='L624'></a>   624 
<a id='L625' name='L625'></a>   625 <em class='sharp'>#include</em> &lt;config.h&gt;
<a id='L626' name='L626'></a>   626 <em class='sharp'>#include</em> &lt;stdlib.h&gt;
<a id='L627' name='L627'></a>   627 <em class='sharp'>#include</em> &lt;math.h&gt;
<a id='L628' name='L628'></a>   628 <em class='sharp'>#include</em> &lt;signal.h&gt;
<a id='L629' name='L629'></a>   629 
<a id='L630' name='L630'></a>   630 <em class='sharp'>#include</em> "<a href='../I/530.html'>lisp.h</a>"
<a id='L631' name='L631'></a>   631 <em class='sharp'>#include</em> "<a href='2089.html'>blockinput.h</a>"
<a id='L632' name='L632'></a>   632 <em class='sharp'>#include</em> "<a href='2337.html'>sysstdio.h</a>"
<a id='L633' name='L633'></a>   633 
<a id='L634' name='L634'></a>   634 <em class='comment'>/* This may include sys/types.h, and that somehow loses</em>
<a id='L635' name='L635'></a>   635 <em class='comment'>   if this is not done before the other system files.  */</em>
<a id='L636' name='L636'></a>   636 <em class='sharp'>#include</em> "<a href='2212.html'>xterm.h</a>"
<a id='L637' name='L637'></a>   637 <em class='sharp'>#include</em> &lt;X11/cursorfont.h&gt;
<a id='L638' name='L638'></a>   638 
<a id='L639' name='L639'></a>   639 <em class='sharp'>#ifdef</em> HAVE_X_I18N
<a id='L640' name='L640'></a>   640 <em class='sharp'>#include</em> "<a href='2319.html'>textconv.h</a>"
<a id='L641' name='L641'></a>   641 <em class='sharp'>#endif</em>
<a id='L642' name='L642'></a>   642 
<a id='L643' name='L643'></a>   643 <em class='sharp'>#ifdef</em> USE_XCB
<a id='L644' name='L644'></a>   644 <em class='sharp'>#include</em> &lt;xcb/xproto.h&gt;
<a id='L645' name='L645'></a>   645 <em class='sharp'>#include</em> &lt;xcb/xcb.h&gt;
<a id='L646' name='L646'></a>   646 <em class='sharp'>#endif</em>
<a id='L647' name='L647'></a>   647 
<a id='L648' name='L648'></a>   648 <em class='comment'>/* If we have Xfixes extension, use it for pointer blanking.  */</em>
<a id='L649' name='L649'></a>   649 <em class='sharp'>#ifdef</em> HAVE_XFIXES
<a id='L650' name='L650'></a>   650 <em class='sharp'>#include</em> &lt;X11/extensions/Xfixes.h&gt;
<a id='L651' name='L651'></a>   651 <em class='sharp'>#endif</em>
<a id='L652' name='L652'></a>   652 
<a id='L653' name='L653'></a>   653 <em class='sharp'>#ifdef</em> HAVE_XDBE
<a id='L654' name='L654'></a>   654 <em class='sharp'>#include</em> &lt;X11/extensions/Xdbe.h&gt;
<a id='L655' name='L655'></a>   655 <em class='sharp'>#endif</em>
<a id='L656' name='L656'></a>   656 
<a id='L657' name='L657'></a>   657 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L658' name='L658'></a>   658 <em class='sharp'>#include</em> &lt;X11/extensions/XInput2.h&gt;
<a id='L659' name='L659'></a>   659 <em class='sharp'>#endif</em>
<a id='L660' name='L660'></a>   660 
<a id='L661' name='L661'></a>   661 <em class='sharp'>#ifdef</em> HAVE_XRANDR
<a id='L662' name='L662'></a>   662 <em class='sharp'>#include</em> &lt;X11/extensions/Xrandr.h&gt;
<a id='L663' name='L663'></a>   663 <em class='sharp'>#endif</em>
<a id='L664' name='L664'></a>   664 
<a id='L665' name='L665'></a>   665 <em class='sharp'>#ifdef</em> HAVE_XSYNC
<a id='L666' name='L666'></a>   666 <em class='sharp'>#include</em> &lt;X11/extensions/sync.h&gt;
<a id='L667' name='L667'></a>   667 <em class='sharp'>#endif</em>
<a id='L668' name='L668'></a>   668 
<a id='L669' name='L669'></a>   669 <em class='sharp'>#ifdef</em> HAVE_XINERAMA
<a id='L670' name='L670'></a>   670 <em class='sharp'>#include</em> &lt;X11/extensions/Xinerama.h&gt;
<a id='L671' name='L671'></a>   671 <em class='sharp'>#endif</em>
<a id='L672' name='L672'></a>   672 
<a id='L673' name='L673'></a>   673 <em class='sharp'>#ifdef</em> HAVE_XCOMPOSITE
<a id='L674' name='L674'></a>   674 <em class='sharp'>#include</em> &lt;X11/extensions/Xcomposite.h&gt;
<a id='L675' name='L675'></a>   675 <em class='sharp'>#endif</em>
<a id='L676' name='L676'></a>   676 
<a id='L677' name='L677'></a>   677 <em class='sharp'>#ifdef</em> HAVE_XSHAPE
<a id='L678' name='L678'></a>   678 <em class='sharp'>#include</em> &lt;X11/extensions/shape.h&gt;
<a id='L679' name='L679'></a>   679 <em class='sharp'>#endif</em>
<a id='L680' name='L680'></a>   680 
<a id='L681' name='L681'></a>   681 <em class='sharp'>#ifdef</em> HAVE_XCB_SHAPE
<a id='L682' name='L682'></a>   682 <em class='sharp'>#include</em> &lt;xcb/shape.h&gt;
<a id='L683' name='L683'></a>   683 <em class='sharp'>#endif</em>
<a id='L684' name='L684'></a>   684 
<a id='L685' name='L685'></a>   685 <em class='comment'>/* Load sys/types.h if not already loaded.</em>
<a id='L686' name='L686'></a>   686 <em class='comment'>   In some systems loading it twice is suicidal.  */</em>
<a id='L687' name='L687'></a>   687 <em class='sharp'>#ifndef</em> makedev
<a id='L688' name='L688'></a>   688 <em class='sharp'>#include</em> &lt;sys/types.h&gt;
<a id='L689' name='L689'></a>   689 <em class='sharp'>#endif</em> <em class='comment'>/* makedev */</em>
<a id='L690' name='L690'></a>   690 
<a id='L691' name='L691'></a>   691 <em class='sharp'>#include</em> &lt;<a href='46.html'>sys/ioctl.h</a>&gt;
<a id='L692' name='L692'></a>   692 
<a id='L693' name='L693'></a>   693 <em class='sharp'>#include</em> "<a href='2136.html'>systime.h</a>"
<a id='L694' name='L694'></a>   694 
<a id='L695' name='L695'></a>   695 <em class='sharp'>#include</em> &lt;fcntl.h&gt;
<a id='L696' name='L696'></a>   696 <em class='sharp'>#include</em> &lt;errno.h&gt;
<a id='L697' name='L697'></a>   697 <em class='sharp'>#include</em> &lt;<a href='47.html'>sys/stat.h</a>&gt;
<a id='L698' name='L698'></a>   698 <em class='sharp'>#include</em> &lt;<a href='2854.html'>flexmember.h</a>&gt;
<a id='L699' name='L699'></a>   699 <em class='sharp'>#include</em> &lt;<a href='2829.html'>c-ctype.h</a>&gt;
<a id='L700' name='L700'></a>   700 <em class='sharp'>#include</em> &lt;byteswap.h&gt;
<a id='L701' name='L701'></a>   701 
<a id='L702' name='L702'></a>   702 <em class='sharp'>#include</em> "<a href='2218.html'>character.h</a>"
<a id='L703' name='L703'></a>   703 <em class='sharp'>#include</em> "<a href='2154.html'>coding.h</a>"
<a id='L704' name='L704'></a>   704 <em class='sharp'>#include</em> "<a href='2177.html'>composite.h</a>"
<a id='L705' name='L705'></a>   705 <em class='sharp'>#include</em> "<a href='2183.html'>frame.h</a>"
<a id='L706' name='L706'></a>   706 <em class='sharp'>#include</em> "<a href='2315.html'>dispextern.h</a>"
<a id='L707' name='L707'></a>   707 <em class='sharp'>#include</em> "<a href='2261.html'>xwidget.h</a>"
<a id='L708' name='L708'></a>   708 <em class='sharp'>#include</em> "<a href='2206.html'>fontset.h</a>"
<a id='L709' name='L709'></a>   709 <em class='sharp'>#include</em> "<a href='2231.html'>termhooks.h</a>"
<a id='L710' name='L710'></a>   710 <em class='sharp'>#include</em> "<a href='2375.html'>termopts.h</a>"
<a id='L711' name='L711'></a>   711 <em class='sharp'>#include</em> "<a href='2179.html'>termchar.h</a>"
<a id='L712' name='L712'></a>   712 <em class='sharp'>#include</em> "<a href='2100.html'>emacs-icon.h</a>"
<a id='L713' name='L713'></a>   713 <em class='sharp'>#include</em> "<a href='2130.html'>buffer.h</a>"
<a id='L714' name='L714'></a>   714 <em class='sharp'>#include</em> "<a href='2317.html'>window.h</a>"
<a id='L715' name='L715'></a>   715 <em class='sharp'>#include</em> "<a href='2185.html'>keyboard.h</a>"
<a id='L716' name='L716'></a>   716 <em class='sharp'>#include</em> "<a href='2141.html'>atimer.h</a>"
<a id='L717' name='L717'></a>   717 <em class='sharp'>#include</em> "<a href='2293.html'>font.h</a>"
<a id='L718' name='L718'></a>   718 <em class='sharp'>#include</em> "<a href='2157.html'>xsettings.h</a>"
<a id='L719' name='L719'></a>   719 <em class='sharp'>#include</em> "<a href='2246.html'>sysselect.h</a>"
<a id='L720' name='L720'></a>   720 <em class='sharp'>#include</em> "<a href='2285.html'>menu.h</a>"
<a id='L721' name='L721'></a>   721 <em class='sharp'>#include</em> "<a href='2324.html'>pdumper.h</a>"
<a id='L722' name='L722'></a>   722 
<a id='L723' name='L723'></a>   723 <em class='sharp'>#ifdef</em> USE_X_TOOLKIT
<a id='L724' name='L724'></a>   724 <em class='sharp'>#include</em> &lt;X11/Shell.h&gt;
<a id='L725' name='L725'></a>   725 <em class='sharp'>#include</em> &lt;X11/ShellP.h&gt;
<a id='L726' name='L726'></a>   726 <em class='sharp'>#endif</em>
<a id='L727' name='L727'></a>   727 
<a id='L728' name='L728'></a>   728 <em class='sharp'>#include</em> &lt;<a href='37.html'>unistd.h</a>&gt;
<a id='L729' name='L729'></a>   729 
<a id='L730' name='L730'></a>   730 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L731' name='L731'></a>   731 <em class='sharp'>#include</em> "<a href='2238.html'>gtkutil.h</a>"
<a id='L732' name='L732'></a>   732 <em class='sharp'>#ifdef</em> HAVE_GTK3
<a id='L733' name='L733'></a>   733 <em class='sharp'>#include</em> &lt;X11/Xproto.h&gt;
<a id='L734' name='L734'></a>   734 <em class='sharp'>#endif</em>
<a id='L735' name='L735'></a>   735 <em class='sharp'>#endif</em>
<a id='L736' name='L736'></a>   736 
<a id='L737' name='L737'></a>   737 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> (USE_LUCID) || <strong class='reserved'>defined</strong> (USE_MOTIF)
<a id='L738' name='L738'></a>   738 <em class='sharp'>#include</em> "<a href='2078.html'>../lwlib/xlwmenu.h</a>"
<a id='L739' name='L739'></a>   739 <em class='sharp'>#endif</em>
<a id='L740' name='L740'></a>   740 
<a id='L741' name='L741'></a>   741 <em class='sharp'>#ifdef</em> HAVE_XWIDGETS
<a id='L742' name='L742'></a>   742 <em class='sharp'>#include</em> &lt;cairo-xlib.h&gt;
<a id='L743' name='L743'></a>   743 <em class='sharp'>#endif</em>
<a id='L744' name='L744'></a>   744 
<a id='L745' name='L745'></a>   745 <em class='sharp'>#ifdef</em> USE_MOTIF
<a id='L746' name='L746'></a>   746 <em class='sharp'>#include</em> &lt;Xm/Xm.h&gt;
<a id='L747' name='L747'></a>   747 <em class='sharp'>#include</em> &lt;Xm/CascadeB.h&gt;
<a id='L748' name='L748'></a>   748 <em class='sharp'>#endif</em>
<a id='L749' name='L749'></a>   749 
<a id='L750' name='L750'></a>   750 <em class='sharp'>#ifdef</em> USE_X_TOOLKIT
<a id='L751' name='L751'></a>   751 
<a id='L752' name='L752'></a>   752 <em class='comment'>/* Include toolkit specific headers for the scroll bar widget.  */</em>
<a id='L753' name='L753'></a>   753 <em class='sharp'>#ifdef</em> USE_TOOLKIT_SCROLL_BARS
<a id='L754' name='L754'></a>   754 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> USE_MOTIF
<a id='L755' name='L755'></a>   755 <em class='sharp'>#include</em> &lt;Xm/ScrollBar.h&gt;
<a id='L756' name='L756'></a>   756 <em class='sharp'>#else</em> <em class='comment'>/* !USE_MOTIF i.e. use Xaw */</em>
<a id='L757' name='L757'></a>   757 
<a id='L758' name='L758'></a>   758 <em class='sharp'>#ifdef</em> HAVE_XAW3D
<a id='L759' name='L759'></a>   759 <em class='sharp'>#include</em> &lt;X11/Xaw3d/Simple.h&gt;
<a id='L760' name='L760'></a>   760 <em class='sharp'>#include</em> &lt;X11/Xaw3d/Scrollbar.h&gt;
<a id='L761' name='L761'></a>   761 <em class='sharp'>#include</em> &lt;X11/Xaw3d/ThreeD.h&gt;
<a id='L762' name='L762'></a>   762 <em class='sharp'>#else</em> <em class='comment'>/* !HAVE_XAW3D */</em>
<a id='L763' name='L763'></a>   763 <em class='sharp'>#include</em> &lt;X11/Xaw/Simple.h&gt;
<a id='L764' name='L764'></a>   764 <em class='sharp'>#include</em> &lt;X11/Xaw/Scrollbar.h&gt;
<a id='L765' name='L765'></a>   765 <em class='sharp'>#endif</em> <em class='comment'>/* !HAVE_XAW3D */</em>
<a id='L766' name='L766'></a>   766 <em class='sharp'>#ifndef</em> <a href='../S/2289.html#L767' title='Defined at 767 in src/xterm.c.'>XtNpickTop</a>
<a id='L767' name='L767'></a>   767 <em class='sharp'>#define</em> <a href='../R/6774.html' title='Multiple referred from 3 places.'>XtNpickTop</a> "pickTop"
<a id='L768' name='L768'></a>   768 <em class='sharp'>#endif</em> <em class='comment'>/* !XtNpickTop */</em>
<a id='L769' name='L769'></a>   769 <em class='sharp'>#endif</em> <em class='comment'>/* !USE_MOTIF */</em>
<a id='L770' name='L770'></a>   770 <em class='sharp'>#endif</em> <em class='comment'>/* USE_TOOLKIT_SCROLL_BARS */</em>
<a id='L771' name='L771'></a>   771 
<a id='L772' name='L772'></a>   772 <em class='sharp'>#endif</em> <em class='comment'>/* USE_X_TOOLKIT */</em>
<a id='L773' name='L773'></a>   773 
<a id='L774' name='L774'></a>   774 <em class='sharp'>#ifdef</em> USE_X_TOOLKIT
<a id='L775' name='L775'></a>   775 <em class='sharp'>#include</em> "<a href='2111.html'>widget.h</a>"
<a id='L776' name='L776'></a>   776 <em class='sharp'>#ifndef</em> <a href='../S/2289.html#L777' title='Defined at 777 in src/xterm.c.'>XtNinitialState</a>
<a id='L777' name='L777'></a>   777 <em class='sharp'>#define</em> <a href='../R/6765.html' title='Multiple referred from 2 places.'>XtNinitialState</a> "initialState"
<a id='L778' name='L778'></a>   778 <em class='sharp'>#endif</em>
<a id='L779' name='L779'></a>   779 <em class='sharp'>#endif</em>
<a id='L780' name='L780'></a>   780 
<a id='L781' name='L781'></a>   781 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L782' name='L782'></a>   782 <em class='sharp'>#include</em> &lt;<a href='2252.html'>xgselect.h</a>&gt;
<a id='L783' name='L783'></a>   783 <em class='sharp'>#endif</em>
<a id='L784' name='L784'></a>   784 
<a id='L785' name='L785'></a>   785 <em class='sharp'>#include</em> "bitmaps/gray.xbm"
<a id='L786' name='L786'></a>   786 
<a id='L787' name='L787'></a>   787 <em class='sharp'>#ifdef</em> HAVE_XKB
<a id='L788' name='L788'></a>   788 <em class='sharp'>#include</em> &lt;X11/XKBlib.h&gt;
<a id='L789' name='L789'></a>   789 <em class='sharp'>#endif</em>
<a id='L790' name='L790'></a>   790 
<a id='L791' name='L791'></a>   791 <em class='comment'>/* Although X11/Xlib.h commonly defines the types XErrorHandler and</em>
<a id='L792' name='L792'></a>   792 <em class='comment'>   XIOErrorHandler, they are not in the Xlib spec, so for portability</em>
<a id='L793' name='L793'></a>   793 <em class='comment'>   define and use names with an Emacs_ prefix instead.  */</em>
<a id='L794' name='L794'></a>   794 <strong class='reserved'>typedef</strong> <strong class='reserved'>int</strong> (*Emacs_XErrorHandler) (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *, XErrorEvent *);
<a id='L795' name='L795'></a>   795 <strong class='reserved'>typedef</strong> <strong class='reserved'>int</strong> (*Emacs_XIOErrorHandler) (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *);
<a id='L796' name='L796'></a>   796 
<a id='L797' name='L797'></a>   797 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> USE_XCB &amp;&amp; <strong class='reserved'>defined</strong> USE_CAIRO_XCB
<a id='L798' name='L798'></a>   798 <em class='sharp'>#define</em> <a href='../R/5960.html' title='Multiple referred from 4 places.'>USE_CAIRO_XCB_SURFACE</a>
<a id='L799' name='L799'></a>   799 <em class='sharp'>#endif</em>
<a id='L800' name='L800'></a>   800 
<a id='L801' name='L801'></a>   801 <em class='sharp'>#if</em> XCB_SHAPE_MAJOR_VERSION &gt; 1       \
<a id='L802' name='L802'></a>   802   || (XCB_SHAPE_MAJOR_VERSION == 1 &amp;&amp; \
<a id='L803' name='L803'></a>   803       XCB_SHAPE_MINOR_VERSION &gt;= 1)
<a id='L804' name='L804'></a>   804 <em class='sharp'>#define</em> <a href='../R/2791.html' title='Multiple referred from 8 places.'>HAVE_XCB_SHAPE_INPUT_RECTS</a>
<a id='L805' name='L805'></a>   805 <em class='sharp'>#endif</em>
<a id='L806' name='L806'></a>   806 
<a id='L807' name='L807'></a>   807 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L808' name='L808'></a>   808 <em class='comment'>/* GTK can't tolerate a call to `handle_interrupt' inside an event</em>
<a id='L809' name='L809'></a>   809 <em class='comment'>   signal handler, but we have to store input events inside the</em>
<a id='L810' name='L810'></a>   810 <em class='comment'>   handler for native input to work.</em>
<a id='L811' name='L811'></a>   811 <em class='comment'></em>
<a id='L812' name='L812'></a>   812 <em class='comment'>   This acts as a `hold_quit', and it is stored in the keyboard buffer</em>
<a id='L813' name='L813'></a>   813 <em class='comment'>   (thereby causing the call to `handle_interrupt') after the GTK</em>
<a id='L814' name='L814'></a>   814 <em class='comment'>   signal handler exits and control returns to XTread_socket.  */</em>
<a id='L815' name='L815'></a>   815 <strong class='reserved'>struct</strong> <a href='../S/2231.html#L350' title='Defined at 350 in src/termhooks.h.'>input_event</a> xg_pending_quit_event = <em class='brace'>{</em> .kind = <a href='../S/2231.html#L74' title='Defined at 74 in src/termhooks.h.'>NO_EVENT</a> <em class='brace'>}</em>;
<a id='L816' name='L816'></a>   816 <em class='sharp'>#endif</em>
<a id='L817' name='L817'></a>   817 
<a id='L818' name='L818'></a>   818 <em class='comment'>/* Non-zero means that a HELP_EVENT has been generated since Emacs</em>
<a id='L819' name='L819'></a>   819 <em class='comment'>   start.  */</em>
<a id='L820' name='L820'></a>   820 
<a id='L821' name='L821'></a>   821 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> any_help_event_p;
<a id='L822' name='L822'></a>   822 
<a id='L823' name='L823'></a>   823 <em class='comment'>/* This is a chain of structures for all the X displays currently in</em>
<a id='L824' name='L824'></a>   824 <em class='comment'>   use.  */</em>
<a id='L825' name='L825'></a>   825 
<a id='L826' name='L826'></a>   826 <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *x_display_list;
<a id='L827' name='L827'></a>   827 
<a id='L828' name='L828'></a>   828 <em class='sharp'>#ifdef</em> USE_X_TOOLKIT
<a id='L829' name='L829'></a>   829 
<a id='L830' name='L830'></a>   830 <em class='comment'>/* The application context for Xt use.  */</em>
<a id='L831' name='L831'></a>   831 XtAppContext Xt_app_con;
<a id='L832' name='L832'></a>   832 <strong class='reserved'>static</strong> String Xt_default_resources[] = <em class='brace'>{</em>0<em class='brace'>}</em>;
<a id='L833' name='L833'></a>   833 
<a id='L834' name='L834'></a>   834 <em class='comment'>/* Non-zero means user is interacting with a toolkit scroll bar.  */</em>
<a id='L835' name='L835'></a>   835 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> toolkit_scroll_bar_interaction;
<a id='L836' name='L836'></a>   836 
<a id='L837' name='L837'></a>   837 <em class='sharp'>#endif</em> <em class='comment'>/* USE_X_TOOLKIT */</em>
<a id='L838' name='L838'></a>   838 
<a id='L839' name='L839'></a>   839 <em class='comment'>/* Non-zero timeout value means ignore next mouse click if it arrives</em>
<a id='L840' name='L840'></a>   840 <em class='comment'>   before that timeout elapses (i.e. as part of the same sequence of</em>
<a id='L841' name='L841'></a>   841 <em class='comment'>   events resulting from clicking on a frame to select it).  */</em>
<a id='L842' name='L842'></a>   842 
<a id='L843' name='L843'></a>   843 <strong class='reserved'>static</strong> <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a> ignore_next_mouse_click_timeout;
<a id='L844' name='L844'></a>   844 
<a id='L845' name='L845'></a>   845 <em class='comment'>/* The display that ignore_next_mouse_click_timeout applies to.  */</em>
<a id='L846' name='L846'></a>   846 
<a id='L847' name='L847'></a>   847 <strong class='reserved'>static</strong> <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *mouse_click_timeout_display;
<a id='L848' name='L848'></a>   848 
<a id='L849' name='L849'></a>   849 <em class='comment'>/* Used locally within XTread_socket.  */</em>
<a id='L850' name='L850'></a>   850 
<a id='L851' name='L851'></a>   851 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong> x_noop_count;
<a id='L852' name='L852'></a>   852 
<a id='L853' name='L853'></a>   853 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L854' name='L854'></a>   854 <em class='comment'>/* The name of the Emacs icon file.  */</em>
<a id='L855' name='L855'></a>   855 <strong class='reserved'>static</strong> <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> xg_default_icon_file;
<a id='L856' name='L856'></a>   856 <em class='sharp'>#endif</em>
<a id='L857' name='L857'></a>   857 
<a id='L858' name='L858'></a>   858 <em class='sharp'>#ifdef</em> HAVE_X_I18N
<a id='L859' name='L859'></a>   859 <em class='comment'>/* Some functions take this as char *, not const char *.  */</em>
<a id='L860' name='L860'></a>   860 <strong class='reserved'>static</strong> <strong class='reserved'>char</strong> emacs_class[] = <a href='../S/2183.html#L1826' title='Defined at 1826 in src/frame.h.'>EMACS_CLASS</a>;
<a id='L861' name='L861'></a>   861 <em class='sharp'>#endif</em>
<a id='L862' name='L862'></a>   862 
<a id='L863' name='L863'></a>   863 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L864' name='L864'></a>   864 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong> current_count;
<a id='L865' name='L865'></a>   865 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong> current_finish;
<a id='L866' name='L866'></a>   866 <strong class='reserved'>static</strong> <strong class='reserved'>struct</strong> <a href='../S/2231.html#L350' title='Defined at 350 in src/termhooks.h.'>input_event</a> *current_hold_quit;
<a id='L867' name='L867'></a>   867 <em class='sharp'>#endif</em>
<a id='L868' name='L868'></a>   868 
<a id='L869' name='L869'></a>   869 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L870' name='L870'></a>   870 <em class='sharp'>#ifndef</em> <a href='../S/2289.html#L871' title='Defined at 871 in src/xterm.c.'>X_XIGrabDevice</a>
<a id='L871' name='L871'></a>   871 <em class='sharp'>#define</em> <a href='../R/6685.html' title='Multiple referred from 2 places.'>X_XIGrabDevice</a> 51
<a id='L872' name='L872'></a>   872 <em class='sharp'>#endif</em>
<a id='L873' name='L873'></a>   873 
<a id='L874' name='L874'></a>   874 <em class='sharp'>#ifndef</em> <a href='../S/2289.html#L875' title='Defined at 875 in src/xterm.c.'>X_XIUngrabDevice</a>
<a id='L875' name='L875'></a>   875 <em class='sharp'>#define</em> <a href='../R/6686.html' title='Multiple referred from 2 places.'>X_XIUngrabDevice</a> 52
<a id='L876' name='L876'></a>   876 <em class='sharp'>#endif</em>
<a id='L877' name='L877'></a>   877 
<a id='L878' name='L878'></a>   878 <em class='sharp'>#ifndef</em> <a href='../S/2289.html#L879' title='Defined at 879 in src/xterm.c.'>X_XIAllowEvents</a>
<a id='L879' name='L879'></a>   879 <em class='sharp'>#define</em> <a href='../R/6684.html' title='Multiple referred from 2 places.'>X_XIAllowEvents</a> 53
<a id='L880' name='L880'></a>   880 <em class='sharp'>#endif</em>
<a id='L881' name='L881'></a>   881 <em class='sharp'>#endif</em>
<a id='L882' name='L882'></a>   882 
<a id='L883' name='L883'></a>   883 <em class='comment'>/* Queue selection requests in `pending_selection_requests' if more</em>
<a id='L884' name='L884'></a>   884 <em class='comment'>   than 0.  */</em>
<a id='L885' name='L885'></a>   885 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong> x_use_pending_selection_requests;
<a id='L886' name='L886'></a>   886 
<a id='L887' name='L887'></a>   887 <em class='comment'>/* Like `next_kbd_event', but for use in X code.  */</em>
<a id='L888' name='L888'></a>   888 <em class='sharp'>#define</em> <a href='../R/6676.html' title='Multiple referred from 5 places.'>X_NEXT_KBD_EVENT</a>(ptr) \
<a id='L889' name='L889'></a>   889   ((ptr) == kbd_buffer + <a href='../D/3480.html' title='Multiple defined in 2 places.'>KBD_BUFFER_SIZE</a> - 1 ? kbd_buffer : (ptr) + 1)
<a id='L890' name='L890'></a>   890 
<a id='L891' name='L891'></a>   891 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong> <a href='../S/2289.html#L12298' title='Defined at 12298 in src/xterm.c.'>x_push_selection_request</a> (<strong class='reserved'>struct</strong> <a href='../D/16706.html' title='Multiple defined in 2 places.'>selection_input_event</a> *);
<a id='L892' name='L892'></a>   892 
<a id='L893' name='L893'></a>   893 <em class='comment'>/* Defer selection requests.  Between this and</em>
<a id='L894' name='L894'></a>   894 <em class='comment'>   x_release_selection_requests, any selection requests can be</em>
<a id='L895' name='L895'></a>   895 <em class='comment'>   processed by calling `x_handle_pending_selection_requests'.</em>
<a id='L896' name='L896'></a>   896 <em class='comment'></em>
<a id='L897' name='L897'></a>   897 <em class='comment'>   Also run through and queue all the selection events already in the</em>
<a id='L898' name='L898'></a>   898 <em class='comment'>   keyboard buffer.  */</em>
<a id='L899' name='L899'></a>   899 <strong class='reserved'>void</strong>
<a id='L900' name='L900'></a>   900 <a href='../R/18111.html' title='Multiple referred from 2 places.'>x_defer_selection_requests</a> (<strong class='reserved'>void</strong>)
<a id='L901' name='L901'></a>   901 <em class='brace'>{</em>
<a id='L902' name='L902'></a>   902   <strong class='reserved'>union</strong> <a href='../S/2185.html#L229' title='Defined at 229 in src/keyboard.h.'>buffered_input_event</a> *event;
<a id='L903' name='L903'></a>   903   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> between;
<a id='L904' name='L904'></a>   904 
<a id='L905' name='L905'></a>   905   between = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L906' name='L906'></a>   906 
<a id='L907' name='L907'></a>   907   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L908' name='L908'></a>   908   <strong class='reserved'>if</strong> (!x_use_pending_selection_requests)
<a id='L909' name='L909'></a>   909     <em class='brace'>{</em>
<a id='L910' name='L910'></a>   910       event = kbd_fetch_ptr;
<a id='L911' name='L911'></a>   911 
<a id='L912' name='L912'></a>   912       <strong class='reserved'>while</strong> (event != kbd_store_ptr)
<a id='L913' name='L913'></a>   913         <em class='brace'>{</em>
<a id='L914' name='L914'></a>   914           <strong class='reserved'>if</strong> (event-&gt;ie.kind == <a href='../S/2231.html#L185' title='Defined at 185 in src/termhooks.h.'>SELECTION_REQUEST_EVENT</a>
<a id='L915' name='L915'></a>   915               || event-&gt;ie.kind == <a href='../S/2231.html#L187' title='Defined at 187 in src/termhooks.h.'>SELECTION_CLEAR_EVENT</a>)
<a id='L916' name='L916'></a>   916             <em class='brace'>{</em>
<a id='L917' name='L917'></a>   917               <a href='../S/2289.html#L12298' title='Defined at 12298 in src/xterm.c.'>x_push_selection_request</a> (&amp;event-&gt;sie);
<a id='L918' name='L918'></a>   918 
<a id='L919' name='L919'></a>   919               <em class='comment'>/* Mark this selection event as invalid.   */</em>
<a id='L920' name='L920'></a>   920               <a href='../D/5566.html' title='Multiple defined in 2 places.'>SELECTION_EVENT_DPYINFO</a> (&amp;event-&gt;sie) = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L921' name='L921'></a>   921 
<a id='L922' name='L922'></a>   922               <em class='comment'>/* Move the kbd_fetch_ptr along if doing so would not</em>
<a id='L923' name='L923'></a>   923 <em class='comment'>                 result in any other events being skipped.  This</em>
<a id='L924' name='L924'></a>   924 <em class='comment'>                 avoids exhausting the keyboard buffer with some</em>
<a id='L925' name='L925'></a>   925 <em class='comment'>                 over-enthusiastic clipboard managers.  */</em>
<a id='L926' name='L926'></a>   926               <strong class='reserved'>if</strong> (!between)
<a id='L927' name='L927'></a>   927                 <em class='brace'>{</em>
<a id='L928' name='L928'></a>   928                   kbd_fetch_ptr = <a href='../S/2289.html#L888' title='Defined at 888 in src/xterm.c.'>X_NEXT_KBD_EVENT</a> (event);
<a id='L929' name='L929'></a>   929 
<a id='L930' name='L930'></a>   930                   <em class='comment'>/* `detect_input_pending' will then recompute</em>
<a id='L931' name='L931'></a>   931 <em class='comment'>                     whether or not pending input events exist.  */</em>
<a id='L932' name='L932'></a>   932                   input_pending = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L933' name='L933'></a>   933                 <em class='brace'>}</em>
<a id='L934' name='L934'></a>   934             <em class='brace'>}</em>
<a id='L935' name='L935'></a>   935           <strong class='reserved'>else</strong>
<a id='L936' name='L936'></a>   936             between = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L937' name='L937'></a>   937 
<a id='L938' name='L938'></a>   938           event = <a href='../S/2289.html#L888' title='Defined at 888 in src/xterm.c.'>X_NEXT_KBD_EVENT</a> (event);
<a id='L939' name='L939'></a>   939         <em class='brace'>}</em>
<a id='L940' name='L940'></a>   940     <em class='brace'>}</em>
<a id='L941' name='L941'></a>   941 
<a id='L942' name='L942'></a>   942   x_use_pending_selection_requests++;
<a id='L943' name='L943'></a>   943   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L944' name='L944'></a>   944 <em class='brace'>}</em>
<a id='L945' name='L945'></a>   945 
<a id='L946' name='L946'></a>   946 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L947' name='L947'></a>   947 <a href='../S/2289.html#L955' title='Referred from 955 in src/xterm.c.'>x_release_selection_requests</a> (<strong class='reserved'>void</strong>)
<a id='L948' name='L948'></a>   948 <em class='brace'>{</em>
<a id='L949' name='L949'></a>   949   x_use_pending_selection_requests--;
<a id='L950' name='L950'></a>   950 <em class='brace'>}</em>
<a id='L951' name='L951'></a>   951 
<a id='L952' name='L952'></a>   952 <strong class='reserved'>void</strong>
<a id='L953' name='L953'></a>   953 <a href='../R/18274.html' title='Multiple referred from 2 places.'>x_release_selection_requests_and_flush</a> (<strong class='reserved'>void</strong>)
<a id='L954' name='L954'></a>   954 <em class='brace'>{</em>
<a id='L955' name='L955'></a>   955   <a href='../S/2289.html#L947' title='Defined at 947 in src/xterm.c.'>x_release_selection_requests</a> ();
<a id='L956' name='L956'></a>   956 
<a id='L957' name='L957'></a>   957   <strong class='reserved'>if</strong> (!x_use_pending_selection_requests)
<a id='L958' name='L958'></a>   958     <a href='../S/2289.html#L12284' title='Defined at 12284 in src/xterm.c.'>x_handle_pending_selection_requests</a> ();
<a id='L959' name='L959'></a>   959 <em class='brace'>}</em>
<a id='L960' name='L960'></a>   960 
<a id='L961' name='L961'></a>   961 <strong class='reserved'>struct</strong> <a href='../R/18281.html' title='Multiple referred from 6 places.'>x_selection_request_event</a>
<a id='L962' name='L962'></a>   962 <em class='brace'>{</em>
<a id='L963' name='L963'></a>   963   <em class='comment'>/* The selection request event.  */</em>
<a id='L964' name='L964'></a>   964   <strong class='reserved'>struct</strong> <a href='../D/16706.html' title='Multiple defined in 2 places.'>selection_input_event</a> se;
<a id='L965' name='L965'></a>   965 
<a id='L966' name='L966'></a>   966   <em class='comment'>/* The next unprocessed selection request event.  */</em>
<a id='L967' name='L967'></a>   967   <strong class='reserved'>struct</strong> <a href='../S/2289.html#L961' title='Defined at 961 in src/xterm.c.'>x_selection_request_event</a> *next;
<a id='L968' name='L968'></a>   968 <em class='brace'>}</em>;
<a id='L969' name='L969'></a>   969 
<a id='L970' name='L970'></a>   970 <em class='comment'>/* Chain of unprocessed selection request events.  Used to handle</em>
<a id='L971' name='L971'></a>   971 <em class='comment'>   selection requests inside long-lasting modal event loops, such as</em>
<a id='L972' name='L972'></a>   972 <em class='comment'>   the drag-and-drop loop.  */</em>
<a id='L973' name='L973'></a>   973 
<a id='L974' name='L974'></a>   974 <strong class='reserved'>struct</strong> <a href='../S/2289.html#L961' title='Defined at 961 in src/xterm.c.'>x_selection_request_event</a> *pending_selection_requests;
<a id='L975' name='L975'></a>   975 
<a id='L976' name='L976'></a>   976 <strong class='reserved'>struct</strong> <a href='../S/2289.html#L987' title='Referred from 987 in src/xterm.c.'>x_atom_ref</a>
<a id='L977' name='L977'></a>   977 <em class='brace'>{</em>
<a id='L978' name='L978'></a>   978   <em class='comment'>/* Atom name.  */</em>
<a id='L979' name='L979'></a>   979   <strong class='reserved'>const</strong> <strong class='reserved'>char</strong> *<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>;
<a id='L980' name='L980'></a>   980 
<a id='L981' name='L981'></a>   981   <em class='comment'>/* Offset of atom in the display info structure.  */</em>
<a id='L982' name='L982'></a>   982   <strong class='reserved'>int</strong> <a href='../D/15084.html' title='Multiple defined in 4 places.'>offset</a>;
<a id='L983' name='L983'></a>   983 <em class='brace'>}</em>;
<a id='L984' name='L984'></a>   984 
<a id='L985' name='L985'></a>   985 <em class='comment'>/* List of all atoms that should be interned when connecting to a</em>
<a id='L986' name='L986'></a>   986 <em class='comment'>   display.  */</em>
<a id='L987' name='L987'></a>   987 <strong class='reserved'>static</strong> <strong class='reserved'>const</strong> <strong class='reserved'>struct</strong> <a href='../S/2289.html#L976' title='Defined at 976 in src/xterm.c.'>x_atom_ref</a> x_atom_refs[] =
<a id='L988' name='L988'></a>   988   <em class='brace'>{</em>
<a id='L989' name='L989'></a>   989 <em class='sharp'>#define</em> <a href='../R/231.html' title='Multiple referred from 121 places.'>ATOM_REFS_INIT</a>(string, <a href='../D/14388.html' title='Multiple defined in 2 places.'>member</a>)                          \
<a id='L990' name='L990'></a>   990     <em class='brace'>{</em> string, offsetof (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a>, <a href='../D/14388.html' title='Multiple defined in 2 places.'>member</a>) <em class='brace'>}</em>,
<a id='L991' name='L991'></a>   991     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("WM_PROTOCOLS", Xatom_wm_protocols)
<a id='L992' name='L992'></a>   992     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("WM_TAKE_FOCUS", Xatom_wm_take_focus)
<a id='L993' name='L993'></a>   993     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("WM_SAVE_YOURSELF", Xatom_wm_save_yourself)
<a id='L994' name='L994'></a>   994     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("WM_DELETE_WINDOW", Xatom_wm_delete_window)
<a id='L995' name='L995'></a>   995     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("WM_CHANGE_STATE", Xatom_wm_change_state)
<a id='L996' name='L996'></a>   996     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("WM_STATE", Xatom_wm_state)
<a id='L997' name='L997'></a>   997     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("WM_CONFIGURE_DENIED", Xatom_wm_configure_denied)
<a id='L998' name='L998'></a>   998     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("WM_MOVED", Xatom_wm_window_moved)
<a id='L999' name='L999'></a>   999     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("WM_CLIENT_LEADER", Xatom_wm_client_leader)
<a id='L1000' name='L1000'></a>  1000     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("WM_TRANSIENT_FOR", Xatom_wm_transient_for)
<a id='L1001' name='L1001'></a>  1001     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("Editres", Xatom_editres)
<a id='L1002' name='L1002'></a>  1002     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("CLIPBOARD", Xatom_CLIPBOARD)
<a id='L1003' name='L1003'></a>  1003     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("TIMESTAMP", Xatom_TIMESTAMP)
<a id='L1004' name='L1004'></a>  1004     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("TEXT", Xatom_TEXT)
<a id='L1005' name='L1005'></a>  1005     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("COMPOUND_TEXT", Xatom_COMPOUND_TEXT)
<a id='L1006' name='L1006'></a>  1006     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("UTF8_STRING", Xatom_UTF8_STRING)
<a id='L1007' name='L1007'></a>  1007     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("DELETE", Xatom_DELETE)
<a id='L1008' name='L1008'></a>  1008     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("MULTIPLE", Xatom_MULTIPLE)
<a id='L1009' name='L1009'></a>  1009     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("INCR", Xatom_INCR)
<a id='L1010' name='L1010'></a>  1010     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_EMACS_TMP_",  Xatom_EMACS_TMP)
<a id='L1011' name='L1011'></a>  1011     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_EMACS_SERVER_TIME_PROP", Xatom_EMACS_SERVER_TIME_PROP)
<a id='L1012' name='L1012'></a>  1012     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("TARGETS", Xatom_TARGETS)
<a id='L1013' name='L1013'></a>  1013     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("NULL", Xatom_NULL)
<a id='L1014' name='L1014'></a>  1014     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("ATOM", Xatom_ATOM)
<a id='L1015' name='L1015'></a>  1015     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("ATOM_PAIR", Xatom_ATOM_PAIR)
<a id='L1016' name='L1016'></a>  1016     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("CLIPBOARD_MANAGER", Xatom_CLIPBOARD_MANAGER)
<a id='L1017' name='L1017'></a>  1017     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_XEMBED_INFO", Xatom_XEMBED_INFO)
<a id='L1018' name='L1018'></a>  1018     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_MOTIF_WM_HINTS", Xatom_MOTIF_WM_HINTS)
<a id='L1019' name='L1019'></a>  1019     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_EMACS_DRAG_ATOM", Xatom_EMACS_DRAG_ATOM)
<a id='L1020' name='L1020'></a>  1020     <em class='comment'>/* For properties of font.  */</em>
<a id='L1021' name='L1021'></a>  1021     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("PIXEL_SIZE", Xatom_PIXEL_SIZE)
<a id='L1022' name='L1022'></a>  1022     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("AVERAGE_WIDTH", Xatom_AVERAGE_WIDTH)
<a id='L1023' name='L1023'></a>  1023     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_MULE_BASELINE_OFFSET", Xatom_MULE_BASELINE_OFFSET)
<a id='L1024' name='L1024'></a>  1024     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_MULE_RELATIVE_COMPOSE", Xatom_MULE_RELATIVE_COMPOSE)
<a id='L1025' name='L1025'></a>  1025     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_MULE_DEFAULT_ASCENT", Xatom_MULE_DEFAULT_ASCENT)
<a id='L1026' name='L1026'></a>  1026     <em class='comment'>/* Ghostscript support.  */</em>
<a id='L1027' name='L1027'></a>  1027     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("DONE", Xatom_DONE)
<a id='L1028' name='L1028'></a>  1028     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("PAGE", Xatom_PAGE)
<a id='L1029' name='L1029'></a>  1029     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_EMACS_SCROLLBAR", Xatom_Scrollbar)
<a id='L1030' name='L1030'></a>  1030     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_EMACS_HORIZONTAL_SCROLLBAR", Xatom_Horizontal_Scrollbar)
<a id='L1031' name='L1031'></a>  1031     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_XEMBED", Xatom_XEMBED)
<a id='L1032' name='L1032'></a>  1032     <em class='comment'>/* EWMH */</em>
<a id='L1033' name='L1033'></a>  1033     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_NET_WM_STATE", Xatom_net_wm_state)
<a id='L1034' name='L1034'></a>  1034     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_NET_WM_STATE_FULLSCREEN", Xatom_net_wm_state_fullscreen)
<a id='L1035' name='L1035'></a>  1035     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_NET_WM_STATE_MAXIMIZED_HORZ",
<a id='L1036' name='L1036'></a>  1036                     Xatom_net_wm_state_maximized_horz)
<a id='L1037' name='L1037'></a>  1037     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_NET_WM_STATE_MAXIMIZED_VERT",
<a id='L1038' name='L1038'></a>  1038                     Xatom_net_wm_state_maximized_vert)
<a id='L1039' name='L1039'></a>  1039     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_NET_WM_STATE_STICKY", Xatom_net_wm_state_sticky)
<a id='L1040' name='L1040'></a>  1040     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_NET_WM_STATE_SHADED", Xatom_net_wm_state_shaded)
<a id='L1041' name='L1041'></a>  1041     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_NET_WM_STATE_HIDDEN", Xatom_net_wm_state_hidden)
<a id='L1042' name='L1042'></a>  1042     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_NET_WM_WINDOW_TYPE", Xatom_net_window_type)
<a id='L1043' name='L1043'></a>  1043     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_NET_WM_WINDOW_TYPE_TOOLTIP",
<a id='L1044' name='L1044'></a>  1044                     Xatom_net_window_type_tooltip)
<a id='L1045' name='L1045'></a>  1045     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_NET_WM_ICON_NAME", Xatom_net_wm_icon_name)
<a id='L1046' name='L1046'></a>  1046     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_NET_WM_NAME", Xatom_net_wm_name)
<a id='L1047' name='L1047'></a>  1047     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_NET_SUPPORTED",  Xatom_net_supported)
<a id='L1048' name='L1048'></a>  1048     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_NET_SUPPORTING_WM_CHECK", Xatom_net_supporting_wm_check)
<a id='L1049' name='L1049'></a>  1049     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_NET_WM_WINDOW_OPACITY", Xatom_net_wm_window_opacity)
<a id='L1050' name='L1050'></a>  1050     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_NET_ACTIVE_WINDOW", Xatom_net_active_window)
<a id='L1051' name='L1051'></a>  1051     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_NET_FRAME_EXTENTS", Xatom_net_frame_extents)
<a id='L1052' name='L1052'></a>  1052     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_NET_CURRENT_DESKTOP", Xatom_net_current_desktop)
<a id='L1053' name='L1053'></a>  1053     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_NET_WORKAREA", Xatom_net_workarea)
<a id='L1054' name='L1054'></a>  1054     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_NET_WM_SYNC_REQUEST", Xatom_net_wm_sync_request)
<a id='L1055' name='L1055'></a>  1055     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_NET_WM_SYNC_REQUEST_COUNTER", Xatom_net_wm_sync_request_counter)
<a id='L1056' name='L1056'></a>  1056     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_NET_WM_SYNC_FENCES", Xatom_net_wm_sync_fences)
<a id='L1057' name='L1057'></a>  1057     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_NET_WM_BYPASS_COMPOSITOR", Xatom_net_wm_bypass_compositor)
<a id='L1058' name='L1058'></a>  1058     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_NET_WM_FRAME_DRAWN", Xatom_net_wm_frame_drawn)
<a id='L1059' name='L1059'></a>  1059     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_NET_WM_FRAME_TIMINGS", Xatom_net_wm_frame_timings)
<a id='L1060' name='L1060'></a>  1060     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_NET_WM_USER_TIME", Xatom_net_wm_user_time)
<a id='L1061' name='L1061'></a>  1061     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_NET_WM_USER_TIME_WINDOW", Xatom_net_wm_user_time_window)
<a id='L1062' name='L1062'></a>  1062     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_NET_CLIENT_LIST_STACKING", Xatom_net_client_list_stacking)
<a id='L1063' name='L1063'></a>  1063     <em class='comment'>/* Session management */</em>
<a id='L1064' name='L1064'></a>  1064     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("SM_CLIENT_ID", Xatom_SM_CLIENT_ID)
<a id='L1065' name='L1065'></a>  1065     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_XSETTINGS_SETTINGS", Xatom_xsettings_prop)
<a id='L1066' name='L1066'></a>  1066     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("MANAGER", Xatom_xsettings_mgr)
<a id='L1067' name='L1067'></a>  1067     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_NET_WM_STATE_SKIP_TASKBAR", Xatom_net_wm_state_skip_taskbar)
<a id='L1068' name='L1068'></a>  1068     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_NET_WM_STATE_ABOVE", Xatom_net_wm_state_above)
<a id='L1069' name='L1069'></a>  1069     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_NET_WM_STATE_BELOW", Xatom_net_wm_state_below)
<a id='L1070' name='L1070'></a>  1070     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_NET_WM_OPAQUE_REGION", Xatom_net_wm_opaque_region)
<a id='L1071' name='L1071'></a>  1071     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_NET_WM_PING", Xatom_net_wm_ping)
<a id='L1072' name='L1072'></a>  1072     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_NET_WM_PID", Xatom_net_wm_pid)
<a id='L1073' name='L1073'></a>  1073 <em class='sharp'>#ifdef</em> HAVE_XKB
<a id='L1074' name='L1074'></a>  1074     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("Meta", Xatom_Meta)
<a id='L1075' name='L1075'></a>  1075     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("Super", Xatom_Super)
<a id='L1076' name='L1076'></a>  1076     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("Hyper", Xatom_Hyper)
<a id='L1077' name='L1077'></a>  1077     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("ShiftLock", Xatom_ShiftLock)
<a id='L1078' name='L1078'></a>  1078     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("Alt", Xatom_Alt)
<a id='L1079' name='L1079'></a>  1079 <em class='sharp'>#endif</em>
<a id='L1080' name='L1080'></a>  1080     <em class='comment'>/* DND source.  */</em>
<a id='L1081' name='L1081'></a>  1081     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("XdndAware", Xatom_XdndAware)
<a id='L1082' name='L1082'></a>  1082     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("XdndSelection", Xatom_XdndSelection)
<a id='L1083' name='L1083'></a>  1083     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("XdndTypeList", Xatom_XdndTypeList)
<a id='L1084' name='L1084'></a>  1084     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("XdndActionCopy", Xatom_XdndActionCopy)
<a id='L1085' name='L1085'></a>  1085     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("XdndActionMove", Xatom_XdndActionMove)
<a id='L1086' name='L1086'></a>  1086     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("XdndActionLink", Xatom_XdndActionLink)
<a id='L1087' name='L1087'></a>  1087     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("XdndActionAsk", Xatom_XdndActionAsk)
<a id='L1088' name='L1088'></a>  1088     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("XdndActionPrivate", Xatom_XdndActionPrivate)
<a id='L1089' name='L1089'></a>  1089     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("XdndActionList", Xatom_XdndActionList)
<a id='L1090' name='L1090'></a>  1090     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("XdndActionDescription", Xatom_XdndActionDescription)
<a id='L1091' name='L1091'></a>  1091     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("XdndProxy", Xatom_XdndProxy)
<a id='L1092' name='L1092'></a>  1092     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("XdndEnter", Xatom_XdndEnter)
<a id='L1093' name='L1093'></a>  1093     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("XdndPosition", Xatom_XdndPosition)
<a id='L1094' name='L1094'></a>  1094     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("XdndStatus", Xatom_XdndStatus)
<a id='L1095' name='L1095'></a>  1095     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("XdndLeave", Xatom_XdndLeave)
<a id='L1096' name='L1096'></a>  1096     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("XdndDrop", Xatom_XdndDrop)
<a id='L1097' name='L1097'></a>  1097     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("XdndFinished", Xatom_XdndFinished)
<a id='L1098' name='L1098'></a>  1098     <em class='comment'>/* XDS source and target.  */</em>
<a id='L1099' name='L1099'></a>  1099     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("XdndDirectSave0", Xatom_XdndDirectSave0)
<a id='L1100' name='L1100'></a>  1100     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("XdndActionDirectSave", Xatom_XdndActionDirectSave)
<a id='L1101' name='L1101'></a>  1101     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("text/plain", Xatom_text_plain)
<a id='L1102' name='L1102'></a>  1102     <em class='comment'>/* Motif drop protocol support.  */</em>
<a id='L1103' name='L1103'></a>  1103     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_MOTIF_DRAG_WINDOW", Xatom_MOTIF_DRAG_WINDOW)
<a id='L1104' name='L1104'></a>  1104     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_MOTIF_DRAG_TARGETS", Xatom_MOTIF_DRAG_TARGETS)
<a id='L1105' name='L1105'></a>  1105     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_MOTIF_DRAG_AND_DROP_MESSAGE",
<a id='L1106' name='L1106'></a>  1106                     Xatom_MOTIF_DRAG_AND_DROP_MESSAGE)
<a id='L1107' name='L1107'></a>  1107     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_MOTIF_DRAG_INITIATOR_INFO",
<a id='L1108' name='L1108'></a>  1108                     Xatom_MOTIF_DRAG_INITIATOR_INFO)
<a id='L1109' name='L1109'></a>  1109     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_MOTIF_DRAG_RECEIVER_INFO",
<a id='L1110' name='L1110'></a>  1110                     Xatom_MOTIF_DRAG_RECEIVER_INFO)
<a id='L1111' name='L1111'></a>  1111     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("XmTRANSFER_SUCCESS", Xatom_XmTRANSFER_SUCCESS)
<a id='L1112' name='L1112'></a>  1112     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("XmTRANSFER_FAILURE", Xatom_XmTRANSFER_FAILURE)
<a id='L1113' name='L1113'></a>  1113     <em class='comment'>/* Old OffiX (a.k.a. old KDE) drop protocol support.  */</em>
<a id='L1114' name='L1114'></a>  1114     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("DndProtocol", Xatom_DndProtocol)
<a id='L1115' name='L1115'></a>  1115     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("_DND_PROTOCOL", Xatom_DND_PROTOCOL)
<a id='L1116' name='L1116'></a>  1116     <em class='comment'>/* Here are some atoms that are not actually used from C, just</em>
<a id='L1117' name='L1117'></a>  1117 <em class='comment'>       defined to make replying to selection requests fast.  */</em>
<a id='L1118' name='L1118'></a>  1118     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("text/plain;charset=utf-8", Xatom_text_plain_charset_utf_8)
<a id='L1119' name='L1119'></a>  1119     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("LENGTH", Xatom_LENGTH)
<a id='L1120' name='L1120'></a>  1120     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("FILE_NAME", Xatom_FILE_NAME)
<a id='L1121' name='L1121'></a>  1121     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("CHARACTER_POSITION", Xatom_CHARACTER_POSITION)
<a id='L1122' name='L1122'></a>  1122     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("LINE_NUMBER", Xatom_LINE_NUMBER)
<a id='L1123' name='L1123'></a>  1123     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("COLUMN_NUMBER", Xatom_COLUMN_NUMBER)
<a id='L1124' name='L1124'></a>  1124     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("OWNER_OS", Xatom_OWNER_OS)
<a id='L1125' name='L1125'></a>  1125     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("HOST_NAME", Xatom_HOST_NAME)
<a id='L1126' name='L1126'></a>  1126     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("USER", Xatom_USER)
<a id='L1127' name='L1127'></a>  1127     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("CLASS", Xatom_CLASS)
<a id='L1128' name='L1128'></a>  1128     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("NAME", Xatom_NAME)
<a id='L1129' name='L1129'></a>  1129     <a href='../S/2289.html#L989' title='Defined at 989 in src/xterm.c.'>ATOM_REFS_INIT</a> ("SAVE_TARGETS", Xatom_SAVE_TARGETS)
<a id='L1130' name='L1130'></a>  1130   <em class='brace'>}</em>;
<a id='L1131' name='L1131'></a>  1131 
<a id='L1132' name='L1132'></a>  1132 <strong class='reserved'>enum</strong>
<a id='L1133' name='L1133'></a>  1133 <em class='brace'>{</em>
<a id='L1134' name='L1134'></a>  1134   <a href='../R/6670.html' title='Multiple referred from 5 places.'>X_EVENT_NORMAL</a>,
<a id='L1135' name='L1135'></a>  1135   <a href='../R/6669.html' title='Multiple referred from 8 places.'>X_EVENT_GOTO_OUT</a>,
<a id='L1136' name='L1136'></a>  1136   <a href='../R/6668.html' title='Multiple referred from 35 places.'>X_EVENT_DROP</a>
<a id='L1137' name='L1137'></a>  1137 <em class='brace'>}</em>;
<a id='L1138' name='L1138'></a>  1138 
<a id='L1139' name='L1139'></a>  1139 <strong class='reserved'>enum</strong> <a href='../S/2289.html#L28445' title='Referred from 28445 in src/xterm.c.'>xembed_info</a>
<a id='L1140' name='L1140'></a>  1140   <em class='brace'>{</em>
<a id='L1141' name='L1141'></a>  1141     <a href='../R/6365.html' title='Multiple referred from 2 places.'>XEMBED_MAPPED</a> = 1 &lt;&lt; 0
<a id='L1142' name='L1142'></a>  1142   <em class='brace'>}</em>;
<a id='L1143' name='L1143'></a>  1143 
<a id='L1144' name='L1144'></a>  1144 <strong class='reserved'>enum</strong> <a href='../R/18420.html' title='Multiple referred from 4 places.'>xembed_message</a>
<a id='L1145' name='L1145'></a>  1145   <em class='brace'>{</em>
<a id='L1146' name='L1146'></a>  1146     XEMBED_EMBEDDED_NOTIFY        = 0,
<a id='L1147' name='L1147'></a>  1147     XEMBED_WINDOW_ACTIVATE        = 1,
<a id='L1148' name='L1148'></a>  1148     XEMBED_WINDOW_DEACTIVATE      = 2,
<a id='L1149' name='L1149'></a>  1149     <a href='../R/6366.html' title='Multiple referred from 3 places.'>XEMBED_REQUEST_FOCUS</a>          = 3,
<a id='L1150' name='L1150'></a>  1150     <a href='../R/6363.html' title='Multiple referred from 2 places.'>XEMBED_FOCUS_IN</a>               = 4,
<a id='L1151' name='L1151'></a>  1151     <a href='../S/2289.html#L19120' title='Referred from 19120 in src/xterm.c.'>XEMBED_FOCUS_OUT</a>              = 5,
<a id='L1152' name='L1152'></a>  1152     XEMBED_FOCUS_NEXT             = 6,
<a id='L1153' name='L1153'></a>  1153     XEMBED_FOCUS_PREV             = 7,
<a id='L1154' name='L1154'></a>  1154 
<a id='L1155' name='L1155'></a>  1155     XEMBED_MODALITY_ON            = 10,
<a id='L1156' name='L1156'></a>  1156     XEMBED_MODALITY_OFF           = 11,
<a id='L1157' name='L1157'></a>  1157     XEMBED_REGISTER_ACCELERATOR   = 12,
<a id='L1158' name='L1158'></a>  1158     XEMBED_UNREGISTER_ACCELERATOR = 13,
<a id='L1159' name='L1159'></a>  1159     XEMBED_ACTIVATE_ACCELERATOR   = 14
<a id='L1160' name='L1160'></a>  1160   <em class='brace'>}</em>;
<a id='L1161' name='L1161'></a>  1161 
<a id='L1162' name='L1162'></a>  1162 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> <a href='../S/2289.html#L9214' title='Defined at 9214 in src/xterm.c.'>x_alloc_nearest_color_1</a> (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *, Colormap, <a href='../D/7038.html' title='Multiple defined in 2 places.'>XColor</a> *);
<a id='L1163' name='L1163'></a>  1163 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong> x_raise_frame (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *);
<a id='L1164' name='L1164'></a>  1164 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong> x_lower_frame (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *);
<a id='L1165' name='L1165'></a>  1165 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong> x_io_error_quitter (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *);
<a id='L1166' name='L1166'></a>  1166 <strong class='reserved'>static</strong> <strong class='reserved'>struct</strong> <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a> *x_create_terminal (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *);
<a id='L1167' name='L1167'></a>  1167 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong> x_frame_rehighlight (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *);
<a id='L1168' name='L1168'></a>  1168 
<a id='L1169' name='L1169'></a>  1169 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong> x_clip_to_row (<strong class='reserved'>struct</strong> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> *, <strong class='reserved'>struct</strong> <a href='../S/2315.html#L892' title='Defined at 892 in src/dispextern.h.'>glyph_row</a> *,
<a id='L1170' name='L1170'></a>  1170                            <strong class='reserved'>enum</strong> <a href='../S/2315.html#L855' title='Defined at 855 in src/dispextern.h.'>glyph_row_area</a>, <a href='../D/2619.html' title='Multiple defined in 2 places.'>GC</a>);
<a id='L1171' name='L1171'></a>  1171 <strong class='reserved'>static</strong> <strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *x_window_to_scroll_bar (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a>, <strong class='reserved'>int</strong>);
<a id='L1172' name='L1172'></a>  1172 <strong class='reserved'>static</strong> <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../S/2289.html#L11957' title='Defined at 11957 in src/xterm.c.'>x_window_to_frame</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *, <strong class='reserved'>int</strong>);
<a id='L1173' name='L1173'></a>  1173 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong> x_scroll_bar_report_motion (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> **, <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> *,
<a id='L1174' name='L1174'></a>  1174                                         <strong class='reserved'>enum</strong> <a href='../S/2231.html#L34' title='Defined at 34 in src/termhooks.h.'>scroll_bar_part</a> *,
<a id='L1175' name='L1175'></a>  1175                                         <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> *, <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> *,
<a id='L1176' name='L1176'></a>  1176                                         <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a> *);
<a id='L1177' name='L1177'></a>  1177 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong> x_horizontal_scroll_bar_report_motion (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> **, <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> *,
<a id='L1178' name='L1178'></a>  1178                                                    <strong class='reserved'>enum</strong> <a href='../S/2231.html#L34' title='Defined at 34 in src/termhooks.h.'>scroll_bar_part</a> *,
<a id='L1179' name='L1179'></a>  1179                                                    <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> *, <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> *,
<a id='L1180' name='L1180'></a>  1180                                                    <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a> *);
<a id='L1181' name='L1181'></a>  1181 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> x_handle_net_wm_state (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *, <strong class='reserved'>const</strong> XPropertyEvent *);
<a id='L1182' name='L1182'></a>  1182 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong> x_check_fullscreen (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *);
<a id='L1183' name='L1183'></a>  1183 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong> x_check_expected_move (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *, <strong class='reserved'>int</strong>, <strong class='reserved'>int</strong>);
<a id='L1184' name='L1184'></a>  1184 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong> x_sync_with_move (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *, <strong class='reserved'>int</strong>, <strong class='reserved'>int</strong>, <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>);
<a id='L1185' name='L1185'></a>  1185 <em class='sharp'>#ifndef</em> HAVE_XINPUT2
<a id='L1186' name='L1186'></a>  1186 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong> handle_one_xevent (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *,
<a id='L1187' name='L1187'></a>  1187                               <strong class='reserved'>const</strong> XEvent *, <strong class='reserved'>int</strong> *,
<a id='L1188' name='L1188'></a>  1188                               <strong class='reserved'>struct</strong> <a href='../S/2231.html#L350' title='Defined at 350 in src/termhooks.h.'>input_event</a> *);
<a id='L1189' name='L1189'></a>  1189 <em class='sharp'>#else</em>
<a id='L1190' name='L1190'></a>  1190 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong> handle_one_xevent (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *,
<a id='L1191' name='L1191'></a>  1191                               XEvent *, <strong class='reserved'>int</strong> *,
<a id='L1192' name='L1192'></a>  1192                               <strong class='reserved'>struct</strong> <a href='../S/2231.html#L350' title='Defined at 350 in src/termhooks.h.'>input_event</a> *);
<a id='L1193' name='L1193'></a>  1193 <em class='sharp'>#endif</em>
<a id='L1194' name='L1194'></a>  1194 <em class='sharp'>#if</em> ! (<strong class='reserved'>defined</strong> USE_X_TOOLKIT || <strong class='reserved'>defined</strong> USE_MOTIF) &amp;&amp; <strong class='reserved'>defined</strong> USE_GTK
<a id='L1195' name='L1195'></a>  1195 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong> x_dispatch_event (XEvent *, <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *);
<a id='L1196' name='L1196'></a>  1196 <em class='sharp'>#endif</em>
<a id='L1197' name='L1197'></a>  1197 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong> x_wm_set_window_state (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *, <strong class='reserved'>int</strong>);
<a id='L1198' name='L1198'></a>  1198 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong> x_wm_set_icon_pixmap (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *, ptrdiff_t);
<a id='L1199' name='L1199'></a>  1199 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong> x_initialize (<strong class='reserved'>void</strong>);
<a id='L1200' name='L1200'></a>  1200 
<a id='L1201' name='L1201'></a>  1201 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> x_get_current_wm_state (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a>, <strong class='reserved'>int</strong> *, <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> *, <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> *);
<a id='L1202' name='L1202'></a>  1202 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong> <a href='../S/2289.html#L5198' title='Defined at 5198 in src/xterm.c.'>x_update_opaque_region</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *, XEvent *);
<a id='L1203' name='L1203'></a>  1203 
<a id='L1204' name='L1204'></a>  1204 <em class='sharp'>#ifdef</em> HAVE_X_I18N
<a id='L1205' name='L1205'></a>  1205 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong> x_filter_event (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *, XEvent *);
<a id='L1206' name='L1206'></a>  1206 <em class='sharp'>#endif</em>
<a id='L1207' name='L1207'></a>  1207 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong> x_clean_failable_requests (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *);
<a id='L1208' name='L1208'></a>  1208 
<a id='L1209' name='L1209'></a>  1209 <strong class='reserved'>static</strong> <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../S/2289.html#L12010' title='Defined at 12010 in src/xterm.c.'>x_tooltip_window_to_frame</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *,
<a id='L1210' name='L1210'></a>  1210                                                 <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a>, <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> *);
<a id='L1211' name='L1211'></a>  1211 <strong class='reserved'>static</strong> <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> x_get_window_below (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a>, <strong class='reserved'>int</strong>, <strong class='reserved'>int</strong>, <strong class='reserved'>int</strong> *, <strong class='reserved'>int</strong> *);
<a id='L1212' name='L1212'></a>  1212 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong> x_set_input_focus (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a>, <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a>);
<a id='L1213' name='L1213'></a>  1213 
<a id='L1214' name='L1214'></a>  1214 <em class='sharp'>#ifndef</em> USE_TOOLKIT_SCROLL_BARS
<a id='L1215' name='L1215'></a>  1215 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong> x_scroll_bar_redraw (<strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *);
<a id='L1216' name='L1216'></a>  1216 <em class='sharp'>#endif</em>
<a id='L1217' name='L1217'></a>  1217 
<a id='L1218' name='L1218'></a>  1218 <em class='comment'>/* Global state maintained during a drag-and-drop operation.  */</em>
<a id='L1219' name='L1219'></a>  1219 
<a id='L1220' name='L1220'></a>  1220 <em class='comment'>/* Flag that indicates if a drag-and-drop operation is in progress.  */</em>
<a id='L1221' name='L1221'></a>  1221 <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> x_dnd_in_progress;
<a id='L1222' name='L1222'></a>  1222 
<a id='L1223' name='L1223'></a>  1223 <em class='comment'>/* The frame where the drag-and-drop operation originated.  */</em>
<a id='L1224' name='L1224'></a>  1224 <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *x_dnd_frame;
<a id='L1225' name='L1225'></a>  1225 
<a id='L1226' name='L1226'></a>  1226 <em class='comment'>/* That frame, but set when x_dnd_waiting_for_finish is true.  Used to</em>
<a id='L1227' name='L1227'></a>  1227 <em class='comment'>   prevent the frame from being deleted inside selection handlers and</em>
<a id='L1228' name='L1228'></a>  1228 <em class='comment'>   other callbacks.  */</em>
<a id='L1229' name='L1229'></a>  1229 <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *x_dnd_finish_frame;
<a id='L1230' name='L1230'></a>  1230 
<a id='L1231' name='L1231'></a>  1231 <em class='comment'>/* Flag that indicates if a drag-and-drop operation is no longer in</em>
<a id='L1232' name='L1232'></a>  1232 <em class='comment'>   progress, but the nested event loop should continue to run, because</em>
<a id='L1233' name='L1233'></a>  1233 <em class='comment'>   handle_one_xevent is waiting for the drop target to return some</em>
<a id='L1234' name='L1234'></a>  1234 <em class='comment'>   important information.  */</em>
<a id='L1235' name='L1235'></a>  1235 <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> x_dnd_waiting_for_finish;
<a id='L1236' name='L1236'></a>  1236 
<a id='L1237' name='L1237'></a>  1237 <em class='comment'>/* Flag that means (when set in addition to</em>
<a id='L1238' name='L1238'></a>  1238 <em class='comment'>   `x_dnd_waiting_for_finish') to run the unsupported drop function</em>
<a id='L1239' name='L1239'></a>  1239 <em class='comment'>   with the given arguments.  */</em>
<a id='L1240' name='L1240'></a>  1240 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> x_dnd_run_unsupported_drop_function;
<a id='L1241' name='L1241'></a>  1241 
<a id='L1242' name='L1242'></a>  1242 <em class='comment'>/* The "before"-time of the unsupported drop.  */</em>
<a id='L1243' name='L1243'></a>  1243 <strong class='reserved'>static</strong> <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a> x_dnd_unsupported_drop_time;
<a id='L1244' name='L1244'></a>  1244 
<a id='L1245' name='L1245'></a>  1245 <em class='comment'>/* The target window of the unsupported drop.  */</em>
<a id='L1246' name='L1246'></a>  1246 <strong class='reserved'>static</strong> <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> x_dnd_unsupported_drop_window;
<a id='L1247' name='L1247'></a>  1247 
<a id='L1248' name='L1248'></a>  1248 <em class='comment'>/* The Lisp data associated with the unsupported drop function.  */</em>
<a id='L1249' name='L1249'></a>  1249 <strong class='reserved'>static</strong> <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> x_dnd_unsupported_drop_data;
<a id='L1250' name='L1250'></a>  1250 
<a id='L1251' name='L1251'></a>  1251 <em class='comment'>/* Whether or not to move the tooltip along with the mouse pointer</em>
<a id='L1252' name='L1252'></a>  1252 <em class='comment'>   during drag-and-drop.  */</em>
<a id='L1253' name='L1253'></a>  1253 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> x_dnd_update_tooltip;
<a id='L1254' name='L1254'></a>  1254 
<a id='L1255' name='L1255'></a>  1255 <em class='comment'>/* Monitor attribute list used for updating the tooltip position.  */</em>
<a id='L1256' name='L1256'></a>  1256 <strong class='reserved'>static</strong> <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> x_dnd_monitors;
<a id='L1257' name='L1257'></a>  1257 
<a id='L1258' name='L1258'></a>  1258 <em class='comment'>/* The display the drop target that is supposed to send information is</em>
<a id='L1259' name='L1259'></a>  1259 <em class='comment'>   on.  */</em>
<a id='L1260' name='L1260'></a>  1260 <strong class='reserved'>static</strong> <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *x_dnd_finish_display;
<a id='L1261' name='L1261'></a>  1261 
<a id='L1262' name='L1262'></a>  1262 <em class='comment'>/* State of the Motif drop operation.</em>
<a id='L1263' name='L1263'></a>  1263 <em class='comment'></em>
<a id='L1264' name='L1264'></a>  1264 <em class='comment'>   0 means nothing has happened, i.e. the event loop should not wait</em>
<a id='L1265' name='L1265'></a>  1265 <em class='comment'>   for the receiver to send any data.  1 means an XmDROP_START message</em>
<a id='L1266' name='L1266'></a>  1266 <em class='comment'>   was sent to the target, but no response has yet been received.  2</em>
<a id='L1267' name='L1267'></a>  1267 <em class='comment'>   means a response to our XmDROP_START message was received and the</em>
<a id='L1268' name='L1268'></a>  1268 <em class='comment'>   target accepted the drop, so Emacs should start waiting for the</em>
<a id='L1269' name='L1269'></a>  1269 <em class='comment'>   drop target to convert one of the special selections</em>
<a id='L1270' name='L1270'></a>  1270 <em class='comment'>   XmTRANSFER_SUCCESS or XmTRANSFER_FAILURE.  */</em>
<a id='L1271' name='L1271'></a>  1271 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong> x_dnd_waiting_for_motif_finish;
<a id='L1272' name='L1272'></a>  1272 
<a id='L1273' name='L1273'></a>  1273 <em class='comment'>/* The display the Motif drag receiver will send response data</em>
<a id='L1274' name='L1274'></a>  1274 <em class='comment'>   from.  */</em>
<a id='L1275' name='L1275'></a>  1275 <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *x_dnd_waiting_for_motif_finish_display;
<a id='L1276' name='L1276'></a>  1276 
<a id='L1277' name='L1277'></a>  1277 <em class='comment'>/* Whether or not F1 was pressed during the drag-and-drop operation.</em>
<a id='L1278' name='L1278'></a>  1278 <em class='comment'></em>
<a id='L1279' name='L1279'></a>  1279 <em class='comment'>   Motif programs rely on this to decide whether or not help</em>
<a id='L1280' name='L1280'></a>  1280 <em class='comment'>   information about the drop site should be displayed.  */</em>
<a id='L1281' name='L1281'></a>  1281 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> x_dnd_xm_use_help;
<a id='L1282' name='L1282'></a>  1282 
<a id='L1283' name='L1283'></a>  1283 <em class='comment'>/* Whether or not Motif drag initiator info was set up.  */</em>
<a id='L1284' name='L1284'></a>  1284 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> x_dnd_motif_setup_p;
<a id='L1285' name='L1285'></a>  1285 
<a id='L1286' name='L1286'></a>  1286 <em class='comment'>/* The Motif drag atom used during the drag-and-drop operation.  */</em>
<a id='L1287' name='L1287'></a>  1287 <strong class='reserved'>static</strong> Atom x_dnd_motif_atom;
<a id='L1288' name='L1288'></a>  1288 
<a id='L1289' name='L1289'></a>  1289 <em class='comment'>/* The target window we are waiting for an XdndFinished message</em>
<a id='L1290' name='L1290'></a>  1290 <em class='comment'>   from.  */</em>
<a id='L1291' name='L1291'></a>  1291 <strong class='reserved'>static</strong> <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> x_dnd_pending_finish_target;
<a id='L1292' name='L1292'></a>  1292 
<a id='L1293' name='L1293'></a>  1293 <em class='comment'>/* The protocol version of that target window.  */</em>
<a id='L1294' name='L1294'></a>  1294 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong> x_dnd_waiting_for_finish_proto;
<a id='L1295' name='L1295'></a>  1295 
<a id='L1296' name='L1296'></a>  1296 <em class='comment'>/* Whether or not it is OK for something to be dropped on the frame</em>
<a id='L1297' name='L1297'></a>  1297 <em class='comment'>   where the drag-and-drop operation originated.  */</em>
<a id='L1298' name='L1298'></a>  1298 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> x_dnd_allow_current_frame;
<a id='L1299' name='L1299'></a>  1299 
<a id='L1300' name='L1300'></a>  1300 <em class='comment'>/* Whether or not the `XdndTypeList' property has already been set on</em>
<a id='L1301' name='L1301'></a>  1301 <em class='comment'>   the drag frame.  */</em>
<a id='L1302' name='L1302'></a>  1302 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> x_dnd_init_type_lists;
<a id='L1303' name='L1303'></a>  1303 
<a id='L1304' name='L1304'></a>  1304 <em class='comment'>/* Whether or not to return a frame from `x_dnd_begin_drag_and_drop'.</em>
<a id='L1305' name='L1305'></a>  1305 <em class='comment'></em>
<a id='L1306' name='L1306'></a>  1306 <em class='comment'>   0 means to do nothing.  1 means to wait for the mouse to first exit</em>
<a id='L1307' name='L1307'></a>  1307 <em class='comment'>   `x_dnd_frame'.  2 means to wait for the mouse to move onto a frame,</em>
<a id='L1308' name='L1308'></a>  1308 <em class='comment'>   and 3 means to return `x_dnd_return_frame_object'.  */</em>
<a id='L1309' name='L1309'></a>  1309 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong> x_dnd_return_frame;
<a id='L1310' name='L1310'></a>  1310 
<a id='L1311' name='L1311'></a>  1311 <em class='comment'>/* The frame that should be returned by</em>
<a id='L1312' name='L1312'></a>  1312 <em class='comment'>   `x_dnd_begin_drag_and_drop'.  */</em>
<a id='L1313' name='L1313'></a>  1313 <strong class='reserved'>static</strong> <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *x_dnd_return_frame_object;
<a id='L1314' name='L1314'></a>  1314 
<a id='L1315' name='L1315'></a>  1315 <em class='comment'>/* The last drop target window the mouse pointer moved over.  This can</em>
<a id='L1316' name='L1316'></a>  1316 <em class='comment'>   be different from `x_dnd_last_seen_toplevel' if that window had an</em>
<a id='L1317' name='L1317'></a>  1317 <em class='comment'>   XdndProxy.  */</em>
<a id='L1318' name='L1318'></a>  1318 <strong class='reserved'>static</strong> <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> x_dnd_last_seen_window;
<a id='L1319' name='L1319'></a>  1319 
<a id='L1320' name='L1320'></a>  1320 <em class='comment'>/* The last toplevel the mouse pointer moved over.  */</em>
<a id='L1321' name='L1321'></a>  1321 <strong class='reserved'>static</strong> <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> x_dnd_last_seen_toplevel;
<a id='L1322' name='L1322'></a>  1322 
<a id='L1323' name='L1323'></a>  1323 <em class='comment'>/* The window where the drop happened.  Normally None, but it is set</em>
<a id='L1324' name='L1324'></a>  1324 <em class='comment'>   when something is actually dropped.  */</em>
<a id='L1325' name='L1325'></a>  1325 <strong class='reserved'>static</strong> <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> x_dnd_end_window;
<a id='L1326' name='L1326'></a>  1326 
<a id='L1327' name='L1327'></a>  1327 <em class='comment'>/* The XDND protocol version of `x_dnd_last_seen_window'.  -1 means it</em>
<a id='L1328' name='L1328'></a>  1328 <em class='comment'>   did not support XDND.  */</em>
<a id='L1329' name='L1329'></a>  1329 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong> x_dnd_last_protocol_version;
<a id='L1330' name='L1330'></a>  1330 
<a id='L1331' name='L1331'></a>  1331 <em class='comment'>/* Whether or not the last seen window is actually one of our</em>
<a id='L1332' name='L1332'></a>  1332 <em class='comment'>   frames.  */</em>
<a id='L1333' name='L1333'></a>  1333 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> x_dnd_last_window_is_frame;
<a id='L1334' name='L1334'></a>  1334 
<a id='L1335' name='L1335'></a>  1335 <em class='comment'>/* The Motif drag and drop protocol style of `x_dnd_last_seen_window'.</em>
<a id='L1336' name='L1336'></a>  1336 <em class='comment'>   XM_DRAG_STYLE_NONE means the window does not support the Motif drag</em>
<a id='L1337' name='L1337'></a>  1337 <em class='comment'>   or drop protocol.  XM_DRAG_STYLE_DROP_ONLY means the window does</em>
<a id='L1338' name='L1338'></a>  1338 <em class='comment'>   not respond to any drag protocol messages, so only drops should be</em>
<a id='L1339' name='L1339'></a>  1339 <em class='comment'>   sent.  Any other value means that the window supports both the drag</em>
<a id='L1340' name='L1340'></a>  1340 <em class='comment'>   and drop protocols.  */</em>
<a id='L1341' name='L1341'></a>  1341 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong> x_dnd_last_motif_style;
<a id='L1342' name='L1342'></a>  1342 
<a id='L1343' name='L1343'></a>  1343 <em class='comment'>/* The timestamp where Emacs last acquired ownership of the</em>
<a id='L1344' name='L1344'></a>  1344 <em class='comment'>   `XdndSelection' selection.  */</em>
<a id='L1345' name='L1345'></a>  1345 <strong class='reserved'>static</strong> <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a> x_dnd_selection_timestamp;
<a id='L1346' name='L1346'></a>  1346 
<a id='L1347' name='L1347'></a>  1347 <em class='comment'>/* The drop target window to which the rectangle below applies.  */</em>
<a id='L1348' name='L1348'></a>  1348 <strong class='reserved'>static</strong> <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> x_dnd_mouse_rect_target;
<a id='L1349' name='L1349'></a>  1349 
<a id='L1350' name='L1350'></a>  1350 <em class='comment'>/* A rectangle where XDND position messages should not be sent to the</em>
<a id='L1351' name='L1351'></a>  1351 <em class='comment'>   drop target if the mouse pointer lies within.  */</em>
<a id='L1352' name='L1352'></a>  1352 <strong class='reserved'>static</strong> <a href='../S/2150.html#L62' title='Defined at 62 in src/pgtkgui.h.'>XRectangle</a> x_dnd_mouse_rect;
<a id='L1353' name='L1353'></a>  1353 
<a id='L1354' name='L1354'></a>  1354 <em class='comment'>/* If not None, Emacs is waiting for an XdndStatus event from this</em>
<a id='L1355' name='L1355'></a>  1355 <em class='comment'>   window.  */</em>
<a id='L1356' name='L1356'></a>  1356 <strong class='reserved'>static</strong> <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> x_dnd_waiting_for_status_window;
<a id='L1357' name='L1357'></a>  1357 
<a id='L1358' name='L1358'></a>  1358 <em class='comment'>/* If .type != 0, an event that should be sent to .xclient.window</em>
<a id='L1359' name='L1359'></a>  1359 <em class='comment'>   upon receiving an XdndStatus event from said window.  */</em>
<a id='L1360' name='L1360'></a>  1360 <strong class='reserved'>static</strong> XEvent x_dnd_pending_send_position;
<a id='L1361' name='L1361'></a>  1361 
<a id='L1362' name='L1362'></a>  1362 <em class='comment'>/* Whether or not that event corresponds to a button press.  */</em>
<a id='L1363' name='L1363'></a>  1363 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> x_dnd_pending_send_position_button;
<a id='L1364' name='L1364'></a>  1364 
<a id='L1365' name='L1365'></a>  1365 <em class='comment'>/* The root-window position of that event.  */</em>
<a id='L1366' name='L1366'></a>  1366 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong> x_dnd_pending_send_position_root_x;
<a id='L1367' name='L1367'></a>  1367 
<a id='L1368' name='L1368'></a>  1368 <em class='comment'>/* Likewise.  */</em>
<a id='L1369' name='L1369'></a>  1369 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong> x_dnd_pending_send_position_root_y;
<a id='L1370' name='L1370'></a>  1370 
<a id='L1371' name='L1371'></a>  1371 <em class='comment'>/* If true, send a drop from `x_dnd_finish_frame' to the pending</em>
<a id='L1372' name='L1372'></a>  1372 <em class='comment'>   status window after receiving all pending XdndStatus events.  */</em>
<a id='L1373' name='L1373'></a>  1373 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> x_dnd_need_send_drop;
<a id='L1374' name='L1374'></a>  1374 
<a id='L1375' name='L1375'></a>  1375 <em class='comment'>/* The protocol version of any such drop.  */</em>
<a id='L1376' name='L1376'></a>  1376 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong> x_dnd_send_drop_proto;
<a id='L1377' name='L1377'></a>  1377 
<a id='L1378' name='L1378'></a>  1378 <em class='comment'>/* The action the drop target actually chose to perform.</em>
<a id='L1379' name='L1379'></a>  1379 <em class='comment'></em>
<a id='L1380' name='L1380'></a>  1380 <em class='comment'>   Under XDND, this is set upon receiving the XdndFinished or</em>
<a id='L1381' name='L1381'></a>  1381 <em class='comment'>   XdndStatus messages from the drop target.</em>
<a id='L1382' name='L1382'></a>  1382 <em class='comment'></em>
<a id='L1383' name='L1383'></a>  1383 <em class='comment'>   Under Motif, this is changed upon receiving a XmDROP_START message</em>
<a id='L1384' name='L1384'></a>  1384 <em class='comment'>   in reply to our own.</em>
<a id='L1385' name='L1385'></a>  1385 <em class='comment'></em>
<a id='L1386' name='L1386'></a>  1386 <em class='comment'>   When dropping on a target that doesn't support any drag-and-drop</em>
<a id='L1387' name='L1387'></a>  1387 <em class='comment'>   protocol, this is set to the atom XdndActionPrivate.  */</em>
<a id='L1388' name='L1388'></a>  1388 <strong class='reserved'>static</strong> Atom x_dnd_action;
<a id='L1389' name='L1389'></a>  1389 
<a id='L1390' name='L1390'></a>  1390 <em class='comment'>/* The symbol to return from `x-begin-drag' if non-nil.  Takes</em>
<a id='L1391' name='L1391'></a>  1391 <em class='comment'>   precedence over `x_dnd_action`.  */</em>
<a id='L1392' name='L1392'></a>  1392 <strong class='reserved'>static</strong> <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> x_dnd_action_symbol;
<a id='L1393' name='L1393'></a>  1393 
<a id='L1394' name='L1394'></a>  1394 <em class='comment'>/* The action we want the drop target to perform.  The drop target may</em>
<a id='L1395' name='L1395'></a>  1395 <em class='comment'>   elect to perform some different action, which is guaranteed to be</em>
<a id='L1396' name='L1396'></a>  1396 <em class='comment'>   in `x_dnd_action' upon completion of a drop.  */</em>
<a id='L1397' name='L1397'></a>  1397 <strong class='reserved'>static</strong> Atom x_dnd_wanted_action;
<a id='L1398' name='L1398'></a>  1398 
<a id='L1399' name='L1399'></a>  1399 <em class='comment'>/* The set of optional actions available to a Motif drop target</em>
<a id='L1400' name='L1400'></a>  1400 <em class='comment'>   computed at the start of the drag-and-drop operation.  */</em>
<a id='L1401' name='L1401'></a>  1401 <strong class='reserved'>static</strong> <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> x_dnd_motif_operations;
<a id='L1402' name='L1402'></a>  1402 
<a id='L1403' name='L1403'></a>  1403 <em class='comment'>/* The preferred optional action out of that set.  Only takes effect</em>
<a id='L1404' name='L1404'></a>  1404 <em class='comment'>   if `x_dnd_action' is XdndAsk.  */</em>
<a id='L1405' name='L1405'></a>  1405 <strong class='reserved'>static</strong> <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> x_dnd_first_motif_operation;
<a id='L1406' name='L1406'></a>  1406 
<a id='L1407' name='L1407'></a>  1407 <em class='comment'>/* Array of selection targets available to the drop target.  */</em>
<a id='L1408' name='L1408'></a>  1408 <strong class='reserved'>static</strong> Atom *x_dnd_targets;
<a id='L1409' name='L1409'></a>  1409 
<a id='L1410' name='L1410'></a>  1410 <em class='comment'>/* The number of elements in that array.  */</em>
<a id='L1411' name='L1411'></a>  1411 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong> x_dnd_n_targets;
<a id='L1412' name='L1412'></a>  1412 
<a id='L1413' name='L1413'></a>  1413 <em class='comment'>/* The old window attributes of the root window before the</em>
<a id='L1414' name='L1414'></a>  1414 <em class='comment'>   drag-and-drop operation started.  It is used to keep the old event</em>
<a id='L1415' name='L1415'></a>  1415 <em class='comment'>   mask around, since that should be restored after the operation</em>
<a id='L1416' name='L1416'></a>  1416 <em class='comment'>   finishes.  */</em>
<a id='L1417' name='L1417'></a>  1417 <strong class='reserved'>static</strong> XWindowAttributes x_dnd_old_window_attrs;
<a id='L1418' name='L1418'></a>  1418 
<a id='L1419' name='L1419'></a>  1419 <em class='comment'>/* Whether or not `x_dnd_cleaup_drag_and_drop' should actually clean</em>
<a id='L1420' name='L1420'></a>  1420 <em class='comment'>   up the drag and drop operation.  */</em>
<a id='L1421' name='L1421'></a>  1421 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> x_dnd_unwind_flag;
<a id='L1422' name='L1422'></a>  1422 
<a id='L1423' name='L1423'></a>  1423 <em class='comment'>/* The frame for which `x-dnd-movement-function' should be called.  */</em>
<a id='L1424' name='L1424'></a>  1424 <strong class='reserved'>static</strong> <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *x_dnd_movement_frame;
<a id='L1425' name='L1425'></a>  1425 
<a id='L1426' name='L1426'></a>  1426 <em class='comment'>/* The coordinates which the movement function should be called</em>
<a id='L1427' name='L1427'></a>  1427 <em class='comment'>   with.  */</em>
<a id='L1428' name='L1428'></a>  1428 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong> x_dnd_movement_x, x_dnd_movement_y;
<a id='L1429' name='L1429'></a>  1429 
<a id='L1430' name='L1430'></a>  1430 <em class='comment'>/* The frame for which `x-dnd-wheel-function' should be called.  */</em>
<a id='L1431' name='L1431'></a>  1431 <strong class='reserved'>static</strong> <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *x_dnd_wheel_frame;
<a id='L1432' name='L1432'></a>  1432 
<a id='L1433' name='L1433'></a>  1433 <em class='comment'>/* The coordinates which the wheel function should be called with.  */</em>
<a id='L1434' name='L1434'></a>  1434 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong> x_dnd_wheel_x, x_dnd_wheel_y;
<a id='L1435' name='L1435'></a>  1435 
<a id='L1436' name='L1436'></a>  1436 <em class='comment'>/* The button that was pressed.  */</em>
<a id='L1437' name='L1437'></a>  1437 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong> x_dnd_wheel_button;
<a id='L1438' name='L1438'></a>  1438 
<a id='L1439' name='L1439'></a>  1439 <em class='comment'>/* The modifier state when the button was pressed.  */</em>
<a id='L1440' name='L1440'></a>  1440 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong> x_dnd_wheel_state;
<a id='L1441' name='L1441'></a>  1441 
<a id='L1442' name='L1442'></a>  1442 <em class='comment'>/* When the button was pressed.  */</em>
<a id='L1443' name='L1443'></a>  1443 <strong class='reserved'>static</strong> <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a> x_dnd_wheel_time;
<a id='L1444' name='L1444'></a>  1444 
<a id='L1445' name='L1445'></a>  1445 <em class='sharp'>#ifdef</em> HAVE_XKB
<a id='L1446' name='L1446'></a>  1446 <em class='comment'>/* The keyboard state during the drag-and-drop operation.  */</em>
<a id='L1447' name='L1447'></a>  1447 <strong class='reserved'>static</strong> <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> x_dnd_keyboard_state;
<a id='L1448' name='L1448'></a>  1448 <em class='sharp'>#endif</em>
<a id='L1449' name='L1449'></a>  1449 
<a id='L1450' name='L1450'></a>  1450 <em class='comment'>/* jmp_buf that gets us out of the IO error handler if an error occurs</em>
<a id='L1451' name='L1451'></a>  1451 <em class='comment'>   terminating DND as part of the display disconnect handler.  */</em>
<a id='L1452' name='L1452'></a>  1452 <strong class='reserved'>static</strong> <a href='../S/54.html#L231' title='Defined at 231 in nt/inc/ms-w32.h.'>sigjmp_buf</a> x_dnd_disconnect_handler;
<a id='L1453' name='L1453'></a>  1453 
<a id='L1454' name='L1454'></a>  1454 <em class='comment'>/* Whether or not the current invocation of handle_one_xevent</em>
<a id='L1455' name='L1455'></a>  1455 <em class='comment'>   happened inside the drag_and_drop event loop.  */</em>
<a id='L1456' name='L1456'></a>  1456 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> x_dnd_inside_handle_one_xevent;
<a id='L1457' name='L1457'></a>  1457 
<a id='L1458' name='L1458'></a>  1458 <em class='comment'>/* The recursive edit depth when the drag-and-drop operation was</em>
<a id='L1459' name='L1459'></a>  1459 <em class='comment'>   started.  */</em>
<a id='L1460' name='L1460'></a>  1460 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong> x_dnd_recursion_depth;
<a id='L1461' name='L1461'></a>  1461 
<a id='L1462' name='L1462'></a>  1462 <em class='comment'>/* The cons cell containing the selection alias between the Motif drag</em>
<a id='L1463' name='L1463'></a>  1463 <em class='comment'>   selection and `XdndSelection'.  The car and cdr are only set when</em>
<a id='L1464' name='L1464'></a>  1464 <em class='comment'>   initiating Motif drag-and-drop for the first time.  */</em>
<a id='L1465' name='L1465'></a>  1465 <strong class='reserved'>static</strong> <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> x_dnd_selection_alias_cell;
<a id='L1466' name='L1466'></a>  1466 
<a id='L1467' name='L1467'></a>  1467 <em class='comment'>/* The last known position of the tooltip window.  */</em>
<a id='L1468' name='L1468'></a>  1468 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong> x_dnd_last_tooltip_x, x_dnd_last_tooltip_y;
<a id='L1469' name='L1469'></a>  1469 
<a id='L1470' name='L1470'></a>  1470 <em class='comment'>/* Whether or not those values are actually known yet.  */</em>
<a id='L1471' name='L1471'></a>  1471 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> x_dnd_last_tooltip_valid;
<a id='L1472' name='L1472'></a>  1472 
<a id='L1473' name='L1473'></a>  1473 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L1474' name='L1474'></a>  1474 <em class='comment'>/* The master pointer device being used for the drag-and-drop</em>
<a id='L1475' name='L1475'></a>  1475 <em class='comment'>   operation.  */</em>
<a id='L1476' name='L1476'></a>  1476 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong> x_dnd_pointer_device;
<a id='L1477' name='L1477'></a>  1477 
<a id='L1478' name='L1478'></a>  1478 <em class='comment'>/* The keyboard device attached to that pointer device.  */</em>
<a id='L1479' name='L1479'></a>  1479 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong> x_dnd_keyboard_device;
<a id='L1480' name='L1480'></a>  1480 <em class='sharp'>#endif</em>
<a id='L1481' name='L1481'></a>  1481 
<a id='L1482' name='L1482'></a>  1482 <em class='comment'>/* Structure describing a single window that can be the target of</em>
<a id='L1483' name='L1483'></a>  1483 <em class='comment'>   drag-and-drop operations.  */</em>
<a id='L1484' name='L1484'></a>  1484 <strong class='reserved'>struct</strong> <a href='../R/18077.html' title='Multiple referred from 11 places.'>x_client_list_window</a>
<a id='L1485' name='L1485'></a>  1485 <em class='brace'>{</em>
<a id='L1486' name='L1486'></a>  1486   <em class='comment'>/* The window itself.  */</em>
<a id='L1487' name='L1487'></a>  1487   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>;
<a id='L1488' name='L1488'></a>  1488 
<a id='L1489' name='L1489'></a>  1489   <em class='comment'>/* The display that window is on.  */</em>
<a id='L1490' name='L1490'></a>  1490   <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy;
<a id='L1491' name='L1491'></a>  1491 
<a id='L1492' name='L1492'></a>  1492   <em class='comment'>/* Its X and Y coordinates from the root window.  */</em>
<a id='L1493' name='L1493'></a>  1493   <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y;
<a id='L1494' name='L1494'></a>  1494 
<a id='L1495' name='L1495'></a>  1495   <em class='comment'>/* The width and height of the window.  */</em>
<a id='L1496' name='L1496'></a>  1496   <strong class='reserved'>int</strong> width, height;
<a id='L1497' name='L1497'></a>  1497 
<a id='L1498' name='L1498'></a>  1498   <em class='comment'>/* A bitmask describing events Emacs was listening for from the</em>
<a id='L1499' name='L1499'></a>  1499 <em class='comment'>     window before some extra events were added in</em>
<a id='L1500' name='L1500'></a>  1500 <em class='comment'>     `x_dnd_compute_toplevels'.  */</em>
<a id='L1501' name='L1501'></a>  1501   <strong class='reserved'>long</strong> previous_event_mask;
<a id='L1502' name='L1502'></a>  1502 
<a id='L1503' name='L1503'></a>  1503   <em class='comment'>/* The window manager state of the window.  */</em>
<a id='L1504' name='L1504'></a>  1504   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> wm_state;
<a id='L1505' name='L1505'></a>  1505 
<a id='L1506' name='L1506'></a>  1506   <em class='comment'>/* The next window in this list.  */</em>
<a id='L1507' name='L1507'></a>  1507   <strong class='reserved'>struct</strong> <a href='../S/2289.html#L1484' title='Defined at 1484 in src/xterm.c.'>x_client_list_window</a> *next;
<a id='L1508' name='L1508'></a>  1508 
<a id='L1509' name='L1509'></a>  1509   <em class='comment'>/* The extents of the frame window in each direction.  */</em>
<a id='L1510' name='L1510'></a>  1510   <strong class='reserved'>int</strong> frame_extents_left;
<a id='L1511' name='L1511'></a>  1511   <strong class='reserved'>int</strong> frame_extents_right;
<a id='L1512' name='L1512'></a>  1512   <strong class='reserved'>int</strong> frame_extents_top;
<a id='L1513' name='L1513'></a>  1513   <strong class='reserved'>int</strong> frame_extents_bottom;
<a id='L1514' name='L1514'></a>  1514 
<a id='L1515' name='L1515'></a>  1515 <em class='sharp'>#ifdef</em> HAVE_XSHAPE
<a id='L1516' name='L1516'></a>  1516   <em class='comment'>/* The border width of this window.  */</em>
<a id='L1517' name='L1517'></a>  1517   <strong class='reserved'>int</strong> border_width;
<a id='L1518' name='L1518'></a>  1518 
<a id='L1519' name='L1519'></a>  1519   <em class='comment'>/* The number of rectangles composing the input shape.  */</em>
<a id='L1520' name='L1520'></a>  1520   <strong class='reserved'>int</strong> n_input_rects;
<a id='L1521' name='L1521'></a>  1521 
<a id='L1522' name='L1522'></a>  1522   <em class='comment'>/* The rectangles making up the input shape.  */</em>
<a id='L1523' name='L1523'></a>  1523   <a href='../S/2150.html#L62' title='Defined at 62 in src/pgtkgui.h.'>XRectangle</a> *input_rects;
<a id='L1524' name='L1524'></a>  1524 
<a id='L1525' name='L1525'></a>  1525   <em class='comment'>/* The rectangles making up the bounding shape.  */</em>
<a id='L1526' name='L1526'></a>  1526   <a href='../S/2150.html#L62' title='Defined at 62 in src/pgtkgui.h.'>XRectangle</a> *bounding_rects;
<a id='L1527' name='L1527'></a>  1527 
<a id='L1528' name='L1528'></a>  1528   <em class='comment'>/* The number of rectangles composing the bounding shape.  */</em>
<a id='L1529' name='L1529'></a>  1529   <strong class='reserved'>int</strong> n_bounding_rects;
<a id='L1530' name='L1530'></a>  1530 <em class='sharp'>#endif</em>
<a id='L1531' name='L1531'></a>  1531 
<a id='L1532' name='L1532'></a>  1532   <em class='comment'>/* The Motif protocol style of this window, if any.  */</em>
<a id='L1533' name='L1533'></a>  1533   <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> xm_protocol_style;
<a id='L1534' name='L1534'></a>  1534 
<a id='L1535' name='L1535'></a>  1535   <em class='comment'>/* Whether or not the window is mapped.  */</em>
<a id='L1536' name='L1536'></a>  1536   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> mapped_p;
<a id='L1537' name='L1537'></a>  1537 <em class='brace'>}</em>;
<a id='L1538' name='L1538'></a>  1538 
<a id='L1539' name='L1539'></a>  1539 <em class='comment'>/* List of all toplevels in stacking order, from top to bottom.  */</em>
<a id='L1540' name='L1540'></a>  1540 <strong class='reserved'>static</strong> <strong class='reserved'>struct</strong> <a href='../S/2289.html#L1484' title='Defined at 1484 in src/xterm.c.'>x_client_list_window</a> *x_dnd_toplevels;
<a id='L1541' name='L1541'></a>  1541 
<a id='L1542' name='L1542'></a>  1542 <em class='comment'>/* Whether or not the window manager supports the required features</em>
<a id='L1543' name='L1543'></a>  1543 <em class='comment'>   for `x_dnd_toplevels' to work.  */</em>
<a id='L1544' name='L1544'></a>  1544 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> x_dnd_use_toplevels;
<a id='L1545' name='L1545'></a>  1545 
<a id='L1546' name='L1546'></a>  1546 <em class='comment'>/* Motif drag-and-drop protocol support.  */</em>
<a id='L1547' name='L1547'></a>  1547 
<a id='L1548' name='L1548'></a>  1548 <em class='comment'>/* Pointer to a variable which stores whether or not an X error</em>
<a id='L1549' name='L1549'></a>  1549 <em class='comment'>   occurred while trying to create the Motif drag window.  */</em>
<a id='L1550' name='L1550'></a>  1550 <strong class='reserved'>static</strong> <strong class='reserved'>volatile</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> *xm_drag_window_error;
<a id='L1551' name='L1551'></a>  1551 
<a id='L1552' name='L1552'></a>  1552 <strong class='reserved'>typedef</strong> <strong class='reserved'>enum</strong> <a href='../R/18625.html' title='Multiple referred from 3 places.'>xm_byte_order</a>
<a id='L1553' name='L1553'></a>  1553   <em class='brace'>{</em>
<a id='L1554' name='L1554'></a>  1554     XM_BYTE_ORDER_LSB_FIRST = 'l',
<a id='L1555' name='L1555'></a>  1555     XM_BYTE_ORDER_MSB_FIRST = 'B',
<a id='L1556' name='L1556'></a>  1556 <em class='sharp'>#ifndef</em> <a href='../D/6942.html' title='Multiple defined in 2 places.'>WORDS_BIGENDIAN</a>
<a id='L1557' name='L1557'></a>  1557     <a href='../R/6493.html' title='Multiple referred from 41 places.'>XM_BYTE_ORDER_CUR_FIRST</a> = 'l',
<a id='L1558' name='L1558'></a>  1558 <em class='sharp'>#else</em>
<a id='L1559' name='L1559'></a>  1559     <a href='../R/6493.html' title='Multiple referred from 41 places.'>XM_BYTE_ORDER_CUR_FIRST</a> = 'B',
<a id='L1560' name='L1560'></a>  1560 <em class='sharp'>#endif</em>
<a id='L1561' name='L1561'></a>  1561   <em class='brace'>}</em> <a href='../R/18625.html' title='Multiple referred from 3 places.'>xm_byte_order</a>;
<a id='L1562' name='L1562'></a>  1562 
<a id='L1563' name='L1563'></a>  1563 <em class='sharp'>#ifdef</em> ENABLE_CHECKING
<a id='L1564' name='L1564'></a>  1564 
<a id='L1565' name='L1565'></a>  1565 <em class='sharp'>#define</em> <a href='../R/5429.html' title='Multiple referred from 10 places.'>SWAPCARD32</a>(l)                           \
<a id='L1566' name='L1566'></a>  1566   <em class='brace'>{</em>                                             \
<a id='L1567' name='L1567'></a>  1567     <strong class='reserved'>struct</strong> <em class='brace'>{</em> <strong class='reserved'>unsigned</strong> t : 32; <em class='brace'>}</em> bit32;          \
<a id='L1568' name='L1568'></a>  1568     <strong class='reserved'>char</strong> n, *tp = (<strong class='reserved'>char</strong> *) &amp;bit32;              \
<a id='L1569' name='L1569'></a>  1569     bit32.t = l;                                \
<a id='L1570' name='L1570'></a>  1570     n = tp[0]; tp[0] = tp[3]; tp[3] = n;        \
<a id='L1571' name='L1571'></a>  1571     n = tp[1]; tp[1] = tp[2]; tp[2] = n;        \
<a id='L1572' name='L1572'></a>  1572     l = bit32.t;                                \
<a id='L1573' name='L1573'></a>  1573   <em class='brace'>}</em>
<a id='L1574' name='L1574'></a>  1574 
<a id='L1575' name='L1575'></a>  1575 <em class='sharp'>#define</em> <a href='../R/5428.html' title='Multiple referred from 16 places.'>SWAPCARD16</a>(s)                           \
<a id='L1576' name='L1576'></a>  1576   <em class='brace'>{</em>                                             \
<a id='L1577' name='L1577'></a>  1577     <strong class='reserved'>struct</strong> <em class='brace'>{</em> <strong class='reserved'>unsigned</strong> t : 16; <em class='brace'>}</em> bit16;          \
<a id='L1578' name='L1578'></a>  1578     <strong class='reserved'>char</strong> n, *tp = (<strong class='reserved'>char</strong> *) &amp;bit16;              \
<a id='L1579' name='L1579'></a>  1579     bit16.t = s;                                \
<a id='L1580' name='L1580'></a>  1580     n = tp[0]; tp[0] = tp[1]; tp[1] = n;        \
<a id='L1581' name='L1581'></a>  1581     s = bit16.t;                                \
<a id='L1582' name='L1582'></a>  1582   <em class='brace'>}</em>
<a id='L1583' name='L1583'></a>  1583 
<a id='L1584' name='L1584'></a>  1584 <em class='sharp'>#else</em>
<a id='L1585' name='L1585'></a>  1585 <em class='sharp'>#define</em> <a href='../R/5429.html' title='Multiple referred from 10 places.'>SWAPCARD32</a>(l)   ((l) = <a href='../D/9374.html' title='Multiple defined in 2 places.'>bswap_32</a> (l))
<a id='L1586' name='L1586'></a>  1586 <em class='sharp'>#define</em> <a href='../R/5428.html' title='Multiple referred from 16 places.'>SWAPCARD16</a>(l)   ((l) = <a href='../S/2892.html#L23' title='Defined at 23 in lib/byteswap.in.h.'>bswap_16</a> (l))
<a id='L1587' name='L1587'></a>  1587 <em class='sharp'>#endif</em>
<a id='L1588' name='L1588'></a>  1588 
<a id='L1589' name='L1589'></a>  1589 <strong class='reserved'>typedef</strong> <strong class='reserved'>struct</strong> <a href='../R/18667.html' title='Multiple referred from 4 places.'>xm_targets_table_header</a>
<a id='L1590' name='L1590'></a>  1590 <em class='brace'>{</em>
<a id='L1591' name='L1591'></a>  1591   <em class='comment'>/* BYTE   */</em> <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> byte_order;
<a id='L1592' name='L1592'></a>  1592   <em class='comment'>/* BYTE   */</em> <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> protocol;
<a id='L1593' name='L1593'></a>  1593 
<a id='L1594' name='L1594'></a>  1594   <em class='comment'>/* CARD16 */</em> <a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> target_list_count;
<a id='L1595' name='L1595'></a>  1595   <em class='comment'>/* CARD32 */</em> <a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> total_data_size;
<a id='L1596' name='L1596'></a>  1596 <em class='brace'>}</em> <a href='../R/18667.html' title='Multiple referred from 4 places.'>xm_targets_table_header</a>;
<a id='L1597' name='L1597'></a>  1597 
<a id='L1598' name='L1598'></a>  1598 <strong class='reserved'>typedef</strong> <strong class='reserved'>struct</strong> <a href='../R/18668.html' title='Multiple referred from 9 places.'>xm_targets_table_rec</a>
<a id='L1599' name='L1599'></a>  1599 <em class='brace'>{</em>
<a id='L1600' name='L1600'></a>  1600   <em class='comment'>/* CARD16 */</em> <a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> n_targets;
<a id='L1601' name='L1601'></a>  1601   <em class='comment'>/* CARD32 */</em> <a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> targets[FLEXIBLE_ARRAY_MEMBER];
<a id='L1602' name='L1602'></a>  1602 <em class='brace'>}</em> <a href='../R/18668.html' title='Multiple referred from 9 places.'>xm_targets_table_rec</a>;
<a id='L1603' name='L1603'></a>  1603 
<a id='L1604' name='L1604'></a>  1604 <strong class='reserved'>typedef</strong> <strong class='reserved'>struct</strong> <a href='../R/18634.html' title='Multiple referred from 10 places.'>xm_drop_start_message</a>
<a id='L1605' name='L1605'></a>  1605 <em class='brace'>{</em>
<a id='L1606' name='L1606'></a>  1606   <em class='comment'>/* BYTE   */</em> <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> reason;
<a id='L1607' name='L1607'></a>  1607   <em class='comment'>/* BYTE   */</em> <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> byte_order;
<a id='L1608' name='L1608'></a>  1608 
<a id='L1609' name='L1609'></a>  1609   <em class='comment'>/* CARD16 */</em> <a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> side_effects;
<a id='L1610' name='L1610'></a>  1610   <em class='comment'>/* CARD32 */</em> <a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> timestamp;
<a id='L1611' name='L1611'></a>  1611   <em class='comment'>/* CARD16 */</em> <a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y;
<a id='L1612' name='L1612'></a>  1612   <em class='comment'>/* CARD32 */</em> <a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> index_atom;
<a id='L1613' name='L1613'></a>  1613   <em class='comment'>/* CARD32 */</em> <a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> source_window;
<a id='L1614' name='L1614'></a>  1614 <em class='brace'>}</em> <a href='../R/18634.html' title='Multiple referred from 10 places.'>xm_drop_start_message</a>;
<a id='L1615' name='L1615'></a>  1615 
<a id='L1616' name='L1616'></a>  1616 <strong class='reserved'>typedef</strong> <strong class='reserved'>struct</strong> <a href='../R/18635.html' title='Multiple referred from 3 places.'>xm_drop_start_reply</a>
<a id='L1617' name='L1617'></a>  1617 <em class='brace'>{</em>
<a id='L1618' name='L1618'></a>  1618   <em class='comment'>/* BYTE   */</em> <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> reason;
<a id='L1619' name='L1619'></a>  1619   <em class='comment'>/* BYTE   */</em> <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> byte_order;
<a id='L1620' name='L1620'></a>  1620 
<a id='L1621' name='L1621'></a>  1621   <em class='comment'>/* CARD16 */</em> <a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> side_effects;
<a id='L1622' name='L1622'></a>  1622   <em class='comment'>/* CARD16 */</em> <a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> better_x;
<a id='L1623' name='L1623'></a>  1623   <em class='comment'>/* CARD16 */</em> <a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> better_y;
<a id='L1624' name='L1624'></a>  1624 <em class='brace'>}</em> <a href='../R/18635.html' title='Multiple referred from 3 places.'>xm_drop_start_reply</a>;
<a id='L1625' name='L1625'></a>  1625 
<a id='L1626' name='L1626'></a>  1626 <strong class='reserved'>typedef</strong> <strong class='reserved'>struct</strong> <a href='../R/18628.html' title='Multiple referred from 2 places.'>xm_drag_initiator_info</a>
<a id='L1627' name='L1627'></a>  1627 <em class='brace'>{</em>
<a id='L1628' name='L1628'></a>  1628   <em class='comment'>/* BYTE   */</em> <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> byteorder;
<a id='L1629' name='L1629'></a>  1629   <em class='comment'>/* BYTE   */</em> <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> protocol;
<a id='L1630' name='L1630'></a>  1630 
<a id='L1631' name='L1631'></a>  1631   <em class='comment'>/* CARD16 */</em> <a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> table_index;
<a id='L1632' name='L1632'></a>  1632   <em class='comment'>/* CARD32 */</em> <a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> <a href='../S/2073.html#L63' title='Defined at 63 in lwlib/lwlib-Xm.c.'>selection</a>;
<a id='L1633' name='L1633'></a>  1633 <em class='brace'>}</em> <a href='../R/18628.html' title='Multiple referred from 2 places.'>xm_drag_initiator_info</a>;
<a id='L1634' name='L1634'></a>  1634 
<a id='L1635' name='L1635'></a>  1635 <strong class='reserved'>typedef</strong> <strong class='reserved'>struct</strong> <a href='../R/18631.html' title='Multiple referred from 5 places.'>xm_drag_receiver_info</a>
<a id='L1636' name='L1636'></a>  1636 <em class='brace'>{</em>
<a id='L1637' name='L1637'></a>  1637   <em class='comment'>/* BYTE   */</em> <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> byteorder;
<a id='L1638' name='L1638'></a>  1638   <em class='comment'>/* BYTE   */</em> <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> protocol;
<a id='L1639' name='L1639'></a>  1639 
<a id='L1640' name='L1640'></a>  1640   <em class='comment'>/* BYTE   */</em> <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> protocol_style;
<a id='L1641' name='L1641'></a>  1641   <em class='comment'>/* BYTE   */</em> <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> unspecified0;
<a id='L1642' name='L1642'></a>  1642   <em class='comment'>/* CARD32 */</em> <a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> unspecified1;
<a id='L1643' name='L1643'></a>  1643   <em class='comment'>/* CARD32 */</em> <a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> unspecified2;
<a id='L1644' name='L1644'></a>  1644   <em class='comment'>/* CARD32 */</em> <a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> unspecified3;
<a id='L1645' name='L1645'></a>  1645 <em class='brace'>}</em> <a href='../R/18631.html' title='Multiple referred from 5 places.'>xm_drag_receiver_info</a>;
<a id='L1646' name='L1646'></a>  1646 
<a id='L1647' name='L1647'></a>  1647 <strong class='reserved'>typedef</strong> <strong class='reserved'>struct</strong> <a href='../R/18669.html' title='Multiple referred from 4 places.'>xm_top_level_enter_message</a>
<a id='L1648' name='L1648'></a>  1648 <em class='brace'>{</em>
<a id='L1649' name='L1649'></a>  1649   <em class='comment'>/* BYTE   */</em> <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> reason;
<a id='L1650' name='L1650'></a>  1650   <em class='comment'>/* BYTE   */</em> <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> byteorder;
<a id='L1651' name='L1651'></a>  1651 
<a id='L1652' name='L1652'></a>  1652   <em class='comment'>/* CARD16 */</em> <a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> zero;
<a id='L1653' name='L1653'></a>  1653   <em class='comment'>/* CARD32 */</em> <a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> timestamp;
<a id='L1654' name='L1654'></a>  1654   <em class='comment'>/* CARD32 */</em> <a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> source_window;
<a id='L1655' name='L1655'></a>  1655   <em class='comment'>/* CARD32 */</em> <a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> index_atom;
<a id='L1656' name='L1656'></a>  1656 <em class='brace'>}</em> <a href='../R/18669.html' title='Multiple referred from 4 places.'>xm_top_level_enter_message</a>;
<a id='L1657' name='L1657'></a>  1657 
<a id='L1658' name='L1658'></a>  1658 <strong class='reserved'>typedef</strong> <strong class='reserved'>struct</strong> <a href='../R/18629.html' title='Multiple referred from 7 places.'>xm_drag_motion_message</a>
<a id='L1659' name='L1659'></a>  1659 <em class='brace'>{</em>
<a id='L1660' name='L1660'></a>  1660   <em class='comment'>/* BYTE   */</em> <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> reason;
<a id='L1661' name='L1661'></a>  1661   <em class='comment'>/* BYTE   */</em> <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> byteorder;
<a id='L1662' name='L1662'></a>  1662 
<a id='L1663' name='L1663'></a>  1663   <em class='comment'>/* CARD16 */</em> <a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> side_effects;
<a id='L1664' name='L1664'></a>  1664   <em class='comment'>/* CARD32 */</em> <a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> timestamp;
<a id='L1665' name='L1665'></a>  1665   <em class='comment'>/* CARD16 */</em> <a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y;
<a id='L1666' name='L1666'></a>  1666 <em class='brace'>}</em> <a href='../R/18629.html' title='Multiple referred from 7 places.'>xm_drag_motion_message</a>;
<a id='L1667' name='L1667'></a>  1667 
<a id='L1668' name='L1668'></a>  1668 <strong class='reserved'>typedef</strong> <strong class='reserved'>struct</strong> <a href='../R/18630.html' title='Multiple referred from 2 places.'>xm_drag_motion_reply</a>
<a id='L1669' name='L1669'></a>  1669 <em class='brace'>{</em>
<a id='L1670' name='L1670'></a>  1670   <em class='comment'>/* BYTE   */</em> <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> reason;
<a id='L1671' name='L1671'></a>  1671   <em class='comment'>/* BYTE   */</em> <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> byte_order;
<a id='L1672' name='L1672'></a>  1672 
<a id='L1673' name='L1673'></a>  1673   <em class='comment'>/* CARD16 */</em> <a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> side_effects;
<a id='L1674' name='L1674'></a>  1674   <em class='comment'>/* CARD32 */</em> <a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> timestamp;
<a id='L1675' name='L1675'></a>  1675   <em class='comment'>/* CARD16 */</em> <a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> better_x;
<a id='L1676' name='L1676'></a>  1676   <em class='comment'>/* CARD16 */</em> <a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> better_y;
<a id='L1677' name='L1677'></a>  1677 <em class='brace'>}</em> <a href='../R/18630.html' title='Multiple referred from 2 places.'>xm_drag_motion_reply</a>;
<a id='L1678' name='L1678'></a>  1678 
<a id='L1679' name='L1679'></a>  1679 <strong class='reserved'>typedef</strong> <strong class='reserved'>struct</strong> <a href='../R/18670.html' title='Multiple referred from 5 places.'>xm_top_level_leave_message</a>
<a id='L1680' name='L1680'></a>  1680 <em class='brace'>{</em>
<a id='L1681' name='L1681'></a>  1681   <em class='comment'>/* BYTE   */</em> <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> reason;
<a id='L1682' name='L1682'></a>  1682   <em class='comment'>/* BYTE   */</em> <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> byteorder;
<a id='L1683' name='L1683'></a>  1683 
<a id='L1684' name='L1684'></a>  1684   <em class='comment'>/* CARD16 */</em> <a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> zero;
<a id='L1685' name='L1685'></a>  1685   <em class='comment'>/* CARD32 */</em> <a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> timestamp;
<a id='L1686' name='L1686'></a>  1686   <em class='comment'>/* CARD32 */</em> <a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> source_window;
<a id='L1687' name='L1687'></a>  1687 <em class='brace'>}</em> <a href='../R/18670.html' title='Multiple referred from 5 places.'>xm_top_level_leave_message</a>;
<a id='L1688' name='L1688'></a>  1688 
<a id='L1689' name='L1689'></a>  1689 <em class='sharp'>#define</em> <a href='../R/6510.html' title='Multiple referred from 13 places.'>XM_DRAG_SIDE_EFFECT</a>(op, <a href='../S/4097.html#L5' title='Defined at 5 in test/manual/etags/cp-src/conway.hpp.'>site</a>, ops, act)         \
<a id='L1690' name='L1690'></a>  1690   ((op) | ((<a href='../S/4097.html#L5' title='Defined at 5 in test/manual/etags/cp-src/conway.hpp.'>site</a>) &lt;&lt; 4) | ((ops) &lt;&lt; 8) | ((act) &lt;&lt; 12))
<a id='L1691' name='L1691'></a>  1691 
<a id='L1692' name='L1692'></a>  1692 <em class='comment'>/* Some of the macros below are temporarily unused.  */</em>
<a id='L1693' name='L1693'></a>  1693 
<a id='L1694' name='L1694'></a>  1694 <em class='sharp'>#define</em> <a href='../S/2289.html#L18794' title='Referred from 18794 in src/xterm.c.'>XM_DRAG_SIDE_EFFECT_OPERATION</a>(effect)   ((effect) &amp; 0xf)
<a id='L1695' name='L1695'></a>  1695 <em class='sharp'>#define</em> <a href='../S/2289.html#L18795' title='Referred from 18795 in src/xterm.c.'>XM_DRAG_SIDE_EFFECT_SITE_STATUS</a>(effect) (((effect) &amp; 0xf0) &gt;&gt; 4)
<a id='L1696' name='L1696'></a>  1696 <em class='comment'>/* #define XM_DRAG_SIDE_EFFECT_OPERATIONS(effect)       (((effect) &amp; 0xf00) &gt;&gt; 8) */</em>
<a id='L1697' name='L1697'></a>  1697 <em class='sharp'>#define</em> <a href='../S/2289.html#L18796' title='Referred from 18796 in src/xterm.c.'>XM_DRAG_SIDE_EFFECT_DROP_ACTION</a>(effect) (((effect) &amp; 0xf000) &gt;&gt; 12)
<a id='L1698' name='L1698'></a>  1698 
<a id='L1699' name='L1699'></a>  1699 <strong class='reserved'>enum</strong> xm_drag_operation
<a id='L1700' name='L1700'></a>  1700   <em class='brace'>{</em>
<a id='L1701' name='L1701'></a>  1701     <a href='../R/6498.html' title='Multiple referred from 2 places.'>XM_DRAG_NOOP</a>     = 0,
<a id='L1702' name='L1702'></a>  1702     <a href='../R/6497.html' title='Multiple referred from 4 places.'>XM_DRAG_MOVE</a>     = (1L &lt;&lt; 0),
<a id='L1703' name='L1703'></a>  1703     <a href='../R/6494.html' title='Multiple referred from 4 places.'>XM_DRAG_COPY</a>     = (1L &lt;&lt; 1),
<a id='L1704' name='L1704'></a>  1704     <a href='../R/6495.html' title='Multiple referred from 3 places.'>XM_DRAG_LINK</a>     = (1L &lt;&lt; 2),
<a id='L1705' name='L1705'></a>  1705     <a href='../S/2289.html#L1709' title='Referred from 1709 in src/xterm.c.'>XM_DRAG_LINK_REC</a> = 3,
<a id='L1706' name='L1706'></a>  1706   <em class='brace'>}</em>;
<a id='L1707' name='L1707'></a>  1707 
<a id='L1708' name='L1708'></a>  1708 <em class='sharp'>#define</em> <a href='../S/2289.html#L18800' title='Referred from 18800 in src/xterm.c.'>XM_DRAG_OPERATION_IS_LINK</a>(op)   ((op) == <a href='../S/2289.html#L1704' title='Defined at 1704 in src/xterm.c.'>XM_DRAG_LINK</a>           \
<a id='L1709' name='L1709'></a>  1709                                          || (op) == <a href='../S/2289.html#L1705' title='Defined at 1705 in src/xterm.c.'>XM_DRAG_LINK_REC</a>)
<a id='L1710' name='L1710'></a>  1710 
<a id='L1711' name='L1711'></a>  1711 <strong class='reserved'>enum</strong> xm_drag_action
<a id='L1712' name='L1712'></a>  1712   <em class='brace'>{</em>
<a id='L1713' name='L1713'></a>  1713     <a href='../R/6522.html' title='Multiple referred from 5 places.'>XM_DROP_ACTION_DROP</a>        = 0,
<a id='L1714' name='L1714'></a>  1714     <a href='../R/6524.html' title='Multiple referred from 6 places.'>XM_DROP_ACTION_DROP_HELP</a>   = 1,
<a id='L1715' name='L1715'></a>  1715     <a href='../R/6523.html' title='Multiple referred from 9 places.'>XM_DROP_ACTION_DROP_CANCEL</a> = 2,
<a id='L1716' name='L1716'></a>  1716   <em class='brace'>}</em>;
<a id='L1717' name='L1717'></a>  1717 
<a id='L1718' name='L1718'></a>  1718 <em class='sharp'>#define</em> <a href='../R/6503.html' title='Multiple referred from 23 places.'>XM_DRAG_REASON</a>(originator, code)        ((code) | ((originator) &lt;&lt; 7))
<a id='L1719' name='L1719'></a>  1719 <em class='sharp'>#define</em> <a href='../R/6507.html' title='Multiple referred from 4 places.'>XM_DRAG_REASON_ORIGINATOR</a>(reason)       (((reason) &amp; 0x80) ? 1 : 0)
<a id='L1720' name='L1720'></a>  1720 <em class='sharp'>#define</em> <a href='../R/6504.html' title='Multiple referred from 4 places.'>XM_DRAG_REASON_CODE</a>(reason)             ((reason) &amp; 0x7f)
<a id='L1721' name='L1721'></a>  1721 
<a id='L1722' name='L1722'></a>  1722 <strong class='reserved'>enum</strong> xm_drag_reason
<a id='L1723' name='L1723'></a>  1723   <em class='brace'>{</em>
<a id='L1724' name='L1724'></a>  1724     <a href='../R/6506.html' title='Multiple referred from 9 places.'>XM_DRAG_REASON_DROP_START</a>      = 5,
<a id='L1725' name='L1725'></a>  1725     <a href='../R/6508.html' title='Multiple referred from 3 places.'>XM_DRAG_REASON_TOP_LEVEL_ENTER</a> = 0,
<a id='L1726' name='L1726'></a>  1726     <a href='../R/6509.html' title='Multiple referred from 7 places.'>XM_DRAG_REASON_TOP_LEVEL_LEAVE</a> = 1,
<a id='L1727' name='L1727'></a>  1727     <a href='../R/6505.html' title='Multiple referred from 8 places.'>XM_DRAG_REASON_DRAG_MOTION</a>     = 2,
<a id='L1728' name='L1728'></a>  1728   <em class='brace'>}</em>;
<a id='L1729' name='L1729'></a>  1729 
<a id='L1730' name='L1730'></a>  1730 <strong class='reserved'>enum</strong> xm_drag_originator
<a id='L1731' name='L1731'></a>  1731   <em class='brace'>{</em>
<a id='L1732' name='L1732'></a>  1732     <a href='../R/6500.html' title='Multiple referred from 25 places.'>XM_DRAG_ORIGINATOR_INITIATOR</a> = 0,
<a id='L1733' name='L1733'></a>  1733     <a href='../R/6501.html' title='Multiple referred from 2 places.'>XM_DRAG_ORIGINATOR_RECEIVER</a>  = 1,
<a id='L1734' name='L1734'></a>  1734   <em class='brace'>}</em>;
<a id='L1735' name='L1735'></a>  1735 
<a id='L1736' name='L1736'></a>  1736 <strong class='reserved'>enum</strong> xm_drag_style
<a id='L1737' name='L1737'></a>  1737   <em class='brace'>{</em>
<a id='L1738' name='L1738'></a>  1738     <em class='comment'>/* The values ending with _REC should be treated as equivalent to</em>
<a id='L1739' name='L1739'></a>  1739 <em class='comment'>       the ones without in messages from the receiver.  */</em>
<a id='L1740' name='L1740'></a>  1740     <a href='../R/6521.html' title='Multiple referred from 24 places.'>XM_DRAG_STYLE_NONE</a>          = 0,
<a id='L1741' name='L1741'></a>  1741     <a href='../S/2289.html#L1748' title='Referred from 1748 in src/xterm.c.'>XM_DRAG_STYLE_DROP_ONLY</a>     = 1,
<a id='L1742' name='L1742'></a>  1742     <a href='../S/2289.html#L1749' title='Referred from 1749 in src/xterm.c.'>XM_DRAG_STYLE_DROP_ONLY_REC</a> = 3,
<a id='L1743' name='L1743'></a>  1743     <a href='../S/2289.html#L1750' title='Referred from 1750 in src/xterm.c.'>XM_DRAG_STYLE_DYNAMIC</a>       = 5,
<a id='L1744' name='L1744'></a>  1744     <a href='../S/2289.html#L1751' title='Referred from 1751 in src/xterm.c.'>XM_DRAG_STYLE_DYNAMIC_REC</a>   = 2,
<a id='L1745' name='L1745'></a>  1745     <a href='../S/2289.html#L1752' title='Referred from 1752 in src/xterm.c.'>XM_DRAG_STYLE_DYNAMIC_REC1</a>  = 4,
<a id='L1746' name='L1746'></a>  1746   <em class='brace'>}</em>;
<a id='L1747' name='L1747'></a>  1747 
<a id='L1748' name='L1748'></a>  1748 <em class='sharp'>#define</em> <a href='../R/6519.html' title='Multiple referred from 7 places.'>XM_DRAG_STYLE_IS_DROP_ONLY</a>(n)   ((n) == <a href='../S/2289.html#L1741' title='Defined at 1741 in src/xterm.c.'>XM_DRAG_STYLE_DROP_ONLY</a> \
<a id='L1749' name='L1749'></a>  1749                                          || (n) == <a href='../S/2289.html#L1742' title='Defined at 1742 in src/xterm.c.'>XM_DRAG_STYLE_DROP_ONLY_REC</a>)
<a id='L1750' name='L1750'></a>  1750 <em class='sharp'>#define</em> <a href='../R/6520.html' title='Multiple referred from 12 places.'>XM_DRAG_STYLE_IS_DYNAMIC</a>(n)     ((n) == <a href='../S/2289.html#L1743' title='Defined at 1743 in src/xterm.c.'>XM_DRAG_STYLE_DYNAMIC</a>   \
<a id='L1751' name='L1751'></a>  1751                                          || (n) == <a href='../S/2289.html#L1744' title='Defined at 1744 in src/xterm.c.'>XM_DRAG_STYLE_DYNAMIC_REC</a> \
<a id='L1752' name='L1752'></a>  1752                                          || (n) == <a href='../S/2289.html#L1745' title='Defined at 1745 in src/xterm.c.'>XM_DRAG_STYLE_DYNAMIC_REC1</a>)
<a id='L1753' name='L1753'></a>  1753 
<a id='L1754' name='L1754'></a>  1754 <strong class='reserved'>enum</strong> xm_drop_site_status
<a id='L1755' name='L1755'></a>  1755   <em class='brace'>{</em>
<a id='L1756' name='L1756'></a>  1756     <a href='../R/6526.html' title='Multiple referred from 11 places.'>XM_DROP_SITE_VALID</a>   = 3,
<a id='L1757' name='L1757'></a>  1757     XM_DROP_SITE_INVALID = 2,
<a id='L1758' name='L1758'></a>  1758     <a href='../R/6525.html' title='Multiple referred from 3 places.'>XM_DROP_SITE_NONE</a>    = 1,
<a id='L1759' name='L1759'></a>  1759   <em class='brace'>}</em>;
<a id='L1760' name='L1760'></a>  1760 
<a id='L1761' name='L1761'></a>  1761 <em class='comment'>/* The version of the Motif drag-and-drop protocols that Emacs</em>
<a id='L1762' name='L1762'></a>  1762 <em class='comment'>   supports.  */</em>
<a id='L1763' name='L1763'></a>  1763 <em class='sharp'>#define</em> <a href='../R/6502.html' title='Multiple referred from 6 places.'>XM_DRAG_PROTOCOL_VERSION</a>        0
<a id='L1764' name='L1764'></a>  1764 
<a id='L1765' name='L1765'></a>  1765 <strong class='reserved'>static</strong> <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a>
<a id='L1766' name='L1766'></a>  1766 <a href='../R/18666.html' title='Multiple referred from 15 places.'>xm_side_effect_from_action</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo, Atom action)
<a id='L1767' name='L1767'></a>  1767 <em class='brace'>{</em>
<a id='L1768' name='L1768'></a>  1768   <strong class='reserved'>if</strong> (action == dpyinfo-&gt;Xatom_XdndActionCopy)
<a id='L1769' name='L1769'></a>  1769     <strong class='reserved'>return</strong> <a href='../S/2289.html#L1703' title='Defined at 1703 in src/xterm.c.'>XM_DRAG_COPY</a>;
<a id='L1770' name='L1770'></a>  1770   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (action == dpyinfo-&gt;Xatom_XdndActionMove)
<a id='L1771' name='L1771'></a>  1771     <strong class='reserved'>return</strong> <a href='../S/2289.html#L1702' title='Defined at 1702 in src/xterm.c.'>XM_DRAG_MOVE</a>;
<a id='L1772' name='L1772'></a>  1772   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (action == dpyinfo-&gt;Xatom_XdndActionLink)
<a id='L1773' name='L1773'></a>  1773     <strong class='reserved'>return</strong> <a href='../S/2289.html#L1704' title='Defined at 1704 in src/xterm.c.'>XM_DRAG_LINK</a>;
<a id='L1774' name='L1774'></a>  1774   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (action == dpyinfo-&gt;Xatom_XdndActionAsk)
<a id='L1775' name='L1775'></a>  1775     <strong class='reserved'>return</strong> x_dnd_first_motif_operation;
<a id='L1776' name='L1776'></a>  1776 
<a id='L1777' name='L1777'></a>  1777   <strong class='reserved'>return</strong> <a href='../S/2289.html#L1701' title='Defined at 1701 in src/xterm.c.'>XM_DRAG_NOOP</a>;
<a id='L1778' name='L1778'></a>  1778 <em class='brace'>}</em>
<a id='L1779' name='L1779'></a>  1779 
<a id='L1780' name='L1780'></a>  1780 <strong class='reserved'>static</strong> <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a>
<a id='L1781' name='L1781'></a>  1781 <a href='../S/2289.html#L12523' title='Referred from 12523 in src/xterm.c.'>xm_operations_from_actions</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L1782' name='L1782'></a>  1782                             Atom *ask_actions, <strong class='reserved'>int</strong> n_ask_actions)
<a id='L1783' name='L1783'></a>  1783 <em class='brace'>{</em>
<a id='L1784' name='L1784'></a>  1784   <strong class='reserved'>int</strong> i;
<a id='L1785' name='L1785'></a>  1785   <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> flags;
<a id='L1786' name='L1786'></a>  1786 
<a id='L1787' name='L1787'></a>  1787   flags = 0;
<a id='L1788' name='L1788'></a>  1788 
<a id='L1789' name='L1789'></a>  1789   <strong class='reserved'>for</strong> (i = 0; i &lt; n_ask_actions; ++i)
<a id='L1790' name='L1790'></a>  1790     <em class='brace'>{</em>
<a id='L1791' name='L1791'></a>  1791       <strong class='reserved'>if</strong> (ask_actions[i] == dpyinfo-&gt;Xatom_XdndActionCopy)
<a id='L1792' name='L1792'></a>  1792         flags |= <a href='../S/2289.html#L1703' title='Defined at 1703 in src/xterm.c.'>XM_DRAG_COPY</a>;
<a id='L1793' name='L1793'></a>  1793       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (ask_actions[i] == dpyinfo-&gt;Xatom_XdndActionMove)
<a id='L1794' name='L1794'></a>  1794         flags |= <a href='../S/2289.html#L1702' title='Defined at 1702 in src/xterm.c.'>XM_DRAG_MOVE</a>;
<a id='L1795' name='L1795'></a>  1795       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (ask_actions[i] == dpyinfo-&gt;Xatom_XdndActionLink)
<a id='L1796' name='L1796'></a>  1796         flags |= <a href='../S/2289.html#L1704' title='Defined at 1704 in src/xterm.c.'>XM_DRAG_LINK</a>;
<a id='L1797' name='L1797'></a>  1797     <em class='brace'>}</em>
<a id='L1798' name='L1798'></a>  1798 
<a id='L1799' name='L1799'></a>  1799   <strong class='reserved'>return</strong> flags;
<a id='L1800' name='L1800'></a>  1800 <em class='brace'>}</em>
<a id='L1801' name='L1801'></a>  1801 
<a id='L1802' name='L1802'></a>  1802 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L1803' name='L1803'></a>  1803 <a href='../S/2289.html#L2234' title='Referred from 2234 in src/xterm.c.'>xm_read_targets_table_header</a> (<a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> *bytes, ptrdiff_t length,
<a id='L1804' name='L1804'></a>  1804                               <a href='../D/20051.html' title='Multiple defined in 2 places.'>xm_targets_table_header</a> *header_return,
<a id='L1805' name='L1805'></a>  1805                               <a href='../D/20003.html' title='Multiple defined in 2 places.'>xm_byte_order</a> *byteorder_return)
<a id='L1806' name='L1806'></a>  1806 <em class='brace'>{</em>
<a id='L1807' name='L1807'></a>  1807   <strong class='reserved'>if</strong> (length &lt; 8)
<a id='L1808' name='L1808'></a>  1808     <strong class='reserved'>return</strong> -1;
<a id='L1809' name='L1809'></a>  1809 
<a id='L1810' name='L1810'></a>  1810   header_return-&gt;byte_order = *byteorder_return = *(bytes++);
<a id='L1811' name='L1811'></a>  1811   header_return-&gt;protocol = *(bytes++);
<a id='L1812' name='L1812'></a>  1812 
<a id='L1813' name='L1813'></a>  1813   header_return-&gt;target_list_count = *(<a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> *) bytes;
<a id='L1814' name='L1814'></a>  1814   header_return-&gt;total_data_size = *(<a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> *) (bytes + 2);
<a id='L1815' name='L1815'></a>  1815 
<a id='L1816' name='L1816'></a>  1816   <strong class='reserved'>if</strong> (header_return-&gt;byte_order != <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>)
<a id='L1817' name='L1817'></a>  1817     <em class='brace'>{</em>
<a id='L1818' name='L1818'></a>  1818       <a href='../D/6041.html' title='Multiple defined in 2 places.'>SWAPCARD16</a> (header_return-&gt;target_list_count);
<a id='L1819' name='L1819'></a>  1819       <a href='../D/6042.html' title='Multiple defined in 2 places.'>SWAPCARD32</a> (header_return-&gt;total_data_size);
<a id='L1820' name='L1820'></a>  1820     <em class='brace'>}</em>
<a id='L1821' name='L1821'></a>  1821 
<a id='L1822' name='L1822'></a>  1822   header_return-&gt;byte_order = <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>;
<a id='L1823' name='L1823'></a>  1823 
<a id='L1824' name='L1824'></a>  1824   <strong class='reserved'>return</strong> 8;
<a id='L1825' name='L1825'></a>  1825 <em class='brace'>}</em>
<a id='L1826' name='L1826'></a>  1826 
<a id='L1827' name='L1827'></a>  1827 <strong class='reserved'>static</strong> <a href='../D/20052.html' title='Multiple defined in 2 places.'>xm_targets_table_rec</a> *
<a id='L1828' name='L1828'></a>  1828 <a href='../S/2289.html#L2250' title='Referred from 2250 in src/xterm.c.'>xm_read_targets_table_rec</a> (<a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> *bytes, ptrdiff_t length,
<a id='L1829' name='L1829'></a>  1829                            <a href='../D/20003.html' title='Multiple defined in 2 places.'>xm_byte_order</a> byteorder)
<a id='L1830' name='L1830'></a>  1830 <em class='brace'>{</em>
<a id='L1831' name='L1831'></a>  1831   <a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> nitems, i;
<a id='L1832' name='L1832'></a>  1832   <a href='../D/20052.html' title='Multiple defined in 2 places.'>xm_targets_table_rec</a> *rec;
<a id='L1833' name='L1833'></a>  1833 
<a id='L1834' name='L1834'></a>  1834   <strong class='reserved'>if</strong> (length &lt; 2)
<a id='L1835' name='L1835'></a>  1835     <strong class='reserved'>return</strong> <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L1836' name='L1836'></a>  1836 
<a id='L1837' name='L1837'></a>  1837   nitems = *(<a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> *) bytes;
<a id='L1838' name='L1838'></a>  1838 
<a id='L1839' name='L1839'></a>  1839   <strong class='reserved'>if</strong> (byteorder != <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>)
<a id='L1840' name='L1840'></a>  1840     <a href='../D/6041.html' title='Multiple defined in 2 places.'>SWAPCARD16</a> (nitems);
<a id='L1841' name='L1841'></a>  1841 
<a id='L1842' name='L1842'></a>  1842   <strong class='reserved'>if</strong> (length &lt; 2 + nitems * 4)
<a id='L1843' name='L1843'></a>  1843     <strong class='reserved'>return</strong> <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L1844' name='L1844'></a>  1844 
<a id='L1845' name='L1845'></a>  1845   rec = <a href='../D/20068.html' title='Multiple defined in 10 places.'>xmalloc</a> (<a href='../S/2854.html#L63' title='Defined at 63 in lib/flexmember.h.'>FLEXSIZEOF</a> (<strong class='reserved'>struct</strong> <a href='../D/20052.html' title='Multiple defined in 2 places.'>xm_targets_table_rec</a>,
<a id='L1846' name='L1846'></a>  1846                              targets, nitems * 4));
<a id='L1847' name='L1847'></a>  1847   rec-&gt;n_targets = nitems;
<a id='L1848' name='L1848'></a>  1848 
<a id='L1849' name='L1849'></a>  1849   <strong class='reserved'>for</strong> (i = 0; i &lt; nitems; ++i)
<a id='L1850' name='L1850'></a>  1850     <em class='brace'>{</em>
<a id='L1851' name='L1851'></a>  1851       rec-&gt;targets[i] = ((<a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> *) (bytes + 2))[i];
<a id='L1852' name='L1852'></a>  1852 
<a id='L1853' name='L1853'></a>  1853       <strong class='reserved'>if</strong> (byteorder != <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>)
<a id='L1854' name='L1854'></a>  1854         <a href='../D/6042.html' title='Multiple defined in 2 places.'>SWAPCARD32</a> (rec-&gt;targets[i]);
<a id='L1855' name='L1855'></a>  1855     <em class='brace'>}</em>
<a id='L1856' name='L1856'></a>  1856 
<a id='L1857' name='L1857'></a>  1857   <strong class='reserved'>return</strong> rec;
<a id='L1858' name='L1858'></a>  1858 <em class='brace'>}</em>
<a id='L1859' name='L1859'></a>  1859 
<a id='L1860' name='L1860'></a>  1860 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L1861' name='L1861'></a>  1861 <a href='../S/2289.html#L2309' title='Referred from 2309 in src/xterm.c.'>xm_find_targets_table_idx</a> (<a href='../D/20051.html' title='Multiple defined in 2 places.'>xm_targets_table_header</a> *header,
<a id='L1862' name='L1862'></a>  1862                            <a href='../D/20052.html' title='Multiple defined in 2 places.'>xm_targets_table_rec</a> **recs,
<a id='L1863' name='L1863'></a>  1863                            Atom *sorted_targets, <strong class='reserved'>int</strong> ntargets)
<a id='L1864' name='L1864'></a>  1864 <em class='brace'>{</em>
<a id='L1865' name='L1865'></a>  1865   <strong class='reserved'>int</strong> j;
<a id='L1866' name='L1866'></a>  1866   <a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> i;
<a id='L1867' name='L1867'></a>  1867   <a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> *targets;
<a id='L1868' name='L1868'></a>  1868 
<a id='L1869' name='L1869'></a>  1869   targets = <a href='../D/8439.html' title='Multiple defined in 8 places.'>alloca</a> (<strong class='reserved'>sizeof</strong> *targets * ntargets);
<a id='L1870' name='L1870'></a>  1870 
<a id='L1871' name='L1871'></a>  1871   <strong class='reserved'>for</strong> (j = 0; j &lt; ntargets; ++j)
<a id='L1872' name='L1872'></a>  1872     targets[j] = sorted_targets[j];
<a id='L1873' name='L1873'></a>  1873 
<a id='L1874' name='L1874'></a>  1874   <strong class='reserved'>for</strong> (i = 0; i &lt; header-&gt;target_list_count; ++i)
<a id='L1875' name='L1875'></a>  1875     <em class='brace'>{</em>
<a id='L1876' name='L1876'></a>  1876       <strong class='reserved'>if</strong> (recs[i]-&gt;n_targets == ntargets
<a id='L1877' name='L1877'></a>  1877           &amp;&amp; !memcmp (&amp;recs[i]-&gt;targets, targets,
<a id='L1878' name='L1878'></a>  1878                       <strong class='reserved'>sizeof</strong> *targets * ntargets))
<a id='L1879' name='L1879'></a>  1879         <strong class='reserved'>return</strong> i;
<a id='L1880' name='L1880'></a>  1880     <em class='brace'>}</em>
<a id='L1881' name='L1881'></a>  1881 
<a id='L1882' name='L1882'></a>  1882   <strong class='reserved'>return</strong> -1;
<a id='L1883' name='L1883'></a>  1883 <em class='brace'>}</em>
<a id='L1884' name='L1884'></a>  1884 
<a id='L1885' name='L1885'></a>  1885 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L1886' name='L1886'></a>  1886 <a href='../S/2289.html#L2205' title='Referred from 2205 in src/xterm.c.'>x_atoms_compare</a> (<strong class='reserved'>const</strong> <strong class='reserved'>void</strong> *<a href='../D/8258.html' title='Multiple defined in 6 places.'>a</a>, <strong class='reserved'>const</strong> <strong class='reserved'>void</strong> *<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>)
<a id='L1887' name='L1887'></a>  1887 <em class='brace'>{</em>
<a id='L1888' name='L1888'></a>  1888   <strong class='reserved'>return</strong> *(Atom *) <a href='../D/8258.html' title='Multiple defined in 6 places.'>a</a> - *(Atom *) <a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>;
<a id='L1889' name='L1889'></a>  1889 <em class='brace'>}</em>
<a id='L1890' name='L1890'></a>  1890 
<a id='L1891' name='L1891'></a>  1891 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L1892' name='L1892'></a>  1892 <a href='../S/2289.html#L2374' title='Referred from 2374 in src/xterm.c.'>xm_write_targets_table</a> (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> wdesc,
<a id='L1893' name='L1893'></a>  1893                         Atom targets_table_atom,
<a id='L1894' name='L1894'></a>  1894                         <a href='../D/20051.html' title='Multiple defined in 2 places.'>xm_targets_table_header</a> *header,
<a id='L1895' name='L1895'></a>  1895                         <a href='../D/20052.html' title='Multiple defined in 2 places.'>xm_targets_table_rec</a> **recs)
<a id='L1896' name='L1896'></a>  1896 <em class='brace'>{</em>
<a id='L1897' name='L1897'></a>  1897   <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> *header_buffer, *ptr, *rec_buffer;
<a id='L1898' name='L1898'></a>  1898   ptrdiff_t rec_buffer_size;
<a id='L1899' name='L1899'></a>  1899   <a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> i, j;
<a id='L1900' name='L1900'></a>  1900 
<a id='L1901' name='L1901'></a>  1901   header_buffer = <a href='../D/8439.html' title='Multiple defined in 8 places.'>alloca</a> (8);
<a id='L1902' name='L1902'></a>  1902   ptr = header_buffer;
<a id='L1903' name='L1903'></a>  1903 
<a id='L1904' name='L1904'></a>  1904   *(header_buffer++) = header-&gt;byte_order;
<a id='L1905' name='L1905'></a>  1905   *(header_buffer++) = header-&gt;protocol;
<a id='L1906' name='L1906'></a>  1906   *((<a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> *) header_buffer) = header-&gt;target_list_count;
<a id='L1907' name='L1907'></a>  1907   *((<a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> *) (header_buffer + 2)) = header-&gt;total_data_size;
<a id='L1908' name='L1908'></a>  1908 
<a id='L1909' name='L1909'></a>  1909   rec_buffer = <a href='../D/20068.html' title='Multiple defined in 10 places.'>xmalloc</a> (600);
<a id='L1910' name='L1910'></a>  1910   rec_buffer_size = 600;
<a id='L1911' name='L1911'></a>  1911 
<a id='L1912' name='L1912'></a>  1912   XChangeProperty (dpy, wdesc, targets_table_atom,
<a id='L1913' name='L1913'></a>  1913                    targets_table_atom, 8, PropModeReplace,
<a id='L1914' name='L1914'></a>  1914                    (<strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *) ptr, 8);
<a id='L1915' name='L1915'></a>  1915 
<a id='L1916' name='L1916'></a>  1916   <strong class='reserved'>for</strong> (i = 0; i &lt; header-&gt;target_list_count; ++i)
<a id='L1917' name='L1917'></a>  1917     <em class='brace'>{</em>
<a id='L1918' name='L1918'></a>  1918       <strong class='reserved'>if</strong> (rec_buffer_size &lt; 2 + recs[i]-&gt;n_targets * 4)
<a id='L1919' name='L1919'></a>  1919         <em class='brace'>{</em>
<a id='L1920' name='L1920'></a>  1920           rec_buffer_size = 2 + recs[i]-&gt;n_targets * 4;
<a id='L1921' name='L1921'></a>  1921           rec_buffer = <a href='../D/20107.html' title='Multiple defined in 7 places.'>xrealloc</a> (rec_buffer, rec_buffer_size);
<a id='L1922' name='L1922'></a>  1922         <em class='brace'>}</em>
<a id='L1923' name='L1923'></a>  1923 
<a id='L1924' name='L1924'></a>  1924       *((<a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> *) rec_buffer) = recs[i]-&gt;n_targets;
<a id='L1925' name='L1925'></a>  1925 
<a id='L1926' name='L1926'></a>  1926       <strong class='reserved'>for</strong> (j = 0; j &lt; recs[i]-&gt;n_targets; ++j)
<a id='L1927' name='L1927'></a>  1927         ((<a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> *) (rec_buffer + 2))[j] = recs[i]-&gt;targets[j];
<a id='L1928' name='L1928'></a>  1928 
<a id='L1929' name='L1929'></a>  1929       XChangeProperty (dpy, wdesc, targets_table_atom,
<a id='L1930' name='L1930'></a>  1930                        targets_table_atom, 8, PropModeAppend,
<a id='L1931' name='L1931'></a>  1931                        (<strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *) rec_buffer,
<a id='L1932' name='L1932'></a>  1932                        2 + recs[i]-&gt;n_targets * 4);
<a id='L1933' name='L1933'></a>  1933     <em class='brace'>}</em>
<a id='L1934' name='L1934'></a>  1934 
<a id='L1935' name='L1935'></a>  1935   <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (rec_buffer);
<a id='L1936' name='L1936'></a>  1936 <em class='brace'>}</em>
<a id='L1937' name='L1937'></a>  1937 
<a id='L1938' name='L1938'></a>  1938 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L1939' name='L1939'></a>  1939 <a href='../S/2289.html#L2554' title='Referred from 2554 in src/xterm.c.'>xm_write_drag_initiator_info</a> (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> wdesc,
<a id='L1940' name='L1940'></a>  1940                               Atom prop_name, Atom type_name,
<a id='L1941' name='L1941'></a>  1941                               <a href='../D/20007.html' title='Multiple defined in 2 places.'>xm_drag_initiator_info</a> *<a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a>)
<a id='L1942' name='L1942'></a>  1942 <em class='brace'>{</em>
<a id='L1943' name='L1943'></a>  1943   <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> *buf;
<a id='L1944' name='L1944'></a>  1944 
<a id='L1945' name='L1945'></a>  1945   buf = <a href='../D/8439.html' title='Multiple defined in 8 places.'>alloca</a> (8);
<a id='L1946' name='L1946'></a>  1946   buf[0] = <a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a>-&gt;byteorder;
<a id='L1947' name='L1947'></a>  1947   buf[1] = <a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a>-&gt;protocol;
<a id='L1948' name='L1948'></a>  1948 
<a id='L1949' name='L1949'></a>  1949   <strong class='reserved'>if</strong> (<a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a>-&gt;byteorder != <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>)
<a id='L1950' name='L1950'></a>  1950     <em class='brace'>{</em>
<a id='L1951' name='L1951'></a>  1951       <a href='../D/6041.html' title='Multiple defined in 2 places.'>SWAPCARD16</a> (<a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a>-&gt;table_index);
<a id='L1952' name='L1952'></a>  1952       <a href='../D/6041.html' title='Multiple defined in 2 places.'>SWAPCARD16</a> (<a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a>-&gt;<a href='../S/2073.html#L63' title='Defined at 63 in lwlib/lwlib-Xm.c.'>selection</a>);
<a id='L1953' name='L1953'></a>  1953     <em class='brace'>}</em>
<a id='L1954' name='L1954'></a>  1954 
<a id='L1955' name='L1955'></a>  1955   *((<a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> *) (buf + 2)) = <a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a>-&gt;table_index;
<a id='L1956' name='L1956'></a>  1956   *((<a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> *) (buf + 4)) = <a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a>-&gt;<a href='../S/2073.html#L63' title='Defined at 63 in lwlib/lwlib-Xm.c.'>selection</a>;
<a id='L1957' name='L1957'></a>  1957 
<a id='L1958' name='L1958'></a>  1958   XChangeProperty (dpy, wdesc, prop_name, type_name, 8,
<a id='L1959' name='L1959'></a>  1959                    PropModeReplace, (<strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *) buf, 8);
<a id='L1960' name='L1960'></a>  1960 <em class='brace'>}</em>
<a id='L1961' name='L1961'></a>  1961 
<a id='L1962' name='L1962'></a>  1962 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L1963' name='L1963'></a>  1963 <a href='../S/2289.html#L2087' title='Referred from 2087 in src/xterm.c.'>xm_drag_window_error_handler</a> (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, XErrorEvent *event)
<a id='L1964' name='L1964'></a>  1964 <em class='brace'>{</em>
<a id='L1965' name='L1965'></a>  1965   <strong class='reserved'>if</strong> (xm_drag_window_error)
<a id='L1966' name='L1966'></a>  1966     *xm_drag_window_error = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L1967' name='L1967'></a>  1967 
<a id='L1968' name='L1968'></a>  1968   <strong class='reserved'>return</strong> 0;
<a id='L1969' name='L1969'></a>  1969 <em class='brace'>}</em>
<a id='L1970' name='L1970'></a>  1970 
<a id='L1971' name='L1971'></a>  1971 <strong class='reserved'>static</strong> <strong class='reserved'>_Noreturn</strong> <strong class='reserved'>int</strong>
<a id='L1972' name='L1972'></a>  1972 <a href='../S/2289.html#L2061' title='Referred from 2061 in src/xterm.c.'>xm_drag_window_io_error_handler</a> (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy)
<a id='L1973' name='L1973'></a>  1973 <em class='brace'>{</em>
<a id='L1974' name='L1974'></a>  1974   <em class='comment'>/* DPY isn't created through GDK, so it doesn't matter if we don't</em>
<a id='L1975' name='L1975'></a>  1975 <em class='comment'>     crash here.  */</em>
<a id='L1976' name='L1976'></a>  1976   siglongjmp (x_dnd_disconnect_handler, 1);
<a id='L1977' name='L1977'></a>  1977 <em class='brace'>}</em>
<a id='L1978' name='L1978'></a>  1978 
<a id='L1979' name='L1979'></a>  1979 <em class='comment'>/* Determine whether or not WINDOW exists on DPYINFO by selecting for</em>
<a id='L1980' name='L1980'></a>  1980 <em class='comment'>   input from it.  */</em>
<a id='L1981' name='L1981'></a>  1981 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L1982' name='L1982'></a>  1982 <a href='../R/18342.html' title='Multiple referred from 5 places.'>x_special_window_exists_p</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L1983' name='L1983'></a>  1983                            <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>)
<a id='L1984' name='L1984'></a>  1984 <em class='brace'>{</em>
<a id='L1985' name='L1985'></a>  1985   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> rc;
<a id='L1986' name='L1986'></a>  1986 
<a id='L1987' name='L1987'></a>  1987   x_catch_errors (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L1988' name='L1988'></a>  1988   XSelectInput (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>,
<a id='L1989' name='L1989'></a>  1989                 StructureNotifyMask);
<a id='L1990' name='L1990'></a>  1990   rc = !x_had_errors_p (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L1991' name='L1991'></a>  1991   x_uncatch_errors_after_check ();
<a id='L1992' name='L1992'></a>  1992 
<a id='L1993' name='L1993'></a>  1993   <strong class='reserved'>return</strong> rc;
<a id='L1994' name='L1994'></a>  1994 <em class='brace'>}</em>
<a id='L1995' name='L1995'></a>  1995 
<a id='L1996' name='L1996'></a>  1996 <em class='comment'>/* Drag window creation strategy (very tricky, but race-free):</em>
<a id='L1997' name='L1997'></a>  1997 <em class='comment'></em>
<a id='L1998' name='L1998'></a>  1998 <em class='comment'>   First look for _MOTIF_DRAG_WINDOW.  If it is already present,</em>
<a id='L1999' name='L1999'></a>  1999 <em class='comment'>   return it immediately to avoid the overhead of new display</em>
<a id='L2000' name='L2000'></a>  2000 <em class='comment'>   connections.</em>
<a id='L2001' name='L2001'></a>  2001 <em class='comment'></em>
<a id='L2002' name='L2002'></a>  2002 <em class='comment'>   Otherwise, create a new connection to the display. In that</em>
<a id='L2003' name='L2003'></a>  2003 <em class='comment'>   connection, create a window, which will be the new drag window. Set</em>
<a id='L2004' name='L2004'></a>  2004 <em class='comment'>   the client disconnect mode of the new connection to</em>
<a id='L2005' name='L2005'></a>  2005 <em class='comment'>   RetainPermanent, and close it.</em>
<a id='L2006' name='L2006'></a>  2006 <em class='comment'></em>
<a id='L2007' name='L2007'></a>  2007 <em class='comment'>   Grab the current display.  Look up _MOTIF_DRAG_WINDOW, the current</em>
<a id='L2008' name='L2008'></a>  2008 <em class='comment'>   drag window.  If it exists (which means _MOTIF_DRAG_WINDOW was</em>
<a id='L2009' name='L2009'></a>  2009 <em class='comment'>   created between the first step and now), kill the client that</em>
<a id='L2010' name='L2010'></a>  2010 <em class='comment'>   created the new drag window to free the client slot on the X</em>
<a id='L2011' name='L2011'></a>  2011 <em class='comment'>   server.  Otherwise, set _MOTIF_DRAG_WINDOW to the new drag window.</em>
<a id='L2012' name='L2012'></a>  2012 <em class='comment'></em>
<a id='L2013' name='L2013'></a>  2013 <em class='comment'>   Ungrab the display and return whichever window is currently in</em>
<a id='L2014' name='L2014'></a>  2014 <em class='comment'>   _MOTIF_DRAG_WINDOW.  */</em>
<a id='L2015' name='L2015'></a>  2015 
<a id='L2016' name='L2016'></a>  2016 <strong class='reserved'>static</strong> <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a>
<a id='L2017' name='L2017'></a>  2017 <a href='../S/2289.html#L2173' title='Referred from 2173 in src/xterm.c.'>xm_get_drag_window_1</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo)
<a id='L2018' name='L2018'></a>  2018 <em class='brace'>{</em>
<a id='L2019' name='L2019'></a>  2019   Atom actual_type;
<a id='L2020' name='L2020'></a>  2020   <strong class='reserved'>int</strong> rc, actual_format;
<a id='L2021' name='L2021'></a>  2021   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> nitems, bytes_remaining;
<a id='L2022' name='L2022'></a>  2022   <strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *tmp_data = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L2023' name='L2023'></a>  2023   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> drag_window;
<a id='L2024' name='L2024'></a>  2024   XSetWindowAttributes attrs;
<a id='L2025' name='L2025'></a>  2025   <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *temp_display;
<a id='L2026' name='L2026'></a>  2026   Emacs_XErrorHandler old_handler;
<a id='L2027' name='L2027'></a>  2027   Emacs_XIOErrorHandler old_io_handler;
<a id='L2028' name='L2028'></a>  2028 
<a id='L2029' name='L2029'></a>  2029   <em class='comment'>/* This is volatile because GCC mistakenly warns about them being</em>
<a id='L2030' name='L2030'></a>  2030 <em class='comment'>     clobbered by longjmp.  */</em>
<a id='L2031' name='L2031'></a>  2031   <strong class='reserved'>volatile</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> <a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>;
<a id='L2032' name='L2032'></a>  2032 
<a id='L2033' name='L2033'></a>  2033   drag_window = None;
<a id='L2034' name='L2034'></a>  2034   rc = XGetWindowProperty (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, dpyinfo-&gt;root_window,
<a id='L2035' name='L2035'></a>  2035                            dpyinfo-&gt;Xatom_MOTIF_DRAG_WINDOW,
<a id='L2036' name='L2036'></a>  2036                            0, 1, False, XA_WINDOW, &amp;actual_type,
<a id='L2037' name='L2037'></a>  2037                            &amp;actual_format, &amp;nitems, &amp;bytes_remaining,
<a id='L2038' name='L2038'></a>  2038                            &amp;tmp_data) == Success;
<a id='L2039' name='L2039'></a>  2039 
<a id='L2040' name='L2040'></a>  2040   <strong class='reserved'>if</strong> (rc &amp;&amp; actual_type == XA_WINDOW
<a id='L2041' name='L2041'></a>  2041       &amp;&amp; actual_format == 32 &amp;&amp; nitems == 1
<a id='L2042' name='L2042'></a>  2042       &amp;&amp; tmp_data)
<a id='L2043' name='L2043'></a>  2043     <em class='brace'>{</em>
<a id='L2044' name='L2044'></a>  2044       drag_window = *(<a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> *) tmp_data;
<a id='L2045' name='L2045'></a>  2045 
<a id='L2046' name='L2046'></a>  2046       <em class='comment'>/* This has the side effect of selecting for</em>
<a id='L2047' name='L2047'></a>  2047 <em class='comment'>         StructureNotifyMask, meaning that we will get notifications</em>
<a id='L2048' name='L2048'></a>  2048 <em class='comment'>         once it is deleted.  */</em>
<a id='L2049' name='L2049'></a>  2049       rc = <a href='../S/2289.html#L1982' title='Defined at 1982 in src/xterm.c.'>x_special_window_exists_p</a> (dpyinfo, drag_window);
<a id='L2050' name='L2050'></a>  2050 
<a id='L2051' name='L2051'></a>  2051       <strong class='reserved'>if</strong> (!rc)
<a id='L2052' name='L2052'></a>  2052         drag_window = None;
<a id='L2053' name='L2053'></a>  2053     <em class='brace'>}</em>
<a id='L2054' name='L2054'></a>  2054 
<a id='L2055' name='L2055'></a>  2055   <strong class='reserved'>if</strong> (tmp_data)
<a id='L2056' name='L2056'></a>  2056     XFree (tmp_data);
<a id='L2057' name='L2057'></a>  2057 
<a id='L2058' name='L2058'></a>  2058   <strong class='reserved'>if</strong> (drag_window == None)
<a id='L2059' name='L2059'></a>  2059     <em class='brace'>{</em>
<a id='L2060' name='L2060'></a>  2060       <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L2061' name='L2061'></a>  2061       old_io_handler = XSetIOErrorHandler (<a href='../S/2289.html#L1972' title='Defined at 1972 in src/xterm.c.'>xm_drag_window_io_error_handler</a>);
<a id='L2062' name='L2062'></a>  2062 
<a id='L2063' name='L2063'></a>  2063       <strong class='reserved'>if</strong> (<a href='../D/17468.html' title='Multiple defined in 2 places.'>sigsetjmp</a> (x_dnd_disconnect_handler, 1))
<a id='L2064' name='L2064'></a>  2064         <em class='brace'>{</em>
<a id='L2065' name='L2065'></a>  2065           XSetIOErrorHandler (old_io_handler);
<a id='L2066' name='L2066'></a>  2066           <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L2067' name='L2067'></a>  2067 
<a id='L2068' name='L2068'></a>  2068           <strong class='reserved'>return</strong> None;
<a id='L2069' name='L2069'></a>  2069         <em class='brace'>}</em>
<a id='L2070' name='L2070'></a>  2070 
<a id='L2071' name='L2071'></a>  2071       <a href='../S/2286.html#L840' title='Defined at 840 in src/sysdep.c.'>unrequest_sigio</a> ();
<a id='L2072' name='L2072'></a>  2072       temp_display = XOpenDisplay (XDisplayString (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>));
<a id='L2073' name='L2073'></a>  2073       <a href='../S/2286.html#L816' title='Defined at 816 in src/sysdep.c.'>request_sigio</a> ();
<a id='L2074' name='L2074'></a>  2074 
<a id='L2075' name='L2075'></a>  2075       <strong class='reserved'>if</strong> (!temp_display)
<a id='L2076' name='L2076'></a>  2076         <em class='brace'>{</em>
<a id='L2077' name='L2077'></a>  2077           XSetIOErrorHandler (old_io_handler);
<a id='L2078' name='L2078'></a>  2078           <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L2079' name='L2079'></a>  2079 
<a id='L2080' name='L2080'></a>  2080           <strong class='reserved'>return</strong> None;
<a id='L2081' name='L2081'></a>  2081         <em class='brace'>}</em>
<a id='L2082' name='L2082'></a>  2082 
<a id='L2083' name='L2083'></a>  2083       <a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a> = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L2084' name='L2084'></a>  2084       xm_drag_window_error = &amp;<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>;
<a id='L2085' name='L2085'></a>  2085 
<a id='L2086' name='L2086'></a>  2086       XSetCloseDownMode (temp_display, RetainPermanent);
<a id='L2087' name='L2087'></a>  2087       old_handler = XSetErrorHandler (<a href='../S/2289.html#L1963' title='Defined at 1963 in src/xterm.c.'>xm_drag_window_error_handler</a>);
<a id='L2088' name='L2088'></a>  2088 
<a id='L2089' name='L2089'></a>  2089       attrs.override_redirect = True;
<a id='L2090' name='L2090'></a>  2090       drag_window = XCreateWindow (temp_display, DefaultRootWindow (temp_display),
<a id='L2091' name='L2091'></a>  2091                                    -1, -1, 1, 1, 0, CopyFromParent, InputOnly,
<a id='L2092' name='L2092'></a>  2092                                    CopyFromParent, CWOverrideRedirect, &amp;attrs);
<a id='L2093' name='L2093'></a>  2093 
<a id='L2094' name='L2094'></a>  2094       <em class='comment'>/* Handle all errors now.   */</em>
<a id='L2095' name='L2095'></a>  2095       <a href='../D/7378.html' title='Multiple defined in 3 places.'>XSync</a> (temp_display, False);
<a id='L2096' name='L2096'></a>  2096 
<a id='L2097' name='L2097'></a>  2097       <em class='comment'>/* Some part of the drag window creation process failed, so</em>
<a id='L2098' name='L2098'></a>  2098 <em class='comment'>         punt.  Release all resources too.  */</em>
<a id='L2099' name='L2099'></a>  2099       <strong class='reserved'>if</strong> (<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>)
<a id='L2100' name='L2100'></a>  2100         <em class='brace'>{</em>
<a id='L2101' name='L2101'></a>  2101           XSetCloseDownMode (temp_display, DestroyAll);
<a id='L2102' name='L2102'></a>  2102           drag_window = None;
<a id='L2103' name='L2103'></a>  2103         <em class='brace'>}</em>
<a id='L2104' name='L2104'></a>  2104 
<a id='L2105' name='L2105'></a>  2105       xm_drag_window_error = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L2106' name='L2106'></a>  2106 
<a id='L2107' name='L2107'></a>  2107       <em class='comment'>/* FIXME: why does XCloseDisplay hang if SIGIO arrives and there</em>
<a id='L2108' name='L2108'></a>  2108 <em class='comment'>         are multiple displays? */</em>
<a id='L2109' name='L2109'></a>  2109       <a href='../S/2286.html#L840' title='Defined at 840 in src/sysdep.c.'>unrequest_sigio</a> ();
<a id='L2110' name='L2110'></a>  2110       XCloseDisplay (temp_display);
<a id='L2111' name='L2111'></a>  2111       <a href='../S/2286.html#L816' title='Defined at 816 in src/sysdep.c.'>request_sigio</a> ();
<a id='L2112' name='L2112'></a>  2112 
<a id='L2113' name='L2113'></a>  2113       XSetErrorHandler (old_handler);
<a id='L2114' name='L2114'></a>  2114       XSetIOErrorHandler (old_io_handler);
<a id='L2115' name='L2115'></a>  2115 
<a id='L2116' name='L2116'></a>  2116       <em class='comment'>/* Make sure the drag window created is actually valid for the</em>
<a id='L2117' name='L2117'></a>  2117 <em class='comment'>         current display, and the XOpenDisplay above didn't</em>
<a id='L2118' name='L2118'></a>  2118 <em class='comment'>         accidentally connect to some other display.  */</em>
<a id='L2119' name='L2119'></a>  2119       <strong class='reserved'>if</strong> (!<a href='../S/2289.html#L1982' title='Defined at 1982 in src/xterm.c.'>x_special_window_exists_p</a> (dpyinfo, drag_window))
<a id='L2120' name='L2120'></a>  2120         drag_window = None;
<a id='L2121' name='L2121'></a>  2121       <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L2122' name='L2122'></a>  2122 
<a id='L2123' name='L2123'></a>  2123       <strong class='reserved'>if</strong> (drag_window != None)
<a id='L2124' name='L2124'></a>  2124         <em class='brace'>{</em>
<a id='L2125' name='L2125'></a>  2125           XGrabServer (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L2126' name='L2126'></a>  2126 
<a id='L2127' name='L2127'></a>  2127           x_catch_errors (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L2128' name='L2128'></a>  2128           tmp_data = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L2129' name='L2129'></a>  2129 
<a id='L2130' name='L2130'></a>  2130           rc = XGetWindowProperty (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, dpyinfo-&gt;root_window,
<a id='L2131' name='L2131'></a>  2131                                    dpyinfo-&gt;Xatom_MOTIF_DRAG_WINDOW,
<a id='L2132' name='L2132'></a>  2132                                    0, 1, False, XA_WINDOW, &amp;actual_type,
<a id='L2133' name='L2133'></a>  2133                                    &amp;actual_format, &amp;nitems, &amp;bytes_remaining,
<a id='L2134' name='L2134'></a>  2134                                    &amp;tmp_data) == Success;
<a id='L2135' name='L2135'></a>  2135 
<a id='L2136' name='L2136'></a>  2136           <strong class='reserved'>if</strong> (rc &amp;&amp; actual_type == XA_WINDOW
<a id='L2137' name='L2137'></a>  2137               &amp;&amp; actual_format == 32 &amp;&amp; nitems == 1
<a id='L2138' name='L2138'></a>  2138               &amp;&amp; tmp_data
<a id='L2139' name='L2139'></a>  2139               &amp;&amp; <a href='../S/2289.html#L1982' title='Defined at 1982 in src/xterm.c.'>x_special_window_exists_p</a> (dpyinfo,
<a id='L2140' name='L2140'></a>  2140                                             *(<a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> *) tmp_data))
<a id='L2141' name='L2141'></a>  2141             <em class='brace'>{</em>
<a id='L2142' name='L2142'></a>  2142               <em class='comment'>/* Kill the client now to avoid leaking a client slot,</em>
<a id='L2143' name='L2143'></a>  2143 <em class='comment'>                 which is a limited resource.  */</em>
<a id='L2144' name='L2144'></a>  2144               XKillClient (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, drag_window);
<a id='L2145' name='L2145'></a>  2145               drag_window = *(<a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> *) tmp_data;
<a id='L2146' name='L2146'></a>  2146             <em class='brace'>}</em>
<a id='L2147' name='L2147'></a>  2147           <strong class='reserved'>else</strong>
<a id='L2148' name='L2148'></a>  2148             XChangeProperty (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, dpyinfo-&gt;root_window,
<a id='L2149' name='L2149'></a>  2149                              dpyinfo-&gt;Xatom_MOTIF_DRAG_WINDOW,
<a id='L2150' name='L2150'></a>  2150                              XA_WINDOW, 32, PropModeReplace,
<a id='L2151' name='L2151'></a>  2151                              (<strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *) &amp;drag_window, 1);
<a id='L2152' name='L2152'></a>  2152 
<a id='L2153' name='L2153'></a>  2153           <strong class='reserved'>if</strong> (tmp_data)
<a id='L2154' name='L2154'></a>  2154             XFree (tmp_data);
<a id='L2155' name='L2155'></a>  2155 
<a id='L2156' name='L2156'></a>  2156           <strong class='reserved'>if</strong> (x_had_errors_p (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>))
<a id='L2157' name='L2157'></a>  2157             drag_window = None;
<a id='L2158' name='L2158'></a>  2158           x_uncatch_errors ();
<a id='L2159' name='L2159'></a>  2159 
<a id='L2160' name='L2160'></a>  2160           XUngrabServer (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L2161' name='L2161'></a>  2161         <em class='brace'>}</em>
<a id='L2162' name='L2162'></a>  2162     <em class='brace'>}</em>
<a id='L2163' name='L2163'></a>  2163 
<a id='L2164' name='L2164'></a>  2164   <strong class='reserved'>return</strong> drag_window;
<a id='L2165' name='L2165'></a>  2165 <em class='brace'>}</em>
<a id='L2166' name='L2166'></a>  2166 
<a id='L2167' name='L2167'></a>  2167 <strong class='reserved'>static</strong> <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a>
<a id='L2168' name='L2168'></a>  2168 <a href='../S/2289.html#L2196' title='Referred from 2196 in src/xterm.c.'>xm_get_drag_window</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo)
<a id='L2169' name='L2169'></a>  2169 <em class='brace'>{</em>
<a id='L2170' name='L2170'></a>  2170   <strong class='reserved'>if</strong> (dpyinfo-&gt;motif_drag_window != None)
<a id='L2171' name='L2171'></a>  2171     <strong class='reserved'>return</strong> dpyinfo-&gt;motif_drag_window;
<a id='L2172' name='L2172'></a>  2172 
<a id='L2173' name='L2173'></a>  2173   dpyinfo-&gt;motif_drag_window = <a href='../S/2289.html#L2017' title='Defined at 2017 in src/xterm.c.'>xm_get_drag_window_1</a> (dpyinfo);
<a id='L2174' name='L2174'></a>  2174   <strong class='reserved'>return</strong> dpyinfo-&gt;motif_drag_window;
<a id='L2175' name='L2175'></a>  2175 <em class='brace'>}</em>
<a id='L2176' name='L2176'></a>  2176 
<a id='L2177' name='L2177'></a>  2177 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L2178' name='L2178'></a>  2178 <a href='../S/2289.html#L2544' title='Referred from 2544 in src/xterm.c.'>xm_setup_dnd_targets</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L2179' name='L2179'></a>  2179                       Atom *targets, <strong class='reserved'>int</strong> ntargets)
<a id='L2180' name='L2180'></a>  2180 <em class='brace'>{</em>
<a id='L2181' name='L2181'></a>  2181   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> drag_window;
<a id='L2182' name='L2182'></a>  2182   Atom *targets_sorted, actual_type;
<a id='L2183' name='L2183'></a>  2183   <strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *tmp_data = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L2184' name='L2184'></a>  2184   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> nitems, bytes_remaining;
<a id='L2185' name='L2185'></a>  2185   <strong class='reserved'>int</strong> rc, actual_format, idx;
<a id='L2186' name='L2186'></a>  2186   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> had_errors;
<a id='L2187' name='L2187'></a>  2187   <a href='../D/20051.html' title='Multiple defined in 2 places.'>xm_targets_table_header</a> header;
<a id='L2188' name='L2188'></a>  2188   <a href='../D/20052.html' title='Multiple defined in 2 places.'>xm_targets_table_rec</a> **recs <a href='../D/6570.html' title='Multiple defined in 2 places.'>UNINIT</a>;
<a id='L2189' name='L2189'></a>  2189   <a href='../D/20003.html' title='Multiple defined in 2 places.'>xm_byte_order</a> byteorder;
<a id='L2190' name='L2190'></a>  2190   <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> *data;
<a id='L2191' name='L2191'></a>  2191   ptrdiff_t total_bytes, total_items, i;
<a id='L2192' name='L2192'></a>  2192   <a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> <a href='../D/17482.html' title='Multiple defined in 5 places.'>size</a>, target_count;
<a id='L2193' name='L2193'></a>  2193 
<a id='L2194' name='L2194'></a>  2194  retry_drag_window:
<a id='L2195' name='L2195'></a>  2195 
<a id='L2196' name='L2196'></a>  2196   drag_window = <a href='../S/2289.html#L2168' title='Defined at 2168 in src/xterm.c.'>xm_get_drag_window</a> (dpyinfo);
<a id='L2197' name='L2197'></a>  2197 
<a id='L2198' name='L2198'></a>  2198   <strong class='reserved'>if</strong> (drag_window == None || ntargets &gt; 64)
<a id='L2199' name='L2199'></a>  2199     <strong class='reserved'>return</strong> -1;
<a id='L2200' name='L2200'></a>  2200 
<a id='L2201' name='L2201'></a>  2201   targets_sorted = <a href='../D/20068.html' title='Multiple defined in 10 places.'>xmalloc</a> (<strong class='reserved'>sizeof</strong> *targets * ntargets);
<a id='L2202' name='L2202'></a>  2202   memcpy (targets_sorted, targets,
<a id='L2203' name='L2203'></a>  2203           <strong class='reserved'>sizeof</strong> *targets * ntargets);
<a id='L2204' name='L2204'></a>  2204   qsort (targets_sorted, ntargets,
<a id='L2205' name='L2205'></a>  2205          <strong class='reserved'>sizeof</strong> (Atom), <a href='../S/2289.html#L1886' title='Defined at 1886 in src/xterm.c.'>x_atoms_compare</a>);
<a id='L2206' name='L2206'></a>  2206 
<a id='L2207' name='L2207'></a>  2207   XGrabServer (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L2208' name='L2208'></a>  2208 
<a id='L2209' name='L2209'></a>  2209   x_catch_errors (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L2210' name='L2210'></a>  2210   rc = XGetWindowProperty (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, drag_window,
<a id='L2211' name='L2211'></a>  2211                            dpyinfo-&gt;Xatom_MOTIF_DRAG_TARGETS,
<a id='L2212' name='L2212'></a>  2212                            0L, LONG_MAX, False,
<a id='L2213' name='L2213'></a>  2213                            dpyinfo-&gt;Xatom_MOTIF_DRAG_TARGETS,
<a id='L2214' name='L2214'></a>  2214                            &amp;actual_type, &amp;actual_format, &amp;nitems,
<a id='L2215' name='L2215'></a>  2215                            &amp;bytes_remaining, &amp;tmp_data) == Success;
<a id='L2216' name='L2216'></a>  2216   had_errors = x_had_errors_p (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L2217' name='L2217'></a>  2217   x_uncatch_errors_after_check ();
<a id='L2218' name='L2218'></a>  2218 
<a id='L2219' name='L2219'></a>  2219   <em class='comment'>/* The drag window is probably invalid, so remove our record of</em>
<a id='L2220' name='L2220'></a>  2220 <em class='comment'>     it.  */</em>
<a id='L2221' name='L2221'></a>  2221   <strong class='reserved'>if</strong> (had_errors)
<a id='L2222' name='L2222'></a>  2222     <em class='brace'>{</em>
<a id='L2223' name='L2223'></a>  2223       dpyinfo-&gt;motif_drag_window = None;
<a id='L2224' name='L2224'></a>  2224       XUngrabServer (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L2225' name='L2225'></a>  2225 
<a id='L2226' name='L2226'></a>  2226       <strong class='reserved'>goto</strong> retry_drag_window;
<a id='L2227' name='L2227'></a>  2227     <em class='brace'>}</em>
<a id='L2228' name='L2228'></a>  2228 
<a id='L2229' name='L2229'></a>  2229   <strong class='reserved'>if</strong> (rc &amp;&amp; tmp_data &amp;&amp; !bytes_remaining
<a id='L2230' name='L2230'></a>  2230       &amp;&amp; actual_type == dpyinfo-&gt;Xatom_MOTIF_DRAG_TARGETS
<a id='L2231' name='L2231'></a>  2231       &amp;&amp; actual_format == 8)
<a id='L2232' name='L2232'></a>  2232     <em class='brace'>{</em>
<a id='L2233' name='L2233'></a>  2233       data = (<a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> *) tmp_data;
<a id='L2234' name='L2234'></a>  2234       <strong class='reserved'>if</strong> (<a href='../S/2289.html#L1803' title='Defined at 1803 in src/xterm.c.'>xm_read_targets_table_header</a> ((<a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> *) tmp_data,
<a id='L2235' name='L2235'></a>  2235                                         nitems, &amp;header,
<a id='L2236' name='L2236'></a>  2236                                         &amp;byteorder) == 8)
<a id='L2237' name='L2237'></a>  2237         <em class='brace'>{</em>
<a id='L2238' name='L2238'></a>  2238           data += 8;
<a id='L2239' name='L2239'></a>  2239           nitems -= 8;
<a id='L2240' name='L2240'></a>  2240           total_bytes = 0;
<a id='L2241' name='L2241'></a>  2241           total_items = 0;
<a id='L2242' name='L2242'></a>  2242 
<a id='L2243' name='L2243'></a>  2243           <em class='comment'>/* The extra rec is used to store a new target list if a</em>
<a id='L2244' name='L2244'></a>  2244 <em class='comment'>             preexisting one doesn't already exist.  */</em>
<a id='L2245' name='L2245'></a>  2245           recs = <a href='../D/20068.html' title='Multiple defined in 10 places.'>xmalloc</a> ((header.target_list_count + 1)
<a id='L2246' name='L2246'></a>  2246                           * <strong class='reserved'>sizeof</strong> *recs);
<a id='L2247' name='L2247'></a>  2247 
<a id='L2248' name='L2248'></a>  2248           <strong class='reserved'>while</strong> (total_items &lt; header.target_list_count)
<a id='L2249' name='L2249'></a>  2249             <em class='brace'>{</em>
<a id='L2250' name='L2250'></a>  2250               recs[total_items] = <a href='../S/2289.html#L1828' title='Defined at 1828 in src/xterm.c.'>xm_read_targets_table_rec</a> (data + total_bytes,
<a id='L2251' name='L2251'></a>  2251                                                              nitems, byteorder);
<a id='L2252' name='L2252'></a>  2252 
<a id='L2253' name='L2253'></a>  2253               <strong class='reserved'>if</strong> (!recs[total_items])
<a id='L2254' name='L2254'></a>  2254                 <strong class='reserved'>break</strong>;
<a id='L2255' name='L2255'></a>  2255 
<a id='L2256' name='L2256'></a>  2256               total_bytes += 2 + recs[total_items]-&gt;n_targets * 4;
<a id='L2257' name='L2257'></a>  2257               nitems -= 2 + recs[total_items]-&gt;n_targets * 4;
<a id='L2258' name='L2258'></a>  2258               total_items++;
<a id='L2259' name='L2259'></a>  2259             <em class='brace'>}</em>
<a id='L2260' name='L2260'></a>  2260 
<a id='L2261' name='L2261'></a>  2261           <strong class='reserved'>if</strong> (header.target_list_count != total_items
<a id='L2262' name='L2262'></a>  2262               || header.total_data_size != 8 + total_bytes)
<a id='L2263' name='L2263'></a>  2263             <em class='brace'>{</em>
<a id='L2264' name='L2264'></a>  2264               <strong class='reserved'>for</strong> (i = 0; i &lt; total_items; ++i)
<a id='L2265' name='L2265'></a>  2265                 <em class='brace'>{</em>
<a id='L2266' name='L2266'></a>  2266                   <strong class='reserved'>if</strong> (recs[i])
<a id='L2267' name='L2267'></a>  2267                       <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (recs[i]);
<a id='L2268' name='L2268'></a>  2268                   <strong class='reserved'>else</strong>
<a id='L2269' name='L2269'></a>  2269                     <strong class='reserved'>break</strong>;
<a id='L2270' name='L2270'></a>  2270                 <em class='brace'>}</em>
<a id='L2271' name='L2271'></a>  2271 
<a id='L2272' name='L2272'></a>  2272               <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (recs);
<a id='L2273' name='L2273'></a>  2273 
<a id='L2274' name='L2274'></a>  2274               rc = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L2275' name='L2275'></a>  2275             <em class='brace'>}</em>
<a id='L2276' name='L2276'></a>  2276         <em class='brace'>}</em>
<a id='L2277' name='L2277'></a>  2277       <strong class='reserved'>else</strong>
<a id='L2278' name='L2278'></a>  2278         rc = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L2279' name='L2279'></a>  2279     <em class='brace'>}</em>
<a id='L2280' name='L2280'></a>  2280   <strong class='reserved'>else</strong>
<a id='L2281' name='L2281'></a>  2281     rc = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L2282' name='L2282'></a>  2282 
<a id='L2283' name='L2283'></a>  2283   <strong class='reserved'>if</strong> (tmp_data)
<a id='L2284' name='L2284'></a>  2284     XFree (tmp_data);
<a id='L2285' name='L2285'></a>  2285 
<a id='L2286' name='L2286'></a>  2286   <em class='comment'>/* Now rc means whether or not the target lists weren't updated and</em>
<a id='L2287' name='L2287'></a>  2287 <em class='comment'>     shouldn't be written to the drag window.  */</em>
<a id='L2288' name='L2288'></a>  2288 
<a id='L2289' name='L2289'></a>  2289   <strong class='reserved'>if</strong> (!rc)
<a id='L2290' name='L2290'></a>  2290     <em class='brace'>{</em>
<a id='L2291' name='L2291'></a>  2291       header.byte_order = <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>;
<a id='L2292' name='L2292'></a>  2292       header.protocol = <a href='../S/2289.html#L1763' title='Defined at 1763 in src/xterm.c.'>XM_DRAG_PROTOCOL_VERSION</a>;
<a id='L2293' name='L2293'></a>  2293       header.target_list_count = 1;
<a id='L2294' name='L2294'></a>  2294       header.total_data_size = 8 + 2 + ntargets * 4;
<a id='L2295' name='L2295'></a>  2295 
<a id='L2296' name='L2296'></a>  2296       recs = <a href='../D/20068.html' title='Multiple defined in 10 places.'>xmalloc</a> (<strong class='reserved'>sizeof</strong> *recs);
<a id='L2297' name='L2297'></a>  2297       recs[0] = <a href='../D/20068.html' title='Multiple defined in 10 places.'>xmalloc</a> (<a href='../S/2854.html#L63' title='Defined at 63 in lib/flexmember.h.'>FLEXSIZEOF</a> (<strong class='reserved'>struct</strong> <a href='../D/20052.html' title='Multiple defined in 2 places.'>xm_targets_table_rec</a>,
<a id='L2298' name='L2298'></a>  2298                                      targets, ntargets * 4));
<a id='L2299' name='L2299'></a>  2299 
<a id='L2300' name='L2300'></a>  2300       recs[0]-&gt;n_targets = ntargets;
<a id='L2301' name='L2301'></a>  2301 
<a id='L2302' name='L2302'></a>  2302       <strong class='reserved'>for</strong> (i = 0; i &lt; ntargets; ++i)
<a id='L2303' name='L2303'></a>  2303         recs[0]-&gt;targets[i] = targets_sorted[i];
<a id='L2304' name='L2304'></a>  2304 
<a id='L2305' name='L2305'></a>  2305       idx = 0;
<a id='L2306' name='L2306'></a>  2306     <em class='brace'>}</em>
<a id='L2307' name='L2307'></a>  2307   <strong class='reserved'>else</strong>
<a id='L2308' name='L2308'></a>  2308     <em class='brace'>{</em>
<a id='L2309' name='L2309'></a>  2309       idx = <a href='../S/2289.html#L1861' title='Defined at 1861 in src/xterm.c.'>xm_find_targets_table_idx</a> (&amp;header, recs,
<a id='L2310' name='L2310'></a>  2310                                        targets_sorted,
<a id='L2311' name='L2311'></a>  2311                                        ntargets);
<a id='L2312' name='L2312'></a>  2312 
<a id='L2313' name='L2313'></a>  2313       <strong class='reserved'>if</strong> (idx == -1)
<a id='L2314' name='L2314'></a>  2314         <em class='brace'>{</em>
<a id='L2315' name='L2315'></a>  2315           target_count = header.target_list_count;
<a id='L2316' name='L2316'></a>  2316           rc = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L2317' name='L2317'></a>  2317 
<a id='L2318' name='L2318'></a>  2318           <strong class='reserved'>if</strong> (<a href='../S/2699.html#L31' title='Defined at 31 in lib/stdckdint.in.h.'>ckd_add</a> (&amp;header.target_list_count, header.target_list_count, 1)
<a id='L2319' name='L2319'></a>  2319               || <a href='../S/2699.html#L33' title='Defined at 33 in lib/stdckdint.in.h.'>ckd_mul</a> (&amp;<a href='../D/17482.html' title='Multiple defined in 5 places.'>size</a>, ntargets, 4)
<a id='L2320' name='L2320'></a>  2320               || <a href='../S/2699.html#L31' title='Defined at 31 in lib/stdckdint.in.h.'>ckd_add</a> (&amp;header.total_data_size, header.total_data_size, <a href='../D/17482.html' title='Multiple defined in 5 places.'>size</a>)
<a id='L2321' name='L2321'></a>  2321               || <a href='../S/2699.html#L31' title='Defined at 31 in lib/stdckdint.in.h.'>ckd_add</a> (&amp;header.total_data_size, header.total_data_size, 2))
<a id='L2322' name='L2322'></a>  2322             <em class='brace'>{</em>
<a id='L2323' name='L2323'></a>  2323               <em class='comment'>/* Overflow, remove every entry from the targets table</em>
<a id='L2324' name='L2324'></a>  2324 <em class='comment'>                 and add one for our current targets list.  This</em>
<a id='L2325' name='L2325'></a>  2325 <em class='comment'>                 confuses real Motif but not GTK 2.x, and there is no</em>
<a id='L2326' name='L2326'></a>  2326 <em class='comment'>                 other choice.  */</em>
<a id='L2327' name='L2327'></a>  2327 
<a id='L2328' name='L2328'></a>  2328               <strong class='reserved'>for</strong> (i = 0; i &lt; target_count; ++i)
<a id='L2329' name='L2329'></a>  2329                 <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (recs[i]);
<a id='L2330' name='L2330'></a>  2330 
<a id='L2331' name='L2331'></a>  2331               <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (recs);
<a id='L2332' name='L2332'></a>  2332 
<a id='L2333' name='L2333'></a>  2333               header.byte_order = <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>;
<a id='L2334' name='L2334'></a>  2334               header.protocol = <a href='../S/2289.html#L1763' title='Defined at 1763 in src/xterm.c.'>XM_DRAG_PROTOCOL_VERSION</a>;
<a id='L2335' name='L2335'></a>  2335               header.target_list_count = 1;
<a id='L2336' name='L2336'></a>  2336               header.total_data_size = 8 + 2 + ntargets * 4;
<a id='L2337' name='L2337'></a>  2337 
<a id='L2338' name='L2338'></a>  2338               recs = <a href='../D/20068.html' title='Multiple defined in 10 places.'>xmalloc</a> (<strong class='reserved'>sizeof</strong> *recs);
<a id='L2339' name='L2339'></a>  2339               recs[0] = <a href='../D/20068.html' title='Multiple defined in 10 places.'>xmalloc</a> (<a href='../S/2854.html#L63' title='Defined at 63 in lib/flexmember.h.'>FLEXSIZEOF</a> (<strong class='reserved'>struct</strong> <a href='../D/20052.html' title='Multiple defined in 2 places.'>xm_targets_table_rec</a>,
<a id='L2340' name='L2340'></a>  2340                                              targets, ntargets * 4));
<a id='L2341' name='L2341'></a>  2341 
<a id='L2342' name='L2342'></a>  2342               recs[0]-&gt;n_targets = ntargets;
<a id='L2343' name='L2343'></a>  2343 
<a id='L2344' name='L2344'></a>  2344               <strong class='reserved'>for</strong> (i = 0; i &lt; ntargets; ++i)
<a id='L2345' name='L2345'></a>  2345                 recs[0]-&gt;targets[i] = targets_sorted[i];
<a id='L2346' name='L2346'></a>  2346 
<a id='L2347' name='L2347'></a>  2347               idx = 0;
<a id='L2348' name='L2348'></a>  2348             <em class='brace'>}</em>
<a id='L2349' name='L2349'></a>  2349           <strong class='reserved'>else</strong>
<a id='L2350' name='L2350'></a>  2350             <em class='brace'>{</em>
<a id='L2351' name='L2351'></a>  2351               recs[header.target_list_count - 1]
<a id='L2352' name='L2352'></a>  2352                 = <a href='../D/20068.html' title='Multiple defined in 10 places.'>xmalloc</a> (<a href='../S/2854.html#L63' title='Defined at 63 in lib/flexmember.h.'>FLEXSIZEOF</a> (<strong class='reserved'>struct</strong> <a href='../D/20052.html' title='Multiple defined in 2 places.'>xm_targets_table_rec</a>,
<a id='L2353' name='L2353'></a>  2353                                        targets, ntargets * 4));
<a id='L2354' name='L2354'></a>  2354               recs[header.target_list_count - 1]-&gt;n_targets = ntargets;
<a id='L2355' name='L2355'></a>  2355 
<a id='L2356' name='L2356'></a>  2356               <strong class='reserved'>for</strong> (i = 0; i &lt; ntargets; ++i)
<a id='L2357' name='L2357'></a>  2357                 recs[header.target_list_count - 1]-&gt;targets[i] = targets_sorted[i];
<a id='L2358' name='L2358'></a>  2358 
<a id='L2359' name='L2359'></a>  2359               idx = header.target_list_count - 1;
<a id='L2360' name='L2360'></a>  2360             <em class='brace'>}</em>
<a id='L2361' name='L2361'></a>  2361         <em class='brace'>}</em>
<a id='L2362' name='L2362'></a>  2362     <em class='brace'>}</em>
<a id='L2363' name='L2363'></a>  2363 
<a id='L2364' name='L2364'></a>  2364   <strong class='reserved'>if</strong> (!rc)
<a id='L2365' name='L2365'></a>  2365     <em class='brace'>{</em>
<a id='L2366' name='L2366'></a>  2366       <em class='comment'>/* Some implementations of Motif DND set the protocol version of</em>
<a id='L2367' name='L2367'></a>  2367 <em class='comment'>         just the targets table to 1 without actually changing the</em>
<a id='L2368' name='L2368'></a>  2368 <em class='comment'>         data format.  To avoid confusing Motif when that happens, set</em>
<a id='L2369' name='L2369'></a>  2369 <em class='comment'>         it back to 0.  There will probably be no more updates to the</em>
<a id='L2370' name='L2370'></a>  2370 <em class='comment'>         protocol either.  */</em>
<a id='L2371' name='L2371'></a>  2371       header.protocol = <a href='../S/2289.html#L1763' title='Defined at 1763 in src/xterm.c.'>XM_DRAG_PROTOCOL_VERSION</a>;
<a id='L2372' name='L2372'></a>  2372 
<a id='L2373' name='L2373'></a>  2373       x_catch_errors (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L2374' name='L2374'></a>  2374       <a href='../S/2289.html#L1892' title='Defined at 1892 in src/xterm.c.'>xm_write_targets_table</a> (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, drag_window,
<a id='L2375' name='L2375'></a>  2375                               dpyinfo-&gt;Xatom_MOTIF_DRAG_TARGETS,
<a id='L2376' name='L2376'></a>  2376                               &amp;header, recs);
<a id='L2377' name='L2377'></a>  2377       <em class='comment'>/* Presumably we got a BadAlloc upon writing the targets</em>
<a id='L2378' name='L2378'></a>  2378 <em class='comment'>         table.  */</em>
<a id='L2379' name='L2379'></a>  2379       <strong class='reserved'>if</strong> (x_had_errors_p (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>))
<a id='L2380' name='L2380'></a>  2380         idx = -1;
<a id='L2381' name='L2381'></a>  2381       x_uncatch_errors_after_check ();
<a id='L2382' name='L2382'></a>  2382     <em class='brace'>}</em>
<a id='L2383' name='L2383'></a>  2383 
<a id='L2384' name='L2384'></a>  2384   XUngrabServer (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L2385' name='L2385'></a>  2385 
<a id='L2386' name='L2386'></a>  2386   <strong class='reserved'>for</strong> (i = 0; i &lt; header.target_list_count; ++i)
<a id='L2387' name='L2387'></a>  2387     <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (recs[i]);
<a id='L2388' name='L2388'></a>  2388 
<a id='L2389' name='L2389'></a>  2389   <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (recs);
<a id='L2390' name='L2390'></a>  2390   <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (targets_sorted);
<a id='L2391' name='L2391'></a>  2391 
<a id='L2392' name='L2392'></a>  2392   <strong class='reserved'>return</strong> idx;
<a id='L2393' name='L2393'></a>  2393 <em class='brace'>}</em>
<a id='L2394' name='L2394'></a>  2394 
<a id='L2395' name='L2395'></a>  2395 <em class='comment'>/* Allocate an atom that will be used for the Motif selection during</em>
<a id='L2396' name='L2396'></a>  2396 <em class='comment'>   the drag-and-drop operation.</em>
<a id='L2397' name='L2397'></a>  2397 <em class='comment'></em>
<a id='L2398' name='L2398'></a>  2398 <em class='comment'>   Grab the server, and then retrieve a list of atoms named</em>
<a id='L2399' name='L2399'></a>  2399 <em class='comment'>   _EMACS_DRAG_ATOM from the root window.  Find the first atom that</em>
<a id='L2400' name='L2400'></a>  2400 <em class='comment'>   has no selection owner, own it and return it.  If there is no such</em>
<a id='L2401' name='L2401'></a>  2401 <em class='comment'>   atom, add a unique atom to the end of the list and return that</em>
<a id='L2402' name='L2402'></a>  2402 <em class='comment'>   instead.  */</em>
<a id='L2403' name='L2403'></a>  2403 
<a id='L2404' name='L2404'></a>  2404 <strong class='reserved'>static</strong> Atom
<a id='L2405' name='L2405'></a>  2405 <a href='../S/2289.html#L2521' title='Referred from 2521 in src/xterm.c.'>xm_get_drag_atom_1</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L2406' name='L2406'></a>  2406                     <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *source_frame)
<a id='L2407' name='L2407'></a>  2407 <em class='brace'>{</em>
<a id='L2408' name='L2408'></a>  2408   Atom actual_type, *atoms, atom;
<a id='L2409' name='L2409'></a>  2409   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> nitems, bytes_remaining;
<a id='L2410' name='L2410'></a>  2410   <strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *tmp_data;
<a id='L2411' name='L2411'></a>  2411   <strong class='reserved'>int</strong> rc, actual_format;
<a id='L2412' name='L2412'></a>  2412   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> i;
<a id='L2413' name='L2413'></a>  2413   <strong class='reserved'>char</strong> *<a href='../S/2130.html#L305' title='Defined at 305 in src/buffer.h.'>buffer</a>;
<a id='L2414' name='L2414'></a>  2414   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> owner;
<a id='L2415' name='L2415'></a>  2415 
<a id='L2416' name='L2416'></a>  2416   <em class='comment'>/* Make sure this operation is done atomically.  */</em>
<a id='L2417' name='L2417'></a>  2417   XGrabServer (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L2418' name='L2418'></a>  2418 
<a id='L2419' name='L2419'></a>  2419   rc = XGetWindowProperty (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, dpyinfo-&gt;root_window,
<a id='L2420' name='L2420'></a>  2420                            dpyinfo-&gt;Xatom_EMACS_DRAG_ATOM,
<a id='L2421' name='L2421'></a>  2421                            0, LONG_MAX, False, XA_ATOM, &amp;actual_type,
<a id='L2422' name='L2422'></a>  2422                            &amp;actual_format, &amp;nitems, &amp;bytes_remaining,
<a id='L2423' name='L2423'></a>  2423                            &amp;tmp_data);
<a id='L2424' name='L2424'></a>  2424   atom = None;
<a id='L2425' name='L2425'></a>  2425   <em class='comment'>/* GCC thinks i is used uninitialized, but it's always initialized if</em>
<a id='L2426' name='L2426'></a>  2426 <em class='comment'>     `atoms' exists at that particular spot.  */</em>
<a id='L2427' name='L2427'></a>  2427   i = 0;
<a id='L2428' name='L2428'></a>  2428 
<a id='L2429' name='L2429'></a>  2429   <strong class='reserved'>if</strong> (rc == Success
<a id='L2430' name='L2430'></a>  2430       &amp;&amp; actual_format == 32 &amp;&amp; nitems
<a id='L2431' name='L2431'></a>  2431       &amp;&amp; actual_type == XA_ATOM)
<a id='L2432' name='L2432'></a>  2432     <em class='brace'>{</em>
<a id='L2433' name='L2433'></a>  2433       atoms = (Atom *) tmp_data;
<a id='L2434' name='L2434'></a>  2434 
<a id='L2435' name='L2435'></a>  2435       x_catch_errors (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L2436' name='L2436'></a>  2436 
<a id='L2437' name='L2437'></a>  2437       <strong class='reserved'>for</strong> (i = 0; i &lt; nitems; ++i)
<a id='L2438' name='L2438'></a>  2438         <em class='brace'>{</em>
<a id='L2439' name='L2439'></a>  2439           owner = XGetSelectionOwner (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, atoms[i]);
<a id='L2440' name='L2440'></a>  2440 
<a id='L2441' name='L2441'></a>  2441           <strong class='reserved'>if</strong> (!x_had_errors_p (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>)
<a id='L2442' name='L2442'></a>  2442               &amp;&amp; (owner == None
<a id='L2443' name='L2443'></a>  2443                   <em class='comment'>/* If we already own this selection (even if another</em>
<a id='L2444' name='L2444'></a>  2444 <em class='comment'>                     frame owns it), use it.  There is no way of</em>
<a id='L2445' name='L2445'></a>  2445 <em class='comment'>                     knowing when ownership was asserted, so it still</em>
<a id='L2446' name='L2446'></a>  2446 <em class='comment'>                     has to be owned again.  */</em>
<a id='L2447' name='L2447'></a>  2447                   || <a href='../S/2289.html#L11957' title='Defined at 11957 in src/xterm.c.'>x_window_to_frame</a> (dpyinfo, owner)))
<a id='L2448' name='L2448'></a>  2448             <em class='brace'>{</em>
<a id='L2449' name='L2449'></a>  2449               atom = atoms[i];
<a id='L2450' name='L2450'></a>  2450 
<a id='L2451' name='L2451'></a>  2451               <strong class='reserved'>break</strong>;
<a id='L2452' name='L2452'></a>  2452             <em class='brace'>}</em>
<a id='L2453' name='L2453'></a>  2453         <em class='brace'>}</em>
<a id='L2454' name='L2454'></a>  2454 
<a id='L2455' name='L2455'></a>  2455       x_uncatch_errors ();
<a id='L2456' name='L2456'></a>  2456     <em class='brace'>}</em>
<a id='L2457' name='L2457'></a>  2457 
<a id='L2458' name='L2458'></a>  2458   <strong class='reserved'>if</strong> (tmp_data)
<a id='L2459' name='L2459'></a>  2459     XFree (tmp_data);
<a id='L2460' name='L2460'></a>  2460 
<a id='L2461' name='L2461'></a>  2461   <a href='../S/2130.html#L305' title='Defined at 305 in src/buffer.h.'>buffer</a> = dpyinfo-&gt;motif_drag_atom_name;
<a id='L2462' name='L2462'></a>  2462 
<a id='L2463' name='L2463'></a>  2463   <strong class='reserved'>if</strong> (atom)
<a id='L2464' name='L2464'></a>  2464     <em class='brace'>{</em>
<a id='L2465' name='L2465'></a>  2465       <a href='../D/17583.html' title='Multiple defined in 3 places.'>sprintf</a> (<a href='../S/2130.html#L305' title='Defined at 305 in src/buffer.h.'>buffer</a>, "_EMACS_ATOM_%lu", i + 1);
<a id='L2466' name='L2466'></a>  2466       XSetSelectionOwner (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, atom,
<a id='L2467' name='L2467'></a>  2467                           <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (source_frame),
<a id='L2468' name='L2468'></a>  2468                           dpyinfo-&gt;last_user_time);
<a id='L2469' name='L2469'></a>  2469 
<a id='L2470' name='L2470'></a>  2470       <em class='comment'>/* The selection's last-change time is newer than our</em>
<a id='L2471' name='L2471'></a>  2471 <em class='comment'>         last_user_time, so create a new selection instead.  */</em>
<a id='L2472' name='L2472'></a>  2472       <strong class='reserved'>if</strong> (XGetSelectionOwner (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, atom)
<a id='L2473' name='L2473'></a>  2473           != <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (source_frame))
<a id='L2474' name='L2474'></a>  2474         atom = None;
<a id='L2475' name='L2475'></a>  2475     <em class='brace'>}</em>
<a id='L2476' name='L2476'></a>  2476 
<a id='L2477' name='L2477'></a>  2477   <strong class='reserved'>while</strong> (!atom)
<a id='L2478' name='L2478'></a>  2478     <em class='brace'>{</em>
<a id='L2479' name='L2479'></a>  2479       <a href='../D/17583.html' title='Multiple defined in 3 places.'>sprintf</a> (<a href='../S/2130.html#L305' title='Defined at 305 in src/buffer.h.'>buffer</a>, "_EMACS_ATOM_%lu", nitems + 1);
<a id='L2480' name='L2480'></a>  2480       atom = XInternAtom (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../S/2130.html#L305' title='Defined at 305 in src/buffer.h.'>buffer</a>, False);
<a id='L2481' name='L2481'></a>  2481 
<a id='L2482' name='L2482'></a>  2482       XSetSelectionOwner (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, atom,
<a id='L2483' name='L2483'></a>  2483                           <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (source_frame),
<a id='L2484' name='L2484'></a>  2484                           dpyinfo-&gt;last_user_time);
<a id='L2485' name='L2485'></a>  2485 
<a id='L2486' name='L2486'></a>  2486       XChangeProperty (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, dpyinfo-&gt;root_window,
<a id='L2487' name='L2487'></a>  2487                        dpyinfo-&gt;Xatom_EMACS_DRAG_ATOM, XA_ATOM, 32,
<a id='L2488' name='L2488'></a>  2488                        (rc != Success
<a id='L2489' name='L2489'></a>  2489                         || (actual_format != 32
<a id='L2490' name='L2490'></a>  2490                             || actual_type != XA_ATOM)
<a id='L2491' name='L2491'></a>  2491                         ? PropModeReplace : PropModeAppend),
<a id='L2492' name='L2492'></a>  2492                        (<strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *) &amp;atom, 1);
<a id='L2493' name='L2493'></a>  2493 
<a id='L2494' name='L2494'></a>  2494       actual_format = 32;
<a id='L2495' name='L2495'></a>  2495       actual_type = XA_ATOM;
<a id='L2496' name='L2496'></a>  2496       rc = Success;
<a id='L2497' name='L2497'></a>  2497       nitems += 1;
<a id='L2498' name='L2498'></a>  2498 
<a id='L2499' name='L2499'></a>  2499       <em class='comment'>/* The selection's last-change time is newer than our</em>
<a id='L2500' name='L2500'></a>  2500 <em class='comment'>         last_user_time, so create a new selection (again).  */</em>
<a id='L2501' name='L2501'></a>  2501       <strong class='reserved'>if</strong> (XGetSelectionOwner (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, atom)
<a id='L2502' name='L2502'></a>  2502           != <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (source_frame))
<a id='L2503' name='L2503'></a>  2503         atom = None;
<a id='L2504' name='L2504'></a>  2504     <em class='brace'>}</em>
<a id='L2505' name='L2505'></a>  2505 
<a id='L2506' name='L2506'></a>  2506   dpyinfo-&gt;motif_drag_atom_time = dpyinfo-&gt;last_user_time;
<a id='L2507' name='L2507'></a>  2507   dpyinfo-&gt;motif_drag_atom_owner = source_frame;
<a id='L2508' name='L2508'></a>  2508 
<a id='L2509' name='L2509'></a>  2509   XUngrabServer (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L2510' name='L2510'></a>  2510   <strong class='reserved'>return</strong> atom;
<a id='L2511' name='L2511'></a>  2511 <em class='brace'>}</em>
<a id='L2512' name='L2512'></a>  2512 
<a id='L2513' name='L2513'></a>  2513 <strong class='reserved'>static</strong> Atom
<a id='L2514' name='L2514'></a>  2514 <a href='../S/2289.html#L2535' title='Referred from 2535 in src/xterm.c.'>xm_get_drag_atom</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo)
<a id='L2515' name='L2515'></a>  2515 <em class='brace'>{</em>
<a id='L2516' name='L2516'></a>  2516   Atom atom;
<a id='L2517' name='L2517'></a>  2517 
<a id='L2518' name='L2518'></a>  2518   <strong class='reserved'>if</strong> (dpyinfo-&gt;motif_drag_atom != None)
<a id='L2519' name='L2519'></a>  2519     atom = dpyinfo-&gt;motif_drag_atom;
<a id='L2520' name='L2520'></a>  2520   <strong class='reserved'>else</strong>
<a id='L2521' name='L2521'></a>  2521     atom = <a href='../S/2289.html#L2405' title='Defined at 2405 in src/xterm.c.'>xm_get_drag_atom_1</a> (dpyinfo, x_dnd_frame);
<a id='L2522' name='L2522'></a>  2522 
<a id='L2523' name='L2523'></a>  2523   dpyinfo-&gt;motif_drag_atom = atom;
<a id='L2524' name='L2524'></a>  2524   <strong class='reserved'>return</strong> atom;
<a id='L2525' name='L2525'></a>  2525 <em class='brace'>}</em>
<a id='L2526' name='L2526'></a>  2526 
<a id='L2527' name='L2527'></a>  2527 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L2528' name='L2528'></a>  2528 <a href='../R/18665.html' title='Multiple referred from 14 places.'>xm_setup_drag_info</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L2529' name='L2529'></a>  2529                     <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *source_frame)
<a id='L2530' name='L2530'></a>  2530 <em class='brace'>{</em>
<a id='L2531' name='L2531'></a>  2531   Atom atom;
<a id='L2532' name='L2532'></a>  2532   <a href='../D/20007.html' title='Multiple defined in 2 places.'>xm_drag_initiator_info</a> drag_initiator_info;
<a id='L2533' name='L2533'></a>  2533   <strong class='reserved'>int</strong> idx;
<a id='L2534' name='L2534'></a>  2534 
<a id='L2535' name='L2535'></a>  2535   atom = <a href='../S/2289.html#L2514' title='Defined at 2514 in src/xterm.c.'>xm_get_drag_atom</a> (dpyinfo);
<a id='L2536' name='L2536'></a>  2536 
<a id='L2537' name='L2537'></a>  2537   <strong class='reserved'>if</strong> (atom == None)
<a id='L2538' name='L2538'></a>  2538     <strong class='reserved'>return</strong>;
<a id='L2539' name='L2539'></a>  2539 
<a id='L2540' name='L2540'></a>  2540   <a href='../S/2267.html#L1528' title='Defined at 1528 in src/lisp.h.'>XSETCAR</a> (x_dnd_selection_alias_cell,
<a id='L2541' name='L2541'></a>  2541            <a href='../S/2281.html#L191' title='Defined at 191 in src/xselect.c.'>x_atom_to_symbol</a> (dpyinfo, atom));
<a id='L2542' name='L2542'></a>  2542   <a href='../D/7333.html' title='Multiple defined in 2 places.'>XSETCDR</a> (x_dnd_selection_alias_cell, QXdndSelection);
<a id='L2543' name='L2543'></a>  2543 
<a id='L2544' name='L2544'></a>  2544   idx = <a href='../S/2289.html#L2178' title='Defined at 2178 in src/xterm.c.'>xm_setup_dnd_targets</a> (dpyinfo, x_dnd_targets,
<a id='L2545' name='L2545'></a>  2545                               x_dnd_n_targets);
<a id='L2546' name='L2546'></a>  2546 
<a id='L2547' name='L2547'></a>  2547   <strong class='reserved'>if</strong> (idx != -1)
<a id='L2548' name='L2548'></a>  2548     <em class='brace'>{</em>
<a id='L2549' name='L2549'></a>  2549       drag_initiator_info.byteorder = <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>;
<a id='L2550' name='L2550'></a>  2550       drag_initiator_info.protocol = <a href='../S/2289.html#L1763' title='Defined at 1763 in src/xterm.c.'>XM_DRAG_PROTOCOL_VERSION</a>;
<a id='L2551' name='L2551'></a>  2551       drag_initiator_info.table_index = idx;
<a id='L2552' name='L2552'></a>  2552       drag_initiator_info.<a href='../S/2073.html#L63' title='Defined at 63 in lwlib/lwlib-Xm.c.'>selection</a> = atom;
<a id='L2553' name='L2553'></a>  2553 
<a id='L2554' name='L2554'></a>  2554       <a href='../S/2289.html#L1939' title='Defined at 1939 in src/xterm.c.'>xm_write_drag_initiator_info</a> (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L2555' name='L2555'></a>  2555                                     <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (source_frame), atom,
<a id='L2556' name='L2556'></a>  2556                                     dpyinfo-&gt;Xatom_MOTIF_DRAG_INITIATOR_INFO,
<a id='L2557' name='L2557'></a>  2557                                     &amp;drag_initiator_info);
<a id='L2558' name='L2558'></a>  2558 
<a id='L2559' name='L2559'></a>  2559       x_dnd_motif_setup_p = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L2560' name='L2560'></a>  2560       x_dnd_motif_atom = atom;
<a id='L2561' name='L2561'></a>  2561     <em class='brace'>}</em>
<a id='L2562' name='L2562'></a>  2562 <em class='brace'>}</em>
<a id='L2563' name='L2563'></a>  2563 
<a id='L2564' name='L2564'></a>  2564 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L2565' name='L2565'></a>  2565 <a href='../R/18659.html' title='Multiple referred from 7 places.'>xm_send_drop_message</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> source,
<a id='L2566' name='L2566'></a>  2566                       <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> target, <a href='../D/20018.html' title='Multiple defined in 2 places.'>xm_drop_start_message</a> *dmsg)
<a id='L2567' name='L2567'></a>  2567 <em class='brace'>{</em>
<a id='L2568' name='L2568'></a>  2568   XEvent msg;
<a id='L2569' name='L2569'></a>  2569 
<a id='L2570' name='L2570'></a>  2570   msg.xclient.type = ClientMessage;
<a id='L2571' name='L2571'></a>  2571   msg.xclient.message_type
<a id='L2572' name='L2572'></a>  2572     = dpyinfo-&gt;Xatom_MOTIF_DRAG_AND_DROP_MESSAGE;
<a id='L2573' name='L2573'></a>  2573   msg.xclient.format = 8;
<a id='L2574' name='L2574'></a>  2574   msg.xclient.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = target;
<a id='L2575' name='L2575'></a>  2575   msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[0] = dmsg-&gt;reason;
<a id='L2576' name='L2576'></a>  2576   msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[1] = dmsg-&gt;byte_order;
<a id='L2577' name='L2577'></a>  2577   *((<a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> *) &amp;msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[2]) = dmsg-&gt;side_effects;
<a id='L2578' name='L2578'></a>  2578   *((<a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> *) &amp;msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[4]) = dmsg-&gt;timestamp;
<a id='L2579' name='L2579'></a>  2579   *((<a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> *) &amp;msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[8]) = dmsg-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L2580' name='L2580'></a>  2580   *((<a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> *) &amp;msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[10]) = dmsg-&gt;y;
<a id='L2581' name='L2581'></a>  2581   *((<a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> *) &amp;msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[12]) = dmsg-&gt;index_atom;
<a id='L2582' name='L2582'></a>  2582   *((<a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> *) &amp;msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[16]) = dmsg-&gt;source_window;
<a id='L2583' name='L2583'></a>  2583 
<a id='L2584' name='L2584'></a>  2584   x_ignore_errors_for_next_request (dpyinfo, 0);
<a id='L2585' name='L2585'></a>  2585   XSendEvent (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, target, False, NoEventMask, &amp;msg);
<a id='L2586' name='L2586'></a>  2586   x_stop_ignoring_errors (dpyinfo);
<a id='L2587' name='L2587'></a>  2587 <em class='brace'>}</em>
<a id='L2588' name='L2588'></a>  2588 
<a id='L2589' name='L2589'></a>  2589 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L2590' name='L2590'></a>  2590 <a href='../R/18660.html' title='Multiple referred from 3 places.'>xm_send_top_level_enter_message</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> source,
<a id='L2591' name='L2591'></a>  2591                                  <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> target, <a href='../D/20053.html' title='Multiple defined in 2 places.'>xm_top_level_enter_message</a> *dmsg)
<a id='L2592' name='L2592'></a>  2592 <em class='brace'>{</em>
<a id='L2593' name='L2593'></a>  2593   XEvent msg;
<a id='L2594' name='L2594'></a>  2594 
<a id='L2595' name='L2595'></a>  2595   msg.xclient.type = ClientMessage;
<a id='L2596' name='L2596'></a>  2596   msg.xclient.message_type
<a id='L2597' name='L2597'></a>  2597     = dpyinfo-&gt;Xatom_MOTIF_DRAG_AND_DROP_MESSAGE;
<a id='L2598' name='L2598'></a>  2598   msg.xclient.format = 8;
<a id='L2599' name='L2599'></a>  2599   msg.xclient.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = target;
<a id='L2600' name='L2600'></a>  2600   msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[0] = dmsg-&gt;reason;
<a id='L2601' name='L2601'></a>  2601   msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[1] = dmsg-&gt;byteorder;
<a id='L2602' name='L2602'></a>  2602   *((<a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> *) &amp;msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[2]) = dmsg-&gt;zero;
<a id='L2603' name='L2603'></a>  2603   *((<a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> *) &amp;msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[4]) = dmsg-&gt;timestamp;
<a id='L2604' name='L2604'></a>  2604   *((<a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> *) &amp;msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[8]) = dmsg-&gt;source_window;
<a id='L2605' name='L2605'></a>  2605   *((<a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> *) &amp;msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[12]) = dmsg-&gt;index_atom;
<a id='L2606' name='L2606'></a>  2606   msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[16] = 0;
<a id='L2607' name='L2607'></a>  2607   msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[17] = 0;
<a id='L2608' name='L2608'></a>  2608   msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[18] = 0;
<a id='L2609' name='L2609'></a>  2609   msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[19] = 0;
<a id='L2610' name='L2610'></a>  2610 
<a id='L2611' name='L2611'></a>  2611   x_ignore_errors_for_next_request (dpyinfo, 0);
<a id='L2612' name='L2612'></a>  2612   XSendEvent (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, target, False, NoEventMask, &amp;msg);
<a id='L2613' name='L2613'></a>  2613   x_stop_ignoring_errors (dpyinfo);
<a id='L2614' name='L2614'></a>  2614 <em class='brace'>}</em>
<a id='L2615' name='L2615'></a>  2615 
<a id='L2616' name='L2616'></a>  2616 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L2617' name='L2617'></a>  2617 <a href='../R/18658.html' title='Multiple referred from 6 places.'>xm_send_drag_motion_message</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> source,
<a id='L2618' name='L2618'></a>  2618                              <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> target, <a href='../D/20008.html' title='Multiple defined in 2 places.'>xm_drag_motion_message</a> *dmsg)
<a id='L2619' name='L2619'></a>  2619 <em class='brace'>{</em>
<a id='L2620' name='L2620'></a>  2620   XEvent msg;
<a id='L2621' name='L2621'></a>  2621 
<a id='L2622' name='L2622'></a>  2622   msg.xclient.type = ClientMessage;
<a id='L2623' name='L2623'></a>  2623   msg.xclient.message_type
<a id='L2624' name='L2624'></a>  2624     = dpyinfo-&gt;Xatom_MOTIF_DRAG_AND_DROP_MESSAGE;
<a id='L2625' name='L2625'></a>  2625   msg.xclient.format = 8;
<a id='L2626' name='L2626'></a>  2626   msg.xclient.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = target;
<a id='L2627' name='L2627'></a>  2627   msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[0] = dmsg-&gt;reason;
<a id='L2628' name='L2628'></a>  2628   msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[1] = dmsg-&gt;byteorder;
<a id='L2629' name='L2629'></a>  2629   *((<a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> *) &amp;msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[2]) = dmsg-&gt;side_effects;
<a id='L2630' name='L2630'></a>  2630   *((<a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> *) &amp;msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[4]) = dmsg-&gt;timestamp;
<a id='L2631' name='L2631'></a>  2631   *((<a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> *) &amp;msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[8]) = dmsg-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L2632' name='L2632'></a>  2632   *((<a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> *) &amp;msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[10]) = dmsg-&gt;y;
<a id='L2633' name='L2633'></a>  2633   msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[12] = 0;
<a id='L2634' name='L2634'></a>  2634   msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[13] = 0;
<a id='L2635' name='L2635'></a>  2635   msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[14] = 0;
<a id='L2636' name='L2636'></a>  2636   msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[15] = 0;
<a id='L2637' name='L2637'></a>  2637   msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[16] = 0;
<a id='L2638' name='L2638'></a>  2638   msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[17] = 0;
<a id='L2639' name='L2639'></a>  2639   msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[18] = 0;
<a id='L2640' name='L2640'></a>  2640   msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[19] = 0;
<a id='L2641' name='L2641'></a>  2641 
<a id='L2642' name='L2642'></a>  2642   x_ignore_errors_for_next_request (dpyinfo, 0);
<a id='L2643' name='L2643'></a>  2643   XSendEvent (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, target, False, NoEventMask, &amp;msg);
<a id='L2644' name='L2644'></a>  2644   x_stop_ignoring_errors (dpyinfo);
<a id='L2645' name='L2645'></a>  2645 <em class='brace'>}</em>
<a id='L2646' name='L2646'></a>  2646 
<a id='L2647' name='L2647'></a>  2647 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L2648' name='L2648'></a>  2648 <a href='../R/18661.html' title='Multiple referred from 7 places.'>xm_send_top_level_leave_message</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> source,
<a id='L2649' name='L2649'></a>  2649                                  <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> target, <a href='../D/20054.html' title='Multiple defined in 2 places.'>xm_top_level_leave_message</a> *dmsg)
<a id='L2650' name='L2650'></a>  2650 <em class='brace'>{</em>
<a id='L2651' name='L2651'></a>  2651   XEvent msg;
<a id='L2652' name='L2652'></a>  2652   <a href='../D/20008.html' title='Multiple defined in 2 places.'>xm_drag_motion_message</a> mmsg;
<a id='L2653' name='L2653'></a>  2653 
<a id='L2654' name='L2654'></a>  2654   <em class='comment'>/* Motif support for TOP_LEVEL_LEAVE has bitrotted, since these days</em>
<a id='L2655' name='L2655'></a>  2655 <em class='comment'>     it assumes every client supports the preregister protocol style,</em>
<a id='L2656' name='L2656'></a>  2656 <em class='comment'>     but we only support drop-only and dynamic.  (Interestingly enough</em>
<a id='L2657' name='L2657'></a>  2657 <em class='comment'>     LessTif works fine.)  Sending an event with impossible</em>
<a id='L2658' name='L2658'></a>  2658 <em class='comment'>     coordinates serves to get rid of any active drop site that might</em>
<a id='L2659' name='L2659'></a>  2659 <em class='comment'>     still be around in the target drag context.  */</em>
<a id='L2660' name='L2660'></a>  2660 
<a id='L2661' name='L2661'></a>  2661   <strong class='reserved'>if</strong> (x_dnd_fix_motif_leave)
<a id='L2662' name='L2662'></a>  2662     <em class='brace'>{</em>
<a id='L2663' name='L2663'></a>  2663       mmsg.reason = <a href='../S/2289.html#L1718' title='Defined at 1718 in src/xterm.c.'>XM_DRAG_REASON</a> (<a href='../S/2289.html#L1732' title='Defined at 1732 in src/xterm.c.'>XM_DRAG_ORIGINATOR_INITIATOR</a>,
<a id='L2664' name='L2664'></a>  2664                                     <a href='../S/2289.html#L1727' title='Defined at 1727 in src/xterm.c.'>XM_DRAG_REASON_DRAG_MOTION</a>);
<a id='L2665' name='L2665'></a>  2665       mmsg.byteorder = <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>;
<a id='L2666' name='L2666'></a>  2666       mmsg.side_effects = <a href='../S/2289.html#L1689' title='Defined at 1689 in src/xterm.c.'>XM_DRAG_SIDE_EFFECT</a> (<a href='../S/2289.html#L1766' title='Defined at 1766 in src/xterm.c.'>xm_side_effect_from_action</a> (dpyinfo,
<a id='L2667' name='L2667'></a>  2667                                                                            x_dnd_wanted_action),
<a id='L2668' name='L2668'></a>  2668                                                <a href='../S/2289.html#L1758' title='Defined at 1758 in src/xterm.c.'>XM_DROP_SITE_NONE</a>, x_dnd_motif_operations,
<a id='L2669' name='L2669'></a>  2669                                                <a href='../S/2289.html#L1715' title='Defined at 1715 in src/xterm.c.'>XM_DROP_ACTION_DROP_CANCEL</a>);
<a id='L2670' name='L2670'></a>  2670       mmsg.timestamp = dmsg-&gt;timestamp;
<a id='L2671' name='L2671'></a>  2671 
<a id='L2672' name='L2672'></a>  2672       <em class='comment'>/* Use X_SHRT_MAX instead of the max value of uint16_t since</em>
<a id='L2673' name='L2673'></a>  2673 <em class='comment'>         that will be interpreted as a plausible position by Motif,</em>
<a id='L2674' name='L2674'></a>  2674 <em class='comment'>         and as such breaks if the drop target is beneath that</em>
<a id='L2675' name='L2675'></a>  2675 <em class='comment'>         position.  */</em>
<a id='L2676' name='L2676'></a>  2676       mmsg.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = <a href='../S/2212.html#L1272' title='Defined at 1272 in src/xterm.h.'>X_SHRT_MAX</a>;
<a id='L2677' name='L2677'></a>  2677       mmsg.y = <a href='../S/2212.html#L1272' title='Defined at 1272 in src/xterm.h.'>X_SHRT_MAX</a>;
<a id='L2678' name='L2678'></a>  2678 
<a id='L2679' name='L2679'></a>  2679       <a href='../S/2289.html#L2617' title='Defined at 2617 in src/xterm.c.'>xm_send_drag_motion_message</a> (dpyinfo, source, target, &amp;mmsg);
<a id='L2680' name='L2680'></a>  2680     <em class='brace'>}</em>
<a id='L2681' name='L2681'></a>  2681 
<a id='L2682' name='L2682'></a>  2682   msg.xclient.type = ClientMessage;
<a id='L2683' name='L2683'></a>  2683   msg.xclient.message_type
<a id='L2684' name='L2684'></a>  2684     = dpyinfo-&gt;Xatom_MOTIF_DRAG_AND_DROP_MESSAGE;
<a id='L2685' name='L2685'></a>  2685   msg.xclient.format = 8;
<a id='L2686' name='L2686'></a>  2686   msg.xclient.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = target;
<a id='L2687' name='L2687'></a>  2687   msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[0] = dmsg-&gt;reason;
<a id='L2688' name='L2688'></a>  2688   msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[1] = dmsg-&gt;byteorder;
<a id='L2689' name='L2689'></a>  2689   *((<a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> *) &amp;msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[2]) = dmsg-&gt;zero;
<a id='L2690' name='L2690'></a>  2690   *((<a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> *) &amp;msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[4]) = dmsg-&gt;timestamp;
<a id='L2691' name='L2691'></a>  2691   *((<a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> *) &amp;msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[8]) = dmsg-&gt;source_window;
<a id='L2692' name='L2692'></a>  2692   msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[12] = 0;
<a id='L2693' name='L2693'></a>  2693   msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[13] = 0;
<a id='L2694' name='L2694'></a>  2694   msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[14] = 0;
<a id='L2695' name='L2695'></a>  2695   msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[15] = 0;
<a id='L2696' name='L2696'></a>  2696   msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[16] = 0;
<a id='L2697' name='L2697'></a>  2697   msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[17] = 0;
<a id='L2698' name='L2698'></a>  2698   msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[18] = 0;
<a id='L2699' name='L2699'></a>  2699   msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[19] = 0;
<a id='L2700' name='L2700'></a>  2700 
<a id='L2701' name='L2701'></a>  2701   x_ignore_errors_for_next_request (dpyinfo, 0);
<a id='L2702' name='L2702'></a>  2702   XSendEvent (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, target, False, NoEventMask, &amp;msg);
<a id='L2703' name='L2703'></a>  2703   x_stop_ignoring_errors (dpyinfo);
<a id='L2704' name='L2704'></a>  2704 <em class='brace'>}</em>
<a id='L2705' name='L2705'></a>  2705 
<a id='L2706' name='L2706'></a>  2706 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L2707' name='L2707'></a>  2707 <a href='../R/18655.html' title='Multiple referred from 2 places.'>xm_read_drop_start_reply</a> (<strong class='reserved'>const</strong> XEvent *msg, <a href='../D/20019.html' title='Multiple defined in 2 places.'>xm_drop_start_reply</a> *reply)
<a id='L2708' name='L2708'></a>  2708 <em class='brace'>{</em>
<a id='L2709' name='L2709'></a>  2709   <strong class='reserved'>const</strong> <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> *data;
<a id='L2710' name='L2710'></a>  2710 
<a id='L2711' name='L2711'></a>  2711   data = (<strong class='reserved'>const</strong> <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> *) &amp;msg-&gt;xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[0];
<a id='L2712' name='L2712'></a>  2712 
<a id='L2713' name='L2713'></a>  2713   <strong class='reserved'>if</strong> ((<a href='../S/2289.html#L1719' title='Defined at 1719 in src/xterm.c.'>XM_DRAG_REASON_ORIGINATOR</a> (data[0])
<a id='L2714' name='L2714'></a>  2714        != <a href='../S/2289.html#L1733' title='Defined at 1733 in src/xterm.c.'>XM_DRAG_ORIGINATOR_RECEIVER</a>)
<a id='L2715' name='L2715'></a>  2715       || (<a href='../S/2289.html#L1720' title='Defined at 1720 in src/xterm.c.'>XM_DRAG_REASON_CODE</a> (data[0])
<a id='L2716' name='L2716'></a>  2716           != <a href='../S/2289.html#L1724' title='Defined at 1724 in src/xterm.c.'>XM_DRAG_REASON_DROP_START</a>))
<a id='L2717' name='L2717'></a>  2717     <strong class='reserved'>return</strong> 1;
<a id='L2718' name='L2718'></a>  2718 
<a id='L2719' name='L2719'></a>  2719   reply-&gt;reason = *(data++);
<a id='L2720' name='L2720'></a>  2720   reply-&gt;byte_order = *(data++);
<a id='L2721' name='L2721'></a>  2721   reply-&gt;side_effects = *(<a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> *) data;
<a id='L2722' name='L2722'></a>  2722   reply-&gt;better_x = *(<a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> *) (data + 2);
<a id='L2723' name='L2723'></a>  2723   reply-&gt;better_y = *(<a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> *) (data + 4);
<a id='L2724' name='L2724'></a>  2724 
<a id='L2725' name='L2725'></a>  2725   <strong class='reserved'>if</strong> (reply-&gt;byte_order != <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>)
<a id='L2726' name='L2726'></a>  2726     <em class='brace'>{</em>
<a id='L2727' name='L2727'></a>  2727       <a href='../D/6041.html' title='Multiple defined in 2 places.'>SWAPCARD16</a> (reply-&gt;side_effects);
<a id='L2728' name='L2728'></a>  2728       <a href='../D/6041.html' title='Multiple defined in 2 places.'>SWAPCARD16</a> (reply-&gt;better_x);
<a id='L2729' name='L2729'></a>  2729       <a href='../D/6041.html' title='Multiple defined in 2 places.'>SWAPCARD16</a> (reply-&gt;better_y);
<a id='L2730' name='L2730'></a>  2730     <em class='brace'>}</em>
<a id='L2731' name='L2731'></a>  2731 
<a id='L2732' name='L2732'></a>  2732   reply-&gt;byte_order = <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>;
<a id='L2733' name='L2733'></a>  2733 
<a id='L2734' name='L2734'></a>  2734   <strong class='reserved'>return</strong> 0;
<a id='L2735' name='L2735'></a>  2735 <em class='brace'>}</em>
<a id='L2736' name='L2736'></a>  2736 
<a id='L2737' name='L2737'></a>  2737 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L2738' name='L2738'></a>  2738 <a href='../S/2289.html#L18409' title='Referred from 18409 in src/xterm.c.'>xm_read_drop_start_message</a> (<strong class='reserved'>const</strong> XEvent *msg,
<a id='L2739' name='L2739'></a>  2739                             <a href='../D/20018.html' title='Multiple defined in 2 places.'>xm_drop_start_message</a> *dmsg)
<a id='L2740' name='L2740'></a>  2740 <em class='brace'>{</em>
<a id='L2741' name='L2741'></a>  2741   <strong class='reserved'>const</strong> <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> *data;
<a id='L2742' name='L2742'></a>  2742 
<a id='L2743' name='L2743'></a>  2743   data = (<strong class='reserved'>const</strong> <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> *) &amp;msg-&gt;xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[0];
<a id='L2744' name='L2744'></a>  2744 
<a id='L2745' name='L2745'></a>  2745   <strong class='reserved'>if</strong> ((<a href='../S/2289.html#L1719' title='Defined at 1719 in src/xterm.c.'>XM_DRAG_REASON_ORIGINATOR</a> (data[0])
<a id='L2746' name='L2746'></a>  2746        != <a href='../S/2289.html#L1732' title='Defined at 1732 in src/xterm.c.'>XM_DRAG_ORIGINATOR_INITIATOR</a>)
<a id='L2747' name='L2747'></a>  2747       || (<a href='../S/2289.html#L1720' title='Defined at 1720 in src/xterm.c.'>XM_DRAG_REASON_CODE</a> (data[0])
<a id='L2748' name='L2748'></a>  2748           != <a href='../S/2289.html#L1724' title='Defined at 1724 in src/xterm.c.'>XM_DRAG_REASON_DROP_START</a>))
<a id='L2749' name='L2749'></a>  2749     <strong class='reserved'>return</strong> 1;
<a id='L2750' name='L2750'></a>  2750 
<a id='L2751' name='L2751'></a>  2751   dmsg-&gt;reason = *(data++);
<a id='L2752' name='L2752'></a>  2752   dmsg-&gt;byte_order = *(data++);
<a id='L2753' name='L2753'></a>  2753   dmsg-&gt;side_effects = *(<a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> *) data;
<a id='L2754' name='L2754'></a>  2754   dmsg-&gt;timestamp = *(<a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> *) (data + 2);
<a id='L2755' name='L2755'></a>  2755   dmsg-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = *(<a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> *) (data + 6);
<a id='L2756' name='L2756'></a>  2756   dmsg-&gt;y = *(<a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> *) (data + 8);
<a id='L2757' name='L2757'></a>  2757   dmsg-&gt;index_atom = *(<a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> *) (data + 10);
<a id='L2758' name='L2758'></a>  2758   dmsg-&gt;source_window = *(<a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> *) (data + 14);
<a id='L2759' name='L2759'></a>  2759 
<a id='L2760' name='L2760'></a>  2760   <strong class='reserved'>if</strong> (dmsg-&gt;byte_order != <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>)
<a id='L2761' name='L2761'></a>  2761     <em class='brace'>{</em>
<a id='L2762' name='L2762'></a>  2762       <a href='../D/6041.html' title='Multiple defined in 2 places.'>SWAPCARD16</a> (dmsg-&gt;side_effects);
<a id='L2763' name='L2763'></a>  2763       <a href='../D/6042.html' title='Multiple defined in 2 places.'>SWAPCARD32</a> (dmsg-&gt;timestamp);
<a id='L2764' name='L2764'></a>  2764       <a href='../D/6041.html' title='Multiple defined in 2 places.'>SWAPCARD16</a> (dmsg-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>);
<a id='L2765' name='L2765'></a>  2765       <a href='../D/6041.html' title='Multiple defined in 2 places.'>SWAPCARD16</a> (dmsg-&gt;y);
<a id='L2766' name='L2766'></a>  2766       <a href='../D/6042.html' title='Multiple defined in 2 places.'>SWAPCARD32</a> (dmsg-&gt;index_atom);
<a id='L2767' name='L2767'></a>  2767       <a href='../D/6042.html' title='Multiple defined in 2 places.'>SWAPCARD32</a> (dmsg-&gt;source_window);
<a id='L2768' name='L2768'></a>  2768     <em class='brace'>}</em>
<a id='L2769' name='L2769'></a>  2769 
<a id='L2770' name='L2770'></a>  2770   dmsg-&gt;byte_order = <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>;
<a id='L2771' name='L2771'></a>  2771 
<a id='L2772' name='L2772'></a>  2772   <strong class='reserved'>return</strong> 0;
<a id='L2773' name='L2773'></a>  2773 <em class='brace'>}</em>
<a id='L2774' name='L2774'></a>  2774 
<a id='L2775' name='L2775'></a>  2775 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L2776' name='L2776'></a>  2776 <a href='../R/18653.html' title='Multiple referred from 4 places.'>xm_read_drag_receiver_info</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L2777' name='L2777'></a>  2777                             <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> wdesc, <a href='../D/20013.html' title='Multiple defined in 2 places.'>xm_drag_receiver_info</a> *rec)
<a id='L2778' name='L2778'></a>  2778 <em class='brace'>{</em>
<a id='L2779' name='L2779'></a>  2779   Atom actual_type;
<a id='L2780' name='L2780'></a>  2780   <strong class='reserved'>int</strong> rc, actual_format;
<a id='L2781' name='L2781'></a>  2781   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> nitems, bytes_remaining;
<a id='L2782' name='L2782'></a>  2782   <strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *tmp_data = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L2783' name='L2783'></a>  2783   <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> *data;
<a id='L2784' name='L2784'></a>  2784 
<a id='L2785' name='L2785'></a>  2785   x_catch_errors (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L2786' name='L2786'></a>  2786   rc = XGetWindowProperty (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, wdesc,
<a id='L2787' name='L2787'></a>  2787                            dpyinfo-&gt;Xatom_MOTIF_DRAG_RECEIVER_INFO,
<a id='L2788' name='L2788'></a>  2788                            0, 4, False,
<a id='L2789' name='L2789'></a>  2789                            dpyinfo-&gt;Xatom_MOTIF_DRAG_RECEIVER_INFO,
<a id='L2790' name='L2790'></a>  2790                            &amp;actual_type, &amp;actual_format, &amp;nitems,
<a id='L2791' name='L2791'></a>  2791                            &amp;bytes_remaining,
<a id='L2792' name='L2792'></a>  2792                            &amp;tmp_data) == Success;
<a id='L2793' name='L2793'></a>  2793 
<a id='L2794' name='L2794'></a>  2794   <strong class='reserved'>if</strong> (x_had_errors_p (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>)
<a id='L2795' name='L2795'></a>  2795       || actual_format != 8 || nitems &lt; 16 || !tmp_data
<a id='L2796' name='L2796'></a>  2796       || actual_type != dpyinfo-&gt;Xatom_MOTIF_DRAG_RECEIVER_INFO)
<a id='L2797' name='L2797'></a>  2797     rc = 0;
<a id='L2798' name='L2798'></a>  2798   x_uncatch_errors_after_check ();
<a id='L2799' name='L2799'></a>  2799 
<a id='L2800' name='L2800'></a>  2800   <strong class='reserved'>if</strong> (rc)
<a id='L2801' name='L2801'></a>  2801     <em class='brace'>{</em>
<a id='L2802' name='L2802'></a>  2802       data = (<a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> *) tmp_data;
<a id='L2803' name='L2803'></a>  2803 
<a id='L2804' name='L2804'></a>  2804       <strong class='reserved'>if</strong> (data[1] &gt; <a href='../S/2289.html#L1763' title='Defined at 1763 in src/xterm.c.'>XM_DRAG_PROTOCOL_VERSION</a>)
<a id='L2805' name='L2805'></a>  2805         <strong class='reserved'>return</strong> 1;
<a id='L2806' name='L2806'></a>  2806 
<a id='L2807' name='L2807'></a>  2807       rec-&gt;byteorder = data[0];
<a id='L2808' name='L2808'></a>  2808       rec-&gt;protocol = data[1];
<a id='L2809' name='L2809'></a>  2809       rec-&gt;protocol_style = data[2];
<a id='L2810' name='L2810'></a>  2810       rec-&gt;unspecified0 = data[3];
<a id='L2811' name='L2811'></a>  2811       rec-&gt;unspecified1 = *(<a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> *) &amp;data[4];
<a id='L2812' name='L2812'></a>  2812       rec-&gt;unspecified2 = *(<a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> *) &amp;data[8];
<a id='L2813' name='L2813'></a>  2813       rec-&gt;unspecified3 = *(<a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> *) &amp;data[12];
<a id='L2814' name='L2814'></a>  2814 
<a id='L2815' name='L2815'></a>  2815       <strong class='reserved'>if</strong> (rec-&gt;byteorder != <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>)
<a id='L2816' name='L2816'></a>  2816         <em class='brace'>{</em>
<a id='L2817' name='L2817'></a>  2817           <a href='../D/6042.html' title='Multiple defined in 2 places.'>SWAPCARD32</a> (rec-&gt;unspecified1);
<a id='L2818' name='L2818'></a>  2818           <a href='../D/6042.html' title='Multiple defined in 2 places.'>SWAPCARD32</a> (rec-&gt;unspecified2);
<a id='L2819' name='L2819'></a>  2819           <a href='../D/6042.html' title='Multiple defined in 2 places.'>SWAPCARD32</a> (rec-&gt;unspecified3);
<a id='L2820' name='L2820'></a>  2820         <em class='brace'>}</em>
<a id='L2821' name='L2821'></a>  2821 
<a id='L2822' name='L2822'></a>  2822       rec-&gt;byteorder = <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>;
<a id='L2823' name='L2823'></a>  2823     <em class='brace'>}</em>
<a id='L2824' name='L2824'></a>  2824 
<a id='L2825' name='L2825'></a>  2825   <strong class='reserved'>if</strong> (tmp_data)
<a id='L2826' name='L2826'></a>  2826     XFree (tmp_data);
<a id='L2827' name='L2827'></a>  2827 
<a id='L2828' name='L2828'></a>  2828   <strong class='reserved'>return</strong> !rc;
<a id='L2829' name='L2829'></a>  2829 <em class='brace'>}</em>
<a id='L2830' name='L2830'></a>  2830 
<a id='L2831' name='L2831'></a>  2831 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L2832' name='L2832'></a>  2832 <a href='../S/2289.html#L18395' title='Referred from 18395 in src/xterm.c.'>xm_read_drag_motion_message</a> (<strong class='reserved'>const</strong> XEvent *msg,
<a id='L2833' name='L2833'></a>  2833                              <a href='../D/20008.html' title='Multiple defined in 2 places.'>xm_drag_motion_message</a> *dmsg)
<a id='L2834' name='L2834'></a>  2834 <em class='brace'>{</em>
<a id='L2835' name='L2835'></a>  2835   <strong class='reserved'>const</strong> <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> *data;
<a id='L2836' name='L2836'></a>  2836 
<a id='L2837' name='L2837'></a>  2837   data = (<strong class='reserved'>const</strong> <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> *) &amp;msg-&gt;xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[0];
<a id='L2838' name='L2838'></a>  2838 
<a id='L2839' name='L2839'></a>  2839   <strong class='reserved'>if</strong> ((<a href='../S/2289.html#L1720' title='Defined at 1720 in src/xterm.c.'>XM_DRAG_REASON_CODE</a> (data[0])
<a id='L2840' name='L2840'></a>  2840        != <a href='../S/2289.html#L1727' title='Defined at 1727 in src/xterm.c.'>XM_DRAG_REASON_DRAG_MOTION</a>)
<a id='L2841' name='L2841'></a>  2841       || (<a href='../S/2289.html#L1719' title='Defined at 1719 in src/xterm.c.'>XM_DRAG_REASON_ORIGINATOR</a> (data[0])
<a id='L2842' name='L2842'></a>  2842           != <a href='../S/2289.html#L1732' title='Defined at 1732 in src/xterm.c.'>XM_DRAG_ORIGINATOR_INITIATOR</a>))
<a id='L2843' name='L2843'></a>  2843     <strong class='reserved'>return</strong> 1;
<a id='L2844' name='L2844'></a>  2844 
<a id='L2845' name='L2845'></a>  2845   dmsg-&gt;reason = *(data++);
<a id='L2846' name='L2846'></a>  2846   dmsg-&gt;byteorder = *(data++);
<a id='L2847' name='L2847'></a>  2847   dmsg-&gt;side_effects = *(<a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> *) data;
<a id='L2848' name='L2848'></a>  2848   dmsg-&gt;timestamp = *(<a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> *) (data + 2);
<a id='L2849' name='L2849'></a>  2849   dmsg-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = *(<a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> *) (data + 6);
<a id='L2850' name='L2850'></a>  2850   dmsg-&gt;y = *(<a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> *) (data + 8);
<a id='L2851' name='L2851'></a>  2851 
<a id='L2852' name='L2852'></a>  2852   <strong class='reserved'>if</strong> (dmsg-&gt;byteorder != <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>)
<a id='L2853' name='L2853'></a>  2853     <em class='brace'>{</em>
<a id='L2854' name='L2854'></a>  2854       <a href='../D/6041.html' title='Multiple defined in 2 places.'>SWAPCARD16</a> (dmsg-&gt;side_effects);
<a id='L2855' name='L2855'></a>  2855       <a href='../D/6042.html' title='Multiple defined in 2 places.'>SWAPCARD32</a> (dmsg-&gt;timestamp);
<a id='L2856' name='L2856'></a>  2856       <a href='../D/6041.html' title='Multiple defined in 2 places.'>SWAPCARD16</a> (dmsg-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>);
<a id='L2857' name='L2857'></a>  2857       <a href='../D/6041.html' title='Multiple defined in 2 places.'>SWAPCARD16</a> (dmsg-&gt;y);
<a id='L2858' name='L2858'></a>  2858     <em class='brace'>}</em>
<a id='L2859' name='L2859'></a>  2859 
<a id='L2860' name='L2860'></a>  2860   dmsg-&gt;byteorder = <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>;
<a id='L2861' name='L2861'></a>  2861 
<a id='L2862' name='L2862'></a>  2862   <strong class='reserved'>return</strong> 0;
<a id='L2863' name='L2863'></a>  2863 <em class='brace'>}</em>
<a id='L2864' name='L2864'></a>  2864 
<a id='L2865' name='L2865'></a>  2865 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L2866' name='L2866'></a>  2866 <a href='../S/2289.html#L18402' title='Referred from 18402 in src/xterm.c.'>xm_read_drag_motion_reply</a> (<strong class='reserved'>const</strong> XEvent *msg, <a href='../D/20009.html' title='Multiple defined in 2 places.'>xm_drag_motion_reply</a> *reply)
<a id='L2867' name='L2867'></a>  2867 <em class='brace'>{</em>
<a id='L2868' name='L2868'></a>  2868   <strong class='reserved'>const</strong> <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> *data;
<a id='L2869' name='L2869'></a>  2869 
<a id='L2870' name='L2870'></a>  2870   data = (<strong class='reserved'>const</strong> <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> *) &amp;msg-&gt;xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[0];
<a id='L2871' name='L2871'></a>  2871 
<a id='L2872' name='L2872'></a>  2872   <strong class='reserved'>if</strong> ((<a href='../S/2289.html#L1720' title='Defined at 1720 in src/xterm.c.'>XM_DRAG_REASON_CODE</a> (data[0])
<a id='L2873' name='L2873'></a>  2873        != <a href='../S/2289.html#L1727' title='Defined at 1727 in src/xterm.c.'>XM_DRAG_REASON_DRAG_MOTION</a>)
<a id='L2874' name='L2874'></a>  2874       || (<a href='../S/2289.html#L1719' title='Defined at 1719 in src/xterm.c.'>XM_DRAG_REASON_ORIGINATOR</a> (data[0])
<a id='L2875' name='L2875'></a>  2875           != <a href='../S/2289.html#L1733' title='Defined at 1733 in src/xterm.c.'>XM_DRAG_ORIGINATOR_RECEIVER</a>))
<a id='L2876' name='L2876'></a>  2876     <strong class='reserved'>return</strong> 1;
<a id='L2877' name='L2877'></a>  2877 
<a id='L2878' name='L2878'></a>  2878   reply-&gt;reason = *(data++);
<a id='L2879' name='L2879'></a>  2879   reply-&gt;byte_order = *(data++);
<a id='L2880' name='L2880'></a>  2880   reply-&gt;side_effects = *(<a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> *) data;
<a id='L2881' name='L2881'></a>  2881   reply-&gt;timestamp = *(<a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> *) (data + 2);
<a id='L2882' name='L2882'></a>  2882   reply-&gt;better_x = *(<a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> *) (data + 6);
<a id='L2883' name='L2883'></a>  2883   reply-&gt;better_y = *(<a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> *) (data + 8);
<a id='L2884' name='L2884'></a>  2884 
<a id='L2885' name='L2885'></a>  2885   <strong class='reserved'>if</strong> (reply-&gt;byte_order != <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>)
<a id='L2886' name='L2886'></a>  2886     <em class='brace'>{</em>
<a id='L2887' name='L2887'></a>  2887       <a href='../D/6041.html' title='Multiple defined in 2 places.'>SWAPCARD16</a> (reply-&gt;side_effects);
<a id='L2888' name='L2888'></a>  2888       <a href='../D/6042.html' title='Multiple defined in 2 places.'>SWAPCARD32</a> (reply-&gt;timestamp);
<a id='L2889' name='L2889'></a>  2889       <a href='../D/6041.html' title='Multiple defined in 2 places.'>SWAPCARD16</a> (reply-&gt;better_x);
<a id='L2890' name='L2890'></a>  2890       <a href='../D/6041.html' title='Multiple defined in 2 places.'>SWAPCARD16</a> (reply-&gt;better_y);
<a id='L2891' name='L2891'></a>  2891     <em class='brace'>}</em>
<a id='L2892' name='L2892'></a>  2892 
<a id='L2893' name='L2893'></a>  2893   reply-&gt;byte_order = <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>;
<a id='L2894' name='L2894'></a>  2894 
<a id='L2895' name='L2895'></a>  2895   <strong class='reserved'>return</strong> 0;
<a id='L2896' name='L2896'></a>  2896 <em class='brace'>}</em>
<a id='L2897' name='L2897'></a>  2897 
<a id='L2898' name='L2898'></a>  2898 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L2899' name='L2899'></a>  2899 <a href='../R/18149.html' title='Multiple referred from 7 places.'>x_dnd_send_xm_leave_for_drop</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L2900' name='L2900'></a>  2900                               <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> wdesc,
<a id='L2901' name='L2901'></a>  2901                               <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a> timestamp)
<a id='L2902' name='L2902'></a>  2902 <em class='brace'>{</em>
<a id='L2903' name='L2903'></a>  2903   <a href='../D/20054.html' title='Multiple defined in 2 places.'>xm_top_level_leave_message</a> lmsg;
<a id='L2904' name='L2904'></a>  2904 
<a id='L2905' name='L2905'></a>  2905   lmsg.reason = <a href='../S/2289.html#L1718' title='Defined at 1718 in src/xterm.c.'>XM_DRAG_REASON</a> (<a href='../S/2289.html#L1732' title='Defined at 1732 in src/xterm.c.'>XM_DRAG_ORIGINATOR_INITIATOR</a>,
<a id='L2906' name='L2906'></a>  2906                                 <a href='../S/2289.html#L1726' title='Defined at 1726 in src/xterm.c.'>XM_DRAG_REASON_TOP_LEVEL_LEAVE</a>);
<a id='L2907' name='L2907'></a>  2907   lmsg.byteorder = <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>;
<a id='L2908' name='L2908'></a>  2908   lmsg.zero = 0;
<a id='L2909' name='L2909'></a>  2909   lmsg.timestamp = timestamp;
<a id='L2910' name='L2910'></a>  2910   lmsg.source_window = <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L2911' name='L2911'></a>  2911 
<a id='L2912' name='L2912'></a>  2912   <strong class='reserved'>if</strong> (x_dnd_motif_setup_p)
<a id='L2913' name='L2913'></a>  2913     <a href='../S/2289.html#L2648' title='Defined at 2648 in src/xterm.c.'>xm_send_top_level_leave_message</a> (dpyinfo, <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L2914' name='L2914'></a>  2914                                      wdesc, &amp;lmsg);
<a id='L2915' name='L2915'></a>  2915 <em class='brace'>}</em>
<a id='L2916' name='L2916'></a>  2916 
<a id='L2917' name='L2917'></a>  2917 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L2918' name='L2918'></a>  2918 <a href='../R/18130.html' title='Multiple referred from 7 places.'>x_dnd_free_toplevels</a> (<a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> display_alive)
<a id='L2919' name='L2919'></a>  2919 <em class='brace'>{</em>
<a id='L2920' name='L2920'></a>  2920   <strong class='reserved'>struct</strong> <a href='../S/2289.html#L1484' title='Defined at 1484 in src/xterm.c.'>x_client_list_window</a> *last;
<a id='L2921' name='L2921'></a>  2921   <strong class='reserved'>struct</strong> <a href='../S/2289.html#L1484' title='Defined at 1484 in src/xterm.c.'>x_client_list_window</a> *tem = x_dnd_toplevels;
<a id='L2922' name='L2922'></a>  2922   ptrdiff_t n_windows, i, buffer_size;
<a id='L2923' name='L2923'></a>  2923   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> *destroy_windows <a href='../D/6570.html' title='Multiple defined in 2 places.'>UNINIT</a>;
<a id='L2924' name='L2924'></a>  2924   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> *prev_masks <a href='../D/6570.html' title='Multiple defined in 2 places.'>UNINIT</a>;
<a id='L2925' name='L2925'></a>  2925   <a href='../D/17570.html' title='Multiple defined in 2 places.'>specpdl_ref</a> count;
<a id='L2926' name='L2926'></a>  2926   <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy <a href='../D/6570.html' title='Multiple defined in 2 places.'>UNINIT</a>;
<a id='L2927' name='L2927'></a>  2927   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L2928' name='L2928'></a>  2928 
<a id='L2929' name='L2929'></a>  2929   <strong class='reserved'>if</strong> (!x_dnd_toplevels)
<a id='L2930' name='L2930'></a>  2930     <em class='comment'>/* Probably called inside an IO error handler.  */</em>
<a id='L2931' name='L2931'></a>  2931     <strong class='reserved'>return</strong>;
<a id='L2932' name='L2932'></a>  2932 
<a id='L2933' name='L2933'></a>  2933   <strong class='reserved'>if</strong> (display_alive)
<a id='L2934' name='L2934'></a>  2934     <em class='brace'>{</em>
<a id='L2935' name='L2935'></a>  2935       buffer_size = 1024;
<a id='L2936' name='L2936'></a>  2936       destroy_windows = <a href='../D/20068.html' title='Multiple defined in 10 places.'>xmalloc</a> (<strong class='reserved'>sizeof</strong> *destroy_windows
<a id='L2937' name='L2937'></a>  2937                                  * buffer_size);
<a id='L2938' name='L2938'></a>  2938       prev_masks = <a href='../D/20068.html' title='Multiple defined in 10 places.'>xmalloc</a> (<strong class='reserved'>sizeof</strong> *prev_masks *
<a id='L2939' name='L2939'></a>  2939                             buffer_size);
<a id='L2940' name='L2940'></a>  2940       n_windows = 0;
<a id='L2941' name='L2941'></a>  2941     <em class='brace'>}</em>
<a id='L2942' name='L2942'></a>  2942 
<a id='L2943' name='L2943'></a>  2943   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L2944' name='L2944'></a>  2944   <strong class='reserved'>while</strong> (tem)
<a id='L2945' name='L2945'></a>  2945     <em class='brace'>{</em>
<a id='L2946' name='L2946'></a>  2946       last = tem;
<a id='L2947' name='L2947'></a>  2947       tem = tem-&gt;next;
<a id='L2948' name='L2948'></a>  2948 
<a id='L2949' name='L2949'></a>  2949       <strong class='reserved'>if</strong> (display_alive)
<a id='L2950' name='L2950'></a>  2950         <em class='brace'>{</em>
<a id='L2951' name='L2951'></a>  2951           <strong class='reserved'>if</strong> (++n_windows &gt;= buffer_size)
<a id='L2952' name='L2952'></a>  2952             <em class='brace'>{</em>
<a id='L2953' name='L2953'></a>  2953               buffer_size += 1024;
<a id='L2954' name='L2954'></a>  2954               destroy_windows
<a id='L2955' name='L2955'></a>  2955                 = <a href='../D/20107.html' title='Multiple defined in 7 places.'>xrealloc</a> (destroy_windows, (<strong class='reserved'>sizeof</strong> *destroy_windows
<a id='L2956' name='L2956'></a>  2956                                               * buffer_size));
<a id='L2957' name='L2957'></a>  2957               prev_masks
<a id='L2958' name='L2958'></a>  2958                 = <a href='../D/20107.html' title='Multiple defined in 7 places.'>xrealloc</a> (prev_masks, (<strong class='reserved'>sizeof</strong> *prev_masks
<a id='L2959' name='L2959'></a>  2959                                          * buffer_size));
<a id='L2960' name='L2960'></a>  2960             <em class='brace'>}</em>
<a id='L2961' name='L2961'></a>  2961 
<a id='L2962' name='L2962'></a>  2962           dpy = last-&gt;dpy;
<a id='L2963' name='L2963'></a>  2963           prev_masks[n_windows - 1] = last-&gt;previous_event_mask;
<a id='L2964' name='L2964'></a>  2964           destroy_windows[n_windows - 1] = last-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>;
<a id='L2965' name='L2965'></a>  2965         <em class='brace'>}</em>
<a id='L2966' name='L2966'></a>  2966 
<a id='L2967' name='L2967'></a>  2967 <em class='sharp'>#ifdef</em> HAVE_XSHAPE
<a id='L2968' name='L2968'></a>  2968       <strong class='reserved'>if</strong> (last-&gt;n_input_rects != -1)
<a id='L2969' name='L2969'></a>  2969         <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (last-&gt;input_rects);
<a id='L2970' name='L2970'></a>  2970       <strong class='reserved'>if</strong> (last-&gt;n_bounding_rects != -1)
<a id='L2971' name='L2971'></a>  2971         <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (last-&gt;bounding_rects);
<a id='L2972' name='L2972'></a>  2972 <em class='sharp'>#endif</em>
<a id='L2973' name='L2973'></a>  2973 
<a id='L2974' name='L2974'></a>  2974       <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (last);
<a id='L2975' name='L2975'></a>  2975     <em class='brace'>}</em>
<a id='L2976' name='L2976'></a>  2976 
<a id='L2977' name='L2977'></a>  2977   x_dnd_toplevels = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L2978' name='L2978'></a>  2978 
<a id='L2979' name='L2979'></a>  2979   <strong class='reserved'>if</strong> (!display_alive)
<a id='L2980' name='L2980'></a>  2980     <em class='brace'>{</em>
<a id='L2981' name='L2981'></a>  2981       <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L2982' name='L2982'></a>  2982       <strong class='reserved'>return</strong>;
<a id='L2983' name='L2983'></a>  2983     <em class='brace'>}</em>
<a id='L2984' name='L2984'></a>  2984 
<a id='L2985' name='L2985'></a>  2985   count = <a href='../D/5888.html' title='Multiple defined in 2 places.'>SPECPDL_INDEX</a> ();
<a id='L2986' name='L2986'></a>  2986   <a href='../S/2188.html#L3559' title='Defined at 3559 in src/eval.c.'>record_unwind_protect_ptr</a> (<a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a>, destroy_windows);
<a id='L2987' name='L2987'></a>  2987   <a href='../S/2188.html#L3559' title='Defined at 3559 in src/eval.c.'>record_unwind_protect_ptr</a> (<a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a>, prev_masks);
<a id='L2988' name='L2988'></a>  2988 
<a id='L2989' name='L2989'></a>  2989   <strong class='reserved'>if</strong> (display_alive)
<a id='L2990' name='L2990'></a>  2990     <em class='brace'>{</em>
<a id='L2991' name='L2991'></a>  2991       dpyinfo = <a href='../S/2289.html#L6774' title='Defined at 6774 in src/xterm.c.'>x_display_info_for_display</a> (dpy);
<a id='L2992' name='L2992'></a>  2992 
<a id='L2993' name='L2993'></a>  2993       <strong class='reserved'>if</strong> (n_windows)
<a id='L2994' name='L2994'></a>  2994         <em class='brace'>{</em>
<a id='L2995' name='L2995'></a>  2995           <a href='../D/10872.html' title='Multiple defined in 5 places.'>eassume</a> (dpyinfo);
<a id='L2996' name='L2996'></a>  2996           x_ignore_errors_for_next_request (dpyinfo, 0);
<a id='L2997' name='L2997'></a>  2997 
<a id='L2998' name='L2998'></a>  2998           <strong class='reserved'>for</strong> (i = 0; i &lt; n_windows; ++i)
<a id='L2999' name='L2999'></a>  2999             <em class='brace'>{</em>
<a id='L3000' name='L3000'></a>  3000               XSelectInput (dpy, destroy_windows[i], prev_masks[i]);
<a id='L3001' name='L3001'></a>  3001 <em class='sharp'>#ifdef</em> HAVE_XSHAPE
<a id='L3002' name='L3002'></a>  3002               XShapeSelectInput (dpy, destroy_windows[i], None);
<a id='L3003' name='L3003'></a>  3003 <em class='sharp'>#endif</em>
<a id='L3004' name='L3004'></a>  3004             <em class='brace'>}</em>
<a id='L3005' name='L3005'></a>  3005 
<a id='L3006' name='L3006'></a>  3006           x_stop_ignoring_errors (dpyinfo);
<a id='L3007' name='L3007'></a>  3007         <em class='brace'>}</em>
<a id='L3008' name='L3008'></a>  3008     <em class='brace'>}</em>
<a id='L3009' name='L3009'></a>  3009 
<a id='L3010' name='L3010'></a>  3010   <a href='../S/2188.html#L3757' title='Defined at 3757 in src/eval.c.'>unbind_to</a> (count, Qnil);
<a id='L3011' name='L3011'></a>  3011   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L3012' name='L3012'></a>  3012 <em class='brace'>}</em>
<a id='L3013' name='L3013'></a>  3013 
<a id='L3014' name='L3014'></a>  3014 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L3015' name='L3015'></a>  3015 <a href='../R/18125.html' title='Multiple referred from 2 places.'>x_dnd_compute_toplevels</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo)
<a id='L3016' name='L3016'></a>  3016 <em class='brace'>{</em>
<a id='L3017' name='L3017'></a>  3017   Atom type;
<a id='L3018' name='L3018'></a>  3018   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> *toplevels;
<a id='L3019' name='L3019'></a>  3019   <strong class='reserved'>int</strong> format, rc;
<a id='L3020' name='L3020'></a>  3020   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> nitems, bytes_after;
<a id='L3021' name='L3021'></a>  3021   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> i, real_nitems;
<a id='L3022' name='L3022'></a>  3022   <strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *data = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L3023' name='L3023'></a>  3023   <strong class='reserved'>int</strong> frame_extents[4];
<a id='L3024' name='L3024'></a>  3024 
<a id='L3025' name='L3025'></a>  3025 <em class='sharp'>#ifndef</em> USE_XCB
<a id='L3026' name='L3026'></a>  3026   <strong class='reserved'>int</strong> dest_x, dest_y;
<a id='L3027' name='L3027'></a>  3027   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> *wmstate;
<a id='L3028' name='L3028'></a>  3028   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> wmstate_items, extent_items;
<a id='L3029' name='L3029'></a>  3029   <strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *wmstate_data = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, *extent_data = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L3030' name='L3030'></a>  3030   XWindowAttributes attrs;
<a id='L3031' name='L3031'></a>  3031   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> child;
<a id='L3032' name='L3032'></a>  3032   <a href='../D/20013.html' title='Multiple defined in 2 places.'>xm_drag_receiver_info</a> xm_info;
<a id='L3033' name='L3033'></a>  3033 <em class='sharp'>#else</em>
<a id='L3034' name='L3034'></a>  3034   <a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> *wmstate, *fextents;
<a id='L3035' name='L3035'></a>  3035   <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> *xmdata;
<a id='L3036' name='L3036'></a>  3036   xcb_get_window_attributes_cookie_t *window_attribute_cookies;
<a id='L3037' name='L3037'></a>  3037   xcb_translate_coordinates_cookie_t *translate_coordinate_cookies;
<a id='L3038' name='L3038'></a>  3038   xcb_get_property_cookie_t *get_property_cookies;
<a id='L3039' name='L3039'></a>  3039   xcb_get_property_cookie_t *xm_property_cookies;
<a id='L3040' name='L3040'></a>  3040   xcb_get_property_cookie_t *extent_property_cookies;
<a id='L3041' name='L3041'></a>  3041   xcb_get_geometry_cookie_t *get_geometry_cookies;
<a id='L3042' name='L3042'></a>  3042   xcb_get_window_attributes_reply_t attrs, *attrs_reply;
<a id='L3043' name='L3043'></a>  3043   xcb_translate_coordinates_reply_t *coordinates_reply;
<a id='L3044' name='L3044'></a>  3044   xcb_get_property_reply_t *property_reply;
<a id='L3045' name='L3045'></a>  3045   xcb_get_property_reply_t *xm_property_reply;
<a id='L3046' name='L3046'></a>  3046   xcb_get_property_reply_t *extent_property_reply;
<a id='L3047' name='L3047'></a>  3047   xcb_get_geometry_reply_t *geometry_reply;
<a id='L3048' name='L3048'></a>  3048   xcb_generic_error_t *<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>;
<a id='L3049' name='L3049'></a>  3049 <em class='sharp'>#endif</em>
<a id='L3050' name='L3050'></a>  3050 
<a id='L3051' name='L3051'></a>  3051 <em class='sharp'>#ifdef</em> HAVE_XCB_SHAPE
<a id='L3052' name='L3052'></a>  3052   xcb_shape_get_rectangles_cookie_t *bounding_rect_cookies;
<a id='L3053' name='L3053'></a>  3053   xcb_shape_get_rectangles_reply_t *bounding_rect_reply;
<a id='L3054' name='L3054'></a>  3054   xcb_rectangle_iterator_t bounding_rect_iterator;
<a id='L3055' name='L3055'></a>  3055 <em class='sharp'>#endif</em>
<a id='L3056' name='L3056'></a>  3056 
<a id='L3057' name='L3057'></a>  3057 <em class='sharp'>#ifdef</em> <a href='../S/2289.html#L804' title='Defined at 804 in src/xterm.c.'>HAVE_XCB_SHAPE_INPUT_RECTS</a>
<a id='L3058' name='L3058'></a>  3058   xcb_shape_get_rectangles_cookie_t *input_rect_cookies;
<a id='L3059' name='L3059'></a>  3059   xcb_shape_get_rectangles_reply_t *input_rect_reply;
<a id='L3060' name='L3060'></a>  3060   xcb_rectangle_iterator_t input_rect_iterator;
<a id='L3061' name='L3061'></a>  3061 <em class='sharp'>#endif</em>
<a id='L3062' name='L3062'></a>  3062 
<a id='L3063' name='L3063'></a>  3063   <strong class='reserved'>struct</strong> <a href='../S/2289.html#L1484' title='Defined at 1484 in src/xterm.c.'>x_client_list_window</a> *tem;
<a id='L3064' name='L3064'></a>  3064 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XSHAPE &amp;&amp; !<strong class='reserved'>defined</strong> <a href='../S/2289.html#L804' title='Defined at 804 in src/xterm.c.'>HAVE_XCB_SHAPE_INPUT_RECTS</a>
<a id='L3065' name='L3065'></a>  3065   <strong class='reserved'>int</strong> count, ordering;
<a id='L3066' name='L3066'></a>  3066   <a href='../S/2150.html#L62' title='Defined at 62 in src/pgtkgui.h.'>XRectangle</a> *rects;
<a id='L3067' name='L3067'></a>  3067 <em class='sharp'>#endif</em>
<a id='L3068' name='L3068'></a>  3068 
<a id='L3069' name='L3069'></a>  3069   rc = XGetWindowProperty (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, dpyinfo-&gt;root_window,
<a id='L3070' name='L3070'></a>  3070                            dpyinfo-&gt;Xatom_net_client_list_stacking,
<a id='L3071' name='L3071'></a>  3071                            0, LONG_MAX, False, XA_WINDOW, &amp;type,
<a id='L3072' name='L3072'></a>  3072                            &amp;format, &amp;nitems, &amp;bytes_after, &amp;data);
<a id='L3073' name='L3073'></a>  3073 
<a id='L3074' name='L3074'></a>  3074   <strong class='reserved'>if</strong> (rc != Success)
<a id='L3075' name='L3075'></a>  3075     <strong class='reserved'>return</strong> 1;
<a id='L3076' name='L3076'></a>  3076 
<a id='L3077' name='L3077'></a>  3077   <strong class='reserved'>if</strong> (format != 32 || type != XA_WINDOW)
<a id='L3078' name='L3078'></a>  3078     <em class='brace'>{</em>
<a id='L3079' name='L3079'></a>  3079       XFree (data);
<a id='L3080' name='L3080'></a>  3080       <strong class='reserved'>return</strong> 1;
<a id='L3081' name='L3081'></a>  3081     <em class='brace'>}</em>
<a id='L3082' name='L3082'></a>  3082 
<a id='L3083' name='L3083'></a>  3083   toplevels = (<a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> *) data;
<a id='L3084' name='L3084'></a>  3084 
<a id='L3085' name='L3085'></a>  3085   <strong class='reserved'>for</strong> (i = 0, real_nitems = 0; i &lt; nitems; ++i)
<a id='L3086' name='L3086'></a>  3086     <em class='brace'>{</em>
<a id='L3087' name='L3087'></a>  3087       <em class='comment'>/* Some window managers with built in compositors end up putting</em>
<a id='L3088' name='L3088'></a>  3088 <em class='comment'>         tooltips in the client list, which is silly.  */</em>
<a id='L3089' name='L3089'></a>  3089       <strong class='reserved'>if</strong> (!<a href='../S/2289.html#L12010' title='Defined at 12010 in src/xterm.c.'>x_tooltip_window_to_frame</a> (dpyinfo, toplevels[i], <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>))
<a id='L3090' name='L3090'></a>  3090         toplevels[real_nitems++] = toplevels[i];
<a id='L3091' name='L3091'></a>  3091     <em class='brace'>}</em>
<a id='L3092' name='L3092'></a>  3092 
<a id='L3093' name='L3093'></a>  3093   nitems = real_nitems;
<a id='L3094' name='L3094'></a>  3094 
<a id='L3095' name='L3095'></a>  3095 <em class='sharp'>#ifdef</em> USE_XCB
<a id='L3096' name='L3096'></a>  3096   <a href='../D/6613.html' title='Multiple defined in 2 places.'>USE_SAFE_ALLOCA</a>;
<a id='L3097' name='L3097'></a>  3097 
<a id='L3098' name='L3098'></a>  3098   window_attribute_cookies
<a id='L3099' name='L3099'></a>  3099     = <a href='../D/5389.html' title='Multiple defined in 2 places.'>SAFE_ALLOCA</a> (<strong class='reserved'>sizeof</strong> *window_attribute_cookies * nitems);
<a id='L3100' name='L3100'></a>  3100   translate_coordinate_cookies
<a id='L3101' name='L3101'></a>  3101     = <a href='../D/5389.html' title='Multiple defined in 2 places.'>SAFE_ALLOCA</a> (<strong class='reserved'>sizeof</strong> *translate_coordinate_cookies * nitems);
<a id='L3102' name='L3102'></a>  3102   get_property_cookies
<a id='L3103' name='L3103'></a>  3103     = <a href='../D/5389.html' title='Multiple defined in 2 places.'>SAFE_ALLOCA</a> (<strong class='reserved'>sizeof</strong> *get_property_cookies * nitems);
<a id='L3104' name='L3104'></a>  3104   xm_property_cookies
<a id='L3105' name='L3105'></a>  3105     = <a href='../D/5389.html' title='Multiple defined in 2 places.'>SAFE_ALLOCA</a> (<strong class='reserved'>sizeof</strong> *xm_property_cookies * nitems);
<a id='L3106' name='L3106'></a>  3106   extent_property_cookies
<a id='L3107' name='L3107'></a>  3107     = <a href='../D/5389.html' title='Multiple defined in 2 places.'>SAFE_ALLOCA</a> (<strong class='reserved'>sizeof</strong> *extent_property_cookies * nitems);
<a id='L3108' name='L3108'></a>  3108   get_geometry_cookies
<a id='L3109' name='L3109'></a>  3109     = <a href='../D/5389.html' title='Multiple defined in 2 places.'>SAFE_ALLOCA</a> (<strong class='reserved'>sizeof</strong> *get_geometry_cookies * nitems);
<a id='L3110' name='L3110'></a>  3110 
<a id='L3111' name='L3111'></a>  3111 <em class='sharp'>#ifdef</em> HAVE_XCB_SHAPE
<a id='L3112' name='L3112'></a>  3112   bounding_rect_cookies
<a id='L3113' name='L3113'></a>  3113     = <a href='../D/5389.html' title='Multiple defined in 2 places.'>SAFE_ALLOCA</a> (<strong class='reserved'>sizeof</strong> *bounding_rect_cookies * nitems);
<a id='L3114' name='L3114'></a>  3114 <em class='sharp'>#endif</em>
<a id='L3115' name='L3115'></a>  3115 
<a id='L3116' name='L3116'></a>  3116 <em class='sharp'>#ifdef</em> <a href='../S/2289.html#L804' title='Defined at 804 in src/xterm.c.'>HAVE_XCB_SHAPE_INPUT_RECTS</a>
<a id='L3117' name='L3117'></a>  3117   input_rect_cookies
<a id='L3118' name='L3118'></a>  3118     = <a href='../D/5389.html' title='Multiple defined in 2 places.'>SAFE_ALLOCA</a> (<strong class='reserved'>sizeof</strong> *input_rect_cookies * nitems);
<a id='L3119' name='L3119'></a>  3119 <em class='sharp'>#endif</em>
<a id='L3120' name='L3120'></a>  3120 
<a id='L3121' name='L3121'></a>  3121   <strong class='reserved'>for</strong> (i = 0; i &lt; nitems; ++i)
<a id='L3122' name='L3122'></a>  3122     <em class='brace'>{</em>
<a id='L3123' name='L3123'></a>  3123       window_attribute_cookies[i]
<a id='L3124' name='L3124'></a>  3124         = xcb_get_window_attributes (dpyinfo-&gt;xcb_connection,
<a id='L3125' name='L3125'></a>  3125                                      (xcb_window_t) toplevels[i]);
<a id='L3126' name='L3126'></a>  3126       translate_coordinate_cookies[i]
<a id='L3127' name='L3127'></a>  3127         = xcb_translate_coordinates (dpyinfo-&gt;xcb_connection,
<a id='L3128' name='L3128'></a>  3128                                      (xcb_window_t) toplevels[i],
<a id='L3129' name='L3129'></a>  3129                                      (xcb_window_t) dpyinfo-&gt;root_window,
<a id='L3130' name='L3130'></a>  3130                                      0, 0);
<a id='L3131' name='L3131'></a>  3131       get_property_cookies[i]
<a id='L3132' name='L3132'></a>  3132         = xcb_get_property (dpyinfo-&gt;xcb_connection, 0, (xcb_window_t) toplevels[i],
<a id='L3133' name='L3133'></a>  3133                             (xcb_atom_t) dpyinfo-&gt;Xatom_wm_state, 0,
<a id='L3134' name='L3134'></a>  3134                             0, 2);
<a id='L3135' name='L3135'></a>  3135       xm_property_cookies[i]
<a id='L3136' name='L3136'></a>  3136         = xcb_get_property (dpyinfo-&gt;xcb_connection, 0, (xcb_window_t) toplevels[i],
<a id='L3137' name='L3137'></a>  3137                             (xcb_atom_t) dpyinfo-&gt;Xatom_MOTIF_DRAG_RECEIVER_INFO,
<a id='L3138' name='L3138'></a>  3138                             (xcb_atom_t) dpyinfo-&gt;Xatom_MOTIF_DRAG_RECEIVER_INFO,
<a id='L3139' name='L3139'></a>  3139                             0, 4);
<a id='L3140' name='L3140'></a>  3140       extent_property_cookies[i]
<a id='L3141' name='L3141'></a>  3141         = xcb_get_property (dpyinfo-&gt;xcb_connection, 0,
<a id='L3142' name='L3142'></a>  3142                             (xcb_window_t) toplevels[i],
<a id='L3143' name='L3143'></a>  3143                             (xcb_atom_t) dpyinfo-&gt;Xatom_net_frame_extents,
<a id='L3144' name='L3144'></a>  3144                             XA_CARDINAL, 0, 4);
<a id='L3145' name='L3145'></a>  3145       get_geometry_cookies[i]
<a id='L3146' name='L3146'></a>  3146         = xcb_get_geometry (dpyinfo-&gt;xcb_connection, (xcb_window_t) toplevels[i]);
<a id='L3147' name='L3147'></a>  3147 
<a id='L3148' name='L3148'></a>  3148 <em class='sharp'>#ifdef</em> HAVE_XCB_SHAPE
<a id='L3149' name='L3149'></a>  3149       bounding_rect_cookies[i]
<a id='L3150' name='L3150'></a>  3150         = xcb_shape_get_rectangles (dpyinfo-&gt;xcb_connection,
<a id='L3151' name='L3151'></a>  3151                                     (xcb_window_t) toplevels[i],
<a id='L3152' name='L3152'></a>  3152                                     XCB_SHAPE_SK_BOUNDING);
<a id='L3153' name='L3153'></a>  3153 <em class='sharp'>#endif</em>
<a id='L3154' name='L3154'></a>  3154 
<a id='L3155' name='L3155'></a>  3155 <em class='sharp'>#ifdef</em> <a href='../S/2289.html#L804' title='Defined at 804 in src/xterm.c.'>HAVE_XCB_SHAPE_INPUT_RECTS</a>
<a id='L3156' name='L3156'></a>  3156       <strong class='reserved'>if</strong> (dpyinfo-&gt;xshape_major &gt; 1
<a id='L3157' name='L3157'></a>  3157           || (dpyinfo-&gt;xshape_major == 1
<a id='L3158' name='L3158'></a>  3158               &amp;&amp; dpyinfo-&gt;xshape_minor &gt;= 1))
<a id='L3159' name='L3159'></a>  3159         input_rect_cookies[i]
<a id='L3160' name='L3160'></a>  3160           = xcb_shape_get_rectangles (dpyinfo-&gt;xcb_connection,
<a id='L3161' name='L3161'></a>  3161                                       (xcb_window_t) toplevels[i],
<a id='L3162' name='L3162'></a>  3162                                       XCB_SHAPE_SK_INPUT);
<a id='L3163' name='L3163'></a>  3163 <em class='sharp'>#endif</em>
<a id='L3164' name='L3164'></a>  3164     <em class='brace'>}</em>
<a id='L3165' name='L3165'></a>  3165 <em class='sharp'>#endif</em>
<a id='L3166' name='L3166'></a>  3166 
<a id='L3167' name='L3167'></a>  3167   <em class='comment'>/* Actually right because _NET_CLIENT_LIST_STACKING has bottom-up</em>
<a id='L3168' name='L3168'></a>  3168 <em class='comment'>     order.  */</em>
<a id='L3169' name='L3169'></a>  3169   <strong class='reserved'>for</strong> (i = 0; i &lt; nitems; ++i)
<a id='L3170' name='L3170'></a>  3170     <em class='brace'>{</em>
<a id='L3171' name='L3171'></a>  3171       frame_extents[0] = 0;
<a id='L3172' name='L3172'></a>  3172       frame_extents[1] = 0;
<a id='L3173' name='L3173'></a>  3173       frame_extents[2] = 0;
<a id='L3174' name='L3174'></a>  3174       frame_extents[3] = 0;
<a id='L3175' name='L3175'></a>  3175 
<a id='L3176' name='L3176'></a>  3176 <em class='sharp'>#ifndef</em> USE_XCB
<a id='L3177' name='L3177'></a>  3177       x_catch_errors (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L3178' name='L3178'></a>  3178       rc = (XGetWindowAttributes (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L3179' name='L3179'></a>  3179                                   toplevels[i], &amp;attrs)
<a id='L3180' name='L3180'></a>  3180             &amp;&amp; !x_had_errors_p (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>));
<a id='L3181' name='L3181'></a>  3181 
<a id='L3182' name='L3182'></a>  3182       <strong class='reserved'>if</strong> (rc)
<a id='L3183' name='L3183'></a>  3183         rc = (XTranslateCoordinates (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, toplevels[i],
<a id='L3184' name='L3184'></a>  3184                                      attrs.root, -attrs.border_width,
<a id='L3185' name='L3185'></a>  3185                                      -attrs.border_width, &amp;dest_x,
<a id='L3186' name='L3186'></a>  3186                                      &amp;dest_y, &amp;child)
<a id='L3187' name='L3187'></a>  3187               &amp;&amp; !x_had_errors_p (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>));
<a id='L3188' name='L3188'></a>  3188       <strong class='reserved'>if</strong> (rc)
<a id='L3189' name='L3189'></a>  3189         rc = ((XGetWindowProperty (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L3190' name='L3190'></a>  3190                                    toplevels[i],
<a id='L3191' name='L3191'></a>  3191                                    dpyinfo-&gt;Xatom_wm_state,
<a id='L3192' name='L3192'></a>  3192                                    0, 2, False, AnyPropertyType,
<a id='L3193' name='L3193'></a>  3193                                    &amp;type, &amp;format, &amp;wmstate_items,
<a id='L3194' name='L3194'></a>  3194                                    &amp;bytes_after, &amp;wmstate_data)
<a id='L3195' name='L3195'></a>  3195                == Success)
<a id='L3196' name='L3196'></a>  3196               &amp;&amp; !x_had_errors_p (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>)
<a id='L3197' name='L3197'></a>  3197               &amp;&amp; wmstate_data &amp;&amp; wmstate_items == 2 &amp;&amp; format == 32);
<a id='L3198' name='L3198'></a>  3198 
<a id='L3199' name='L3199'></a>  3199       <strong class='reserved'>if</strong> (XGetWindowProperty (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, toplevels[i],
<a id='L3200' name='L3200'></a>  3200                               dpyinfo-&gt;Xatom_net_frame_extents,
<a id='L3201' name='L3201'></a>  3201                               0, 4, False, XA_CARDINAL, &amp;type,
<a id='L3202' name='L3202'></a>  3202                               &amp;format, &amp;extent_items, &amp;bytes_after,
<a id='L3203' name='L3203'></a>  3203                               &amp;extent_data) == Success
<a id='L3204' name='L3204'></a>  3204           &amp;&amp; !x_had_errors_p (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>)
<a id='L3205' name='L3205'></a>  3205           &amp;&amp; extent_data &amp;&amp; extent_items &gt;= 4 &amp;&amp; format == 32)
<a id='L3206' name='L3206'></a>  3206         <em class='brace'>{</em>
<a id='L3207' name='L3207'></a>  3207           frame_extents[0] = ((<strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> *) extent_data)[0];
<a id='L3208' name='L3208'></a>  3208           frame_extents[1] = ((<strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> *) extent_data)[1];
<a id='L3209' name='L3209'></a>  3209           frame_extents[2] = ((<strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> *) extent_data)[2];
<a id='L3210' name='L3210'></a>  3210           frame_extents[3] = ((<strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> *) extent_data)[3];
<a id='L3211' name='L3211'></a>  3211         <em class='brace'>}</em>
<a id='L3212' name='L3212'></a>  3212 
<a id='L3213' name='L3213'></a>  3213       <strong class='reserved'>if</strong> (extent_data)
<a id='L3214' name='L3214'></a>  3214         XFree (extent_data);
<a id='L3215' name='L3215'></a>  3215 
<a id='L3216' name='L3216'></a>  3216       x_uncatch_errors ();
<a id='L3217' name='L3217'></a>  3217 <em class='sharp'>#else</em>
<a id='L3218' name='L3218'></a>  3218       rc = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L3219' name='L3219'></a>  3219 
<a id='L3220' name='L3220'></a>  3220       attrs_reply
<a id='L3221' name='L3221'></a>  3221         = xcb_get_window_attributes_reply (dpyinfo-&gt;xcb_connection,
<a id='L3222' name='L3222'></a>  3222                                            window_attribute_cookies[i],
<a id='L3223' name='L3223'></a>  3223                                            &amp;<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L3224' name='L3224'></a>  3224 
<a id='L3225' name='L3225'></a>  3225       <strong class='reserved'>if</strong> (!attrs_reply)
<a id='L3226' name='L3226'></a>  3226         <em class='brace'>{</em>
<a id='L3227' name='L3227'></a>  3227           rc = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L3228' name='L3228'></a>  3228           <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L3229' name='L3229'></a>  3229         <em class='brace'>}</em>
<a id='L3230' name='L3230'></a>  3230 
<a id='L3231' name='L3231'></a>  3231       coordinates_reply
<a id='L3232' name='L3232'></a>  3232         = xcb_translate_coordinates_reply (dpyinfo-&gt;xcb_connection,
<a id='L3233' name='L3233'></a>  3233                                            translate_coordinate_cookies[i],
<a id='L3234' name='L3234'></a>  3234                                            &amp;<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L3235' name='L3235'></a>  3235 
<a id='L3236' name='L3236'></a>  3236       <strong class='reserved'>if</strong> (!coordinates_reply)
<a id='L3237' name='L3237'></a>  3237         <em class='brace'>{</em>
<a id='L3238' name='L3238'></a>  3238           rc = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L3239' name='L3239'></a>  3239           <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L3240' name='L3240'></a>  3240         <em class='brace'>}</em>
<a id='L3241' name='L3241'></a>  3241 
<a id='L3242' name='L3242'></a>  3242       property_reply = xcb_get_property_reply (dpyinfo-&gt;xcb_connection,
<a id='L3243' name='L3243'></a>  3243                                                get_property_cookies[i],
<a id='L3244' name='L3244'></a>  3244                                                &amp;<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L3245' name='L3245'></a>  3245 
<a id='L3246' name='L3246'></a>  3246       <strong class='reserved'>if</strong> (!property_reply)
<a id='L3247' name='L3247'></a>  3247         <em class='brace'>{</em>
<a id='L3248' name='L3248'></a>  3248           rc = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L3249' name='L3249'></a>  3249           <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L3250' name='L3250'></a>  3250         <em class='brace'>}</em>
<a id='L3251' name='L3251'></a>  3251 
<a id='L3252' name='L3252'></a>  3252       <em class='comment'>/* These requests don't set rc on failure because they aren't</em>
<a id='L3253' name='L3253'></a>  3253 <em class='comment'>         required.  */</em>
<a id='L3254' name='L3254'></a>  3254 
<a id='L3255' name='L3255'></a>  3255       xm_property_reply = xcb_get_property_reply (dpyinfo-&gt;xcb_connection,
<a id='L3256' name='L3256'></a>  3256                                                   xm_property_cookies[i],
<a id='L3257' name='L3257'></a>  3257                                                   &amp;<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L3258' name='L3258'></a>  3258 
<a id='L3259' name='L3259'></a>  3259       <strong class='reserved'>if</strong> (!xm_property_reply)
<a id='L3260' name='L3260'></a>  3260         <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L3261' name='L3261'></a>  3261 
<a id='L3262' name='L3262'></a>  3262       extent_property_reply = xcb_get_property_reply (dpyinfo-&gt;xcb_connection,
<a id='L3263' name='L3263'></a>  3263                                                       extent_property_cookies[i],
<a id='L3264' name='L3264'></a>  3264                                                       &amp;<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L3265' name='L3265'></a>  3265 
<a id='L3266' name='L3266'></a>  3266       <strong class='reserved'>if</strong> (!extent_property_reply)
<a id='L3267' name='L3267'></a>  3267         <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L3268' name='L3268'></a>  3268       <strong class='reserved'>else</strong>
<a id='L3269' name='L3269'></a>  3269         <em class='brace'>{</em>
<a id='L3270' name='L3270'></a>  3270           <strong class='reserved'>if</strong> (xcb_get_property_value_length (extent_property_reply) == 16
<a id='L3271' name='L3271'></a>  3271               &amp;&amp; extent_property_reply-&gt;format == 32
<a id='L3272' name='L3272'></a>  3272               &amp;&amp; extent_property_reply-&gt;type == XA_CARDINAL)
<a id='L3273' name='L3273'></a>  3273             <em class='brace'>{</em>
<a id='L3274' name='L3274'></a>  3274               fextents = xcb_get_property_value (extent_property_reply);
<a id='L3275' name='L3275'></a>  3275               frame_extents[0] = fextents[0];
<a id='L3276' name='L3276'></a>  3276               frame_extents[1] = fextents[1];
<a id='L3277' name='L3277'></a>  3277               frame_extents[2] = fextents[2];
<a id='L3278' name='L3278'></a>  3278               frame_extents[3] = fextents[3];
<a id='L3279' name='L3279'></a>  3279             <em class='brace'>}</em>
<a id='L3280' name='L3280'></a>  3280 
<a id='L3281' name='L3281'></a>  3281           <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (extent_property_reply);
<a id='L3282' name='L3282'></a>  3282         <em class='brace'>}</em>
<a id='L3283' name='L3283'></a>  3283 
<a id='L3284' name='L3284'></a>  3284       <strong class='reserved'>if</strong> (property_reply
<a id='L3285' name='L3285'></a>  3285           &amp;&amp; (xcb_get_property_value_length (property_reply) != 8
<a id='L3286' name='L3286'></a>  3286               || property_reply-&gt;format != 32))
<a id='L3287' name='L3287'></a>  3287         rc = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L3288' name='L3288'></a>  3288 
<a id='L3289' name='L3289'></a>  3289       geometry_reply = xcb_get_geometry_reply (dpyinfo-&gt;xcb_connection,
<a id='L3290' name='L3290'></a>  3290                                                get_geometry_cookies[i],
<a id='L3291' name='L3291'></a>  3291                                                &amp;<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L3292' name='L3292'></a>  3292 
<a id='L3293' name='L3293'></a>  3293       <strong class='reserved'>if</strong> (!geometry_reply)
<a id='L3294' name='L3294'></a>  3294         <em class='brace'>{</em>
<a id='L3295' name='L3295'></a>  3295           rc = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L3296' name='L3296'></a>  3296           <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L3297' name='L3297'></a>  3297         <em class='brace'>}</em>
<a id='L3298' name='L3298'></a>  3298 <em class='sharp'>#endif</em>
<a id='L3299' name='L3299'></a>  3299 
<a id='L3300' name='L3300'></a>  3300       <strong class='reserved'>if</strong> (rc)
<a id='L3301' name='L3301'></a>  3301         <em class='brace'>{</em>
<a id='L3302' name='L3302'></a>  3302 <em class='sharp'>#ifdef</em> USE_XCB
<a id='L3303' name='L3303'></a>  3303           wmstate = (<a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> *) xcb_get_property_value (property_reply);
<a id='L3304' name='L3304'></a>  3304           attrs = *attrs_reply;
<a id='L3305' name='L3305'></a>  3305 <em class='sharp'>#else</em>
<a id='L3306' name='L3306'></a>  3306           wmstate = (<strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> *) wmstate_data;
<a id='L3307' name='L3307'></a>  3307 <em class='sharp'>#endif</em>
<a id='L3308' name='L3308'></a>  3308 
<a id='L3309' name='L3309'></a>  3309           tem = <a href='../D/20068.html' title='Multiple defined in 10 places.'>xmalloc</a> (<strong class='reserved'>sizeof</strong> *tem);
<a id='L3310' name='L3310'></a>  3310           tem-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = toplevels[i];
<a id='L3311' name='L3311'></a>  3311           tem-&gt;dpy = dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>;
<a id='L3312' name='L3312'></a>  3312           tem-&gt;frame_extents_left = frame_extents[0];
<a id='L3313' name='L3313'></a>  3313           tem-&gt;frame_extents_right = frame_extents[1];
<a id='L3314' name='L3314'></a>  3314           tem-&gt;frame_extents_top = frame_extents[2];
<a id='L3315' name='L3315'></a>  3315           tem-&gt;frame_extents_bottom = frame_extents[3];
<a id='L3316' name='L3316'></a>  3316 
<a id='L3317' name='L3317'></a>  3317 <em class='sharp'>#ifndef</em> USE_XCB
<a id='L3318' name='L3318'></a>  3318           tem-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = dest_x;
<a id='L3319' name='L3319'></a>  3319           tem-&gt;y = dest_y;
<a id='L3320' name='L3320'></a>  3320           tem-&gt;width = attrs.width + attrs.border_width;
<a id='L3321' name='L3321'></a>  3321           tem-&gt;height = attrs.height + attrs.border_width;
<a id='L3322' name='L3322'></a>  3322           tem-&gt;mapped_p = (attrs.map_state != IsUnmapped);
<a id='L3323' name='L3323'></a>  3323 <em class='sharp'>#else</em>
<a id='L3324' name='L3324'></a>  3324           tem-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = (coordinates_reply-&gt;dst_x
<a id='L3325' name='L3325'></a>  3325                     - geometry_reply-&gt;border_width);
<a id='L3326' name='L3326'></a>  3326           tem-&gt;y = (coordinates_reply-&gt;dst_y
<a id='L3327' name='L3327'></a>  3327                     - geometry_reply-&gt;border_width);
<a id='L3328' name='L3328'></a>  3328           tem-&gt;width = (geometry_reply-&gt;width
<a id='L3329' name='L3329'></a>  3329                         + geometry_reply-&gt;border_width);
<a id='L3330' name='L3330'></a>  3330           tem-&gt;height = (geometry_reply-&gt;height
<a id='L3331' name='L3331'></a>  3331                          + geometry_reply-&gt;border_width);
<a id='L3332' name='L3332'></a>  3332           tem-&gt;mapped_p = (attrs.map_state != XCB_MAP_STATE_UNMAPPED);
<a id='L3333' name='L3333'></a>  3333 <em class='sharp'>#endif</em>
<a id='L3334' name='L3334'></a>  3334           tem-&gt;next = x_dnd_toplevels;
<a id='L3335' name='L3335'></a>  3335           tem-&gt;previous_event_mask = attrs.your_event_mask;
<a id='L3336' name='L3336'></a>  3336           tem-&gt;wm_state = wmstate[0];
<a id='L3337' name='L3337'></a>  3337           tem-&gt;xm_protocol_style = <a href='../S/2289.html#L1740' title='Defined at 1740 in src/xterm.c.'>XM_DRAG_STYLE_NONE</a>;
<a id='L3338' name='L3338'></a>  3338 
<a id='L3339' name='L3339'></a>  3339 <em class='sharp'>#ifndef</em> USE_XCB
<a id='L3340' name='L3340'></a>  3340           <strong class='reserved'>if</strong> (!<a href='../S/2289.html#L2776' title='Defined at 2776 in src/xterm.c.'>xm_read_drag_receiver_info</a> (dpyinfo, toplevels[i], &amp;xm_info))
<a id='L3341' name='L3341'></a>  3341             tem-&gt;xm_protocol_style = xm_info.protocol_style;
<a id='L3342' name='L3342'></a>  3342 <em class='sharp'>#else</em>
<a id='L3343' name='L3343'></a>  3343           <strong class='reserved'>if</strong> (xm_property_reply
<a id='L3344' name='L3344'></a>  3344               &amp;&amp; xm_property_reply-&gt;format == 8
<a id='L3345' name='L3345'></a>  3345               &amp;&amp; xm_property_reply-&gt;type == dpyinfo-&gt;Xatom_MOTIF_DRAG_RECEIVER_INFO
<a id='L3346' name='L3346'></a>  3346               &amp;&amp; xcb_get_property_value_length (xm_property_reply) &gt;= 4)
<a id='L3347' name='L3347'></a>  3347             <em class='brace'>{</em>
<a id='L3348' name='L3348'></a>  3348               xmdata = xcb_get_property_value (xm_property_reply);
<a id='L3349' name='L3349'></a>  3349 
<a id='L3350' name='L3350'></a>  3350               <strong class='reserved'>if</strong> (xmdata[1] &lt;= <a href='../S/2289.html#L1763' title='Defined at 1763 in src/xterm.c.'>XM_DRAG_PROTOCOL_VERSION</a>)
<a id='L3351' name='L3351'></a>  3351                 tem-&gt;xm_protocol_style = xmdata[2];
<a id='L3352' name='L3352'></a>  3352             <em class='brace'>}</em>
<a id='L3353' name='L3353'></a>  3353 <em class='sharp'>#endif</em>
<a id='L3354' name='L3354'></a>  3354 
<a id='L3355' name='L3355'></a>  3355 <em class='sharp'>#ifdef</em> HAVE_XSHAPE
<a id='L3356' name='L3356'></a>  3356 <em class='sharp'>#ifndef</em> USE_XCB
<a id='L3357' name='L3357'></a>  3357           tem-&gt;border_width = attrs.border_width;
<a id='L3358' name='L3358'></a>  3358 <em class='sharp'>#else</em>
<a id='L3359' name='L3359'></a>  3359           tem-&gt;border_width = geometry_reply-&gt;border_width;
<a id='L3360' name='L3360'></a>  3360 <em class='sharp'>#endif</em>
<a id='L3361' name='L3361'></a>  3361           tem-&gt;n_bounding_rects = -1;
<a id='L3362' name='L3362'></a>  3362           tem-&gt;n_input_rects = -1;
<a id='L3363' name='L3363'></a>  3363 
<a id='L3364' name='L3364'></a>  3364           <strong class='reserved'>if</strong> (dpyinfo-&gt;xshape_supported_p)
<a id='L3365' name='L3365'></a>  3365             <em class='brace'>{</em>
<a id='L3366' name='L3366'></a>  3366               x_ignore_errors_for_next_request (dpyinfo, 0);
<a id='L3367' name='L3367'></a>  3367               XShapeSelectInput (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L3368' name='L3368'></a>  3368                                  toplevels[i],
<a id='L3369' name='L3369'></a>  3369                                  ShapeNotifyMask);
<a id='L3370' name='L3370'></a>  3370               x_stop_ignoring_errors (dpyinfo);
<a id='L3371' name='L3371'></a>  3371 
<a id='L3372' name='L3372'></a>  3372 <em class='sharp'>#ifndef</em> HAVE_XCB_SHAPE
<a id='L3373' name='L3373'></a>  3373               x_catch_errors (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L3374' name='L3374'></a>  3374               rects = XShapeGetRectangles (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L3375' name='L3375'></a>  3375                                            toplevels[i],
<a id='L3376' name='L3376'></a>  3376                                            ShapeBounding,
<a id='L3377' name='L3377'></a>  3377                                            &amp;count, &amp;ordering);
<a id='L3378' name='L3378'></a>  3378               rc = x_had_errors_p (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L3379' name='L3379'></a>  3379               x_uncatch_errors_after_check ();
<a id='L3380' name='L3380'></a>  3380 
<a id='L3381' name='L3381'></a>  3381               <em class='comment'>/* Does XShapeGetRectangles allocate anything upon an</em>
<a id='L3382' name='L3382'></a>  3382 <em class='comment'>                 error?  */</em>
<a id='L3383' name='L3383'></a>  3383               <strong class='reserved'>if</strong> (!rc)
<a id='L3384' name='L3384'></a>  3384                 <em class='brace'>{</em>
<a id='L3385' name='L3385'></a>  3385                   tem-&gt;n_bounding_rects = count;
<a id='L3386' name='L3386'></a>  3386                   tem-&gt;bounding_rects
<a id='L3387' name='L3387'></a>  3387                     = <a href='../D/20068.html' title='Multiple defined in 10 places.'>xmalloc</a> (<strong class='reserved'>sizeof</strong> *tem-&gt;bounding_rects * count);
<a id='L3388' name='L3388'></a>  3388                   memcpy (tem-&gt;bounding_rects, rects,
<a id='L3389' name='L3389'></a>  3389                           <strong class='reserved'>sizeof</strong> *tem-&gt;bounding_rects * count);
<a id='L3390' name='L3390'></a>  3390 
<a id='L3391' name='L3391'></a>  3391                   XFree (rects);
<a id='L3392' name='L3392'></a>  3392                 <em class='brace'>}</em>
<a id='L3393' name='L3393'></a>  3393 <em class='sharp'>#else</em>
<a id='L3394' name='L3394'></a>  3394               bounding_rect_reply = xcb_shape_get_rectangles_reply (dpyinfo-&gt;xcb_connection,
<a id='L3395' name='L3395'></a>  3395                                                                     bounding_rect_cookies[i],
<a id='L3396' name='L3396'></a>  3396                                                                     &amp;<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L3397' name='L3397'></a>  3397 
<a id='L3398' name='L3398'></a>  3398               <strong class='reserved'>if</strong> (bounding_rect_reply)
<a id='L3399' name='L3399'></a>  3399                 <em class='brace'>{</em>
<a id='L3400' name='L3400'></a>  3400                   bounding_rect_iterator
<a id='L3401' name='L3401'></a>  3401                     = xcb_shape_get_rectangles_rectangles_iterator (bounding_rect_reply);
<a id='L3402' name='L3402'></a>  3402                   tem-&gt;n_bounding_rects = bounding_rect_iterator.rem + 1;
<a id='L3403' name='L3403'></a>  3403                   tem-&gt;bounding_rects = <a href='../D/20068.html' title='Multiple defined in 10 places.'>xmalloc</a> (tem-&gt;n_bounding_rects
<a id='L3404' name='L3404'></a>  3404                                                  * <strong class='reserved'>sizeof</strong> *tem-&gt;bounding_rects);
<a id='L3405' name='L3405'></a>  3405                   tem-&gt;n_bounding_rects = 0;
<a id='L3406' name='L3406'></a>  3406 
<a id='L3407' name='L3407'></a>  3407                   <strong class='reserved'>for</strong> (; bounding_rect_iterator.rem; xcb_rectangle_next (&amp;bounding_rect_iterator))
<a id='L3408' name='L3408'></a>  3408                     <em class='brace'>{</em>
<a id='L3409' name='L3409'></a>  3409                       tem-&gt;bounding_rects[tem-&gt;n_bounding_rects].<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>
<a id='L3410' name='L3410'></a>  3410                         = bounding_rect_iterator.data-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L3411' name='L3411'></a>  3411                       tem-&gt;bounding_rects[tem-&gt;n_bounding_rects].y
<a id='L3412' name='L3412'></a>  3412                         = bounding_rect_iterator.data-&gt;y;
<a id='L3413' name='L3413'></a>  3413                       tem-&gt;bounding_rects[tem-&gt;n_bounding_rects].width
<a id='L3414' name='L3414'></a>  3414                         = bounding_rect_iterator.data-&gt;width;
<a id='L3415' name='L3415'></a>  3415                       tem-&gt;bounding_rects[tem-&gt;n_bounding_rects].height
<a id='L3416' name='L3416'></a>  3416                         = bounding_rect_iterator.data-&gt;height;
<a id='L3417' name='L3417'></a>  3417 
<a id='L3418' name='L3418'></a>  3418                       tem-&gt;n_bounding_rects++;
<a id='L3419' name='L3419'></a>  3419                     <em class='brace'>}</em>
<a id='L3420' name='L3420'></a>  3420 
<a id='L3421' name='L3421'></a>  3421                   <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (bounding_rect_reply);
<a id='L3422' name='L3422'></a>  3422                 <em class='brace'>}</em>
<a id='L3423' name='L3423'></a>  3423               <strong class='reserved'>else</strong>
<a id='L3424' name='L3424'></a>  3424                 <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L3425' name='L3425'></a>  3425 <em class='sharp'>#endif</em>
<a id='L3426' name='L3426'></a>  3426 
<a id='L3427' name='L3427'></a>  3427 <em class='sharp'>#ifdef</em> <a href='../S/2289.html#L804' title='Defined at 804 in src/xterm.c.'>HAVE_XCB_SHAPE_INPUT_RECTS</a>
<a id='L3428' name='L3428'></a>  3428               <strong class='reserved'>if</strong> (dpyinfo-&gt;xshape_major &gt; 1
<a id='L3429' name='L3429'></a>  3429                   || (dpyinfo-&gt;xshape_major == 1
<a id='L3430' name='L3430'></a>  3430                       &amp;&amp; dpyinfo-&gt;xshape_minor &gt;= 1))
<a id='L3431' name='L3431'></a>  3431                 <em class='brace'>{</em>
<a id='L3432' name='L3432'></a>  3432                   input_rect_reply = xcb_shape_get_rectangles_reply (dpyinfo-&gt;xcb_connection,
<a id='L3433' name='L3433'></a>  3433                                                                      input_rect_cookies[i],
<a id='L3434' name='L3434'></a>  3434                                                                      &amp;<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L3435' name='L3435'></a>  3435 
<a id='L3436' name='L3436'></a>  3436                   <strong class='reserved'>if</strong> (input_rect_reply)
<a id='L3437' name='L3437'></a>  3437                     <em class='brace'>{</em>
<a id='L3438' name='L3438'></a>  3438                       input_rect_iterator
<a id='L3439' name='L3439'></a>  3439                         = xcb_shape_get_rectangles_rectangles_iterator (input_rect_reply);
<a id='L3440' name='L3440'></a>  3440                       tem-&gt;n_input_rects = input_rect_iterator.rem + 1;
<a id='L3441' name='L3441'></a>  3441                       tem-&gt;input_rects = <a href='../D/20068.html' title='Multiple defined in 10 places.'>xmalloc</a> (tem-&gt;n_input_rects
<a id='L3442' name='L3442'></a>  3442                                                   * <strong class='reserved'>sizeof</strong> *tem-&gt;input_rects);
<a id='L3443' name='L3443'></a>  3443                       tem-&gt;n_input_rects = 0;
<a id='L3444' name='L3444'></a>  3444 
<a id='L3445' name='L3445'></a>  3445                       <strong class='reserved'>for</strong> (; input_rect_iterator.rem; xcb_rectangle_next (&amp;input_rect_iterator))
<a id='L3446' name='L3446'></a>  3446                         <em class='brace'>{</em>
<a id='L3447' name='L3447'></a>  3447                           tem-&gt;input_rects[tem-&gt;n_input_rects].<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>
<a id='L3448' name='L3448'></a>  3448                             = input_rect_iterator.data-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L3449' name='L3449'></a>  3449                           tem-&gt;input_rects[tem-&gt;n_input_rects].y
<a id='L3450' name='L3450'></a>  3450                             = input_rect_iterator.data-&gt;y;
<a id='L3451' name='L3451'></a>  3451                           tem-&gt;input_rects[tem-&gt;n_input_rects].width
<a id='L3452' name='L3452'></a>  3452                             = input_rect_iterator.data-&gt;width;
<a id='L3453' name='L3453'></a>  3453                           tem-&gt;input_rects[tem-&gt;n_input_rects].height
<a id='L3454' name='L3454'></a>  3454                             = input_rect_iterator.data-&gt;height;
<a id='L3455' name='L3455'></a>  3455 
<a id='L3456' name='L3456'></a>  3456                           tem-&gt;n_input_rects++;
<a id='L3457' name='L3457'></a>  3457                         <em class='brace'>}</em>
<a id='L3458' name='L3458'></a>  3458 
<a id='L3459' name='L3459'></a>  3459                       <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (input_rect_reply);
<a id='L3460' name='L3460'></a>  3460                     <em class='brace'>}</em>
<a id='L3461' name='L3461'></a>  3461                   <strong class='reserved'>else</strong>
<a id='L3462' name='L3462'></a>  3462                     <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L3463' name='L3463'></a>  3463                 <em class='brace'>}</em>
<a id='L3464' name='L3464'></a>  3464 <em class='sharp'>#else</em>
<a id='L3465' name='L3465'></a>  3465 <em class='sharp'>#ifdef</em> ShapeInput
<a id='L3466' name='L3466'></a>  3466               <strong class='reserved'>if</strong> (dpyinfo-&gt;xshape_major &gt; 1
<a id='L3467' name='L3467'></a>  3467                   || (dpyinfo-&gt;xshape_major == 1
<a id='L3468' name='L3468'></a>  3468                       &amp;&amp; dpyinfo-&gt;xshape_minor &gt;= 1))
<a id='L3469' name='L3469'></a>  3469                 <em class='brace'>{</em>
<a id='L3470' name='L3470'></a>  3470                   x_catch_errors (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L3471' name='L3471'></a>  3471                   rects = XShapeGetRectangles (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L3472' name='L3472'></a>  3472                                                toplevels[i], ShapeInput,
<a id='L3473' name='L3473'></a>  3473                                                &amp;count, &amp;ordering);
<a id='L3474' name='L3474'></a>  3474                   rc = x_had_errors_p (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L3475' name='L3475'></a>  3475                   x_uncatch_errors_after_check ();
<a id='L3476' name='L3476'></a>  3476 
<a id='L3477' name='L3477'></a>  3477                   <em class='comment'>/* Does XShapeGetRectangles allocate anything upon</em>
<a id='L3478' name='L3478'></a>  3478 <em class='comment'>                     an error?  */</em>
<a id='L3479' name='L3479'></a>  3479                   <strong class='reserved'>if</strong> (!rc)
<a id='L3480' name='L3480'></a>  3480                     <em class='brace'>{</em>
<a id='L3481' name='L3481'></a>  3481                       tem-&gt;n_input_rects = count;
<a id='L3482' name='L3482'></a>  3482                       tem-&gt;input_rects
<a id='L3483' name='L3483'></a>  3483                         = <a href='../D/20068.html' title='Multiple defined in 10 places.'>xmalloc</a> (<strong class='reserved'>sizeof</strong> *tem-&gt;input_rects * count);
<a id='L3484' name='L3484'></a>  3484                       memcpy (tem-&gt;input_rects, rects,
<a id='L3485' name='L3485'></a>  3485                               <strong class='reserved'>sizeof</strong> *tem-&gt;input_rects * count);
<a id='L3486' name='L3486'></a>  3486 
<a id='L3487' name='L3487'></a>  3487                       XFree (rects);
<a id='L3488' name='L3488'></a>  3488                     <em class='brace'>}</em>
<a id='L3489' name='L3489'></a>  3489                 <em class='brace'>}</em>
<a id='L3490' name='L3490'></a>  3490 <em class='sharp'>#endif</em>
<a id='L3491' name='L3491'></a>  3491 <em class='sharp'>#endif</em>
<a id='L3492' name='L3492'></a>  3492             <em class='brace'>}</em>
<a id='L3493' name='L3493'></a>  3493 
<a id='L3494' name='L3494'></a>  3494           <em class='comment'>/* Handle the common case where the input shape equals the</em>
<a id='L3495' name='L3495'></a>  3495 <em class='comment'>             bounding shape.  */</em>
<a id='L3496' name='L3496'></a>  3496 
<a id='L3497' name='L3497'></a>  3497           <strong class='reserved'>if</strong> (tem-&gt;n_input_rects != -1
<a id='L3498' name='L3498'></a>  3498               &amp;&amp; tem-&gt;n_bounding_rects == tem-&gt;n_input_rects
<a id='L3499' name='L3499'></a>  3499               &amp;&amp; !memcmp (tem-&gt;bounding_rects, tem-&gt;input_rects,
<a id='L3500' name='L3500'></a>  3500                           tem-&gt;n_input_rects * <strong class='reserved'>sizeof</strong> *tem-&gt;input_rects))
<a id='L3501' name='L3501'></a>  3501             <em class='brace'>{</em>
<a id='L3502' name='L3502'></a>  3502               <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (tem-&gt;input_rects);
<a id='L3503' name='L3503'></a>  3503               tem-&gt;n_input_rects = -1;
<a id='L3504' name='L3504'></a>  3504             <em class='brace'>}</em>
<a id='L3505' name='L3505'></a>  3505 
<a id='L3506' name='L3506'></a>  3506           <em class='comment'>/* And the common case where there is no input rect and the</em>
<a id='L3507' name='L3507'></a>  3507 <em class='comment'>             bounding rect equals the window dimensions.  */</em>
<a id='L3508' name='L3508'></a>  3508 
<a id='L3509' name='L3509'></a>  3509           <strong class='reserved'>if</strong> (tem-&gt;n_input_rects == -1
<a id='L3510' name='L3510'></a>  3510               &amp;&amp; tem-&gt;n_bounding_rects == 1
<a id='L3511' name='L3511'></a>  3511 <em class='sharp'>#ifdef</em> USE_XCB
<a id='L3512' name='L3512'></a>  3512               &amp;&amp; tem-&gt;bounding_rects[0].width == (geometry_reply-&gt;width
<a id='L3513' name='L3513'></a>  3513                                                   + geometry_reply-&gt;border_width)
<a id='L3514' name='L3514'></a>  3514               &amp;&amp; tem-&gt;bounding_rects[0].height == (geometry_reply-&gt;height
<a id='L3515' name='L3515'></a>  3515                                                    + geometry_reply-&gt;border_width)
<a id='L3516' name='L3516'></a>  3516               &amp;&amp; tem-&gt;bounding_rects[0].<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> == -geometry_reply-&gt;border_width
<a id='L3517' name='L3517'></a>  3517               &amp;&amp; tem-&gt;bounding_rects[0].y == -geometry_reply-&gt;border_width
<a id='L3518' name='L3518'></a>  3518 <em class='sharp'>#else</em>
<a id='L3519' name='L3519'></a>  3519               &amp;&amp; tem-&gt;bounding_rects[0].width == attrs.width + attrs.border_width
<a id='L3520' name='L3520'></a>  3520               &amp;&amp; tem-&gt;bounding_rects[0].height == attrs.height + attrs.border_width
<a id='L3521' name='L3521'></a>  3521               &amp;&amp; tem-&gt;bounding_rects[0].<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> == -attrs.border_width
<a id='L3522' name='L3522'></a>  3522               &amp;&amp; tem-&gt;bounding_rects[0].y == -attrs.border_width
<a id='L3523' name='L3523'></a>  3523 <em class='sharp'>#endif</em>
<a id='L3524' name='L3524'></a>  3524               )
<a id='L3525' name='L3525'></a>  3525             <em class='brace'>{</em>
<a id='L3526' name='L3526'></a>  3526               <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (tem-&gt;bounding_rects);
<a id='L3527' name='L3527'></a>  3527               tem-&gt;n_bounding_rects = -1;
<a id='L3528' name='L3528'></a>  3528             <em class='brace'>}</em>
<a id='L3529' name='L3529'></a>  3529 <em class='sharp'>#endif</em>
<a id='L3530' name='L3530'></a>  3530 
<a id='L3531' name='L3531'></a>  3531           x_ignore_errors_for_next_request (dpyinfo, 0);
<a id='L3532' name='L3532'></a>  3532           XSelectInput (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, toplevels[i],
<a id='L3533' name='L3533'></a>  3533                         (attrs.your_event_mask
<a id='L3534' name='L3534'></a>  3534                          | StructureNotifyMask
<a id='L3535' name='L3535'></a>  3535                          | PropertyChangeMask));
<a id='L3536' name='L3536'></a>  3536           x_stop_ignoring_errors (dpyinfo);
<a id='L3537' name='L3537'></a>  3537 
<a id='L3538' name='L3538'></a>  3538           x_dnd_toplevels = tem;
<a id='L3539' name='L3539'></a>  3539         <em class='brace'>}</em>
<a id='L3540' name='L3540'></a>  3540       <strong class='reserved'>else</strong>
<a id='L3541' name='L3541'></a>  3541         <em class='brace'>{</em>
<a id='L3542' name='L3542'></a>  3542 <em class='sharp'>#ifdef</em> HAVE_XCB_SHAPE
<a id='L3543' name='L3543'></a>  3543           <strong class='reserved'>if</strong> (dpyinfo-&gt;xshape_supported_p)
<a id='L3544' name='L3544'></a>  3544             <em class='brace'>{</em>
<a id='L3545' name='L3545'></a>  3545               bounding_rect_reply = xcb_shape_get_rectangles_reply (dpyinfo-&gt;xcb_connection,
<a id='L3546' name='L3546'></a>  3546                                                                     bounding_rect_cookies[i],
<a id='L3547' name='L3547'></a>  3547                                                                     &amp;<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L3548' name='L3548'></a>  3548 
<a id='L3549' name='L3549'></a>  3549               <strong class='reserved'>if</strong> (bounding_rect_reply)
<a id='L3550' name='L3550'></a>  3550                 <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (bounding_rect_reply);
<a id='L3551' name='L3551'></a>  3551               <strong class='reserved'>else</strong>
<a id='L3552' name='L3552'></a>  3552                 <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L3553' name='L3553'></a>  3553             <em class='brace'>}</em>
<a id='L3554' name='L3554'></a>  3554 <em class='sharp'>#endif</em>
<a id='L3555' name='L3555'></a>  3555 
<a id='L3556' name='L3556'></a>  3556 <em class='sharp'>#ifdef</em> <a href='../S/2289.html#L804' title='Defined at 804 in src/xterm.c.'>HAVE_XCB_SHAPE_INPUT_RECTS</a>
<a id='L3557' name='L3557'></a>  3557           <strong class='reserved'>if</strong> (dpyinfo-&gt;xshape_supported_p
<a id='L3558' name='L3558'></a>  3558               &amp;&amp; (dpyinfo-&gt;xshape_major &gt; 1
<a id='L3559' name='L3559'></a>  3559                   || (dpyinfo-&gt;xshape_major == 1
<a id='L3560' name='L3560'></a>  3560                       &amp;&amp; dpyinfo-&gt;xshape_minor &gt;= 1)))
<a id='L3561' name='L3561'></a>  3561             <em class='brace'>{</em>
<a id='L3562' name='L3562'></a>  3562               input_rect_reply = xcb_shape_get_rectangles_reply (dpyinfo-&gt;xcb_connection,
<a id='L3563' name='L3563'></a>  3563                                                                  input_rect_cookies[i],
<a id='L3564' name='L3564'></a>  3564                                                                  &amp;<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L3565' name='L3565'></a>  3565 
<a id='L3566' name='L3566'></a>  3566               <strong class='reserved'>if</strong> (input_rect_reply)
<a id='L3567' name='L3567'></a>  3567                 <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (input_rect_reply);
<a id='L3568' name='L3568'></a>  3568               <strong class='reserved'>else</strong>
<a id='L3569' name='L3569'></a>  3569                 <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L3570' name='L3570'></a>  3570             <em class='brace'>}</em>
<a id='L3571' name='L3571'></a>  3571 <em class='sharp'>#endif</em>
<a id='L3572' name='L3572'></a>  3572         <em class='brace'>}</em>
<a id='L3573' name='L3573'></a>  3573 
<a id='L3574' name='L3574'></a>  3574 <em class='sharp'>#ifdef</em> USE_XCB
<a id='L3575' name='L3575'></a>  3575       <strong class='reserved'>if</strong> (attrs_reply)
<a id='L3576' name='L3576'></a>  3576         <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (attrs_reply);
<a id='L3577' name='L3577'></a>  3577 
<a id='L3578' name='L3578'></a>  3578       <strong class='reserved'>if</strong> (coordinates_reply)
<a id='L3579' name='L3579'></a>  3579         <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (coordinates_reply);
<a id='L3580' name='L3580'></a>  3580 
<a id='L3581' name='L3581'></a>  3581       <strong class='reserved'>if</strong> (property_reply)
<a id='L3582' name='L3582'></a>  3582         <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (property_reply);
<a id='L3583' name='L3583'></a>  3583 
<a id='L3584' name='L3584'></a>  3584       <strong class='reserved'>if</strong> (xm_property_reply)
<a id='L3585' name='L3585'></a>  3585         <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (xm_property_reply);
<a id='L3586' name='L3586'></a>  3586 
<a id='L3587' name='L3587'></a>  3587       <strong class='reserved'>if</strong> (geometry_reply)
<a id='L3588' name='L3588'></a>  3588         <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (geometry_reply);
<a id='L3589' name='L3589'></a>  3589 <em class='sharp'>#endif</em>
<a id='L3590' name='L3590'></a>  3590 
<a id='L3591' name='L3591'></a>  3591 <em class='sharp'>#ifndef</em> USE_XCB
<a id='L3592' name='L3592'></a>  3592       <strong class='reserved'>if</strong> (wmstate_data)
<a id='L3593' name='L3593'></a>  3593         <em class='brace'>{</em>
<a id='L3594' name='L3594'></a>  3594           XFree (wmstate_data);
<a id='L3595' name='L3595'></a>  3595           wmstate_data = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L3596' name='L3596'></a>  3596         <em class='brace'>}</em>
<a id='L3597' name='L3597'></a>  3597 <em class='sharp'>#endif</em>
<a id='L3598' name='L3598'></a>  3598     <em class='brace'>}</em>
<a id='L3599' name='L3599'></a>  3599 
<a id='L3600' name='L3600'></a>  3600 <em class='sharp'>#ifdef</em> USE_XCB
<a id='L3601' name='L3601'></a>  3601   <a href='../D/5394.html' title='Multiple defined in 2 places.'>SAFE_FREE</a> ();
<a id='L3602' name='L3602'></a>  3602 <em class='sharp'>#endif</em>
<a id='L3603' name='L3603'></a>  3603 
<a id='L3604' name='L3604'></a>  3604   <strong class='reserved'>if</strong> (data)
<a id='L3605' name='L3605'></a>  3605     XFree (data);
<a id='L3606' name='L3606'></a>  3606 
<a id='L3607' name='L3607'></a>  3607   <strong class='reserved'>return</strong> 0;
<a id='L3608' name='L3608'></a>  3608 <em class='brace'>}</em>
<a id='L3609' name='L3609'></a>  3609 
<a id='L3610' name='L3610'></a>  3610 <strong class='reserved'>static</strong> <strong class='reserved'>_Noreturn</strong> <strong class='reserved'>int</strong>
<a id='L3611' name='L3611'></a>  3611 <a href='../S/2289.html#L26232' title='Referred from 26232 in src/xterm.c.'>x_dnd_io_error_handler</a> (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>)
<a id='L3612' name='L3612'></a>  3612 <em class='brace'>{</em>
<a id='L3613' name='L3613'></a>  3613 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L3614' name='L3614'></a>  3614   <a href='../D/10893.html' title='Multiple defined in 6 places.'>emacs_abort</a> ();
<a id='L3615' name='L3615'></a>  3615 <em class='sharp'>#else</em>
<a id='L3616' name='L3616'></a>  3616   siglongjmp (x_dnd_disconnect_handler, 1);
<a id='L3617' name='L3617'></a>  3617 <em class='sharp'>#endif</em>
<a id='L3618' name='L3618'></a>  3618 <em class='brace'>}</em>
<a id='L3619' name='L3619'></a>  3619 
<a id='L3620' name='L3620'></a>  3620 <em class='sharp'>#define</em> <a href='../R/6666.html' title='Multiple referred from 2 places.'>X_DND_SUPPORTED_VERSION</a> 5
<a id='L3621' name='L3621'></a>  3621 
<a id='L3622' name='L3622'></a>  3622 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong> <a href='../S/2289.html#L4502' title='Defined at 4502 in src/xterm.c.'>x_dnd_get_window_proto</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a>);
<a id='L3623' name='L3623'></a>  3623 <strong class='reserved'>static</strong> <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> <a href='../S/2289.html#L4460' title='Defined at 4460 in src/xterm.c.'>x_dnd_get_window_proxy</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a>);
<a id='L3624' name='L3624'></a>  3624 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong> x_dnd_update_state (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *, <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a>);
<a id='L3625' name='L3625'></a>  3625 
<a id='L3626' name='L3626'></a>  3626 <em class='sharp'>#ifdef</em> USE_XCB
<a id='L3627' name='L3627'></a>  3627 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L3628' name='L3628'></a>  3628 <a href='../S/2289.html#L4186' title='Referred from 4186 in src/xterm.c.'>x_dnd_get_proxy_proto</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> wdesc,
<a id='L3629' name='L3629'></a>  3629                        <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> *proxy_out, <strong class='reserved'>int</strong> *proto_out)
<a id='L3630' name='L3630'></a>  3630 <em class='brace'>{</em>
<a id='L3631' name='L3631'></a>  3631   xcb_get_property_cookie_t xdnd_proto_cookie;
<a id='L3632' name='L3632'></a>  3632   xcb_get_property_cookie_t xdnd_proxy_cookie;
<a id='L3633' name='L3633'></a>  3633   xcb_get_property_reply_t *reply;
<a id='L3634' name='L3634'></a>  3634   xcb_generic_error_t *<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>;
<a id='L3635' name='L3635'></a>  3635 
<a id='L3636' name='L3636'></a>  3636   <strong class='reserved'>if</strong> (proxy_out)
<a id='L3637' name='L3637'></a>  3637     *proxy_out = None;
<a id='L3638' name='L3638'></a>  3638 
<a id='L3639' name='L3639'></a>  3639   <strong class='reserved'>if</strong> (proto_out)
<a id='L3640' name='L3640'></a>  3640     *proto_out = -1;
<a id='L3641' name='L3641'></a>  3641 
<a id='L3642' name='L3642'></a>  3642   <strong class='reserved'>if</strong> (proxy_out)
<a id='L3643' name='L3643'></a>  3643     xdnd_proxy_cookie = xcb_get_property (dpyinfo-&gt;xcb_connection, 0,
<a id='L3644' name='L3644'></a>  3644                                           (xcb_window_t) wdesc,
<a id='L3645' name='L3645'></a>  3645                                           (xcb_atom_t) dpyinfo-&gt;Xatom_XdndProxy,
<a id='L3646' name='L3646'></a>  3646                                           XA_WINDOW, 0, 1);
<a id='L3647' name='L3647'></a>  3647 
<a id='L3648' name='L3648'></a>  3648   <strong class='reserved'>if</strong> (proto_out)
<a id='L3649' name='L3649'></a>  3649     xdnd_proto_cookie = xcb_get_property (dpyinfo-&gt;xcb_connection, 0,
<a id='L3650' name='L3650'></a>  3650                                           (xcb_window_t) wdesc,
<a id='L3651' name='L3651'></a>  3651                                           (xcb_atom_t) dpyinfo-&gt;Xatom_XdndAware,
<a id='L3652' name='L3652'></a>  3652                                           XA_ATOM, 0, 1);
<a id='L3653' name='L3653'></a>  3653 
<a id='L3654' name='L3654'></a>  3654   <strong class='reserved'>if</strong> (proxy_out)
<a id='L3655' name='L3655'></a>  3655     <em class='brace'>{</em>
<a id='L3656' name='L3656'></a>  3656       reply = xcb_get_property_reply (dpyinfo-&gt;xcb_connection,
<a id='L3657' name='L3657'></a>  3657                                       xdnd_proxy_cookie, &amp;<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L3658' name='L3658'></a>  3658 
<a id='L3659' name='L3659'></a>  3659       <strong class='reserved'>if</strong> (!reply)
<a id='L3660' name='L3660'></a>  3660         <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L3661' name='L3661'></a>  3661       <strong class='reserved'>else</strong>
<a id='L3662' name='L3662'></a>  3662         <em class='brace'>{</em>
<a id='L3663' name='L3663'></a>  3663           <strong class='reserved'>if</strong> (reply-&gt;format == 32
<a id='L3664' name='L3664'></a>  3664               &amp;&amp; reply-&gt;type == XA_WINDOW
<a id='L3665' name='L3665'></a>  3665               &amp;&amp; (xcb_get_property_value_length (reply) &gt;= 4))
<a id='L3666' name='L3666'></a>  3666             *proxy_out = *(xcb_window_t *) xcb_get_property_value (reply);
<a id='L3667' name='L3667'></a>  3667 
<a id='L3668' name='L3668'></a>  3668           <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (reply);
<a id='L3669' name='L3669'></a>  3669         <em class='brace'>}</em>
<a id='L3670' name='L3670'></a>  3670     <em class='brace'>}</em>
<a id='L3671' name='L3671'></a>  3671 
<a id='L3672' name='L3672'></a>  3672   <strong class='reserved'>if</strong> (proto_out)
<a id='L3673' name='L3673'></a>  3673     <em class='brace'>{</em>
<a id='L3674' name='L3674'></a>  3674       reply = xcb_get_property_reply (dpyinfo-&gt;xcb_connection,
<a id='L3675' name='L3675'></a>  3675                                       xdnd_proto_cookie, &amp;<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L3676' name='L3676'></a>  3676 
<a id='L3677' name='L3677'></a>  3677       <strong class='reserved'>if</strong> (!reply)
<a id='L3678' name='L3678'></a>  3678         <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L3679' name='L3679'></a>  3679       <strong class='reserved'>else</strong>
<a id='L3680' name='L3680'></a>  3680         <em class='brace'>{</em>
<a id='L3681' name='L3681'></a>  3681           <strong class='reserved'>if</strong> (reply-&gt;format == 32
<a id='L3682' name='L3682'></a>  3682               &amp;&amp; reply-&gt;type == XA_ATOM
<a id='L3683' name='L3683'></a>  3683               &amp;&amp; (xcb_get_property_value_length (reply) &gt;= 4))
<a id='L3684' name='L3684'></a>  3684             *proto_out = (<strong class='reserved'>int</strong>) *(xcb_atom_t *) xcb_get_property_value (reply);
<a id='L3685' name='L3685'></a>  3685 
<a id='L3686' name='L3686'></a>  3686           <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (reply);
<a id='L3687' name='L3687'></a>  3687         <em class='brace'>}</em>
<a id='L3688' name='L3688'></a>  3688     <em class='brace'>}</em>
<a id='L3689' name='L3689'></a>  3689 <em class='brace'>}</em>
<a id='L3690' name='L3690'></a>  3690 <em class='sharp'>#endif</em>
<a id='L3691' name='L3691'></a>  3691 
<a id='L3692' name='L3692'></a>  3692 <em class='sharp'>#ifdef</em> HAVE_XSHAPE
<a id='L3693' name='L3693'></a>  3693 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L3694' name='L3694'></a>  3694 <a href='../R/18134.html' title='Multiple referred from 2 places.'>x_dnd_get_target_window_2</a> (<a href='../S/2150.html#L62' title='Defined at 62 in src/pgtkgui.h.'>XRectangle</a> *rects, <strong class='reserved'>int</strong> nrects,
<a id='L3695' name='L3695'></a>  3695                            <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, <strong class='reserved'>int</strong> y)
<a id='L3696' name='L3696'></a>  3696 <em class='brace'>{</em>
<a id='L3697' name='L3697'></a>  3697   <strong class='reserved'>int</strong> i;
<a id='L3698' name='L3698'></a>  3698   <a href='../S/2150.html#L62' title='Defined at 62 in src/pgtkgui.h.'>XRectangle</a> *tem;
<a id='L3699' name='L3699'></a>  3699 
<a id='L3700' name='L3700'></a>  3700   <strong class='reserved'>for</strong> (i = 0; i &lt; nrects; ++i)
<a id='L3701' name='L3701'></a>  3701     <em class='brace'>{</em>
<a id='L3702' name='L3702'></a>  3702       tem = &amp;rects[i];
<a id='L3703' name='L3703'></a>  3703 
<a id='L3704' name='L3704'></a>  3704       <strong class='reserved'>if</strong> (<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> &gt;= tem-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> &amp;&amp; y &gt;= tem-&gt;y
<a id='L3705' name='L3705'></a>  3705           &amp;&amp; <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> &lt; tem-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + tem-&gt;width
<a id='L3706' name='L3706'></a>  3706           &amp;&amp; y &lt; tem-&gt;y + tem-&gt;height)
<a id='L3707' name='L3707'></a>  3707         <strong class='reserved'>return</strong> <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L3708' name='L3708'></a>  3708     <em class='brace'>}</em>
<a id='L3709' name='L3709'></a>  3709 
<a id='L3710' name='L3710'></a>  3710   <strong class='reserved'>return</strong> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L3711' name='L3711'></a>  3711 <em class='brace'>}</em>
<a id='L3712' name='L3712'></a>  3712 <em class='sharp'>#endif</em>
<a id='L3713' name='L3713'></a>  3713 
<a id='L3714' name='L3714'></a>  3714 <strong class='reserved'>static</strong> <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a>
<a id='L3715' name='L3715'></a>  3715 <a href='../S/2289.html#L4160' title='Referred from 4160 in src/xterm.c.'>x_dnd_get_target_window_1</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L3716' name='L3716'></a>  3716                            <strong class='reserved'>int</strong> root_x, <strong class='reserved'>int</strong> root_y, <strong class='reserved'>int</strong> *motif_out,
<a id='L3717' name='L3717'></a>  3717                            <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> *extents_p)
<a id='L3718' name='L3718'></a>  3718 <em class='brace'>{</em>
<a id='L3719' name='L3719'></a>  3719   <strong class='reserved'>struct</strong> <a href='../S/2289.html#L1484' title='Defined at 1484 in src/xterm.c.'>x_client_list_window</a> *tem, *chosen = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L3720' name='L3720'></a>  3720 
<a id='L3721' name='L3721'></a>  3721   <em class='comment'>/* Loop through x_dnd_toplevels until we find the toplevel where</em>
<a id='L3722' name='L3722'></a>  3722 <em class='comment'>     root_x and root_y are.  */</em>
<a id='L3723' name='L3723'></a>  3723 
<a id='L3724' name='L3724'></a>  3724   *motif_out = <a href='../S/2289.html#L1740' title='Defined at 1740 in src/xterm.c.'>XM_DRAG_STYLE_NONE</a>;
<a id='L3725' name='L3725'></a>  3725 
<a id='L3726' name='L3726'></a>  3726   <strong class='reserved'>for</strong> (tem = x_dnd_toplevels; tem; tem = tem-&gt;next)
<a id='L3727' name='L3727'></a>  3727     <em class='brace'>{</em>
<a id='L3728' name='L3728'></a>  3728       <strong class='reserved'>if</strong> (!tem-&gt;mapped_p || tem-&gt;wm_state != NormalState)
<a id='L3729' name='L3729'></a>  3729         <strong class='reserved'>continue</strong>;
<a id='L3730' name='L3730'></a>  3730 
<a id='L3731' name='L3731'></a>  3731       <em class='comment'>/* Test if the coordinates are inside the window's frame</em>
<a id='L3732' name='L3732'></a>  3732 <em class='comment'>         extents, and return None in that case.  */</em>
<a id='L3733' name='L3733'></a>  3733 
<a id='L3734' name='L3734'></a>  3734       *extents_p = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L3735' name='L3735'></a>  3735       <strong class='reserved'>if</strong> (root_x &gt; tem-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> - tem-&gt;frame_extents_left
<a id='L3736' name='L3736'></a>  3736           &amp;&amp; root_x &lt; tem-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>
<a id='L3737' name='L3737'></a>  3737           &amp;&amp; root_y &gt; tem-&gt;y - tem-&gt;frame_extents_top
<a id='L3738' name='L3738'></a>  3738           &amp;&amp; root_y &lt; (tem-&gt;y + tem-&gt;height - 1
<a id='L3739' name='L3739'></a>  3739                        + tem-&gt;frame_extents_bottom))
<a id='L3740' name='L3740'></a>  3740         <strong class='reserved'>return</strong> None;
<a id='L3741' name='L3741'></a>  3741 
<a id='L3742' name='L3742'></a>  3742       <strong class='reserved'>if</strong> (root_x &gt; tem-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + tem-&gt;width
<a id='L3743' name='L3743'></a>  3743           &amp;&amp; root_x &lt; (tem-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + tem-&gt;width - 1
<a id='L3744' name='L3744'></a>  3744                        + tem-&gt;frame_extents_right)
<a id='L3745' name='L3745'></a>  3745           &amp;&amp; root_y &gt; tem-&gt;y - tem-&gt;frame_extents_top
<a id='L3746' name='L3746'></a>  3746           &amp;&amp; root_y &lt; (tem-&gt;y + tem-&gt;height - 1
<a id='L3747' name='L3747'></a>  3747                        + tem-&gt;frame_extents_bottom))
<a id='L3748' name='L3748'></a>  3748         <strong class='reserved'>return</strong> None;
<a id='L3749' name='L3749'></a>  3749 
<a id='L3750' name='L3750'></a>  3750       <strong class='reserved'>if</strong> (root_y &gt; tem-&gt;y - tem-&gt;frame_extents_top
<a id='L3751' name='L3751'></a>  3751           &amp;&amp; root_y &lt; tem-&gt;y
<a id='L3752' name='L3752'></a>  3752           &amp;&amp; root_x &gt; tem-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> - tem-&gt;frame_extents_left
<a id='L3753' name='L3753'></a>  3753           &amp;&amp; root_x &lt; (tem-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + tem-&gt;width - 1
<a id='L3754' name='L3754'></a>  3754                        + tem-&gt;frame_extents_right))
<a id='L3755' name='L3755'></a>  3755         <strong class='reserved'>return</strong> None;
<a id='L3756' name='L3756'></a>  3756 
<a id='L3757' name='L3757'></a>  3757       <strong class='reserved'>if</strong> (root_y &gt; tem-&gt;y + tem-&gt;height
<a id='L3758' name='L3758'></a>  3758           &amp;&amp; root_y &lt; (tem-&gt;y + tem-&gt;height - 1
<a id='L3759' name='L3759'></a>  3759                        + tem-&gt;frame_extents_bottom)
<a id='L3760' name='L3760'></a>  3760           &amp;&amp; root_x &gt;= tem-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> - tem-&gt;frame_extents_left
<a id='L3761' name='L3761'></a>  3761           &amp;&amp; root_x &lt; (tem-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + tem-&gt;width - 1
<a id='L3762' name='L3762'></a>  3762                        + tem-&gt;frame_extents_right))
<a id='L3763' name='L3763'></a>  3763         <strong class='reserved'>return</strong> None;
<a id='L3764' name='L3764'></a>  3764       *extents_p = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L3765' name='L3765'></a>  3765 
<a id='L3766' name='L3766'></a>  3766       <strong class='reserved'>if</strong> (root_x &gt;= tem-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> &amp;&amp; root_y &gt;= tem-&gt;y
<a id='L3767' name='L3767'></a>  3767           &amp;&amp; root_x &lt; tem-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + tem-&gt;width
<a id='L3768' name='L3768'></a>  3768           &amp;&amp; root_y &lt; tem-&gt;y + tem-&gt;height)
<a id='L3769' name='L3769'></a>  3769         <em class='brace'>{</em>
<a id='L3770' name='L3770'></a>  3770 <em class='sharp'>#ifdef</em> HAVE_XSHAPE
<a id='L3771' name='L3771'></a>  3771           <strong class='reserved'>if</strong> (tem-&gt;n_bounding_rects == -1)
<a id='L3772' name='L3772'></a>  3772 <em class='sharp'>#endif</em>
<a id='L3773' name='L3773'></a>  3773             <em class='brace'>{</em>
<a id='L3774' name='L3774'></a>  3774               chosen = tem;
<a id='L3775' name='L3775'></a>  3775               <strong class='reserved'>break</strong>;
<a id='L3776' name='L3776'></a>  3776             <em class='brace'>}</em>
<a id='L3777' name='L3777'></a>  3777 
<a id='L3778' name='L3778'></a>  3778 <em class='sharp'>#ifdef</em> HAVE_XSHAPE
<a id='L3779' name='L3779'></a>  3779           <strong class='reserved'>if</strong> (<a href='../S/2289.html#L3694' title='Defined at 3694 in src/xterm.c.'>x_dnd_get_target_window_2</a> (tem-&gt;bounding_rects,
<a id='L3780' name='L3780'></a>  3780                                          tem-&gt;n_bounding_rects,
<a id='L3781' name='L3781'></a>  3781                                          tem-&gt;border_width + root_x - tem-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>,
<a id='L3782' name='L3782'></a>  3782                                          tem-&gt;border_width + root_y - tem-&gt;y))
<a id='L3783' name='L3783'></a>  3783             <em class='brace'>{</em>
<a id='L3784' name='L3784'></a>  3784               <strong class='reserved'>if</strong> (tem-&gt;n_input_rects == -1
<a id='L3785' name='L3785'></a>  3785                   || <a href='../S/2289.html#L3694' title='Defined at 3694 in src/xterm.c.'>x_dnd_get_target_window_2</a> (tem-&gt;input_rects,
<a id='L3786' name='L3786'></a>  3786                                                 tem-&gt;n_input_rects,
<a id='L3787' name='L3787'></a>  3787                                                 tem-&gt;border_width + root_x - tem-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>,
<a id='L3788' name='L3788'></a>  3788                                                 tem-&gt;border_width + root_y - tem-&gt;y))
<a id='L3789' name='L3789'></a>  3789                 <em class='brace'>{</em>
<a id='L3790' name='L3790'></a>  3790                   chosen = tem;
<a id='L3791' name='L3791'></a>  3791                   <strong class='reserved'>break</strong>;
<a id='L3792' name='L3792'></a>  3792                 <em class='brace'>}</em>
<a id='L3793' name='L3793'></a>  3793             <em class='brace'>}</em>
<a id='L3794' name='L3794'></a>  3794 <em class='sharp'>#endif</em>
<a id='L3795' name='L3795'></a>  3795         <em class='brace'>}</em>
<a id='L3796' name='L3796'></a>  3796     <em class='brace'>}</em>
<a id='L3797' name='L3797'></a>  3797 
<a id='L3798' name='L3798'></a>  3798   <strong class='reserved'>if</strong> (chosen)
<a id='L3799' name='L3799'></a>  3799     <em class='brace'>{</em>
<a id='L3800' name='L3800'></a>  3800       *motif_out = (x_dnd_disable_motif_protocol
<a id='L3801' name='L3801'></a>  3801                     ? <a href='../S/2289.html#L1740' title='Defined at 1740 in src/xterm.c.'>XM_DRAG_STYLE_NONE</a>
<a id='L3802' name='L3802'></a>  3802                     : chosen-&gt;xm_protocol_style);
<a id='L3803' name='L3803'></a>  3803       <strong class='reserved'>return</strong> chosen-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>;
<a id='L3804' name='L3804'></a>  3804     <em class='brace'>}</em>
<a id='L3805' name='L3805'></a>  3805   <strong class='reserved'>else</strong>
<a id='L3806' name='L3806'></a>  3806     *motif_out = <a href='../S/2289.html#L1740' title='Defined at 1740 in src/xterm.c.'>XM_DRAG_STYLE_NONE</a>;
<a id='L3807' name='L3807'></a>  3807 
<a id='L3808' name='L3808'></a>  3808   <strong class='reserved'>return</strong> None;
<a id='L3809' name='L3809'></a>  3809 <em class='brace'>}</em>
<a id='L3810' name='L3810'></a>  3810 
<a id='L3811' name='L3811'></a>  3811 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L3812' name='L3812'></a>  3812 <a href='../S/2289.html#L4334' title='Referred from 4334 in src/xterm.c.'>x_dnd_get_wm_state_and_proto</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L3813' name='L3813'></a>  3813                               <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, <strong class='reserved'>int</strong> *wmstate_out,
<a id='L3814' name='L3814'></a>  3814                               <strong class='reserved'>int</strong> *proto_out, <strong class='reserved'>int</strong> *motif_out,
<a id='L3815' name='L3815'></a>  3815                               <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> *proxy_out)
<a id='L3816' name='L3816'></a>  3816 <em class='brace'>{</em>
<a id='L3817' name='L3817'></a>  3817 <em class='sharp'>#ifndef</em> USE_XCB
<a id='L3818' name='L3818'></a>  3818   Atom type;
<a id='L3819' name='L3819'></a>  3819   <strong class='reserved'>int</strong> format;
<a id='L3820' name='L3820'></a>  3820   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> nitems, bytes_after;
<a id='L3821' name='L3821'></a>  3821   <strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *data = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L3822' name='L3822'></a>  3822   <a href='../D/20013.html' title='Multiple defined in 2 places.'>xm_drag_receiver_info</a> xm_info;
<a id='L3823' name='L3823'></a>  3823 <em class='sharp'>#else</em>
<a id='L3824' name='L3824'></a>  3824   xcb_get_property_cookie_t wmstate_cookie;
<a id='L3825' name='L3825'></a>  3825   xcb_get_property_cookie_t xdnd_proto_cookie;
<a id='L3826' name='L3826'></a>  3826   xcb_get_property_cookie_t xdnd_proxy_cookie;
<a id='L3827' name='L3827'></a>  3827   xcb_get_property_cookie_t xm_style_cookie;
<a id='L3828' name='L3828'></a>  3828   xcb_get_property_reply_t *reply;
<a id='L3829' name='L3829'></a>  3829   xcb_generic_error_t *<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>;
<a id='L3830' name='L3830'></a>  3830   <a href='../D/18594.html' title='Multiple defined in 2 places.'>uint8_t</a> *xmdata;
<a id='L3831' name='L3831'></a>  3831 <em class='sharp'>#endif</em>
<a id='L3832' name='L3832'></a>  3832   <strong class='reserved'>int</strong> rc;
<a id='L3833' name='L3833'></a>  3833 
<a id='L3834' name='L3834'></a>  3834 <em class='sharp'>#ifndef</em> USE_XCB
<a id='L3835' name='L3835'></a>  3835   x_catch_errors (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L3836' name='L3836'></a>  3836   rc = ((XGetWindowProperty (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>,
<a id='L3837' name='L3837'></a>  3837                              dpyinfo-&gt;Xatom_wm_state,
<a id='L3838' name='L3838'></a>  3838                              0, 2, False, AnyPropertyType,
<a id='L3839' name='L3839'></a>  3839                              &amp;type, &amp;format, &amp;nitems,
<a id='L3840' name='L3840'></a>  3840                              &amp;bytes_after, &amp;data)
<a id='L3841' name='L3841'></a>  3841          == Success)
<a id='L3842' name='L3842'></a>  3842         &amp;&amp; !x_had_errors_p (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>)
<a id='L3843' name='L3843'></a>  3843         &amp;&amp; data &amp;&amp; nitems == 2 &amp;&amp; format == 32);
<a id='L3844' name='L3844'></a>  3844   x_uncatch_errors ();
<a id='L3845' name='L3845'></a>  3845 
<a id='L3846' name='L3846'></a>  3846   <strong class='reserved'>if</strong> (rc)
<a id='L3847' name='L3847'></a>  3847     *wmstate_out = *(<strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> *) data;
<a id='L3848' name='L3848'></a>  3848 
<a id='L3849' name='L3849'></a>  3849   *proto_out = <a href='../S/2289.html#L4502' title='Defined at 4502 in src/xterm.c.'>x_dnd_get_window_proto</a> (dpyinfo, <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L3850' name='L3850'></a>  3850 
<a id='L3851' name='L3851'></a>  3851   <strong class='reserved'>if</strong> (!<a href='../S/2289.html#L2776' title='Defined at 2776 in src/xterm.c.'>xm_read_drag_receiver_info</a> (dpyinfo, <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, &amp;xm_info))
<a id='L3852' name='L3852'></a>  3852     *motif_out = xm_info.protocol_style;
<a id='L3853' name='L3853'></a>  3853   <strong class='reserved'>else</strong>
<a id='L3854' name='L3854'></a>  3854     *motif_out = <a href='../S/2289.html#L1740' title='Defined at 1740 in src/xterm.c.'>XM_DRAG_STYLE_NONE</a>;
<a id='L3855' name='L3855'></a>  3855 
<a id='L3856' name='L3856'></a>  3856   *proxy_out = <a href='../S/2289.html#L4460' title='Defined at 4460 in src/xterm.c.'>x_dnd_get_window_proxy</a> (dpyinfo, <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L3857' name='L3857'></a>  3857 
<a id='L3858' name='L3858'></a>  3858   <strong class='reserved'>if</strong> (data)
<a id='L3859' name='L3859'></a>  3859     XFree (data);
<a id='L3860' name='L3860'></a>  3860 <em class='sharp'>#else</em>
<a id='L3861' name='L3861'></a>  3861   rc = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L3862' name='L3862'></a>  3862 
<a id='L3863' name='L3863'></a>  3863   wmstate_cookie = xcb_get_property (dpyinfo-&gt;xcb_connection, 0,
<a id='L3864' name='L3864'></a>  3864                                      (xcb_window_t) <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>,
<a id='L3865' name='L3865'></a>  3865                                      (xcb_atom_t) dpyinfo-&gt;Xatom_wm_state,
<a id='L3866' name='L3866'></a>  3866                                      0, 0, 2);
<a id='L3867' name='L3867'></a>  3867   xdnd_proto_cookie = xcb_get_property (dpyinfo-&gt;xcb_connection, 0,
<a id='L3868' name='L3868'></a>  3868                                         (xcb_window_t) <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>,
<a id='L3869' name='L3869'></a>  3869                                         (xcb_atom_t) dpyinfo-&gt;Xatom_XdndAware,
<a id='L3870' name='L3870'></a>  3870                                         XA_ATOM, 0, 1);
<a id='L3871' name='L3871'></a>  3871   xdnd_proxy_cookie = xcb_get_property (dpyinfo-&gt;xcb_connection, 0,
<a id='L3872' name='L3872'></a>  3872                                         (xcb_window_t) <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>,
<a id='L3873' name='L3873'></a>  3873                                         (xcb_atom_t) dpyinfo-&gt;Xatom_XdndProxy,
<a id='L3874' name='L3874'></a>  3874                                         XA_WINDOW, 0, 1);
<a id='L3875' name='L3875'></a>  3875   xm_style_cookie = xcb_get_property (dpyinfo-&gt;xcb_connection, 0,
<a id='L3876' name='L3876'></a>  3876                                       (xcb_window_t) <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>,
<a id='L3877' name='L3877'></a>  3877                                       (xcb_atom_t) dpyinfo-&gt;Xatom_MOTIF_DRAG_RECEIVER_INFO,
<a id='L3878' name='L3878'></a>  3878                                       (xcb_atom_t) dpyinfo-&gt;Xatom_MOTIF_DRAG_RECEIVER_INFO,
<a id='L3879' name='L3879'></a>  3879                                       0, 4);
<a id='L3880' name='L3880'></a>  3880 
<a id='L3881' name='L3881'></a>  3881   reply = xcb_get_property_reply (dpyinfo-&gt;xcb_connection,
<a id='L3882' name='L3882'></a>  3882                                   wmstate_cookie, &amp;<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L3883' name='L3883'></a>  3883 
<a id='L3884' name='L3884'></a>  3884   <strong class='reserved'>if</strong> (!reply)
<a id='L3885' name='L3885'></a>  3885     <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>), rc = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L3886' name='L3886'></a>  3886   <strong class='reserved'>else</strong>
<a id='L3887' name='L3887'></a>  3887     <em class='brace'>{</em>
<a id='L3888' name='L3888'></a>  3888       <strong class='reserved'>if</strong> (reply-&gt;format != 32
<a id='L3889' name='L3889'></a>  3889           || xcb_get_property_value_length (reply) != 8)
<a id='L3890' name='L3890'></a>  3890         rc = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L3891' name='L3891'></a>  3891       <strong class='reserved'>else</strong>
<a id='L3892' name='L3892'></a>  3892         *wmstate_out = *(<a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> *) xcb_get_property_value (reply);
<a id='L3893' name='L3893'></a>  3893 
<a id='L3894' name='L3894'></a>  3894       <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (reply);
<a id='L3895' name='L3895'></a>  3895     <em class='brace'>}</em>
<a id='L3896' name='L3896'></a>  3896 
<a id='L3897' name='L3897'></a>  3897   reply = xcb_get_property_reply (dpyinfo-&gt;xcb_connection,
<a id='L3898' name='L3898'></a>  3898                                   xdnd_proto_cookie, &amp;<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L3899' name='L3899'></a>  3899 
<a id='L3900' name='L3900'></a>  3900   *proto_out = -1;
<a id='L3901' name='L3901'></a>  3901   <strong class='reserved'>if</strong> (!reply)
<a id='L3902' name='L3902'></a>  3902     <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L3903' name='L3903'></a>  3903   <strong class='reserved'>else</strong>
<a id='L3904' name='L3904'></a>  3904     <em class='brace'>{</em>
<a id='L3905' name='L3905'></a>  3905       <strong class='reserved'>if</strong> (reply-&gt;format == 32
<a id='L3906' name='L3906'></a>  3906           &amp;&amp; xcb_get_property_value_length (reply) &gt;= 4)
<a id='L3907' name='L3907'></a>  3907         *proto_out = *(<a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> *) xcb_get_property_value (reply);
<a id='L3908' name='L3908'></a>  3908 
<a id='L3909' name='L3909'></a>  3909       <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (reply);
<a id='L3910' name='L3910'></a>  3910     <em class='brace'>}</em>
<a id='L3911' name='L3911'></a>  3911 
<a id='L3912' name='L3912'></a>  3912   *proxy_out = None;
<a id='L3913' name='L3913'></a>  3913   reply = xcb_get_property_reply (dpyinfo-&gt;xcb_connection,
<a id='L3914' name='L3914'></a>  3914                                   xdnd_proxy_cookie, &amp;<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L3915' name='L3915'></a>  3915 
<a id='L3916' name='L3916'></a>  3916   <strong class='reserved'>if</strong> (!reply)
<a id='L3917' name='L3917'></a>  3917     <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L3918' name='L3918'></a>  3918   <strong class='reserved'>else</strong>
<a id='L3919' name='L3919'></a>  3919     <em class='brace'>{</em>
<a id='L3920' name='L3920'></a>  3920       <strong class='reserved'>if</strong> (reply-&gt;format == 32
<a id='L3921' name='L3921'></a>  3921           &amp;&amp; reply-&gt;type == XA_WINDOW
<a id='L3922' name='L3922'></a>  3922           &amp;&amp; (xcb_get_property_value_length (reply) &gt;= 4))
<a id='L3923' name='L3923'></a>  3923         *proxy_out = *(xcb_window_t *) xcb_get_property_value (reply);
<a id='L3924' name='L3924'></a>  3924 
<a id='L3925' name='L3925'></a>  3925       <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (reply);
<a id='L3926' name='L3926'></a>  3926     <em class='brace'>}</em>
<a id='L3927' name='L3927'></a>  3927 
<a id='L3928' name='L3928'></a>  3928   *motif_out = <a href='../S/2289.html#L1740' title='Defined at 1740 in src/xterm.c.'>XM_DRAG_STYLE_NONE</a>;
<a id='L3929' name='L3929'></a>  3929 
<a id='L3930' name='L3930'></a>  3930   reply = xcb_get_property_reply (dpyinfo-&gt;xcb_connection,
<a id='L3931' name='L3931'></a>  3931                                   xm_style_cookie, &amp;<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L3932' name='L3932'></a>  3932 
<a id='L3933' name='L3933'></a>  3933   <strong class='reserved'>if</strong> (!reply)
<a id='L3934' name='L3934'></a>  3934     <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L3935' name='L3935'></a>  3935  <strong class='reserved'>else</strong>
<a id='L3936' name='L3936'></a>  3936    <em class='brace'>{</em>
<a id='L3937' name='L3937'></a>  3937      <strong class='reserved'>if</strong> (reply-&gt;format == 8
<a id='L3938' name='L3938'></a>  3938          &amp;&amp; reply-&gt;type == dpyinfo-&gt;Xatom_MOTIF_DRAG_RECEIVER_INFO
<a id='L3939' name='L3939'></a>  3939          &amp;&amp; xcb_get_property_value_length (reply) &gt;= 4)
<a id='L3940' name='L3940'></a>  3940        <em class='brace'>{</em>
<a id='L3941' name='L3941'></a>  3941          xmdata = xcb_get_property_value (reply);
<a id='L3942' name='L3942'></a>  3942          *motif_out = xmdata[2];
<a id='L3943' name='L3943'></a>  3943        <em class='brace'>}</em>
<a id='L3944' name='L3944'></a>  3944 
<a id='L3945' name='L3945'></a>  3945      <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (reply);
<a id='L3946' name='L3946'></a>  3946    <em class='brace'>}</em>
<a id='L3947' name='L3947'></a>  3947 <em class='sharp'>#endif</em>
<a id='L3948' name='L3948'></a>  3948 
<a id='L3949' name='L3949'></a>  3949   <strong class='reserved'>return</strong> rc;
<a id='L3950' name='L3950'></a>  3950 <em class='brace'>}</em>
<a id='L3951' name='L3951'></a>  3951 
<a id='L3952' name='L3952'></a>  3952 <em class='comment'>/* From the XDND protocol specification:</em>
<a id='L3953' name='L3953'></a>  3953 <em class='comment'></em>
<a id='L3954' name='L3954'></a>  3954 <em class='comment'>   Dropping on windows that do not support XDND</em>
<a id='L3955' name='L3955'></a>  3955 <em class='comment'></em>
<a id='L3956' name='L3956'></a>  3956 <em class='comment'>   Since middle clicking is the universal shortcut for pasting</em>
<a id='L3957' name='L3957'></a>  3957 <em class='comment'>   in X, one can drop data into a window that does not support</em>
<a id='L3958' name='L3958'></a>  3958 <em class='comment'>   XDND by:</em>
<a id='L3959' name='L3959'></a>  3959 <em class='comment'></em>
<a id='L3960' name='L3960'></a>  3960 <em class='comment'>   1. After the mouse has been released to trigger the drop,</em>
<a id='L3961' name='L3961'></a>  3961 <em class='comment'>   obtain ownership of XA_PRIMARY.</em>
<a id='L3962' name='L3962'></a>  3962 <em class='comment'></em>
<a id='L3963' name='L3963'></a>  3963 <em class='comment'>   2. Send a ButtonPress event and then a ButtonRelease event to</em>
<a id='L3964' name='L3964'></a>  3964 <em class='comment'>   the deepest subwindow containing the mouse to simulate a</em>
<a id='L3965' name='L3965'></a>  3965 <em class='comment'>   middle click.  The times for these events should be the time</em>
<a id='L3966' name='L3966'></a>  3966 <em class='comment'>   of the actual button release +1 and +2, respectively.  These</em>
<a id='L3967' name='L3967'></a>  3967 <em class='comment'>   values will not be used by anybody else, so one can</em>
<a id='L3968' name='L3968'></a>  3968 <em class='comment'>   unambiguously recognize the resulting `XConvertSelection'</em>
<a id='L3969' name='L3969'></a>  3969 <em class='comment'>   request.</em>
<a id='L3970' name='L3970'></a>  3970 <em class='comment'></em>
<a id='L3971' name='L3971'></a>  3971 <em class='comment'>   3. If a request for XA_PRIMARY arrives bearing the timestamp</em>
<a id='L3972' name='L3972'></a>  3972 <em class='comment'>   of either the ButtonPress or the ButtonRelease event, treat</em>
<a id='L3973' name='L3973'></a>  3973 <em class='comment'>   it as a request for XdndSelection.  Note that you must use</em>
<a id='L3974' name='L3974'></a>  3974 <em class='comment'>   the X data types instead of the MIME types in this case.</em>
<a id='L3975' name='L3975'></a>  3975 <em class='comment'>   (e.g. XA_STRING instead of text/plain).  */</em>
<a id='L3976' name='L3976'></a>  3976 <strong class='reserved'>void</strong>
<a id='L3977' name='L3977'></a>  3977 <a href='../R/18128.html' title='Multiple referred from 2 places.'>x_dnd_do_unsupported_drop</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L3978' name='L3978'></a>  3978                            <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>,
<a id='L3979' name='L3979'></a>  3979                            <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> targets, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> target_window,
<a id='L3980' name='L3980'></a>  3980                            <strong class='reserved'>int</strong> root_x, <strong class='reserved'>int</strong> root_y, <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a> before)
<a id='L3981' name='L3981'></a>  3981 <em class='brace'>{</em>
<a id='L3982' name='L3982'></a>  3982   XEvent event;
<a id='L3983' name='L3983'></a>  3983   <strong class='reserved'>int</strong> dest_x, dest_y;
<a id='L3984' name='L3984'></a>  3984   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> child_return, child, owner;
<a id='L3985' name='L3985'></a>  3985   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> current_value;
<a id='L3986' name='L3986'></a>  3986   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L3987' name='L3987'></a>  3987 
<a id='L3988' name='L3988'></a>  3988   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2247.html#L124' title='Defined at 124 in src/frame.c.'>decode_window_system_frame</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>);
<a id='L3989' name='L3989'></a>  3989 
<a id='L3990' name='L3990'></a>  3990   <strong class='reserved'>if</strong> (<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>))
<a id='L3991' name='L3991'></a>  3991     <strong class='reserved'>return</strong>;
<a id='L3992' name='L3992'></a>  3992 
<a id='L3993' name='L3993'></a>  3993   <strong class='reserved'>if</strong> (!x_dnd_use_unsupported_drop)
<a id='L3994' name='L3994'></a>  3994     <strong class='reserved'>return</strong>;
<a id='L3995' name='L3995'></a>  3995 
<a id='L3996' name='L3996'></a>  3996   event.xbutton.serial = 0;
<a id='L3997' name='L3997'></a>  3997   event.xbutton.send_event = True;
<a id='L3998' name='L3998'></a>  3998   event.xbutton.<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> = dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>;
<a id='L3999' name='L3999'></a>  3999   event.xbutton.root = dpyinfo-&gt;root_window;
<a id='L4000' name='L4000'></a>  4000   event.xbutton.x_root = root_x;
<a id='L4001' name='L4001'></a>  4001   event.xbutton.y_root = root_y;
<a id='L4002' name='L4002'></a>  4002 
<a id='L4003' name='L4003'></a>  4003   x_catch_errors (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L4004' name='L4004'></a>  4004 
<a id='L4005' name='L4005'></a>  4005   child = dpyinfo-&gt;root_window;
<a id='L4006' name='L4006'></a>  4006   dest_x = root_x;
<a id='L4007' name='L4007'></a>  4007   dest_y = root_y;
<a id='L4008' name='L4008'></a>  4008 
<a id='L4009' name='L4009'></a>  4009   <strong class='reserved'>while</strong> (XTranslateCoordinates (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, dpyinfo-&gt;root_window,
<a id='L4010' name='L4010'></a>  4010                                 child, root_x, root_y, &amp;dest_x, &amp;dest_y,
<a id='L4011' name='L4011'></a>  4011                                 &amp;child_return)
<a id='L4012' name='L4012'></a>  4012          &amp;&amp; child_return != None)
<a id='L4013' name='L4013'></a>  4013     child = child_return;
<a id='L4014' name='L4014'></a>  4014 
<a id='L4015' name='L4015'></a>  4015   x_uncatch_errors ();
<a id='L4016' name='L4016'></a>  4016 
<a id='L4017' name='L4017'></a>  4017   <strong class='reserved'>if</strong> (!<a href='../D/1228.html' title='Multiple defined in 2 places.'>CONSP</a> (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>))
<a id='L4018' name='L4018'></a>  4018     <strong class='reserved'>return</strong>;
<a id='L4019' name='L4019'></a>  4019 
<a id='L4020' name='L4020'></a>  4020   current_value = <a href='../S/2320.html#L1962' title='Defined at 1962 in src/fns.c.'>assq_no_quit</a> (QPRIMARY,
<a id='L4021' name='L4021'></a>  4021                                 dpyinfo-&gt;<a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;Vselection_alist);
<a id='L4022' name='L4022'></a>  4022 
<a id='L4023' name='L4023'></a>  4023   <strong class='reserved'>if</strong> (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (current_value))
<a id='L4024' name='L4024'></a>  4024     current_value = <a href='../D/7021.html' title='Multiple defined in 2 places.'>XCAR</a> (<a href='../D/7022.html' title='Multiple defined in 2 places.'>XCDR</a> (current_value));
<a id='L4025' name='L4025'></a>  4025 
<a id='L4026' name='L4026'></a>  4026   <a href='../S/2281.html#L274' title='Defined at 274 in src/xselect.c.'>x_own_selection</a> (QPRIMARY, current_value, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>,
<a id='L4027' name='L4027'></a>  4027                    <a href='../D/7021.html' title='Multiple defined in 2 places.'>XCAR</a> (<a href='../D/7022.html' title='Multiple defined in 2 places.'>XCDR</a> (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>)), before);
<a id='L4028' name='L4028'></a>  4028 
<a id='L4029' name='L4029'></a>  4029   owner = XGetSelectionOwner (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, XA_PRIMARY);
<a id='L4030' name='L4030'></a>  4030 
<a id='L4031' name='L4031'></a>  4031   <em class='comment'>/* If we didn't successfully obtain selection ownership, refrain</em>
<a id='L4032' name='L4032'></a>  4032 <em class='comment'>     from generating events that will insert something else.  */</em>
<a id='L4033' name='L4033'></a>  4033 
<a id='L4034' name='L4034'></a>  4034   <strong class='reserved'>if</strong> (owner != <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L4035' name='L4035'></a>  4035     <strong class='reserved'>return</strong>;
<a id='L4036' name='L4036'></a>  4036 
<a id='L4037' name='L4037'></a>  4037   <em class='comment'>/* mouse-drag-and-drop-region will immediately deactivate the mark</em>
<a id='L4038' name='L4038'></a>  4038 <em class='comment'>     after this is set.  Make sure the primary selection is not</em>
<a id='L4039' name='L4039'></a>  4039 <em class='comment'>     clobbered in that case by setting `deactivate-mark' to</em>
<a id='L4040' name='L4040'></a>  4040 <em class='comment'>     Qdont_save.  */</em>
<a id='L4041' name='L4041'></a>  4041   Vdeactivate_mark = Qdont_save;
<a id='L4042' name='L4042'></a>  4042 
<a id='L4043' name='L4043'></a>  4043   event.xbutton.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = child;
<a id='L4044' name='L4044'></a>  4044   event.xbutton.subwindow = None;
<a id='L4045' name='L4045'></a>  4045   event.xbutton.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = dest_x;
<a id='L4046' name='L4046'></a>  4046   event.xbutton.y = dest_y;
<a id='L4047' name='L4047'></a>  4047   event.xbutton.state = 0;
<a id='L4048' name='L4048'></a>  4048   event.xbutton.button = 2;
<a id='L4049' name='L4049'></a>  4049   event.xbutton.same_screen = True;
<a id='L4050' name='L4050'></a>  4050 
<a id='L4051' name='L4051'></a>  4051   dpyinfo-&gt;pending_dnd_time = before;
<a id='L4052' name='L4052'></a>  4052 
<a id='L4053' name='L4053'></a>  4053   event.xbutton.type = ButtonPress;
<a id='L4054' name='L4054'></a>  4054   event.xbutton.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> = before + 1;
<a id='L4055' name='L4055'></a>  4055 
<a id='L4056' name='L4056'></a>  4056   x_ignore_errors_for_next_request (dpyinfo, 0);
<a id='L4057' name='L4057'></a>  4057   XSendEvent (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, child,
<a id='L4058' name='L4058'></a>  4058               True, ButtonPressMask, &amp;event);
<a id='L4059' name='L4059'></a>  4059 
<a id='L4060' name='L4060'></a>  4060   event.xbutton.type = ButtonRelease;
<a id='L4061' name='L4061'></a>  4061   event.xbutton.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> = before + 2;
<a id='L4062' name='L4062'></a>  4062 
<a id='L4063' name='L4063'></a>  4063   XSendEvent (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, child,
<a id='L4064' name='L4064'></a>  4064               True, <a href='../S/2321.html#L132' title='Defined at 132 in src/msdos.h.'>ButtonReleaseMask</a>, &amp;event);
<a id='L4065' name='L4065'></a>  4065   x_stop_ignoring_errors (dpyinfo);
<a id='L4066' name='L4066'></a>  4066 
<a id='L4067' name='L4067'></a>  4067   x_dnd_action_symbol = QXdndActionPrivate;
<a id='L4068' name='L4068'></a>  4068 
<a id='L4069' name='L4069'></a>  4069   <strong class='reserved'>return</strong>;
<a id='L4070' name='L4070'></a>  4070 <em class='brace'>}</em>
<a id='L4071' name='L4071'></a>  4071 
<a id='L4072' name='L4072'></a>  4072 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L4073' name='L4073'></a>  4073 <a href='../R/18148.html' title='Multiple referred from 4 places.'>x_dnd_send_unsupported_drop</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> target_window,
<a id='L4074' name='L4074'></a>  4074                              <strong class='reserved'>int</strong> root_x, <strong class='reserved'>int</strong> root_y, <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a> before)
<a id='L4075' name='L4075'></a>  4075 <em class='brace'>{</em>
<a id='L4076' name='L4076'></a>  4076   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> targets, arg;
<a id='L4077' name='L4077'></a>  4077   <strong class='reserved'>int</strong> i;
<a id='L4078' name='L4078'></a>  4078   <strong class='reserved'>char</strong> **atom_names, *<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>;
<a id='L4079' name='L4079'></a>  4079 
<a id='L4080' name='L4080'></a>  4080   targets = Qnil;
<a id='L4081' name='L4081'></a>  4081   atom_names = <a href='../D/8439.html' title='Multiple defined in 8 places.'>alloca</a> (<strong class='reserved'>sizeof</strong> *atom_names * x_dnd_n_targets);
<a id='L4082' name='L4082'></a>  4082 
<a id='L4083' name='L4083'></a>  4083   <strong class='reserved'>if</strong> (!XGetAtomNames (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, x_dnd_targets,
<a id='L4084' name='L4084'></a>  4084                       x_dnd_n_targets, atom_names))
<a id='L4085' name='L4085'></a>  4085       <strong class='reserved'>return</strong>;
<a id='L4086' name='L4086'></a>  4086 
<a id='L4087' name='L4087'></a>  4087   <strong class='reserved'>for</strong> (i = x_dnd_n_targets; i &gt; 0; --i)
<a id='L4088' name='L4088'></a>  4088     <em class='brace'>{</em>
<a id='L4089' name='L4089'></a>  4089       targets = Fcons (<a href='../D/9420.html' title='Multiple defined in 2 places.'>build_string</a> (atom_names[i - 1]),
<a id='L4090' name='L4090'></a>  4090                        targets);
<a id='L4091' name='L4091'></a>  4091       XFree (atom_names[i - 1]);
<a id='L4092' name='L4092'></a>  4092     <em class='brace'>}</em>
<a id='L4093' name='L4093'></a>  4093 
<a id='L4094' name='L4094'></a>  4094   <a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a> = x_get_atom_name (dpyinfo, x_dnd_wanted_action,
<a id='L4095' name='L4095'></a>  4095                           <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L4096' name='L4096'></a>  4096 
<a id='L4097' name='L4097'></a>  4097   <strong class='reserved'>if</strong> (<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>)
<a id='L4098' name='L4098'></a>  4098     <em class='brace'>{</em>
<a id='L4099' name='L4099'></a>  4099       arg = <a href='../D/13388.html' title='Multiple defined in 2 places.'>intern</a> (<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>);
<a id='L4100' name='L4100'></a>  4100       <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>);
<a id='L4101' name='L4101'></a>  4101     <em class='brace'>}</em>
<a id='L4102' name='L4102'></a>  4102   <strong class='reserved'>else</strong>
<a id='L4103' name='L4103'></a>  4103     arg = Qnil;
<a id='L4104' name='L4104'></a>  4104 
<a id='L4105' name='L4105'></a>  4105   x_dnd_run_unsupported_drop_function = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L4106' name='L4106'></a>  4106   x_dnd_unsupported_drop_time = before;
<a id='L4107' name='L4107'></a>  4107   x_dnd_unsupported_drop_window = target_window;
<a id='L4108' name='L4108'></a>  4108   x_dnd_unsupported_drop_data
<a id='L4109' name='L4109'></a>  4109     = <a href='../S/2350.html#L2971' title='Defined at 2971 in src/alloc.c.'>listn</a> (5, <a href='../S/2320.html#L1962' title='Defined at 1962 in src/fns.c.'>assq_no_quit</a> (QXdndSelection,
<a id='L4110' name='L4110'></a>  4110                               dpyinfo-&gt;<a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;Vselection_alist),
<a id='L4111' name='L4111'></a>  4111              targets, arg, <a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (root_x),
<a id='L4112' name='L4112'></a>  4112              <a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (root_y));
<a id='L4113' name='L4113'></a>  4113 
<a id='L4114' name='L4114'></a>  4114   x_dnd_waiting_for_finish = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L4115' name='L4115'></a>  4115   x_dnd_finish_display = dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>;
<a id='L4116' name='L4116'></a>  4116 <em class='brace'>}</em>
<a id='L4117' name='L4117'></a>  4117 
<a id='L4118' name='L4118'></a>  4118 <strong class='reserved'>static</strong> <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a>
<a id='L4119' name='L4119'></a>  4119 <a href='../R/18129.html' title='Multiple referred from 2 places.'>x_dnd_fill_empty_target</a> (<strong class='reserved'>int</strong> *proto_out, <strong class='reserved'>int</strong> *motif_out,
<a id='L4120' name='L4120'></a>  4120                          <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> *toplevel_out, <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> *was_frame)
<a id='L4121' name='L4121'></a>  4121 <em class='brace'>{</em>
<a id='L4122' name='L4122'></a>  4122   *proto_out = -1;
<a id='L4123' name='L4123'></a>  4123   *motif_out = <a href='../S/2289.html#L1740' title='Defined at 1740 in src/xterm.c.'>XM_DRAG_STYLE_NONE</a>;
<a id='L4124' name='L4124'></a>  4124   *toplevel_out = None;
<a id='L4125' name='L4125'></a>  4125   *was_frame = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L4126' name='L4126'></a>  4126 
<a id='L4127' name='L4127'></a>  4127   <strong class='reserved'>return</strong> None;
<a id='L4128' name='L4128'></a>  4128 <em class='brace'>}</em>
<a id='L4129' name='L4129'></a>  4129 
<a id='L4130' name='L4130'></a>  4130 <strong class='reserved'>static</strong> <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a>
<a id='L4131' name='L4131'></a>  4131 <a href='../R/18132.html' title='Multiple referred from 3 places.'>x_dnd_get_target_window</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L4132' name='L4132'></a>  4132                          <strong class='reserved'>int</strong> root_x, <strong class='reserved'>int</strong> root_y, <strong class='reserved'>int</strong> *proto_out,
<a id='L4133' name='L4133'></a>  4133                          <strong class='reserved'>int</strong> *motif_out, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> *toplevel_out,
<a id='L4134' name='L4134'></a>  4134                          <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> *was_frame)
<a id='L4135' name='L4135'></a>  4135 <em class='brace'>{</em>
<a id='L4136' name='L4136'></a>  4136   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> child_return, child, proxy;
<a id='L4137' name='L4137'></a>  4137   <strong class='reserved'>int</strong> dest_x_return, dest_y_return, rc, <a href='../S/4027.html#L26' title='Defined at 26 in test/manual/cedet/tests/testpolymorph.cpp.'>proto</a>, motif;
<a id='L4138' name='L4138'></a>  4138   <strong class='reserved'>int</strong> parent_x, parent_y;
<a id='L4139' name='L4139'></a>  4139   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> extents_p;
<a id='L4140' name='L4140'></a>  4140 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XCOMPOSITE &amp;&amp; (XCOMPOSITE_MAJOR &gt; 0 || XCOMPOSITE_MINOR &gt; 2)
<a id='L4141' name='L4141'></a>  4141   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> overlay_window;
<a id='L4142' name='L4142'></a>  4142   XWindowAttributes attrs;
<a id='L4143' name='L4143'></a>  4143 <em class='sharp'>#endif</em>
<a id='L4144' name='L4144'></a>  4144   <strong class='reserved'>int</strong> wmstate;
<a id='L4145' name='L4145'></a>  4145   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *tooltip, *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L4146' name='L4146'></a>  4146   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> unrelated;
<a id='L4147' name='L4147'></a>  4147 
<a id='L4148' name='L4148'></a>  4148   child_return = dpyinfo-&gt;root_window;
<a id='L4149' name='L4149'></a>  4149   dest_x_return = root_x;
<a id='L4150' name='L4150'></a>  4150   dest_y_return = root_y;
<a id='L4151' name='L4151'></a>  4151 
<a id='L4152' name='L4152'></a>  4152   <a href='../S/4027.html#L26' title='Defined at 26 in test/manual/cedet/tests/testpolymorph.cpp.'>proto</a> = -1;
<a id='L4153' name='L4153'></a>  4153   *motif_out = <a href='../S/2289.html#L1740' title='Defined at 1740 in src/xterm.c.'>XM_DRAG_STYLE_NONE</a>;
<a id='L4154' name='L4154'></a>  4154   *toplevel_out = None;
<a id='L4155' name='L4155'></a>  4155   *was_frame = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L4156' name='L4156'></a>  4156 
<a id='L4157' name='L4157'></a>  4157   <strong class='reserved'>if</strong> (x_dnd_use_toplevels)
<a id='L4158' name='L4158'></a>  4158     <em class='brace'>{</em>
<a id='L4159' name='L4159'></a>  4159       extents_p = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L4160' name='L4160'></a>  4160       child = <a href='../S/2289.html#L3715' title='Defined at 3715 in src/xterm.c.'>x_dnd_get_target_window_1</a> (dpyinfo, root_x,
<a id='L4161' name='L4161'></a>  4161                                          root_y, motif_out,
<a id='L4162' name='L4162'></a>  4162                                          &amp;extents_p);
<a id='L4163' name='L4163'></a>  4163 
<a id='L4164' name='L4164'></a>  4164       <strong class='reserved'>if</strong> (!x_dnd_allow_current_frame
<a id='L4165' name='L4165'></a>  4165           &amp;&amp; <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (x_dnd_frame) == child)
<a id='L4166' name='L4166'></a>  4166         *motif_out = <a href='../S/2289.html#L1740' title='Defined at 1740 in src/xterm.c.'>XM_DRAG_STYLE_NONE</a>;
<a id='L4167' name='L4167'></a>  4167 
<a id='L4168' name='L4168'></a>  4168       <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../D/19730.html' title='Multiple defined in 2 places.'>x_top_window_to_frame</a> (dpyinfo, child);
<a id='L4169' name='L4169'></a>  4169 
<a id='L4170' name='L4170'></a>  4170       *toplevel_out = child;
<a id='L4171' name='L4171'></a>  4171 
<a id='L4172' name='L4172'></a>  4172       <strong class='reserved'>if</strong> (child != None)
<a id='L4173' name='L4173'></a>  4173         <em class='brace'>{</em>
<a id='L4174' name='L4174'></a>  4174           <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L4175' name='L4175'></a>  4175             <em class='brace'>{</em>
<a id='L4176' name='L4176'></a>  4176               *was_frame = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L4177' name='L4177'></a>  4177               *proto_out = -1;
<a id='L4178' name='L4178'></a>  4178               *motif_out = <a href='../S/2289.html#L1740' title='Defined at 1740 in src/xterm.c.'>XM_DRAG_STYLE_NONE</a>;
<a id='L4179' name='L4179'></a>  4179 
<a id='L4180' name='L4180'></a>  4180               <strong class='reserved'>return</strong> child;
<a id='L4181' name='L4181'></a>  4181             <em class='brace'>}</em>
<a id='L4182' name='L4182'></a>  4182 
<a id='L4183' name='L4183'></a>  4183 <em class='sharp'>#ifndef</em> USE_XCB
<a id='L4184' name='L4184'></a>  4184           proxy = <a href='../S/2289.html#L4460' title='Defined at 4460 in src/xterm.c.'>x_dnd_get_window_proxy</a> (dpyinfo, child);
<a id='L4185' name='L4185'></a>  4185 <em class='sharp'>#else</em>
<a id='L4186' name='L4186'></a>  4186           <a href='../S/2289.html#L3628' title='Defined at 3628 in src/xterm.c.'>x_dnd_get_proxy_proto</a> (dpyinfo, child, &amp;proxy, proto_out);
<a id='L4187' name='L4187'></a>  4187 <em class='sharp'>#endif</em>
<a id='L4188' name='L4188'></a>  4188 
<a id='L4189' name='L4189'></a>  4189           <strong class='reserved'>if</strong> (proxy != None)
<a id='L4190' name='L4190'></a>  4190             <em class='brace'>{</em>
<a id='L4191' name='L4191'></a>  4191               <a href='../S/4027.html#L26' title='Defined at 26 in test/manual/cedet/tests/testpolymorph.cpp.'>proto</a> = <a href='../S/2289.html#L4502' title='Defined at 4502 in src/xterm.c.'>x_dnd_get_window_proto</a> (dpyinfo, proxy);
<a id='L4192' name='L4192'></a>  4192 
<a id='L4193' name='L4193'></a>  4193               <strong class='reserved'>if</strong> (<a href='../S/4027.html#L26' title='Defined at 26 in test/manual/cedet/tests/testpolymorph.cpp.'>proto</a> != -1)
<a id='L4194' name='L4194'></a>  4194                 <em class='brace'>{</em>
<a id='L4195' name='L4195'></a>  4195                   *proto_out = <a href='../S/4027.html#L26' title='Defined at 26 in test/manual/cedet/tests/testpolymorph.cpp.'>proto</a>;
<a id='L4196' name='L4196'></a>  4196                   <strong class='reserved'>return</strong> proxy;
<a id='L4197' name='L4197'></a>  4197                 <em class='brace'>}</em>
<a id='L4198' name='L4198'></a>  4198             <em class='brace'>}</em>
<a id='L4199' name='L4199'></a>  4199 
<a id='L4200' name='L4200'></a>  4200 <em class='sharp'>#ifndef</em> USE_XCB
<a id='L4201' name='L4201'></a>  4201           *proto_out = <a href='../S/2289.html#L4502' title='Defined at 4502 in src/xterm.c.'>x_dnd_get_window_proto</a> (dpyinfo, child);
<a id='L4202' name='L4202'></a>  4202 <em class='sharp'>#endif</em>
<a id='L4203' name='L4203'></a>  4203           <strong class='reserved'>return</strong> child;
<a id='L4204' name='L4204'></a>  4204         <em class='brace'>}</em>
<a id='L4205' name='L4205'></a>  4205 
<a id='L4206' name='L4206'></a>  4206       <strong class='reserved'>if</strong> (extents_p)
<a id='L4207' name='L4207'></a>  4207         <em class='brace'>{</em>
<a id='L4208' name='L4208'></a>  4208           *proto_out = -1;
<a id='L4209' name='L4209'></a>  4209           *motif_out = <a href='../S/2289.html#L1740' title='Defined at 1740 in src/xterm.c.'>XM_DRAG_STYLE_NONE</a>;
<a id='L4210' name='L4210'></a>  4210           *toplevel_out = None;
<a id='L4211' name='L4211'></a>  4211 
<a id='L4212' name='L4212'></a>  4212           <strong class='reserved'>return</strong> None;
<a id='L4213' name='L4213'></a>  4213         <em class='brace'>}</em>
<a id='L4214' name='L4214'></a>  4214 
<a id='L4215' name='L4215'></a>  4215       <em class='comment'>/* Then look at the composite overlay window.  */</em>
<a id='L4216' name='L4216'></a>  4216 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XCOMPOSITE &amp;&amp; (XCOMPOSITE_MAJOR &gt; 0 || XCOMPOSITE_MINOR &gt; 2)
<a id='L4217' name='L4217'></a>  4217       <strong class='reserved'>if</strong> (dpyinfo-&gt;composite_supported_p
<a id='L4218' name='L4218'></a>  4218           &amp;&amp; (dpyinfo-&gt;composite_major &gt; 0
<a id='L4219' name='L4219'></a>  4219               || dpyinfo-&gt;composite_minor &gt; 2))
<a id='L4220' name='L4220'></a>  4220         <em class='brace'>{</em>
<a id='L4221' name='L4221'></a>  4221           <strong class='reserved'>if</strong> (XGetSelectionOwner (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L4222' name='L4222'></a>  4222                                   dpyinfo-&gt;Xatom_NET_WM_CM_Sn) != None)
<a id='L4223' name='L4223'></a>  4223             <em class='brace'>{</em>
<a id='L4224' name='L4224'></a>  4224               x_catch_errors (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L4225' name='L4225'></a>  4225               XGrabServer (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L4226' name='L4226'></a>  4226               overlay_window = XCompositeGetOverlayWindow (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L4227' name='L4227'></a>  4227                                                            dpyinfo-&gt;root_window);
<a id='L4228' name='L4228'></a>  4228               XCompositeReleaseOverlayWindow (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L4229' name='L4229'></a>  4229                                               dpyinfo-&gt;root_window);
<a id='L4230' name='L4230'></a>  4230               XUngrabServer (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L4231' name='L4231'></a>  4231 
<a id='L4232' name='L4232'></a>  4232               <strong class='reserved'>if</strong> (!x_had_errors_p (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>))
<a id='L4233' name='L4233'></a>  4233                 <em class='brace'>{</em>
<a id='L4234' name='L4234'></a>  4234                   XGetWindowAttributes (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, overlay_window, &amp;attrs);
<a id='L4235' name='L4235'></a>  4235 
<a id='L4236' name='L4236'></a>  4236                   <strong class='reserved'>if</strong> (attrs.map_state == IsViewable)
<a id='L4237' name='L4237'></a>  4237                     <em class='brace'>{</em>
<a id='L4238' name='L4238'></a>  4238                       proxy = <a href='../S/2289.html#L4460' title='Defined at 4460 in src/xterm.c.'>x_dnd_get_window_proxy</a> (dpyinfo, overlay_window);
<a id='L4239' name='L4239'></a>  4239 
<a id='L4240' name='L4240'></a>  4240                       <strong class='reserved'>if</strong> (proxy != None)
<a id='L4241' name='L4241'></a>  4241                         <em class='brace'>{</em>
<a id='L4242' name='L4242'></a>  4242                           <a href='../S/4027.html#L26' title='Defined at 26 in test/manual/cedet/tests/testpolymorph.cpp.'>proto</a> = <a href='../S/2289.html#L4502' title='Defined at 4502 in src/xterm.c.'>x_dnd_get_window_proto</a> (dpyinfo, proxy);
<a id='L4243' name='L4243'></a>  4243 
<a id='L4244' name='L4244'></a>  4244                           <strong class='reserved'>if</strong> (<a href='../S/4027.html#L26' title='Defined at 26 in test/manual/cedet/tests/testpolymorph.cpp.'>proto</a> != -1)
<a id='L4245' name='L4245'></a>  4245                             <em class='brace'>{</em>
<a id='L4246' name='L4246'></a>  4246                               *proto_out = <a href='../S/4027.html#L26' title='Defined at 26 in test/manual/cedet/tests/testpolymorph.cpp.'>proto</a>;
<a id='L4247' name='L4247'></a>  4247                               *toplevel_out = overlay_window;
<a id='L4248' name='L4248'></a>  4248                               x_uncatch_errors_after_check ();
<a id='L4249' name='L4249'></a>  4249 
<a id='L4250' name='L4250'></a>  4250                               <strong class='reserved'>return</strong> proxy;
<a id='L4251' name='L4251'></a>  4251                             <em class='brace'>}</em>
<a id='L4252' name='L4252'></a>  4252                         <em class='brace'>}</em>
<a id='L4253' name='L4253'></a>  4253                     <em class='brace'>}</em>
<a id='L4254' name='L4254'></a>  4254                 <em class='brace'>}</em>
<a id='L4255' name='L4255'></a>  4255               x_uncatch_errors_after_check ();
<a id='L4256' name='L4256'></a>  4256             <em class='brace'>}</em>
<a id='L4257' name='L4257'></a>  4257         <em class='brace'>}</em>
<a id='L4258' name='L4258'></a>  4258 <em class='sharp'>#endif</em>
<a id='L4259' name='L4259'></a>  4259 
<a id='L4260' name='L4260'></a>  4260       <em class='comment'>/* Now look for an XdndProxy on the root window.  */</em>
<a id='L4261' name='L4261'></a>  4261 
<a id='L4262' name='L4262'></a>  4262       proxy = <a href='../S/2289.html#L4460' title='Defined at 4460 in src/xterm.c.'>x_dnd_get_window_proxy</a> (dpyinfo, dpyinfo-&gt;root_window);
<a id='L4263' name='L4263'></a>  4263 
<a id='L4264' name='L4264'></a>  4264       <strong class='reserved'>if</strong> (proxy != None)
<a id='L4265' name='L4265'></a>  4265         <em class='brace'>{</em>
<a id='L4266' name='L4266'></a>  4266           <a href='../S/4027.html#L26' title='Defined at 26 in test/manual/cedet/tests/testpolymorph.cpp.'>proto</a> = <a href='../S/2289.html#L4502' title='Defined at 4502 in src/xterm.c.'>x_dnd_get_window_proto</a> (dpyinfo, dpyinfo-&gt;root_window);
<a id='L4267' name='L4267'></a>  4267 
<a id='L4268' name='L4268'></a>  4268           <strong class='reserved'>if</strong> (<a href='../S/4027.html#L26' title='Defined at 26 in test/manual/cedet/tests/testpolymorph.cpp.'>proto</a> != -1)
<a id='L4269' name='L4269'></a>  4269             <em class='brace'>{</em>
<a id='L4270' name='L4270'></a>  4270               *toplevel_out = dpyinfo-&gt;root_window;
<a id='L4271' name='L4271'></a>  4271               *proto_out = <a href='../S/4027.html#L26' title='Defined at 26 in test/manual/cedet/tests/testpolymorph.cpp.'>proto</a>;
<a id='L4272' name='L4272'></a>  4272               <strong class='reserved'>return</strong> proxy;
<a id='L4273' name='L4273'></a>  4273             <em class='brace'>}</em>
<a id='L4274' name='L4274'></a>  4274         <em class='brace'>}</em>
<a id='L4275' name='L4275'></a>  4275 
<a id='L4276' name='L4276'></a>  4276       <em class='comment'>/* No toplevel was found and the overlay and root windows were</em>
<a id='L4277' name='L4277'></a>  4277 <em class='comment'>         not proxies, so return None.  */</em>
<a id='L4278' name='L4278'></a>  4278       *proto_out = -1;
<a id='L4279' name='L4279'></a>  4279       *toplevel_out = dpyinfo-&gt;root_window;
<a id='L4280' name='L4280'></a>  4280       <strong class='reserved'>return</strong> None;
<a id='L4281' name='L4281'></a>  4281     <em class='brace'>}</em>
<a id='L4282' name='L4282'></a>  4282 
<a id='L4283' name='L4283'></a>  4283   <em class='comment'>/* Not strictly necessary, but satisfies GCC.  */</em>
<a id='L4284' name='L4284'></a>  4284   child = dpyinfo-&gt;root_window;
<a id='L4285' name='L4285'></a>  4285 
<a id='L4286' name='L4286'></a>  4286   <strong class='reserved'>while</strong> (child_return != None)
<a id='L4287' name='L4287'></a>  4287     <em class='brace'>{</em>
<a id='L4288' name='L4288'></a>  4288       child = child_return;
<a id='L4289' name='L4289'></a>  4289       parent_x = dest_x_return;
<a id='L4290' name='L4290'></a>  4290       parent_y = dest_y_return;
<a id='L4291' name='L4291'></a>  4291 
<a id='L4292' name='L4292'></a>  4292       x_catch_errors (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L4293' name='L4293'></a>  4293       rc = XTranslateCoordinates (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, dpyinfo-&gt;root_window,
<a id='L4294' name='L4294'></a>  4294                                   child_return, root_x, root_y, &amp;dest_x_return,
<a id='L4295' name='L4295'></a>  4295                                   &amp;dest_y_return, &amp;child_return);
<a id='L4296' name='L4296'></a>  4296 
<a id='L4297' name='L4297'></a>  4297       <strong class='reserved'>if</strong> (x_had_errors_p (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>) || !rc)
<a id='L4298' name='L4298'></a>  4298         <em class='brace'>{</em>
<a id='L4299' name='L4299'></a>  4299           x_uncatch_errors_after_check ();
<a id='L4300' name='L4300'></a>  4300           <strong class='reserved'>break</strong>;
<a id='L4301' name='L4301'></a>  4301         <em class='brace'>}</em>
<a id='L4302' name='L4302'></a>  4302 
<a id='L4303' name='L4303'></a>  4303       <strong class='reserved'>if</strong> (child_return)
<a id='L4304' name='L4304'></a>  4304         <em class='brace'>{</em>
<a id='L4305' name='L4305'></a>  4305           <em class='comment'>/* If child_return is a tooltip frame, look beneath it.  We</em>
<a id='L4306' name='L4306'></a>  4306 <em class='comment'>             never want to drop anything onto a tooltip frame.  */</em>
<a id='L4307' name='L4307'></a>  4307 
<a id='L4308' name='L4308'></a>  4308           tooltip = <a href='../S/2289.html#L12010' title='Defined at 12010 in src/xterm.c.'>x_tooltip_window_to_frame</a> (dpyinfo, child_return,
<a id='L4309' name='L4309'></a>  4309                                                &amp;unrelated);
<a id='L4310' name='L4310'></a>  4310 
<a id='L4311' name='L4311'></a>  4311           <strong class='reserved'>if</strong> (tooltip || unrelated)
<a id='L4312' name='L4312'></a>  4312             child_return = x_get_window_below (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, child_return,
<a id='L4313' name='L4313'></a>  4313                                                parent_x, parent_y, &amp;dest_x_return,
<a id='L4314' name='L4314'></a>  4314                                                &amp;dest_y_return);
<a id='L4315' name='L4315'></a>  4315 
<a id='L4316' name='L4316'></a>  4316           <strong class='reserved'>if</strong> (!child_return)
<a id='L4317' name='L4317'></a>  4317             <em class='brace'>{</em>
<a id='L4318' name='L4318'></a>  4318               x_uncatch_errors ();
<a id='L4319' name='L4319'></a>  4319               <strong class='reserved'>break</strong>;
<a id='L4320' name='L4320'></a>  4320             <em class='brace'>}</em>
<a id='L4321' name='L4321'></a>  4321 
<a id='L4322' name='L4322'></a>  4322           <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../D/19730.html' title='Multiple defined in 2 places.'>x_top_window_to_frame</a> (dpyinfo, child_return);
<a id='L4323' name='L4323'></a>  4323 
<a id='L4324' name='L4324'></a>  4324           <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L4325' name='L4325'></a>  4325             <em class='brace'>{</em>
<a id='L4326' name='L4326'></a>  4326               *proto_out = -1;
<a id='L4327' name='L4327'></a>  4327               *motif_out = <a href='../S/2289.html#L1740' title='Defined at 1740 in src/xterm.c.'>XM_DRAG_STYLE_NONE</a>;
<a id='L4328' name='L4328'></a>  4328               *toplevel_out = child_return;
<a id='L4329' name='L4329'></a>  4329               *was_frame = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L4330' name='L4330'></a>  4330 
<a id='L4331' name='L4331'></a>  4331               <strong class='reserved'>return</strong> child_return;
<a id='L4332' name='L4332'></a>  4332             <em class='brace'>}</em>
<a id='L4333' name='L4333'></a>  4333 
<a id='L4334' name='L4334'></a>  4334           <strong class='reserved'>if</strong> (<a href='../S/2289.html#L3812' title='Defined at 3812 in src/xterm.c.'>x_dnd_get_wm_state_and_proto</a> (dpyinfo, child_return,
<a id='L4335' name='L4335'></a>  4335                                             &amp;wmstate, &amp;<a href='../S/4027.html#L26' title='Defined at 26 in test/manual/cedet/tests/testpolymorph.cpp.'>proto</a>, &amp;motif,
<a id='L4336' name='L4336'></a>  4336                                             &amp;proxy)
<a id='L4337' name='L4337'></a>  4337               <em class='comment'>/* `proto' and `motif' are set by x_dnd_get_wm_state</em>
<a id='L4338' name='L4338'></a>  4338 <em class='comment'>                 even if getting the wm state failed.  */</em>
<a id='L4339' name='L4339'></a>  4339               || <a href='../S/4027.html#L26' title='Defined at 26 in test/manual/cedet/tests/testpolymorph.cpp.'>proto</a> != -1 || motif != <a href='../S/2289.html#L1740' title='Defined at 1740 in src/xterm.c.'>XM_DRAG_STYLE_NONE</a>)
<a id='L4340' name='L4340'></a>  4340             <em class='brace'>{</em>
<a id='L4341' name='L4341'></a>  4341               *proto_out = <a href='../S/4027.html#L26' title='Defined at 26 in test/manual/cedet/tests/testpolymorph.cpp.'>proto</a>;
<a id='L4342' name='L4342'></a>  4342               *motif_out = (x_dnd_disable_motif_protocol
<a id='L4343' name='L4343'></a>  4343                             ? <a href='../S/2289.html#L1740' title='Defined at 1740 in src/xterm.c.'>XM_DRAG_STYLE_NONE</a> : motif);
<a id='L4344' name='L4344'></a>  4344               *toplevel_out = child_return;
<a id='L4345' name='L4345'></a>  4345               x_uncatch_errors ();
<a id='L4346' name='L4346'></a>  4346 
<a id='L4347' name='L4347'></a>  4347               <strong class='reserved'>return</strong> child_return;
<a id='L4348' name='L4348'></a>  4348             <em class='brace'>}</em>
<a id='L4349' name='L4349'></a>  4349 
<a id='L4350' name='L4350'></a>  4350           <strong class='reserved'>if</strong> (proxy != None)
<a id='L4351' name='L4351'></a>  4351             <em class='brace'>{</em>
<a id='L4352' name='L4352'></a>  4352               <a href='../S/4027.html#L26' title='Defined at 26 in test/manual/cedet/tests/testpolymorph.cpp.'>proto</a> = <a href='../S/2289.html#L4502' title='Defined at 4502 in src/xterm.c.'>x_dnd_get_window_proto</a> (dpyinfo, proxy);
<a id='L4353' name='L4353'></a>  4353 
<a id='L4354' name='L4354'></a>  4354               <strong class='reserved'>if</strong> (<a href='../S/4027.html#L26' title='Defined at 26 in test/manual/cedet/tests/testpolymorph.cpp.'>proto</a> != -1)
<a id='L4355' name='L4355'></a>  4355                 <em class='brace'>{</em>
<a id='L4356' name='L4356'></a>  4356                   *proto_out = <a href='../S/4027.html#L26' title='Defined at 26 in test/manual/cedet/tests/testpolymorph.cpp.'>proto</a>;
<a id='L4357' name='L4357'></a>  4357                   *toplevel_out = child_return;
<a id='L4358' name='L4358'></a>  4358 
<a id='L4359' name='L4359'></a>  4359                   x_uncatch_errors ();
<a id='L4360' name='L4360'></a>  4360                   <strong class='reserved'>return</strong> proxy;
<a id='L4361' name='L4361'></a>  4361                 <em class='brace'>}</em>
<a id='L4362' name='L4362'></a>  4362             <em class='brace'>}</em>
<a id='L4363' name='L4363'></a>  4363         <em class='brace'>}</em>
<a id='L4364' name='L4364'></a>  4364 
<a id='L4365' name='L4365'></a>  4365       x_uncatch_errors ();
<a id='L4366' name='L4366'></a>  4366     <em class='brace'>}</em>
<a id='L4367' name='L4367'></a>  4367 
<a id='L4368' name='L4368'></a>  4368 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XCOMPOSITE &amp;&amp; (XCOMPOSITE_MAJOR &gt; 0 || XCOMPOSITE_MINOR &gt; 2)
<a id='L4369' name='L4369'></a>  4369   <strong class='reserved'>if</strong> (child != dpyinfo-&gt;root_window)
<a id='L4370' name='L4370'></a>  4370     <em class='brace'>{</em>
<a id='L4371' name='L4371'></a>  4371 <em class='sharp'>#endif</em>
<a id='L4372' name='L4372'></a>  4372       <strong class='reserved'>if</strong> (child != None)
<a id='L4373' name='L4373'></a>  4373         <em class='brace'>{</em>
<a id='L4374' name='L4374'></a>  4374           proxy = <a href='../S/2289.html#L4460' title='Defined at 4460 in src/xterm.c.'>x_dnd_get_window_proxy</a> (dpyinfo, child);
<a id='L4375' name='L4375'></a>  4375 
<a id='L4376' name='L4376'></a>  4376           <strong class='reserved'>if</strong> (proxy)
<a id='L4377' name='L4377'></a>  4377             <em class='brace'>{</em>
<a id='L4378' name='L4378'></a>  4378               <a href='../S/4027.html#L26' title='Defined at 26 in test/manual/cedet/tests/testpolymorph.cpp.'>proto</a> = <a href='../S/2289.html#L4502' title='Defined at 4502 in src/xterm.c.'>x_dnd_get_window_proto</a> (dpyinfo, proxy);
<a id='L4379' name='L4379'></a>  4379 
<a id='L4380' name='L4380'></a>  4380               <strong class='reserved'>if</strong> (<a href='../S/4027.html#L26' title='Defined at 26 in test/manual/cedet/tests/testpolymorph.cpp.'>proto</a> != -1)
<a id='L4381' name='L4381'></a>  4381                 <em class='brace'>{</em>
<a id='L4382' name='L4382'></a>  4382                   *proto_out = <a href='../S/4027.html#L26' title='Defined at 26 in test/manual/cedet/tests/testpolymorph.cpp.'>proto</a>;
<a id='L4383' name='L4383'></a>  4383                   *toplevel_out = child;
<a id='L4384' name='L4384'></a>  4384                   <strong class='reserved'>return</strong> proxy;
<a id='L4385' name='L4385'></a>  4385                 <em class='brace'>}</em>
<a id='L4386' name='L4386'></a>  4386             <em class='brace'>}</em>
<a id='L4387' name='L4387'></a>  4387         <em class='brace'>}</em>
<a id='L4388' name='L4388'></a>  4388 
<a id='L4389' name='L4389'></a>  4389       *proto_out = <a href='../S/2289.html#L4502' title='Defined at 4502 in src/xterm.c.'>x_dnd_get_window_proto</a> (dpyinfo, child);
<a id='L4390' name='L4390'></a>  4390       <strong class='reserved'>return</strong> child;
<a id='L4391' name='L4391'></a>  4391 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XCOMPOSITE &amp;&amp; (XCOMPOSITE_MAJOR &gt; 0 || XCOMPOSITE_MINOR &gt; 2)
<a id='L4392' name='L4392'></a>  4392     <em class='brace'>}</em>
<a id='L4393' name='L4393'></a>  4393   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (dpyinfo-&gt;composite_supported_p
<a id='L4394' name='L4394'></a>  4394            &amp;&amp; (dpyinfo-&gt;composite_major &gt; 0
<a id='L4395' name='L4395'></a>  4395                || dpyinfo-&gt;composite_minor &gt; 2))
<a id='L4396' name='L4396'></a>  4396     <em class='brace'>{</em>
<a id='L4397' name='L4397'></a>  4397       <em class='comment'>/* Only do this if a compositing manager is present.  */</em>
<a id='L4398' name='L4398'></a>  4398       <strong class='reserved'>if</strong> (XGetSelectionOwner (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L4399' name='L4399'></a>  4399                               dpyinfo-&gt;Xatom_NET_WM_CM_Sn) != None)
<a id='L4400' name='L4400'></a>  4400         <em class='brace'>{</em>
<a id='L4401' name='L4401'></a>  4401           x_catch_errors (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L4402' name='L4402'></a>  4402           XGrabServer (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L4403' name='L4403'></a>  4403           overlay_window = XCompositeGetOverlayWindow (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L4404' name='L4404'></a>  4404                                                        dpyinfo-&gt;root_window);
<a id='L4405' name='L4405'></a>  4405           XCompositeReleaseOverlayWindow (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L4406' name='L4406'></a>  4406                                           dpyinfo-&gt;root_window);
<a id='L4407' name='L4407'></a>  4407           XUngrabServer (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L4408' name='L4408'></a>  4408 
<a id='L4409' name='L4409'></a>  4409           <strong class='reserved'>if</strong> (!x_had_errors_p (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>))
<a id='L4410' name='L4410'></a>  4410             <em class='brace'>{</em>
<a id='L4411' name='L4411'></a>  4411               XGetWindowAttributes (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, overlay_window, &amp;attrs);
<a id='L4412' name='L4412'></a>  4412 
<a id='L4413' name='L4413'></a>  4413               <strong class='reserved'>if</strong> (attrs.map_state == IsViewable)
<a id='L4414' name='L4414'></a>  4414                 <em class='brace'>{</em>
<a id='L4415' name='L4415'></a>  4415                   proxy = <a href='../S/2289.html#L4460' title='Defined at 4460 in src/xterm.c.'>x_dnd_get_window_proxy</a> (dpyinfo, overlay_window);
<a id='L4416' name='L4416'></a>  4416 
<a id='L4417' name='L4417'></a>  4417                   <strong class='reserved'>if</strong> (proxy != None)
<a id='L4418' name='L4418'></a>  4418                     <em class='brace'>{</em>
<a id='L4419' name='L4419'></a>  4419                       <a href='../S/4027.html#L26' title='Defined at 26 in test/manual/cedet/tests/testpolymorph.cpp.'>proto</a> = <a href='../S/2289.html#L4502' title='Defined at 4502 in src/xterm.c.'>x_dnd_get_window_proto</a> (dpyinfo, proxy);
<a id='L4420' name='L4420'></a>  4420 
<a id='L4421' name='L4421'></a>  4421                       <strong class='reserved'>if</strong> (<a href='../S/4027.html#L26' title='Defined at 26 in test/manual/cedet/tests/testpolymorph.cpp.'>proto</a> != -1)
<a id='L4422' name='L4422'></a>  4422                         <em class='brace'>{</em>
<a id='L4423' name='L4423'></a>  4423                           *proto_out = <a href='../S/4027.html#L26' title='Defined at 26 in test/manual/cedet/tests/testpolymorph.cpp.'>proto</a>;
<a id='L4424' name='L4424'></a>  4424                           *toplevel_out = overlay_window;
<a id='L4425' name='L4425'></a>  4425                           x_uncatch_errors_after_check ();
<a id='L4426' name='L4426'></a>  4426 
<a id='L4427' name='L4427'></a>  4427                           <strong class='reserved'>return</strong> proxy;
<a id='L4428' name='L4428'></a>  4428                         <em class='brace'>}</em>
<a id='L4429' name='L4429'></a>  4429                     <em class='brace'>}</em>
<a id='L4430' name='L4430'></a>  4430                 <em class='brace'>}</em>
<a id='L4431' name='L4431'></a>  4431             <em class='brace'>}</em>
<a id='L4432' name='L4432'></a>  4432           x_uncatch_errors_after_check ();
<a id='L4433' name='L4433'></a>  4433         <em class='brace'>}</em>
<a id='L4434' name='L4434'></a>  4434     <em class='brace'>}</em>
<a id='L4435' name='L4435'></a>  4435 
<a id='L4436' name='L4436'></a>  4436   <strong class='reserved'>if</strong> (child != None)
<a id='L4437' name='L4437'></a>  4437     <em class='brace'>{</em>
<a id='L4438' name='L4438'></a>  4438       proxy = <a href='../S/2289.html#L4460' title='Defined at 4460 in src/xterm.c.'>x_dnd_get_window_proxy</a> (dpyinfo, child);
<a id='L4439' name='L4439'></a>  4439 
<a id='L4440' name='L4440'></a>  4440       <strong class='reserved'>if</strong> (proxy)
<a id='L4441' name='L4441'></a>  4441         <em class='brace'>{</em>
<a id='L4442' name='L4442'></a>  4442           <a href='../S/4027.html#L26' title='Defined at 26 in test/manual/cedet/tests/testpolymorph.cpp.'>proto</a> = <a href='../S/2289.html#L4502' title='Defined at 4502 in src/xterm.c.'>x_dnd_get_window_proto</a> (dpyinfo, proxy);
<a id='L4443' name='L4443'></a>  4443 
<a id='L4444' name='L4444'></a>  4444           <strong class='reserved'>if</strong> (<a href='../S/4027.html#L26' title='Defined at 26 in test/manual/cedet/tests/testpolymorph.cpp.'>proto</a> != -1)
<a id='L4445' name='L4445'></a>  4445             <em class='brace'>{</em>
<a id='L4446' name='L4446'></a>  4446               *toplevel_out = child;
<a id='L4447' name='L4447'></a>  4447               *proto_out = <a href='../S/4027.html#L26' title='Defined at 26 in test/manual/cedet/tests/testpolymorph.cpp.'>proto</a>;
<a id='L4448' name='L4448'></a>  4448               <strong class='reserved'>return</strong> proxy;
<a id='L4449' name='L4449'></a>  4449             <em class='brace'>}</em>
<a id='L4450' name='L4450'></a>  4450         <em class='brace'>}</em>
<a id='L4451' name='L4451'></a>  4451     <em class='brace'>}</em>
<a id='L4452' name='L4452'></a>  4452 
<a id='L4453' name='L4453'></a>  4453   *proto_out = <a href='../S/2289.html#L4502' title='Defined at 4502 in src/xterm.c.'>x_dnd_get_window_proto</a> (dpyinfo, child);
<a id='L4454' name='L4454'></a>  4454   *toplevel_out = child;
<a id='L4455' name='L4455'></a>  4455   <strong class='reserved'>return</strong> child;
<a id='L4456' name='L4456'></a>  4456 <em class='sharp'>#endif</em>
<a id='L4457' name='L4457'></a>  4457 <em class='brace'>}</em>
<a id='L4458' name='L4458'></a>  4458 
<a id='L4459' name='L4459'></a>  4459 <strong class='reserved'>static</strong> <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a>
<a id='L4460' name='L4460'></a>  4460 <a href='../R/18136.html' title='Multiple referred from 8 places.'>x_dnd_get_window_proxy</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> wdesc)
<a id='L4461' name='L4461'></a>  4461 <em class='brace'>{</em>
<a id='L4462' name='L4462'></a>  4462   <strong class='reserved'>int</strong> rc, actual_format;
<a id='L4463' name='L4463'></a>  4463   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> actual_size, bytes_remaining;
<a id='L4464' name='L4464'></a>  4464   <strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *tmp_data = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L4465' name='L4465'></a>  4465   XWindowAttributes attrs;
<a id='L4466' name='L4466'></a>  4466   Atom actual_type;
<a id='L4467' name='L4467'></a>  4467   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> proxy;
<a id='L4468' name='L4468'></a>  4468 
<a id='L4469' name='L4469'></a>  4469   proxy = None;
<a id='L4470' name='L4470'></a>  4470   x_catch_errors (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L4471' name='L4471'></a>  4471   rc = XGetWindowProperty (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, wdesc,
<a id='L4472' name='L4472'></a>  4472                            dpyinfo-&gt;Xatom_XdndProxy,
<a id='L4473' name='L4473'></a>  4473                            0, 1, False, XA_WINDOW,
<a id='L4474' name='L4474'></a>  4474                            &amp;actual_type, &amp;actual_format,
<a id='L4475' name='L4475'></a>  4475                            &amp;actual_size, &amp;bytes_remaining,
<a id='L4476' name='L4476'></a>  4476                            &amp;tmp_data);
<a id='L4477' name='L4477'></a>  4477 
<a id='L4478' name='L4478'></a>  4478   <strong class='reserved'>if</strong> (!x_had_errors_p (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>)
<a id='L4479' name='L4479'></a>  4479       &amp;&amp; rc == Success
<a id='L4480' name='L4480'></a>  4480       &amp;&amp; tmp_data
<a id='L4481' name='L4481'></a>  4481       &amp;&amp; actual_type == XA_WINDOW
<a id='L4482' name='L4482'></a>  4482       &amp;&amp; actual_format == 32
<a id='L4483' name='L4483'></a>  4483       &amp;&amp; actual_size == 1)
<a id='L4484' name='L4484'></a>  4484     <em class='brace'>{</em>
<a id='L4485' name='L4485'></a>  4485       proxy = *(<a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> *) tmp_data;
<a id='L4486' name='L4486'></a>  4486 
<a id='L4487' name='L4487'></a>  4487       <em class='comment'>/* Verify the proxy window exists.  */</em>
<a id='L4488' name='L4488'></a>  4488       XGetWindowAttributes (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, proxy, &amp;attrs);
<a id='L4489' name='L4489'></a>  4489 
<a id='L4490' name='L4490'></a>  4490       <strong class='reserved'>if</strong> (x_had_errors_p (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>))
<a id='L4491' name='L4491'></a>  4491         proxy = None;
<a id='L4492' name='L4492'></a>  4492     <em class='brace'>}</em>
<a id='L4493' name='L4493'></a>  4493 
<a id='L4494' name='L4494'></a>  4494   <strong class='reserved'>if</strong> (tmp_data)
<a id='L4495' name='L4495'></a>  4495     XFree (tmp_data);
<a id='L4496' name='L4496'></a>  4496   x_uncatch_errors_after_check ();
<a id='L4497' name='L4497'></a>  4497 
<a id='L4498' name='L4498'></a>  4498   <strong class='reserved'>return</strong> proxy;
<a id='L4499' name='L4499'></a>  4499 <em class='brace'>}</em>
<a id='L4500' name='L4500'></a>  4500 
<a id='L4501' name='L4501'></a>  4501 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L4502' name='L4502'></a>  4502 <a href='../R/18135.html' title='Multiple referred from 12 places.'>x_dnd_get_window_proto</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> wdesc)
<a id='L4503' name='L4503'></a>  4503 <em class='brace'>{</em>
<a id='L4504' name='L4504'></a>  4504   Atom actual, <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>;
<a id='L4505' name='L4505'></a>  4505   <strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *tmp_data = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L4506' name='L4506'></a>  4506   <strong class='reserved'>int</strong> rc, format;
<a id='L4507' name='L4507'></a>  4507   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> n, left;
<a id='L4508' name='L4508'></a>  4508   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> had_errors;
<a id='L4509' name='L4509'></a>  4509 
<a id='L4510' name='L4510'></a>  4510   <strong class='reserved'>if</strong> (wdesc == None || (!x_dnd_allow_current_frame
<a id='L4511' name='L4511'></a>  4511                         &amp;&amp; wdesc == <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (x_dnd_frame)))
<a id='L4512' name='L4512'></a>  4512     <strong class='reserved'>return</strong> -1;
<a id='L4513' name='L4513'></a>  4513 
<a id='L4514' name='L4514'></a>  4514   x_catch_errors (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L4515' name='L4515'></a>  4515   rc = XGetWindowProperty (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, wdesc, dpyinfo-&gt;Xatom_XdndAware,
<a id='L4516' name='L4516'></a>  4516                            0, 1, False, XA_ATOM, &amp;actual, &amp;format, &amp;n, &amp;left,
<a id='L4517' name='L4517'></a>  4517                            &amp;tmp_data);
<a id='L4518' name='L4518'></a>  4518   had_errors = x_had_errors_p (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L4519' name='L4519'></a>  4519   x_uncatch_errors_after_check ();
<a id='L4520' name='L4520'></a>  4520 
<a id='L4521' name='L4521'></a>  4521   <strong class='reserved'>if</strong> (had_errors || rc != Success || actual != XA_ATOM || format != 32 || n &lt; 1
<a id='L4522' name='L4522'></a>  4522       || !tmp_data)
<a id='L4523' name='L4523'></a>  4523     <em class='brace'>{</em>
<a id='L4524' name='L4524'></a>  4524       <strong class='reserved'>if</strong> (tmp_data)
<a id='L4525' name='L4525'></a>  4525         XFree (tmp_data);
<a id='L4526' name='L4526'></a>  4526       <strong class='reserved'>return</strong> -1;
<a id='L4527' name='L4527'></a>  4527     <em class='brace'>}</em>
<a id='L4528' name='L4528'></a>  4528 
<a id='L4529' name='L4529'></a>  4529   <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a> = (<strong class='reserved'>int</strong>) *(Atom *) tmp_data;
<a id='L4530' name='L4530'></a>  4530   XFree (tmp_data);
<a id='L4531' name='L4531'></a>  4531 
<a id='L4532' name='L4532'></a>  4532   <strong class='reserved'>return</strong> <a href='../D/14475.html' title='Multiple defined in 11 places.'>min</a> (<a href='../S/2289.html#L3620' title='Defined at 3620 in src/xterm.c.'>X_DND_SUPPORTED_VERSION</a>, (<strong class='reserved'>int</strong>) <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>);
<a id='L4533' name='L4533'></a>  4533 <em class='brace'>}</em>
<a id='L4534' name='L4534'></a>  4534 
<a id='L4535' name='L4535'></a>  4535 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L4536' name='L4536'></a>  4536 <a href='../R/18145.html' title='Multiple referred from 3 places.'>x_dnd_send_enter</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> target, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> toplevel,
<a id='L4537' name='L4537'></a>  4537                   <strong class='reserved'>int</strong> supported)
<a id='L4538' name='L4538'></a>  4538 <em class='brace'>{</em>
<a id='L4539' name='L4539'></a>  4539   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L4540' name='L4540'></a>  4540   <strong class='reserved'>int</strong> i;
<a id='L4541' name='L4541'></a>  4541   XEvent msg;
<a id='L4542' name='L4542'></a>  4542 
<a id='L4543' name='L4543'></a>  4543   msg.xclient.type = ClientMessage;
<a id='L4544' name='L4544'></a>  4544   msg.xclient.message_type = dpyinfo-&gt;Xatom_XdndEnter;
<a id='L4545' name='L4545'></a>  4545   msg.xclient.format = 32;
<a id='L4546' name='L4546'></a>  4546   msg.xclient.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = toplevel;
<a id='L4547' name='L4547'></a>  4547   msg.xclient.data.l[0] = <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L4548' name='L4548'></a>  4548   msg.xclient.data.l[1] = (((<strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong>) <a href='../D/14475.html' title='Multiple defined in 11 places.'>min</a> (<a href='../S/2289.html#L3620' title='Defined at 3620 in src/xterm.c.'>X_DND_SUPPORTED_VERSION</a>,
<a id='L4549' name='L4549'></a>  4549                                                 supported) &lt;&lt; 24)
<a id='L4550' name='L4550'></a>  4550                            | (x_dnd_n_targets &gt; 3 ? 1 : 0));
<a id='L4551' name='L4551'></a>  4551   msg.xclient.data.l[2] = 0;
<a id='L4552' name='L4552'></a>  4552   msg.xclient.data.l[3] = 0;
<a id='L4553' name='L4553'></a>  4553   msg.xclient.data.l[4] = 0;
<a id='L4554' name='L4554'></a>  4554 
<a id='L4555' name='L4555'></a>  4555   <strong class='reserved'>for</strong> (i = 0; i &lt; <a href='../D/14475.html' title='Multiple defined in 11 places.'>min</a> (3, x_dnd_n_targets); ++i)
<a id='L4556' name='L4556'></a>  4556     msg.xclient.data.l[i + 2] = x_dnd_targets[i];
<a id='L4557' name='L4557'></a>  4557 
<a id='L4558' name='L4558'></a>  4558   <strong class='reserved'>if</strong> (x_dnd_n_targets &gt; 3 &amp;&amp; !x_dnd_init_type_lists)
<a id='L4559' name='L4559'></a>  4559     XChangeProperty (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L4560' name='L4560'></a>  4560                      dpyinfo-&gt;Xatom_XdndTypeList, XA_ATOM, 32,
<a id='L4561' name='L4561'></a>  4561                      PropModeReplace, (<strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *) x_dnd_targets,
<a id='L4562' name='L4562'></a>  4562                      x_dnd_n_targets);
<a id='L4563' name='L4563'></a>  4563 
<a id='L4564' name='L4564'></a>  4564   <em class='comment'>/* Now record that the type list has already been set (if required),</em>
<a id='L4565' name='L4565'></a>  4565 <em class='comment'>     so we don't have to set it again.  */</em>
<a id='L4566' name='L4566'></a>  4566   x_dnd_init_type_lists = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L4567' name='L4567'></a>  4567 
<a id='L4568' name='L4568'></a>  4568   x_ignore_errors_for_next_request (dpyinfo, 0);
<a id='L4569' name='L4569'></a>  4569   XSendEvent (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), target, False, NoEventMask, &amp;msg);
<a id='L4570' name='L4570'></a>  4570   x_stop_ignoring_errors (dpyinfo);
<a id='L4571' name='L4571'></a>  4571 <em class='brace'>}</em>
<a id='L4572' name='L4572'></a>  4572 
<a id='L4573' name='L4573'></a>  4573 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L4574' name='L4574'></a>  4574 <a href='../R/18147.html' title='Multiple referred from 5 places.'>x_dnd_send_position</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> target, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> toplevel,
<a id='L4575' name='L4575'></a>  4575                      <strong class='reserved'>int</strong> supported, <strong class='reserved'>unsigned</strong> <strong class='reserved'>short</strong> root_x,
<a id='L4576' name='L4576'></a>  4576                      <strong class='reserved'>unsigned</strong> <strong class='reserved'>short</strong> root_y, <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a> timestamp, Atom action,
<a id='L4577' name='L4577'></a>  4577                      <strong class='reserved'>int</strong> button, <strong class='reserved'>unsigned</strong> state)
<a id='L4578' name='L4578'></a>  4578 <em class='brace'>{</em>
<a id='L4579' name='L4579'></a>  4579   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L4580' name='L4580'></a>  4580   XEvent msg;
<a id='L4581' name='L4581'></a>  4581 
<a id='L4582' name='L4582'></a>  4582   msg.xclient.type = ClientMessage;
<a id='L4583' name='L4583'></a>  4583   msg.xclient.message_type = dpyinfo-&gt;Xatom_XdndPosition;
<a id='L4584' name='L4584'></a>  4584   msg.xclient.format = 32;
<a id='L4585' name='L4585'></a>  4585   msg.xclient.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = toplevel;
<a id='L4586' name='L4586'></a>  4586   msg.xclient.data.l[0] = <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L4587' name='L4587'></a>  4587   msg.xclient.data.l[1] = 0;
<a id='L4588' name='L4588'></a>  4588 
<a id='L4589' name='L4589'></a>  4589   <em class='comment'>/* This is problematic because it's not specified in the</em>
<a id='L4590' name='L4590'></a>  4590 <em class='comment'>     freedesktop.org copy of the protocol specification, but the copy</em>
<a id='L4591' name='L4591'></a>  4591 <em class='comment'>     maintained by the original author of the protocol specifies it</em>
<a id='L4592' name='L4592'></a>  4592 <em class='comment'>     for all versions.  Since at least one program supports these</em>
<a id='L4593' name='L4593'></a>  4593 <em class='comment'>     flags, but uses protocol v4 (and not v5), set them for all</em>
<a id='L4594' name='L4594'></a>  4594 <em class='comment'>     protocol versions.  */</em>
<a id='L4595' name='L4595'></a>  4595   <strong class='reserved'>if</strong> (button &gt;= 4 &amp;&amp; button &lt;= 7)
<a id='L4596' name='L4596'></a>  4596     <em class='brace'>{</em>
<a id='L4597' name='L4597'></a>  4597       msg.xclient.data.l[1] |= (1 &lt;&lt; 10);
<a id='L4598' name='L4598'></a>  4598       msg.xclient.data.l[1] |= (button - 4) &lt;&lt; 8;
<a id='L4599' name='L4599'></a>  4599     <em class='brace'>}</em>
<a id='L4600' name='L4600'></a>  4600   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (button)
<a id='L4601' name='L4601'></a>  4601     <strong class='reserved'>return</strong>;
<a id='L4602' name='L4602'></a>  4602 
<a id='L4603' name='L4603'></a>  4603   msg.xclient.data.l[1] |= state &amp; 0xff;
<a id='L4604' name='L4604'></a>  4604 
<a id='L4605' name='L4605'></a>  4605   msg.xclient.data.l[2] = (root_x &lt;&lt; 16) | root_y;
<a id='L4606' name='L4606'></a>  4606   msg.xclient.data.l[3] = 0;
<a id='L4607' name='L4607'></a>  4607   msg.xclient.data.l[4] = 0;
<a id='L4608' name='L4608'></a>  4608 
<a id='L4609' name='L4609'></a>  4609   <strong class='reserved'>if</strong> (supported &gt;= 3)
<a id='L4610' name='L4610'></a>  4610     msg.xclient.data.l[3] = timestamp;
<a id='L4611' name='L4611'></a>  4611 
<a id='L4612' name='L4612'></a>  4612   <strong class='reserved'>if</strong> (supported &gt;= 4)
<a id='L4613' name='L4613'></a>  4613     msg.xclient.data.l[4] = action;
<a id='L4614' name='L4614'></a>  4614 
<a id='L4615' name='L4615'></a>  4615   <strong class='reserved'>if</strong> (x_dnd_waiting_for_status_window == target)
<a id='L4616' name='L4616'></a>  4616     <em class='brace'>{</em>
<a id='L4617' name='L4617'></a>  4617       x_dnd_pending_send_position = msg;
<a id='L4618' name='L4618'></a>  4618       x_dnd_pending_send_position_button = button;
<a id='L4619' name='L4619'></a>  4619       x_dnd_pending_send_position_root_x = root_x;
<a id='L4620' name='L4620'></a>  4620       x_dnd_pending_send_position_root_y = root_y;
<a id='L4621' name='L4621'></a>  4621     <em class='brace'>}</em>
<a id='L4622' name='L4622'></a>  4622   <strong class='reserved'>else</strong>
<a id='L4623' name='L4623'></a>  4623     <em class='brace'>{</em>
<a id='L4624' name='L4624'></a>  4624       <strong class='reserved'>if</strong> (target == x_dnd_mouse_rect_target
<a id='L4625' name='L4625'></a>  4625           &amp;&amp; x_dnd_mouse_rect.width
<a id='L4626' name='L4626'></a>  4626           &amp;&amp; x_dnd_mouse_rect.height
<a id='L4627' name='L4627'></a>  4627           <em class='comment'>/* Ignore the mouse rectangle if we're supposed to be sending a</em>
<a id='L4628' name='L4628'></a>  4628 <em class='comment'>             button press instead.  */</em>
<a id='L4629' name='L4629'></a>  4629           &amp;&amp; !button)
<a id='L4630' name='L4630'></a>  4630         <em class='brace'>{</em>
<a id='L4631' name='L4631'></a>  4631           <strong class='reserved'>if</strong> (root_x &gt;= x_dnd_mouse_rect.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>
<a id='L4632' name='L4632'></a>  4632               &amp;&amp; root_x &lt; (x_dnd_mouse_rect.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>
<a id='L4633' name='L4633'></a>  4633                            + x_dnd_mouse_rect.width)
<a id='L4634' name='L4634'></a>  4634               &amp;&amp; root_y &gt;= x_dnd_mouse_rect.y
<a id='L4635' name='L4635'></a>  4635               &amp;&amp; root_y &lt; (x_dnd_mouse_rect.y
<a id='L4636' name='L4636'></a>  4636                            + x_dnd_mouse_rect.height))
<a id='L4637' name='L4637'></a>  4637             <strong class='reserved'>return</strong>;
<a id='L4638' name='L4638'></a>  4638         <em class='brace'>}</em>
<a id='L4639' name='L4639'></a>  4639 
<a id='L4640' name='L4640'></a>  4640       x_ignore_errors_for_next_request (dpyinfo, 0);
<a id='L4641' name='L4641'></a>  4641       XSendEvent (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), target, False, NoEventMask, &amp;msg);
<a id='L4642' name='L4642'></a>  4642       x_stop_ignoring_errors (dpyinfo);
<a id='L4643' name='L4643'></a>  4643 
<a id='L4644' name='L4644'></a>  4644       x_dnd_waiting_for_status_window = target;
<a id='L4645' name='L4645'></a>  4645     <em class='brace'>}</em>
<a id='L4646' name='L4646'></a>  4646 <em class='brace'>}</em>
<a id='L4647' name='L4647'></a>  4647 
<a id='L4648' name='L4648'></a>  4648 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L4649' name='L4649'></a>  4649 <a href='../R/18146.html' title='Multiple referred from 12 places.'>x_dnd_send_leave</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> target, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> toplevel)
<a id='L4650' name='L4650'></a>  4650 <em class='brace'>{</em>
<a id='L4651' name='L4651'></a>  4651   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L4652' name='L4652'></a>  4652   XEvent msg;
<a id='L4653' name='L4653'></a>  4653 
<a id='L4654' name='L4654'></a>  4654   msg.xclient.type = ClientMessage;
<a id='L4655' name='L4655'></a>  4655   msg.xclient.message_type = dpyinfo-&gt;Xatom_XdndLeave;
<a id='L4656' name='L4656'></a>  4656   msg.xclient.format = 32;
<a id='L4657' name='L4657'></a>  4657   msg.xclient.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = toplevel;
<a id='L4658' name='L4658'></a>  4658   msg.xclient.data.l[0] = <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L4659' name='L4659'></a>  4659   msg.xclient.data.l[1] = 0;
<a id='L4660' name='L4660'></a>  4660   msg.xclient.data.l[2] = 0;
<a id='L4661' name='L4661'></a>  4661   msg.xclient.data.l[3] = 0;
<a id='L4662' name='L4662'></a>  4662   msg.xclient.data.l[4] = 0;
<a id='L4663' name='L4663'></a>  4663 
<a id='L4664' name='L4664'></a>  4664   x_dnd_waiting_for_status_window = None;
<a id='L4665' name='L4665'></a>  4665   x_dnd_pending_send_position.type = 0;
<a id='L4666' name='L4666'></a>  4666 
<a id='L4667' name='L4667'></a>  4667   x_ignore_errors_for_next_request (dpyinfo, 0);
<a id='L4668' name='L4668'></a>  4668   XSendEvent (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), target, False, NoEventMask, &amp;msg);
<a id='L4669' name='L4669'></a>  4669   x_stop_ignoring_errors (dpyinfo);
<a id='L4670' name='L4670'></a>  4670 <em class='brace'>}</em>
<a id='L4671' name='L4671'></a>  4671 
<a id='L4672' name='L4672'></a>  4672 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L4673' name='L4673'></a>  4673 <a href='../R/18144.html' title='Multiple referred from 2 places.'>x_dnd_send_drop</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> target, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> toplevel,
<a id='L4674' name='L4674'></a>  4674                  <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a> timestamp, <strong class='reserved'>int</strong> supported)
<a id='L4675' name='L4675'></a>  4675 <em class='brace'>{</em>
<a id='L4676' name='L4676'></a>  4676   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L4677' name='L4677'></a>  4677   XEvent msg;
<a id='L4678' name='L4678'></a>  4678 
<a id='L4679' name='L4679'></a>  4679   <strong class='reserved'>if</strong> (x_dnd_action == None)
<a id='L4680' name='L4680'></a>  4680     <em class='brace'>{</em>
<a id='L4681' name='L4681'></a>  4681       <a href='../S/2289.html#L4649' title='Defined at 4649 in src/xterm.c.'>x_dnd_send_leave</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, target, toplevel);
<a id='L4682' name='L4682'></a>  4682       <strong class='reserved'>return</strong> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L4683' name='L4683'></a>  4683     <em class='brace'>}</em>
<a id='L4684' name='L4684'></a>  4684 
<a id='L4685' name='L4685'></a>  4685   dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L4686' name='L4686'></a>  4686 
<a id='L4687' name='L4687'></a>  4687   msg.xclient.type = ClientMessage;
<a id='L4688' name='L4688'></a>  4688   msg.xclient.message_type = dpyinfo-&gt;Xatom_XdndDrop;
<a id='L4689' name='L4689'></a>  4689   msg.xclient.format = 32;
<a id='L4690' name='L4690'></a>  4690   msg.xclient.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = toplevel;
<a id='L4691' name='L4691'></a>  4691   msg.xclient.data.l[0] = <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L4692' name='L4692'></a>  4692   msg.xclient.data.l[1] = 0;
<a id='L4693' name='L4693'></a>  4693   msg.xclient.data.l[2] = 0;
<a id='L4694' name='L4694'></a>  4694   msg.xclient.data.l[3] = 0;
<a id='L4695' name='L4695'></a>  4695   msg.xclient.data.l[4] = 0;
<a id='L4696' name='L4696'></a>  4696 
<a id='L4697' name='L4697'></a>  4697   <strong class='reserved'>if</strong> (supported &gt;= 1)
<a id='L4698' name='L4698'></a>  4698     msg.xclient.data.l[2] = timestamp;
<a id='L4699' name='L4699'></a>  4699 
<a id='L4700' name='L4700'></a>  4700   x_ignore_errors_for_next_request (dpyinfo, 0);
<a id='L4701' name='L4701'></a>  4701   XSendEvent (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), target, False, NoEventMask, &amp;msg);
<a id='L4702' name='L4702'></a>  4702   x_stop_ignoring_errors (dpyinfo);
<a id='L4703' name='L4703'></a>  4703   <strong class='reserved'>return</strong> <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L4704' name='L4704'></a>  4704 <em class='brace'>}</em>
<a id='L4705' name='L4705'></a>  4705 
<a id='L4706' name='L4706'></a>  4706 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L4707' name='L4707'></a>  4707 <a href='../R/18127.html' title='Multiple referred from 2 places.'>x_dnd_do_drop</a> (<a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> target, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> toplevel, <strong class='reserved'>int</strong> supported)
<a id='L4708' name='L4708'></a>  4708 <em class='brace'>{</em>
<a id='L4709' name='L4709'></a>  4709   <strong class='reserved'>if</strong> (x_dnd_waiting_for_status_window != target)
<a id='L4710' name='L4710'></a>  4710     <strong class='reserved'>return</strong> <a href='../S/2289.html#L4673' title='Defined at 4673 in src/xterm.c.'>x_dnd_send_drop</a> (x_dnd_frame, target, toplevel,
<a id='L4711' name='L4711'></a>  4711                             x_dnd_selection_timestamp, supported);
<a id='L4712' name='L4712'></a>  4712 
<a id='L4713' name='L4713'></a>  4713   x_dnd_need_send_drop = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L4714' name='L4714'></a>  4714   x_dnd_send_drop_proto = supported;
<a id='L4715' name='L4715'></a>  4715 
<a id='L4716' name='L4716'></a>  4716   <strong class='reserved'>return</strong> <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L4717' name='L4717'></a>  4717 <em class='brace'>}</em>
<a id='L4718' name='L4718'></a>  4718 
<a id='L4719' name='L4719'></a>  4719 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L4720' name='L4720'></a>  4720 <a href='../S/2289.html#L12492' title='Referred from 12492 in src/xterm.c.'>x_set_dnd_targets</a> (Atom *targets, <strong class='reserved'>int</strong> ntargets)
<a id='L4721' name='L4721'></a>  4721 <em class='brace'>{</em>
<a id='L4722' name='L4722'></a>  4722   <strong class='reserved'>if</strong> (x_dnd_targets)
<a id='L4723' name='L4723'></a>  4723     <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (x_dnd_targets);
<a id='L4724' name='L4724'></a>  4724 
<a id='L4725' name='L4725'></a>  4725   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L4726' name='L4726'></a>  4726   x_dnd_targets = <a href='../D/20068.html' title='Multiple defined in 10 places.'>xmalloc</a> (<strong class='reserved'>sizeof</strong> *targets * ntargets);
<a id='L4727' name='L4727'></a>  4727   x_dnd_n_targets = ntargets;
<a id='L4728' name='L4728'></a>  4728 
<a id='L4729' name='L4729'></a>  4729   memcpy (x_dnd_targets, targets,
<a id='L4730' name='L4730'></a>  4730           <strong class='reserved'>sizeof</strong> *targets * ntargets);
<a id='L4731' name='L4731'></a>  4731   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L4732' name='L4732'></a>  4732 <em class='brace'>}</em>
<a id='L4733' name='L4733'></a>  4733 
<a id='L4734' name='L4734'></a>  4734 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L4735' name='L4735'></a>  4735 <a href='../S/2289.html#L12493' title='Referred from 12493 in src/xterm.c.'>x_free_dnd_targets</a> (<strong class='reserved'>void</strong>)
<a id='L4736' name='L4736'></a>  4736 <em class='brace'>{</em>
<a id='L4737' name='L4737'></a>  4737   <strong class='reserved'>if</strong> (!x_dnd_targets)
<a id='L4738' name='L4738'></a>  4738     <strong class='reserved'>return</strong>;
<a id='L4739' name='L4739'></a>  4739 
<a id='L4740' name='L4740'></a>  4740   <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (x_dnd_targets);
<a id='L4741' name='L4741'></a>  4741   x_dnd_targets = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L4742' name='L4742'></a>  4742   x_dnd_n_targets = 0;
<a id='L4743' name='L4743'></a>  4743 <em class='brace'>}</em>
<a id='L4744' name='L4744'></a>  4744 
<a id='L4745' name='L4745'></a>  4745 <em class='comment'>/* Clear some Lisp variables after the drop finishes, so they are</em>
<a id='L4746' name='L4746'></a>  4746 <em class='comment'>   freed by the GC.  */</em>
<a id='L4747' name='L4747'></a>  4747 
<a id='L4748' name='L4748'></a>  4748 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L4749' name='L4749'></a>  4749 <a href='../S/2289.html#L12577' title='Referred from 12577 in src/xterm.c.'>x_clear_dnd_variables</a> (<strong class='reserved'>void</strong>)
<a id='L4750' name='L4750'></a>  4750 <em class='brace'>{</em>
<a id='L4751' name='L4751'></a>  4751   x_dnd_monitors = Qnil;
<a id='L4752' name='L4752'></a>  4752   x_dnd_unsupported_drop_data = Qnil;
<a id='L4753' name='L4753'></a>  4753 <em class='brace'>}</em>
<a id='L4754' name='L4754'></a>  4754 
<a id='L4755' name='L4755'></a>  4755 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L4756' name='L4756'></a>  4756 <a href='../S/2289.html#L12700' title='Referred from 12700 in src/xterm.c.'>x_free_dnd_toplevels</a> (<strong class='reserved'>void</strong>)
<a id='L4757' name='L4757'></a>  4757 <em class='brace'>{</em>
<a id='L4758' name='L4758'></a>  4758   <strong class='reserved'>if</strong> (!x_dnd_use_toplevels || !x_dnd_toplevels)
<a id='L4759' name='L4759'></a>  4759     <strong class='reserved'>return</strong>;
<a id='L4760' name='L4760'></a>  4760 
<a id='L4761' name='L4761'></a>  4761   <em class='comment'>/* If the display is deleted, x_dnd_toplevels will already be</em>
<a id='L4762' name='L4762'></a>  4762 <em class='comment'>     NULL, so we can always assume the display is alive here.  */</em>
<a id='L4763' name='L4763'></a>  4763 
<a id='L4764' name='L4764'></a>  4764   <a href='../S/2289.html#L2918' title='Defined at 2918 in src/xterm.c.'>x_dnd_free_toplevels</a> (<a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L4765' name='L4765'></a>  4765 <em class='brace'>}</em>
<a id='L4766' name='L4766'></a>  4766 
<a id='L4767' name='L4767'></a>  4767 <em class='comment'>/* Restore event masks and window properties changed during a</em>
<a id='L4768' name='L4768'></a>  4768 <em class='comment'>   drag-and-drop operation, after it finishes.  */</em>
<a id='L4769' name='L4769'></a>  4769 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L4770' name='L4770'></a>  4770 <a href='../R/18278.html' title='Multiple referred from 5 places.'>x_restore_events_after_dnd</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, XWindowAttributes *wa)
<a id='L4771' name='L4771'></a>  4771 <em class='brace'>{</em>
<a id='L4772' name='L4772'></a>  4772   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L4773' name='L4773'></a>  4773 
<a id='L4774' name='L4774'></a>  4774   dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L4775' name='L4775'></a>  4775 
<a id='L4776' name='L4776'></a>  4776   <em class='comment'>/* Restore the old event mask.  */</em>
<a id='L4777' name='L4777'></a>  4777   XSelectInput (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, dpyinfo-&gt;root_window,
<a id='L4778' name='L4778'></a>  4778                 wa-&gt;your_event_mask);
<a id='L4779' name='L4779'></a>  4779 <em class='sharp'>#ifdef</em> HAVE_XKB
<a id='L4780' name='L4780'></a>  4780   <strong class='reserved'>if</strong> (dpyinfo-&gt;supports_xkb)
<a id='L4781' name='L4781'></a>  4781     XkbSelectEvents (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, XkbUseCoreKbd,
<a id='L4782' name='L4782'></a>  4782                      XkbStateNotifyMask, 0);
<a id='L4783' name='L4783'></a>  4783 <em class='sharp'>#endif</em>
<a id='L4784' name='L4784'></a>  4784   <em class='comment'>/* Delete the Motif drag initiator info if it was set up.  */</em>
<a id='L4785' name='L4785'></a>  4785   <strong class='reserved'>if</strong> (x_dnd_motif_setup_p)
<a id='L4786' name='L4786'></a>  4786     XDeleteProperty (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L4787' name='L4787'></a>  4787                      x_dnd_motif_atom);
<a id='L4788' name='L4788'></a>  4788 
<a id='L4789' name='L4789'></a>  4789   <em class='comment'>/* Remove any type list set as well.  */</em>
<a id='L4790' name='L4790'></a>  4790   <strong class='reserved'>if</strong> (x_dnd_init_type_lists &amp;&amp; x_dnd_n_targets &gt; 3)
<a id='L4791' name='L4791'></a>  4791     XDeleteProperty (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L4792' name='L4792'></a>  4792                      dpyinfo-&gt;Xatom_XdndTypeList);
<a id='L4793' name='L4793'></a>  4793 <em class='brace'>}</em>
<a id='L4794' name='L4794'></a>  4794 
<a id='L4795' name='L4795'></a>  4795 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L4796' name='L4796'></a>  4796 
<a id='L4797' name='L4797'></a>  4797 <em class='comment'>/* Cancel the current drag-and-drop operation, sending leave messages</em>
<a id='L4798' name='L4798'></a>  4798 <em class='comment'>   to any relevant toplevels.  This is called from the event loop when</em>
<a id='L4799' name='L4799'></a>  4799 <em class='comment'>   an event is received telling Emacs to gracefully cancel the</em>
<a id='L4800' name='L4800'></a>  4800 <em class='comment'>   drag-and-drop operation.  */</em>
<a id='L4801' name='L4801'></a>  4801 
<a id='L4802' name='L4802'></a>  4802 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L4803' name='L4803'></a>  4803 <a href='../S/2289.html#L13599' title='Referred from 13599 in src/xterm.c.'>x_dnd_cancel_dnd_early</a> (<strong class='reserved'>void</strong>)
<a id='L4804' name='L4804'></a>  4804 <em class='brace'>{</em>
<a id='L4805' name='L4805'></a>  4805   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L4806' name='L4806'></a>  4806   <a href='../D/20018.html' title='Multiple defined in 2 places.'>xm_drop_start_message</a> dmsg;
<a id='L4807' name='L4807'></a>  4807 
<a id='L4808' name='L4808'></a>  4808   <a href='../D/10871.html' title='Multiple defined in 5 places.'>eassert</a> (x_dnd_frame &amp;&amp; x_dnd_in_progress);
<a id='L4809' name='L4809'></a>  4809 
<a id='L4810' name='L4810'></a>  4810   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = x_dnd_frame;
<a id='L4811' name='L4811'></a>  4811 
<a id='L4812' name='L4812'></a>  4812   <strong class='reserved'>if</strong> (x_dnd_last_seen_window != None
<a id='L4813' name='L4813'></a>  4813       &amp;&amp; x_dnd_last_protocol_version != -1)
<a id='L4814' name='L4814'></a>  4814     <a href='../S/2289.html#L4649' title='Defined at 4649 in src/xterm.c.'>x_dnd_send_leave</a> (x_dnd_frame,
<a id='L4815' name='L4815'></a>  4815                       x_dnd_last_seen_window,
<a id='L4816' name='L4816'></a>  4816                       x_dnd_last_seen_toplevel);
<a id='L4817' name='L4817'></a>  4817   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (x_dnd_last_seen_window != None
<a id='L4818' name='L4818'></a>  4818            &amp;&amp; !<a href='../S/2289.html#L1748' title='Defined at 1748 in src/xterm.c.'>XM_DRAG_STYLE_IS_DROP_ONLY</a> (x_dnd_last_motif_style)
<a id='L4819' name='L4819'></a>  4819            &amp;&amp; x_dnd_last_motif_style != <a href='../S/2289.html#L1740' title='Defined at 1740 in src/xterm.c.'>XM_DRAG_STYLE_NONE</a>
<a id='L4820' name='L4820'></a>  4820            &amp;&amp; x_dnd_motif_setup_p)
<a id='L4821' name='L4821'></a>  4821     <em class='brace'>{</em>
<a id='L4822' name='L4822'></a>  4822       dmsg.reason = <a href='../S/2289.html#L1718' title='Defined at 1718 in src/xterm.c.'>XM_DRAG_REASON</a> (<a href='../S/2289.html#L1732' title='Defined at 1732 in src/xterm.c.'>XM_DRAG_ORIGINATOR_INITIATOR</a>,
<a id='L4823' name='L4823'></a>  4823                                     <a href='../S/2289.html#L1724' title='Defined at 1724 in src/xterm.c.'>XM_DRAG_REASON_DROP_START</a>);
<a id='L4824' name='L4824'></a>  4824       dmsg.byte_order = <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>;
<a id='L4825' name='L4825'></a>  4825       dmsg.timestamp = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;last_user_time;
<a id='L4826' name='L4826'></a>  4826       dmsg.side_effects
<a id='L4827' name='L4827'></a>  4827         = <a href='../S/2289.html#L1689' title='Defined at 1689 in src/xterm.c.'>XM_DRAG_SIDE_EFFECT</a> (<a href='../S/2289.html#L1766' title='Defined at 1766 in src/xterm.c.'>xm_side_effect_from_action</a> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L4828' name='L4828'></a>  4828                                                            x_dnd_wanted_action),
<a id='L4829' name='L4829'></a>  4829                                <a href='../S/2289.html#L1756' title='Defined at 1756 in src/xterm.c.'>XM_DROP_SITE_VALID</a>, x_dnd_motif_operations,
<a id='L4830' name='L4830'></a>  4830                                <a href='../S/2289.html#L1715' title='Defined at 1715 in src/xterm.c.'>XM_DROP_ACTION_DROP_CANCEL</a>);
<a id='L4831' name='L4831'></a>  4831       dmsg.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = 0;
<a id='L4832' name='L4832'></a>  4832       dmsg.y = 0;
<a id='L4833' name='L4833'></a>  4833       dmsg.index_atom = x_dnd_motif_atom;
<a id='L4834' name='L4834'></a>  4834       dmsg.source_window = <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L4835' name='L4835'></a>  4835 
<a id='L4836' name='L4836'></a>  4836       <a href='../S/2289.html#L2899' title='Defined at 2899 in src/xterm.c.'>x_dnd_send_xm_leave_for_drop</a> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>,
<a id='L4837' name='L4837'></a>  4837                                     x_dnd_last_seen_window,
<a id='L4838' name='L4838'></a>  4838                                     <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;last_user_time);
<a id='L4839' name='L4839'></a>  4839       <a href='../S/2289.html#L2565' title='Defined at 2565 in src/xterm.c.'>xm_send_drop_message</a> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L4840' name='L4840'></a>  4840                             x_dnd_last_seen_window, &amp;dmsg);
<a id='L4841' name='L4841'></a>  4841     <em class='brace'>}</em>
<a id='L4842' name='L4842'></a>  4842 
<a id='L4843' name='L4843'></a>  4843   x_dnd_last_seen_window = None;
<a id='L4844' name='L4844'></a>  4844   x_dnd_last_seen_toplevel = None;
<a id='L4845' name='L4845'></a>  4845   x_dnd_in_progress = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L4846' name='L4846'></a>  4846   x_dnd_waiting_for_finish = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L4847' name='L4847'></a>  4847   x_dnd_return_frame_object = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L4848' name='L4848'></a>  4848   x_dnd_movement_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L4849' name='L4849'></a>  4849   x_dnd_wheel_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L4850' name='L4850'></a>  4850   x_dnd_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L4851' name='L4851'></a>  4851   x_dnd_action = None;
<a id='L4852' name='L4852'></a>  4852   x_dnd_action_symbol = Qnil;
<a id='L4853' name='L4853'></a>  4853 <em class='brace'>}</em>
<a id='L4854' name='L4854'></a>  4854 
<a id='L4855' name='L4855'></a>  4855 <em class='sharp'>#endif</em>
<a id='L4856' name='L4856'></a>  4856 
<a id='L4857' name='L4857'></a>  4857 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L4858' name='L4858'></a>  4858 <a href='../R/18124.html' title='Multiple referred from 4 places.'>x_dnd_cleanup_drag_and_drop</a> (<strong class='reserved'>void</strong> *<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)
<a id='L4859' name='L4859'></a>  4859 <em class='brace'>{</em>
<a id='L4860' name='L4860'></a>  4860   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>;
<a id='L4861' name='L4861'></a>  4861   <a href='../D/20018.html' title='Multiple defined in 2 places.'>xm_drop_start_message</a> dmsg;
<a id='L4862' name='L4862'></a>  4862 
<a id='L4863' name='L4863'></a>  4863   <strong class='reserved'>if</strong> (!x_dnd_unwind_flag)
<a id='L4864' name='L4864'></a>  4864     <strong class='reserved'>return</strong>;
<a id='L4865' name='L4865'></a>  4865 
<a id='L4866' name='L4866'></a>  4866   <strong class='reserved'>if</strong> (x_dnd_in_progress)
<a id='L4867' name='L4867'></a>  4867     <em class='brace'>{</em>
<a id='L4868' name='L4868'></a>  4868       <a href='../D/10871.html' title='Multiple defined in 5 places.'>eassert</a> (x_dnd_frame);
<a id='L4869' name='L4869'></a>  4869 
<a id='L4870' name='L4870'></a>  4870       <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L4871' name='L4871'></a>  4871       <strong class='reserved'>if</strong> (x_dnd_last_seen_window != None
<a id='L4872' name='L4872'></a>  4872           &amp;&amp; x_dnd_last_protocol_version != -1)
<a id='L4873' name='L4873'></a>  4873         <a href='../S/2289.html#L4649' title='Defined at 4649 in src/xterm.c.'>x_dnd_send_leave</a> (x_dnd_frame,
<a id='L4874' name='L4874'></a>  4874                           x_dnd_last_seen_window,
<a id='L4875' name='L4875'></a>  4875                           x_dnd_last_seen_toplevel);
<a id='L4876' name='L4876'></a>  4876       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (x_dnd_last_seen_window != None
<a id='L4877' name='L4877'></a>  4877                &amp;&amp; !<a href='../S/2289.html#L1748' title='Defined at 1748 in src/xterm.c.'>XM_DRAG_STYLE_IS_DROP_ONLY</a> (x_dnd_last_motif_style)
<a id='L4878' name='L4878'></a>  4878                &amp;&amp; x_dnd_last_motif_style != <a href='../S/2289.html#L1740' title='Defined at 1740 in src/xterm.c.'>XM_DRAG_STYLE_NONE</a>
<a id='L4879' name='L4879'></a>  4879                &amp;&amp; x_dnd_motif_setup_p)
<a id='L4880' name='L4880'></a>  4880         <em class='brace'>{</em>
<a id='L4881' name='L4881'></a>  4881           dmsg.reason = <a href='../S/2289.html#L1718' title='Defined at 1718 in src/xterm.c.'>XM_DRAG_REASON</a> (<a href='../S/2289.html#L1732' title='Defined at 1732 in src/xterm.c.'>XM_DRAG_ORIGINATOR_INITIATOR</a>,
<a id='L4882' name='L4882'></a>  4882                                         <a href='../S/2289.html#L1724' title='Defined at 1724 in src/xterm.c.'>XM_DRAG_REASON_DROP_START</a>);
<a id='L4883' name='L4883'></a>  4883           dmsg.byte_order = <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>;
<a id='L4884' name='L4884'></a>  4884           dmsg.timestamp = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;last_user_time;
<a id='L4885' name='L4885'></a>  4885           dmsg.side_effects
<a id='L4886' name='L4886'></a>  4886             = <a href='../S/2289.html#L1689' title='Defined at 1689 in src/xterm.c.'>XM_DRAG_SIDE_EFFECT</a> (<a href='../S/2289.html#L1766' title='Defined at 1766 in src/xterm.c.'>xm_side_effect_from_action</a> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L4887' name='L4887'></a>  4887                                                                x_dnd_wanted_action),
<a id='L4888' name='L4888'></a>  4888                                    <a href='../S/2289.html#L1756' title='Defined at 1756 in src/xterm.c.'>XM_DROP_SITE_VALID</a>, x_dnd_motif_operations,
<a id='L4889' name='L4889'></a>  4889                                    <a href='../S/2289.html#L1715' title='Defined at 1715 in src/xterm.c.'>XM_DROP_ACTION_DROP_CANCEL</a>);
<a id='L4890' name='L4890'></a>  4890           dmsg.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = 0;
<a id='L4891' name='L4891'></a>  4891           dmsg.y = 0;
<a id='L4892' name='L4892'></a>  4892           dmsg.index_atom = x_dnd_motif_atom;
<a id='L4893' name='L4893'></a>  4893           dmsg.source_window = <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L4894' name='L4894'></a>  4894 
<a id='L4895' name='L4895'></a>  4895           <a href='../S/2289.html#L2899' title='Defined at 2899 in src/xterm.c.'>x_dnd_send_xm_leave_for_drop</a> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>,
<a id='L4896' name='L4896'></a>  4896                                         x_dnd_last_seen_window,
<a id='L4897' name='L4897'></a>  4897                                         <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;last_user_time);
<a id='L4898' name='L4898'></a>  4898           <a href='../S/2289.html#L2565' title='Defined at 2565 in src/xterm.c.'>xm_send_drop_message</a> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L4899' name='L4899'></a>  4899                                 x_dnd_last_seen_window, &amp;dmsg);
<a id='L4900' name='L4900'></a>  4900         <em class='brace'>}</em>
<a id='L4901' name='L4901'></a>  4901       <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L4902' name='L4902'></a>  4902 
<a id='L4903' name='L4903'></a>  4903       x_dnd_end_window = x_dnd_last_seen_window;
<a id='L4904' name='L4904'></a>  4904       x_dnd_last_seen_window = None;
<a id='L4905' name='L4905'></a>  4905       x_dnd_last_seen_toplevel = None;
<a id='L4906' name='L4906'></a>  4906       x_dnd_in_progress = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L4907' name='L4907'></a>  4907     <em class='brace'>}</em>
<a id='L4908' name='L4908'></a>  4908 
<a id='L4909' name='L4909'></a>  4909   x_dnd_waiting_for_finish = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L4910' name='L4910'></a>  4910 
<a id='L4911' name='L4911'></a>  4911   <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;grabbed = 0;
<a id='L4912' name='L4912'></a>  4912 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L4913' name='L4913'></a>  4913   current_hold_quit = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L4914' name='L4914'></a>  4914 <em class='sharp'>#endif</em>
<a id='L4915' name='L4915'></a>  4915   x_dnd_return_frame_object = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L4916' name='L4916'></a>  4916   x_dnd_movement_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L4917' name='L4917'></a>  4917   x_dnd_wheel_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L4918' name='L4918'></a>  4918   x_dnd_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L4919' name='L4919'></a>  4919 
<a id='L4920' name='L4920'></a>  4920   <a href='../S/2289.html#L4770' title='Defined at 4770 in src/xterm.c.'>x_restore_events_after_dnd</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, &amp;x_dnd_old_window_attrs);
<a id='L4921' name='L4921'></a>  4921 <em class='brace'>}</em>
<a id='L4922' name='L4922'></a>  4922 
<a id='L4923' name='L4923'></a>  4923 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L4924' name='L4924'></a>  4924 <a href='../R/18141.html' title='Multiple referred from 3 places.'>x_dnd_note_self_position</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> target,
<a id='L4925' name='L4925'></a>  4925                           <strong class='reserved'>unsigned</strong> <strong class='reserved'>short</strong> root_x, <strong class='reserved'>unsigned</strong> <strong class='reserved'>short</strong> root_y)
<a id='L4926' name='L4926'></a>  4926 <em class='brace'>{</em>
<a id='L4927' name='L4927'></a>  4927   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L4928' name='L4928'></a>  4928   <strong class='reserved'>int</strong> dest_x, dest_y;
<a id='L4929' name='L4929'></a>  4929 
<a id='L4930' name='L4930'></a>  4930   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../D/19730.html' title='Multiple defined in 2 places.'>x_top_window_to_frame</a> (dpyinfo, target);
<a id='L4931' name='L4931'></a>  4931 
<a id='L4932' name='L4932'></a>  4932   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L4933' name='L4933'></a>  4933     <em class='brace'>{</em>
<a id='L4934' name='L4934'></a>  4934       x_translate_coordinates (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, root_x, root_y, &amp;dest_x, &amp;dest_y);
<a id='L4935' name='L4935'></a>  4935 
<a id='L4936' name='L4936'></a>  4936       x_dnd_movement_frame = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L4937' name='L4937'></a>  4937       x_dnd_movement_x = dest_x;
<a id='L4938' name='L4938'></a>  4938       x_dnd_movement_y = dest_y;
<a id='L4939' name='L4939'></a>  4939 
<a id='L4940' name='L4940'></a>  4940       <strong class='reserved'>return</strong>;
<a id='L4941' name='L4941'></a>  4941     <em class='brace'>}</em>
<a id='L4942' name='L4942'></a>  4942 <em class='brace'>}</em>
<a id='L4943' name='L4943'></a>  4943 
<a id='L4944' name='L4944'></a>  4944 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L4945' name='L4945'></a>  4945 <a href='../R/18142.html' title='Multiple referred from 2 places.'>x_dnd_note_self_wheel</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> target,
<a id='L4946' name='L4946'></a>  4946                        <strong class='reserved'>unsigned</strong> <strong class='reserved'>short</strong> root_x, <strong class='reserved'>unsigned</strong> <strong class='reserved'>short</strong> root_y,
<a id='L4947' name='L4947'></a>  4947                        <strong class='reserved'>int</strong> button, <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> state, <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a> <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>)
<a id='L4948' name='L4948'></a>  4948 <em class='brace'>{</em>
<a id='L4949' name='L4949'></a>  4949   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L4950' name='L4950'></a>  4950   <strong class='reserved'>int</strong> dest_x, dest_y;
<a id='L4951' name='L4951'></a>  4951 
<a id='L4952' name='L4952'></a>  4952   <strong class='reserved'>if</strong> (button &lt; 4 || button &gt; 7)
<a id='L4953' name='L4953'></a>  4953     <strong class='reserved'>return</strong>;
<a id='L4954' name='L4954'></a>  4954 
<a id='L4955' name='L4955'></a>  4955   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../D/19730.html' title='Multiple defined in 2 places.'>x_top_window_to_frame</a> (dpyinfo, target);
<a id='L4956' name='L4956'></a>  4956 
<a id='L4957' name='L4957'></a>  4957   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L4958' name='L4958'></a>  4958     <em class='brace'>{</em>
<a id='L4959' name='L4959'></a>  4959       x_translate_coordinates (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, root_x, root_y, &amp;dest_x, &amp;dest_y);
<a id='L4960' name='L4960'></a>  4960 
<a id='L4961' name='L4961'></a>  4961       x_dnd_wheel_frame = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L4962' name='L4962'></a>  4962       x_dnd_wheel_x = dest_x;
<a id='L4963' name='L4963'></a>  4963       x_dnd_wheel_y = dest_y;
<a id='L4964' name='L4964'></a>  4964       x_dnd_wheel_button = button;
<a id='L4965' name='L4965'></a>  4965       x_dnd_wheel_state = state;
<a id='L4966' name='L4966'></a>  4966       x_dnd_wheel_time = <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L4967' name='L4967'></a>  4967 
<a id='L4968' name='L4968'></a>  4968       <strong class='reserved'>return</strong>;
<a id='L4969' name='L4969'></a>  4969     <em class='brace'>}</em>
<a id='L4970' name='L4970'></a>  4970 <em class='brace'>}</em>
<a id='L4971' name='L4971'></a>  4971 
<a id='L4972' name='L4972'></a>  4972 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L4973' name='L4973'></a>  4973 <a href='../R/18140.html' title='Multiple referred from 2 places.'>x_dnd_note_self_drop</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> target,
<a id='L4974' name='L4974'></a>  4974                       <strong class='reserved'>unsigned</strong> <strong class='reserved'>short</strong> root_x, <strong class='reserved'>unsigned</strong> <strong class='reserved'>short</strong> root_y,
<a id='L4975' name='L4975'></a>  4975                       <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a> timestamp)
<a id='L4976' name='L4976'></a>  4976 <em class='brace'>{</em>
<a id='L4977' name='L4977'></a>  4977   <strong class='reserved'>struct</strong> <a href='../S/2231.html#L350' title='Defined at 350 in src/termhooks.h.'>input_event</a> ie;
<a id='L4978' name='L4978'></a>  4978   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L4979' name='L4979'></a>  4979   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> lval;
<a id='L4980' name='L4980'></a>  4980   <strong class='reserved'>char</strong> **atom_names;
<a id='L4981' name='L4981'></a>  4981   <strong class='reserved'>char</strong> *<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>;
<a id='L4982' name='L4982'></a>  4982   <strong class='reserved'>int</strong> win_x, win_y, i;
<a id='L4983' name='L4983'></a>  4983 
<a id='L4984' name='L4984'></a>  4984   <strong class='reserved'>if</strong> (!x_dnd_allow_current_frame
<a id='L4985' name='L4985'></a>  4985       &amp;&amp; (<a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (x_dnd_frame)
<a id='L4986' name='L4986'></a>  4986           == target))
<a id='L4987' name='L4987'></a>  4987     <strong class='reserved'>return</strong>;
<a id='L4988' name='L4988'></a>  4988 
<a id='L4989' name='L4989'></a>  4989   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../D/19730.html' title='Multiple defined in 2 places.'>x_top_window_to_frame</a> (dpyinfo, target);
<a id='L4990' name='L4990'></a>  4990 
<a id='L4991' name='L4991'></a>  4991   <strong class='reserved'>if</strong> (!<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L4992' name='L4992'></a>  4992     <strong class='reserved'>return</strong>;
<a id='L4993' name='L4993'></a>  4993 
<a id='L4994' name='L4994'></a>  4994   <strong class='reserved'>if</strong> (<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (Vx_dnd_native_test_function))
<a id='L4995' name='L4995'></a>  4995     <strong class='reserved'>return</strong>;
<a id='L4996' name='L4996'></a>  4996 
<a id='L4997' name='L4997'></a>  4997   x_translate_coordinates (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, root_x, root_y, &amp;win_x, &amp;win_y);
<a id='L4998' name='L4998'></a>  4998 
<a id='L4999' name='L4999'></a>  4999   <em class='comment'>/* Emacs can't respond to DND events inside the nested event loop,</em>
<a id='L5000' name='L5000'></a>  5000 <em class='comment'>     so when dragging items to itself, call the test function</em>
<a id='L5001' name='L5001'></a>  5001 <em class='comment'>     manually.  */</em>
<a id='L5002' name='L5002'></a>  5002 
<a id='L5003' name='L5003'></a>  5003   <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (lval, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L5004' name='L5004'></a>  5004   x_dnd_action = None;
<a id='L5005' name='L5005'></a>  5005   x_dnd_action_symbol
<a id='L5006' name='L5006'></a>  5006     = <a href='../S/2224.html#L3082' title='Defined at 3082 in src/xdisp.c.'>safe_call2</a> (Vx_dnd_native_test_function,
<a id='L5007' name='L5007'></a>  5007                   Fposn_at_x_y (<a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (win_x),
<a id='L5008' name='L5008'></a>  5008                                 <a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (win_y),
<a id='L5009' name='L5009'></a>  5009                                 lval, Qnil),
<a id='L5010' name='L5010'></a>  5010                   <a href='../S/2281.html#L191' title='Defined at 191 in src/xselect.c.'>x_atom_to_symbol</a> (dpyinfo,
<a id='L5011' name='L5011'></a>  5011                                     x_dnd_wanted_action));
<a id='L5012' name='L5012'></a>  5012 
<a id='L5013' name='L5013'></a>  5013   <strong class='reserved'>if</strong> (!<a href='../S/4044.html#L397' title='Defined at 397 in test/manual/etags/c-src/emacs/src/lisp.h.'>SYMBOLP</a> (x_dnd_action_symbol))
<a id='L5014' name='L5014'></a>  5014     <strong class='reserved'>return</strong>;
<a id='L5015' name='L5015'></a>  5015 
<a id='L5016' name='L5016'></a>  5016   <a href='../S/2231.html#L393' title='Defined at 393 in src/termhooks.h.'>EVENT_INIT</a> (ie);
<a id='L5017' name='L5017'></a>  5017 
<a id='L5018' name='L5018'></a>  5018   ie.kind = <a href='../S/2231.html#L200' title='Defined at 200 in src/termhooks.h.'>DRAG_N_DROP_EVENT</a>;
<a id='L5019' name='L5019'></a>  5019   <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (ie.frame_or_window, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L5020' name='L5020'></a>  5020 
<a id='L5021' name='L5021'></a>  5021   lval = Qnil;
<a id='L5022' name='L5022'></a>  5022   atom_names = <a href='../D/8439.html' title='Multiple defined in 8 places.'>alloca</a> (x_dnd_n_targets * <strong class='reserved'>sizeof</strong> *atom_names);
<a id='L5023' name='L5023'></a>  5023   <a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a> = x_get_atom_name (dpyinfo, x_dnd_wanted_action, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L5024' name='L5024'></a>  5024 
<a id='L5025' name='L5025'></a>  5025   <strong class='reserved'>if</strong> (!XGetAtomNames (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, x_dnd_targets,
<a id='L5026' name='L5026'></a>  5026                       x_dnd_n_targets, atom_names))
<a id='L5027' name='L5027'></a>  5027     <em class='brace'>{</em>
<a id='L5028' name='L5028'></a>  5028       <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>);
<a id='L5029' name='L5029'></a>  5029       <strong class='reserved'>return</strong>;
<a id='L5030' name='L5030'></a>  5030     <em class='brace'>}</em>
<a id='L5031' name='L5031'></a>  5031 
<a id='L5032' name='L5032'></a>  5032   <strong class='reserved'>for</strong> (i = x_dnd_n_targets; i != 0; --i)
<a id='L5033' name='L5033'></a>  5033     <em class='brace'>{</em>
<a id='L5034' name='L5034'></a>  5034       lval = Fcons (<a href='../D/13388.html' title='Multiple defined in 2 places.'>intern</a> (atom_names[i - 1]), lval);
<a id='L5035' name='L5035'></a>  5035       XFree (atom_names[i - 1]);
<a id='L5036' name='L5036'></a>  5036     <em class='brace'>}</em>
<a id='L5037' name='L5037'></a>  5037 
<a id='L5038' name='L5038'></a>  5038   lval = Fcons (<a href='../S/2320.html#L1962' title='Defined at 1962 in src/fns.c.'>assq_no_quit</a> (QXdndSelection,
<a id='L5039' name='L5039'></a>  5039                               <a href='../S/2231.html#L912' title='Defined at 912 in src/termhooks.h.'>FRAME_TERMINAL</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;Vselection_alist),
<a id='L5040' name='L5040'></a>  5040                 lval);
<a id='L5041' name='L5041'></a>  5041   lval = Fcons (<a href='../D/13388.html' title='Multiple defined in 2 places.'>intern</a> (<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>), lval);
<a id='L5042' name='L5042'></a>  5042   lval = Fcons (QXdndSelection, lval);
<a id='L5043' name='L5043'></a>  5043   ie.arg = lval;
<a id='L5044' name='L5044'></a>  5044   ie.timestamp = timestamp;
<a id='L5045' name='L5045'></a>  5045 
<a id='L5046' name='L5046'></a>  5046   <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (ie.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, win_x);
<a id='L5047' name='L5047'></a>  5047   <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (ie.y, win_y);
<a id='L5048' name='L5048'></a>  5048 
<a id='L5049' name='L5049'></a>  5049   <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>);
<a id='L5050' name='L5050'></a>  5050   <a href='../D/13636.html' title='Multiple defined in 2 places.'>kbd_buffer_store_event</a> (&amp;ie);
<a id='L5051' name='L5051'></a>  5051 <em class='brace'>}</em>
<a id='L5052' name='L5052'></a>  5052 
<a id='L5053' name='L5053'></a>  5053 <em class='comment'>/* Flush display of frame F.  */</em>
<a id='L5054' name='L5054'></a>  5054 
<a id='L5055' name='L5055'></a>  5055 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L5056' name='L5056'></a>  5056 <a href='../R/18189.html' title='Multiple referred from 5 places.'>x_flush</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L5057' name='L5057'></a>  5057 <em class='brace'>{</em>
<a id='L5058' name='L5058'></a>  5058   <a href='../D/10871.html' title='Multiple defined in 5 places.'>eassert</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; <a href='../S/2183.html#L919' title='Defined at 919 in src/frame.h.'>FRAME_X_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L5059' name='L5059'></a>  5059   <em class='comment'>/* Don't call XFlush when it is not safe to redisplay; the X</em>
<a id='L5060' name='L5060'></a>  5060 <em class='comment'>     connection may be broken.  */</em>
<a id='L5061' name='L5061'></a>  5061   <strong class='reserved'>if</strong> (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (Vinhibit_redisplay))
<a id='L5062' name='L5062'></a>  5062     <strong class='reserved'>return</strong>;
<a id='L5063' name='L5063'></a>  5063 
<a id='L5064' name='L5064'></a>  5064   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L5065' name='L5065'></a>  5065   XFlush (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L5066' name='L5066'></a>  5066   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L5067' name='L5067'></a>  5067 <em class='brace'>}</em>
<a id='L5068' name='L5068'></a>  5068 
<a id='L5069' name='L5069'></a>  5069 <em class='sharp'>#ifdef</em> HAVE_XDBE
<a id='L5070' name='L5070'></a>  5070 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L5071' name='L5071'></a>  5071 <a href='../R/18171.html' title='Multiple referred from 4 places.'>x_drop_xrender_surfaces</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L5072' name='L5072'></a>  5072 <em class='brace'>{</em>
<a id='L5073' name='L5073'></a>  5073   <a href='../S/2262.html#L5564' title='Defined at 5564 in src/font.c.'>font_drop_xrender_surfaces</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L5074' name='L5074'></a>  5074 
<a id='L5075' name='L5075'></a>  5075 <em class='sharp'>#ifdef</em> HAVE_XRENDER
<a id='L5076' name='L5076'></a>  5076   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; <a href='../S/2212.html#L1356' title='Defined at 1356 in src/xterm.h.'>FRAME_X_DOUBLE_BUFFERED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L5077' name='L5077'></a>  5077       &amp;&amp; <a href='../S/2212.html#L1446' title='Defined at 1446 in src/xterm.h.'>FRAME_X_PICTURE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) != None)
<a id='L5078' name='L5078'></a>  5078     <em class='brace'>{</em>
<a id='L5079' name='L5079'></a>  5079       XRenderFreePicture (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L5080' name='L5080'></a>  5080                           <a href='../S/2212.html#L1446' title='Defined at 1446 in src/xterm.h.'>FRAME_X_PICTURE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L5081' name='L5081'></a>  5081       <a href='../S/2212.html#L1446' title='Defined at 1446 in src/xterm.h.'>FRAME_X_PICTURE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = None;
<a id='L5082' name='L5082'></a>  5082     <em class='brace'>}</em>
<a id='L5083' name='L5083'></a>  5083 <em class='sharp'>#endif</em>
<a id='L5084' name='L5084'></a>  5084 <em class='brace'>}</em>
<a id='L5085' name='L5085'></a>  5085 <em class='sharp'>#endif</em>
<a id='L5086' name='L5086'></a>  5086 
<a id='L5087' name='L5087'></a>  5087 <em class='sharp'>#ifdef</em> HAVE_XRENDER
<a id='L5088' name='L5088'></a>  5088 <strong class='reserved'>void</strong>
<a id='L5089' name='L5089'></a>  5089 <a href='../R/18377.html' title='Multiple referred from 7 places.'>x_xr_ensure_picture</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L5090' name='L5090'></a>  5090 <em class='brace'>{</em>
<a id='L5091' name='L5091'></a>  5091   <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1446' title='Defined at 1446 in src/xterm.h.'>FRAME_X_PICTURE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) == None &amp;&amp; <a href='../S/2212.html#L1445' title='Defined at 1445 in src/xterm.h.'>FRAME_X_PICTURE_FORMAT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L5092' name='L5092'></a>  5092     <em class='brace'>{</em>
<a id='L5093' name='L5093'></a>  5093       XRenderPictureAttributes attrs;
<a id='L5094' name='L5094'></a>  5094       attrs.clip_mask = None;
<a id='L5095' name='L5095'></a>  5095       XRenderPictFormat *fmt = <a href='../S/2212.html#L1445' title='Defined at 1445 in src/xterm.h.'>FRAME_X_PICTURE_FORMAT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L5096' name='L5096'></a>  5096 
<a id='L5097' name='L5097'></a>  5097       <a href='../S/2212.html#L1446' title='Defined at 1446 in src/xterm.h.'>FRAME_X_PICTURE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = XRenderCreatePicture (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L5098' name='L5098'></a>  5098                                                   <a href='../S/2212.html#L1344' title='Defined at 1344 in src/xterm.h.'>FRAME_X_RAW_DRAWABLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L5099' name='L5099'></a>  5099                                                   fmt, CPClipMask, &amp;attrs);
<a id='L5100' name='L5100'></a>  5100     <em class='brace'>}</em>
<a id='L5101' name='L5101'></a>  5101 <em class='brace'>}</em>
<a id='L5102' name='L5102'></a>  5102 <em class='sharp'>#endif</em>
<a id='L5103' name='L5103'></a>  5103 
<a id='L5104' name='L5104'></a>  5104 
<a id='L5105' name='L5105'></a>  5105 <em class='comment'>/***********************************************************************</em>
<a id='L5106' name='L5106'></a>  5106 <em class='comment'>                              Debugging</em>
<a id='L5107' name='L5107'></a>  5107 <em class='comment'> ***********************************************************************/</em>
<a id='L5108' name='L5108'></a>  5108 
<a id='L5109' name='L5109'></a>  5109 <em class='sharp'>#if</em> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>
<a id='L5110' name='L5110'></a>  5110 
<a id='L5111' name='L5111'></a>  5111 <em class='comment'>/* This is a function useful for recording debugging information about</em>
<a id='L5112' name='L5112'></a>  5112 <em class='comment'>   the sequence of occurrences in this file.  */</em>
<a id='L5113' name='L5113'></a>  5113 
<a id='L5114' name='L5114'></a>  5114 <strong class='reserved'>struct</strong> <a href='../R/14941.html' title='Multiple referred from 30 places.'>record</a>
<a id='L5115' name='L5115'></a>  5115 <em class='brace'>{</em>
<a id='L5116' name='L5116'></a>  5116   <strong class='reserved'>char</strong> *locus;
<a id='L5117' name='L5117'></a>  5117   <strong class='reserved'>int</strong> type;
<a id='L5118' name='L5118'></a>  5118 <em class='brace'>}</em>;
<a id='L5119' name='L5119'></a>  5119 
<a id='L5120' name='L5120'></a>  5120 <strong class='reserved'>struct</strong> <a href='../D/16171.html' title='Multiple defined in 2 places.'>record</a> event_record[100];
<a id='L5121' name='L5121'></a>  5121 
<a id='L5122' name='L5122'></a>  5122 <strong class='reserved'>int</strong> event_record_index;
<a id='L5123' name='L5123'></a>  5123 
<a id='L5124' name='L5124'></a>  5124 <strong class='reserved'>void</strong>
<a id='L5125' name='L5125'></a>  5125 record_event (<strong class='reserved'>char</strong> *locus, <strong class='reserved'>int</strong> type)
<a id='L5126' name='L5126'></a>  5126 <em class='brace'>{</em>
<a id='L5127' name='L5127'></a>  5127   <strong class='reserved'>if</strong> (event_record_index == <a href='../D/185.html' title='Multiple defined in 3 places.'>ARRAYELTS</a> (event_record))
<a id='L5128' name='L5128'></a>  5128     event_record_index = 0;
<a id='L5129' name='L5129'></a>  5129 
<a id='L5130' name='L5130'></a>  5130   event_record[event_record_index].locus = locus;
<a id='L5131' name='L5131'></a>  5131   event_record[event_record_index].type = type;
<a id='L5132' name='L5132'></a>  5132   event_record_index++;
<a id='L5133' name='L5133'></a>  5133 <em class='brace'>}</em>
<a id='L5134' name='L5134'></a>  5134 
<a id='L5135' name='L5135'></a>  5135 <em class='sharp'>#endif</em>
<a id='L5136' name='L5136'></a>  5136 
<a id='L5137' name='L5137'></a>  5137 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L5138' name='L5138'></a>  5138 <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L5139' name='L5139'></a>  5139 <a href='../R/18588.html' title='Multiple referred from 7 places.'>xi_frame_selected_for</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> event)
<a id='L5140' name='L5140'></a>  5140 <em class='brace'>{</em>
<a id='L5141' name='L5141'></a>  5141   XIEventMask *masks;
<a id='L5142' name='L5142'></a>  5142   <strong class='reserved'>int</strong> i;
<a id='L5143' name='L5143'></a>  5143 
<a id='L5144' name='L5144'></a>  5144   masks = <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;xi_masks;
<a id='L5145' name='L5145'></a>  5145 
<a id='L5146' name='L5146'></a>  5146   <strong class='reserved'>if</strong> (!masks)
<a id='L5147' name='L5147'></a>  5147     <strong class='reserved'>return</strong> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L5148' name='L5148'></a>  5148 
<a id='L5149' name='L5149'></a>  5149   <strong class='reserved'>for</strong> (i = 0; i &lt; <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;num_xi_masks; ++i)
<a id='L5150' name='L5150'></a>  5150     <em class='brace'>{</em>
<a id='L5151' name='L5151'></a>  5151       <strong class='reserved'>if</strong> (masks[i].mask_len &gt;= XIMaskLen (event)
<a id='L5152' name='L5152'></a>  5152           &amp;&amp; XIMaskIsSet (masks[i].mask, event))
<a id='L5153' name='L5153'></a>  5153         <strong class='reserved'>return</strong> <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L5154' name='L5154'></a>  5154     <em class='brace'>}</em>
<a id='L5155' name='L5155'></a>  5155 
<a id='L5156' name='L5156'></a>  5156   <strong class='reserved'>return</strong> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L5157' name='L5157'></a>  5157 <em class='brace'>}</em>
<a id='L5158' name='L5158'></a>  5158 <em class='sharp'>#endif</em>
<a id='L5159' name='L5159'></a>  5159 
<a id='L5160' name='L5160'></a>  5160 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L5161' name='L5161'></a>  5161 <a href='../S/2289.html#L31577' title='Referred from 31577 in src/xterm.c.'>x_toolkit_position</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, <strong class='reserved'>int</strong> y,
<a id='L5162' name='L5162'></a>  5162                     <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> *menu_bar_p, <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> *tool_bar_p)
<a id='L5163' name='L5163'></a>  5163 <em class='brace'>{</em>
<a id='L5164' name='L5164'></a>  5164 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L5165' name='L5165'></a>  5165   GdkRectangle test_rect;
<a id='L5166' name='L5166'></a>  5166   <strong class='reserved'>int</strong> scale;
<a id='L5167' name='L5167'></a>  5167 
<a id='L5168' name='L5168'></a>  5168   y += (<a href='../D/2342.html' title='Multiple defined in 3 places.'>FRAME_MENUBAR_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L5169' name='L5169'></a>  5169         + <a href='../D/2423.html' title='Multiple defined in 2 places.'>FRAME_TOOLBAR_TOP_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L5170' name='L5170'></a>  5170   <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> += <a href='../D/2421.html' title='Multiple defined in 2 places.'>FRAME_TOOLBAR_LEFT_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L5171' name='L5171'></a>  5171 
<a id='L5172' name='L5172'></a>  5172   <strong class='reserved'>if</strong> (<a href='../D/2294.html' title='Multiple defined in 2 places.'>FRAME_EXTERNAL_MENU_BAR</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L5173' name='L5173'></a>  5173     *menu_bar_p = (<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> &gt;= 0 &amp;&amp; <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> &lt; <a href='../S/2183.html#L1051' title='Defined at 1051 in src/frame.h.'>FRAME_PIXEL_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L5174' name='L5174'></a>  5174                    &amp;&amp; y &gt;= 0 &amp;&amp; y &lt; <a href='../D/2342.html' title='Multiple defined in 3 places.'>FRAME_MENUBAR_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L5175' name='L5175'></a>  5175 
<a id='L5176' name='L5176'></a>  5176   <strong class='reserved'>if</strong> (<a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;toolbar_widget)
<a id='L5177' name='L5177'></a>  5177     <em class='brace'>{</em>
<a id='L5178' name='L5178'></a>  5178       scale = <a href='../S/2362.html#L284' title='Defined at 284 in src/gtkutil.c.'>xg_get_scale</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L5179' name='L5179'></a>  5179       test_rect.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> / scale;
<a id='L5180' name='L5180'></a>  5180       test_rect.y = y / scale;
<a id='L5181' name='L5181'></a>  5181       test_rect.width = 1;
<a id='L5182' name='L5182'></a>  5182       test_rect.height = 1;
<a id='L5183' name='L5183'></a>  5183 
<a id='L5184' name='L5184'></a>  5184       *tool_bar_p = gtk_widget_intersect (<a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;toolbar_widget,
<a id='L5185' name='L5185'></a>  5185                                           &amp;test_rect, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L5186' name='L5186'></a>  5186     <em class='brace'>}</em>
<a id='L5187' name='L5187'></a>  5187 <em class='sharp'>#elif</em> <strong class='reserved'>defined</strong> USE_X_TOOLKIT
<a id='L5188' name='L5188'></a>  5188   *menu_bar_p = (<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> &gt; 0 &amp;&amp; <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> &lt; <a href='../S/2183.html#L1051' title='Defined at 1051 in src/frame.h.'>FRAME_PIXEL_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L5189' name='L5189'></a>  5189                  &amp;&amp; (y &lt; 0 &amp;&amp; y &gt;= -<a href='../D/2342.html' title='Multiple defined in 3 places.'>FRAME_MENUBAR_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)));
<a id='L5190' name='L5190'></a>  5190 <em class='sharp'>#else</em>
<a id='L5191' name='L5191'></a>  5191   *menu_bar_p = (<a href='../D/6789.html' title='Multiple defined in 2 places.'>WINDOWP</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;menu_bar_window)
<a id='L5192' name='L5192'></a>  5192                  &amp;&amp; (<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> &gt; 0 &amp;&amp; <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> &lt; <a href='../S/2183.html#L1051' title='Defined at 1051 in src/frame.h.'>FRAME_PIXEL_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L5193' name='L5193'></a>  5193                      &amp;&amp; (y &gt; 0 &amp;&amp; y &lt; <a href='../S/2183.html#L1072' title='Defined at 1072 in src/frame.h.'>FRAME_MENU_BAR_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))));
<a id='L5194' name='L5194'></a>  5194 <em class='sharp'>#endif</em>
<a id='L5195' name='L5195'></a>  5195 <em class='brace'>}</em>
<a id='L5196' name='L5196'></a>  5196 
<a id='L5197' name='L5197'></a>  5197 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L5198' name='L5198'></a>  5198 <a href='../R/18367.html' title='Multiple referred from 4 places.'>x_update_opaque_region</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, XEvent *configure)
<a id='L5199' name='L5199'></a>  5199 <em class='brace'>{</em>
<a id='L5200' name='L5200'></a>  5200   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> opaque_region[] = <em class='brace'>{</em>0, 0,
<a id='L5201' name='L5201'></a>  5201                                    (configure
<a id='L5202' name='L5202'></a>  5202                                     ? configure-&gt;xconfigure.width
<a id='L5203' name='L5203'></a>  5203                                     : <a href='../S/2183.html#L1051' title='Defined at 1051 in src/frame.h.'>FRAME_PIXEL_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)),
<a id='L5204' name='L5204'></a>  5204                                    (configure
<a id='L5205' name='L5205'></a>  5205                                     ? configure-&gt;xconfigure.height
<a id='L5206' name='L5206'></a>  5206                                     : <a href='../S/2183.html#L1052' title='Defined at 1052 in src/frame.h.'>FRAME_PIXEL_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))<em class='brace'>}</em>;
<a id='L5207' name='L5207'></a>  5207 <em class='sharp'>#ifdef</em> HAVE_GTK3
<a id='L5208' name='L5208'></a>  5208   GObjectClass *object_class;
<a id='L5209' name='L5209'></a>  5209   GtkWidgetClass *class;
<a id='L5210' name='L5210'></a>  5210 <em class='sharp'>#endif</em>
<a id='L5211' name='L5211'></a>  5211 
<a id='L5212' name='L5212'></a>  5212   <strong class='reserved'>if</strong> (!<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;alpha_bits)
<a id='L5213' name='L5213'></a>  5213     <strong class='reserved'>return</strong>;
<a id='L5214' name='L5214'></a>  5214 
<a id='L5215' name='L5215'></a>  5215   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;alpha_background &lt; 1.0)
<a id='L5216' name='L5216'></a>  5216     XChangeProperty (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L5217' name='L5217'></a>  5217                      <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;Xatom_net_wm_opaque_region,
<a id='L5218' name='L5218'></a>  5218                      XA_CARDINAL, 32, PropModeReplace,
<a id='L5219' name='L5219'></a>  5219                      <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, 0);
<a id='L5220' name='L5220'></a>  5220 <em class='sharp'>#ifndef</em> HAVE_GTK3
<a id='L5221' name='L5221'></a>  5221   <strong class='reserved'>else</strong>
<a id='L5222' name='L5222'></a>  5222     XChangeProperty (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L5223' name='L5223'></a>  5223                      <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;Xatom_net_wm_opaque_region,
<a id='L5224' name='L5224'></a>  5224                      XA_CARDINAL, 32, PropModeReplace,
<a id='L5225' name='L5225'></a>  5225                      (<strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *) &amp;opaque_region, 4);
<a id='L5226' name='L5226'></a>  5226 <em class='sharp'>#else</em>
<a id='L5227' name='L5227'></a>  5227   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (<a href='../D/2425.html' title='Multiple defined in 2 places.'>FRAME_TOOLTIP_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L5228' name='L5228'></a>  5228     XChangeProperty (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L5229' name='L5229'></a>  5229                      <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;Xatom_net_wm_opaque_region,
<a id='L5230' name='L5230'></a>  5230                      XA_CARDINAL, 32, PropModeReplace,
<a id='L5231' name='L5231'></a>  5231                      (<strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *) &amp;opaque_region, 4);
<a id='L5232' name='L5232'></a>  5232   <strong class='reserved'>else</strong>
<a id='L5233' name='L5233'></a>  5233     <em class='brace'>{</em>
<a id='L5234' name='L5234'></a>  5234       <em class='comment'>/* This causes child frames to not update correctly for an</em>
<a id='L5235' name='L5235'></a>  5235 <em class='comment'>         unknown reason.  (bug#55779) */</em>
<a id='L5236' name='L5236'></a>  5236       <strong class='reserved'>if</strong> (!<a href='../D/2370.html' title='Multiple defined in 2 places.'>FRAME_PARENT_FRAME</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L5237' name='L5237'></a>  5237         <em class='brace'>{</em>
<a id='L5238' name='L5238'></a>  5238           object_class = G_OBJECT_GET_CLASS (<a href='../D/2309.html' title='Multiple defined in 2 places.'>FRAME_GTK_OUTER_WIDGET</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L5239' name='L5239'></a>  5239           class = GTK_WIDGET_CLASS (object_class);
<a id='L5240' name='L5240'></a>  5240 
<a id='L5241' name='L5241'></a>  5241           <strong class='reserved'>if</strong> (class-&gt;style_updated)
<a id='L5242' name='L5242'></a>  5242             class-&gt;style_updated (<a href='../D/2309.html' title='Multiple defined in 2 places.'>FRAME_GTK_OUTER_WIDGET</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L5243' name='L5243'></a>  5243         <em class='brace'>}</em>
<a id='L5244' name='L5244'></a>  5244     <em class='brace'>}</em>
<a id='L5245' name='L5245'></a>  5245 <em class='sharp'>#endif</em>
<a id='L5246' name='L5246'></a>  5246 <em class='brace'>}</em>
<a id='L5247' name='L5247'></a>  5247 
<a id='L5248' name='L5248'></a>  5248 
<a id='L5249' name='L5249'></a>  5249 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> USE_CAIRO || <strong class='reserved'>defined</strong> HAVE_XRENDER
<a id='L5250' name='L5250'></a>  5250 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L5251' name='L5251'></a>  5251 <a href='../S/2289.html#L5277' title='Referred from 5277 in src/xterm.c.'>x_gc_free_ext_data_private</a> (XExtData *extension)
<a id='L5252' name='L5252'></a>  5252 <em class='brace'>{</em>
<a id='L5253' name='L5253'></a>  5253   <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (extension-&gt;private_data);
<a id='L5254' name='L5254'></a>  5254 
<a id='L5255' name='L5255'></a>  5255   <strong class='reserved'>return</strong> 0;
<a id='L5256' name='L5256'></a>  5256 <em class='brace'>}</em>
<a id='L5257' name='L5257'></a>  5257 
<a id='L5258' name='L5258'></a>  5258 <strong class='reserved'>static</strong> <strong class='reserved'>struct</strong> <a href='../S/2212.html#L199' title='Defined at 199 in src/xterm.h.'>x_gc_ext_data</a> *
<a id='L5259' name='L5259'></a>  5259 <a href='../R/18206.html' title='Multiple referred from 5 places.'>x_gc_get_ext_data</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/2619.html' title='Multiple defined in 2 places.'>GC</a> gc, <strong class='reserved'>int</strong> create_if_not_found_p)
<a id='L5260' name='L5260'></a>  5260 <em class='brace'>{</em>
<a id='L5261' name='L5261'></a>  5261   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L5262' name='L5262'></a>  5262   XEDataObject object;
<a id='L5263' name='L5263'></a>  5263   XExtData **head, *ext_data;
<a id='L5264' name='L5264'></a>  5264 
<a id='L5265' name='L5265'></a>  5265   object.gc = gc;
<a id='L5266' name='L5266'></a>  5266   head = XEHeadOfExtensionList (object);
<a id='L5267' name='L5267'></a>  5267   ext_data = XFindOnExtensionList (head, dpyinfo-&gt;ext_codes-&gt;extension);
<a id='L5268' name='L5268'></a>  5268   <strong class='reserved'>if</strong> (ext_data == <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>)
<a id='L5269' name='L5269'></a>  5269     <em class='brace'>{</em>
<a id='L5270' name='L5270'></a>  5270       <strong class='reserved'>if</strong> (!create_if_not_found_p)
<a id='L5271' name='L5271'></a>  5271         <strong class='reserved'>return</strong> <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L5272' name='L5272'></a>  5272       <strong class='reserved'>else</strong>
<a id='L5273' name='L5273'></a>  5273         <em class='brace'>{</em>
<a id='L5274' name='L5274'></a>  5274           ext_data = <a href='../S/2350.html#L802' title='Defined at 802 in src/alloc.c.'>xzalloc</a> (<strong class='reserved'>sizeof</strong> (*ext_data));
<a id='L5275' name='L5275'></a>  5275           ext_data-&gt;number = dpyinfo-&gt;ext_codes-&gt;extension;
<a id='L5276' name='L5276'></a>  5276           ext_data-&gt;private_data = <a href='../S/2350.html#L802' title='Defined at 802 in src/alloc.c.'>xzalloc</a> (<strong class='reserved'>sizeof</strong> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L199' title='Defined at 199 in src/xterm.h.'>x_gc_ext_data</a>));
<a id='L5277' name='L5277'></a>  5277           ext_data-&gt;free_private = <a href='../S/2289.html#L5251' title='Defined at 5251 in src/xterm.c.'>x_gc_free_ext_data_private</a>;
<a id='L5278' name='L5278'></a>  5278           XAddToExtensionList (head, ext_data);
<a id='L5279' name='L5279'></a>  5279         <em class='brace'>}</em>
<a id='L5280' name='L5280'></a>  5280     <em class='brace'>}</em>
<a id='L5281' name='L5281'></a>  5281   <strong class='reserved'>return</strong> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L199' title='Defined at 199 in src/xterm.h.'>x_gc_ext_data</a> *) ext_data-&gt;private_data;
<a id='L5282' name='L5282'></a>  5282 <em class='brace'>}</em>
<a id='L5283' name='L5283'></a>  5283 
<a id='L5284' name='L5284'></a>  5284 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L5285' name='L5285'></a>  5285 <a href='../S/2289.html#L30998' title='Referred from 30998 in src/xterm.c.'>x_extension_initialize</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo)
<a id='L5286' name='L5286'></a>  5286 <em class='brace'>{</em>
<a id='L5287' name='L5287'></a>  5287   XExtCodes *ext_codes = XAddExtension (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L5288' name='L5288'></a>  5288 
<a id='L5289' name='L5289'></a>  5289   dpyinfo-&gt;ext_codes = ext_codes;
<a id='L5290' name='L5290'></a>  5290 <em class='brace'>}</em>
<a id='L5291' name='L5291'></a>  5291 <em class='sharp'>#endif</em>
<a id='L5292' name='L5292'></a>  5292 
<a id='L5293' name='L5293'></a>  5293 <em class='sharp'>#ifdef</em> USE_CAIRO
<a id='L5294' name='L5294'></a>  5294 
<a id='L5295' name='L5295'></a>  5295 <em class='sharp'>#define</em> <a href='../R/2122.html' title='Multiple referred from 46 places.'>FRAME_CR_CONTEXT</a>(<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)     ((<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;cr_context)
<a id='L5296' name='L5296'></a>  5296 <em class='sharp'>#define</em> <a href='../R/2125.html' title='Multiple referred from 9 places.'>FRAME_CR_SURFACE_DESIRED_WIDTH</a>(<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) \
<a id='L5297' name='L5297'></a>  5297   ((<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;cr_surface_desired_width)
<a id='L5298' name='L5298'></a>  5298 <em class='sharp'>#define</em> <a href='../R/2124.html' title='Multiple referred from 9 places.'>FRAME_CR_SURFACE_DESIRED_HEIGHT</a>(<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) \
<a id='L5299' name='L5299'></a>  5299   ((<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;cr_surface_desired_height)
<a id='L5300' name='L5300'></a>  5300 
<a id='L5301' name='L5301'></a>  5301 <em class='sharp'>#endif</em> <em class='comment'>/* HAVE_CAIRO */</em>
<a id='L5302' name='L5302'></a>  5302 
<a id='L5303' name='L5303'></a>  5303 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L5304' name='L5304'></a>  5304 
<a id='L5305' name='L5305'></a>  5305 <em class='comment'>/* Convert XI2 button state IN to a standard X button modifier</em>
<a id='L5306' name='L5306'></a>  5306 <em class='comment'>   mask, and place it in OUT.  */</em>
<a id='L5307' name='L5307'></a>  5307 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L5308' name='L5308'></a>  5308 <a href='../R/18582.html' title='Multiple referred from 5 places.'>xi_convert_button_state</a> (XIButtonState *in, <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> *out)
<a id='L5309' name='L5309'></a>  5309 <em class='brace'>{</em>
<a id='L5310' name='L5310'></a>  5310   <strong class='reserved'>int</strong> i;
<a id='L5311' name='L5311'></a>  5311 
<a id='L5312' name='L5312'></a>  5312   <strong class='reserved'>if</strong> (in-&gt;mask_len)
<a id='L5313' name='L5313'></a>  5313     <em class='brace'>{</em>
<a id='L5314' name='L5314'></a>  5314       <strong class='reserved'>for</strong> (i = 1; i &lt;= 8; ++i)
<a id='L5315' name='L5315'></a>  5315         <em class='brace'>{</em>
<a id='L5316' name='L5316'></a>  5316           <strong class='reserved'>if</strong> (XIMaskIsSet (in-&gt;mask, i))
<a id='L5317' name='L5317'></a>  5317             *out |= (Button1Mask &lt;&lt; (i - 1));
<a id='L5318' name='L5318'></a>  5318         <em class='brace'>}</em>
<a id='L5319' name='L5319'></a>  5319     <em class='brace'>}</em>
<a id='L5320' name='L5320'></a>  5320 <em class='brace'>}</em>
<a id='L5321' name='L5321'></a>  5321 
<a id='L5322' name='L5322'></a>  5322 <em class='comment'>/* Return the modifier state in XEV as a standard X modifier mask.</em>
<a id='L5323' name='L5323'></a>  5323 <em class='comment'>   This should be used for non-keyboard events, where the group does</em>
<a id='L5324' name='L5324'></a>  5324 <em class='comment'>   not matter.  */</em>
<a id='L5325' name='L5325'></a>  5325 
<a id='L5326' name='L5326'></a>  5326 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L5327' name='L5327'></a>  5327 <strong class='reserved'>static</strong>
<a id='L5328' name='L5328'></a>  5328 <em class='sharp'>#endif</em>
<a id='L5329' name='L5329'></a>  5329 <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong>
<a id='L5330' name='L5330'></a>  5330 <a href='../R/18584.html' title='Multiple referred from 12 places.'>xi_convert_event_state</a> (XIDeviceEvent *xev)
<a id='L5331' name='L5331'></a>  5331 <em class='brace'>{</em>
<a id='L5332' name='L5332'></a>  5332   <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> mods, buttons;
<a id='L5333' name='L5333'></a>  5333 
<a id='L5334' name='L5334'></a>  5334   mods = xev-&gt;mods.effective;
<a id='L5335' name='L5335'></a>  5335   buttons = 0;
<a id='L5336' name='L5336'></a>  5336 
<a id='L5337' name='L5337'></a>  5337   <a href='../S/2289.html#L5308' title='Defined at 5308 in src/xterm.c.'>xi_convert_button_state</a> (&amp;xev-&gt;buttons, &amp;buttons);
<a id='L5338' name='L5338'></a>  5338 
<a id='L5339' name='L5339'></a>  5339   <strong class='reserved'>return</strong> mods | buttons;
<a id='L5340' name='L5340'></a>  5340 <em class='brace'>}</em>
<a id='L5341' name='L5341'></a>  5341 
<a id='L5342' name='L5342'></a>  5342 <em class='comment'>/* Like the above.  However, buttons are not converted, while the</em>
<a id='L5343' name='L5343'></a>  5343 <em class='comment'>   group is.  This should be used for key events being passed to the</em>
<a id='L5344' name='L5344'></a>  5344 <em class='comment'>   likes of input methods and Xt.  */</em>
<a id='L5345' name='L5345'></a>  5345 
<a id='L5346' name='L5346'></a>  5346 <strong class='reserved'>static</strong> <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong>
<a id='L5347' name='L5347'></a>  5347 <a href='../R/18583.html' title='Multiple referred from 3 places.'>xi_convert_event_keyboard_state</a> (XIDeviceEvent *xev)
<a id='L5348' name='L5348'></a>  5348 <em class='brace'>{</em>
<a id='L5349' name='L5349'></a>  5349   <strong class='reserved'>return</strong> ((xev-&gt;mods.effective &amp; ~(1 &lt;&lt; 13 | 1 &lt;&lt; 14))
<a id='L5350' name='L5350'></a>  5350           | (xev-&gt;<a href='../S/56.html#L26' title='Defined at 26 in nt/inc/grp.h.'>group</a>.effective &lt;&lt; 13));
<a id='L5351' name='L5351'></a>  5351 <em class='brace'>}</em>
<a id='L5352' name='L5352'></a>  5352 
<a id='L5353' name='L5353'></a>  5353 <em class='comment'>/* Free all XI2 devices on DPYINFO.  */</em>
<a id='L5354' name='L5354'></a>  5354 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L5355' name='L5355'></a>  5355 <a href='../R/18203.html' title='Multiple referred from 2 places.'>x_free_xi_devices</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo)
<a id='L5356' name='L5356'></a>  5356 <em class='brace'>{</em>
<a id='L5357' name='L5357'></a>  5357 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L171' title='Defined at 171 in src/xterm.h.'>HAVE_XINPUT2_2</a>
<a id='L5358' name='L5358'></a>  5358   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L258' title='Defined at 258 in src/xterm.h.'>xi_touch_point_t</a> *tem, *last;
<a id='L5359' name='L5359'></a>  5359 <em class='sharp'>#endif</em>
<a id='L5360' name='L5360'></a>  5360 
<a id='L5361' name='L5361'></a>  5361   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L5362' name='L5362'></a>  5362 
<a id='L5363' name='L5363'></a>  5363   <strong class='reserved'>if</strong> (dpyinfo-&gt;num_devices)
<a id='L5364' name='L5364'></a>  5364     <em class='brace'>{</em>
<a id='L5365' name='L5365'></a>  5365       <strong class='reserved'>for</strong> (<strong class='reserved'>int</strong> i = 0; i &lt; dpyinfo-&gt;num_devices; ++i)
<a id='L5366' name='L5366'></a>  5366         <em class='brace'>{</em>
<a id='L5367' name='L5367'></a>  5367 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L168' title='Defined at 168 in src/xterm.h.'>HAVE_XINPUT2_1</a>
<a id='L5368' name='L5368'></a>  5368           <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (dpyinfo-&gt;devices[i].valuators);
<a id='L5369' name='L5369'></a>  5369 <em class='sharp'>#endif</em>
<a id='L5370' name='L5370'></a>  5370 
<a id='L5371' name='L5371'></a>  5371 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L171' title='Defined at 171 in src/xterm.h.'>HAVE_XINPUT2_2</a>
<a id='L5372' name='L5372'></a>  5372           tem = dpyinfo-&gt;devices[i].touchpoints;
<a id='L5373' name='L5373'></a>  5373           <strong class='reserved'>while</strong> (tem)
<a id='L5374' name='L5374'></a>  5374             <em class='brace'>{</em>
<a id='L5375' name='L5375'></a>  5375               last = tem;
<a id='L5376' name='L5376'></a>  5376               tem = tem-&gt;next;
<a id='L5377' name='L5377'></a>  5377               <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (last);
<a id='L5378' name='L5378'></a>  5378             <em class='brace'>}</em>
<a id='L5379' name='L5379'></a>  5379 <em class='sharp'>#endif</em>
<a id='L5380' name='L5380'></a>  5380         <em class='brace'>}</em>
<a id='L5381' name='L5381'></a>  5381 
<a id='L5382' name='L5382'></a>  5382       <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (dpyinfo-&gt;devices);
<a id='L5383' name='L5383'></a>  5383       dpyinfo-&gt;devices = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L5384' name='L5384'></a>  5384       dpyinfo-&gt;num_devices = 0;
<a id='L5385' name='L5385'></a>  5385     <em class='brace'>}</em>
<a id='L5386' name='L5386'></a>  5386 
<a id='L5387' name='L5387'></a>  5387   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L5388' name='L5388'></a>  5388 <em class='brace'>}</em>
<a id='L5389' name='L5389'></a>  5389 
<a id='L5390' name='L5390'></a>  5390 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L168' title='Defined at 168 in src/xterm.h.'>HAVE_XINPUT2_1</a>
<a id='L5391' name='L5391'></a>  5391 
<a id='L5392' name='L5392'></a>  5392 <strong class='reserved'>struct</strong> <a href='../R/18589.html' title='Multiple referred from 2 places.'>xi_known_valuator</a>
<a id='L5393' name='L5393'></a>  5393 <em class='brace'>{</em>
<a id='L5394' name='L5394'></a>  5394   <em class='comment'>/* The current value of this valuator.  */</em>
<a id='L5395' name='L5395'></a>  5395   <strong class='reserved'>double</strong> current_value;
<a id='L5396' name='L5396'></a>  5396 
<a id='L5397' name='L5397'></a>  5397   <em class='comment'>/* The number of the valuator.  */</em>
<a id='L5398' name='L5398'></a>  5398   <strong class='reserved'>int</strong> number;
<a id='L5399' name='L5399'></a>  5399 
<a id='L5400' name='L5400'></a>  5400   <em class='comment'>/* The next valuator whose value we already know.  */</em>
<a id='L5401' name='L5401'></a>  5401   <strong class='reserved'>struct</strong> <a href='../S/2289.html#L5392' title='Defined at 5392 in src/xterm.c.'>xi_known_valuator</a> *next;
<a id='L5402' name='L5402'></a>  5402 <em class='brace'>}</em>;
<a id='L5403' name='L5403'></a>  5403 
<a id='L5404' name='L5404'></a>  5404 <em class='comment'>/* Populate the scroll valuator at INDEX in DEVICE with the scroll</em>
<a id='L5405' name='L5405'></a>  5405 <em class='comment'>   valuator information provided in INFO.</em>
<a id='L5406' name='L5406'></a>  5406 <em class='comment'></em>
<a id='L5407' name='L5407'></a>  5407 <em class='comment'>   The information consists of:</em>
<a id='L5408' name='L5408'></a>  5408 <em class='comment'></em>
<a id='L5409' name='L5409'></a>  5409 <em class='comment'>     - whether or not the valuator is horizontal.</em>
<a id='L5410' name='L5410'></a>  5410 <em class='comment'></em>
<a id='L5411' name='L5411'></a>  5411 <em class='comment'>     - whether or not the valuator's value is currently unknown,</em>
<a id='L5412' name='L5412'></a>  5412 <em class='comment'>       until the next XI_Motion event is received or the valuator's</em>
<a id='L5413' name='L5413'></a>  5413 <em class='comment'>       value is restored by the caller upon encountering valuator</em>
<a id='L5414' name='L5414'></a>  5414 <em class='comment'>       class data.</em>
<a id='L5415' name='L5415'></a>  5415 <em class='comment'></em>
<a id='L5416' name='L5416'></a>  5416 <em class='comment'>     - what the current value of the valuator is.  This is set to</em>
<a id='L5417' name='L5417'></a>  5417 <em class='comment'>       DBL_MIN for debugging purposes, but can be any value, as</em>
<a id='L5418' name='L5418'></a>  5418 <em class='comment'>       invalid_p is currently true.</em>
<a id='L5419' name='L5419'></a>  5419 <em class='comment'></em>
<a id='L5420' name='L5420'></a>  5420 <em class='comment'>     - the increment, which defines the amount of movement equal to a</em>
<a id='L5421' name='L5421'></a>  5421 <em class='comment'>       single unit of scrolling.  For example, if the increment is</em>
<a id='L5422' name='L5422'></a>  5422 <em class='comment'>       2.0, then a WHEEL_DOWN or WHEEL_UP event will be sent every</em>
<a id='L5423' name='L5423'></a>  5423 <em class='comment'>       time the valuator value changes by 2.0, unless</em>
<a id='L5424' name='L5424'></a>  5424 <em class='comment'>       mwheel-coalesce-scroll-events is nil.</em>
<a id='L5425' name='L5425'></a>  5425 <em class='comment'></em>
<a id='L5426' name='L5426'></a>  5426 <em class='comment'>     - the number used in XI_Motion events and elsewhere to identify</em>
<a id='L5427' name='L5427'></a>  5427 <em class='comment'>       the valuator.  */</em>
<a id='L5428' name='L5428'></a>  5428 
<a id='L5429' name='L5429'></a>  5429 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L5430' name='L5430'></a>  5430 <a href='../R/18592.html' title='Multiple referred from 2 places.'>xi_populate_scroll_valuator</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L275' title='Defined at 275 in src/xterm.h.'>xi_device_t</a> *device,
<a id='L5431' name='L5431'></a>  5431                              <strong class='reserved'>int</strong> <a href='../S/2961.html#L89' title='Defined at 89 in lib-src/ntlib.h.'>index</a>, XIScrollClassInfo *<a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a>)
<a id='L5432' name='L5432'></a>  5432 <em class='brace'>{</em>
<a id='L5433' name='L5433'></a>  5433   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L233' title='Defined at 233 in src/xterm.h.'>xi_scroll_valuator_t</a> *valuator;
<a id='L5434' name='L5434'></a>  5434 
<a id='L5435' name='L5435'></a>  5435   valuator = &amp;device-&gt;valuators[<a href='../S/2961.html#L89' title='Defined at 89 in lib-src/ntlib.h.'>index</a>];
<a id='L5436' name='L5436'></a>  5436   valuator-&gt;horizontal
<a id='L5437' name='L5437'></a>  5437     = (<a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a>-&gt;scroll_type == XIScrollTypeHorizontal);
<a id='L5438' name='L5438'></a>  5438   valuator-&gt;invalid_p = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L5439' name='L5439'></a>  5439   valuator-&gt;emacs_value = DBL_MIN;
<a id='L5440' name='L5440'></a>  5440   valuator-&gt;<a href='../S/4025.html#L45' title='Defined at 45 in test/manual/cedet/tests/testsppreplaced.c.'>increment</a> = <a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a>-&gt;<a href='../S/4025.html#L45' title='Defined at 45 in test/manual/cedet/tests/testsppreplaced.c.'>increment</a>;
<a id='L5441' name='L5441'></a>  5441   valuator-&gt;number = <a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a>-&gt;number;
<a id='L5442' name='L5442'></a>  5442 <em class='brace'>}</em>
<a id='L5443' name='L5443'></a>  5443 
<a id='L5444' name='L5444'></a>  5444 <em class='sharp'>#endif</em>
<a id='L5445' name='L5445'></a>  5445 
<a id='L5446' name='L5446'></a>  5446 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L5447' name='L5447'></a>  5447 <a href='../R/18591.html' title='Multiple referred from 2 places.'>xi_populate_device_from_info</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L5448' name='L5448'></a>  5448                               <strong class='reserved'>struct</strong> <a href='../S/2212.html#L275' title='Defined at 275 in src/xterm.h.'>xi_device_t</a> *xi_device,
<a id='L5449' name='L5449'></a>  5449                               XIDeviceInfo *device)
<a id='L5450' name='L5450'></a>  5450 <em class='brace'>{</em>
<a id='L5451' name='L5451'></a>  5451 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L168' title='Defined at 168 in src/xterm.h.'>HAVE_XINPUT2_1</a>
<a id='L5452' name='L5452'></a>  5452   <strong class='reserved'>struct</strong> <a href='../S/2289.html#L5392' title='Defined at 5392 in src/xterm.c.'>xi_known_valuator</a> *values, *tem;
<a id='L5453' name='L5453'></a>  5453   <strong class='reserved'>int</strong> actual_valuator_count, <a href='../D/9440.html' title='Multiple defined in 2 places.'>c</a>;
<a id='L5454' name='L5454'></a>  5454   XIScrollClassInfo *<a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a>;
<a id='L5455' name='L5455'></a>  5455   XIValuatorClassInfo *valuator_info;
<a id='L5456' name='L5456'></a>  5456 <em class='sharp'>#endif</em>
<a id='L5457' name='L5457'></a>  5457 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L171' title='Defined at 171 in src/xterm.h.'>HAVE_XINPUT2_2</a>
<a id='L5458' name='L5458'></a>  5458   XITouchClassInfo *touch_info;
<a id='L5459' name='L5459'></a>  5459 <em class='sharp'>#endif</em>
<a id='L5460' name='L5460'></a>  5460 
<a id='L5461' name='L5461'></a>  5461 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L168' title='Defined at 168 in src/xterm.h.'>HAVE_XINPUT2_1</a>
<a id='L5462' name='L5462'></a>  5462   <a href='../D/6613.html' title='Multiple defined in 2 places.'>USE_SAFE_ALLOCA</a>;
<a id='L5463' name='L5463'></a>  5463 <em class='sharp'>#endif</em>
<a id='L5464' name='L5464'></a>  5464 
<a id='L5465' name='L5465'></a>  5465   <em class='comment'>/* Initialize generic information about the device: its ID, which</em>
<a id='L5466' name='L5466'></a>  5466 <em class='comment'>     buttons are currently pressed and thus presumably actively</em>
<a id='L5467' name='L5467'></a>  5467 <em class='comment'>     grabbing the device, what kind of device it is (master pointer,</em>
<a id='L5468' name='L5468'></a>  5468 <em class='comment'>     master keyboard, slave pointer, slave keyboard, or floating</em>
<a id='L5469' name='L5469'></a>  5469 <em class='comment'>     slave), and its attachment.</em>
<a id='L5470' name='L5470'></a>  5470 <em class='comment'></em>
<a id='L5471' name='L5471'></a>  5471 <em class='comment'>     Here is a brief description of what device uses and attachments</em>
<a id='L5472' name='L5472'></a>  5472 <em class='comment'>     are.  Under XInput 2, user input from individual input devices is</em>
<a id='L5473' name='L5473'></a>  5473 <em class='comment'>     multiplexed into specific seats before being delivered, with each</em>
<a id='L5474' name='L5474'></a>  5474 <em class='comment'>     seat corresponding to a single on-screen mouse pointer and having</em>
<a id='L5475' name='L5475'></a>  5475 <em class='comment'>     its own keyboard focus.  Each seat consists of two virtual</em>
<a id='L5476' name='L5476'></a>  5476 <em class='comment'>     devices: the master keyboard and the master pointer, the first of</em>
<a id='L5477' name='L5477'></a>  5477 <em class='comment'>     which is used to report all keyboard input, with the other used</em>
<a id='L5478' name='L5478'></a>  5478 <em class='comment'>     to report all other input.</em>
<a id='L5479' name='L5479'></a>  5479 <em class='comment'></em>
<a id='L5480' name='L5480'></a>  5480 <em class='comment'>     Input from each physical device (mouse, trackpad or keyboard) is</em>
<a id='L5481' name='L5481'></a>  5481 <em class='comment'>     then associated with that slave device's paired master device.</em>
<a id='L5482' name='L5482'></a>  5482 <em class='comment'>     For example, moving the device "Logitech USB Optical Mouse",</em>
<a id='L5483' name='L5483'></a>  5483 <em class='comment'>     enslaved by the master pointer device "Virtual core pointer",</em>
<a id='L5484' name='L5484'></a>  5484 <em class='comment'>     will result in movement of the mouse pointer associated with that</em>
<a id='L5485' name='L5485'></a>  5485 <em class='comment'>     master device's seat.  If the pointer moves over an Emacs frame,</em>
<a id='L5486' name='L5486'></a>  5486 <em class='comment'>     then the frame will receive XI_Enter and XI_Motion events from</em>
<a id='L5487' name='L5487'></a>  5487 <em class='comment'>     that master pointer.</em>
<a id='L5488' name='L5488'></a>  5488 <em class='comment'></em>
<a id='L5489' name='L5489'></a>  5489 <em class='comment'>     Likewise, keyboard input from the device "AT Translated Set 2</em>
<a id='L5490' name='L5490'></a>  5490 <em class='comment'>     keyboard", enslaved by the master keyboard device "Virtual core</em>
<a id='L5491' name='L5491'></a>  5491 <em class='comment'>     keyboard", will be reported to its seat's input focus window.</em>
<a id='L5492' name='L5492'></a>  5492 <em class='comment'></em>
<a id='L5493' name='L5493'></a>  5493 <em class='comment'>     The device use describes what the device is.  The meanings of</em>
<a id='L5494' name='L5494'></a>  5494 <em class='comment'>     MasterPointer, MasterKeyboard, SlavePointer and SlaveKeyboard</em>
<a id='L5495' name='L5495'></a>  5495 <em class='comment'>     should be obvious.  FloatingSlave means the device is a slave</em>
<a id='L5496' name='L5496'></a>  5496 <em class='comment'>     device that is not associated with any seat, and thus generates</em>
<a id='L5497' name='L5497'></a>  5497 <em class='comment'>     no input.</em>
<a id='L5498' name='L5498'></a>  5498 <em class='comment'></em>
<a id='L5499' name='L5499'></a>  5499 <em class='comment'>     The device attachment is a device ID whose meaning varies</em>
<a id='L5500' name='L5500'></a>  5500 <em class='comment'>     depending on the device use.  If the device is a master device,</em>
<a id='L5501' name='L5501'></a>  5501 <em class='comment'>     then the attachment is the device ID of the other device in its</em>
<a id='L5502' name='L5502'></a>  5502 <em class='comment'>     seat (the master keyboard for master pointer devices, and vice</em>
<a id='L5503' name='L5503'></a>  5503 <em class='comment'>     versa).  Otherwise, it is the ID of the master device the slave</em>
<a id='L5504' name='L5504'></a>  5504 <em class='comment'>     device is attached to.  For slave devices not attached to any</em>
<a id='L5505' name='L5505'></a>  5505 <em class='comment'>     seat, its value is undefined.  */</em>
<a id='L5506' name='L5506'></a>  5506 
<a id='L5507' name='L5507'></a>  5507   xi_device-&gt;device_id = device-&gt;deviceid;
<a id='L5508' name='L5508'></a>  5508   xi_device-&gt;grab = 0;
<a id='L5509' name='L5509'></a>  5509   xi_device-&gt;use = device-&gt;use;
<a id='L5510' name='L5510'></a>  5510   xi_device-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a> = <a href='../D/9420.html' title='Multiple defined in 2 places.'>build_string</a> (device-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>);
<a id='L5511' name='L5511'></a>  5511   xi_device-&gt;attachment = device-&gt;attachment;
<a id='L5512' name='L5512'></a>  5512 
<a id='L5513' name='L5513'></a>  5513   <em class='comment'>/* Clear the list of active touch points on the device, which are</em>
<a id='L5514' name='L5514'></a>  5514 <em class='comment'>     individual touches tracked by a touchscreen.  */</em>
<a id='L5515' name='L5515'></a>  5515 
<a id='L5516' name='L5516'></a>  5516 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L171' title='Defined at 171 in src/xterm.h.'>HAVE_XINPUT2_2</a>
<a id='L5517' name='L5517'></a>  5517   xi_device-&gt;touchpoints = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L5518' name='L5518'></a>  5518   xi_device-&gt;direct_p = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L5519' name='L5519'></a>  5519 <em class='sharp'>#endif</em>
<a id='L5520' name='L5520'></a>  5520 
<a id='L5521' name='L5521'></a>  5521 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L168' title='Defined at 168 in src/xterm.h.'>HAVE_XINPUT2_1</a>
<a id='L5522' name='L5522'></a>  5522   <strong class='reserved'>if</strong> (!dpyinfo-&gt;xi2_version)
<a id='L5523' name='L5523'></a>  5523     <em class='brace'>{</em>
<a id='L5524' name='L5524'></a>  5524       <em class='comment'>/* Skip everything below as there are no classes of interest on</em>
<a id='L5525' name='L5525'></a>  5525 <em class='comment'>         XI 2.0 servers.  */</em>
<a id='L5526' name='L5526'></a>  5526       xi_device-&gt;valuators = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L5527' name='L5527'></a>  5527       xi_device-&gt;scroll_valuator_count = 0;
<a id='L5528' name='L5528'></a>  5528 
<a id='L5529' name='L5529'></a>  5529       <a href='../D/5394.html' title='Multiple defined in 2 places.'>SAFE_FREE</a> ();
<a id='L5530' name='L5530'></a>  5530       <strong class='reserved'>return</strong>;
<a id='L5531' name='L5531'></a>  5531     <em class='brace'>}</em>
<a id='L5532' name='L5532'></a>  5532 
<a id='L5533' name='L5533'></a>  5533   actual_valuator_count = 0;
<a id='L5534' name='L5534'></a>  5534   xi_device-&gt;valuators = <a href='../D/20078.html' title='Multiple defined in 2 places.'>xnmalloc</a> (device-&gt;num_classes,
<a id='L5535' name='L5535'></a>  5535                                    <strong class='reserved'>sizeof</strong> *xi_device-&gt;valuators);
<a id='L5536' name='L5536'></a>  5536   values = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L5537' name='L5537'></a>  5537 
<a id='L5538' name='L5538'></a>  5538   <em class='comment'>/* Initialize device info based on a list of "device classes".</em>
<a id='L5539' name='L5539'></a>  5539 <em class='comment'>     Device classes are little pieces of information associated with a</em>
<a id='L5540' name='L5540'></a>  5540 <em class='comment'>     device.  Emacs is interested in scroll valuator information and</em>
<a id='L5541' name='L5541'></a>  5541 <em class='comment'>     touch handling information, which respectively describe the axes</em>
<a id='L5542' name='L5542'></a>  5542 <em class='comment'>     (if any) along which the device's scroll wheel rotates, and how</em>
<a id='L5543' name='L5543'></a>  5543 <em class='comment'>     the device reports touch input.  */</em>
<a id='L5544' name='L5544'></a>  5544 
<a id='L5545' name='L5545'></a>  5545   <strong class='reserved'>for</strong> (<a href='../D/9440.html' title='Multiple defined in 2 places.'>c</a> = 0; <a href='../D/9440.html' title='Multiple defined in 2 places.'>c</a> &lt; device-&gt;num_classes; ++<a href='../D/9440.html' title='Multiple defined in 2 places.'>c</a>)
<a id='L5546' name='L5546'></a>  5546     <em class='brace'>{</em>
<a id='L5547' name='L5547'></a>  5547       <strong class='reserved'>switch</strong> (device-&gt;classes[<a href='../D/9440.html' title='Multiple defined in 2 places.'>c</a>]-&gt;type)
<a id='L5548' name='L5548'></a>  5548         <em class='brace'>{</em>
<a id='L5549' name='L5549'></a>  5549         <strong class='reserved'>case</strong> XIScrollClass:
<a id='L5550' name='L5550'></a>  5550           <em class='brace'>{</em>
<a id='L5551' name='L5551'></a>  5551             <a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a> = (XIScrollClassInfo *) device-&gt;classes[<a href='../D/9440.html' title='Multiple defined in 2 places.'>c</a>];
<a id='L5552' name='L5552'></a>  5552             <a href='../S/2289.html#L5430' title='Defined at 5430 in src/xterm.c.'>xi_populate_scroll_valuator</a> (xi_device, actual_valuator_count++,
<a id='L5553' name='L5553'></a>  5553                                          <a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a>);
<a id='L5554' name='L5554'></a>  5554             <strong class='reserved'>break</strong>;
<a id='L5555' name='L5555'></a>  5555           <em class='brace'>}</em>
<a id='L5556' name='L5556'></a>  5556 
<a id='L5557' name='L5557'></a>  5557         <strong class='reserved'>case</strong> XIValuatorClass:
<a id='L5558' name='L5558'></a>  5558           <em class='brace'>{</em>
<a id='L5559' name='L5559'></a>  5559             valuator_info = (XIValuatorClassInfo *) device-&gt;classes[<a href='../D/9440.html' title='Multiple defined in 2 places.'>c</a>];
<a id='L5560' name='L5560'></a>  5560             tem = <a href='../D/5389.html' title='Multiple defined in 2 places.'>SAFE_ALLOCA</a> (<strong class='reserved'>sizeof</strong> *tem);
<a id='L5561' name='L5561'></a>  5561 
<a id='L5562' name='L5562'></a>  5562             <em class='comment'>/* Avoid restoring bogus values if some driver</em>
<a id='L5563' name='L5563'></a>  5563 <em class='comment'>               accidentally specifies relative values in scroll</em>
<a id='L5564' name='L5564'></a>  5564 <em class='comment'>               valuator classes how the input extension spec says they</em>
<a id='L5565' name='L5565'></a>  5565 <em class='comment'>               should be, but allow restoring values when a value is</em>
<a id='L5566' name='L5566'></a>  5566 <em class='comment'>               set, which is how the input extension actually</em>
<a id='L5567' name='L5567'></a>  5567 <em class='comment'>               behaves.  */</em>
<a id='L5568' name='L5568'></a>  5568 
<a id='L5569' name='L5569'></a>  5569             <strong class='reserved'>if</strong> (valuator_info-&gt;<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a> == 0.0
<a id='L5570' name='L5570'></a>  5570                 &amp;&amp; valuator_info-&gt;mode != XIModeAbsolute)
<a id='L5571' name='L5571'></a>  5571               <strong class='reserved'>continue</strong>;
<a id='L5572' name='L5572'></a>  5572 
<a id='L5573' name='L5573'></a>  5573             tem-&gt;next = values;
<a id='L5574' name='L5574'></a>  5574             tem-&gt;number = valuator_info-&gt;number;
<a id='L5575' name='L5575'></a>  5575             tem-&gt;current_value = valuator_info-&gt;<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>;
<a id='L5576' name='L5576'></a>  5576 
<a id='L5577' name='L5577'></a>  5577             values = tem;
<a id='L5578' name='L5578'></a>  5578             <strong class='reserved'>break</strong>;
<a id='L5579' name='L5579'></a>  5579           <em class='brace'>}</em>
<a id='L5580' name='L5580'></a>  5580 
<a id='L5581' name='L5581'></a>  5581 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L171' title='Defined at 171 in src/xterm.h.'>HAVE_XINPUT2_2</a>
<a id='L5582' name='L5582'></a>  5582         <strong class='reserved'>case</strong> XITouchClass:
<a id='L5583' name='L5583'></a>  5583           <em class='brace'>{</em>
<a id='L5584' name='L5584'></a>  5584             touch_info = (XITouchClassInfo *) device-&gt;classes[<a href='../D/9440.html' title='Multiple defined in 2 places.'>c</a>];
<a id='L5585' name='L5585'></a>  5585             xi_device-&gt;direct_p = touch_info-&gt;mode == XIDirectTouch;
<a id='L5586' name='L5586'></a>  5586           <em class='brace'>}</em>
<a id='L5587' name='L5587'></a>  5587 <em class='sharp'>#endif</em>
<a id='L5588' name='L5588'></a>  5588         <strong class='reserved'>default</strong>:
<a id='L5589' name='L5589'></a>  5589           <strong class='reserved'>break</strong>;
<a id='L5590' name='L5590'></a>  5590         <em class='brace'>}</em>
<a id='L5591' name='L5591'></a>  5591     <em class='brace'>}</em>
<a id='L5592' name='L5592'></a>  5592 
<a id='L5593' name='L5593'></a>  5593   xi_device-&gt;scroll_valuator_count = actual_valuator_count;
<a id='L5594' name='L5594'></a>  5594 
<a id='L5595' name='L5595'></a>  5595   <em class='comment'>/* Now look through all the valuators whose values are already known</em>
<a id='L5596' name='L5596'></a>  5596 <em class='comment'>     and populate our client-side records with their current</em>
<a id='L5597' name='L5597'></a>  5597 <em class='comment'>     values.  */</em>
<a id='L5598' name='L5598'></a>  5598 
<a id='L5599' name='L5599'></a>  5599   <strong class='reserved'>for</strong> (tem = values; values; values = values-&gt;next)
<a id='L5600' name='L5600'></a>  5600     <em class='brace'>{</em>
<a id='L5601' name='L5601'></a>  5601       <strong class='reserved'>for</strong> (<a href='../D/9440.html' title='Multiple defined in 2 places.'>c</a> = 0; <a href='../D/9440.html' title='Multiple defined in 2 places.'>c</a> &lt; xi_device-&gt;scroll_valuator_count; ++<a href='../D/9440.html' title='Multiple defined in 2 places.'>c</a>)
<a id='L5602' name='L5602'></a>  5602         <em class='brace'>{</em>
<a id='L5603' name='L5603'></a>  5603           <strong class='reserved'>if</strong> (xi_device-&gt;valuators[<a href='../D/9440.html' title='Multiple defined in 2 places.'>c</a>].number == tem-&gt;number)
<a id='L5604' name='L5604'></a>  5604             <em class='brace'>{</em>
<a id='L5605' name='L5605'></a>  5605               xi_device-&gt;valuators[<a href='../D/9440.html' title='Multiple defined in 2 places.'>c</a>].invalid_p = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L5606' name='L5606'></a>  5606               xi_device-&gt;valuators[<a href='../D/9440.html' title='Multiple defined in 2 places.'>c</a>].current_value
<a id='L5607' name='L5607'></a>  5607                 = tem-&gt;current_value;
<a id='L5608' name='L5608'></a>  5608               xi_device-&gt;valuators[<a href='../D/9440.html' title='Multiple defined in 2 places.'>c</a>].emacs_value = 0.0;
<a id='L5609' name='L5609'></a>  5609             <em class='brace'>}</em>
<a id='L5610' name='L5610'></a>  5610         <em class='brace'>}</em>
<a id='L5611' name='L5611'></a>  5611     <em class='brace'>}</em>
<a id='L5612' name='L5612'></a>  5612 
<a id='L5613' name='L5613'></a>  5613   <a href='../D/5394.html' title='Multiple defined in 2 places.'>SAFE_FREE</a> ();
<a id='L5614' name='L5614'></a>  5614 <em class='sharp'>#endif</em>
<a id='L5615' name='L5615'></a>  5615 <em class='brace'>}</em>
<a id='L5616' name='L5616'></a>  5616 
<a id='L5617' name='L5617'></a>  5617 <em class='comment'>/* Populate our client-side record of all devices, which includes</em>
<a id='L5618' name='L5618'></a>  5618 <em class='comment'>   basic information about the device and also touchscreen tracking</em>
<a id='L5619' name='L5619'></a>  5619 <em class='comment'>   information and scroll valuators.</em>
<a id='L5620' name='L5620'></a>  5620 <em class='comment'></em>
<a id='L5621' name='L5621'></a>  5621 <em class='comment'>   Keeping track of scroll valuators is required in order to support</em>
<a id='L5622' name='L5622'></a>  5622 <em class='comment'>   scroll wheels that report information in a fashion more detailed</em>
<a id='L5623' name='L5623'></a>  5623 <em class='comment'>   than a single turn of a "step" in the wheel.</em>
<a id='L5624' name='L5624'></a>  5624 <em class='comment'></em>
<a id='L5625' name='L5625'></a>  5625 <em class='comment'>   When the input extension is being utilized, the states of the mouse</em>
<a id='L5626' name='L5626'></a>  5626 <em class='comment'>   wheels on each axis are stored as absolute values inside</em>
<a id='L5627' name='L5627'></a>  5627 <em class='comment'>   "valuators" attached to each mouse device.  To obtain the delta of</em>
<a id='L5628' name='L5628'></a>  5628 <em class='comment'>   the scroll wheel from a motion event (which is used to report that</em>
<a id='L5629' name='L5629'></a>  5629 <em class='comment'>   some valuator has changed), it is necessary to iterate over every</em>
<a id='L5630' name='L5630'></a>  5630 <em class='comment'>   valuator that changed, and compare its previous value to the</em>
<a id='L5631' name='L5631'></a>  5631 <em class='comment'>   current value of the valuator.</em>
<a id='L5632' name='L5632'></a>  5632 <em class='comment'></em>
<a id='L5633' name='L5633'></a>  5633 <em class='comment'>   Each individual valuator also has an "interval", which is the</em>
<a id='L5634' name='L5634'></a>  5634 <em class='comment'>   amount you must divide that delta by in order to obtain a delta in</em>
<a id='L5635' name='L5635'></a>  5635 <em class='comment'>   the terms of scroll units.</em>
<a id='L5636' name='L5636'></a>  5636 <em class='comment'></em>
<a id='L5637' name='L5637'></a>  5637 <em class='comment'>   This delta however is still intermediate, to make driver</em>
<a id='L5638' name='L5638'></a>  5638 <em class='comment'>   implementations easier.  The XInput developers recommend (and most</em>
<a id='L5639' name='L5639'></a>  5639 <em class='comment'>   programs use) the following algorithm to convert from scroll unit</em>
<a id='L5640' name='L5640'></a>  5640 <em class='comment'>   deltas to pixel deltas by which the display must actually be</em>
<a id='L5641' name='L5641'></a>  5641 <em class='comment'>   scrolled:</em>
<a id='L5642' name='L5642'></a>  5642 <em class='comment'></em>
<a id='L5643' name='L5643'></a>  5643 <em class='comment'>     pixels_scrolled = pow (window_height, 2.0 / 3.0) * delta;  */</em>
<a id='L5644' name='L5644'></a>  5644 
<a id='L5645' name='L5645'></a>  5645 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L5646' name='L5646'></a>  5646 <a href='../S/2289.html#L30677' title='Referred from 30677 in src/xterm.c.'>x_cache_xi_devices</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo)
<a id='L5647' name='L5647'></a>  5647 <em class='brace'>{</em>
<a id='L5648' name='L5648'></a>  5648   <strong class='reserved'>int</strong> ndevices, actual_devices, i;
<a id='L5649' name='L5649'></a>  5649   XIDeviceInfo *infos;
<a id='L5650' name='L5650'></a>  5650 
<a id='L5651' name='L5651'></a>  5651   actual_devices = 0;
<a id='L5652' name='L5652'></a>  5652   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L5653' name='L5653'></a>  5653   <a href='../S/2289.html#L5355' title='Defined at 5355 in src/xterm.c.'>x_free_xi_devices</a> (dpyinfo);
<a id='L5654' name='L5654'></a>  5654   infos = XIQueryDevice (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L5655' name='L5655'></a>  5655                          XIAllDevices,
<a id='L5656' name='L5656'></a>  5656                          &amp;ndevices);
<a id='L5657' name='L5657'></a>  5657 
<a id='L5658' name='L5658'></a>  5658   <strong class='reserved'>if</strong> (!ndevices)
<a id='L5659' name='L5659'></a>  5659     <em class='brace'>{</em>
<a id='L5660' name='L5660'></a>  5660       XIFreeDeviceInfo (infos);
<a id='L5661' name='L5661'></a>  5661       <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L5662' name='L5662'></a>  5662       <strong class='reserved'>return</strong>;
<a id='L5663' name='L5663'></a>  5663     <em class='brace'>}</em>
<a id='L5664' name='L5664'></a>  5664 
<a id='L5665' name='L5665'></a>  5665   dpyinfo-&gt;devices = <a href='../S/2350.html#L802' title='Defined at 802 in src/alloc.c.'>xzalloc</a> (<strong class='reserved'>sizeof</strong> *dpyinfo-&gt;devices * ndevices);
<a id='L5666' name='L5666'></a>  5666 
<a id='L5667' name='L5667'></a>  5667   <strong class='reserved'>for</strong> (i = 0; i &lt; ndevices; ++i)
<a id='L5668' name='L5668'></a>  5668     <em class='brace'>{</em>
<a id='L5669' name='L5669'></a>  5669       <strong class='reserved'>if</strong> (infos[i].enabled)
<a id='L5670' name='L5670'></a>  5670         <a href='../S/2289.html#L5447' title='Defined at 5447 in src/xterm.c.'>xi_populate_device_from_info</a> (dpyinfo,
<a id='L5671' name='L5671'></a>  5671                                       &amp;dpyinfo-&gt;devices[actual_devices++],
<a id='L5672' name='L5672'></a>  5672                                       &amp;infos[i]);
<a id='L5673' name='L5673'></a>  5673     <em class='brace'>}</em>
<a id='L5674' name='L5674'></a>  5674 
<a id='L5675' name='L5675'></a>  5675   dpyinfo-&gt;num_devices = actual_devices;
<a id='L5676' name='L5676'></a>  5676   XIFreeDeviceInfo (infos);
<a id='L5677' name='L5677'></a>  5677   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L5678' name='L5678'></a>  5678 <em class='brace'>}</em>
<a id='L5679' name='L5679'></a>  5679 
<a id='L5680' name='L5680'></a>  5680 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L168' title='Defined at 168 in src/xterm.h.'>HAVE_XINPUT2_1</a>
<a id='L5681' name='L5681'></a>  5681 <em class='comment'>/* Return the delta of the scroll valuator VALUATOR_NUMBER under</em>
<a id='L5682' name='L5682'></a>  5682 <em class='comment'>   DEVICE in the display DPYINFO with VALUE.  The valuator's valuator</em>
<a id='L5683' name='L5683'></a>  5683 <em class='comment'>   will be set to VALUE afterwards.  In case no scroll valuator is</em>
<a id='L5684' name='L5684'></a>  5684 <em class='comment'>   found, or if the valuator state is invalid (see the comment under</em>
<a id='L5685' name='L5685'></a>  5685 <em class='comment'>   XI_Enter in handle_one_xevent).  Otherwise, the valuator is</em>
<a id='L5686' name='L5686'></a>  5686 <em class='comment'>   returned in VALUATOR_RETURN.  */</em>
<a id='L5687' name='L5687'></a>  5687 <strong class='reserved'>static</strong> <strong class='reserved'>double</strong>
<a id='L5688' name='L5688'></a>  5688 <a href='../S/2289.html#L22330' title='Referred from 22330 in src/xterm.c.'>x_get_scroll_valuator_delta</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L5689' name='L5689'></a>  5689                              <strong class='reserved'>struct</strong> <a href='../S/2212.html#L275' title='Defined at 275 in src/xterm.h.'>xi_device_t</a> *device,
<a id='L5690' name='L5690'></a>  5690                              <strong class='reserved'>int</strong> valuator_number, <strong class='reserved'>double</strong> <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>,
<a id='L5691' name='L5691'></a>  5691                              <strong class='reserved'>struct</strong> <a href='../S/2212.html#L233' title='Defined at 233 in src/xterm.h.'>xi_scroll_valuator_t</a> **valuator_return)
<a id='L5692' name='L5692'></a>  5692 <em class='brace'>{</em>
<a id='L5693' name='L5693'></a>  5693   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L233' title='Defined at 233 in src/xterm.h.'>xi_scroll_valuator_t</a> *sv;
<a id='L5694' name='L5694'></a>  5694   <strong class='reserved'>double</strong> delta;
<a id='L5695' name='L5695'></a>  5695   <strong class='reserved'>int</strong> i;
<a id='L5696' name='L5696'></a>  5696 
<a id='L5697' name='L5697'></a>  5697   <strong class='reserved'>for</strong> (i = 0; i &lt; device-&gt;scroll_valuator_count; ++i)
<a id='L5698' name='L5698'></a>  5698     <em class='brace'>{</em>
<a id='L5699' name='L5699'></a>  5699       sv = &amp;device-&gt;valuators[i];
<a id='L5700' name='L5700'></a>  5700 
<a id='L5701' name='L5701'></a>  5701       <strong class='reserved'>if</strong> (sv-&gt;number == valuator_number)
<a id='L5702' name='L5702'></a>  5702         <em class='brace'>{</em>
<a id='L5703' name='L5703'></a>  5703           *valuator_return = sv;
<a id='L5704' name='L5704'></a>  5704 
<a id='L5705' name='L5705'></a>  5705           <strong class='reserved'>if</strong> (sv-&gt;<a href='../S/4025.html#L45' title='Defined at 45 in test/manual/cedet/tests/testsppreplaced.c.'>increment</a> == 0)
<a id='L5706' name='L5706'></a>  5706             <strong class='reserved'>return</strong> DBL_MAX;
<a id='L5707' name='L5707'></a>  5707 
<a id='L5708' name='L5708'></a>  5708           <strong class='reserved'>if</strong> (sv-&gt;invalid_p)
<a id='L5709' name='L5709'></a>  5709             <em class='brace'>{</em>
<a id='L5710' name='L5710'></a>  5710               sv-&gt;current_value = <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>;
<a id='L5711' name='L5711'></a>  5711               sv-&gt;invalid_p = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L5712' name='L5712'></a>  5712 
<a id='L5713' name='L5713'></a>  5713               <strong class='reserved'>return</strong> DBL_MAX;
<a id='L5714' name='L5714'></a>  5714             <em class='brace'>}</em>
<a id='L5715' name='L5715'></a>  5715           <strong class='reserved'>else</strong>
<a id='L5716' name='L5716'></a>  5716             <em class='brace'>{</em>
<a id='L5717' name='L5717'></a>  5717               delta = (sv-&gt;current_value - <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>) / sv-&gt;<a href='../S/4025.html#L45' title='Defined at 45 in test/manual/cedet/tests/testsppreplaced.c.'>increment</a>;
<a id='L5718' name='L5718'></a>  5718               sv-&gt;current_value = <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>;
<a id='L5719' name='L5719'></a>  5719 
<a id='L5720' name='L5720'></a>  5720               <strong class='reserved'>return</strong> delta;
<a id='L5721' name='L5721'></a>  5721             <em class='brace'>}</em>
<a id='L5722' name='L5722'></a>  5722         <em class='brace'>}</em>
<a id='L5723' name='L5723'></a>  5723     <em class='brace'>}</em>
<a id='L5724' name='L5724'></a>  5724 
<a id='L5725' name='L5725'></a>  5725   *valuator_return = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L5726' name='L5726'></a>  5726   <strong class='reserved'>return</strong> DBL_MAX;
<a id='L5727' name='L5727'></a>  5727 <em class='brace'>}</em>
<a id='L5728' name='L5728'></a>  5728 
<a id='L5729' name='L5729'></a>  5729 <em class='sharp'>#endif</em>
<a id='L5730' name='L5730'></a>  5730 
<a id='L5731' name='L5731'></a>  5731 <strong class='reserved'>struct</strong> <a href='../S/2212.html#L275' title='Defined at 275 in src/xterm.h.'>xi_device_t</a> *
<a id='L5732' name='L5732'></a>  5732 <a href='../R/18585.html' title='Multiple referred from 39 places.'>xi_device_from_id</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo, <strong class='reserved'>int</strong> deviceid)
<a id='L5733' name='L5733'></a>  5733 <em class='brace'>{</em>
<a id='L5734' name='L5734'></a>  5734   <strong class='reserved'>for</strong> (<strong class='reserved'>int</strong> i = 0; i &lt; dpyinfo-&gt;num_devices; ++i)
<a id='L5735' name='L5735'></a>  5735     <em class='brace'>{</em>
<a id='L5736' name='L5736'></a>  5736       <strong class='reserved'>if</strong> (dpyinfo-&gt;devices[i].device_id == deviceid)
<a id='L5737' name='L5737'></a>  5737         <strong class='reserved'>return</strong> &amp;dpyinfo-&gt;devices[i];
<a id='L5738' name='L5738'></a>  5738     <em class='brace'>}</em>
<a id='L5739' name='L5739'></a>  5739 
<a id='L5740' name='L5740'></a>  5740   <strong class='reserved'>return</strong> <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L5741' name='L5741'></a>  5741 <em class='brace'>}</em>
<a id='L5742' name='L5742'></a>  5742 
<a id='L5743' name='L5743'></a>  5743 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L171' title='Defined at 171 in src/xterm.h.'>HAVE_XINPUT2_2</a>
<a id='L5744' name='L5744'></a>  5744 
<a id='L5745' name='L5745'></a>  5745 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L5746' name='L5746'></a>  5746 <a href='../S/2289.html#L24411' title='Referred from 24411 in src/xterm.c.'>xi_link_touch_point</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L275' title='Defined at 275 in src/xterm.h.'>xi_device_t</a> *device,
<a id='L5747' name='L5747'></a>  5747                      <strong class='reserved'>int</strong> detail, <strong class='reserved'>double</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, <strong class='reserved'>double</strong> y,
<a id='L5748' name='L5748'></a>  5748                      <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)
<a id='L5749' name='L5749'></a>  5749 <em class='brace'>{</em>
<a id='L5750' name='L5750'></a>  5750   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L258' title='Defined at 258 in src/xterm.h.'>xi_touch_point_t</a> *touchpoint;
<a id='L5751' name='L5751'></a>  5751 
<a id='L5752' name='L5752'></a>  5752   touchpoint = <a href='../D/20068.html' title='Multiple defined in 10 places.'>xmalloc</a> (<strong class='reserved'>sizeof</strong> *touchpoint);
<a id='L5753' name='L5753'></a>  5753   touchpoint-&gt;next = device-&gt;touchpoints;
<a id='L5754' name='L5754'></a>  5754   touchpoint-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L5755' name='L5755'></a>  5755   touchpoint-&gt;y = y;
<a id='L5756' name='L5756'></a>  5756   touchpoint-&gt;number = detail;
<a id='L5757' name='L5757'></a>  5757   touchpoint-&gt;<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> = <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>;
<a id='L5758' name='L5758'></a>  5758 
<a id='L5759' name='L5759'></a>  5759   device-&gt;touchpoints = touchpoint;
<a id='L5760' name='L5760'></a>  5760 <em class='brace'>}</em>
<a id='L5761' name='L5761'></a>  5761 
<a id='L5762' name='L5762'></a>  5762 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L5763' name='L5763'></a>  5763 <a href='../S/2289.html#L24517' title='Referred from 24517 in src/xterm.c.'>xi_unlink_touch_point</a> (<strong class='reserved'>int</strong> detail,
<a id='L5764' name='L5764'></a>  5764                        <strong class='reserved'>struct</strong> <a href='../S/2212.html#L275' title='Defined at 275 in src/xterm.h.'>xi_device_t</a> *device)
<a id='L5765' name='L5765'></a>  5765 <em class='brace'>{</em>
<a id='L5766' name='L5766'></a>  5766   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L258' title='Defined at 258 in src/xterm.h.'>xi_touch_point_t</a> *last, *tem;
<a id='L5767' name='L5767'></a>  5767 
<a id='L5768' name='L5768'></a>  5768   <strong class='reserved'>for</strong> (last = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, tem = device-&gt;touchpoints; tem;
<a id='L5769' name='L5769'></a>  5769        last = tem, tem = tem-&gt;next)
<a id='L5770' name='L5770'></a>  5770     <em class='brace'>{</em>
<a id='L5771' name='L5771'></a>  5771       <strong class='reserved'>if</strong> (tem-&gt;number == detail)
<a id='L5772' name='L5772'></a>  5772         <em class='brace'>{</em>
<a id='L5773' name='L5773'></a>  5773           <strong class='reserved'>if</strong> (!last)
<a id='L5774' name='L5774'></a>  5774             device-&gt;touchpoints = tem-&gt;next;
<a id='L5775' name='L5775'></a>  5775           <strong class='reserved'>else</strong>
<a id='L5776' name='L5776'></a>  5776             last-&gt;next = tem-&gt;next;
<a id='L5777' name='L5777'></a>  5777 
<a id='L5778' name='L5778'></a>  5778           <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (tem);
<a id='L5779' name='L5779'></a>  5779           <strong class='reserved'>return</strong> <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L5780' name='L5780'></a>  5780         <em class='brace'>}</em>
<a id='L5781' name='L5781'></a>  5781     <em class='brace'>}</em>
<a id='L5782' name='L5782'></a>  5782 
<a id='L5783' name='L5783'></a>  5783   <strong class='reserved'>return</strong> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L5784' name='L5784'></a>  5784 <em class='brace'>}</em>
<a id='L5785' name='L5785'></a>  5785 
<a id='L5786' name='L5786'></a>  5786 <em class='comment'>/* Unlink all touch points associated with the frame F.</em>
<a id='L5787' name='L5787'></a>  5787 <em class='comment'>   This is done upon unmapping or destroying F's window, because</em>
<a id='L5788' name='L5788'></a>  5788 <em class='comment'>   touch point delivery after that point is undefined.  */</em>
<a id='L5789' name='L5789'></a>  5789 
<a id='L5790' name='L5790'></a>  5790 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L5791' name='L5791'></a>  5791 <a href='../R/18598.html' title='Multiple referred from 2 places.'>xi_unlink_touch_points</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L5792' name='L5792'></a>  5792 <em class='brace'>{</em>
<a id='L5793' name='L5793'></a>  5793   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L275' title='Defined at 275 in src/xterm.h.'>xi_device_t</a> *device;
<a id='L5794' name='L5794'></a>  5794   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L258' title='Defined at 258 in src/xterm.h.'>xi_touch_point_t</a> **next, *last;
<a id='L5795' name='L5795'></a>  5795   <strong class='reserved'>int</strong> i;
<a id='L5796' name='L5796'></a>  5796 
<a id='L5797' name='L5797'></a>  5797   <strong class='reserved'>for</strong> (i = 0; i &lt; <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;num_devices; ++i)
<a id='L5798' name='L5798'></a>  5798     <em class='brace'>{</em>
<a id='L5799' name='L5799'></a>  5799       device = &amp;<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;devices[i];
<a id='L5800' name='L5800'></a>  5800 
<a id='L5801' name='L5801'></a>  5801       <em class='comment'>/* Now unlink all touch points on DEVICE matching F.  */</em>
<a id='L5802' name='L5802'></a>  5802 
<a id='L5803' name='L5803'></a>  5803       <strong class='reserved'>for</strong> (next = &amp;device-&gt;touchpoints; (last = *next);)
<a id='L5804' name='L5804'></a>  5804         <em class='brace'>{</em>
<a id='L5805' name='L5805'></a>  5805           <strong class='reserved'>if</strong> (last-&gt;<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> == <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L5806' name='L5806'></a>  5806             <em class='brace'>{</em>
<a id='L5807' name='L5807'></a>  5807               *next = last-&gt;next;
<a id='L5808' name='L5808'></a>  5808               <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (last);
<a id='L5809' name='L5809'></a>  5809             <em class='brace'>}</em>
<a id='L5810' name='L5810'></a>  5810           <strong class='reserved'>else</strong>
<a id='L5811' name='L5811'></a>  5811             next = &amp;last-&gt;next;
<a id='L5812' name='L5812'></a>  5812         <em class='brace'>}</em>
<a id='L5813' name='L5813'></a>  5813     <em class='brace'>}</em>
<a id='L5814' name='L5814'></a>  5814 <em class='brace'>}</em>
<a id='L5815' name='L5815'></a>  5815 
<a id='L5816' name='L5816'></a>  5816 <strong class='reserved'>static</strong> <strong class='reserved'>struct</strong> <a href='../S/2212.html#L258' title='Defined at 258 in src/xterm.h.'>xi_touch_point_t</a> *
<a id='L5817' name='L5817'></a>  5817 <a href='../R/18587.html' title='Multiple referred from 2 places.'>xi_find_touch_point</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L275' title='Defined at 275 in src/xterm.h.'>xi_device_t</a> *device, <strong class='reserved'>int</strong> detail)
<a id='L5818' name='L5818'></a>  5818 <em class='brace'>{</em>
<a id='L5819' name='L5819'></a>  5819   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L258' title='Defined at 258 in src/xterm.h.'>xi_touch_point_t</a> *point;
<a id='L5820' name='L5820'></a>  5820 
<a id='L5821' name='L5821'></a>  5821   <strong class='reserved'>for</strong> (point = device-&gt;touchpoints; point; point = point-&gt;next)
<a id='L5822' name='L5822'></a>  5822     <em class='brace'>{</em>
<a id='L5823' name='L5823'></a>  5823       <strong class='reserved'>if</strong> (point-&gt;number == detail)
<a id='L5824' name='L5824'></a>  5824         <strong class='reserved'>return</strong> point;
<a id='L5825' name='L5825'></a>  5825     <em class='brace'>}</em>
<a id='L5826' name='L5826'></a>  5826 
<a id='L5827' name='L5827'></a>  5827   <strong class='reserved'>return</strong> <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L5828' name='L5828'></a>  5828 <em class='brace'>}</em>
<a id='L5829' name='L5829'></a>  5829 
<a id='L5830' name='L5830'></a>  5830 <em class='sharp'>#endif</em> <em class='comment'>/* HAVE_XINPUT2_2 */</em>
<a id='L5831' name='L5831'></a>  5831 
<a id='L5832' name='L5832'></a>  5832 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L168' title='Defined at 168 in src/xterm.h.'>HAVE_XINPUT2_1</a>
<a id='L5833' name='L5833'></a>  5833 
<a id='L5834' name='L5834'></a>  5834 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L5835' name='L5835'></a>  5835 <a href='../R/18593.html' title='Multiple referred from 2 places.'>xi_reset_scroll_valuators_for_device_id</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L5836' name='L5836'></a>  5836                                          <strong class='reserved'>int</strong> id)
<a id='L5837' name='L5837'></a>  5837 <em class='brace'>{</em>
<a id='L5838' name='L5838'></a>  5838   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L275' title='Defined at 275 in src/xterm.h.'>xi_device_t</a> *device;
<a id='L5839' name='L5839'></a>  5839   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L233' title='Defined at 233 in src/xterm.h.'>xi_scroll_valuator_t</a> *valuator;
<a id='L5840' name='L5840'></a>  5840   <strong class='reserved'>int</strong> i;
<a id='L5841' name='L5841'></a>  5841 
<a id='L5842' name='L5842'></a>  5842   device = <a href='../S/2289.html#L5732' title='Defined at 5732 in src/xterm.c.'>xi_device_from_id</a> (dpyinfo, id);
<a id='L5843' name='L5843'></a>  5843 
<a id='L5844' name='L5844'></a>  5844   <strong class='reserved'>if</strong> (!device)
<a id='L5845' name='L5845'></a>  5845     <strong class='reserved'>return</strong>;
<a id='L5846' name='L5846'></a>  5846 
<a id='L5847' name='L5847'></a>  5847   <strong class='reserved'>if</strong> (!device-&gt;scroll_valuator_count)
<a id='L5848' name='L5848'></a>  5848     <strong class='reserved'>return</strong>;
<a id='L5849' name='L5849'></a>  5849 
<a id='L5850' name='L5850'></a>  5850   <strong class='reserved'>for</strong> (i = 0; i &lt; device-&gt;scroll_valuator_count; ++i)
<a id='L5851' name='L5851'></a>  5851     <em class='brace'>{</em>
<a id='L5852' name='L5852'></a>  5852       valuator = &amp;device-&gt;valuators[i];
<a id='L5853' name='L5853'></a>  5853       valuator-&gt;invalid_p = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L5854' name='L5854'></a>  5854       valuator-&gt;emacs_value = 0.0;
<a id='L5855' name='L5855'></a>  5855     <em class='brace'>}</em>
<a id='L5856' name='L5856'></a>  5856 
<a id='L5857' name='L5857'></a>  5857   <strong class='reserved'>return</strong>;
<a id='L5858' name='L5858'></a>  5858 <em class='brace'>}</em>
<a id='L5859' name='L5859'></a>  5859 
<a id='L5860' name='L5860'></a>  5860 <em class='sharp'>#endif</em> <em class='comment'>/* HAVE_XINPUT2_1 */</em>
<a id='L5861' name='L5861'></a>  5861 
<a id='L5862' name='L5862'></a>  5862 <em class='sharp'>#endif</em>
<a id='L5863' name='L5863'></a>  5863 
<a id='L5864' name='L5864'></a>  5864 <em class='sharp'>#ifdef</em> USE_CAIRO
<a id='L5865' name='L5865'></a>  5865 
<a id='L5866' name='L5866'></a>  5866 <strong class='reserved'>void</strong>
<a id='L5867' name='L5867'></a>  5867 <a href='../R/18092.html' title='Multiple referred from 5 places.'>x_cr_destroy_frame_context</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L5868' name='L5868'></a>  5868 <em class='brace'>{</em>
<a id='L5869' name='L5869'></a>  5869   <strong class='reserved'>if</strong> (<a href='../D/2280.html' title='Multiple defined in 3 places.'>FRAME_CR_CONTEXT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L5870' name='L5870'></a>  5870     <em class='brace'>{</em>
<a id='L5871' name='L5871'></a>  5871       cairo_destroy (<a href='../D/2280.html' title='Multiple defined in 3 places.'>FRAME_CR_CONTEXT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L5872' name='L5872'></a>  5872       <a href='../D/2280.html' title='Multiple defined in 3 places.'>FRAME_CR_CONTEXT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L5873' name='L5873'></a>  5873     <em class='brace'>}</em>
<a id='L5874' name='L5874'></a>  5874 <em class='brace'>}</em>
<a id='L5875' name='L5875'></a>  5875 
<a id='L5876' name='L5876'></a>  5876 <strong class='reserved'>void</strong>
<a id='L5877' name='L5877'></a>  5877 <a href='../R/18099.html' title='Multiple referred from 5 places.'>x_cr_update_surface_desired_size</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <strong class='reserved'>int</strong> width, <strong class='reserved'>int</strong> height)
<a id='L5878' name='L5878'></a>  5878 <em class='brace'>{</em>
<a id='L5879' name='L5879'></a>  5879   <strong class='reserved'>if</strong> (<a href='../D/2283.html' title='Multiple defined in 2 places.'>FRAME_CR_SURFACE_DESIRED_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) != width
<a id='L5880' name='L5880'></a>  5880       || <a href='../D/2282.html' title='Multiple defined in 2 places.'>FRAME_CR_SURFACE_DESIRED_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) != height)
<a id='L5881' name='L5881'></a>  5881     <em class='brace'>{</em>
<a id='L5882' name='L5882'></a>  5882       <a href='../S/2289.html#L5867' title='Defined at 5867 in src/xterm.c.'>x_cr_destroy_frame_context</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L5883' name='L5883'></a>  5883       <a href='../D/2283.html' title='Multiple defined in 2 places.'>FRAME_CR_SURFACE_DESIRED_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = width;
<a id='L5884' name='L5884'></a>  5884       <a href='../D/2282.html' title='Multiple defined in 2 places.'>FRAME_CR_SURFACE_DESIRED_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = height;
<a id='L5885' name='L5885'></a>  5885     <em class='brace'>}</em>
<a id='L5886' name='L5886'></a>  5886 <em class='brace'>}</em>
<a id='L5887' name='L5887'></a>  5887 
<a id='L5888' name='L5888'></a>  5888 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L5889' name='L5889'></a>  5889 <a href='../R/18098.html' title='Multiple referred from 3 places.'>x_cr_gc_clip</a> (cairo_t *cr, <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/2619.html' title='Multiple defined in 2 places.'>GC</a> gc)
<a id='L5890' name='L5890'></a>  5890 <em class='brace'>{</em>
<a id='L5891' name='L5891'></a>  5891   <strong class='reserved'>if</strong> (gc)
<a id='L5892' name='L5892'></a>  5892     <em class='brace'>{</em>
<a id='L5893' name='L5893'></a>  5893       <strong class='reserved'>struct</strong> <a href='../S/2212.html#L199' title='Defined at 199 in src/xterm.h.'>x_gc_ext_data</a> *gc_ext = <a href='../S/2289.html#L5259' title='Defined at 5259 in src/xterm.c.'>x_gc_get_ext_data</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, 0);
<a id='L5894' name='L5894'></a>  5894 
<a id='L5895' name='L5895'></a>  5895       <strong class='reserved'>if</strong> (gc_ext &amp;&amp; gc_ext-&gt;n_clip_rects)
<a id='L5896' name='L5896'></a>  5896         <em class='brace'>{</em>
<a id='L5897' name='L5897'></a>  5897           <strong class='reserved'>for</strong> (<strong class='reserved'>int</strong> i = 0; i &lt; gc_ext-&gt;n_clip_rects; i++)
<a id='L5898' name='L5898'></a>  5898             cairo_rectangle (cr, gc_ext-&gt;clip_rects[i].<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>,
<a id='L5899' name='L5899'></a>  5899                              gc_ext-&gt;clip_rects[i].y,
<a id='L5900' name='L5900'></a>  5900                              gc_ext-&gt;clip_rects[i].width,
<a id='L5901' name='L5901'></a>  5901                              gc_ext-&gt;clip_rects[i].height);
<a id='L5902' name='L5902'></a>  5902           cairo_clip (cr);
<a id='L5903' name='L5903'></a>  5903         <em class='brace'>}</em>
<a id='L5904' name='L5904'></a>  5904     <em class='brace'>}</em>
<a id='L5905' name='L5905'></a>  5905 <em class='brace'>}</em>
<a id='L5906' name='L5906'></a>  5906 
<a id='L5907' name='L5907'></a>  5907 cairo_t *
<a id='L5908' name='L5908'></a>  5908 <a href='../R/18053.html' title='Multiple referred from 11 places.'>x_begin_cr_clip</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/2619.html' title='Multiple defined in 2 places.'>GC</a> gc)
<a id='L5909' name='L5909'></a>  5909 <em class='brace'>{</em>
<a id='L5910' name='L5910'></a>  5910   cairo_t *cr = <a href='../D/2280.html' title='Multiple defined in 3 places.'>FRAME_CR_CONTEXT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L5911' name='L5911'></a>  5911 
<a id='L5912' name='L5912'></a>  5912   <strong class='reserved'>if</strong> (!cr)
<a id='L5913' name='L5913'></a>  5913     <em class='brace'>{</em>
<a id='L5914' name='L5914'></a>  5914       <strong class='reserved'>int</strong> width = <a href='../D/2283.html' title='Multiple defined in 2 places.'>FRAME_CR_SURFACE_DESIRED_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L5915' name='L5915'></a>  5915       <strong class='reserved'>int</strong> height = <a href='../D/2282.html' title='Multiple defined in 2 places.'>FRAME_CR_SURFACE_DESIRED_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L5916' name='L5916'></a>  5916       cairo_surface_t *surface;
<a id='L5917' name='L5917'></a>  5917 <em class='sharp'>#ifdef</em> <a href='../S/2289.html#L798' title='Defined at 798 in src/xterm.c.'>USE_CAIRO_XCB_SURFACE</a>
<a id='L5918' name='L5918'></a>  5918       <strong class='reserved'>if</strong> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;xcb_visual)
<a id='L5919' name='L5919'></a>  5919         surface = cairo_xcb_surface_create (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;xcb_connection,
<a id='L5920' name='L5920'></a>  5920                                             (xcb_drawable_t) <a href='../S/2212.html#L1344' title='Defined at 1344 in src/xterm.h.'>FRAME_X_RAW_DRAWABLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L5921' name='L5921'></a>  5921                                             <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;xcb_visual,
<a id='L5922' name='L5922'></a>  5922                                             width, height);
<a id='L5923' name='L5923'></a>  5923       <strong class='reserved'>else</strong>
<a id='L5924' name='L5924'></a>  5924 <em class='sharp'>#endif</em>
<a id='L5925' name='L5925'></a>  5925         surface = cairo_xlib_surface_create (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L5926' name='L5926'></a>  5926                                              <a href='../S/2212.html#L1344' title='Defined at 1344 in src/xterm.h.'>FRAME_X_RAW_DRAWABLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L5927' name='L5927'></a>  5927                                              <a href='../S/2212.html#L1434' title='Defined at 1434 in src/xterm.h.'>FRAME_X_VISUAL</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L5928' name='L5928'></a>  5928                                              width, height);
<a id='L5929' name='L5929'></a>  5929 
<a id='L5930' name='L5930'></a>  5930       cr = <a href='../D/2280.html' title='Multiple defined in 3 places.'>FRAME_CR_CONTEXT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = cairo_create (surface);
<a id='L5931' name='L5931'></a>  5931       cairo_surface_destroy (surface);
<a id='L5932' name='L5932'></a>  5932     <em class='brace'>}</em>
<a id='L5933' name='L5933'></a>  5933   cairo_save (cr);
<a id='L5934' name='L5934'></a>  5934   <a href='../S/2289.html#L5889' title='Defined at 5889 in src/xterm.c.'>x_cr_gc_clip</a> (cr, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc);
<a id='L5935' name='L5935'></a>  5935 
<a id='L5936' name='L5936'></a>  5936   <strong class='reserved'>return</strong> cr;
<a id='L5937' name='L5937'></a>  5937 <em class='brace'>}</em>
<a id='L5938' name='L5938'></a>  5938 
<a id='L5939' name='L5939'></a>  5939 <strong class='reserved'>void</strong>
<a id='L5940' name='L5940'></a>  5940 <a href='../R/18175.html' title='Multiple referred from 11 places.'>x_end_cr_clip</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L5941' name='L5941'></a>  5941 <em class='brace'>{</em>
<a id='L5942' name='L5942'></a>  5942   cairo_restore (<a href='../D/2280.html' title='Multiple defined in 3 places.'>FRAME_CR_CONTEXT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L5943' name='L5943'></a>  5943 <em class='sharp'>#ifdef</em> HAVE_XDBE
<a id='L5944' name='L5944'></a>  5944   <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1356' title='Defined at 1356 in src/xterm.h.'>FRAME_X_DOUBLE_BUFFERED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L5945' name='L5945'></a>  5945     <a href='../S/2296.html#L3928' title='Defined at 3928 in src/xfns.c.'>x_mark_frame_dirty</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L5946' name='L5946'></a>  5946 <em class='sharp'>#endif</em>
<a id='L5947' name='L5947'></a>  5947 <em class='brace'>}</em>
<a id='L5948' name='L5948'></a>  5948 
<a id='L5949' name='L5949'></a>  5949 <strong class='reserved'>void</strong>
<a id='L5950' name='L5950'></a>  5950 <a href='../R/18298.html' title='Multiple referred from 8 places.'>x_set_cr_source_with_gc_foreground</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/2619.html' title='Multiple defined in 2 places.'>GC</a> gc,
<a id='L5951' name='L5951'></a>  5951                                     <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> respect_alpha_background)
<a id='L5952' name='L5952'></a>  5952 <em class='brace'>{</em>
<a id='L5953' name='L5953'></a>  5953   XGCValues xgcv;
<a id='L5954' name='L5954'></a>  5954   <a href='../D/7038.html' title='Multiple defined in 2 places.'>XColor</a> color;
<a id='L5955' name='L5955'></a>  5955   <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> depth;
<a id='L5956' name='L5956'></a>  5956 
<a id='L5957' name='L5957'></a>  5957   <a href='../S/2215.html#L271' title='Defined at 271 in src/w32term.c.'>XGetGCValues</a> (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), gc, <a href='../S/2315.html#L89' title='Defined at 89 in src/dispextern.h.'>GCForeground</a>, &amp;xgcv);
<a id='L5958' name='L5958'></a>  5958   color.pixel = xgcv.foreground;
<a id='L5959' name='L5959'></a>  5959   <a href='../S/2289.html#L8972' title='Defined at 8972 in src/xterm.c.'>x_query_colors</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, &amp;color, 1);
<a id='L5960' name='L5960'></a>  5960   depth = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;n_planes;
<a id='L5961' name='L5961'></a>  5961 
<a id='L5962' name='L5962'></a>  5962   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;alpha_background &lt; 1.0 &amp;&amp; depth == 32
<a id='L5963' name='L5963'></a>  5963       &amp;&amp; respect_alpha_background)
<a id='L5964' name='L5964'></a>  5964     <em class='brace'>{</em>
<a id='L5965' name='L5965'></a>  5965       cairo_set_source_rgba (<a href='../D/2280.html' title='Multiple defined in 3 places.'>FRAME_CR_CONTEXT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), color.red / 65535.0,
<a id='L5966' name='L5966'></a>  5966                              color.green / 65535.0, color.blue / 65535.0,
<a id='L5967' name='L5967'></a>  5967                              <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;alpha_background);
<a id='L5968' name='L5968'></a>  5968 
<a id='L5969' name='L5969'></a>  5969       cairo_set_operator (<a href='../D/2280.html' title='Multiple defined in 3 places.'>FRAME_CR_CONTEXT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), CAIRO_OPERATOR_SOURCE);
<a id='L5970' name='L5970'></a>  5970     <em class='brace'>}</em>
<a id='L5971' name='L5971'></a>  5971   <strong class='reserved'>else</strong>
<a id='L5972' name='L5972'></a>  5972     <em class='brace'>{</em>
<a id='L5973' name='L5973'></a>  5973       cairo_set_source_rgb (<a href='../D/2280.html' title='Multiple defined in 3 places.'>FRAME_CR_CONTEXT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), color.red / 65535.0,
<a id='L5974' name='L5974'></a>  5974                             color.green / 65535.0, color.blue / 65535.0);
<a id='L5975' name='L5975'></a>  5975       cairo_set_operator (<a href='../D/2280.html' title='Multiple defined in 3 places.'>FRAME_CR_CONTEXT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), CAIRO_OPERATOR_OVER);
<a id='L5976' name='L5976'></a>  5976     <em class='brace'>}</em>
<a id='L5977' name='L5977'></a>  5977 <em class='brace'>}</em>
<a id='L5978' name='L5978'></a>  5978 
<a id='L5979' name='L5979'></a>  5979 <strong class='reserved'>void</strong>
<a id='L5980' name='L5980'></a>  5980 <a href='../R/18297.html' title='Multiple referred from 8 places.'>x_set_cr_source_with_gc_background</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/2619.html' title='Multiple defined in 2 places.'>GC</a> gc,
<a id='L5981' name='L5981'></a>  5981                                     <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> respect_alpha_background)
<a id='L5982' name='L5982'></a>  5982 <em class='brace'>{</em>
<a id='L5983' name='L5983'></a>  5983   XGCValues xgcv;
<a id='L5984' name='L5984'></a>  5984   <a href='../D/7038.html' title='Multiple defined in 2 places.'>XColor</a> color;
<a id='L5985' name='L5985'></a>  5985   <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> depth;
<a id='L5986' name='L5986'></a>  5986 
<a id='L5987' name='L5987'></a>  5987   <a href='../S/2215.html#L271' title='Defined at 271 in src/w32term.c.'>XGetGCValues</a> (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), gc, <a href='../S/2315.html#L90' title='Defined at 90 in src/dispextern.h.'>GCBackground</a>, &amp;xgcv);
<a id='L5988' name='L5988'></a>  5988   color.pixel = xgcv.background;
<a id='L5989' name='L5989'></a>  5989 
<a id='L5990' name='L5990'></a>  5990   <a href='../S/2289.html#L8972' title='Defined at 8972 in src/xterm.c.'>x_query_colors</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, &amp;color, 1);
<a id='L5991' name='L5991'></a>  5991 
<a id='L5992' name='L5992'></a>  5992   depth = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;n_planes;
<a id='L5993' name='L5993'></a>  5993 
<a id='L5994' name='L5994'></a>  5994   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;alpha_background &lt; 1.0 &amp;&amp; depth == 32
<a id='L5995' name='L5995'></a>  5995       &amp;&amp; respect_alpha_background)
<a id='L5996' name='L5996'></a>  5996     <em class='brace'>{</em>
<a id='L5997' name='L5997'></a>  5997       cairo_set_source_rgba (<a href='../D/2280.html' title='Multiple defined in 3 places.'>FRAME_CR_CONTEXT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), color.red / 65535.0,
<a id='L5998' name='L5998'></a>  5998                              color.green / 65535.0, color.blue / 65535.0,
<a id='L5999' name='L5999'></a>  5999                              <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;alpha_background);
<a id='L6000' name='L6000'></a>  6000 
<a id='L6001' name='L6001'></a>  6001       cairo_set_operator (<a href='../D/2280.html' title='Multiple defined in 3 places.'>FRAME_CR_CONTEXT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), CAIRO_OPERATOR_SOURCE);
<a id='L6002' name='L6002'></a>  6002     <em class='brace'>}</em>
<a id='L6003' name='L6003'></a>  6003   <strong class='reserved'>else</strong>
<a id='L6004' name='L6004'></a>  6004     <em class='brace'>{</em>
<a id='L6005' name='L6005'></a>  6005       cairo_set_source_rgb (<a href='../D/2280.html' title='Multiple defined in 3 places.'>FRAME_CR_CONTEXT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), color.red / 65535.0,
<a id='L6006' name='L6006'></a>  6006                             color.green / 65535.0, color.blue / 65535.0);
<a id='L6007' name='L6007'></a>  6007       cairo_set_operator (<a href='../D/2280.html' title='Multiple defined in 3 places.'>FRAME_CR_CONTEXT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), CAIRO_OPERATOR_OVER);
<a id='L6008' name='L6008'></a>  6008     <em class='brace'>}</em>
<a id='L6009' name='L6009'></a>  6009 <em class='brace'>}</em>
<a id='L6010' name='L6010'></a>  6010 
<a id='L6011' name='L6011'></a>  6011 <strong class='reserved'>static</strong> <strong class='reserved'>const</strong> cairo_user_data_key_t xlib_surface_key, saved_drawable_key;
<a id='L6012' name='L6012'></a>  6012 
<a id='L6013' name='L6013'></a>  6013 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L6014' name='L6014'></a>  6014 <a href='../S/2289.html#L6068' title='Referred from 6068 in src/xterm.c.'>x_cr_destroy_xlib_surface</a> (cairo_surface_t *xlib_surface)
<a id='L6015' name='L6015'></a>  6015 <em class='brace'>{</em>
<a id='L6016' name='L6016'></a>  6016   <strong class='reserved'>if</strong> (xlib_surface)
<a id='L6017' name='L6017'></a>  6017     <em class='brace'>{</em>
<a id='L6018' name='L6018'></a>  6018       XFreePixmap (cairo_xlib_surface_get_display (xlib_surface),
<a id='L6019' name='L6019'></a>  6019                    cairo_xlib_surface_get_drawable (xlib_surface));
<a id='L6020' name='L6020'></a>  6020       cairo_surface_destroy (xlib_surface);
<a id='L6021' name='L6021'></a>  6021     <em class='brace'>}</em>
<a id='L6022' name='L6022'></a>  6022 <em class='brace'>}</em>
<a id='L6023' name='L6023'></a>  6023 
<a id='L6024' name='L6024'></a>  6024 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L6025' name='L6025'></a>  6025 <a href='../R/18362.html' title='Multiple referred from 2 places.'>x_try_cr_xlib_drawable</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/2619.html' title='Multiple defined in 2 places.'>GC</a> gc)
<a id='L6026' name='L6026'></a>  6026 <em class='brace'>{</em>
<a id='L6027' name='L6027'></a>  6027   cairo_t *cr = <a href='../D/2280.html' title='Multiple defined in 3 places.'>FRAME_CR_CONTEXT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L6028' name='L6028'></a>  6028   <strong class='reserved'>if</strong> (!cr)
<a id='L6029' name='L6029'></a>  6029     <strong class='reserved'>return</strong> <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L6030' name='L6030'></a>  6030 
<a id='L6031' name='L6031'></a>  6031   cairo_surface_t *surface = cairo_get_target (cr);
<a id='L6032' name='L6032'></a>  6032   <strong class='reserved'>switch</strong> (cairo_surface_get_type (surface))
<a id='L6033' name='L6033'></a>  6033     <em class='brace'>{</em>
<a id='L6034' name='L6034'></a>  6034     <strong class='reserved'>case</strong> CAIRO_SURFACE_TYPE_XLIB:
<a id='L6035' name='L6035'></a>  6035 <em class='sharp'>#ifdef</em> <a href='../S/2289.html#L798' title='Defined at 798 in src/xterm.c.'>USE_CAIRO_XCB_SURFACE</a>
<a id='L6036' name='L6036'></a>  6036     <strong class='reserved'>case</strong> CAIRO_SURFACE_TYPE_XCB:
<a id='L6037' name='L6037'></a>  6037 <em class='sharp'>#endif</em>
<a id='L6038' name='L6038'></a>  6038       cairo_surface_flush (surface);
<a id='L6039' name='L6039'></a>  6039       <strong class='reserved'>return</strong> <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L6040' name='L6040'></a>  6040 
<a id='L6041' name='L6041'></a>  6041     <strong class='reserved'>case</strong> CAIRO_SURFACE_TYPE_IMAGE:
<a id='L6042' name='L6042'></a>  6042       <strong class='reserved'>break</strong>;
<a id='L6043' name='L6043'></a>  6043 
<a id='L6044' name='L6044'></a>  6044     <strong class='reserved'>default</strong>:
<a id='L6045' name='L6045'></a>  6045       <strong class='reserved'>return</strong> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L6046' name='L6046'></a>  6046     <em class='brace'>}</em>
<a id='L6047' name='L6047'></a>  6047 
<a id='L6048' name='L6048'></a>  6048   <em class='comment'>/* FRAME_CR_CONTEXT (f) is an image surface we can not draw into</em>
<a id='L6049' name='L6049'></a>  6049 <em class='comment'>     directly with Xlib.  Set up a Pixmap so we can copy back the</em>
<a id='L6050' name='L6050'></a>  6050 <em class='comment'>     result later in x_end_cr_xlib_drawable.  */</em>
<a id='L6051' name='L6051'></a>  6051   cairo_surface_t *xlib_surface = cairo_get_user_data (cr, &amp;xlib_surface_key);
<a id='L6052' name='L6052'></a>  6052   <strong class='reserved'>int</strong> width = <a href='../D/2283.html' title='Multiple defined in 2 places.'>FRAME_CR_SURFACE_DESIRED_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L6053' name='L6053'></a>  6053   <strong class='reserved'>int</strong> height = <a href='../D/2282.html' title='Multiple defined in 2 places.'>FRAME_CR_SURFACE_DESIRED_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L6054' name='L6054'></a>  6054   <a href='../D/5058.html' title='Multiple defined in 2 places.'>Pixmap</a> pixmap;
<a id='L6055' name='L6055'></a>  6055   <strong class='reserved'>if</strong> (xlib_surface
<a id='L6056' name='L6056'></a>  6056       &amp;&amp; cairo_xlib_surface_get_width (xlib_surface) == width
<a id='L6057' name='L6057'></a>  6057       &amp;&amp; cairo_xlib_surface_get_height (xlib_surface) == height)
<a id='L6058' name='L6058'></a>  6058     pixmap = cairo_xlib_surface_get_drawable (xlib_surface);
<a id='L6059' name='L6059'></a>  6059   <strong class='reserved'>else</strong>
<a id='L6060' name='L6060'></a>  6060     <em class='brace'>{</em>
<a id='L6061' name='L6061'></a>  6061       pixmap = XCreatePixmap (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../S/2212.html#L1344' title='Defined at 1344 in src/xterm.h.'>FRAME_X_RAW_DRAWABLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L6062' name='L6062'></a>  6062                               width, height,
<a id='L6063' name='L6063'></a>  6063                               DefaultDepthOfScreen (<a href='../S/2212.html#L1428' title='Defined at 1428 in src/xterm.h.'>FRAME_X_SCREEN</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)));
<a id='L6064' name='L6064'></a>  6064       xlib_surface = cairo_xlib_surface_create (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L6065' name='L6065'></a>  6065                                                 pixmap, <a href='../S/2212.html#L1434' title='Defined at 1434 in src/xterm.h.'>FRAME_X_VISUAL</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L6066' name='L6066'></a>  6066                                                 width, height);
<a id='L6067' name='L6067'></a>  6067       cairo_set_user_data (cr, &amp;xlib_surface_key, xlib_surface,
<a id='L6068' name='L6068'></a>  6068                            (cairo_destroy_func_t) <a href='../S/2289.html#L6014' title='Defined at 6014 in src/xterm.c.'>x_cr_destroy_xlib_surface</a>);
<a id='L6069' name='L6069'></a>  6069     <em class='brace'>}</em>
<a id='L6070' name='L6070'></a>  6070 
<a id='L6071' name='L6071'></a>  6071   cairo_t *buf = cairo_create (xlib_surface);
<a id='L6072' name='L6072'></a>  6072   cairo_set_source_surface (buf, surface, 0, 0);
<a id='L6073' name='L6073'></a>  6073   cairo_matrix_t matrix;
<a id='L6074' name='L6074'></a>  6074   cairo_get_matrix (cr, &amp;matrix);
<a id='L6075' name='L6075'></a>  6075   cairo_pattern_set_matrix (cairo_get_source (cr), &amp;matrix);
<a id='L6076' name='L6076'></a>  6076   cairo_set_operator (buf, CAIRO_OPERATOR_SOURCE);
<a id='L6077' name='L6077'></a>  6077   <a href='../S/2289.html#L5889' title='Defined at 5889 in src/xterm.c.'>x_cr_gc_clip</a> (buf, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc);
<a id='L6078' name='L6078'></a>  6078   cairo_paint (buf);
<a id='L6079' name='L6079'></a>  6079   cairo_destroy (buf);
<a id='L6080' name='L6080'></a>  6080 
<a id='L6081' name='L6081'></a>  6081   cairo_set_user_data (cr, &amp;saved_drawable_key,
<a id='L6082' name='L6082'></a>  6082                        (<strong class='reserved'>void</strong> *) (<a href='../D/18604.html' title='Multiple defined in 2 places.'>uintptr_t</a>) <a href='../S/2212.html#L1344' title='Defined at 1344 in src/xterm.h.'>FRAME_X_RAW_DRAWABLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L6083' name='L6083'></a>  6083   <a href='../S/2212.html#L1344' title='Defined at 1344 in src/xterm.h.'>FRAME_X_RAW_DRAWABLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = pixmap;
<a id='L6084' name='L6084'></a>  6084   cairo_surface_flush (xlib_surface);
<a id='L6085' name='L6085'></a>  6085 
<a id='L6086' name='L6086'></a>  6086   <strong class='reserved'>return</strong> <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L6087' name='L6087'></a>  6087 <em class='brace'>}</em>
<a id='L6088' name='L6088'></a>  6088 
<a id='L6089' name='L6089'></a>  6089 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L6090' name='L6090'></a>  6090 <a href='../R/18176.html' title='Multiple referred from 2 places.'>x_end_cr_xlib_drawable</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/2619.html' title='Multiple defined in 2 places.'>GC</a> gc)
<a id='L6091' name='L6091'></a>  6091 <em class='brace'>{</em>
<a id='L6092' name='L6092'></a>  6092   cairo_t *cr = <a href='../D/2280.html' title='Multiple defined in 3 places.'>FRAME_CR_CONTEXT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L6093' name='L6093'></a>  6093   <strong class='reserved'>if</strong> (!cr)
<a id='L6094' name='L6094'></a>  6094     <strong class='reserved'>return</strong>;
<a id='L6095' name='L6095'></a>  6095 
<a id='L6096' name='L6096'></a>  6096   <a href='../D/1653.html' title='Multiple defined in 2 places.'>Drawable</a> saved_drawable
<a id='L6097' name='L6097'></a>  6097     = (<a href='../D/18604.html' title='Multiple defined in 2 places.'>uintptr_t</a>) cairo_get_user_data (cr, &amp;saved_drawable_key);
<a id='L6098' name='L6098'></a>  6098   cairo_surface_t *surface = (saved_drawable
<a id='L6099' name='L6099'></a>  6099                               ? cairo_get_user_data (cr, &amp;xlib_surface_key)
<a id='L6100' name='L6100'></a>  6100                               : cairo_get_target (cr));
<a id='L6101' name='L6101'></a>  6101   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L199' title='Defined at 199 in src/xterm.h.'>x_gc_ext_data</a> *gc_ext = <a href='../S/2289.html#L5259' title='Defined at 5259 in src/xterm.c.'>x_gc_get_ext_data</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, 0);
<a id='L6102' name='L6102'></a>  6102   <strong class='reserved'>if</strong> (gc_ext &amp;&amp; gc_ext-&gt;n_clip_rects)
<a id='L6103' name='L6103'></a>  6103     <strong class='reserved'>for</strong> (<strong class='reserved'>int</strong> i = 0; i &lt; gc_ext-&gt;n_clip_rects; i++)
<a id='L6104' name='L6104'></a>  6104       cairo_surface_mark_dirty_rectangle (surface, gc_ext-&gt;clip_rects[i].<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>,
<a id='L6105' name='L6105'></a>  6105                                           gc_ext-&gt;clip_rects[i].y,
<a id='L6106' name='L6106'></a>  6106                                           gc_ext-&gt;clip_rects[i].width,
<a id='L6107' name='L6107'></a>  6107                                           gc_ext-&gt;clip_rects[i].height);
<a id='L6108' name='L6108'></a>  6108   <strong class='reserved'>else</strong>
<a id='L6109' name='L6109'></a>  6109     cairo_surface_mark_dirty (surface);
<a id='L6110' name='L6110'></a>  6110   <strong class='reserved'>if</strong> (!saved_drawable)
<a id='L6111' name='L6111'></a>  6111     <strong class='reserved'>return</strong>;
<a id='L6112' name='L6112'></a>  6112 
<a id='L6113' name='L6113'></a>  6113   cairo_save (cr);
<a id='L6114' name='L6114'></a>  6114   cairo_set_source_surface (cr, surface, 0, 0);
<a id='L6115' name='L6115'></a>  6115   cairo_set_operator (cr, CAIRO_OPERATOR_SOURCE);
<a id='L6116' name='L6116'></a>  6116   <a href='../S/2289.html#L5889' title='Defined at 5889 in src/xterm.c.'>x_cr_gc_clip</a> (cr, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc);
<a id='L6117' name='L6117'></a>  6117   cairo_paint (cr);
<a id='L6118' name='L6118'></a>  6118   cairo_restore (cr);
<a id='L6119' name='L6119'></a>  6119 
<a id='L6120' name='L6120'></a>  6120   <a href='../S/2212.html#L1344' title='Defined at 1344 in src/xterm.h.'>FRAME_X_RAW_DRAWABLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = saved_drawable;
<a id='L6121' name='L6121'></a>  6121   cairo_set_user_data (cr, &amp;saved_drawable_key, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L6122' name='L6122'></a>  6122 <em class='brace'>}</em>
<a id='L6123' name='L6123'></a>  6123 
<a id='L6124' name='L6124'></a>  6124 <em class='comment'>/* Fringe bitmaps.  */</em>
<a id='L6125' name='L6125'></a>  6125 
<a id='L6126' name='L6126'></a>  6126 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong> max_fringe_bmp = 0;
<a id='L6127' name='L6127'></a>  6127 <strong class='reserved'>static</strong> cairo_pattern_t **fringe_bmp = 0;
<a id='L6128' name='L6128'></a>  6128 
<a id='L6129' name='L6129'></a>  6129 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L6130' name='L6130'></a>  6130 <a href='../S/2289.html#L31327' title='Referred from 31327 in src/xterm.c.'>x_cr_define_fringe_bitmap</a> (<strong class='reserved'>int</strong> which, <strong class='reserved'>unsigned</strong> <strong class='reserved'>short</strong> *<a href='../S/2358.html#L1062' title='Defined at 1062 in src/emacs-module.c.'>bits</a>, <strong class='reserved'>int</strong> h, <strong class='reserved'>int</strong> wd)
<a id='L6131' name='L6131'></a>  6131 <em class='brace'>{</em>
<a id='L6132' name='L6132'></a>  6132   <strong class='reserved'>int</strong> i, stride;
<a id='L6133' name='L6133'></a>  6133   cairo_surface_t *surface;
<a id='L6134' name='L6134'></a>  6134   cairo_pattern_t *pattern;
<a id='L6135' name='L6135'></a>  6135   <strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *data;
<a id='L6136' name='L6136'></a>  6136 
<a id='L6137' name='L6137'></a>  6137   <strong class='reserved'>if</strong> (which &gt;= max_fringe_bmp)
<a id='L6138' name='L6138'></a>  6138     <em class='brace'>{</em>
<a id='L6139' name='L6139'></a>  6139       i = max_fringe_bmp;
<a id='L6140' name='L6140'></a>  6140       max_fringe_bmp = which + 20;
<a id='L6141' name='L6141'></a>  6141       fringe_bmp = <a href='../D/20107.html' title='Multiple defined in 7 places.'>xrealloc</a> (fringe_bmp, max_fringe_bmp * <strong class='reserved'>sizeof</strong> (*fringe_bmp));
<a id='L6142' name='L6142'></a>  6142       <strong class='reserved'>while</strong> (i &lt; max_fringe_bmp)
<a id='L6143' name='L6143'></a>  6143         fringe_bmp[i++] = 0;
<a id='L6144' name='L6144'></a>  6144     <em class='brace'>}</em>
<a id='L6145' name='L6145'></a>  6145 
<a id='L6146' name='L6146'></a>  6146   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L6147' name='L6147'></a>  6147 
<a id='L6148' name='L6148'></a>  6148   surface = cairo_image_surface_create (CAIRO_FORMAT_A1, wd, h);
<a id='L6149' name='L6149'></a>  6149   stride = cairo_image_surface_get_stride (surface);
<a id='L6150' name='L6150'></a>  6150   data = cairo_image_surface_get_data (surface);
<a id='L6151' name='L6151'></a>  6151 
<a id='L6152' name='L6152'></a>  6152   <strong class='reserved'>for</strong> (i = 0; i &lt; h; i++)
<a id='L6153' name='L6153'></a>  6153     <em class='brace'>{</em>
<a id='L6154' name='L6154'></a>  6154       *((<strong class='reserved'>unsigned</strong> <strong class='reserved'>short</strong> *) data) = <a href='../S/2358.html#L1062' title='Defined at 1062 in src/emacs-module.c.'>bits</a>[i];
<a id='L6155' name='L6155'></a>  6155       data += stride;
<a id='L6156' name='L6156'></a>  6156     <em class='brace'>}</em>
<a id='L6157' name='L6157'></a>  6157 
<a id='L6158' name='L6158'></a>  6158   cairo_surface_mark_dirty (surface);
<a id='L6159' name='L6159'></a>  6159   pattern = cairo_pattern_create_for_surface (surface);
<a id='L6160' name='L6160'></a>  6160   cairo_surface_destroy (surface);
<a id='L6161' name='L6161'></a>  6161 
<a id='L6162' name='L6162'></a>  6162   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L6163' name='L6163'></a>  6163 
<a id='L6164' name='L6164'></a>  6164   fringe_bmp[which] = pattern;
<a id='L6165' name='L6165'></a>  6165 <em class='brace'>}</em>
<a id='L6166' name='L6166'></a>  6166 
<a id='L6167' name='L6167'></a>  6167 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L6168' name='L6168'></a>  6168 <a href='../S/2289.html#L31328' title='Referred from 31328 in src/xterm.c.'>x_cr_destroy_fringe_bitmap</a> (<strong class='reserved'>int</strong> which)
<a id='L6169' name='L6169'></a>  6169 <em class='brace'>{</em>
<a id='L6170' name='L6170'></a>  6170   <strong class='reserved'>if</strong> (which &gt;= max_fringe_bmp)
<a id='L6171' name='L6171'></a>  6171     <strong class='reserved'>return</strong>;
<a id='L6172' name='L6172'></a>  6172 
<a id='L6173' name='L6173'></a>  6173   <strong class='reserved'>if</strong> (fringe_bmp[which])
<a id='L6174' name='L6174'></a>  6174     <em class='brace'>{</em>
<a id='L6175' name='L6175'></a>  6175       <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L6176' name='L6176'></a>  6176       cairo_pattern_destroy (fringe_bmp[which]);
<a id='L6177' name='L6177'></a>  6177       <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L6178' name='L6178'></a>  6178     <em class='brace'>}</em>
<a id='L6179' name='L6179'></a>  6179   fringe_bmp[which] = 0;
<a id='L6180' name='L6180'></a>  6180 <em class='brace'>}</em>
<a id='L6181' name='L6181'></a>  6181 
<a id='L6182' name='L6182'></a>  6182 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L6183' name='L6183'></a>  6183 <a href='../R/18096.html' title='Multiple referred from 2 places.'>x_cr_draw_image</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/2619.html' title='Multiple defined in 2 places.'>GC</a> gc, cairo_pattern_t *<a href='../S/2315.html#L3110' title='Defined at 3110 in src/dispextern.h.'>image</a>,
<a id='L6184' name='L6184'></a>  6184                  <strong class='reserved'>int</strong> src_x, <strong class='reserved'>int</strong> src_y, <strong class='reserved'>int</strong> width, <strong class='reserved'>int</strong> height,
<a id='L6185' name='L6185'></a>  6185                  <strong class='reserved'>int</strong> dest_x, <strong class='reserved'>int</strong> dest_y, <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> overlay_p)
<a id='L6186' name='L6186'></a>  6186 <em class='brace'>{</em>
<a id='L6187' name='L6187'></a>  6187   cairo_t *cr = <a href='../S/2289.html#L5908' title='Defined at 5908 in src/xterm.c.'>x_begin_cr_clip</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc);
<a id='L6188' name='L6188'></a>  6188 
<a id='L6189' name='L6189'></a>  6189   <strong class='reserved'>if</strong> (overlay_p)
<a id='L6190' name='L6190'></a>  6190     cairo_rectangle (cr, dest_x, dest_y, width, height);
<a id='L6191' name='L6191'></a>  6191   <strong class='reserved'>else</strong>
<a id='L6192' name='L6192'></a>  6192     <em class='brace'>{</em>
<a id='L6193' name='L6193'></a>  6193       <a href='../S/2289.html#L5980' title='Defined at 5980 in src/xterm.c.'>x_set_cr_source_with_gc_background</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L6194' name='L6194'></a>  6194       cairo_rectangle (cr, dest_x, dest_y, width, height);
<a id='L6195' name='L6195'></a>  6195       cairo_fill_preserve (cr);
<a id='L6196' name='L6196'></a>  6196     <em class='brace'>}</em>
<a id='L6197' name='L6197'></a>  6197 
<a id='L6198' name='L6198'></a>  6198   cairo_translate (cr, dest_x - src_x, dest_y - src_y);
<a id='L6199' name='L6199'></a>  6199 
<a id='L6200' name='L6200'></a>  6200   cairo_surface_t *surface;
<a id='L6201' name='L6201'></a>  6201   cairo_pattern_get_surface (<a href='../S/2315.html#L3110' title='Defined at 3110 in src/dispextern.h.'>image</a>, &amp;surface);
<a id='L6202' name='L6202'></a>  6202   cairo_format_t format = cairo_image_surface_get_format (surface);
<a id='L6203' name='L6203'></a>  6203   <strong class='reserved'>if</strong> (format != CAIRO_FORMAT_A8 &amp;&amp; format != CAIRO_FORMAT_A1)
<a id='L6204' name='L6204'></a>  6204     <em class='brace'>{</em>
<a id='L6205' name='L6205'></a>  6205       cairo_set_source (cr, <a href='../S/2315.html#L3110' title='Defined at 3110 in src/dispextern.h.'>image</a>);
<a id='L6206' name='L6206'></a>  6206       cairo_fill (cr);
<a id='L6207' name='L6207'></a>  6207     <em class='brace'>}</em>
<a id='L6208' name='L6208'></a>  6208   <strong class='reserved'>else</strong>
<a id='L6209' name='L6209'></a>  6209     <em class='brace'>{</em>
<a id='L6210' name='L6210'></a>  6210       <a href='../S/2289.html#L5950' title='Defined at 5950 in src/xterm.c.'>x_set_cr_source_with_gc_foreground</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L6211' name='L6211'></a>  6211       cairo_clip (cr);
<a id='L6212' name='L6212'></a>  6212       cairo_mask (cr, <a href='../S/2315.html#L3110' title='Defined at 3110 in src/dispextern.h.'>image</a>);
<a id='L6213' name='L6213'></a>  6213     <em class='brace'>}</em>
<a id='L6214' name='L6214'></a>  6214 
<a id='L6215' name='L6215'></a>  6215   <a href='../S/2289.html#L5940' title='Defined at 5940 in src/xterm.c.'>x_end_cr_clip</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L6216' name='L6216'></a>  6216 <em class='brace'>}</em>
<a id='L6217' name='L6217'></a>  6217 
<a id='L6218' name='L6218'></a>  6218 <strong class='reserved'>void</strong>
<a id='L6219' name='L6219'></a>  6219 <a href='../R/18095.html' title='Multiple referred from 2 places.'>x_cr_draw_frame</a> (cairo_t *cr, <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L6220' name='L6220'></a>  6220 <em class='brace'>{</em>
<a id='L6221' name='L6221'></a>  6221   <strong class='reserved'>int</strong> width, height;
<a id='L6222' name='L6222'></a>  6222 
<a id='L6223' name='L6223'></a>  6223   width = <a href='../S/2183.html#L1051' title='Defined at 1051 in src/frame.h.'>FRAME_PIXEL_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L6224' name='L6224'></a>  6224   height = <a href='../S/2183.html#L1052' title='Defined at 1052 in src/frame.h.'>FRAME_PIXEL_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L6225' name='L6225'></a>  6225 
<a id='L6226' name='L6226'></a>  6226   cairo_t *saved_cr = <a href='../D/2280.html' title='Multiple defined in 3 places.'>FRAME_CR_CONTEXT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L6227' name='L6227'></a>  6227   <a href='../D/2280.html' title='Multiple defined in 3 places.'>FRAME_CR_CONTEXT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = cr;
<a id='L6228' name='L6228'></a>  6228   <a href='../S/2289.html#L11076' title='Defined at 11076 in src/xterm.c.'>x_clear_area</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 0, 0, width, height);
<a id='L6229' name='L6229'></a>  6229   <a href='../S/2224.html#L36467' title='Defined at 36467 in src/xdisp.c.'>expose_frame</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 0, 0, width, height);
<a id='L6230' name='L6230'></a>  6230   <a href='../D/2280.html' title='Multiple defined in 3 places.'>FRAME_CR_CONTEXT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = saved_cr;
<a id='L6231' name='L6231'></a>  6231 <em class='brace'>}</em>
<a id='L6232' name='L6232'></a>  6232 
<a id='L6233' name='L6233'></a>  6233 <strong class='reserved'>static</strong> cairo_status_t
<a id='L6234' name='L6234'></a>  6234 <a href='../R/18089.html' title='Multiple referred from 4 places.'>x_cr_accumulate_data</a> (<strong class='reserved'>void</strong> *closure, <strong class='reserved'>const</strong> <strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *data,
<a id='L6235' name='L6235'></a>  6235                       <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> length)
<a id='L6236' name='L6236'></a>  6236 <em class='brace'>{</em>
<a id='L6237' name='L6237'></a>  6237   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> *acc = (<a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> *) closure;
<a id='L6238' name='L6238'></a>  6238 
<a id='L6239' name='L6239'></a>  6239   *acc = Fcons (<a href='../S/2350.html#L2504' title='Defined at 2504 in src/alloc.c.'>make_unibyte_string</a> ((<strong class='reserved'>char</strong> <strong class='reserved'>const</strong> *) data, length), *acc);
<a id='L6240' name='L6240'></a>  6240 
<a id='L6241' name='L6241'></a>  6241   <strong class='reserved'>return</strong> CAIRO_STATUS_SUCCESS;
<a id='L6242' name='L6242'></a>  6242 <em class='brace'>}</em>
<a id='L6243' name='L6243'></a>  6243 
<a id='L6244' name='L6244'></a>  6244 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L6245' name='L6245'></a>  6245 <a href='../S/2289.html#L6305' title='Referred from 6305 in src/xterm.c.'>x_cr_destroy</a> (<strong class='reserved'>void</strong> *cr)
<a id='L6246' name='L6246'></a>  6246 <em class='brace'>{</em>
<a id='L6247' name='L6247'></a>  6247   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L6248' name='L6248'></a>  6248   cairo_destroy (cr);
<a id='L6249' name='L6249'></a>  6249   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L6250' name='L6250'></a>  6250 <em class='brace'>}</em>
<a id='L6251' name='L6251'></a>  6251 
<a id='L6252' name='L6252'></a>  6252 <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a>
<a id='L6253' name='L6253'></a>  6253 <a href='../R/18097.html' title='Multiple referred from 2 places.'>x_cr_export_frames</a> (<a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> frames, cairo_surface_type_t surface_type)
<a id='L6254' name='L6254'></a>  6254 <em class='brace'>{</em>
<a id='L6255' name='L6255'></a>  6255   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L6256' name='L6256'></a>  6256   cairo_surface_t *surface;
<a id='L6257' name='L6257'></a>  6257   cairo_t *cr;
<a id='L6258' name='L6258'></a>  6258   <strong class='reserved'>int</strong> width, height;
<a id='L6259' name='L6259'></a>  6259   <strong class='reserved'>void</strong> (*surface_set_size_func) (cairo_surface_t *, <strong class='reserved'>double</strong>, <strong class='reserved'>double</strong>) = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L6260' name='L6260'></a>  6260   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> acc = Qnil;
<a id='L6261' name='L6261'></a>  6261   <a href='../D/17570.html' title='Multiple defined in 2 places.'>specpdl_ref</a> count = <a href='../D/5888.html' title='Multiple defined in 2 places.'>SPECPDL_INDEX</a> ();
<a id='L6262' name='L6262'></a>  6262 
<a id='L6263' name='L6263'></a>  6263   <a href='../S/2188.html#L3480' title='Defined at 3480 in src/eval.c.'>specbind</a> (Qredisplay_dont_pause, Qt);
<a id='L6264' name='L6264'></a>  6264   <a href='../S/2224.html#L17480' title='Defined at 17480 in src/xdisp.c.'>redisplay_preserve_echo_area</a> (31);
<a id='L6265' name='L6265'></a>  6265 
<a id='L6266' name='L6266'></a>  6266   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/7021.html' title='Multiple defined in 2 places.'>XCAR</a> (frames));
<a id='L6267' name='L6267'></a>  6267   frames = <a href='../D/7022.html' title='Multiple defined in 2 places.'>XCDR</a> (frames);
<a id='L6268' name='L6268'></a>  6268   width = <a href='../S/2183.html#L1051' title='Defined at 1051 in src/frame.h.'>FRAME_PIXEL_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L6269' name='L6269'></a>  6269   height = <a href='../S/2183.html#L1052' title='Defined at 1052 in src/frame.h.'>FRAME_PIXEL_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L6270' name='L6270'></a>  6270 
<a id='L6271' name='L6271'></a>  6271   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L6272' name='L6272'></a>  6272 <em class='sharp'>#ifdef</em> CAIRO_HAS_PDF_SURFACE
<a id='L6273' name='L6273'></a>  6273   <strong class='reserved'>if</strong> (surface_type == CAIRO_SURFACE_TYPE_PDF)
<a id='L6274' name='L6274'></a>  6274     <em class='brace'>{</em>
<a id='L6275' name='L6275'></a>  6275       surface = cairo_pdf_surface_create_for_stream (<a href='../S/2289.html#L6234' title='Defined at 6234 in src/xterm.c.'>x_cr_accumulate_data</a>, &amp;acc,
<a id='L6276' name='L6276'></a>  6276                                                      width, height);
<a id='L6277' name='L6277'></a>  6277       surface_set_size_func = cairo_pdf_surface_set_size;
<a id='L6278' name='L6278'></a>  6278     <em class='brace'>}</em>
<a id='L6279' name='L6279'></a>  6279   <strong class='reserved'>else</strong>
<a id='L6280' name='L6280'></a>  6280 <em class='sharp'>#endif</em>
<a id='L6281' name='L6281'></a>  6281 <em class='sharp'>#ifdef</em> CAIRO_HAS_PNG_FUNCTIONS
<a id='L6282' name='L6282'></a>  6282   <strong class='reserved'>if</strong> (surface_type == CAIRO_SURFACE_TYPE_IMAGE)
<a id='L6283' name='L6283'></a>  6283     surface = cairo_image_surface_create (CAIRO_FORMAT_RGB24, width, height);
<a id='L6284' name='L6284'></a>  6284   <strong class='reserved'>else</strong>
<a id='L6285' name='L6285'></a>  6285 <em class='sharp'>#endif</em>
<a id='L6286' name='L6286'></a>  6286 <em class='sharp'>#ifdef</em> CAIRO_HAS_PS_SURFACE
<a id='L6287' name='L6287'></a>  6287   <strong class='reserved'>if</strong> (surface_type == CAIRO_SURFACE_TYPE_PS)
<a id='L6288' name='L6288'></a>  6288     <em class='brace'>{</em>
<a id='L6289' name='L6289'></a>  6289       surface = cairo_ps_surface_create_for_stream (<a href='../S/2289.html#L6234' title='Defined at 6234 in src/xterm.c.'>x_cr_accumulate_data</a>, &amp;acc,
<a id='L6290' name='L6290'></a>  6290                                                     width, height);
<a id='L6291' name='L6291'></a>  6291       surface_set_size_func = cairo_ps_surface_set_size;
<a id='L6292' name='L6292'></a>  6292     <em class='brace'>}</em>
<a id='L6293' name='L6293'></a>  6293   <strong class='reserved'>else</strong>
<a id='L6294' name='L6294'></a>  6294 <em class='sharp'>#endif</em>
<a id='L6295' name='L6295'></a>  6295 <em class='sharp'>#ifdef</em> CAIRO_HAS_SVG_SURFACE
<a id='L6296' name='L6296'></a>  6296   <strong class='reserved'>if</strong> (surface_type == CAIRO_SURFACE_TYPE_SVG)
<a id='L6297' name='L6297'></a>  6297     surface = cairo_svg_surface_create_for_stream (<a href='../S/2289.html#L6234' title='Defined at 6234 in src/xterm.c.'>x_cr_accumulate_data</a>, &amp;acc,
<a id='L6298' name='L6298'></a>  6298                                                    width, height);
<a id='L6299' name='L6299'></a>  6299   <strong class='reserved'>else</strong>
<a id='L6300' name='L6300'></a>  6300 <em class='sharp'>#endif</em>
<a id='L6301' name='L6301'></a>  6301     abort ();
<a id='L6302' name='L6302'></a>  6302 
<a id='L6303' name='L6303'></a>  6303   cr = cairo_create (surface);
<a id='L6304' name='L6304'></a>  6304   cairo_surface_destroy (surface);
<a id='L6305' name='L6305'></a>  6305   <a href='../S/2188.html#L3559' title='Defined at 3559 in src/eval.c.'>record_unwind_protect_ptr</a> (<a href='../S/2289.html#L6245' title='Defined at 6245 in src/xterm.c.'>x_cr_destroy</a>, cr);
<a id='L6306' name='L6306'></a>  6306 
<a id='L6307' name='L6307'></a>  6307   <strong class='reserved'>while</strong> (1)
<a id='L6308' name='L6308'></a>  6308     <em class='brace'>{</em>
<a id='L6309' name='L6309'></a>  6309       cairo_t *saved_cr = <a href='../D/2280.html' title='Multiple defined in 3 places.'>FRAME_CR_CONTEXT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L6310' name='L6310'></a>  6310       <a href='../D/2280.html' title='Multiple defined in 3 places.'>FRAME_CR_CONTEXT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = cr;
<a id='L6311' name='L6311'></a>  6311       <a href='../S/2289.html#L11076' title='Defined at 11076 in src/xterm.c.'>x_clear_area</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 0, 0, width, height);
<a id='L6312' name='L6312'></a>  6312       <a href='../S/2224.html#L36467' title='Defined at 36467 in src/xdisp.c.'>expose_frame</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 0, 0, width, height);
<a id='L6313' name='L6313'></a>  6313       <a href='../D/2280.html' title='Multiple defined in 3 places.'>FRAME_CR_CONTEXT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = saved_cr;
<a id='L6314' name='L6314'></a>  6314 
<a id='L6315' name='L6315'></a>  6315       <strong class='reserved'>if</strong> (<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (frames))
<a id='L6316' name='L6316'></a>  6316         <strong class='reserved'>break</strong>;
<a id='L6317' name='L6317'></a>  6317 
<a id='L6318' name='L6318'></a>  6318       cairo_surface_show_page (surface);
<a id='L6319' name='L6319'></a>  6319       <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/7021.html' title='Multiple defined in 2 places.'>XCAR</a> (frames));
<a id='L6320' name='L6320'></a>  6320       frames = <a href='../D/7022.html' title='Multiple defined in 2 places.'>XCDR</a> (frames);
<a id='L6321' name='L6321'></a>  6321       width = <a href='../S/2183.html#L1051' title='Defined at 1051 in src/frame.h.'>FRAME_PIXEL_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L6322' name='L6322'></a>  6322       height = <a href='../S/2183.html#L1052' title='Defined at 1052 in src/frame.h.'>FRAME_PIXEL_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L6323' name='L6323'></a>  6323       <strong class='reserved'>if</strong> (surface_set_size_func)
<a id='L6324' name='L6324'></a>  6324         (*surface_set_size_func) (surface, width, height);
<a id='L6325' name='L6325'></a>  6325 
<a id='L6326' name='L6326'></a>  6326       <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L6327' name='L6327'></a>  6327       <a href='../S/2267.html#L3683' title='Defined at 3683 in src/lisp.h.'>maybe_quit</a> ();
<a id='L6328' name='L6328'></a>  6328       <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L6329' name='L6329'></a>  6329     <em class='brace'>}</em>
<a id='L6330' name='L6330'></a>  6330 
<a id='L6331' name='L6331'></a>  6331 <em class='sharp'>#ifdef</em> CAIRO_HAS_PNG_FUNCTIONS
<a id='L6332' name='L6332'></a>  6332   <strong class='reserved'>if</strong> (surface_type == CAIRO_SURFACE_TYPE_IMAGE)
<a id='L6333' name='L6333'></a>  6333     <em class='brace'>{</em>
<a id='L6334' name='L6334'></a>  6334       cairo_surface_flush (surface);
<a id='L6335' name='L6335'></a>  6335       cairo_surface_write_to_png_stream (surface, <a href='../S/2289.html#L6234' title='Defined at 6234 in src/xterm.c.'>x_cr_accumulate_data</a>, &amp;acc);
<a id='L6336' name='L6336'></a>  6336     <em class='brace'>}</em>
<a id='L6337' name='L6337'></a>  6337 <em class='sharp'>#endif</em>
<a id='L6338' name='L6338'></a>  6338   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L6339' name='L6339'></a>  6339 
<a id='L6340' name='L6340'></a>  6340   <a href='../S/2188.html#L3757' title='Defined at 3757 in src/eval.c.'>unbind_to</a> (count, Qnil);
<a id='L6341' name='L6341'></a>  6341 
<a id='L6342' name='L6342'></a>  6342   <strong class='reserved'>return</strong> <a href='../D/652.html' title='Multiple defined in 2 places.'>CALLN</a> (Fapply, Qconcat, Fnreverse (acc));
<a id='L6343' name='L6343'></a>  6343 <em class='brace'>}</em>
<a id='L6344' name='L6344'></a>  6344 
<a id='L6345' name='L6345'></a>  6345 <em class='sharp'>#endif</em>  <em class='comment'>/* USE_CAIRO */</em>
<a id='L6346' name='L6346'></a>  6346 
<a id='L6347' name='L6347'></a>  6347 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XRENDER
<a id='L6348' name='L6348'></a>  6348 <strong class='reserved'>void</strong>
<a id='L6349' name='L6349'></a>  6349 <a href='../R/18376.html' title='Multiple referred from 6 places.'>x_xr_apply_ext_clip</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/2619.html' title='Multiple defined in 2 places.'>GC</a> gc)
<a id='L6350' name='L6350'></a>  6350 <em class='brace'>{</em>
<a id='L6351' name='L6351'></a>  6351   <a href='../D/10871.html' title='Multiple defined in 5 places.'>eassert</a> (<a href='../S/2212.html#L1446' title='Defined at 1446 in src/xterm.h.'>FRAME_X_PICTURE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) != None);
<a id='L6352' name='L6352'></a>  6352 
<a id='L6353' name='L6353'></a>  6353   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L199' title='Defined at 199 in src/xterm.h.'>x_gc_ext_data</a> *data = <a href='../S/2289.html#L5259' title='Defined at 5259 in src/xterm.c.'>x_gc_get_ext_data</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, 1);
<a id='L6354' name='L6354'></a>  6354 
<a id='L6355' name='L6355'></a>  6355   <strong class='reserved'>if</strong> (data-&gt;n_clip_rects)
<a id='L6356' name='L6356'></a>  6356     XRenderSetPictureClipRectangles (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L6357' name='L6357'></a>  6357                                      <a href='../S/2212.html#L1446' title='Defined at 1446 in src/xterm.h.'>FRAME_X_PICTURE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L6358' name='L6358'></a>  6358                                      0, 0, data-&gt;clip_rects,
<a id='L6359' name='L6359'></a>  6359                                      data-&gt;n_clip_rects);
<a id='L6360' name='L6360'></a>  6360 <em class='brace'>}</em>
<a id='L6361' name='L6361'></a>  6361 
<a id='L6362' name='L6362'></a>  6362 <strong class='reserved'>void</strong>
<a id='L6363' name='L6363'></a>  6363 <a href='../R/18378.html' title='Multiple referred from 8 places.'>x_xr_reset_ext_clip</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L6364' name='L6364'></a>  6364 <em class='brace'>{</em>
<a id='L6365' name='L6365'></a>  6365   XRenderPictureAttributes attrs = <em class='brace'>{</em> .clip_mask = None <em class='brace'>}</em>;
<a id='L6366' name='L6366'></a>  6366 
<a id='L6367' name='L6367'></a>  6367   XRenderChangePicture (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L6368' name='L6368'></a>  6368                         <a href='../S/2212.html#L1446' title='Defined at 1446 in src/xterm.h.'>FRAME_X_PICTURE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L6369' name='L6369'></a>  6369                         CPClipMask, &amp;attrs);
<a id='L6370' name='L6370'></a>  6370 <em class='brace'>}</em>
<a id='L6371' name='L6371'></a>  6371 <em class='sharp'>#endif</em>
<a id='L6372' name='L6372'></a>  6372 
<a id='L6373' name='L6373'></a>  6373 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L6374' name='L6374'></a>  6374 <a href='../R/18296.html' title='Multiple referred from 9 places.'>x_set_clip_rectangles</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/2619.html' title='Multiple defined in 2 places.'>GC</a> gc, <a href='../S/2150.html#L62' title='Defined at 62 in src/pgtkgui.h.'>XRectangle</a> *rectangles, <strong class='reserved'>int</strong> n)
<a id='L6375' name='L6375'></a>  6375 <em class='brace'>{</em>
<a id='L6376' name='L6376'></a>  6376   XSetClipRectangles (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), gc, 0, 0, rectangles, n, Unsorted);
<a id='L6377' name='L6377'></a>  6377 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> USE_CAIRO || <strong class='reserved'>defined</strong> HAVE_XRENDER
<a id='L6378' name='L6378'></a>  6378   <a href='../D/10871.html' title='Multiple defined in 5 places.'>eassert</a> (n &gt;= 0 &amp;&amp; n &lt;= <a href='../S/2212.html#L201' title='Defined at 201 in src/xterm.h.'>MAX_CLIP_RECTS</a>);
<a id='L6379' name='L6379'></a>  6379 
<a id='L6380' name='L6380'></a>  6380   <em class='brace'>{</em>
<a id='L6381' name='L6381'></a>  6381     <strong class='reserved'>struct</strong> <a href='../S/2212.html#L199' title='Defined at 199 in src/xterm.h.'>x_gc_ext_data</a> *gc_ext = <a href='../S/2289.html#L5259' title='Defined at 5259 in src/xterm.c.'>x_gc_get_ext_data</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, 1);
<a id='L6382' name='L6382'></a>  6382 
<a id='L6383' name='L6383'></a>  6383     gc_ext-&gt;n_clip_rects = n;
<a id='L6384' name='L6384'></a>  6384     memcpy (gc_ext-&gt;clip_rects, rectangles, <strong class='reserved'>sizeof</strong> (<a href='../S/2150.html#L62' title='Defined at 62 in src/pgtkgui.h.'>XRectangle</a>) * n);
<a id='L6385' name='L6385'></a>  6385   <em class='brace'>}</em>
<a id='L6386' name='L6386'></a>  6386 <em class='sharp'>#endif</em>
<a id='L6387' name='L6387'></a>  6387 <em class='brace'>}</em>
<a id='L6388' name='L6388'></a>  6388 
<a id='L6389' name='L6389'></a>  6389 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L6390' name='L6390'></a>  6390 <a href='../R/18277.html' title='Multiple referred from 12 places.'>x_reset_clip_rectangles</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/2619.html' title='Multiple defined in 2 places.'>GC</a> gc)
<a id='L6391' name='L6391'></a>  6391 <em class='brace'>{</em>
<a id='L6392' name='L6392'></a>  6392   XSetClipMask (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), gc, None);
<a id='L6393' name='L6393'></a>  6393 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> USE_CAIRO || <strong class='reserved'>defined</strong> HAVE_XRENDER
<a id='L6394' name='L6394'></a>  6394   <em class='brace'>{</em>
<a id='L6395' name='L6395'></a>  6395     <strong class='reserved'>struct</strong> <a href='../S/2212.html#L199' title='Defined at 199 in src/xterm.h.'>x_gc_ext_data</a> *gc_ext = <a href='../S/2289.html#L5259' title='Defined at 5259 in src/xterm.c.'>x_gc_get_ext_data</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, 0);
<a id='L6396' name='L6396'></a>  6396 
<a id='L6397' name='L6397'></a>  6397     <strong class='reserved'>if</strong> (gc_ext)
<a id='L6398' name='L6398'></a>  6398       gc_ext-&gt;n_clip_rects = 0;
<a id='L6399' name='L6399'></a>  6399   <em class='brace'>}</em>
<a id='L6400' name='L6400'></a>  6400 <em class='sharp'>#endif</em>
<a id='L6401' name='L6401'></a>  6401 <em class='brace'>}</em>
<a id='L6402' name='L6402'></a>  6402 
<a id='L6403' name='L6403'></a>  6403 <em class='sharp'>#ifdef</em> HAVE_XRENDER
<a id='L6404' name='L6404'></a>  6404 <em class='sharp'># if</em> !<strong class='reserved'>defined</strong> USE_CAIRO &amp;&amp; (RENDER_MAJOR &gt; 0 || RENDER_MINOR &gt;= 2)
<a id='L6405' name='L6405'></a>  6405 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L6406' name='L6406'></a>  6406 <a href='../R/18380.html' title='Multiple referred from 2 places.'>x_xrender_color_from_gc_foreground</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/2619.html' title='Multiple defined in 2 places.'>GC</a> gc, XRenderColor *color,
<a id='L6407' name='L6407'></a>  6407                                     <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> apply_alpha_background)
<a id='L6408' name='L6408'></a>  6408 <em class='brace'>{</em>
<a id='L6409' name='L6409'></a>  6409   XGCValues xgcv;
<a id='L6410' name='L6410'></a>  6410   <a href='../D/7038.html' title='Multiple defined in 2 places.'>XColor</a> xc;
<a id='L6411' name='L6411'></a>  6411 
<a id='L6412' name='L6412'></a>  6412   <a href='../S/2215.html#L271' title='Defined at 271 in src/w32term.c.'>XGetGCValues</a> (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), gc, <a href='../S/2315.html#L89' title='Defined at 89 in src/dispextern.h.'>GCForeground</a>, &amp;xgcv);
<a id='L6413' name='L6413'></a>  6413   xc.pixel = xgcv.foreground;
<a id='L6414' name='L6414'></a>  6414   <a href='../S/2289.html#L8972' title='Defined at 8972 in src/xterm.c.'>x_query_colors</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, &amp;xc, 1);
<a id='L6415' name='L6415'></a>  6415 
<a id='L6416' name='L6416'></a>  6416   color-&gt;alpha = (apply_alpha_background
<a id='L6417' name='L6417'></a>  6417                   ? 65535 * <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;alpha_background
<a id='L6418' name='L6418'></a>  6418                   : 65535);
<a id='L6419' name='L6419'></a>  6419 
<a id='L6420' name='L6420'></a>  6420   <strong class='reserved'>if</strong> (color-&gt;alpha == 65535)
<a id='L6421' name='L6421'></a>  6421     <em class='brace'>{</em>
<a id='L6422' name='L6422'></a>  6422       color-&gt;red = xc.red;
<a id='L6423' name='L6423'></a>  6423       color-&gt;blue = xc.blue;
<a id='L6424' name='L6424'></a>  6424       color-&gt;green = xc.green;
<a id='L6425' name='L6425'></a>  6425     <em class='brace'>}</em>
<a id='L6426' name='L6426'></a>  6426   <strong class='reserved'>else</strong>
<a id='L6427' name='L6427'></a>  6427     <em class='brace'>{</em>
<a id='L6428' name='L6428'></a>  6428       color-&gt;red = (xc.red * color-&gt;alpha) / 65535;
<a id='L6429' name='L6429'></a>  6429       color-&gt;blue = (xc.blue * color-&gt;alpha) / 65535;
<a id='L6430' name='L6430'></a>  6430       color-&gt;green = (xc.green * color-&gt;alpha) / 65535;
<a id='L6431' name='L6431'></a>  6431     <em class='brace'>}</em>
<a id='L6432' name='L6432'></a>  6432 <em class='brace'>}</em>
<a id='L6433' name='L6433'></a>  6433 <em class='sharp'># endif</em>
<a id='L6434' name='L6434'></a>  6434 
<a id='L6435' name='L6435'></a>  6435 <strong class='reserved'>void</strong>
<a id='L6436' name='L6436'></a>  6436 <a href='../R/18379.html' title='Multiple referred from 7 places.'>x_xrender_color_from_gc_background</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/2619.html' title='Multiple defined in 2 places.'>GC</a> gc, XRenderColor *color,
<a id='L6437' name='L6437'></a>  6437                                     <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> apply_alpha_background)
<a id='L6438' name='L6438'></a>  6438 <em class='brace'>{</em>
<a id='L6439' name='L6439'></a>  6439   XGCValues xgcv;
<a id='L6440' name='L6440'></a>  6440   <a href='../D/7038.html' title='Multiple defined in 2 places.'>XColor</a> xc;
<a id='L6441' name='L6441'></a>  6441 
<a id='L6442' name='L6442'></a>  6442   <a href='../S/2215.html#L271' title='Defined at 271 in src/w32term.c.'>XGetGCValues</a> (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), gc, <a href='../S/2315.html#L90' title='Defined at 90 in src/dispextern.h.'>GCBackground</a>, &amp;xgcv);
<a id='L6443' name='L6443'></a>  6443   xc.pixel = xgcv.background;
<a id='L6444' name='L6444'></a>  6444   <a href='../S/2289.html#L8972' title='Defined at 8972 in src/xterm.c.'>x_query_colors</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, &amp;xc, 1);
<a id='L6445' name='L6445'></a>  6445 
<a id='L6446' name='L6446'></a>  6446   color-&gt;alpha = (apply_alpha_background
<a id='L6447' name='L6447'></a>  6447                   ? 65535 * <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;alpha_background
<a id='L6448' name='L6448'></a>  6448                   : 65535);
<a id='L6449' name='L6449'></a>  6449 
<a id='L6450' name='L6450'></a>  6450   <strong class='reserved'>if</strong> (color-&gt;alpha == 65535)
<a id='L6451' name='L6451'></a>  6451     <em class='brace'>{</em>
<a id='L6452' name='L6452'></a>  6452       color-&gt;red = xc.red;
<a id='L6453' name='L6453'></a>  6453       color-&gt;blue = xc.blue;
<a id='L6454' name='L6454'></a>  6454       color-&gt;green = xc.green;
<a id='L6455' name='L6455'></a>  6455     <em class='brace'>}</em>
<a id='L6456' name='L6456'></a>  6456   <strong class='reserved'>else</strong>
<a id='L6457' name='L6457'></a>  6457     <em class='brace'>{</em>
<a id='L6458' name='L6458'></a>  6458       color-&gt;red = (xc.red * color-&gt;alpha) / 65535;
<a id='L6459' name='L6459'></a>  6459       color-&gt;blue = (xc.blue * color-&gt;alpha) / 65535;
<a id='L6460' name='L6460'></a>  6460       color-&gt;green = (xc.green * color-&gt;alpha) / 65535;
<a id='L6461' name='L6461'></a>  6461     <em class='brace'>}</em>
<a id='L6462' name='L6462'></a>  6462 <em class='brace'>}</em>
<a id='L6463' name='L6463'></a>  6463 <em class='sharp'>#endif</em>
<a id='L6464' name='L6464'></a>  6464 
<a id='L6465' name='L6465'></a>  6465 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L6466' name='L6466'></a>  6466 <a href='../R/18183.html' title='Multiple referred from 42 places.'>x_fill_rectangle</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/2619.html' title='Multiple defined in 2 places.'>GC</a> gc, <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, <strong class='reserved'>int</strong> y, <strong class='reserved'>int</strong> width, <strong class='reserved'>int</strong> height,
<a id='L6467' name='L6467'></a>  6467                   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> respect_alpha_background)
<a id='L6468' name='L6468'></a>  6468 <em class='brace'>{</em>
<a id='L6469' name='L6469'></a>  6469 <em class='sharp'>#ifdef</em> USE_CAIRO
<a id='L6470' name='L6470'></a>  6470   <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy = <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L6471' name='L6471'></a>  6471   cairo_t *cr;
<a id='L6472' name='L6472'></a>  6472   XGCValues xgcv;
<a id='L6473' name='L6473'></a>  6473 
<a id='L6474' name='L6474'></a>  6474   cr = <a href='../S/2289.html#L5908' title='Defined at 5908 in src/xterm.c.'>x_begin_cr_clip</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc);
<a id='L6475' name='L6475'></a>  6475   <a href='../S/2215.html#L271' title='Defined at 271 in src/w32term.c.'>XGetGCValues</a> (dpy, gc, GCFillStyle | GCStipple, &amp;xgcv);
<a id='L6476' name='L6476'></a>  6476   <strong class='reserved'>if</strong> (xgcv.fill_style == FillSolid
<a id='L6477' name='L6477'></a>  6477       <em class='comment'>/* Invalid resource ID (one or more of the three most</em>
<a id='L6478' name='L6478'></a>  6478 <em class='comment'>         significant bits set to 1) is obtained if the GCStipple</em>
<a id='L6479' name='L6479'></a>  6479 <em class='comment'>         component has never been explicitly set.  It should be</em>
<a id='L6480' name='L6480'></a>  6480 <em class='comment'>         regarded as Pixmap of unspecified size filled with ones.  */</em>
<a id='L6481' name='L6481'></a>  6481       || (xgcv.stipple &amp; ((<a href='../D/5058.html' title='Multiple defined in 2 places.'>Pixmap</a>) 7 &lt;&lt; (<strong class='reserved'>sizeof</strong> (<a href='../D/5058.html' title='Multiple defined in 2 places.'>Pixmap</a>) * CHAR_BIT - 3))))
<a id='L6482' name='L6482'></a>  6482     <em class='brace'>{</em>
<a id='L6483' name='L6483'></a>  6483       <a href='../S/2289.html#L5950' title='Defined at 5950 in src/xterm.c.'>x_set_cr_source_with_gc_foreground</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, respect_alpha_background);
<a id='L6484' name='L6484'></a>  6484       cairo_rectangle (cr, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, width, height);
<a id='L6485' name='L6485'></a>  6485       cairo_fill (cr);
<a id='L6486' name='L6486'></a>  6486     <em class='brace'>}</em>
<a id='L6487' name='L6487'></a>  6487   <strong class='reserved'>else</strong>
<a id='L6488' name='L6488'></a>  6488     <em class='brace'>{</em>
<a id='L6489' name='L6489'></a>  6489       <a href='../D/10871.html' title='Multiple defined in 5 places.'>eassert</a> (xgcv.fill_style == FillOpaqueStippled);
<a id='L6490' name='L6490'></a>  6490       <a href='../D/10871.html' title='Multiple defined in 5 places.'>eassert</a> (xgcv.stipple != None);
<a id='L6491' name='L6491'></a>  6491       <a href='../S/2289.html#L5980' title='Defined at 5980 in src/xterm.c.'>x_set_cr_source_with_gc_background</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, respect_alpha_background);
<a id='L6492' name='L6492'></a>  6492       cairo_rectangle (cr, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, width, height);
<a id='L6493' name='L6493'></a>  6493       cairo_fill_preserve (cr);
<a id='L6494' name='L6494'></a>  6494 
<a id='L6495' name='L6495'></a>  6495       cairo_pattern_t *pattern = <a href='../S/2204.html#L388' title='Defined at 388 in src/image.c.'>x_bitmap_stipple</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, xgcv.stipple);
<a id='L6496' name='L6496'></a>  6496       <strong class='reserved'>if</strong> (pattern)
<a id='L6497' name='L6497'></a>  6497         <em class='brace'>{</em>
<a id='L6498' name='L6498'></a>  6498           <a href='../S/2289.html#L5950' title='Defined at 5950 in src/xterm.c.'>x_set_cr_source_with_gc_foreground</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, respect_alpha_background);
<a id='L6499' name='L6499'></a>  6499           cairo_clip (cr);
<a id='L6500' name='L6500'></a>  6500           cairo_mask (cr, pattern);
<a id='L6501' name='L6501'></a>  6501         <em class='brace'>}</em>
<a id='L6502' name='L6502'></a>  6502     <em class='brace'>}</em>
<a id='L6503' name='L6503'></a>  6503   <a href='../S/2289.html#L5940' title='Defined at 5940 in src/xterm.c.'>x_end_cr_clip</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L6504' name='L6504'></a>  6504 <em class='sharp'>#else</em>
<a id='L6505' name='L6505'></a>  6505 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XRENDER &amp;&amp; (RENDER_MAJOR &gt; 0 || (RENDER_MINOR &gt;= 2))
<a id='L6506' name='L6506'></a>  6506   <strong class='reserved'>if</strong> (respect_alpha_background
<a id='L6507' name='L6507'></a>  6507       &amp;&amp; <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;alpha_background != 1.0
<a id='L6508' name='L6508'></a>  6508       &amp;&amp; <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;alpha_bits
<a id='L6509' name='L6509'></a>  6509       &amp;&amp; <a href='../S/2212.html#L1447' title='Defined at 1447 in src/xterm.h.'>FRAME_CHECK_XR_VERSION</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 0, 2))
<a id='L6510' name='L6510'></a>  6510     <em class='brace'>{</em>
<a id='L6511' name='L6511'></a>  6511       <a href='../S/2289.html#L5089' title='Defined at 5089 in src/xterm.c.'>x_xr_ensure_picture</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L6512' name='L6512'></a>  6512 
<a id='L6513' name='L6513'></a>  6513       <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1446' title='Defined at 1446 in src/xterm.h.'>FRAME_X_PICTURE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) != None)
<a id='L6514' name='L6514'></a>  6514         <em class='brace'>{</em>
<a id='L6515' name='L6515'></a>  6515           XRenderColor xc;
<a id='L6516' name='L6516'></a>  6516 
<a id='L6517' name='L6517'></a>  6517 <em class='sharp'>#if</em> RENDER_MAJOR &gt; 0 || (RENDER_MINOR &gt;= 10)
<a id='L6518' name='L6518'></a>  6518           XGCValues xgcv;
<a id='L6519' name='L6519'></a>  6519           XRenderPictureAttributes attrs;
<a id='L6520' name='L6520'></a>  6520           XRenderColor alpha;
<a id='L6521' name='L6521'></a>  6521           <a href='../S/2204.html#L1049' title='Defined at 1049 in src/image.c.'>Picture</a> stipple, fill;
<a id='L6522' name='L6522'></a>  6522 <em class='sharp'>#endif</em>
<a id='L6523' name='L6523'></a>  6523 
<a id='L6524' name='L6524'></a>  6524           <a href='../S/2289.html#L6349' title='Defined at 6349 in src/xterm.c.'>x_xr_apply_ext_clip</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc);
<a id='L6525' name='L6525'></a>  6525 
<a id='L6526' name='L6526'></a>  6526 <em class='sharp'>#if</em> RENDER_MAJOR &gt; 0 || (RENDER_MINOR &gt;= 10)
<a id='L6527' name='L6527'></a>  6527           <a href='../S/2215.html#L271' title='Defined at 271 in src/w32term.c.'>XGetGCValues</a> (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L6528' name='L6528'></a>  6528                         gc, GCFillStyle | GCStipple, &amp;xgcv);
<a id='L6529' name='L6529'></a>  6529 
<a id='L6530' name='L6530'></a>  6530           <strong class='reserved'>if</strong> (xgcv.fill_style == FillOpaqueStippled
<a id='L6531' name='L6531'></a>  6531               &amp;&amp; <a href='../S/2212.html#L1447' title='Defined at 1447 in src/xterm.h.'>FRAME_CHECK_XR_VERSION</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 0, 10))
<a id='L6532' name='L6532'></a>  6532             <em class='brace'>{</em>
<a id='L6533' name='L6533'></a>  6533               <a href='../S/2289.html#L6436' title='Defined at 6436 in src/xterm.c.'>x_xrender_color_from_gc_background</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, &amp;alpha, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L6534' name='L6534'></a>  6534               <a href='../S/2289.html#L6406' title='Defined at 6406 in src/xterm.c.'>x_xrender_color_from_gc_foreground</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, &amp;xc, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L6535' name='L6535'></a>  6535               attrs.repeat = RepeatNormal;
<a id='L6536' name='L6536'></a>  6536 
<a id='L6537' name='L6537'></a>  6537               stipple = XRenderCreatePicture (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L6538' name='L6538'></a>  6538                                               xgcv.stipple,
<a id='L6539' name='L6539'></a>  6539                                               XRenderFindStandardFormat (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L6540' name='L6540'></a>  6540                                                                          PictStandardA1),
<a id='L6541' name='L6541'></a>  6541                                               CPRepeat, &amp;attrs);
<a id='L6542' name='L6542'></a>  6542 
<a id='L6543' name='L6543'></a>  6543               XRenderFillRectangle (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), PictOpSrc,
<a id='L6544' name='L6544'></a>  6544                                     <a href='../S/2212.html#L1446' title='Defined at 1446 in src/xterm.h.'>FRAME_X_PICTURE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L6545' name='L6545'></a>  6545                                     &amp;alpha, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, width, height);
<a id='L6546' name='L6546'></a>  6546 
<a id='L6547' name='L6547'></a>  6547               fill = XRenderCreateSolidFill (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), &amp;xc);
<a id='L6548' name='L6548'></a>  6548 
<a id='L6549' name='L6549'></a>  6549               XRenderComposite (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), PictOpOver, fill, stipple,
<a id='L6550' name='L6550'></a>  6550                                 <a href='../S/2212.html#L1446' title='Defined at 1446 in src/xterm.h.'>FRAME_X_PICTURE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), 0, 0, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, width, height);
<a id='L6551' name='L6551'></a>  6551 
<a id='L6552' name='L6552'></a>  6552               XRenderFreePicture (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), stipple);
<a id='L6553' name='L6553'></a>  6553               XRenderFreePicture (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), fill);
<a id='L6554' name='L6554'></a>  6554             <em class='brace'>}</em>
<a id='L6555' name='L6555'></a>  6555           <strong class='reserved'>else</strong>
<a id='L6556' name='L6556'></a>  6556 <em class='sharp'>#endif</em>
<a id='L6557' name='L6557'></a>  6557             <em class='brace'>{</em>
<a id='L6558' name='L6558'></a>  6558               <a href='../S/2289.html#L6406' title='Defined at 6406 in src/xterm.c.'>x_xrender_color_from_gc_foreground</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, &amp;xc, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L6559' name='L6559'></a>  6559               XRenderFillRectangle (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L6560' name='L6560'></a>  6560                                     PictOpSrc, <a href='../S/2212.html#L1446' title='Defined at 1446 in src/xterm.h.'>FRAME_X_PICTURE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L6561' name='L6561'></a>  6561                                     &amp;xc, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, width, height);
<a id='L6562' name='L6562'></a>  6562             <em class='brace'>}</em>
<a id='L6563' name='L6563'></a>  6563           <a href='../S/2289.html#L6363' title='Defined at 6363 in src/xterm.c.'>x_xr_reset_ext_clip</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L6564' name='L6564'></a>  6564           <a href='../S/2296.html#L3928' title='Defined at 3928 in src/xfns.c.'>x_mark_frame_dirty</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L6565' name='L6565'></a>  6565 
<a id='L6566' name='L6566'></a>  6566           <strong class='reserved'>return</strong>;
<a id='L6567' name='L6567'></a>  6567         <em class='brace'>}</em>
<a id='L6568' name='L6568'></a>  6568     <em class='brace'>}</em>
<a id='L6569' name='L6569'></a>  6569 <em class='sharp'>#endif</em>
<a id='L6570' name='L6570'></a>  6570   XFillRectangle (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../S/2212.html#L1352' title='Defined at 1352 in src/xterm.h.'>FRAME_X_DRAWABLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L6571' name='L6571'></a>  6571                   gc, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, width, height);
<a id='L6572' name='L6572'></a>  6572 <em class='sharp'>#endif</em>
<a id='L6573' name='L6573'></a>  6573 <em class='brace'>}</em>
<a id='L6574' name='L6574'></a>  6574 
<a id='L6575' name='L6575'></a>  6575 
<a id='L6576' name='L6576'></a>  6576 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L6577' name='L6577'></a>  6577 <a href='../R/18074.html' title='Multiple referred from 3 places.'>x_clear_rectangle</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/2619.html' title='Multiple defined in 2 places.'>GC</a> gc, <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, <strong class='reserved'>int</strong> y, <strong class='reserved'>int</strong> width, <strong class='reserved'>int</strong> height,
<a id='L6578' name='L6578'></a>  6578                    <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> respect_alpha_background)
<a id='L6579' name='L6579'></a>  6579 <em class='brace'>{</em>
<a id='L6580' name='L6580'></a>  6580 <em class='sharp'>#ifdef</em> USE_CAIRO
<a id='L6581' name='L6581'></a>  6581   cairo_t *cr;
<a id='L6582' name='L6582'></a>  6582 
<a id='L6583' name='L6583'></a>  6583   cr = <a href='../S/2289.html#L5908' title='Defined at 5908 in src/xterm.c.'>x_begin_cr_clip</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc);
<a id='L6584' name='L6584'></a>  6584   <a href='../S/2289.html#L5980' title='Defined at 5980 in src/xterm.c.'>x_set_cr_source_with_gc_background</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, respect_alpha_background);
<a id='L6585' name='L6585'></a>  6585   cairo_rectangle (cr, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, width, height);
<a id='L6586' name='L6586'></a>  6586   cairo_fill (cr);
<a id='L6587' name='L6587'></a>  6587   <a href='../S/2289.html#L5940' title='Defined at 5940 in src/xterm.c.'>x_end_cr_clip</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L6588' name='L6588'></a>  6588 <em class='sharp'>#else</em>
<a id='L6589' name='L6589'></a>  6589 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XRENDER &amp;&amp; (RENDER_MAJOR &gt; 0 || (RENDER_MINOR &gt;= 2))
<a id='L6590' name='L6590'></a>  6590   <strong class='reserved'>if</strong> (respect_alpha_background
<a id='L6591' name='L6591'></a>  6591       &amp;&amp; <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;alpha_background != 1.0
<a id='L6592' name='L6592'></a>  6592       &amp;&amp; <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;alpha_bits
<a id='L6593' name='L6593'></a>  6593       &amp;&amp; <a href='../S/2212.html#L1447' title='Defined at 1447 in src/xterm.h.'>FRAME_CHECK_XR_VERSION</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 0, 2))
<a id='L6594' name='L6594'></a>  6594     <em class='brace'>{</em>
<a id='L6595' name='L6595'></a>  6595       <a href='../S/2289.html#L5089' title='Defined at 5089 in src/xterm.c.'>x_xr_ensure_picture</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L6596' name='L6596'></a>  6596 
<a id='L6597' name='L6597'></a>  6597       <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1446' title='Defined at 1446 in src/xterm.h.'>FRAME_X_PICTURE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) != None)
<a id='L6598' name='L6598'></a>  6598         <em class='brace'>{</em>
<a id='L6599' name='L6599'></a>  6599           XRenderColor xc;
<a id='L6600' name='L6600'></a>  6600 
<a id='L6601' name='L6601'></a>  6601           <a href='../S/2289.html#L6349' title='Defined at 6349 in src/xterm.c.'>x_xr_apply_ext_clip</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc);
<a id='L6602' name='L6602'></a>  6602           <a href='../S/2289.html#L6436' title='Defined at 6436 in src/xterm.c.'>x_xrender_color_from_gc_background</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, &amp;xc, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L6603' name='L6603'></a>  6603           XRenderFillRectangle (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L6604' name='L6604'></a>  6604                                 PictOpSrc, <a href='../S/2212.html#L1446' title='Defined at 1446 in src/xterm.h.'>FRAME_X_PICTURE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L6605' name='L6605'></a>  6605                                 &amp;xc, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, width, height);
<a id='L6606' name='L6606'></a>  6606           <a href='../S/2289.html#L6363' title='Defined at 6363 in src/xterm.c.'>x_xr_reset_ext_clip</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L6607' name='L6607'></a>  6607           <a href='../S/2296.html#L3928' title='Defined at 3928 in src/xfns.c.'>x_mark_frame_dirty</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L6608' name='L6608'></a>  6608 
<a id='L6609' name='L6609'></a>  6609           <strong class='reserved'>return</strong>;
<a id='L6610' name='L6610'></a>  6610         <em class='brace'>}</em>
<a id='L6611' name='L6611'></a>  6611     <em class='brace'>}</em>
<a id='L6612' name='L6612'></a>  6612 <em class='sharp'>#endif</em>
<a id='L6613' name='L6613'></a>  6613 
<a id='L6614' name='L6614'></a>  6614   XGCValues xgcv;
<a id='L6615' name='L6615'></a>  6615   <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy = <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L6616' name='L6616'></a>  6616   <a href='../S/2215.html#L271' title='Defined at 271 in src/w32term.c.'>XGetGCValues</a> (dpy, gc, <a href='../S/2315.html#L90' title='Defined at 90 in src/dispextern.h.'>GCBackground</a> | <a href='../S/2315.html#L89' title='Defined at 89 in src/dispextern.h.'>GCForeground</a>, &amp;xgcv);
<a id='L6617' name='L6617'></a>  6617   XSetForeground (dpy, gc, xgcv.background);
<a id='L6618' name='L6618'></a>  6618   XFillRectangle (dpy, <a href='../S/2212.html#L1352' title='Defined at 1352 in src/xterm.h.'>FRAME_X_DRAWABLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L6619' name='L6619'></a>  6619                   gc, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, width, height);
<a id='L6620' name='L6620'></a>  6620   XSetForeground (dpy, gc, xgcv.foreground);
<a id='L6621' name='L6621'></a>  6621 <em class='sharp'>#endif</em>
<a id='L6622' name='L6622'></a>  6622 <em class='brace'>}</em>
<a id='L6623' name='L6623'></a>  6623 
<a id='L6624' name='L6624'></a>  6624 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L6625' name='L6625'></a>  6625 <a href='../R/18164.html' title='Multiple referred from 12 places.'>x_draw_rectangle</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/2619.html' title='Multiple defined in 2 places.'>GC</a> gc, <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, <strong class='reserved'>int</strong> y, <strong class='reserved'>int</strong> width, <strong class='reserved'>int</strong> height)
<a id='L6626' name='L6626'></a>  6626 <em class='brace'>{</em>
<a id='L6627' name='L6627'></a>  6627 <em class='sharp'>#ifdef</em> USE_CAIRO
<a id='L6628' name='L6628'></a>  6628   cairo_t *cr;
<a id='L6629' name='L6629'></a>  6629 
<a id='L6630' name='L6630'></a>  6630   cr = <a href='../S/2289.html#L5908' title='Defined at 5908 in src/xterm.c.'>x_begin_cr_clip</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc);
<a id='L6631' name='L6631'></a>  6631   <a href='../S/2289.html#L5950' title='Defined at 5950 in src/xterm.c.'>x_set_cr_source_with_gc_foreground</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L6632' name='L6632'></a>  6632   cairo_rectangle (cr, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + 0.5, y + 0.5, width, height);
<a id='L6633' name='L6633'></a>  6633   cairo_set_line_width (cr, 1);
<a id='L6634' name='L6634'></a>  6634   cairo_stroke (cr);
<a id='L6635' name='L6635'></a>  6635   <a href='../S/2289.html#L5940' title='Defined at 5940 in src/xterm.c.'>x_end_cr_clip</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L6636' name='L6636'></a>  6636 <em class='sharp'>#else</em>
<a id='L6637' name='L6637'></a>  6637   XDrawRectangle (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../S/2212.html#L1352' title='Defined at 1352 in src/xterm.h.'>FRAME_X_DRAWABLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L6638' name='L6638'></a>  6638                   gc, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, width, height);
<a id='L6639' name='L6639'></a>  6639 <em class='sharp'>#endif</em>
<a id='L6640' name='L6640'></a>  6640 <em class='brace'>}</em>
<a id='L6641' name='L6641'></a>  6641 
<a id='L6642' name='L6642'></a>  6642 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L6643' name='L6643'></a>  6643 <a href='../S/2289.html#L11144' title='Referred from 11144 in src/xterm.c.'>x_clear_window</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L6644' name='L6644'></a>  6644 <em class='brace'>{</em>
<a id='L6645' name='L6645'></a>  6645 <em class='sharp'>#ifdef</em> USE_CAIRO
<a id='L6646' name='L6646'></a>  6646   cairo_t *cr;
<a id='L6647' name='L6647'></a>  6647 
<a id='L6648' name='L6648'></a>  6648   cr = <a href='../S/2289.html#L5908' title='Defined at 5908 in src/xterm.c.'>x_begin_cr_clip</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L6649' name='L6649'></a>  6649   <a href='../S/2289.html#L5980' title='Defined at 5980 in src/xterm.c.'>x_set_cr_source_with_gc_background</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;normal_gc, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L6650' name='L6650'></a>  6650   cairo_paint (cr);
<a id='L6651' name='L6651'></a>  6651   <a href='../S/2289.html#L5940' title='Defined at 5940 in src/xterm.c.'>x_end_cr_clip</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L6652' name='L6652'></a>  6652 <em class='sharp'>#else</em>
<a id='L6653' name='L6653'></a>  6653 <em class='sharp'>#ifndef</em> USE_GTK
<a id='L6654' name='L6654'></a>  6654   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;alpha_background != 1.0
<a id='L6655' name='L6655'></a>  6655 <em class='sharp'>#ifdef</em> HAVE_XDBE
<a id='L6656' name='L6656'></a>  6656       || <a href='../S/2212.html#L1356' title='Defined at 1356 in src/xterm.h.'>FRAME_X_DOUBLE_BUFFERED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L6657' name='L6657'></a>  6657 <em class='sharp'>#endif</em>
<a id='L6658' name='L6658'></a>  6658       )
<a id='L6659' name='L6659'></a>  6659 <em class='sharp'>#endif</em>
<a id='L6660' name='L6660'></a>  6660     <a href='../S/2289.html#L11076' title='Defined at 11076 in src/xterm.c.'>x_clear_area</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 0, 0, <a href='../S/2183.html#L1051' title='Defined at 1051 in src/frame.h.'>FRAME_PIXEL_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L6661' name='L6661'></a>  6661                   <a href='../S/2183.html#L1052' title='Defined at 1052 in src/frame.h.'>FRAME_PIXEL_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L6662' name='L6662'></a>  6662 <em class='sharp'>#ifndef</em> USE_GTK
<a id='L6663' name='L6663'></a>  6663   <strong class='reserved'>else</strong>
<a id='L6664' name='L6664'></a>  6664     XClearWindow (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L6665' name='L6665'></a>  6665 <em class='sharp'>#endif</em>
<a id='L6666' name='L6666'></a>  6666 <em class='sharp'>#endif</em>
<a id='L6667' name='L6667'></a>  6667 <em class='brace'>}</em>
<a id='L6668' name='L6668'></a>  6668 
<a id='L6669' name='L6669'></a>  6669 <em class='sharp'>#ifdef</em> USE_CAIRO
<a id='L6670' name='L6670'></a>  6670 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L6671' name='L6671'></a>  6671 <a href='../R/18184.html' title='Multiple referred from 2 places.'>x_fill_trapezoid_for_relief</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/2619.html' title='Multiple defined in 2 places.'>GC</a> gc, <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, <strong class='reserved'>int</strong> y,
<a id='L6672' name='L6672'></a>  6672                              <strong class='reserved'>int</strong> width, <strong class='reserved'>int</strong> height, <strong class='reserved'>int</strong> top_p)
<a id='L6673' name='L6673'></a>  6673 <em class='brace'>{</em>
<a id='L6674' name='L6674'></a>  6674   cairo_t *cr;
<a id='L6675' name='L6675'></a>  6675 
<a id='L6676' name='L6676'></a>  6676   cr = <a href='../S/2289.html#L5908' title='Defined at 5908 in src/xterm.c.'>x_begin_cr_clip</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc);
<a id='L6677' name='L6677'></a>  6677   <a href='../S/2289.html#L5950' title='Defined at 5950 in src/xterm.c.'>x_set_cr_source_with_gc_foreground</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L6678' name='L6678'></a>  6678   cairo_move_to (cr, top_p ? <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> : <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + height, y);
<a id='L6679' name='L6679'></a>  6679   cairo_line_to (cr, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y + height);
<a id='L6680' name='L6680'></a>  6680   cairo_line_to (cr, top_p ? <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + width - height : <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + width, y + height);
<a id='L6681' name='L6681'></a>  6681   cairo_line_to (cr, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + width, y);
<a id='L6682' name='L6682'></a>  6682   cairo_fill (cr);
<a id='L6683' name='L6683'></a>  6683   <a href='../S/2289.html#L5940' title='Defined at 5940 in src/xterm.c.'>x_end_cr_clip</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L6684' name='L6684'></a>  6684 <em class='brace'>}</em>
<a id='L6685' name='L6685'></a>  6685 
<a id='L6686' name='L6686'></a>  6686 <strong class='reserved'>enum</strong> <a href='../R/9188.html' title='Multiple referred from 46 places.'>corners</a>
<a id='L6687' name='L6687'></a>  6687   <em class='brace'>{</em>
<a id='L6688' name='L6688'></a>  6688     <a href='../R/1177.html' title='Multiple referred from 2 places.'>CORNER_BOTTOM_RIGHT</a>,        <em class='comment'>/* 0 -&gt; pi/2 */</em>
<a id='L6689' name='L6689'></a>  6689     <a href='../R/1176.html' title='Multiple referred from 4 places.'>CORNER_BOTTOM_LEFT</a>,         <em class='comment'>/* pi/2 -&gt; pi */</em>
<a id='L6690' name='L6690'></a>  6690     <a href='../R/1179.html' title='Multiple referred from 6 places.'>CORNER_TOP_LEFT</a>,            <em class='comment'>/* pi -&gt; 3pi/2 */</em>
<a id='L6691' name='L6691'></a>  6691     <a href='../R/1180.html' title='Multiple referred from 4 places.'>CORNER_TOP_RIGHT</a>,           <em class='comment'>/* 3pi/2 -&gt; 2pi */</em>
<a id='L6692' name='L6692'></a>  6692     <a href='../R/1178.html' title='Multiple referred from 2 places.'>CORNER_LAST</a>
<a id='L6693' name='L6693'></a>  6693   <em class='brace'>}</em>;
<a id='L6694' name='L6694'></a>  6694 
<a id='L6695' name='L6695'></a>  6695 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L6696' name='L6696'></a>  6696 <a href='../S/2289.html#L9706' title='Referred from 9706 in src/xterm.c.'>x_erase_corners_for_relief</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/2619.html' title='Multiple defined in 2 places.'>GC</a> gc, <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, <strong class='reserved'>int</strong> y,
<a id='L6697' name='L6697'></a>  6697                             <strong class='reserved'>int</strong> width, <strong class='reserved'>int</strong> height,
<a id='L6698' name='L6698'></a>  6698                             <strong class='reserved'>double</strong> radius, <strong class='reserved'>double</strong> margin, <strong class='reserved'>int</strong> <a href='../D/10126.html' title='Multiple defined in 2 places.'>corners</a>)
<a id='L6699' name='L6699'></a>  6699 <em class='brace'>{</em>
<a id='L6700' name='L6700'></a>  6700   cairo_t *cr;
<a id='L6701' name='L6701'></a>  6701   <strong class='reserved'>int</strong> i;
<a id='L6702' name='L6702'></a>  6702 
<a id='L6703' name='L6703'></a>  6703   cr = <a href='../S/2289.html#L5908' title='Defined at 5908 in src/xterm.c.'>x_begin_cr_clip</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc);
<a id='L6704' name='L6704'></a>  6704   <a href='../S/2289.html#L5980' title='Defined at 5980 in src/xterm.c.'>x_set_cr_source_with_gc_background</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L6705' name='L6705'></a>  6705   <strong class='reserved'>for</strong> (i = 0; i &lt; <a href='../D/1249.html' title='Multiple defined in 2 places.'>CORNER_LAST</a>; i++)
<a id='L6706' name='L6706'></a>  6706     <strong class='reserved'>if</strong> (<a href='../D/10126.html' title='Multiple defined in 2 places.'>corners</a> &amp; (1 &lt;&lt; i))
<a id='L6707' name='L6707'></a>  6707       <em class='brace'>{</em>
<a id='L6708' name='L6708'></a>  6708         <strong class='reserved'>double</strong> xm, ym, xc, yc;
<a id='L6709' name='L6709'></a>  6709 
<a id='L6710' name='L6710'></a>  6710         <strong class='reserved'>if</strong> (i == <a href='../D/1250.html' title='Multiple defined in 2 places.'>CORNER_TOP_LEFT</a> || i == <a href='../D/1247.html' title='Multiple defined in 2 places.'>CORNER_BOTTOM_LEFT</a>)
<a id='L6711' name='L6711'></a>  6711           xm = <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> - margin, xc = xm + radius;
<a id='L6712' name='L6712'></a>  6712         <strong class='reserved'>else</strong>
<a id='L6713' name='L6713'></a>  6713           xm = <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + width + margin, xc = xm - radius;
<a id='L6714' name='L6714'></a>  6714         <strong class='reserved'>if</strong> (i == <a href='../D/1250.html' title='Multiple defined in 2 places.'>CORNER_TOP_LEFT</a> || i == <a href='../D/1251.html' title='Multiple defined in 2 places.'>CORNER_TOP_RIGHT</a>)
<a id='L6715' name='L6715'></a>  6715           ym = y - margin, yc = ym + radius;
<a id='L6716' name='L6716'></a>  6716         <strong class='reserved'>else</strong>
<a id='L6717' name='L6717'></a>  6717           ym = y + height + margin, yc = ym - radius;
<a id='L6718' name='L6718'></a>  6718 
<a id='L6719' name='L6719'></a>  6719         cairo_move_to (cr, xm, ym);
<a id='L6720' name='L6720'></a>  6720         cairo_arc (cr, xc, yc, radius, i * M_PI_2, (i + 1) * M_PI_2);
<a id='L6721' name='L6721'></a>  6721       <em class='brace'>}</em>
<a id='L6722' name='L6722'></a>  6722   cairo_clip (cr);
<a id='L6723' name='L6723'></a>  6723   cairo_rectangle (cr, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, width, height);
<a id='L6724' name='L6724'></a>  6724   cairo_fill (cr);
<a id='L6725' name='L6725'></a>  6725   <a href='../S/2289.html#L5940' title='Defined at 5940 in src/xterm.c.'>x_end_cr_clip</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L6726' name='L6726'></a>  6726 <em class='brace'>}</em>
<a id='L6727' name='L6727'></a>  6727 
<a id='L6728' name='L6728'></a>  6728 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L6729' name='L6729'></a>  6729 <a href='../S/2289.html#L10625' title='Referred from 10625 in src/xterm.c.'>x_draw_horizontal_wave</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/2619.html' title='Multiple defined in 2 places.'>GC</a> gc, <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, <strong class='reserved'>int</strong> y,
<a id='L6730' name='L6730'></a>  6730                         <strong class='reserved'>int</strong> width, <strong class='reserved'>int</strong> height, <strong class='reserved'>int</strong> wave_length)
<a id='L6731' name='L6731'></a>  6731 <em class='brace'>{</em>
<a id='L6732' name='L6732'></a>  6732   cairo_t *cr;
<a id='L6733' name='L6733'></a>  6733   <strong class='reserved'>double</strong> dx = wave_length, dy = height - 1;
<a id='L6734' name='L6734'></a>  6734   <strong class='reserved'>int</strong> xoffset, n;
<a id='L6735' name='L6735'></a>  6735 
<a id='L6736' name='L6736'></a>  6736   cr = <a href='../S/2289.html#L5908' title='Defined at 5908 in src/xterm.c.'>x_begin_cr_clip</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc);
<a id='L6737' name='L6737'></a>  6737   <a href='../S/2289.html#L5950' title='Defined at 5950 in src/xterm.c.'>x_set_cr_source_with_gc_foreground</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L6738' name='L6738'></a>  6738   cairo_rectangle (cr, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, width, height);
<a id='L6739' name='L6739'></a>  6739   cairo_clip (cr);
<a id='L6740' name='L6740'></a>  6740 
<a id='L6741' name='L6741'></a>  6741   <strong class='reserved'>if</strong> (<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> &gt;= 0)
<a id='L6742' name='L6742'></a>  6742     <em class='brace'>{</em>
<a id='L6743' name='L6743'></a>  6743       xoffset = <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> % (wave_length * 2);
<a id='L6744' name='L6744'></a>  6744       <strong class='reserved'>if</strong> (xoffset == 0)
<a id='L6745' name='L6745'></a>  6745         xoffset = wave_length * 2;
<a id='L6746' name='L6746'></a>  6746     <em class='brace'>}</em>
<a id='L6747' name='L6747'></a>  6747   <strong class='reserved'>else</strong>
<a id='L6748' name='L6748'></a>  6748     xoffset = <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> % (wave_length * 2) + wave_length * 2;
<a id='L6749' name='L6749'></a>  6749   n = (width + xoffset) / wave_length + 1;
<a id='L6750' name='L6750'></a>  6750   <strong class='reserved'>if</strong> (xoffset &gt; wave_length)
<a id='L6751' name='L6751'></a>  6751     <em class='brace'>{</em>
<a id='L6752' name='L6752'></a>  6752       xoffset -= wave_length;
<a id='L6753' name='L6753'></a>  6753       --n;
<a id='L6754' name='L6754'></a>  6754       y += height - 1;
<a id='L6755' name='L6755'></a>  6755       dy = -dy;
<a id='L6756' name='L6756'></a>  6756     <em class='brace'>}</em>
<a id='L6757' name='L6757'></a>  6757 
<a id='L6758' name='L6758'></a>  6758   cairo_move_to (cr, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> - xoffset + 0.5, y + 0.5);
<a id='L6759' name='L6759'></a>  6759   <strong class='reserved'>while</strong> (--n &gt;= 0)
<a id='L6760' name='L6760'></a>  6760     <em class='brace'>{</em>
<a id='L6761' name='L6761'></a>  6761       cairo_rel_line_to (cr, dx, dy);
<a id='L6762' name='L6762'></a>  6762       dy = -dy;
<a id='L6763' name='L6763'></a>  6763     <em class='brace'>}</em>
<a id='L6764' name='L6764'></a>  6764   cairo_set_line_width (cr, 1);
<a id='L6765' name='L6765'></a>  6765   cairo_stroke (cr);
<a id='L6766' name='L6766'></a>  6766   <a href='../S/2289.html#L5940' title='Defined at 5940 in src/xterm.c.'>x_end_cr_clip</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L6767' name='L6767'></a>  6767 <em class='brace'>}</em>
<a id='L6768' name='L6768'></a>  6768 <em class='sharp'>#endif</em>
<a id='L6769' name='L6769'></a>  6769 
<a id='L6770' name='L6770'></a>  6770 
<a id='L6771' name='L6771'></a>  6771 <em class='comment'>/* Return the struct x_display_info corresponding to DPY.  */</em>
<a id='L6772' name='L6772'></a>  6772 
<a id='L6773' name='L6773'></a>  6773 <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *
<a id='L6774' name='L6774'></a>  6774 <a href='../R/18118.html' title='Multiple referred from 26 places.'>x_display_info_for_display</a> (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy)
<a id='L6775' name='L6775'></a>  6775 <em class='brace'>{</em>
<a id='L6776' name='L6776'></a>  6776   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L6777' name='L6777'></a>  6777 
<a id='L6778' name='L6778'></a>  6778   <strong class='reserved'>for</strong> (dpyinfo = x_display_list; dpyinfo; dpyinfo = dpyinfo-&gt;next)
<a id='L6779' name='L6779'></a>  6779     <strong class='reserved'>if</strong> (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> == dpy)
<a id='L6780' name='L6780'></a>  6780       <strong class='reserved'>return</strong> dpyinfo;
<a id='L6781' name='L6781'></a>  6781 
<a id='L6782' name='L6782'></a>  6782   <strong class='reserved'>return</strong> 0;
<a id='L6783' name='L6783'></a>  6783 <em class='brace'>}</em>
<a id='L6784' name='L6784'></a>  6784 
<a id='L6785' name='L6785'></a>  6785 <strong class='reserved'>static</strong> <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a>
<a id='L6786' name='L6786'></a>  6786 <a href='../S/2289.html#L6850' title='Referred from 6850 in src/xterm.c.'>x_find_topmost_parent</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L6787' name='L6787'></a>  6787 <em class='brace'>{</em>
<a id='L6788' name='L6788'></a>  6788   <strong class='reserved'>struct</strong> <a href='../D/19627.html' title='Multiple defined in 5 places.'>x_output</a> *<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L6789' name='L6789'></a>  6789   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> win = None, wi = <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;parent_desc;
<a id='L6790' name='L6790'></a>  6790   <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy = <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L6791' name='L6791'></a>  6791 
<a id='L6792' name='L6792'></a>  6792   <strong class='reserved'>while</strong> (wi != <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;root_window)
<a id='L6793' name='L6793'></a>  6793     <em class='brace'>{</em>
<a id='L6794' name='L6794'></a>  6794       <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> root;
<a id='L6795' name='L6795'></a>  6795       <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> *children;
<a id='L6796' name='L6796'></a>  6796       <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> nchildren;
<a id='L6797' name='L6797'></a>  6797 
<a id='L6798' name='L6798'></a>  6798       win = wi;
<a id='L6799' name='L6799'></a>  6799       <strong class='reserved'>if</strong> (XQueryTree (dpy, win, &amp;root, &amp;wi, &amp;children, &amp;nchildren))
<a id='L6800' name='L6800'></a>  6800         XFree (children);
<a id='L6801' name='L6801'></a>  6801       <strong class='reserved'>else</strong>
<a id='L6802' name='L6802'></a>  6802         <strong class='reserved'>break</strong>;
<a id='L6803' name='L6803'></a>  6803     <em class='brace'>}</em>
<a id='L6804' name='L6804'></a>  6804 
<a id='L6805' name='L6805'></a>  6805   <strong class='reserved'>return</strong> win;
<a id='L6806' name='L6806'></a>  6806 <em class='brace'>}</em>
<a id='L6807' name='L6807'></a>  6807 
<a id='L6808' name='L6808'></a>  6808 <em class='sharp'>#define</em> <a href='../R/4155.html' title='Multiple referred from 6 places.'>OPAQUE</a>  0xffffffff
<a id='L6809' name='L6809'></a>  6809 
<a id='L6810' name='L6810'></a>  6810 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L6811' name='L6811'></a>  6811 <a href='../R/18304.html' title='Multiple referred from 4 places.'>x_set_frame_alpha</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L6812' name='L6812'></a>  6812 <em class='brace'>{</em>
<a id='L6813' name='L6813'></a>  6813   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L6814' name='L6814'></a>  6814   <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy = <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L6815' name='L6815'></a>  6815   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> win = <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L6816' name='L6816'></a>  6816   <strong class='reserved'>double</strong> alpha = 1.0;
<a id='L6817' name='L6817'></a>  6817   <strong class='reserved'>double</strong> alpha_min = 1.0;
<a id='L6818' name='L6818'></a>  6818   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> opac;
<a id='L6819' name='L6819'></a>  6819   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> <a href='../D/15236.html' title='Multiple defined in 2 places.'>parent</a>;
<a id='L6820' name='L6820'></a>  6820 
<a id='L6821' name='L6821'></a>  6821   <strong class='reserved'>if</strong> (dpyinfo-&gt;highlight_frame == <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L6822' name='L6822'></a>  6822     alpha = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;alpha[0];
<a id='L6823' name='L6823'></a>  6823   <strong class='reserved'>else</strong>
<a id='L6824' name='L6824'></a>  6824     alpha = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;alpha[1];
<a id='L6825' name='L6825'></a>  6825 
<a id='L6826' name='L6826'></a>  6826   <strong class='reserved'>if</strong> (alpha &lt; 0.0)
<a id='L6827' name='L6827'></a>  6827     <strong class='reserved'>return</strong>;
<a id='L6828' name='L6828'></a>  6828 
<a id='L6829' name='L6829'></a>  6829   <strong class='reserved'>if</strong> (<a href='../D/2123.html' title='Multiple defined in 2 places.'>FLOATP</a> (Vframe_alpha_lower_limit))
<a id='L6830' name='L6830'></a>  6830     alpha_min = <a href='../D/7090.html' title='Multiple defined in 2 places.'>XFLOAT_DATA</a> (Vframe_alpha_lower_limit);
<a id='L6831' name='L6831'></a>  6831   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (<a href='../S/2267.html#L469' title='Defined at 469 in src/lisp.h.'>FIXNUMP</a> (Vframe_alpha_lower_limit))
<a id='L6832' name='L6832'></a>  6832     alpha_min = (<a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (Vframe_alpha_lower_limit)) / 100.0;
<a id='L6833' name='L6833'></a>  6833 
<a id='L6834' name='L6834'></a>  6834   <strong class='reserved'>if</strong> (alpha &gt; 1.0)
<a id='L6835' name='L6835'></a>  6835     alpha = 1.0;
<a id='L6836' name='L6836'></a>  6836   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (alpha &lt; alpha_min &amp;&amp; alpha_min &lt;= 1.0)
<a id='L6837' name='L6837'></a>  6837     alpha = alpha_min;
<a id='L6838' name='L6838'></a>  6838 
<a id='L6839' name='L6839'></a>  6839   opac = alpha * <a href='../S/2289.html#L6808' title='Defined at 6808 in src/xterm.c.'>OPAQUE</a>;
<a id='L6840' name='L6840'></a>  6840 
<a id='L6841' name='L6841'></a>  6841   <em class='comment'>/* If there is a parent from the window manager, put the property there</em>
<a id='L6842' name='L6842'></a>  6842 <em class='comment'>     also, to work around broken window managers that fail to do that.</em>
<a id='L6843' name='L6843'></a>  6843 <em class='comment'>     Do this unconditionally as this function is called on reparent when</em>
<a id='L6844' name='L6844'></a>  6844 <em class='comment'>     alpha has not changed on the frame.  */</em>
<a id='L6845' name='L6845'></a>  6845 
<a id='L6846' name='L6846'></a>  6846   x_ignore_errors_for_next_request (dpyinfo, 0);
<a id='L6847' name='L6847'></a>  6847 
<a id='L6848' name='L6848'></a>  6848   <strong class='reserved'>if</strong> (!<a href='../D/2370.html' title='Multiple defined in 2 places.'>FRAME_PARENT_FRAME</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L6849' name='L6849'></a>  6849     <em class='brace'>{</em>
<a id='L6850' name='L6850'></a>  6850       <a href='../D/15236.html' title='Multiple defined in 2 places.'>parent</a> = <a href='../S/2289.html#L6786' title='Defined at 6786 in src/xterm.c.'>x_find_topmost_parent</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L6851' name='L6851'></a>  6851 
<a id='L6852' name='L6852'></a>  6852       <strong class='reserved'>if</strong> (<a href='../D/15236.html' title='Multiple defined in 2 places.'>parent</a> != None)
<a id='L6853' name='L6853'></a>  6853         <em class='brace'>{</em>
<a id='L6854' name='L6854'></a>  6854           XChangeProperty (dpy, <a href='../D/15236.html' title='Multiple defined in 2 places.'>parent</a>,
<a id='L6855' name='L6855'></a>  6855                            dpyinfo-&gt;Xatom_net_wm_window_opacity,
<a id='L6856' name='L6856'></a>  6856                            XA_CARDINAL, 32, PropModeReplace,
<a id='L6857' name='L6857'></a>  6857                            (<strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *) &amp;opac, 1);
<a id='L6858' name='L6858'></a>  6858         <em class='brace'>}</em>
<a id='L6859' name='L6859'></a>  6859     <em class='brace'>}</em>
<a id='L6860' name='L6860'></a>  6860 
<a id='L6861' name='L6861'></a>  6861   XChangeProperty (dpy, win, dpyinfo-&gt;Xatom_net_wm_window_opacity,
<a id='L6862' name='L6862'></a>  6862                    XA_CARDINAL, 32, PropModeReplace,
<a id='L6863' name='L6863'></a>  6863                    (<strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *) &amp;opac, 1);
<a id='L6864' name='L6864'></a>  6864   x_stop_ignoring_errors (dpyinfo);
<a id='L6865' name='L6865'></a>  6865 <em class='brace'>}</em>
<a id='L6866' name='L6866'></a>  6866 
<a id='L6867' name='L6867'></a>  6867 <em class='comment'>/***********************************************************************</em>
<a id='L6868' name='L6868'></a>  6868 <em class='comment'>                    Starting and ending an update</em>
<a id='L6869' name='L6869'></a>  6869 <em class='comment'> ***********************************************************************/</em>
<a id='L6870' name='L6870'></a>  6870 
<a id='L6871' name='L6871'></a>  6871 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XSYNC &amp;&amp; !<strong class='reserved'>defined</strong> USE_GTK &amp;&amp; <strong class='reserved'>defined</strong> HAVE_CLOCK_GETTIME
<a id='L6872' name='L6872'></a>  6872 
<a id='L6873' name='L6873'></a>  6873 <em class='comment'>/* Wait for an event matching PREDICATE to show up in the event</em>
<a id='L6874' name='L6874'></a>  6874 <em class='comment'>   queue, or TIMEOUT to elapse.</em>
<a id='L6875' name='L6875'></a>  6875 <em class='comment'></em>
<a id='L6876' name='L6876'></a>  6876 <em class='comment'>   If TIMEOUT passes without an event being found, return 1.</em>
<a id='L6877' name='L6877'></a>  6877 <em class='comment'>   Otherwise, return 0 and behave as XIfEvent would.  */</em>
<a id='L6878' name='L6878'></a>  6878 
<a id='L6879' name='L6879'></a>  6879 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L6880' name='L6880'></a>  6880 <a href='../S/2289.html#L7031' title='Referred from 7031 in src/xterm.c.'>x_if_event</a> (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy, XEvent *event_return,
<a id='L6881' name='L6881'></a>  6881             Bool (*predicate) (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *, XEvent *, XPointer),
<a id='L6882' name='L6882'></a>  6882             XPointer arg, <strong class='reserved'>struct</strong> <a href='../D/18278.html' title='Multiple defined in 3 places.'>timespec</a> timeout)
<a id='L6883' name='L6883'></a>  6883 <em class='brace'>{</em>
<a id='L6884' name='L6884'></a>  6884   <strong class='reserved'>struct</strong> <a href='../D/18278.html' title='Multiple defined in 3 places.'>timespec</a> current_time, target;
<a id='L6885' name='L6885'></a>  6885   <strong class='reserved'>int</strong> fd;
<a id='L6886' name='L6886'></a>  6886   <a href='../D/11311.html' title='Multiple defined in 3 places.'>fd_set</a> fds;
<a id='L6887' name='L6887'></a>  6887 
<a id='L6888' name='L6888'></a>  6888   fd = ConnectionNumber (dpy);
<a id='L6889' name='L6889'></a>  6889   current_time = <a href='../S/2947.html#L46' title='Defined at 46 in lib/gettime.c.'>current_timespec</a> ();
<a id='L6890' name='L6890'></a>  6890   target = <a href='../D/18279.html' title='Multiple defined in 2 places.'>timespec_add</a> (current_time, timeout);
<a id='L6891' name='L6891'></a>  6891 
<a id='L6892' name='L6892'></a>  6892   <em class='comment'>/* Check if an event is already in the queue.  If it is, avoid</em>
<a id='L6893' name='L6893'></a>  6893 <em class='comment'>     syncing.  */</em>
<a id='L6894' name='L6894'></a>  6894   <strong class='reserved'>if</strong> (XCheckIfEvent (dpy, event_return, predicate, arg))
<a id='L6895' name='L6895'></a>  6895     <strong class='reserved'>return</strong> 0;
<a id='L6896' name='L6896'></a>  6896 
<a id='L6897' name='L6897'></a>  6897   <strong class='reserved'>while</strong> (<a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>)
<a id='L6898' name='L6898'></a>  6898     <em class='brace'>{</em>
<a id='L6899' name='L6899'></a>  6899       <em class='comment'>/* Get events into the queue.  */</em>
<a id='L6900' name='L6900'></a>  6900       <a href='../D/7378.html' title='Multiple defined in 3 places.'>XSync</a> (dpy, False);
<a id='L6901' name='L6901'></a>  6901 
<a id='L6902' name='L6902'></a>  6902       <em class='comment'>/* Look for an event again.  */</em>
<a id='L6903' name='L6903'></a>  6903       <strong class='reserved'>if</strong> (XCheckIfEvent (dpy, event_return, predicate, arg))
<a id='L6904' name='L6904'></a>  6904         <strong class='reserved'>return</strong> 0;
<a id='L6905' name='L6905'></a>  6905 
<a id='L6906' name='L6906'></a>  6906       <em class='comment'>/* Calculate the timeout.  */</em>
<a id='L6907' name='L6907'></a>  6907       current_time = <a href='../S/2947.html#L46' title='Defined at 46 in lib/gettime.c.'>current_timespec</a> ();
<a id='L6908' name='L6908'></a>  6908       timeout = <a href='../S/2890.html#L31' title='Defined at 31 in lib/timespec-sub.c.'>timespec_sub</a> (target, current_time);
<a id='L6909' name='L6909'></a>  6909 
<a id='L6910' name='L6910'></a>  6910       <em class='comment'>/* If not, wait for some input to show up on the X connection,</em>
<a id='L6911' name='L6911'></a>  6911 <em class='comment'>         or for the timeout to elapse.  */</em>
<a id='L6912' name='L6912'></a>  6912       <a href='../D/2046.html' title='Multiple defined in 4 places.'>FD_ZERO</a> (&amp;fds);
<a id='L6913' name='L6913'></a>  6913       <a href='../D/2044.html' title='Multiple defined in 6 places.'>FD_SET</a> (fd, &amp;fds);
<a id='L6914' name='L6914'></a>  6914 
<a id='L6915' name='L6915'></a>  6915       <em class='comment'>/* If this fails due to an IO error, XSync will call the IO</em>
<a id='L6916' name='L6916'></a>  6916 <em class='comment'>         error handler.  */</em>
<a id='L6917' name='L6917'></a>  6917       <a href='../D/15844.html' title='Multiple defined in 7 places.'>pselect</a> (fd + 1, &amp;fds, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, &amp;timeout, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L6918' name='L6918'></a>  6918 
<a id='L6919' name='L6919'></a>  6919       <em class='comment'>/* Timeout elapsed.  */</em>
<a id='L6920' name='L6920'></a>  6920       current_time = <a href='../S/2947.html#L46' title='Defined at 46 in lib/gettime.c.'>current_timespec</a> ();
<a id='L6921' name='L6921'></a>  6921       <strong class='reserved'>if</strong> (<a href='../S/2788.html#L64' title='Defined at 64 in lib/timespec.h.'>timespec_cmp</a> (target, current_time) &lt; 0)
<a id='L6922' name='L6922'></a>  6922         <strong class='reserved'>return</strong> 1;
<a id='L6923' name='L6923'></a>  6923     <em class='brace'>}</em>
<a id='L6924' name='L6924'></a>  6924 <em class='brace'>}</em>
<a id='L6925' name='L6925'></a>  6925 
<a id='L6926' name='L6926'></a>  6926 <em class='comment'>/* Return the monotonic time corresponding to the high-resolution</em>
<a id='L6927' name='L6927'></a>  6927 <em class='comment'>   server timestamp TIMESTAMP.  Return 0 if the necessary information</em>
<a id='L6928' name='L6928'></a>  6928 <em class='comment'>   is not available.  */</em>
<a id='L6929' name='L6929'></a>  6929 
<a id='L6930' name='L6930'></a>  6930 <strong class='reserved'>static</strong> <a href='../D/18597.html' title='Multiple defined in 2 places.'>uint_fast64_t</a>
<a id='L6931' name='L6931'></a>  6931 <a href='../S/2289.html#L6979' title='Referred from 6979 in src/xterm.c.'>x_sync_get_monotonic_time</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L6932' name='L6932'></a>  6932                            <a href='../D/18597.html' title='Multiple defined in 2 places.'>uint_fast64_t</a> timestamp)
<a id='L6933' name='L6933'></a>  6933 <em class='brace'>{</em>
<a id='L6934' name='L6934'></a>  6934   <strong class='reserved'>if</strong> (dpyinfo-&gt;server_time_monotonic_p)
<a id='L6935' name='L6935'></a>  6935     <strong class='reserved'>return</strong> timestamp;
<a id='L6936' name='L6936'></a>  6936 
<a id='L6937' name='L6937'></a>  6937   <em class='comment'>/* This means we haven't yet initialized the server time offset.  */</em>
<a id='L6938' name='L6938'></a>  6938   <strong class='reserved'>if</strong> (!dpyinfo-&gt;server_time_offset)
<a id='L6939' name='L6939'></a>  6939     <strong class='reserved'>return</strong> 0;
<a id='L6940' name='L6940'></a>  6940 
<a id='L6941' name='L6941'></a>  6941   <a href='../D/18597.html' title='Multiple defined in 2 places.'>uint_fast64_t</a> t;
<a id='L6942' name='L6942'></a>  6942   <strong class='reserved'>return</strong> <a href='../S/2699.html#L32' title='Defined at 32 in lib/stdckdint.in.h.'>ckd_sub</a> (&amp;t, timestamp, dpyinfo-&gt;server_time_offset) ? 0 : t;
<a id='L6943' name='L6943'></a>  6943 <em class='brace'>}</em>
<a id='L6944' name='L6944'></a>  6944 
<a id='L6945' name='L6945'></a>  6945 <em class='sharp'># ifndef</em> <a href='../S/2289.html#L6946' title='Defined at 6946 in src/xterm.c.'>CLOCK_MONOTONIC</a>
<a id='L6946' name='L6946'></a>  6946 <em class='sharp'>#  define</em> <a href='../R/999.html' title='Multiple referred from 5 places.'>CLOCK_MONOTONIC</a> CLOCK_REALTIME
<a id='L6947' name='L6947'></a>  6947 <em class='sharp'># endif</em>
<a id='L6948' name='L6948'></a>  6948 
<a id='L6949' name='L6949'></a>  6949 <em class='comment'>/* Return the current monotonic time in the same format as a</em>
<a id='L6950' name='L6950'></a>  6950 <em class='comment'>   high-resolution server timestamp, or 0 if not available.  */</em>
<a id='L6951' name='L6951'></a>  6951 
<a id='L6952' name='L6952'></a>  6952 <strong class='reserved'>static</strong> <a href='../D/18597.html' title='Multiple defined in 2 places.'>uint_fast64_t</a>
<a id='L6953' name='L6953'></a>  6953 <a href='../R/18344.html' title='Multiple referred from 3 places.'>x_sync_current_monotonic_time</a> (<strong class='reserved'>void</strong>)
<a id='L6954' name='L6954'></a>  6954 <em class='brace'>{</em>
<a id='L6955' name='L6955'></a>  6955   <strong class='reserved'>struct</strong> <a href='../D/18278.html' title='Multiple defined in 3 places.'>timespec</a> <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L6956' name='L6956'></a>  6956   <a href='../D/18597.html' title='Multiple defined in 2 places.'>uint_fast64_t</a> t;
<a id='L6957' name='L6957'></a>  6957   <strong class='reserved'>return</strong> (((clock_gettime (<a href='../S/2289.html#L6946' title='Defined at 6946 in src/xterm.c.'>CLOCK_MONOTONIC</a>, &amp;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>) != 0
<a id='L6958' name='L6958'></a>  6958             &amp;&amp; (<a href='../S/2289.html#L6946' title='Defined at 6946 in src/xterm.c.'>CLOCK_MONOTONIC</a> == CLOCK_REALTIME
<a id='L6959' name='L6959'></a>  6959                 || clock_gettime (CLOCK_REALTIME, &amp;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>) != 0))
<a id='L6960' name='L6960'></a>  6960            || <a href='../S/2699.html#L33' title='Defined at 33 in lib/stdckdint.in.h.'>ckd_mul</a> (&amp;t, <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>.tv_sec, 1000000)
<a id='L6961' name='L6961'></a>  6961            || <a href='../S/2699.html#L31' title='Defined at 31 in lib/stdckdint.in.h.'>ckd_add</a> (&amp;t, t, <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>.tv_nsec / 1000))
<a id='L6962' name='L6962'></a>  6962           ? 0 : t);
<a id='L6963' name='L6963'></a>  6963 <em class='brace'>}</em>
<a id='L6964' name='L6964'></a>  6964 
<a id='L6965' name='L6965'></a>  6965 <em class='comment'>/* Decode a _NET_WM_FRAME_DRAWN message and calculate the time it took</em>
<a id='L6966' name='L6966'></a>  6966 <em class='comment'>   to draw the last frame.  */</em>
<a id='L6967' name='L6967'></a>  6967 
<a id='L6968' name='L6968'></a>  6968 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L6969' name='L6969'></a>  6969 <a href='../R/18350.html' title='Multiple referred from 2 places.'>x_sync_note_frame_times</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L6970' name='L6970'></a>  6970                          <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, XEvent *event)
<a id='L6971' name='L6971'></a>  6971 <em class='brace'>{</em>
<a id='L6972' name='L6972'></a>  6972   <a href='../D/18597.html' title='Multiple defined in 2 places.'>uint_fast64_t</a> low, high, <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L6973' name='L6973'></a>  6973   <strong class='reserved'>struct</strong> <a href='../D/19627.html' title='Multiple defined in 5 places.'>x_output</a> *output;
<a id='L6974' name='L6974'></a>  6974 
<a id='L6975' name='L6975'></a>  6975   low = event-&gt;xclient.data.l[2];
<a id='L6976' name='L6976'></a>  6976   high = event-&gt;xclient.data.l[3];
<a id='L6977' name='L6977'></a>  6977   output = <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L6978' name='L6978'></a>  6978 
<a id='L6979' name='L6979'></a>  6979   <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> = <a href='../S/2289.html#L6931' title='Defined at 6931 in src/xterm.c.'>x_sync_get_monotonic_time</a> (dpyinfo, low | (high &lt;&lt; 32));
<a id='L6980' name='L6980'></a>  6980 
<a id='L6981' name='L6981'></a>  6981   <strong class='reserved'>if</strong> (!<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> || !output-&gt;temp_frame_time
<a id='L6982' name='L6982'></a>  6982       || <a href='../S/2699.html#L32' title='Defined at 32 in lib/stdckdint.in.h.'>ckd_sub</a> (&amp;output-&gt;last_frame_time, <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>, output-&gt;temp_frame_time))
<a id='L6983' name='L6983'></a>  6983     output-&gt;last_frame_time = 0;
<a id='L6984' name='L6984'></a>  6984 
<a id='L6985' name='L6985'></a>  6985 <em class='sharp'>#ifdef</em> FRAME_DEBUG
<a id='L6986' name='L6986'></a>  6986   <a href='../D/18597.html' title='Multiple defined in 2 places.'>uint_fast64_t</a> last_frame_ms = output-&gt;last_frame_time / 1000;
<a id='L6987' name='L6987'></a>  6987   <a href='../D/11675.html' title='Multiple defined in 4 places.'>fprintf</a> (<a href='../S/20.html#L50' title='Defined at 50 in nt/cmdproxy.c.'>stderr</a>,
<a id='L6988' name='L6988'></a>  6988            "Drawing the last frame took: %"<a href='../S/2757.html#L429' title='Defined at 429 in lib/inttypes.in.h.'>PRIuFAST64</a>" ms (%"<a href='../S/2757.html#L429' title='Defined at 429 in lib/inttypes.in.h.'>PRIuFAST64</a>")\n",
<a id='L6989' name='L6989'></a>  6989            last_frame_ms, <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>);
<a id='L6990' name='L6990'></a>  6990 <em class='sharp'>#endif</em>
<a id='L6991' name='L6991'></a>  6991 <em class='brace'>}</em>
<a id='L6992' name='L6992'></a>  6992 
<a id='L6993' name='L6993'></a>  6993 <strong class='reserved'>static</strong> Bool
<a id='L6994' name='L6994'></a>  6994 <a href='../S/2289.html#L7032' title='Referred from 7032 in src/xterm.c.'>x_sync_is_frame_drawn_event</a> (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy, XEvent *event,
<a id='L6995' name='L6995'></a>  6995                              XPointer user_data)
<a id='L6996' name='L6996'></a>  6996 <em class='brace'>{</em>
<a id='L6997' name='L6997'></a>  6997   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L6998' name='L6998'></a>  6998   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L6999' name='L6999'></a>  6999 
<a id='L7000' name='L7000'></a>  7000   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *) user_data;
<a id='L7001' name='L7001'></a>  7001   dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L7002' name='L7002'></a>  7002 
<a id='L7003' name='L7003'></a>  7003   <strong class='reserved'>if</strong> (event-&gt;type == ClientMessage
<a id='L7004' name='L7004'></a>  7004       &amp;&amp; (event-&gt;xclient.message_type
<a id='L7005' name='L7005'></a>  7005           == dpyinfo-&gt;Xatom_net_wm_frame_drawn)
<a id='L7006' name='L7006'></a>  7006       &amp;&amp; event-&gt;xclient.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> == <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L7007' name='L7007'></a>  7007     <strong class='reserved'>return</strong> True;
<a id='L7008' name='L7008'></a>  7008 
<a id='L7009' name='L7009'></a>  7009   <strong class='reserved'>return</strong> False;
<a id='L7010' name='L7010'></a>  7010 <em class='brace'>}</em>
<a id='L7011' name='L7011'></a>  7011 
<a id='L7012' name='L7012'></a>  7012 <em class='comment'>/* Wait for the compositing manager to finish drawing the last frame.</em>
<a id='L7013' name='L7013'></a>  7013 <em class='comment'>   If the compositing manager has already drawn everything, do</em>
<a id='L7014' name='L7014'></a>  7014 <em class='comment'>   nothing.  */</em>
<a id='L7015' name='L7015'></a>  7015 
<a id='L7016' name='L7016'></a>  7016 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L7017' name='L7017'></a>  7017 <a href='../R/18354.html' title='Multiple referred from 2 places.'>x_sync_wait_for_frame_drawn_event</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L7018' name='L7018'></a>  7018 <em class='brace'>{</em>
<a id='L7019' name='L7019'></a>  7019   XEvent event;
<a id='L7020' name='L7020'></a>  7020   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L7021' name='L7021'></a>  7021 
<a id='L7022' name='L7022'></a>  7022   <strong class='reserved'>if</strong> (!<a href='../S/2212.html#L1459' title='Defined at 1459 in src/xterm.h.'>FRAME_X_WAITING_FOR_DRAW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L7023' name='L7023'></a>  7023       <em class='comment'>/* The compositing manager can't draw a frame if it is</em>
<a id='L7024' name='L7024'></a>  7024 <em class='comment'>         unmapped.  */</em>
<a id='L7025' name='L7025'></a>  7025       || !<a href='../S/2183.html#L1152' title='Defined at 1152 in src/frame.h.'>FRAME_VISIBLE_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L7026' name='L7026'></a>  7026     <strong class='reserved'>return</strong>;
<a id='L7027' name='L7027'></a>  7027 
<a id='L7028' name='L7028'></a>  7028   dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L7029' name='L7029'></a>  7029 
<a id='L7030' name='L7030'></a>  7030   <em class='comment'>/* Wait for the frame drawn message to arrive.  */</em>
<a id='L7031' name='L7031'></a>  7031   <strong class='reserved'>if</strong> (<a href='../S/2289.html#L6880' title='Defined at 6880 in src/xterm.c.'>x_if_event</a> (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), &amp;event,
<a id='L7032' name='L7032'></a>  7032                   <a href='../S/2289.html#L6994' title='Defined at 6994 in src/xterm.c.'>x_sync_is_frame_drawn_event</a>, (XPointer) <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>,
<a id='L7033' name='L7033'></a>  7033                   <a href='../S/2788.html#L56' title='Defined at 56 in lib/timespec.h.'>make_timespec</a> (1, 0)))
<a id='L7034' name='L7034'></a>  7034     <em class='brace'>{</em>
<a id='L7035' name='L7035'></a>  7035       <em class='comment'>/* The first time a draw hangs, treat it as a random fluctuation</em>
<a id='L7036' name='L7036'></a>  7036 <em class='comment'>         on the part of the compositor.  If the next draw continues to</em>
<a id='L7037' name='L7037'></a>  7037 <em class='comment'>         hang, disable frame synchronization.  */</em>
<a id='L7038' name='L7038'></a>  7038       <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1461' title='Defined at 1461 in src/xterm.h.'>FRAME_X_DRAW_JUST_HUNG</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L7039' name='L7039'></a>  7039         <em class='brace'>{</em>
<a id='L7040' name='L7040'></a>  7040           <a href='../D/11675.html' title='Multiple defined in 4 places.'>fprintf</a> (<a href='../S/20.html#L50' title='Defined at 50 in nt/cmdproxy.c.'>stderr</a>, "Warning: compositing manager spent more than 1 "
<a id='L7041' name='L7041'></a>  7041                    "second drawing a frame.  Frame synchronization has "
<a id='L7042' name='L7042'></a>  7042                    "been disabled\n");
<a id='L7043' name='L7043'></a>  7043           <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;use_vsync_p = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L7044' name='L7044'></a>  7044 
<a id='L7045' name='L7045'></a>  7045           <em class='comment'>/* Remove the compositor bypass property from the outer</em>
<a id='L7046' name='L7046'></a>  7046 <em class='comment'>             window.  */</em>
<a id='L7047' name='L7047'></a>  7047           XDeleteProperty (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L7048' name='L7048'></a>  7048                            dpyinfo-&gt;Xatom_net_wm_bypass_compositor);
<a id='L7049' name='L7049'></a>  7049 
<a id='L7050' name='L7050'></a>  7050           <em class='comment'>/* Also change the frame parameter to reflect the new</em>
<a id='L7051' name='L7051'></a>  7051 <em class='comment'>             state.  */</em>
<a id='L7052' name='L7052'></a>  7052           <a href='../S/2247.html#L3214' title='Defined at 3214 in src/frame.c.'>store_frame_param</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, Quse_frame_synchronization, Qnil);
<a id='L7053' name='L7053'></a>  7053         <em class='brace'>}</em>
<a id='L7054' name='L7054'></a>  7054       <strong class='reserved'>else</strong>
<a id='L7055' name='L7055'></a>  7055         <em class='brace'>{</em>
<a id='L7056' name='L7056'></a>  7056           <a href='../D/11675.html' title='Multiple defined in 4 places.'>fprintf</a> (<a href='../S/20.html#L50' title='Defined at 50 in nt/cmdproxy.c.'>stderr</a>, "Warning: compositing manager spent more than 1 "
<a id='L7057' name='L7057'></a>  7057                    "second drawing a frame.  Frame synchronization will be "
<a id='L7058' name='L7058'></a>  7058                    "disabled if this happens again\n");
<a id='L7059' name='L7059'></a>  7059           <a href='../S/2212.html#L1461' title='Defined at 1461 in src/xterm.h.'>FRAME_X_DRAW_JUST_HUNG</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L7060' name='L7060'></a>  7060         <em class='brace'>}</em>
<a id='L7061' name='L7061'></a>  7061     <em class='brace'>}</em>
<a id='L7062' name='L7062'></a>  7062   <strong class='reserved'>else</strong>
<a id='L7063' name='L7063'></a>  7063     <a href='../S/2289.html#L6969' title='Defined at 6969 in src/xterm.c.'>x_sync_note_frame_times</a> (dpyinfo, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, &amp;event);
<a id='L7064' name='L7064'></a>  7064 
<a id='L7065' name='L7065'></a>  7065   <a href='../S/2212.html#L1459' title='Defined at 1459 in src/xterm.h.'>FRAME_X_WAITING_FOR_DRAW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L7066' name='L7066'></a>  7066 <em class='brace'>}</em>
<a id='L7067' name='L7067'></a>  7067 
<a id='L7068' name='L7068'></a>  7068 <em class='comment'>/* Tell the compositing manager to postpone updates of F until a frame</em>
<a id='L7069' name='L7069'></a>  7069 <em class='comment'>   has finished drawing.  */</em>
<a id='L7070' name='L7070'></a>  7070 
<a id='L7071' name='L7071'></a>  7071 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L7072' name='L7072'></a>  7072 <a href='../R/18352.html' title='Multiple referred from 2 places.'>x_sync_update_begin</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L7073' name='L7073'></a>  7073 <em class='brace'>{</em>
<a id='L7074' name='L7074'></a>  7074   XSyncValue <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>, <a href='../S/2741.html#L157' title='Defined at 157 in lib/nstrftime.c.'>add</a>;
<a id='L7075' name='L7075'></a>  7075   Bool overflow;
<a id='L7076' name='L7076'></a>  7076 
<a id='L7077' name='L7077'></a>  7077   <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1457' title='Defined at 1457 in src/xterm.h.'>FRAME_X_EXTENDED_COUNTER</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) == None)
<a id='L7078' name='L7078'></a>  7078     <strong class='reserved'>return</strong>;
<a id='L7079' name='L7079'></a>  7079 
<a id='L7080' name='L7080'></a>  7080   <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a> = <a href='../S/2212.html#L1463' title='Defined at 1463 in src/xterm.h.'>FRAME_X_COUNTER_VALUE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L7081' name='L7081'></a>  7081 
<a id='L7082' name='L7082'></a>  7082   <strong class='reserved'>if</strong> (<a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;ext_sync_end_pending_p)
<a id='L7083' name='L7083'></a>  7083     <em class='brace'>{</em>
<a id='L7084' name='L7084'></a>  7084       <a href='../S/2212.html#L1463' title='Defined at 1463 in src/xterm.h.'>FRAME_X_COUNTER_VALUE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L7085' name='L7085'></a>  7085         = <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;resize_counter_value;
<a id='L7086' name='L7086'></a>  7086 
<a id='L7087' name='L7087'></a>  7087       <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a> = <a href='../S/2212.html#L1463' title='Defined at 1463 in src/xterm.h.'>FRAME_X_COUNTER_VALUE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L7088' name='L7088'></a>  7088 
<a id='L7089' name='L7089'></a>  7089       <strong class='reserved'>if</strong> (XSyncValueLow32 (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>) % 2)
<a id='L7090' name='L7090'></a>  7090         <em class='brace'>{</em>
<a id='L7091' name='L7091'></a>  7091           XSyncIntToValue (&amp;<a href='../S/2741.html#L157' title='Defined at 157 in lib/nstrftime.c.'>add</a>, 1);
<a id='L7092' name='L7092'></a>  7092           XSyncValueAdd (&amp;<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>, <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>, <a href='../S/2741.html#L157' title='Defined at 157 in lib/nstrftime.c.'>add</a>, &amp;overflow);
<a id='L7093' name='L7093'></a>  7093 
<a id='L7094' name='L7094'></a>  7094           <strong class='reserved'>if</strong> (overflow)
<a id='L7095' name='L7095'></a>  7095             XSyncIntToValue (&amp;<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>, 0);
<a id='L7096' name='L7096'></a>  7096         <em class='brace'>}</em>
<a id='L7097' name='L7097'></a>  7097 
<a id='L7098' name='L7098'></a>  7098       <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;ext_sync_end_pending_p = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L7099' name='L7099'></a>  7099     <em class='brace'>}</em>
<a id='L7100' name='L7100'></a>  7100 
<a id='L7101' name='L7101'></a>  7101   <em class='comment'>/* Since a frame is already in progress, there is no point in</em>
<a id='L7102' name='L7102'></a>  7102 <em class='comment'>     continuing.  */</em>
<a id='L7103' name='L7103'></a>  7103   <strong class='reserved'>if</strong> (XSyncValueLow32 (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>) % 2)
<a id='L7104' name='L7104'></a>  7104     <strong class='reserved'>return</strong>;
<a id='L7105' name='L7105'></a>  7105 
<a id='L7106' name='L7106'></a>  7106   <em class='comment'>/* Wait for the last frame to be drawn before drawing this one.  */</em>
<a id='L7107' name='L7107'></a>  7107   <a href='../S/2289.html#L7017' title='Defined at 7017 in src/xterm.c.'>x_sync_wait_for_frame_drawn_event</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L7108' name='L7108'></a>  7108 
<a id='L7109' name='L7109'></a>  7109   <em class='comment'>/* Make a note of the time at which we started to draw this</em>
<a id='L7110' name='L7110'></a>  7110 <em class='comment'>     frame.  */</em>
<a id='L7111' name='L7111'></a>  7111   <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;temp_frame_time = <a href='../S/2289.html#L6953' title='Defined at 6953 in src/xterm.c.'>x_sync_current_monotonic_time</a> ();
<a id='L7112' name='L7112'></a>  7112 
<a id='L7113' name='L7113'></a>  7113   <em class='comment'>/* Since Emacs needs a non-urgent redraw, ensure that value % 4 ==</em>
<a id='L7114' name='L7114'></a>  7114 <em class='comment'>     1.  Later, add 3 to create the even counter value.  */</em>
<a id='L7115' name='L7115'></a>  7115   <strong class='reserved'>if</strong> (XSyncValueLow32 (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>) % 4 == 2)
<a id='L7116' name='L7116'></a>  7116     XSyncIntToValue (&amp;<a href='../S/2741.html#L157' title='Defined at 157 in lib/nstrftime.c.'>add</a>, 3);
<a id='L7117' name='L7117'></a>  7117   <strong class='reserved'>else</strong>
<a id='L7118' name='L7118'></a>  7118     XSyncIntToValue (&amp;<a href='../S/2741.html#L157' title='Defined at 157 in lib/nstrftime.c.'>add</a>, 1);
<a id='L7119' name='L7119'></a>  7119 
<a id='L7120' name='L7120'></a>  7120   XSyncValueAdd (&amp;<a href='../S/2212.html#L1463' title='Defined at 1463 in src/xterm.h.'>FRAME_X_COUNTER_VALUE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L7121' name='L7121'></a>  7121                  <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>, <a href='../S/2741.html#L157' title='Defined at 157 in lib/nstrftime.c.'>add</a>, &amp;overflow);
<a id='L7122' name='L7122'></a>  7122 
<a id='L7123' name='L7123'></a>  7123   <strong class='reserved'>if</strong> (overflow)
<a id='L7124' name='L7124'></a>  7124     XSyncIntToValue (&amp;<a href='../S/2212.html#L1463' title='Defined at 1463 in src/xterm.h.'>FRAME_X_COUNTER_VALUE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), 3);
<a id='L7125' name='L7125'></a>  7125 
<a id='L7126' name='L7126'></a>  7126   <a href='../D/10871.html' title='Multiple defined in 5 places.'>eassert</a> (XSyncValueLow32 (<a href='../S/2212.html#L1463' title='Defined at 1463 in src/xterm.h.'>FRAME_X_COUNTER_VALUE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)) % 4 == 1);
<a id='L7127' name='L7127'></a>  7127 
<a id='L7128' name='L7128'></a>  7128   XSyncSetCounter (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L7129' name='L7129'></a>  7129                    <a href='../S/2212.html#L1457' title='Defined at 1457 in src/xterm.h.'>FRAME_X_EXTENDED_COUNTER</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L7130' name='L7130'></a>  7130                    <a href='../S/2212.html#L1463' title='Defined at 1463 in src/xterm.h.'>FRAME_X_COUNTER_VALUE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L7131' name='L7131'></a>  7131 <em class='brace'>}</em>
<a id='L7132' name='L7132'></a>  7132 
<a id='L7133' name='L7133'></a>  7133 <em class='sharp'>#ifdef</em> HAVE_XSYNCTRIGGERFENCE
<a id='L7134' name='L7134'></a>  7134 
<a id='L7135' name='L7135'></a>  7135 <em class='comment'>/* Trigger the sync fence for counter VALUE immediately before a frame</em>
<a id='L7136' name='L7136'></a>  7136 <em class='comment'>   finishes.  */</em>
<a id='L7137' name='L7137'></a>  7137 
<a id='L7138' name='L7138'></a>  7138 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L7139' name='L7139'></a>  7139 <a href='../S/2289.html#L7246' title='Referred from 7246 in src/xterm.c.'>x_sync_trigger_fence</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, XSyncValue <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>)
<a id='L7140' name='L7140'></a>  7140 <em class='brace'>{</em>
<a id='L7141' name='L7141'></a>  7141   <a href='../D/18597.html' title='Multiple defined in 2 places.'>uint_fast64_t</a> n, low, high, idx;
<a id='L7142' name='L7142'></a>  7142 
<a id='L7143' name='L7143'></a>  7143   <em class='comment'>/* Sync fences aren't supported by the X server.  */</em>
<a id='L7144' name='L7144'></a>  7144   <strong class='reserved'>if</strong> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;xsync_major &lt; 3
<a id='L7145' name='L7145'></a>  7145       || (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;xsync_major == 3
<a id='L7146' name='L7146'></a>  7146           &amp;&amp; <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;xsync_minor &lt; 1))
<a id='L7147' name='L7147'></a>  7147     <strong class='reserved'>return</strong>;
<a id='L7148' name='L7148'></a>  7148 
<a id='L7149' name='L7149'></a>  7149   low = XSyncValueLow32 (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>);
<a id='L7150' name='L7150'></a>  7150   high = XSyncValueHigh32 (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>);
<a id='L7151' name='L7151'></a>  7151 
<a id='L7152' name='L7152'></a>  7152   n = low | (high &lt;&lt; 32);
<a id='L7153' name='L7153'></a>  7153   idx = (n / 4) % 2;
<a id='L7154' name='L7154'></a>  7154 
<a id='L7155' name='L7155'></a>  7155 <em class='sharp'>#ifdef</em> FRAME_DEBUG
<a id='L7156' name='L7156'></a>  7156   <a href='../D/11675.html' title='Multiple defined in 4 places.'>fprintf</a> (<a href='../S/20.html#L50' title='Defined at 50 in nt/cmdproxy.c.'>stderr</a>, "Triggering synchronization fence: %lu\n", idx);
<a id='L7157' name='L7157'></a>  7157 <em class='sharp'>#endif</em>
<a id='L7158' name='L7158'></a>  7158 
<a id='L7159' name='L7159'></a>  7159   XSyncTriggerFence (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L7160' name='L7160'></a>  7160                      <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;sync_fences[idx]);
<a id='L7161' name='L7161'></a>  7161 <em class='brace'>}</em>
<a id='L7162' name='L7162'></a>  7162 
<a id='L7163' name='L7163'></a>  7163 <em class='comment'>/* Initialize the sync fences on F.  */</em>
<a id='L7164' name='L7164'></a>  7164 
<a id='L7165' name='L7165'></a>  7165 <strong class='reserved'>void</strong>
<a id='L7166' name='L7166'></a>  7166 <a href='../R/18348.html' title='Multiple referred from 2 places.'>x_sync_init_fences</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L7167' name='L7167'></a>  7167 <em class='brace'>{</em>
<a id='L7168' name='L7168'></a>  7168   <strong class='reserved'>struct</strong> <a href='../D/19627.html' title='Multiple defined in 5 places.'>x_output</a> *output;
<a id='L7169' name='L7169'></a>  7169   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L7170' name='L7170'></a>  7170 
<a id='L7171' name='L7171'></a>  7171   output = <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L7172' name='L7172'></a>  7172   dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L7173' name='L7173'></a>  7173 
<a id='L7174' name='L7174'></a>  7174   <em class='comment'>/* Sync fences aren't supported by the X server.  */</em>
<a id='L7175' name='L7175'></a>  7175   <strong class='reserved'>if</strong> (dpyinfo-&gt;xsync_major &lt; 3
<a id='L7176' name='L7176'></a>  7176       || (dpyinfo-&gt;xsync_major == 3
<a id='L7177' name='L7177'></a>  7177           &amp;&amp; dpyinfo-&gt;xsync_minor &lt; 1))
<a id='L7178' name='L7178'></a>  7178     <strong class='reserved'>return</strong>;
<a id='L7179' name='L7179'></a>  7179 
<a id='L7180' name='L7180'></a>  7180   output-&gt;sync_fences[0]
<a id='L7181' name='L7181'></a>  7181     = XSyncCreateFence (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L7182' name='L7182'></a>  7182                         <em class='comment'>/* The drawable given below is only used to</em>
<a id='L7183' name='L7183'></a>  7183 <em class='comment'>                           determine the screen on which the fence is</em>
<a id='L7184' name='L7184'></a>  7184 <em class='comment'>                           created.  */</em>
<a id='L7185' name='L7185'></a>  7185                         <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L7186' name='L7186'></a>  7186                         False);
<a id='L7187' name='L7187'></a>  7187   output-&gt;sync_fences[1]
<a id='L7188' name='L7188'></a>  7188     = XSyncCreateFence (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L7189' name='L7189'></a>  7189                         <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L7190' name='L7190'></a>  7190                         False);
<a id='L7191' name='L7191'></a>  7191 
<a id='L7192' name='L7192'></a>  7192   XChangeProperty (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L7193' name='L7193'></a>  7193                    dpyinfo-&gt;Xatom_net_wm_sync_fences, XA_CARDINAL,
<a id='L7194' name='L7194'></a>  7194                    32, PropModeReplace,
<a id='L7195' name='L7195'></a>  7195                    (<strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *) &amp;output-&gt;sync_fences, 2);
<a id='L7196' name='L7196'></a>  7196 <em class='brace'>}</em>
<a id='L7197' name='L7197'></a>  7197 
<a id='L7198' name='L7198'></a>  7198 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L7199' name='L7199'></a>  7199 <a href='../S/2289.html#L29076' title='Referred from 29076 in src/xterm.c.'>x_sync_free_fences</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L7200' name='L7200'></a>  7200 <em class='brace'>{</em>
<a id='L7201' name='L7201'></a>  7201   <strong class='reserved'>if</strong> (<a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;sync_fences[0] != None)
<a id='L7202' name='L7202'></a>  7202     XSyncDestroyFence (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L7203' name='L7203'></a>  7203                        <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;sync_fences[0]);
<a id='L7204' name='L7204'></a>  7204 
<a id='L7205' name='L7205'></a>  7205   <strong class='reserved'>if</strong> (<a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;sync_fences[1] != None)
<a id='L7206' name='L7206'></a>  7206     XSyncDestroyFence (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L7207' name='L7207'></a>  7207                        <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;sync_fences[1]);
<a id='L7208' name='L7208'></a>  7208 <em class='brace'>}</em>
<a id='L7209' name='L7209'></a>  7209 
<a id='L7210' name='L7210'></a>  7210 <em class='sharp'>#endif</em>
<a id='L7211' name='L7211'></a>  7211 
<a id='L7212' name='L7212'></a>  7212 <em class='comment'>/* Tell the compositing manager that FRAME has been drawn and can be</em>
<a id='L7213' name='L7213'></a>  7213 <em class='comment'>   updated.  */</em>
<a id='L7214' name='L7214'></a>  7214 
<a id='L7215' name='L7215'></a>  7215 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L7216' name='L7216'></a>  7216 <a href='../R/18353.html' title='Multiple referred from 2 places.'>x_sync_update_finish</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L7217' name='L7217'></a>  7217 <em class='brace'>{</em>
<a id='L7218' name='L7218'></a>  7218   XSyncValue <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>, <a href='../S/2741.html#L157' title='Defined at 157 in lib/nstrftime.c.'>add</a>;
<a id='L7219' name='L7219'></a>  7219   Bool overflow;
<a id='L7220' name='L7220'></a>  7220 
<a id='L7221' name='L7221'></a>  7221   <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1457' title='Defined at 1457 in src/xterm.h.'>FRAME_X_EXTENDED_COUNTER</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) == None)
<a id='L7222' name='L7222'></a>  7222     <strong class='reserved'>return</strong>;
<a id='L7223' name='L7223'></a>  7223 
<a id='L7224' name='L7224'></a>  7224   <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a> = <a href='../S/2212.html#L1463' title='Defined at 1463 in src/xterm.h.'>FRAME_X_COUNTER_VALUE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L7225' name='L7225'></a>  7225 
<a id='L7226' name='L7226'></a>  7226   <strong class='reserved'>if</strong> (!(XSyncValueLow32 (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>) % 2))
<a id='L7227' name='L7227'></a>  7227     <strong class='reserved'>return</strong>;
<a id='L7228' name='L7228'></a>  7228 
<a id='L7229' name='L7229'></a>  7229   <strong class='reserved'>if</strong> ((XSyncValueLow32 (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>) % 4) == 1)
<a id='L7230' name='L7230'></a>  7230     <em class='comment'>/* This means the frame is non-urgent and should be drawn at the</em>
<a id='L7231' name='L7231'></a>  7231 <em class='comment'>       next redraw point.  */</em>
<a id='L7232' name='L7232'></a>  7232     XSyncIntToValue (&amp;<a href='../S/2741.html#L157' title='Defined at 157 in lib/nstrftime.c.'>add</a>, 3);
<a id='L7233' name='L7233'></a>  7233   <strong class='reserved'>else</strong>
<a id='L7234' name='L7234'></a>  7234     <em class='comment'>/* Otherwise, the frame is urgent and should be drawn as soon as</em>
<a id='L7235' name='L7235'></a>  7235 <em class='comment'>       possible.  */</em>
<a id='L7236' name='L7236'></a>  7236     XSyncIntToValue (&amp;<a href='../S/2741.html#L157' title='Defined at 157 in lib/nstrftime.c.'>add</a>, 1);
<a id='L7237' name='L7237'></a>  7237 
<a id='L7238' name='L7238'></a>  7238   XSyncValueAdd (&amp;<a href='../S/2212.html#L1463' title='Defined at 1463 in src/xterm.h.'>FRAME_X_COUNTER_VALUE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L7239' name='L7239'></a>  7239                  <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>, <a href='../S/2741.html#L157' title='Defined at 157 in lib/nstrftime.c.'>add</a>, &amp;overflow);
<a id='L7240' name='L7240'></a>  7240 
<a id='L7241' name='L7241'></a>  7241   <strong class='reserved'>if</strong> (overflow)
<a id='L7242' name='L7242'></a>  7242     XSyncIntToValue (&amp;<a href='../S/2212.html#L1463' title='Defined at 1463 in src/xterm.h.'>FRAME_X_COUNTER_VALUE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), 0);
<a id='L7243' name='L7243'></a>  7243 
<a id='L7244' name='L7244'></a>  7244   <em class='comment'>/* Trigger any sync fences if necessary.  */</em>
<a id='L7245' name='L7245'></a>  7245 <em class='sharp'>#ifdef</em> HAVE_XSYNCTRIGGERFENCE
<a id='L7246' name='L7246'></a>  7246   <a href='../S/2289.html#L7139' title='Defined at 7139 in src/xterm.c.'>x_sync_trigger_fence</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/2212.html#L1463' title='Defined at 1463 in src/xterm.h.'>FRAME_X_COUNTER_VALUE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L7247' name='L7247'></a>  7247 <em class='sharp'>#endif</em>
<a id='L7248' name='L7248'></a>  7248 
<a id='L7249' name='L7249'></a>  7249   XSyncSetCounter (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L7250' name='L7250'></a>  7250                    <a href='../S/2212.html#L1457' title='Defined at 1457 in src/xterm.h.'>FRAME_X_EXTENDED_COUNTER</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L7251' name='L7251'></a>  7251                    <a href='../S/2212.html#L1463' title='Defined at 1463 in src/xterm.h.'>FRAME_X_COUNTER_VALUE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L7252' name='L7252'></a>  7252 
<a id='L7253' name='L7253'></a>  7253   <strong class='reserved'>if</strong> (<a href='../D/2368.html' title='Multiple defined in 7 places.'>FRAME_OUTPUT_DATA</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;use_vsync_p)
<a id='L7254' name='L7254'></a>  7254     <a href='../S/2212.html#L1459' title='Defined at 1459 in src/xterm.h.'>FRAME_X_WAITING_FOR_DRAW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L7255' name='L7255'></a>  7255 <em class='brace'>}</em>
<a id='L7256' name='L7256'></a>  7256 
<a id='L7257' name='L7257'></a>  7257 <em class='comment'>/* Handle a _NET_WM_FRAME_DRAWN message from the compositor.  */</em>
<a id='L7258' name='L7258'></a>  7258 
<a id='L7259' name='L7259'></a>  7259 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L7260' name='L7260'></a>  7260 <a href='../S/2289.html#L19134' title='Referred from 19134 in src/xterm.c.'>x_sync_handle_frame_drawn</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L7261' name='L7261'></a>  7261                            XEvent *<a href='../D/14458.html' title='Multiple defined in 2 places.'>message</a>, <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L7262' name='L7262'></a>  7262 <em class='brace'>{</em>
<a id='L7263' name='L7263'></a>  7263   XSyncValue <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>, counter;
<a id='L7264' name='L7264'></a>  7264 
<a id='L7265' name='L7265'></a>  7265   <strong class='reserved'>if</strong> (<a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) == <a href='../D/14458.html' title='Multiple defined in 2 places.'>message</a>-&gt;xclient.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>)
<a id='L7266' name='L7266'></a>  7266     <em class='brace'>{</em>
<a id='L7267' name='L7267'></a>  7267       counter = <a href='../S/2212.html#L1463' title='Defined at 1463 in src/xterm.h.'>FRAME_X_COUNTER_VALUE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L7268' name='L7268'></a>  7268 
<a id='L7269' name='L7269'></a>  7269       <em class='comment'>/* Check that the counter in the message is the same as the</em>
<a id='L7270' name='L7270'></a>  7270 <em class='comment'>         counter in the frame.  */</em>
<a id='L7271' name='L7271'></a>  7271       XSyncIntsToValue (&amp;<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>,
<a id='L7272' name='L7272'></a>  7272                         <a href='../D/14458.html' title='Multiple defined in 2 places.'>message</a>-&gt;xclient.data.l[0] &amp; 0xffffffff,
<a id='L7273' name='L7273'></a>  7273                         <a href='../D/14458.html' title='Multiple defined in 2 places.'>message</a>-&gt;xclient.data.l[1] &amp; 0xffffffff);
<a id='L7274' name='L7274'></a>  7274 
<a id='L7275' name='L7275'></a>  7275       <strong class='reserved'>if</strong> (XSyncValueEqual (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>, counter))
<a id='L7276' name='L7276'></a>  7276         <a href='../S/2212.html#L1459' title='Defined at 1459 in src/xterm.h.'>FRAME_X_WAITING_FOR_DRAW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L7277' name='L7277'></a>  7277 
<a id='L7278' name='L7278'></a>  7278       <em class='comment'>/* As long as a _NET_WM_FRAME_DRAWN message arrives, we know</em>
<a id='L7279' name='L7279'></a>  7279 <em class='comment'>         that the compositor is still sending events, so avoid timing</em>
<a id='L7280' name='L7280'></a>  7280 <em class='comment'>         out.  */</em>
<a id='L7281' name='L7281'></a>  7281       <a href='../S/2212.html#L1461' title='Defined at 1461 in src/xterm.h.'>FRAME_X_DRAW_JUST_HUNG</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L7282' name='L7282'></a>  7282     <em class='brace'>}</em>
<a id='L7283' name='L7283'></a>  7283 
<a id='L7284' name='L7284'></a>  7284   <a href='../S/2289.html#L6969' title='Defined at 6969 in src/xterm.c.'>x_sync_note_frame_times</a> (dpyinfo, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/14458.html' title='Multiple defined in 2 places.'>message</a>);
<a id='L7285' name='L7285'></a>  7285 <em class='brace'>}</em>
<a id='L7286' name='L7286'></a>  7286 <em class='sharp'>#endif</em>
<a id='L7287' name='L7287'></a>  7287 
<a id='L7288' name='L7288'></a>  7288 <em class='comment'>/* Start an update of frame F.  This function is installed as a hook</em>
<a id='L7289' name='L7289'></a>  7289 <em class='comment'>   for update_begin, i.e. it is called when update_begin is called.</em>
<a id='L7290' name='L7290'></a>  7290 <em class='comment'>   This function is called prior to calls to gui_update_window_begin for</em>
<a id='L7291' name='L7291'></a>  7291 <em class='comment'>   each window being updated.  Currently, there is nothing to do here</em>
<a id='L7292' name='L7292'></a>  7292 <em class='comment'>   because all interesting stuff is done on a window basis.  */</em>
<a id='L7293' name='L7293'></a>  7293 
<a id='L7294' name='L7294'></a>  7294 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L7295' name='L7295'></a>  7295 <a href='../S/2289.html#L31531' title='Referred from 31531 in src/xterm.c.'>x_update_begin</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L7296' name='L7296'></a>  7296 <em class='brace'>{</em>
<a id='L7297' name='L7297'></a>  7297 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XSYNC &amp;&amp; !<strong class='reserved'>defined</strong> USE_GTK &amp;&amp; <strong class='reserved'>defined</strong> HAVE_CLOCK_GETTIME
<a id='L7298' name='L7298'></a>  7298   <em class='comment'>/* If F is double-buffered, we can make the entire frame center</em>
<a id='L7299' name='L7299'></a>  7299 <em class='comment'>     around XdbeSwapBuffers.  */</em>
<a id='L7300' name='L7300'></a>  7300 <em class='sharp'>#ifdef</em> HAVE_XDBE
<a id='L7301' name='L7301'></a>  7301   <strong class='reserved'>if</strong> (!<a href='../S/2212.html#L1356' title='Defined at 1356 in src/xterm.h.'>FRAME_X_DOUBLE_BUFFERED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L7302' name='L7302'></a>  7302 <em class='sharp'>#endif</em>
<a id='L7303' name='L7303'></a>  7303     <a href='../S/2289.html#L7072' title='Defined at 7072 in src/xterm.c.'>x_sync_update_begin</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L7304' name='L7304'></a>  7304 <em class='sharp'>#else</em>
<a id='L7305' name='L7305'></a>  7305   <em class='comment'>/* Nothing to do.  */</em>
<a id='L7306' name='L7306'></a>  7306 <em class='sharp'>#endif</em>
<a id='L7307' name='L7307'></a>  7307 
<a id='L7308' name='L7308'></a>  7308 <em class='sharp'>#ifdef</em> HAVE_XDBE
<a id='L7309' name='L7309'></a>  7309   <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1356' title='Defined at 1356 in src/xterm.h.'>FRAME_X_DOUBLE_BUFFERED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L7310' name='L7310'></a>  7310     <em class='comment'>/* The frame is no longer complete, as it is in the midst of an</em>
<a id='L7311' name='L7311'></a>  7311 <em class='comment'>       update.  */</em>
<a id='L7312' name='L7312'></a>  7312     <a href='../S/2212.html#L1364' title='Defined at 1364 in src/xterm.h.'>FRAME_X_COMPLETE_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L7313' name='L7313'></a>  7313 <em class='sharp'>#endif</em>
<a id='L7314' name='L7314'></a>  7314 <em class='brace'>}</em>
<a id='L7315' name='L7315'></a>  7315 
<a id='L7316' name='L7316'></a>  7316 <em class='comment'>/* Draw a vertical window border from (x,y0) to (x,y1)  */</em>
<a id='L7317' name='L7317'></a>  7317 
<a id='L7318' name='L7318'></a>  7318 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L7319' name='L7319'></a>  7319 <a href='../S/2289.html#L31339' title='Referred from 31339 in src/xterm.c.'>x_draw_vertical_window_border</a> (<strong class='reserved'>struct</strong> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> *w, <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, <strong class='reserved'>int</strong> <a href='../D/20169.html' title='Multiple defined in 2 places.'>y0</a>, <strong class='reserved'>int</strong> <a href='../D/20170.html' title='Multiple defined in 2 places.'>y1</a>)
<a id='L7320' name='L7320'></a>  7320 <em class='brace'>{</em>
<a id='L7321' name='L7321'></a>  7321   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../S/2183.html#L914' title='Defined at 914 in src/frame.h.'>WINDOW_FRAME</a> (w));
<a id='L7322' name='L7322'></a>  7322   <strong class='reserved'>struct</strong> <a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a> *<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>;
<a id='L7323' name='L7323'></a>  7323 
<a id='L7324' name='L7324'></a>  7324   <a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a> = <a href='../S/2183.html#L1642' title='Defined at 1642 in src/frame.h.'>FACE_FROM_ID_OR_NULL</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/2315.html#L1891' title='Defined at 1891 in src/dispextern.h.'>VERTICAL_BORDER_FACE_ID</a>);
<a id='L7325' name='L7325'></a>  7325   <strong class='reserved'>if</strong> (<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>)
<a id='L7326' name='L7326'></a>  7326     XSetForeground (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;normal_gc,
<a id='L7327' name='L7327'></a>  7327                     <a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;foreground);
<a id='L7328' name='L7328'></a>  7328 
<a id='L7329' name='L7329'></a>  7329 <em class='sharp'>#ifdef</em> USE_CAIRO
<a id='L7330' name='L7330'></a>  7330   <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;normal_gc, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, <a href='../D/20169.html' title='Multiple defined in 2 places.'>y0</a>, 1, <a href='../D/20170.html' title='Multiple defined in 2 places.'>y1</a> - <a href='../D/20169.html' title='Multiple defined in 2 places.'>y0</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L7331' name='L7331'></a>  7331 <em class='sharp'>#else</em>
<a id='L7332' name='L7332'></a>  7332   XDrawLine (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../S/2212.html#L1352' title='Defined at 1352 in src/xterm.h.'>FRAME_X_DRAWABLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L7333' name='L7333'></a>  7333              <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;normal_gc, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, <a href='../D/20169.html' title='Multiple defined in 2 places.'>y0</a>, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, <a href='../D/20170.html' title='Multiple defined in 2 places.'>y1</a>);
<a id='L7334' name='L7334'></a>  7334 <em class='sharp'>#endif</em>
<a id='L7335' name='L7335'></a>  7335 <em class='brace'>}</em>
<a id='L7336' name='L7336'></a>  7336 
<a id='L7337' name='L7337'></a>  7337 <em class='comment'>/* Draw a window divider from (x0,y0) to (x1,y1)  */</em>
<a id='L7338' name='L7338'></a>  7338 
<a id='L7339' name='L7339'></a>  7339 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L7340' name='L7340'></a>  7340 <a href='../S/2289.html#L31340' title='Referred from 31340 in src/xterm.c.'>x_draw_window_divider</a> (<strong class='reserved'>struct</strong> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> *w, <strong class='reserved'>int</strong> x0, <strong class='reserved'>int</strong> x1, <strong class='reserved'>int</strong> <a href='../D/20169.html' title='Multiple defined in 2 places.'>y0</a>, <strong class='reserved'>int</strong> <a href='../D/20170.html' title='Multiple defined in 2 places.'>y1</a>)
<a id='L7341' name='L7341'></a>  7341 <em class='brace'>{</em>
<a id='L7342' name='L7342'></a>  7342   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../S/2183.html#L914' title='Defined at 914 in src/frame.h.'>WINDOW_FRAME</a> (w));
<a id='L7343' name='L7343'></a>  7343   <strong class='reserved'>struct</strong> <a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a> *<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a> = <a href='../S/2183.html#L1642' title='Defined at 1642 in src/frame.h.'>FACE_FROM_ID_OR_NULL</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/2315.html#L1892' title='Defined at 1892 in src/dispextern.h.'>WINDOW_DIVIDER_FACE_ID</a>);
<a id='L7344' name='L7344'></a>  7344   <strong class='reserved'>struct</strong> <a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a> *face_first
<a id='L7345' name='L7345'></a>  7345     = <a href='../S/2183.html#L1642' title='Defined at 1642 in src/frame.h.'>FACE_FROM_ID_OR_NULL</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/2315.html#L1893' title='Defined at 1893 in src/dispextern.h.'>WINDOW_DIVIDER_FIRST_PIXEL_FACE_ID</a>);
<a id='L7346' name='L7346'></a>  7346   <strong class='reserved'>struct</strong> <a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a> *face_last
<a id='L7347' name='L7347'></a>  7347     = <a href='../S/2183.html#L1642' title='Defined at 1642 in src/frame.h.'>FACE_FROM_ID_OR_NULL</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/2315.html#L1894' title='Defined at 1894 in src/dispextern.h.'>WINDOW_DIVIDER_LAST_PIXEL_FACE_ID</a>);
<a id='L7348' name='L7348'></a>  7348   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> color = <a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a> ? <a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;foreground : <a href='../S/2183.html#L1376' title='Defined at 1376 in src/frame.h.'>FRAME_FOREGROUND_PIXEL</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L7349' name='L7349'></a>  7349   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> color_first = (face_first
<a id='L7350' name='L7350'></a>  7350                                ? face_first-&gt;foreground
<a id='L7351' name='L7351'></a>  7351                                : <a href='../S/2183.html#L1376' title='Defined at 1376 in src/frame.h.'>FRAME_FOREGROUND_PIXEL</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L7352' name='L7352'></a>  7352   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> color_last = (face_last
<a id='L7353' name='L7353'></a>  7353                               ? face_last-&gt;foreground
<a id='L7354' name='L7354'></a>  7354                               : <a href='../S/2183.html#L1376' title='Defined at 1376 in src/frame.h.'>FRAME_FOREGROUND_PIXEL</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L7355' name='L7355'></a>  7355   <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> = <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L7356' name='L7356'></a>  7356 
<a id='L7357' name='L7357'></a>  7357   <strong class='reserved'>if</strong> ((<a href='../D/20170.html' title='Multiple defined in 2 places.'>y1</a> - <a href='../D/20169.html' title='Multiple defined in 2 places.'>y0</a> &gt; x1 - x0) &amp;&amp; (x1 - x0 &gt;= 3))
<a id='L7358' name='L7358'></a>  7358     <em class='comment'>/* A vertical divider, at least three pixels wide: Draw first and</em>
<a id='L7359' name='L7359'></a>  7359 <em class='comment'>       last pixels differently.  */</em>
<a id='L7360' name='L7360'></a>  7360     <em class='brace'>{</em>
<a id='L7361' name='L7361'></a>  7361       XSetForeground (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;normal_gc, color_first);
<a id='L7362' name='L7362'></a>  7362       <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;normal_gc,
<a id='L7363' name='L7363'></a>  7363                         x0, <a href='../D/20169.html' title='Multiple defined in 2 places.'>y0</a>, 1, <a href='../D/20170.html' title='Multiple defined in 2 places.'>y1</a> - <a href='../D/20169.html' title='Multiple defined in 2 places.'>y0</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L7364' name='L7364'></a>  7364       XSetForeground (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;normal_gc, color);
<a id='L7365' name='L7365'></a>  7365       <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;normal_gc,
<a id='L7366' name='L7366'></a>  7366                         x0 + 1, <a href='../D/20169.html' title='Multiple defined in 2 places.'>y0</a>, x1 - x0 - 2, <a href='../D/20170.html' title='Multiple defined in 2 places.'>y1</a> - <a href='../D/20169.html' title='Multiple defined in 2 places.'>y0</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L7367' name='L7367'></a>  7367       XSetForeground (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;normal_gc, color_last);
<a id='L7368' name='L7368'></a>  7368       <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;normal_gc,
<a id='L7369' name='L7369'></a>  7369                         x1 - 1, <a href='../D/20169.html' title='Multiple defined in 2 places.'>y0</a>, 1, <a href='../D/20170.html' title='Multiple defined in 2 places.'>y1</a> - <a href='../D/20169.html' title='Multiple defined in 2 places.'>y0</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L7370' name='L7370'></a>  7370     <em class='brace'>}</em>
<a id='L7371' name='L7371'></a>  7371   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> ((x1 - x0 &gt; <a href='../D/20170.html' title='Multiple defined in 2 places.'>y1</a> - <a href='../D/20169.html' title='Multiple defined in 2 places.'>y0</a>) &amp;&amp; (<a href='../D/20170.html' title='Multiple defined in 2 places.'>y1</a> - <a href='../D/20169.html' title='Multiple defined in 2 places.'>y0</a> &gt;= 3))
<a id='L7372' name='L7372'></a>  7372     <em class='comment'>/* A horizontal divider, at least three pixels high: Draw first and</em>
<a id='L7373' name='L7373'></a>  7373 <em class='comment'>       last pixels differently.  */</em>
<a id='L7374' name='L7374'></a>  7374     <em class='brace'>{</em>
<a id='L7375' name='L7375'></a>  7375       XSetForeground (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;normal_gc, color_first);
<a id='L7376' name='L7376'></a>  7376       <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;normal_gc,
<a id='L7377' name='L7377'></a>  7377                         x0, <a href='../D/20169.html' title='Multiple defined in 2 places.'>y0</a>, x1 - x0, 1, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L7378' name='L7378'></a>  7378       XSetForeground (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;normal_gc, color);
<a id='L7379' name='L7379'></a>  7379       <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;normal_gc,
<a id='L7380' name='L7380'></a>  7380                         x0, <a href='../D/20169.html' title='Multiple defined in 2 places.'>y0</a> + 1, x1 - x0, <a href='../D/20170.html' title='Multiple defined in 2 places.'>y1</a> - <a href='../D/20169.html' title='Multiple defined in 2 places.'>y0</a> - 2, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L7381' name='L7381'></a>  7381       XSetForeground (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;normal_gc, color_last);
<a id='L7382' name='L7382'></a>  7382       <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;normal_gc,
<a id='L7383' name='L7383'></a>  7383                         x0, <a href='../D/20170.html' title='Multiple defined in 2 places.'>y1</a> - 1, x1 - x0, 1, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L7384' name='L7384'></a>  7384     <em class='brace'>}</em>
<a id='L7385' name='L7385'></a>  7385   <strong class='reserved'>else</strong>
<a id='L7386' name='L7386'></a>  7386     <em class='brace'>{</em>
<a id='L7387' name='L7387'></a>  7387     <em class='comment'>/* In any other case do not draw the first and last pixels</em>
<a id='L7388' name='L7388'></a>  7388 <em class='comment'>       differently.  */</em>
<a id='L7389' name='L7389'></a>  7389       XSetForeground (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;normal_gc, color);
<a id='L7390' name='L7390'></a>  7390       <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;normal_gc,
<a id='L7391' name='L7391'></a>  7391                         x0, <a href='../D/20169.html' title='Multiple defined in 2 places.'>y0</a>, x1 - x0, <a href='../D/20170.html' title='Multiple defined in 2 places.'>y1</a> - <a href='../D/20169.html' title='Multiple defined in 2 places.'>y0</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L7392' name='L7392'></a>  7392     <em class='brace'>}</em>
<a id='L7393' name='L7393'></a>  7393 <em class='brace'>}</em>
<a id='L7394' name='L7394'></a>  7394 
<a id='L7395' name='L7395'></a>  7395 <em class='sharp'>#ifdef</em> HAVE_XDBE
<a id='L7396' name='L7396'></a>  7396 
<a id='L7397' name='L7397'></a>  7397 <em class='comment'>/* Show the frame back buffer.  If frame is double-buffered,</em>
<a id='L7398' name='L7398'></a>  7398 <em class='comment'>   atomically publish to the user's screen graphics updates made since</em>
<a id='L7399' name='L7399'></a>  7399 <em class='comment'>   the last call to show_back_buffer.  */</em>
<a id='L7400' name='L7400'></a>  7400 
<a id='L7401' name='L7401'></a>  7401 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L7402' name='L7402'></a>  7402 <a href='../R/16140.html' title='Multiple referred from 11 places.'>show_back_buffer</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L7403' name='L7403'></a>  7403 <em class='brace'>{</em>
<a id='L7404' name='L7404'></a>  7404   XdbeSwapInfo swap_info;
<a id='L7405' name='L7405'></a>  7405 <em class='sharp'>#ifdef</em> USE_CAIRO
<a id='L7406' name='L7406'></a>  7406   cairo_t *cr;
<a id='L7407' name='L7407'></a>  7407 <em class='sharp'>#endif</em>
<a id='L7408' name='L7408'></a>  7408 
<a id='L7409' name='L7409'></a>  7409   <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1356' title='Defined at 1356 in src/xterm.h.'>FRAME_X_DOUBLE_BUFFERED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L7410' name='L7410'></a>  7410     <em class='brace'>{</em>
<a id='L7411' name='L7411'></a>  7411 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XSYNC &amp;&amp; !<strong class='reserved'>defined</strong> USE_GTK &amp;&amp; <strong class='reserved'>defined</strong> HAVE_CLOCK_GETTIME
<a id='L7412' name='L7412'></a>  7412       <em class='comment'>/* Wait for drawing of the previous frame to complete before</em>
<a id='L7413' name='L7413'></a>  7413 <em class='comment'>         displaying this new frame.  */</em>
<a id='L7414' name='L7414'></a>  7414       <a href='../S/2289.html#L7017' title='Defined at 7017 in src/xterm.c.'>x_sync_wait_for_frame_drawn_event</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L7415' name='L7415'></a>  7415 
<a id='L7416' name='L7416'></a>  7416       <em class='comment'>/* Begin a new frame.  */</em>
<a id='L7417' name='L7417'></a>  7417       <a href='../S/2289.html#L7072' title='Defined at 7072 in src/xterm.c.'>x_sync_update_begin</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L7418' name='L7418'></a>  7418 <em class='sharp'>#endif</em>
<a id='L7419' name='L7419'></a>  7419 
<a id='L7420' name='L7420'></a>  7420 <em class='sharp'>#ifdef</em> USE_CAIRO
<a id='L7421' name='L7421'></a>  7421       cr = <a href='../D/2280.html' title='Multiple defined in 3 places.'>FRAME_CR_CONTEXT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L7422' name='L7422'></a>  7422       <strong class='reserved'>if</strong> (cr)
<a id='L7423' name='L7423'></a>  7423         cairo_surface_flush (cairo_get_target (cr));
<a id='L7424' name='L7424'></a>  7424 <em class='sharp'>#endif</em>
<a id='L7425' name='L7425'></a>  7425       memset (&amp;swap_info, 0, <strong class='reserved'>sizeof</strong> (swap_info));
<a id='L7426' name='L7426'></a>  7426       swap_info.swap_window = <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L7427' name='L7427'></a>  7427       swap_info.swap_action = XdbeCopied;
<a id='L7428' name='L7428'></a>  7428       XdbeSwapBuffers (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), &amp;swap_info, 1);
<a id='L7429' name='L7429'></a>  7429 
<a id='L7430' name='L7430'></a>  7430 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XSYNC &amp;&amp; !<strong class='reserved'>defined</strong> USE_GTK &amp;&amp; <strong class='reserved'>defined</strong> HAVE_CLOCK_GETTIME
<a id='L7431' name='L7431'></a>  7431       <em class='comment'>/* Finish the frame here.  */</em>
<a id='L7432' name='L7432'></a>  7432       <a href='../S/2289.html#L7216' title='Defined at 7216 in src/xterm.c.'>x_sync_update_finish</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L7433' name='L7433'></a>  7433 <em class='sharp'>#endif</em>
<a id='L7434' name='L7434'></a>  7434     <em class='brace'>}</em>
<a id='L7435' name='L7435'></a>  7435 
<a id='L7436' name='L7436'></a>  7436   <a href='../S/2212.html#L1360' title='Defined at 1360 in src/xterm.h.'>FRAME_X_NEED_BUFFER_FLIP</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L7437' name='L7437'></a>  7437 <em class='brace'>}</em>
<a id='L7438' name='L7438'></a>  7438 
<a id='L7439' name='L7439'></a>  7439 <em class='sharp'>#endif</em>
<a id='L7440' name='L7440'></a>  7440 
<a id='L7441' name='L7441'></a>  7441 <em class='comment'>/* Updates back buffer and flushes changes to display.  Called from</em>
<a id='L7442' name='L7442'></a>  7442 <em class='comment'>   minibuf read code.  Note that we display the back buffer even if</em>
<a id='L7443' name='L7443'></a>  7443 <em class='comment'>   buffer flipping is blocked.  */</em>
<a id='L7444' name='L7444'></a>  7444 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L7445' name='L7445'></a>  7445 <a href='../S/2289.html#L31321' title='Referred from 31321 in src/xterm.c.'>x_flip_and_flush</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L7446' name='L7446'></a>  7446 <em class='brace'>{</em>
<a id='L7447' name='L7447'></a>  7447   <em class='comment'>/* Flipping buffers requires a working connection to the X server,</em>
<a id='L7448' name='L7448'></a>  7448 <em class='comment'>     which isn't always present if `inhibit-redisplay' is t, since</em>
<a id='L7449' name='L7449'></a>  7449 <em class='comment'>     this can be called from the IO error handler.  */</em>
<a id='L7450' name='L7450'></a>  7450   <strong class='reserved'>if</strong> (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (Vinhibit_redisplay)
<a id='L7451' name='L7451'></a>  7451       <em class='comment'>/* This has to work for tooltip frames, however, and redisplay</em>
<a id='L7452' name='L7452'></a>  7452 <em class='comment'>         cannot happen when they are being flushed anyway.  (bug#55519) */</em>
<a id='L7453' name='L7453'></a>  7453       &amp;&amp; !<a href='../D/2425.html' title='Multiple defined in 2 places.'>FRAME_TOOLTIP_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L7454' name='L7454'></a>  7454     <strong class='reserved'>return</strong>;
<a id='L7455' name='L7455'></a>  7455 
<a id='L7456' name='L7456'></a>  7456   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L7457' name='L7457'></a>  7457 <em class='sharp'>#ifdef</em> HAVE_XDBE
<a id='L7458' name='L7458'></a>  7458   <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1360' title='Defined at 1360 in src/xterm.h.'>FRAME_X_NEED_BUFFER_FLIP</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L7459' name='L7459'></a>  7459     <a href='../D/17419.html' title='Multiple defined in 2 places.'>show_back_buffer</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L7460' name='L7460'></a>  7460 
<a id='L7461' name='L7461'></a>  7461   <em class='comment'>/* The frame is complete again as its contents were just</em>
<a id='L7462' name='L7462'></a>  7462 <em class='comment'>     flushed.  */</em>
<a id='L7463' name='L7463'></a>  7463   <a href='../S/2212.html#L1364' title='Defined at 1364 in src/xterm.h.'>FRAME_X_COMPLETE_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L7464' name='L7464'></a>  7464 <em class='sharp'>#endif</em>
<a id='L7465' name='L7465'></a>  7465   <a href='../S/2289.html#L5056' title='Defined at 5056 in src/xterm.c.'>x_flush</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L7466' name='L7466'></a>  7466   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L7467' name='L7467'></a>  7467 <em class='brace'>}</em>
<a id='L7468' name='L7468'></a>  7468 
<a id='L7469' name='L7469'></a>  7469 <em class='comment'>/* End update of frame F.  This function is installed as a hook in</em>
<a id='L7470' name='L7470'></a>  7470 <em class='comment'>   update_end.  */</em>
<a id='L7471' name='L7471'></a>  7471 
<a id='L7472' name='L7472'></a>  7472 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L7473' name='L7473'></a>  7473 <a href='../S/2289.html#L31532' title='Referred from 31532 in src/xterm.c.'>x_update_end</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L7474' name='L7474'></a>  7474 <em class='brace'>{</em>
<a id='L7475' name='L7475'></a>  7475   <em class='comment'>/* Mouse highlight may be displayed again.  */</em>
<a id='L7476' name='L7476'></a>  7476   <a href='../D/4164.html' title='Multiple defined in 3 places.'>MOUSE_HL_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;mouse_face_defer = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L7477' name='L7477'></a>  7477 
<a id='L7478' name='L7478'></a>  7478 <em class='sharp'>#ifdef</em> USE_CAIRO
<a id='L7479' name='L7479'></a>  7479 <em class='sharp'># ifdef</em> HAVE_XDBE
<a id='L7480' name='L7480'></a>  7480   <strong class='reserved'>if</strong> (!<a href='../S/2212.html#L1356' title='Defined at 1356 in src/xterm.h.'>FRAME_X_DOUBLE_BUFFERED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) &amp;&amp; <a href='../D/2280.html' title='Multiple defined in 3 places.'>FRAME_CR_CONTEXT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L7481' name='L7481'></a>  7481     cairo_surface_flush (cairo_get_target (<a href='../D/2280.html' title='Multiple defined in 3 places.'>FRAME_CR_CONTEXT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)));
<a id='L7482' name='L7482'></a>  7482 <em class='sharp'># endif</em>
<a id='L7483' name='L7483'></a>  7483 <em class='sharp'>#endif</em>
<a id='L7484' name='L7484'></a>  7484 
<a id='L7485' name='L7485'></a>  7485   <em class='comment'>/* If double buffering is disabled, finish the update here.</em>
<a id='L7486' name='L7486'></a>  7486 <em class='comment'>     Otherwise, finish the update when the back buffer is next</em>
<a id='L7487' name='L7487'></a>  7487 <em class='comment'>     displayed.  */</em>
<a id='L7488' name='L7488'></a>  7488 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XSYNC &amp;&amp; !<strong class='reserved'>defined</strong> USE_GTK &amp;&amp; <strong class='reserved'>defined</strong> HAVE_CLOCK_GETTIME
<a id='L7489' name='L7489'></a>  7489 <em class='sharp'>#ifdef</em> HAVE_XDBE
<a id='L7490' name='L7490'></a>  7490   <strong class='reserved'>if</strong> (!<a href='../S/2212.html#L1356' title='Defined at 1356 in src/xterm.h.'>FRAME_X_DOUBLE_BUFFERED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L7491' name='L7491'></a>  7491 <em class='sharp'>#endif</em>
<a id='L7492' name='L7492'></a>  7492     <a href='../S/2289.html#L7216' title='Defined at 7216 in src/xterm.c.'>x_sync_update_finish</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L7493' name='L7493'></a>  7493 <em class='sharp'>#endif</em>
<a id='L7494' name='L7494'></a>  7494 <em class='brace'>}</em>
<a id='L7495' name='L7495'></a>  7495 
<a id='L7496' name='L7496'></a>  7496 <em class='comment'>/* This function is called from various places in xdisp.c</em>
<a id='L7497' name='L7497'></a>  7497 <em class='comment'>   whenever a complete update has been performed.  */</em>
<a id='L7498' name='L7498'></a>  7498 
<a id='L7499' name='L7499'></a>  7499 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L7500' name='L7500'></a>  7500 <a href='../S/2289.html#L31534' title='Referred from 31534 in src/xterm.c.'>XTframe_up_to_date</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L7501' name='L7501'></a>  7501 <em class='brace'>{</em>
<a id='L7502' name='L7502'></a>  7502 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XSYNC &amp;&amp; <strong class='reserved'>defined</strong> HAVE_GTK3
<a id='L7503' name='L7503'></a>  7503   GtkWidget *widget;
<a id='L7504' name='L7504'></a>  7504   GdkWindow *<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>;
<a id='L7505' name='L7505'></a>  7505   GdkFrameClock *<a href='../D/9793.html' title='Multiple defined in 2 places.'>clock</a>;
<a id='L7506' name='L7506'></a>  7506 <em class='sharp'>#endif</em>
<a id='L7507' name='L7507'></a>  7507 
<a id='L7508' name='L7508'></a>  7508   <a href='../D/10871.html' title='Multiple defined in 5 places.'>eassert</a> (<a href='../S/2183.html#L919' title='Defined at 919 in src/frame.h.'>FRAME_X_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L7509' name='L7509'></a>  7509   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L7510' name='L7510'></a>  7510   <a href='../S/2183.html#L1412' title='Defined at 1412 in src/frame.h.'>FRAME_MOUSE_UPDATE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L7511' name='L7511'></a>  7511 
<a id='L7512' name='L7512'></a>  7512 <em class='sharp'>#ifdef</em> HAVE_XDBE
<a id='L7513' name='L7513'></a>  7513   <strong class='reserved'>if</strong> (!<a href='../S/2224.html#L17703' title='Defined at 17703 in src/xdisp.c.'>buffer_flipping_blocked_p</a> ()
<a id='L7514' name='L7514'></a>  7514       &amp;&amp; <a href='../S/2212.html#L1360' title='Defined at 1360 in src/xterm.h.'>FRAME_X_NEED_BUFFER_FLIP</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L7515' name='L7515'></a>  7515     <a href='../D/17419.html' title='Multiple defined in 2 places.'>show_back_buffer</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L7516' name='L7516'></a>  7516 
<a id='L7517' name='L7517'></a>  7517   <em class='comment'>/* The frame is now complete, as its contents have been drawn.  */</em>
<a id='L7518' name='L7518'></a>  7518   <a href='../S/2212.html#L1364' title='Defined at 1364 in src/xterm.h.'>FRAME_X_COMPLETE_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L7519' name='L7519'></a>  7519 <em class='sharp'>#endif</em>
<a id='L7520' name='L7520'></a>  7520 
<a id='L7521' name='L7521'></a>  7521 <em class='sharp'>#ifdef</em> HAVE_XSYNC
<a id='L7522' name='L7522'></a>  7522 <em class='sharp'>#ifndef</em> HAVE_GTK3
<a id='L7523' name='L7523'></a>  7523   <strong class='reserved'>if</strong> (<a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;sync_end_pending_p
<a id='L7524' name='L7524'></a>  7524       &amp;&amp; <a href='../S/2212.html#L1455' title='Defined at 1455 in src/xterm.h.'>FRAME_X_BASIC_COUNTER</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) != None)
<a id='L7525' name='L7525'></a>  7525     <em class='brace'>{</em>
<a id='L7526' name='L7526'></a>  7526       XSyncSetCounter (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L7527' name='L7527'></a>  7527                        <a href='../S/2212.html#L1455' title='Defined at 1455 in src/xterm.h.'>FRAME_X_BASIC_COUNTER</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L7528' name='L7528'></a>  7528                        <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;pending_basic_counter_value);
<a id='L7529' name='L7529'></a>  7529       <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;sync_end_pending_p = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L7530' name='L7530'></a>  7530     <em class='brace'>}</em>
<a id='L7531' name='L7531'></a>  7531 <em class='sharp'>#else</em>
<a id='L7532' name='L7532'></a>  7532   <strong class='reserved'>if</strong> (<a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;xg_sync_end_pending_p)
<a id='L7533' name='L7533'></a>  7533     <em class='brace'>{</em>
<a id='L7534' name='L7534'></a>  7534       widget = <a href='../D/2309.html' title='Multiple defined in 2 places.'>FRAME_GTK_OUTER_WIDGET</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L7535' name='L7535'></a>  7535       <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = gtk_widget_get_window (widget);
<a id='L7536' name='L7536'></a>  7536       <a href='../D/10871.html' title='Multiple defined in 5 places.'>eassert</a> (<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L7537' name='L7537'></a>  7537       <a href='../D/9793.html' title='Multiple defined in 2 places.'>clock</a> = gdk_window_get_frame_clock (<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L7538' name='L7538'></a>  7538       <a href='../D/10871.html' title='Multiple defined in 5 places.'>eassert</a> (<a href='../D/9793.html' title='Multiple defined in 2 places.'>clock</a>);
<a id='L7539' name='L7539'></a>  7539 
<a id='L7540' name='L7540'></a>  7540       gdk_frame_clock_request_phase (<a href='../D/9793.html' title='Multiple defined in 2 places.'>clock</a>,
<a id='L7541' name='L7541'></a>  7541                                      GDK_FRAME_CLOCK_PHASE_AFTER_PAINT);
<a id='L7542' name='L7542'></a>  7542       <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;xg_sync_end_pending_p = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L7543' name='L7543'></a>  7543     <em class='brace'>}</em>
<a id='L7544' name='L7544'></a>  7544 <em class='sharp'>#endif</em>
<a id='L7545' name='L7545'></a>  7545 <em class='sharp'>#endif</em>
<a id='L7546' name='L7546'></a>  7546   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L7547' name='L7547'></a>  7547 <em class='brace'>}</em>
<a id='L7548' name='L7548'></a>  7548 
<a id='L7549' name='L7549'></a>  7549 <em class='sharp'>#ifdef</em> HAVE_XDBE
<a id='L7550' name='L7550'></a>  7550 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L7551' name='L7551'></a>  7551 <a href='../S/2289.html#L31536' title='Referred from 31536 in src/xterm.c.'>XTbuffer_flipping_unblocked_hook</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L7552' name='L7552'></a>  7552 <em class='brace'>{</em>
<a id='L7553' name='L7553'></a>  7553   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L7554' name='L7554'></a>  7554 
<a id='L7555' name='L7555'></a>  7555   <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1360' title='Defined at 1360 in src/xterm.h.'>FRAME_X_NEED_BUFFER_FLIP</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L7556' name='L7556'></a>  7556     <a href='../D/17419.html' title='Multiple defined in 2 places.'>show_back_buffer</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L7557' name='L7557'></a>  7557 
<a id='L7558' name='L7558'></a>  7558   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L7559' name='L7559'></a>  7559 <em class='brace'>}</em>
<a id='L7560' name='L7560'></a>  7560 <em class='sharp'>#endif</em>
<a id='L7561' name='L7561'></a>  7561 
<a id='L7562' name='L7562'></a>  7562 <em class='comment'>/**</em>
<a id='L7563' name='L7563'></a>  7563 <em class='comment'> * x_clear_under_internal_border:</em>
<a id='L7564' name='L7564'></a>  7564 <em class='comment'> *</em>
<a id='L7565' name='L7565'></a>  7565 <em class='comment'> * Clear area of frame F's internal border.  If the internal border face</em>
<a id='L7566' name='L7566'></a>  7566 <em class='comment'> * of F has been specified (is not null), fill the area with that face.</em>
<a id='L7567' name='L7567'></a>  7567 <em class='comment'> */</em>
<a id='L7568' name='L7568'></a>  7568 <strong class='reserved'>void</strong>
<a id='L7569' name='L7569'></a>  7569 <a href='../R/18075.html' title='Multiple referred from 13 places.'>x_clear_under_internal_border</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L7570' name='L7570'></a>  7570 <em class='brace'>{</em>
<a id='L7571' name='L7571'></a>  7571   <strong class='reserved'>if</strong> (<a href='../S/2183.html#L1603' title='Defined at 1603 in src/frame.h.'>FRAME_INTERNAL_BORDER_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) &gt; 0)
<a id='L7572' name='L7572'></a>  7572     <em class='brace'>{</em>
<a id='L7573' name='L7573'></a>  7573       <strong class='reserved'>int</strong> border = <a href='../S/2183.html#L1603' title='Defined at 1603 in src/frame.h.'>FRAME_INTERNAL_BORDER_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L7574' name='L7574'></a>  7574       <strong class='reserved'>int</strong> width = <a href='../S/2183.html#L1051' title='Defined at 1051 in src/frame.h.'>FRAME_PIXEL_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L7575' name='L7575'></a>  7575       <strong class='reserved'>int</strong> height = <a href='../S/2183.html#L1052' title='Defined at 1052 in src/frame.h.'>FRAME_PIXEL_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L7576' name='L7576'></a>  7576       <strong class='reserved'>int</strong> margin = <a href='../S/2183.html#L1124' title='Defined at 1124 in src/frame.h.'>FRAME_TOP_MARGIN_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L7577' name='L7577'></a>  7577       <strong class='reserved'>int</strong> bottom_margin = <a href='../S/2183.html#L1136' title='Defined at 1136 in src/frame.h.'>FRAME_BOTTOM_MARGIN_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L7578' name='L7578'></a>  7578       <strong class='reserved'>int</strong> <a href='../S/2315.html#L1878' title='Defined at 1878 in src/dispextern.h.'>face_id</a> = (<a href='../D/2370.html' title='Multiple defined in 2 places.'>FRAME_PARENT_FRAME</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L7579' name='L7579'></a>  7579                      ? (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (Vface_remapping_alist)
<a id='L7580' name='L7580'></a>  7580                         ? <a href='../S/2239.html#L5034' title='Defined at 5034 in src/xfaces.c.'>lookup_basic_face</a> (<a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>,
<a id='L7581' name='L7581'></a>  7581                                              <a href='../S/2315.html#L1896' title='Defined at 1896 in src/dispextern.h.'>CHILD_FRAME_BORDER_FACE_ID</a>)
<a id='L7582' name='L7582'></a>  7582                         : <a href='../S/2315.html#L1896' title='Defined at 1896 in src/dispextern.h.'>CHILD_FRAME_BORDER_FACE_ID</a>)
<a id='L7583' name='L7583'></a>  7583                      : (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (Vface_remapping_alist)
<a id='L7584' name='L7584'></a>  7584                         ? <a href='../S/2239.html#L5034' title='Defined at 5034 in src/xfaces.c.'>lookup_basic_face</a> (<a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>,
<a id='L7585' name='L7585'></a>  7585                                              <a href='../S/2315.html#L1895' title='Defined at 1895 in src/dispextern.h.'>INTERNAL_BORDER_FACE_ID</a>)
<a id='L7586' name='L7586'></a>  7586                         : <a href='../S/2315.html#L1895' title='Defined at 1895 in src/dispextern.h.'>INTERNAL_BORDER_FACE_ID</a>));
<a id='L7587' name='L7587'></a>  7587       <strong class='reserved'>struct</strong> <a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a> *<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a> = <a href='../S/2183.html#L1642' title='Defined at 1642 in src/frame.h.'>FACE_FROM_ID_OR_NULL</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/2315.html#L1878' title='Defined at 1878 in src/dispextern.h.'>face_id</a>);
<a id='L7588' name='L7588'></a>  7588 
<a id='L7589' name='L7589'></a>  7589       <strong class='reserved'>if</strong> (<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>)
<a id='L7590' name='L7590'></a>  7590         <em class='brace'>{</em>
<a id='L7591' name='L7591'></a>  7591           <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> color = <a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;background;
<a id='L7592' name='L7592'></a>  7592           <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> = <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L7593' name='L7593'></a>  7593           <a href='../D/2619.html' title='Multiple defined in 2 places.'>GC</a> gc = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;normal_gc;
<a id='L7594' name='L7594'></a>  7594 
<a id='L7595' name='L7595'></a>  7595           XSetForeground (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, gc, color);
<a id='L7596' name='L7596'></a>  7596           <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, 0, margin, width, border, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L7597' name='L7597'></a>  7597           <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, 0, 0, border, height, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L7598' name='L7598'></a>  7598           <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, width - border, 0, border, height, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L7599' name='L7599'></a>  7599           <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, 0, height - bottom_margin - border,
<a id='L7600' name='L7600'></a>  7600                             width, border, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L7601' name='L7601'></a>  7601           XSetForeground (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, gc, <a href='../S/2183.html#L1376' title='Defined at 1376 in src/frame.h.'>FRAME_FOREGROUND_PIXEL</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L7602' name='L7602'></a>  7602         <em class='brace'>}</em>
<a id='L7603' name='L7603'></a>  7603       <strong class='reserved'>else</strong>
<a id='L7604' name='L7604'></a>  7604         <em class='brace'>{</em>
<a id='L7605' name='L7605'></a>  7605           <a href='../S/2289.html#L11076' title='Defined at 11076 in src/xterm.c.'>x_clear_area</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 0, 0, border, height);
<a id='L7606' name='L7606'></a>  7606           <a href='../S/2289.html#L11076' title='Defined at 11076 in src/xterm.c.'>x_clear_area</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 0, margin, width, border);
<a id='L7607' name='L7607'></a>  7607           <a href='../S/2289.html#L11076' title='Defined at 11076 in src/xterm.c.'>x_clear_area</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, width - border, 0, border, height);
<a id='L7608' name='L7608'></a>  7608           <a href='../S/2289.html#L11076' title='Defined at 11076 in src/xterm.c.'>x_clear_area</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 0, height - bottom_margin - border,
<a id='L7609' name='L7609'></a>  7609                         width, border);
<a id='L7610' name='L7610'></a>  7610         <em class='brace'>}</em>
<a id='L7611' name='L7611'></a>  7611     <em class='brace'>}</em>
<a id='L7612' name='L7612'></a>  7612 <em class='brace'>}</em>
<a id='L7613' name='L7613'></a>  7613 
<a id='L7614' name='L7614'></a>  7614 <em class='comment'>/* Draw truncation mark bitmaps, continuation mark bitmaps, overlay</em>
<a id='L7615' name='L7615'></a>  7615 <em class='comment'>   arrow bitmaps, or clear the fringes if no bitmaps are required</em>
<a id='L7616' name='L7616'></a>  7616 <em class='comment'>   before DESIRED_ROW is made current.  This function is called from</em>
<a id='L7617' name='L7617'></a>  7617 <em class='comment'>   update_window_line only if it is known that there are differences</em>
<a id='L7618' name='L7618'></a>  7618 <em class='comment'>   between bitmaps to be drawn between current row and DESIRED_ROW.  */</em>
<a id='L7619' name='L7619'></a>  7619 
<a id='L7620' name='L7620'></a>  7620 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L7621' name='L7621'></a>  7621 <a href='../S/2289.html#L31318' title='Referred from 31318 in src/xterm.c.'>x_after_update_window_line</a> (<strong class='reserved'>struct</strong> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> *w, <strong class='reserved'>struct</strong> <a href='../S/2315.html#L892' title='Defined at 892 in src/dispextern.h.'>glyph_row</a> *desired_row)
<a id='L7622' name='L7622'></a>  7622 <em class='brace'>{</em>
<a id='L7623' name='L7623'></a>  7623   <a href='../D/10871.html' title='Multiple defined in 5 places.'>eassert</a> (w);
<a id='L7624' name='L7624'></a>  7624 
<a id='L7625' name='L7625'></a>  7625   <strong class='reserved'>if</strong> (!desired_row-&gt;mode_line_p &amp;&amp; !w-&gt;pseudo_window_p)
<a id='L7626' name='L7626'></a>  7626     desired_row-&gt;redraw_fringe_bitmaps_p = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L7627' name='L7627'></a>  7627 
<a id='L7628' name='L7628'></a>  7628 <em class='sharp'>#ifdef</em> USE_X_TOOLKIT
<a id='L7629' name='L7629'></a>  7629   <em class='comment'>/* When a window has disappeared, make sure that no rest of</em>
<a id='L7630' name='L7630'></a>  7630 <em class='comment'>     full-width rows stays visible in the internal border.  Could</em>
<a id='L7631' name='L7631'></a>  7631 <em class='comment'>     check here if updated window is the leftmost/rightmost window,</em>
<a id='L7632' name='L7632'></a>  7632 <em class='comment'>     but I guess it's not worth doing since vertically split windows</em>
<a id='L7633' name='L7633'></a>  7633 <em class='comment'>     are almost never used, internal border is rarely set, and the</em>
<a id='L7634' name='L7634'></a>  7634 <em class='comment'>     overhead is very small.  */</em>
<a id='L7635' name='L7635'></a>  7635   <em class='brace'>{</em>
<a id='L7636' name='L7636'></a>  7636     <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L7637' name='L7637'></a>  7637     <strong class='reserved'>int</strong> width, height;
<a id='L7638' name='L7638'></a>  7638 
<a id='L7639' name='L7639'></a>  7639     <strong class='reserved'>if</strong> (windows_or_buffers_changed
<a id='L7640' name='L7640'></a>  7640         &amp;&amp; desired_row-&gt;full_width_p
<a id='L7641' name='L7641'></a>  7641         &amp;&amp; (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (w-&gt;<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>),
<a id='L7642' name='L7642'></a>  7642             width = <a href='../S/2183.html#L1603' title='Defined at 1603 in src/frame.h.'>FRAME_INTERNAL_BORDER_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L7643' name='L7643'></a>  7643             width != 0)
<a id='L7644' name='L7644'></a>  7644         &amp;&amp; (height = desired_row-&gt;visible_height,
<a id='L7645' name='L7645'></a>  7645             height &gt; 0))
<a id='L7646' name='L7646'></a>  7646       <em class='brace'>{</em>
<a id='L7647' name='L7647'></a>  7647         <strong class='reserved'>int</strong> y = <a href='../S/2317.html#L1071' title='Defined at 1071 in src/window.h.'>WINDOW_TO_FRAME_PIXEL_Y</a> (w, <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> (0, desired_row-&gt;y));
<a id='L7648' name='L7648'></a>  7648         <strong class='reserved'>int</strong> <a href='../S/2315.html#L1878' title='Defined at 1878 in src/dispextern.h.'>face_id</a> =
<a id='L7649' name='L7649'></a>  7649           (<a href='../D/2370.html' title='Multiple defined in 2 places.'>FRAME_PARENT_FRAME</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L7650' name='L7650'></a>  7650            ? (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (Vface_remapping_alist)
<a id='L7651' name='L7651'></a>  7651               ? <a href='../S/2239.html#L5034' title='Defined at 5034 in src/xfaces.c.'>lookup_basic_face</a> (<a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/2315.html#L1896' title='Defined at 1896 in src/dispextern.h.'>CHILD_FRAME_BORDER_FACE_ID</a>)
<a id='L7652' name='L7652'></a>  7652               : <a href='../S/2315.html#L1896' title='Defined at 1896 in src/dispextern.h.'>CHILD_FRAME_BORDER_FACE_ID</a>)
<a id='L7653' name='L7653'></a>  7653            : (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (Vface_remapping_alist)
<a id='L7654' name='L7654'></a>  7654               ? <a href='../S/2239.html#L5034' title='Defined at 5034 in src/xfaces.c.'>lookup_basic_face</a> (<a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/2315.html#L1895' title='Defined at 1895 in src/dispextern.h.'>INTERNAL_BORDER_FACE_ID</a>)
<a id='L7655' name='L7655'></a>  7655               : <a href='../S/2315.html#L1895' title='Defined at 1895 in src/dispextern.h.'>INTERNAL_BORDER_FACE_ID</a>));
<a id='L7656' name='L7656'></a>  7656         <strong class='reserved'>struct</strong> <a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a> *<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a> = <a href='../S/2183.html#L1642' title='Defined at 1642 in src/frame.h.'>FACE_FROM_ID_OR_NULL</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/2315.html#L1878' title='Defined at 1878 in src/dispextern.h.'>face_id</a>);
<a id='L7657' name='L7657'></a>  7657 
<a id='L7658' name='L7658'></a>  7658         <strong class='reserved'>if</strong> (<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>)
<a id='L7659' name='L7659'></a>  7659           <em class='brace'>{</em>
<a id='L7660' name='L7660'></a>  7660             <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> color = <a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;background;
<a id='L7661' name='L7661'></a>  7661             <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> = <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L7662' name='L7662'></a>  7662             <a href='../D/2619.html' title='Multiple defined in 2 places.'>GC</a> gc = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;normal_gc;
<a id='L7663' name='L7663'></a>  7663 
<a id='L7664' name='L7664'></a>  7664             XSetForeground (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, gc, color);
<a id='L7665' name='L7665'></a>  7665             <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, 0, y, width, height, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L7666' name='L7666'></a>  7666             <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, <a href='../S/2183.html#L1051' title='Defined at 1051 in src/frame.h.'>FRAME_PIXEL_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) - width, y,
<a id='L7667' name='L7667'></a>  7667                               width, height, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L7668' name='L7668'></a>  7668             XSetForeground (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, gc, <a href='../S/2183.html#L1376' title='Defined at 1376 in src/frame.h.'>FRAME_FOREGROUND_PIXEL</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L7669' name='L7669'></a>  7669           <em class='brace'>}</em>
<a id='L7670' name='L7670'></a>  7670         <strong class='reserved'>else</strong>
<a id='L7671' name='L7671'></a>  7671           <em class='brace'>{</em>
<a id='L7672' name='L7672'></a>  7672             <a href='../S/2289.html#L11076' title='Defined at 11076 in src/xterm.c.'>x_clear_area</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 0, y, width, height);
<a id='L7673' name='L7673'></a>  7673             <a href='../S/2289.html#L11076' title='Defined at 11076 in src/xterm.c.'>x_clear_area</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/2183.html#L1051' title='Defined at 1051 in src/frame.h.'>FRAME_PIXEL_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) - width, y, width, height);
<a id='L7674' name='L7674'></a>  7674           <em class='brace'>}</em>
<a id='L7675' name='L7675'></a>  7675       <em class='brace'>}</em>
<a id='L7676' name='L7676'></a>  7676   <em class='brace'>}</em>
<a id='L7677' name='L7677'></a>  7677 <em class='sharp'>#endif</em>
<a id='L7678' name='L7678'></a>  7678 <em class='brace'>}</em>
<a id='L7679' name='L7679'></a>  7679 
<a id='L7680' name='L7680'></a>  7680 <em class='comment'>/* Generate a premultiplied pixel value for COLOR with ALPHA applied</em>
<a id='L7681' name='L7681'></a>  7681 <em class='comment'>   on the given display.  COLOR will be modified.  The display must</em>
<a id='L7682' name='L7682'></a>  7682 <em class='comment'>   use a visual that supports an alpha channel.</em>
<a id='L7683' name='L7683'></a>  7683 <em class='comment'></em>
<a id='L7684' name='L7684'></a>  7684 <em class='comment'>   This is possibly dead code on builds which do not support</em>
<a id='L7685' name='L7685'></a>  7685 <em class='comment'>   XRender.  */</em>
<a id='L7686' name='L7686'></a>  7686 
<a id='L7687' name='L7687'></a>  7687 <em class='sharp'>#ifndef</em> USE_CAIRO
<a id='L7688' name='L7688'></a>  7688 
<a id='L7689' name='L7689'></a>  7689 <strong class='reserved'>static</strong> <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong>
<a id='L7690' name='L7690'></a>  7690 <a href='../R/18264.html' title='Multiple referred from 2 places.'>x_premultiply_pixel</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L7691' name='L7691'></a>  7691                      <a href='../D/7038.html' title='Multiple defined in 2 places.'>XColor</a> *color, <strong class='reserved'>double</strong> alpha)
<a id='L7692' name='L7692'></a>  7692 <em class='brace'>{</em>
<a id='L7693' name='L7693'></a>  7693   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> pixel;
<a id='L7694' name='L7694'></a>  7694 
<a id='L7695' name='L7695'></a>  7695   <a href='../D/10871.html' title='Multiple defined in 5 places.'>eassert</a> (dpyinfo-&gt;alpha_bits);
<a id='L7696' name='L7696'></a>  7696 
<a id='L7697' name='L7697'></a>  7697   <em class='comment'>/* Multiply the RGB channels.  */</em>
<a id='L7698' name='L7698'></a>  7698   color-&gt;red *= alpha;
<a id='L7699' name='L7699'></a>  7699   color-&gt;green *= alpha;
<a id='L7700' name='L7700'></a>  7700   color-&gt;blue *= alpha;
<a id='L7701' name='L7701'></a>  7701 
<a id='L7702' name='L7702'></a>  7702   <em class='comment'>/* First, allocate a fully opaque pixel.  */</em>
<a id='L7703' name='L7703'></a>  7703   pixel = <a href='../S/2212.html#L1813' title='Defined at 1813 in src/xterm.h.'>x_make_truecolor_pixel</a> (dpyinfo, color-&gt;red,
<a id='L7704' name='L7704'></a>  7704                                   color-&gt;green,
<a id='L7705' name='L7705'></a>  7705                                   color-&gt;blue);
<a id='L7706' name='L7706'></a>  7706 
<a id='L7707' name='L7707'></a>  7707   <em class='comment'>/* Next, erase the alpha component.  */</em>
<a id='L7708' name='L7708'></a>  7708   pixel &amp;= ~dpyinfo-&gt;alpha_mask;
<a id='L7709' name='L7709'></a>  7709 
<a id='L7710' name='L7710'></a>  7710   <em class='comment'>/* And add an alpha channel.  */</em>
<a id='L7711' name='L7711'></a>  7711   pixel |= (((<strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong>) (alpha * 65535)
<a id='L7712' name='L7712'></a>  7712              &gt;&gt; (16 - dpyinfo-&gt;alpha_bits))
<a id='L7713' name='L7713'></a>  7713             &lt;&lt; dpyinfo-&gt;alpha_offset);
<a id='L7714' name='L7714'></a>  7714 
<a id='L7715' name='L7715'></a>  7715   <strong class='reserved'>return</strong> pixel;
<a id='L7716' name='L7716'></a>  7716 <em class='brace'>}</em>
<a id='L7717' name='L7717'></a>  7717 
<a id='L7718' name='L7718'></a>  7718 <em class='sharp'>#endif</em>
<a id='L7719' name='L7719'></a>  7719 
<a id='L7720' name='L7720'></a>  7720 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L7721' name='L7721'></a>  7721 <a href='../S/2289.html#L31325' title='Referred from 31325 in src/xterm.c.'>x_draw_fringe_bitmap</a> (<strong class='reserved'>struct</strong> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> *w, <strong class='reserved'>struct</strong> <a href='../S/2315.html#L892' title='Defined at 892 in src/dispextern.h.'>glyph_row</a> *row,
<a id='L7722' name='L7722'></a>  7722                       <strong class='reserved'>struct</strong> <a href='../S/2315.html#L2139' title='Defined at 2139 in src/dispextern.h.'>draw_fringe_bitmap_params</a> *p)
<a id='L7723' name='L7723'></a>  7723 <em class='brace'>{</em>
<a id='L7724' name='L7724'></a>  7724   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../S/2183.html#L914' title='Defined at 914 in src/frame.h.'>WINDOW_FRAME</a> (w));
<a id='L7725' name='L7725'></a>  7725   <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> = <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L7726' name='L7726'></a>  7726   <a href='../D/2619.html' title='Multiple defined in 2 places.'>GC</a> gc = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;normal_gc;
<a id='L7727' name='L7727'></a>  7727   <strong class='reserved'>struct</strong> <a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a> *<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a> = p-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>;
<a id='L7728' name='L7728'></a>  7728 
<a id='L7729' name='L7729'></a>  7729   <em class='comment'>/* Must clip because of partially visible lines.  */</em>
<a id='L7730' name='L7730'></a>  7730   x_clip_to_row (w, row, <a href='../S/2315.html#L857' title='Defined at 857 in src/dispextern.h.'>ANY_AREA</a>, gc);
<a id='L7731' name='L7731'></a>  7731 
<a id='L7732' name='L7732'></a>  7732   <strong class='reserved'>if</strong> (p-&gt;bx &gt;= 0 &amp;&amp; !p-&gt;overlay_p)
<a id='L7733' name='L7733'></a>  7733     <em class='brace'>{</em>
<a id='L7734' name='L7734'></a>  7734       <em class='comment'>/* In case the same realized face is used for fringes and</em>
<a id='L7735' name='L7735'></a>  7735 <em class='comment'>         for something displayed in the text (e.g. face `region' on</em>
<a id='L7736' name='L7736'></a>  7736 <em class='comment'>         mono-displays, the fill style may have been changed to</em>
<a id='L7737' name='L7737'></a>  7737 <em class='comment'>         FillSolid in x_draw_glyph_string_background.  */</em>
<a id='L7738' name='L7738'></a>  7738       <strong class='reserved'>if</strong> (<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;stipple)
<a id='L7739' name='L7739'></a>  7739         <em class='brace'>{</em>
<a id='L7740' name='L7740'></a>  7740           XSetFillStyle (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;gc, FillOpaqueStippled);
<a id='L7741' name='L7741'></a>  7741           <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;gc, p-&gt;bx, p-&gt;by, p-&gt;nx, p-&gt;ny,
<a id='L7742' name='L7742'></a>  7742                             <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L7743' name='L7743'></a>  7743           XSetFillStyle (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;gc, FillSolid);
<a id='L7744' name='L7744'></a>  7744 
<a id='L7745' name='L7745'></a>  7745           row-&gt;stipple_p = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L7746' name='L7746'></a>  7746         <em class='brace'>}</em>
<a id='L7747' name='L7747'></a>  7747       <strong class='reserved'>else</strong>
<a id='L7748' name='L7748'></a>  7748         <em class='brace'>{</em>
<a id='L7749' name='L7749'></a>  7749           XSetBackground (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;gc, <a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;background);
<a id='L7750' name='L7750'></a>  7750           <a href='../S/2289.html#L6577' title='Defined at 6577 in src/xterm.c.'>x_clear_rectangle</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;gc, p-&gt;bx, p-&gt;by, p-&gt;nx, p-&gt;ny,
<a id='L7751' name='L7751'></a>  7751                            <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L7752' name='L7752'></a>  7752           XSetForeground (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;gc, <a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;foreground);
<a id='L7753' name='L7753'></a>  7753         <em class='brace'>}</em>
<a id='L7754' name='L7754'></a>  7754     <em class='brace'>}</em>
<a id='L7755' name='L7755'></a>  7755 
<a id='L7756' name='L7756'></a>  7756 <em class='sharp'>#ifdef</em> USE_CAIRO
<a id='L7757' name='L7757'></a>  7757   <strong class='reserved'>if</strong> (p-&gt;which
<a id='L7758' name='L7758'></a>  7758       &amp;&amp; p-&gt;which &lt; max_fringe_bmp
<a id='L7759' name='L7759'></a>  7759       &amp;&amp; p-&gt;which &lt; max_used_fringe_bitmap)
<a id='L7760' name='L7760'></a>  7760     <em class='brace'>{</em>
<a id='L7761' name='L7761'></a>  7761       XGCValues gcv;
<a id='L7762' name='L7762'></a>  7762 
<a id='L7763' name='L7763'></a>  7763       <a href='../S/2215.html#L271' title='Defined at 271 in src/w32term.c.'>XGetGCValues</a> (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, gc, <a href='../S/2315.html#L89' title='Defined at 89 in src/dispextern.h.'>GCForeground</a> | <a href='../S/2315.html#L90' title='Defined at 90 in src/dispextern.h.'>GCBackground</a>, &amp;gcv);
<a id='L7764' name='L7764'></a>  7764       XSetForeground (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, gc, (p-&gt;cursor_p
<a id='L7765' name='L7765'></a>  7765                                     ? (p-&gt;overlay_p ? <a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;background
<a id='L7766' name='L7766'></a>  7766                                        : <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;cursor_pixel)
<a id='L7767' name='L7767'></a>  7767                                     : <a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;foreground));
<a id='L7768' name='L7768'></a>  7768       XSetBackground (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, gc, <a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;background);
<a id='L7769' name='L7769'></a>  7769       <strong class='reserved'>if</strong> (!fringe_bmp[p-&gt;which])
<a id='L7770' name='L7770'></a>  7770         <em class='brace'>{</em>
<a id='L7771' name='L7771'></a>  7771           <em class='comment'>/* This fringe bitmap is known to fringe.c, but lacks the</em>
<a id='L7772' name='L7772'></a>  7772 <em class='comment'>             cairo_pattern_t pattern which shadows that bitmap.  This</em>
<a id='L7773' name='L7773'></a>  7773 <em class='comment'>             is typical to define-fringe-bitmap being called when the</em>
<a id='L7774' name='L7774'></a>  7774 <em class='comment'>             selected frame was not a GUI frame, for example, when</em>
<a id='L7775' name='L7775'></a>  7775 <em class='comment'>             packages that define fringe bitmaps are loaded by a</em>
<a id='L7776' name='L7776'></a>  7776 <em class='comment'>             daemon Emacs.  Create the missing pattern now.  */</em>
<a id='L7777' name='L7777'></a>  7777           <a href='../S/2354.html#L1853' title='Defined at 1853 in src/fringe.c.'>gui_define_fringe_bitmap</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, p-&gt;which);
<a id='L7778' name='L7778'></a>  7778         <em class='brace'>}</em>
<a id='L7779' name='L7779'></a>  7779       <a href='../S/2289.html#L6183' title='Defined at 6183 in src/xterm.c.'>x_cr_draw_image</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, fringe_bmp[p-&gt;which], 0, p-&gt;dh,
<a id='L7780' name='L7780'></a>  7780                        p-&gt;wd, p-&gt;h, p-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, p-&gt;y, p-&gt;overlay_p);
<a id='L7781' name='L7781'></a>  7781       XSetForeground (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, gc, gcv.foreground);
<a id='L7782' name='L7782'></a>  7782       XSetBackground (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, gc, gcv.background);
<a id='L7783' name='L7783'></a>  7783     <em class='brace'>}</em>
<a id='L7784' name='L7784'></a>  7784 <em class='sharp'>#else</em>  <em class='comment'>/* not USE_CAIRO */</em>
<a id='L7785' name='L7785'></a>  7785   <strong class='reserved'>if</strong> (p-&gt;which)
<a id='L7786' name='L7786'></a>  7786     <em class='brace'>{</em>
<a id='L7787' name='L7787'></a>  7787       <a href='../D/1653.html' title='Multiple defined in 2 places.'>Drawable</a> drawable = <a href='../S/2212.html#L1352' title='Defined at 1352 in src/xterm.h.'>FRAME_X_DRAWABLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L7788' name='L7788'></a>  7788       <strong class='reserved'>char</strong> *<a href='../S/2358.html#L1062' title='Defined at 1062 in src/emacs-module.c.'>bits</a>;
<a id='L7789' name='L7789'></a>  7789       <a href='../D/5058.html' title='Multiple defined in 2 places.'>Pixmap</a> pixmap, clipmask = None;
<a id='L7790' name='L7790'></a>  7790       <strong class='reserved'>int</strong> depth = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;n_planes;
<a id='L7791' name='L7791'></a>  7791       XGCValues gcv;
<a id='L7792' name='L7792'></a>  7792       <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> background = <a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;background;
<a id='L7793' name='L7793'></a>  7793       <a href='../D/7038.html' title='Multiple defined in 2 places.'>XColor</a> bg;
<a id='L7794' name='L7794'></a>  7794 <em class='sharp'>#ifdef</em> HAVE_XRENDER
<a id='L7795' name='L7795'></a>  7795       <a href='../S/2204.html#L1049' title='Defined at 1049 in src/image.c.'>Picture</a> picture = None;
<a id='L7796' name='L7796'></a>  7796       XRenderPictureAttributes attrs;
<a id='L7797' name='L7797'></a>  7797 
<a id='L7798' name='L7798'></a>  7798       memset (&amp;attrs, 0, <strong class='reserved'>sizeof</strong> attrs);
<a id='L7799' name='L7799'></a>  7799 <em class='sharp'>#endif</em>
<a id='L7800' name='L7800'></a>  7800 
<a id='L7801' name='L7801'></a>  7801       <strong class='reserved'>if</strong> (p-&gt;wd &gt; 8)
<a id='L7802' name='L7802'></a>  7802         <a href='../S/2358.html#L1062' title='Defined at 1062 in src/emacs-module.c.'>bits</a> = (<strong class='reserved'>char</strong> *) (p-&gt;<a href='../S/2358.html#L1062' title='Defined at 1062 in src/emacs-module.c.'>bits</a> + p-&gt;dh);
<a id='L7803' name='L7803'></a>  7803       <strong class='reserved'>else</strong>
<a id='L7804' name='L7804'></a>  7804         <a href='../S/2358.html#L1062' title='Defined at 1062 in src/emacs-module.c.'>bits</a> = (<strong class='reserved'>char</strong> *) p-&gt;<a href='../S/2358.html#L1062' title='Defined at 1062 in src/emacs-module.c.'>bits</a> + p-&gt;dh;
<a id='L7805' name='L7805'></a>  7805 
<a id='L7806' name='L7806'></a>  7806       <strong class='reserved'>if</strong> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;alpha_bits
<a id='L7807' name='L7807'></a>  7807           &amp;&amp; <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;alpha_background &lt; 1.0)
<a id='L7808' name='L7808'></a>  7808         <em class='brace'>{</em>
<a id='L7809' name='L7809'></a>  7809           <em class='comment'>/* Extend the background color with an alpha channel</em>
<a id='L7810' name='L7810'></a>  7810 <em class='comment'>             according to f-&gt;alpha_background.  */</em>
<a id='L7811' name='L7811'></a>  7811           bg.pixel = background;
<a id='L7812' name='L7812'></a>  7812           <a href='../S/2289.html#L8972' title='Defined at 8972 in src/xterm.c.'>x_query_colors</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, &amp;bg, 1);
<a id='L7813' name='L7813'></a>  7813 
<a id='L7814' name='L7814'></a>  7814           background
<a id='L7815' name='L7815'></a>  7815             = <a href='../S/2289.html#L7690' title='Defined at 7690 in src/xterm.c.'>x_premultiply_pixel</a> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L7816' name='L7816'></a>  7816                                    &amp;bg,
<a id='L7817' name='L7817'></a>  7817                                    <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;alpha_background);
<a id='L7818' name='L7818'></a>  7818         <em class='brace'>}</em>
<a id='L7819' name='L7819'></a>  7819 
<a id='L7820' name='L7820'></a>  7820       <em class='comment'>/* Draw the bitmap.  I believe these small pixmaps can be cached</em>
<a id='L7821' name='L7821'></a>  7821 <em class='comment'>         by the server.  */</em>
<a id='L7822' name='L7822'></a>  7822       pixmap = XCreatePixmapFromBitmapData (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, drawable, <a href='../S/2358.html#L1062' title='Defined at 1062 in src/emacs-module.c.'>bits</a>, p-&gt;wd, p-&gt;h,
<a id='L7823' name='L7823'></a>  7823                                             (p-&gt;cursor_p
<a id='L7824' name='L7824'></a>  7824                                              ? (p-&gt;overlay_p ? <a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;background
<a id='L7825' name='L7825'></a>  7825                                                 : <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;cursor_pixel)
<a id='L7826' name='L7826'></a>  7826                                              : <a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;foreground),
<a id='L7827' name='L7827'></a>  7827                                             background, depth);
<a id='L7828' name='L7828'></a>  7828 
<a id='L7829' name='L7829'></a>  7829 <em class='sharp'>#ifdef</em> HAVE_XRENDER
<a id='L7830' name='L7830'></a>  7830       <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1445' title='Defined at 1445 in src/xterm.h.'>FRAME_X_PICTURE_FORMAT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L7831' name='L7831'></a>  7831           &amp;&amp; (<a href='../S/2289.html#L5089' title='Defined at 5089 in src/xterm.c.'>x_xr_ensure_picture</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../S/2212.html#L1446' title='Defined at 1446 in src/xterm.h.'>FRAME_X_PICTURE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)))
<a id='L7832' name='L7832'></a>  7832         picture = XRenderCreatePicture (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, pixmap,
<a id='L7833' name='L7833'></a>  7833                                         <a href='../S/2212.html#L1445' title='Defined at 1445 in src/xterm.h.'>FRAME_X_PICTURE_FORMAT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L7834' name='L7834'></a>  7834                                         0, &amp;attrs);
<a id='L7835' name='L7835'></a>  7835 <em class='sharp'>#endif</em>
<a id='L7836' name='L7836'></a>  7836 
<a id='L7837' name='L7837'></a>  7837       <strong class='reserved'>if</strong> (p-&gt;overlay_p)
<a id='L7838' name='L7838'></a>  7838         <em class='brace'>{</em>
<a id='L7839' name='L7839'></a>  7839           clipmask = XCreatePixmapFromBitmapData (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L7840' name='L7840'></a>  7840                                                   <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;root_window,
<a id='L7841' name='L7841'></a>  7841                                                   <a href='../S/2358.html#L1062' title='Defined at 1062 in src/emacs-module.c.'>bits</a>, p-&gt;wd, p-&gt;h,
<a id='L7842' name='L7842'></a>  7842                                                   1, 0, 1);
<a id='L7843' name='L7843'></a>  7843 
<a id='L7844' name='L7844'></a>  7844 <em class='sharp'>#ifdef</em> HAVE_XRENDER
<a id='L7845' name='L7845'></a>  7845           <strong class='reserved'>if</strong> (picture != None)
<a id='L7846' name='L7846'></a>  7846             <em class='brace'>{</em>
<a id='L7847' name='L7847'></a>  7847               attrs.clip_mask = clipmask;
<a id='L7848' name='L7848'></a>  7848               attrs.clip_x_origin = p-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L7849' name='L7849'></a>  7849               attrs.clip_y_origin = p-&gt;y;
<a id='L7850' name='L7850'></a>  7850 
<a id='L7851' name='L7851'></a>  7851               XRenderChangePicture (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../S/2212.html#L1446' title='Defined at 1446 in src/xterm.h.'>FRAME_X_PICTURE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L7852' name='L7852'></a>  7852                                     CPClipMask | CPClipXOrigin | CPClipYOrigin,
<a id='L7853' name='L7853'></a>  7853                                     &amp;attrs);
<a id='L7854' name='L7854'></a>  7854             <em class='brace'>}</em>
<a id='L7855' name='L7855'></a>  7855           <strong class='reserved'>else</strong>
<a id='L7856' name='L7856'></a>  7856 <em class='sharp'>#endif</em>
<a id='L7857' name='L7857'></a>  7857             <em class='brace'>{</em>
<a id='L7858' name='L7858'></a>  7858               gcv.clip_mask = clipmask;
<a id='L7859' name='L7859'></a>  7859               gcv.clip_x_origin = p-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L7860' name='L7860'></a>  7860               gcv.clip_y_origin = p-&gt;y;
<a id='L7861' name='L7861'></a>  7861               <a href='../S/2215.html#L250' title='Defined at 250 in src/w32term.c.'>XChangeGC</a> (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, gc, GCClipMask | GCClipXOrigin | GCClipYOrigin, &amp;gcv);
<a id='L7862' name='L7862'></a>  7862             <em class='brace'>}</em>
<a id='L7863' name='L7863'></a>  7863         <em class='brace'>}</em>
<a id='L7864' name='L7864'></a>  7864 
<a id='L7865' name='L7865'></a>  7865 <em class='sharp'>#ifdef</em> HAVE_XRENDER
<a id='L7866' name='L7866'></a>  7866       <strong class='reserved'>if</strong> (picture != None)
<a id='L7867' name='L7867'></a>  7867         <em class='brace'>{</em>
<a id='L7868' name='L7868'></a>  7868           <a href='../S/2289.html#L6349' title='Defined at 6349 in src/xterm.c.'>x_xr_apply_ext_clip</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc);
<a id='L7869' name='L7869'></a>  7869           XRenderComposite (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, PictOpSrc, picture,
<a id='L7870' name='L7870'></a>  7870                             None, <a href='../S/2212.html#L1446' title='Defined at 1446 in src/xterm.h.'>FRAME_X_PICTURE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L7871' name='L7871'></a>  7871                             0, 0, 0, 0, p-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, p-&gt;y, p-&gt;wd, p-&gt;h);
<a id='L7872' name='L7872'></a>  7872           <a href='../S/2289.html#L6363' title='Defined at 6363 in src/xterm.c.'>x_xr_reset_ext_clip</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L7873' name='L7873'></a>  7873 
<a id='L7874' name='L7874'></a>  7874           XRenderFreePicture (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, picture);
<a id='L7875' name='L7875'></a>  7875         <em class='brace'>}</em>
<a id='L7876' name='L7876'></a>  7876       <strong class='reserved'>else</strong>
<a id='L7877' name='L7877'></a>  7877 <em class='sharp'>#endif</em>
<a id='L7878' name='L7878'></a>  7878         XCopyArea (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, pixmap, drawable, gc, 0, 0,
<a id='L7879' name='L7879'></a>  7879                    p-&gt;wd, p-&gt;h, p-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, p-&gt;y);
<a id='L7880' name='L7880'></a>  7880       XFreePixmap (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, pixmap);
<a id='L7881' name='L7881'></a>  7881 
<a id='L7882' name='L7882'></a>  7882       <strong class='reserved'>if</strong> (p-&gt;overlay_p)
<a id='L7883' name='L7883'></a>  7883         <em class='brace'>{</em>
<a id='L7884' name='L7884'></a>  7884           gcv.clip_mask = (<a href='../D/5058.html' title='Multiple defined in 2 places.'>Pixmap</a>) 0;
<a id='L7885' name='L7885'></a>  7885           <a href='../S/2215.html#L250' title='Defined at 250 in src/w32term.c.'>XChangeGC</a> (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, gc, GCClipMask, &amp;gcv);
<a id='L7886' name='L7886'></a>  7886           XFreePixmap (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, clipmask);
<a id='L7887' name='L7887'></a>  7887         <em class='brace'>}</em>
<a id='L7888' name='L7888'></a>  7888     <em class='brace'>}</em>
<a id='L7889' name='L7889'></a>  7889 <em class='sharp'>#endif</em>  <em class='comment'>/* not USE_CAIRO */</em>
<a id='L7890' name='L7890'></a>  7890 
<a id='L7891' name='L7891'></a>  7891   <a href='../S/2289.html#L6390' title='Defined at 6390 in src/xterm.c.'>x_reset_clip_rectangles</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc);
<a id='L7892' name='L7892'></a>  7892 <em class='brace'>}</em>
<a id='L7893' name='L7893'></a>  7893 
<a id='L7894' name='L7894'></a>  7894 <em class='comment'>/***********************************************************************</em>
<a id='L7895' name='L7895'></a>  7895 <em class='comment'>                            Glyph display</em>
<a id='L7896' name='L7896'></a>  7896 <em class='comment'> ***********************************************************************/</em>
<a id='L7897' name='L7897'></a>  7897 
<a id='L7898' name='L7898'></a>  7898 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> <a href='../S/2289.html#L9430' title='Defined at 9430 in src/xterm.c.'>x_alloc_lighter_color</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *, <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *, Colormap,
<a id='L7899' name='L7899'></a>  7899                                    <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> *, <strong class='reserved'>double</strong>, <strong class='reserved'>int</strong>);
<a id='L7900' name='L7900'></a>  7900 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong> x_scroll_bar_clear (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *);
<a id='L7901' name='L7901'></a>  7901 
<a id='L7902' name='L7902'></a>  7902 <em class='sharp'>#ifdef</em> GLYPH_DEBUG
<a id='L7903' name='L7903'></a>  7903 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong> x_check_font (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *, <strong class='reserved'>struct</strong> <a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a> *);
<a id='L7904' name='L7904'></a>  7904 <em class='sharp'>#endif</em>
<a id='L7905' name='L7905'></a>  7905 
<a id='L7906' name='L7906'></a>  7906 <em class='comment'>/* If SEND_EVENT, make sure that TIME is larger than the current last</em>
<a id='L7907' name='L7907'></a>  7907 <em class='comment'>   user time.  We don't sanitize timestamps from events sent by the X</em>
<a id='L7908' name='L7908'></a>  7908 <em class='comment'>   server itself because some Lisp might have set the user time to a</em>
<a id='L7909' name='L7909'></a>  7909 <em class='comment'>   ridiculously large value, and this way a more reasonable timestamp</em>
<a id='L7910' name='L7910'></a>  7910 <em class='comment'>   can be obtained upon the next event.</em>
<a id='L7911' name='L7911'></a>  7911 <em class='comment'></em>
<a id='L7912' name='L7912'></a>  7912 <em class='comment'>   Alternatively, the server time could've overflowed.</em>
<a id='L7913' name='L7913'></a>  7913 <em class='comment'></em>
<a id='L7914' name='L7914'></a>  7914 <em class='comment'>   SET_PROPERTY specifies whether or not to change the user time</em>
<a id='L7915' name='L7915'></a>  7915 <em class='comment'>   property for the active frame.  The important thing is to not set</em>
<a id='L7916' name='L7916'></a>  7916 <em class='comment'>   the last user time upon leave events; on Metacity and GNOME Shell,</em>
<a id='L7917' name='L7917'></a>  7917 <em class='comment'>   mapping a new frame on top of the old frame potentially causes</em>
<a id='L7918' name='L7918'></a>  7918 <em class='comment'>   crossing events to be sent to the old frame if it contains the</em>
<a id='L7919' name='L7919'></a>  7919 <em class='comment'>   pointer, as the new frame will initially stack above the old frame.</em>
<a id='L7920' name='L7920'></a>  7920 <em class='comment'>   If _NET_WM_USER_TIME is changed at that point, then GNOME may get</em>
<a id='L7921' name='L7921'></a>  7921 <em class='comment'>   notified about the user time change on the old frame before it</em>
<a id='L7922' name='L7922'></a>  7922 <em class='comment'>   tries to focus the new frame, which will make it consider the new</em>
<a id='L7923' name='L7923'></a>  7923 <em class='comment'>   frame (whose user time property will not have been updated at that</em>
<a id='L7924' name='L7924'></a>  7924 <em class='comment'>   point, due to not being focused) as having been mapped</em>
<a id='L7925' name='L7925'></a>  7925 <em class='comment'>   out-of-order, and lower the new frame, which is typically not what</em>
<a id='L7926' name='L7926'></a>  7926 <em class='comment'>   users want.  */</em>
<a id='L7927' name='L7927'></a>  7927 
<a id='L7928' name='L7928'></a>  7928 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L7929' name='L7929'></a>  7929 <a href='../R/18121.html' title='Multiple referred from 24 places.'>x_display_set_last_user_time</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo, <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a> <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>,
<a id='L7930' name='L7930'></a>  7930                               <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> send_event, <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> set_property)
<a id='L7931' name='L7931'></a>  7931 <em class='brace'>{</em>
<a id='L7932' name='L7932'></a>  7932 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XSYNC &amp;&amp; !<strong class='reserved'>defined</strong> USE_GTK &amp;&amp; <strong class='reserved'>defined</strong> HAVE_CLOCK_GETTIME
<a id='L7933' name='L7933'></a>  7933   <a href='../D/18597.html' title='Multiple defined in 2 places.'>uint_fast64_t</a> monotonic_time;
<a id='L7934' name='L7934'></a>  7934   <a href='../D/18597.html' title='Multiple defined in 2 places.'>uint_fast64_t</a> monotonic_ms;
<a id='L7935' name='L7935'></a>  7935   <a href='../D/13374.html' title='Multiple defined in 2 places.'>int_fast64_t</a> diff_ms;
<a id='L7936' name='L7936'></a>  7936 <em class='sharp'>#endif</em>
<a id='L7937' name='L7937'></a>  7937 <em class='sharp'>#ifndef</em> USE_GTK
<a id='L7938' name='L7938'></a>  7938   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *focus_frame;
<a id='L7939' name='L7939'></a>  7939   <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a> old_time;
<a id='L7940' name='L7940'></a>  7940 
<a id='L7941' name='L7941'></a>  7941   focus_frame = dpyinfo-&gt;x_focus_frame;
<a id='L7942' name='L7942'></a>  7942   old_time = dpyinfo-&gt;last_user_time;
<a id='L7943' name='L7943'></a>  7943 <em class='sharp'>#endif</em>
<a id='L7944' name='L7944'></a>  7944 
<a id='L7945' name='L7945'></a>  7945 <em class='sharp'>#ifdef</em> ENABLE_CHECKING
<a id='L7946' name='L7946'></a>  7946   <a href='../D/10871.html' title='Multiple defined in 5 places.'>eassert</a> (<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> &lt;= <a href='../S/2212.html#L1276' title='Defined at 1276 in src/xterm.h.'>X_ULONG_MAX</a>);
<a id='L7947' name='L7947'></a>  7947 <em class='sharp'>#endif</em>
<a id='L7948' name='L7948'></a>  7948 
<a id='L7949' name='L7949'></a>  7949   <strong class='reserved'>if</strong> (!send_event || <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> &gt; dpyinfo-&gt;last_user_time)
<a id='L7950' name='L7950'></a>  7950     dpyinfo-&gt;last_user_time = <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L7951' name='L7951'></a>  7951 
<a id='L7952' name='L7952'></a>  7952 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XSYNC &amp;&amp; !<strong class='reserved'>defined</strong> USE_GTK &amp;&amp; <strong class='reserved'>defined</strong> HAVE_CLOCK_GETTIME
<a id='L7953' name='L7953'></a>  7953   <strong class='reserved'>if</strong> (!send_event)
<a id='L7954' name='L7954'></a>  7954     <em class='brace'>{</em>
<a id='L7955' name='L7955'></a>  7955       <em class='comment'>/* See if the current CLOCK_MONOTONIC time is reasonably close</em>
<a id='L7956' name='L7956'></a>  7956 <em class='comment'>         to the X server time.  */</em>
<a id='L7957' name='L7957'></a>  7957       monotonic_time = <a href='../S/2289.html#L6953' title='Defined at 6953 in src/xterm.c.'>x_sync_current_monotonic_time</a> ();
<a id='L7958' name='L7958'></a>  7958       monotonic_ms = monotonic_time / 1000;
<a id='L7959' name='L7959'></a>  7959 
<a id='L7960' name='L7960'></a>  7960       dpyinfo-&gt;server_time_monotonic_p
<a id='L7961' name='L7961'></a>  7961         = (monotonic_time != 0
<a id='L7962' name='L7962'></a>  7962            &amp;&amp; !<a href='../S/2699.html#L32' title='Defined at 32 in lib/stdckdint.in.h.'>ckd_sub</a> (&amp;diff_ms, <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>, monotonic_ms)
<a id='L7963' name='L7963'></a>  7963            &amp;&amp; -500 &lt; diff_ms &amp;&amp; diff_ms &lt; 500);
<a id='L7964' name='L7964'></a>  7964 
<a id='L7965' name='L7965'></a>  7965       <strong class='reserved'>if</strong> (!dpyinfo-&gt;server_time_monotonic_p)
<a id='L7966' name='L7966'></a>  7966         <em class='brace'>{</em>
<a id='L7967' name='L7967'></a>  7967           <em class='comment'>/* Compute an offset that can be subtracted from the server</em>
<a id='L7968' name='L7968'></a>  7968 <em class='comment'>             time to estimate the monotonic time on the X server.  */</em>
<a id='L7969' name='L7969'></a>  7969 
<a id='L7970' name='L7970'></a>  7970           <strong class='reserved'>if</strong> (!monotonic_time
<a id='L7971' name='L7971'></a>  7971               || <a href='../S/2699.html#L33' title='Defined at 33 in lib/stdckdint.in.h.'>ckd_mul</a> (&amp;dpyinfo-&gt;server_time_offset, <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>, 1000)
<a id='L7972' name='L7972'></a>  7972               || <a href='../S/2699.html#L32' title='Defined at 32 in lib/stdckdint.in.h.'>ckd_sub</a> (&amp;dpyinfo-&gt;server_time_offset,
<a id='L7973' name='L7973'></a>  7973                           dpyinfo-&gt;server_time_offset, monotonic_time))
<a id='L7974' name='L7974'></a>  7974             dpyinfo-&gt;server_time_offset = 0;
<a id='L7975' name='L7975'></a>  7975 
<a id='L7976' name='L7976'></a>  7976           <em class='comment'>/* If the server time is reasonably close to the monotonic</em>
<a id='L7977' name='L7977'></a>  7977 <em class='comment'>             time after the latter is truncated to CARD32, simply make</em>
<a id='L7978' name='L7978'></a>  7978 <em class='comment'>             the offset that between the server time in ms and the</em>
<a id='L7979' name='L7979'></a>  7979 <em class='comment'>             actual time in ms.  */</em>
<a id='L7980' name='L7980'></a>  7980 
<a id='L7981' name='L7981'></a>  7981           monotonic_ms = monotonic_ms &amp; 0xffffffff;
<a id='L7982' name='L7982'></a>  7982           <strong class='reserved'>if</strong> (!<a href='../S/2699.html#L32' title='Defined at 32 in lib/stdckdint.in.h.'>ckd_sub</a> (&amp;diff_ms, <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>, monotonic_ms)
<a id='L7983' name='L7983'></a>  7983               &amp;&amp; -500 &lt; diff_ms &amp;&amp; diff_ms &lt; 500)
<a id='L7984' name='L7984'></a>  7984             <em class='brace'>{</em>
<a id='L7985' name='L7985'></a>  7985               <em class='comment'>/* The server timestamp overflowed.  Make the time</em>
<a id='L7986' name='L7986'></a>  7986 <em class='comment'>                 offset exactly how much it overflowed by.  */</em>
<a id='L7987' name='L7987'></a>  7987 
<a id='L7988' name='L7988'></a>  7988               <strong class='reserved'>if</strong> (<a href='../S/2699.html#L32' title='Defined at 32 in lib/stdckdint.in.h.'>ckd_sub</a> (&amp;dpyinfo-&gt;server_time_offset,
<a id='L7989' name='L7989'></a>  7989                            monotonic_time / 1000, monotonic_ms)
<a id='L7990' name='L7990'></a>  7990                   || <a href='../S/2699.html#L33' title='Defined at 33 in lib/stdckdint.in.h.'>ckd_mul</a> (&amp;dpyinfo-&gt;server_time_offset,
<a id='L7991' name='L7991'></a>  7991                               dpyinfo-&gt;server_time_offset, 1000)
<a id='L7992' name='L7992'></a>  7992                   || <a href='../S/2699.html#L32' title='Defined at 32 in lib/stdckdint.in.h.'>ckd_sub</a> (&amp;dpyinfo-&gt;server_time_offset,
<a id='L7993' name='L7993'></a>  7993                               0, dpyinfo-&gt;server_time_offset))
<a id='L7994' name='L7994'></a>  7994                 dpyinfo-&gt;server_time_offset = 0;
<a id='L7995' name='L7995'></a>  7995             <em class='brace'>}</em>
<a id='L7996' name='L7996'></a>  7996         <em class='brace'>}</em>
<a id='L7997' name='L7997'></a>  7997     <em class='brace'>}</em>
<a id='L7998' name='L7998'></a>  7998 <em class='sharp'>#endif</em>
<a id='L7999' name='L7999'></a>  7999 
<a id='L8000' name='L8000'></a>  8000 <em class='sharp'>#ifndef</em> USE_GTK
<a id='L8001' name='L8001'></a>  8001   <em class='comment'>/* Don't waste bandwidth if the time hasn't actually changed.  */</em>
<a id='L8002' name='L8002'></a>  8002   <strong class='reserved'>if</strong> (focus_frame &amp;&amp; old_time != dpyinfo-&gt;last_user_time
<a id='L8003' name='L8003'></a>  8003       &amp;&amp; set_property)
<a id='L8004' name='L8004'></a>  8004     <em class='brace'>{</em>
<a id='L8005' name='L8005'></a>  8005       <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> = dpyinfo-&gt;last_user_time;
<a id='L8006' name='L8006'></a>  8006 
<a id='L8007' name='L8007'></a>  8007       <strong class='reserved'>while</strong> (<a href='../D/2370.html' title='Multiple defined in 2 places.'>FRAME_PARENT_FRAME</a> (focus_frame))
<a id='L8008' name='L8008'></a>  8008         focus_frame = <a href='../D/2370.html' title='Multiple defined in 2 places.'>FRAME_PARENT_FRAME</a> (focus_frame);
<a id='L8009' name='L8009'></a>  8009 
<a id='L8010' name='L8010'></a>  8010       <strong class='reserved'>if</strong> (<a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (focus_frame)-&gt;user_time_window != None)
<a id='L8011' name='L8011'></a>  8011         XChangeProperty (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L8012' name='L8012'></a>  8012                          <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (focus_frame)-&gt;user_time_window,
<a id='L8013' name='L8013'></a>  8013                          dpyinfo-&gt;Xatom_net_wm_user_time,
<a id='L8014' name='L8014'></a>  8014                          XA_CARDINAL, 32, PropModeReplace,
<a id='L8015' name='L8015'></a>  8015                          (<strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *) &amp;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>, 1);
<a id='L8016' name='L8016'></a>  8016     <em class='brace'>}</em>
<a id='L8017' name='L8017'></a>  8017 <em class='sharp'>#endif</em>
<a id='L8018' name='L8018'></a>  8018 <em class='brace'>}</em>
<a id='L8019' name='L8019'></a>  8019 
<a id='L8020' name='L8020'></a>  8020 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L8021' name='L8021'></a>  8021 
<a id='L8022' name='L8022'></a>  8022 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L8023' name='L8023'></a>  8023 <a href='../R/18308.html' title='Multiple referred from 3 places.'>x_set_gtk_user_time</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a> <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>)
<a id='L8024' name='L8024'></a>  8024 <em class='brace'>{</em>
<a id='L8025' name='L8025'></a>  8025   GtkWidget *widget;
<a id='L8026' name='L8026'></a>  8026   GdkWindow *<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>;
<a id='L8027' name='L8027'></a>  8027 
<a id='L8028' name='L8028'></a>  8028   widget = <a href='../D/2309.html' title='Multiple defined in 2 places.'>FRAME_GTK_OUTER_WIDGET</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L8029' name='L8029'></a>  8029   <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = gtk_widget_get_window (widget);
<a id='L8030' name='L8030'></a>  8030 
<a id='L8031' name='L8031'></a>  8031   <em class='comment'>/* This widget isn't realized yet.  */</em>
<a id='L8032' name='L8032'></a>  8032   <strong class='reserved'>if</strong> (!<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>)
<a id='L8033' name='L8033'></a>  8033     <strong class='reserved'>return</strong>;
<a id='L8034' name='L8034'></a>  8034 
<a id='L8035' name='L8035'></a>  8035   gdk_x11_window_set_user_time (<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>);
<a id='L8036' name='L8036'></a>  8036 <em class='brace'>}</em>
<a id='L8037' name='L8037'></a>  8037 
<a id='L8038' name='L8038'></a>  8038 <em class='sharp'>#endif</em>
<a id='L8039' name='L8039'></a>  8039 
<a id='L8040' name='L8040'></a>  8040 <em class='sharp'>#if</em> !<strong class='reserved'>defined</strong> USE_GTK || <strong class='reserved'>defined</strong> HAVE_XFIXES
<a id='L8041' name='L8041'></a>  8041 
<a id='L8042' name='L8042'></a>  8042 <em class='comment'>/* Create and return a special window for receiving events such as</em>
<a id='L8043' name='L8043'></a>  8043 <em class='comment'>   selection notify events, and reporting user time.  The window is an</em>
<a id='L8044' name='L8044'></a>  8044 <em class='comment'>   1x1 unmapped override-redirect InputOnly window at -1, -1 relative</em>
<a id='L8045' name='L8045'></a>  8045 <em class='comment'>   to the parent, which should prevent it from doing anything.  */</em>
<a id='L8046' name='L8046'></a>  8046 
<a id='L8047' name='L8047'></a>  8047 <strong class='reserved'>static</strong> <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a>
<a id='L8048' name='L8048'></a>  8048 <a href='../R/18103.html' title='Multiple referred from 2 places.'>x_create_special_window</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L8049' name='L8049'></a>  8049                          <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> parent_window)
<a id='L8050' name='L8050'></a>  8050 <em class='brace'>{</em>
<a id='L8051' name='L8051'></a>  8051   XSetWindowAttributes attrs;
<a id='L8052' name='L8052'></a>  8052 
<a id='L8053' name='L8053'></a>  8053   attrs.override_redirect = True;
<a id='L8054' name='L8054'></a>  8054 
<a id='L8055' name='L8055'></a>  8055   <strong class='reserved'>return</strong> XCreateWindow (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, parent_window,
<a id='L8056' name='L8056'></a>  8056                         -1, -1, 1, 1, 0, CopyFromParent, InputOnly,
<a id='L8057' name='L8057'></a>  8057                         CopyFromParent, CWOverrideRedirect, &amp;attrs);
<a id='L8058' name='L8058'></a>  8058 <em class='brace'>}</em>
<a id='L8059' name='L8059'></a>  8059 
<a id='L8060' name='L8060'></a>  8060 <em class='sharp'>#endif</em>
<a id='L8061' name='L8061'></a>  8061 
<a id='L8062' name='L8062'></a>  8062 <em class='comment'>/* Not needed on GTK because GTK handles reporting the user time</em>
<a id='L8063' name='L8063'></a>  8063 <em class='comment'>   itself.  */</em>
<a id='L8064' name='L8064'></a>  8064 
<a id='L8065' name='L8065'></a>  8065 <em class='sharp'>#ifndef</em> USE_GTK
<a id='L8066' name='L8066'></a>  8066 
<a id='L8067' name='L8067'></a>  8067 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L8068' name='L8068'></a>  8068 <a href='../R/18365.html' title='Multiple referred from 2 places.'>x_update_frame_user_time_window</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L8069' name='L8069'></a>  8069 <em class='brace'>{</em>
<a id='L8070' name='L8070'></a>  8070   <strong class='reserved'>struct</strong> <a href='../D/19627.html' title='Multiple defined in 5 places.'>x_output</a> *output;
<a id='L8071' name='L8071'></a>  8071   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L8072' name='L8072'></a>  8072 
<a id='L8073' name='L8073'></a>  8073   output = <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L8074' name='L8074'></a>  8074   dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L8075' name='L8075'></a>  8075 
<a id='L8076' name='L8076'></a>  8076   <strong class='reserved'>if</strong> (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (Vx_no_window_manager)
<a id='L8077' name='L8077'></a>  8077       || !x_wm_supports (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, dpyinfo-&gt;Xatom_net_wm_user_time))
<a id='L8078' name='L8078'></a>  8078     <em class='brace'>{</em>
<a id='L8079' name='L8079'></a>  8079       <strong class='reserved'>if</strong> (output-&gt;user_time_window != None
<a id='L8080' name='L8080'></a>  8080           &amp;&amp; output-&gt;user_time_window != <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L8081' name='L8081'></a>  8081         <em class='brace'>{</em>
<a id='L8082' name='L8082'></a>  8082           XDestroyWindow (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, output-&gt;user_time_window);
<a id='L8083' name='L8083'></a>  8083           XDeleteProperty (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L8084' name='L8084'></a>  8084                            dpyinfo-&gt;Xatom_net_wm_user_time_window);
<a id='L8085' name='L8085'></a>  8085         <em class='brace'>}</em>
<a id='L8086' name='L8086'></a>  8086       <strong class='reserved'>else</strong>
<a id='L8087' name='L8087'></a>  8087         XDeleteProperty (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L8088' name='L8088'></a>  8088                          dpyinfo-&gt;Xatom_net_wm_user_time);
<a id='L8089' name='L8089'></a>  8089 
<a id='L8090' name='L8090'></a>  8090       output-&gt;user_time_window = None;
<a id='L8091' name='L8091'></a>  8091       <strong class='reserved'>return</strong>;
<a id='L8092' name='L8092'></a>  8092     <em class='brace'>}</em>
<a id='L8093' name='L8093'></a>  8093 
<a id='L8094' name='L8094'></a>  8094   <strong class='reserved'>if</strong> (!x_wm_supports (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, dpyinfo-&gt;Xatom_net_wm_user_time_window))
<a id='L8095' name='L8095'></a>  8095     <em class='brace'>{</em>
<a id='L8096' name='L8096'></a>  8096       <strong class='reserved'>if</strong> (output-&gt;user_time_window == None)
<a id='L8097' name='L8097'></a>  8097         output-&gt;user_time_window = <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L8098' name='L8098'></a>  8098       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (output-&gt;user_time_window != <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L8099' name='L8099'></a>  8099         <em class='brace'>{</em>
<a id='L8100' name='L8100'></a>  8100           XDestroyWindow (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L8101' name='L8101'></a>  8101                           output-&gt;user_time_window);
<a id='L8102' name='L8102'></a>  8102           XDeleteProperty (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L8103' name='L8103'></a>  8103                            <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L8104' name='L8104'></a>  8104                            dpyinfo-&gt;Xatom_net_wm_user_time_window);
<a id='L8105' name='L8105'></a>  8105           output-&gt;user_time_window = <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L8106' name='L8106'></a>  8106         <em class='brace'>}</em>
<a id='L8107' name='L8107'></a>  8107     <em class='brace'>}</em>
<a id='L8108' name='L8108'></a>  8108   <strong class='reserved'>else</strong>
<a id='L8109' name='L8109'></a>  8109     <em class='brace'>{</em>
<a id='L8110' name='L8110'></a>  8110       <strong class='reserved'>if</strong> (output-&gt;user_time_window == <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L8111' name='L8111'></a>  8111           || output-&gt;user_time_window == None)
<a id='L8112' name='L8112'></a>  8112         <em class='brace'>{</em>
<a id='L8113' name='L8113'></a>  8113           <em class='comment'>/* Create a "user time" window that is used to report user</em>
<a id='L8114' name='L8114'></a>  8114 <em class='comment'>             activity on a given frame.  This is used in preference to</em>
<a id='L8115' name='L8115'></a>  8115 <em class='comment'>             _NET_WM_USER_TIME, as using a separate window allows the</em>
<a id='L8116' name='L8116'></a>  8116 <em class='comment'>             window manager to express interest in other properties</em>
<a id='L8117' name='L8117'></a>  8117 <em class='comment'>             while only reading the user time when necessary, thereby</em>
<a id='L8118' name='L8118'></a>  8118 <em class='comment'>             improving battery life by not involving the window</em>
<a id='L8119' name='L8119'></a>  8119 <em class='comment'>             manager in each key press.  */</em>
<a id='L8120' name='L8120'></a>  8120 
<a id='L8121' name='L8121'></a>  8121           output-&gt;user_time_window
<a id='L8122' name='L8122'></a>  8122             = <a href='../S/2289.html#L8048' title='Defined at 8048 in src/xterm.c.'>x_create_special_window</a> (dpyinfo, <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L8123' name='L8123'></a>  8123 
<a id='L8124' name='L8124'></a>  8124           XDeleteProperty (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L8125' name='L8125'></a>  8125                            dpyinfo-&gt;Xatom_net_wm_user_time);
<a id='L8126' name='L8126'></a>  8126           XChangeProperty (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L8127' name='L8127'></a>  8127                            dpyinfo-&gt;Xatom_net_wm_user_time_window,
<a id='L8128' name='L8128'></a>  8128                            XA_WINDOW, 32, PropModeReplace,
<a id='L8129' name='L8129'></a>  8129                            (<strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *) &amp;output-&gt;user_time_window, 1);
<a id='L8130' name='L8130'></a>  8130         <em class='brace'>}</em>
<a id='L8131' name='L8131'></a>  8131     <em class='brace'>}</em>
<a id='L8132' name='L8132'></a>  8132 <em class='brace'>}</em>
<a id='L8133' name='L8133'></a>  8133 
<a id='L8134' name='L8134'></a>  8134 <em class='sharp'>#endif</em>
<a id='L8135' name='L8135'></a>  8135 
<a id='L8136' name='L8136'></a>  8136 <strong class='reserved'>void</strong>
<a id='L8137' name='L8137'></a>  8137 <a href='../R/18313.html' title='Multiple referred from 2 places.'>x_set_last_user_time_from_lisp</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L8138' name='L8138'></a>  8138                                 <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a> <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>)
<a id='L8139' name='L8139'></a>  8139 <em class='brace'>{</em>
<a id='L8140' name='L8140'></a>  8140   <a href='../S/2289.html#L7929' title='Defined at 7929 in src/xterm.c.'>x_display_set_last_user_time</a> (dpyinfo, <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L8141' name='L8141'></a>  8141 <em class='brace'>}</em>
<a id='L8142' name='L8142'></a>  8142 
<a id='L8143' name='L8143'></a>  8143 
<a id='L8144' name='L8144'></a>  8144 <em class='comment'>/* Set S-&gt;gc to a suitable GC for drawing glyph string S in cursor</em>
<a id='L8145' name='L8145'></a>  8145 <em class='comment'>   face.  */</em>
<a id='L8146' name='L8146'></a>  8146 
<a id='L8147' name='L8147'></a>  8147 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L8148' name='L8148'></a>  8148 <a href='../S/2289.html#L8270' title='Referred from 8270 in src/xterm.c.'>x_set_cursor_gc</a> (<strong class='reserved'>struct</strong> <a href='../S/2315.html#L1336' title='Defined at 1336 in src/dispextern.h.'>glyph_string</a> *s)
<a id='L8149' name='L8149'></a>  8149 <em class='brace'>{</em>
<a id='L8150' name='L8150'></a>  8150   <strong class='reserved'>if</strong> (s-&gt;<a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a> == <a href='../D/2302.html' title='Multiple defined in 7 places.'>FRAME_FONT</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L8151' name='L8151'></a>  8151       &amp;&amp; s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;background == <a href='../S/2183.html#L1377' title='Defined at 1377 in src/frame.h.'>FRAME_BACKGROUND_PIXEL</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L8152' name='L8152'></a>  8152       &amp;&amp; s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;foreground == <a href='../S/2183.html#L1376' title='Defined at 1376 in src/frame.h.'>FRAME_FOREGROUND_PIXEL</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L8153' name='L8153'></a>  8153       &amp;&amp; !s-&gt;cmp)
<a id='L8154' name='L8154'></a>  8154     s-&gt;gc = s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;cursor_gc;
<a id='L8155' name='L8155'></a>  8155   <strong class='reserved'>else</strong>
<a id='L8156' name='L8156'></a>  8156     <em class='brace'>{</em>
<a id='L8157' name='L8157'></a>  8157       <em class='comment'>/* Cursor on non-default face: must merge.  */</em>
<a id='L8158' name='L8158'></a>  8158       XGCValues xgcv;
<a id='L8159' name='L8159'></a>  8159       <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> mask;
<a id='L8160' name='L8160'></a>  8160       <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> = <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L8161' name='L8161'></a>  8161 
<a id='L8162' name='L8162'></a>  8162       xgcv.background = s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;cursor_pixel;
<a id='L8163' name='L8163'></a>  8163       xgcv.foreground = s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;background;
<a id='L8164' name='L8164'></a>  8164 
<a id='L8165' name='L8165'></a>  8165       <em class='comment'>/* If the glyph would be invisible, try a different foreground.  */</em>
<a id='L8166' name='L8166'></a>  8166       <strong class='reserved'>if</strong> (xgcv.foreground == xgcv.background)
<a id='L8167' name='L8167'></a>  8167         xgcv.foreground = s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;foreground;
<a id='L8168' name='L8168'></a>  8168       <strong class='reserved'>if</strong> (xgcv.foreground == xgcv.background)
<a id='L8169' name='L8169'></a>  8169         xgcv.foreground = s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;cursor_foreground_pixel;
<a id='L8170' name='L8170'></a>  8170       <strong class='reserved'>if</strong> (xgcv.foreground == xgcv.background)
<a id='L8171' name='L8171'></a>  8171         xgcv.foreground = s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;foreground;
<a id='L8172' name='L8172'></a>  8172 
<a id='L8173' name='L8173'></a>  8173       <em class='comment'>/* Make sure the cursor is distinct from text in this face.  */</em>
<a id='L8174' name='L8174'></a>  8174       <strong class='reserved'>if</strong> (xgcv.background == s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;background
<a id='L8175' name='L8175'></a>  8175           &amp;&amp; xgcv.foreground == s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;foreground)
<a id='L8176' name='L8176'></a>  8176         <em class='brace'>{</em>
<a id='L8177' name='L8177'></a>  8177           xgcv.background = s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;foreground;
<a id='L8178' name='L8178'></a>  8178           xgcv.foreground = s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;background;
<a id='L8179' name='L8179'></a>  8179         <em class='brace'>}</em>
<a id='L8180' name='L8180'></a>  8180 
<a id='L8181' name='L8181'></a>  8181       <a href='../D/3115.html' title='Multiple defined in 2 places.'>IF_DEBUG</a> (x_check_font (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, s-&gt;<a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>));
<a id='L8182' name='L8182'></a>  8182       xgcv.graphics_exposures = False;
<a id='L8183' name='L8183'></a>  8183       xgcv.line_width = 1;
<a id='L8184' name='L8184'></a>  8184       mask = (<a href='../S/2315.html#L89' title='Defined at 89 in src/dispextern.h.'>GCForeground</a> | <a href='../S/2315.html#L90' title='Defined at 90 in src/dispextern.h.'>GCBackground</a>
<a id='L8185' name='L8185'></a>  8185               | <a href='../D/2628.html' title='Multiple defined in 5 places.'>GCGraphicsExposures</a>
<a id='L8186' name='L8186'></a>  8186               | GCLineWidth);
<a id='L8187' name='L8187'></a>  8187 
<a id='L8188' name='L8188'></a>  8188       <strong class='reserved'>if</strong> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;scratch_cursor_gc)
<a id='L8189' name='L8189'></a>  8189         <a href='../S/2215.html#L250' title='Defined at 250 in src/w32term.c.'>XChangeGC</a> (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;scratch_cursor_gc,
<a id='L8190' name='L8190'></a>  8190                    mask, &amp;xgcv);
<a id='L8191' name='L8191'></a>  8191       <strong class='reserved'>else</strong>
<a id='L8192' name='L8192'></a>  8192         <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;scratch_cursor_gc
<a id='L8193' name='L8193'></a>  8193           = <a href='../S/2215.html#L260' title='Defined at 260 in src/w32term.c.'>XCreateGC</a> (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../S/2212.html#L1352' title='Defined at 1352 in src/xterm.h.'>FRAME_X_DRAWABLE</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), mask, &amp;xgcv);
<a id='L8194' name='L8194'></a>  8194 
<a id='L8195' name='L8195'></a>  8195       s-&gt;gc = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;scratch_cursor_gc;
<a id='L8196' name='L8196'></a>  8196     <em class='brace'>}</em>
<a id='L8197' name='L8197'></a>  8197 <em class='brace'>}</em>
<a id='L8198' name='L8198'></a>  8198 
<a id='L8199' name='L8199'></a>  8199 
<a id='L8200' name='L8200'></a>  8200 <em class='comment'>/* Set up S-&gt;gc of glyph string S for drawing text in mouse face.  */</em>
<a id='L8201' name='L8201'></a>  8201 
<a id='L8202' name='L8202'></a>  8202 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L8203' name='L8203'></a>  8203 <a href='../R/18318.html' title='Multiple referred from 2 places.'>x_set_mouse_face_gc</a> (<strong class='reserved'>struct</strong> <a href='../S/2315.html#L1336' title='Defined at 1336 in src/dispextern.h.'>glyph_string</a> *s)
<a id='L8204' name='L8204'></a>  8204 <em class='brace'>{</em>
<a id='L8205' name='L8205'></a>  8205   <strong class='reserved'>if</strong> (s-&gt;<a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a> == s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;<a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>)
<a id='L8206' name='L8206'></a>  8206     s-&gt;gc = s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;gc;
<a id='L8207' name='L8207'></a>  8207   <strong class='reserved'>else</strong>
<a id='L8208' name='L8208'></a>  8208     <em class='brace'>{</em>
<a id='L8209' name='L8209'></a>  8209       <em class='comment'>/* Otherwise construct scratch_cursor_gc with values from FACE</em>
<a id='L8210' name='L8210'></a>  8210 <em class='comment'>         except for FONT.  */</em>
<a id='L8211' name='L8211'></a>  8211       XGCValues xgcv;
<a id='L8212' name='L8212'></a>  8212       <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> mask;
<a id='L8213' name='L8213'></a>  8213       <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> = <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L8214' name='L8214'></a>  8214 
<a id='L8215' name='L8215'></a>  8215       xgcv.background = s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;background;
<a id='L8216' name='L8216'></a>  8216       xgcv.foreground = s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;foreground;
<a id='L8217' name='L8217'></a>  8217       xgcv.graphics_exposures = False;
<a id='L8218' name='L8218'></a>  8218       xgcv.line_width = 1;
<a id='L8219' name='L8219'></a>  8219 
<a id='L8220' name='L8220'></a>  8220       mask = (<a href='../S/2315.html#L89' title='Defined at 89 in src/dispextern.h.'>GCForeground</a> | <a href='../S/2315.html#L90' title='Defined at 90 in src/dispextern.h.'>GCBackground</a>
<a id='L8221' name='L8221'></a>  8221               | <a href='../D/2628.html' title='Multiple defined in 5 places.'>GCGraphicsExposures</a>
<a id='L8222' name='L8222'></a>  8222               | GCLineWidth);
<a id='L8223' name='L8223'></a>  8223 
<a id='L8224' name='L8224'></a>  8224       <strong class='reserved'>if</strong> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;scratch_cursor_gc)
<a id='L8225' name='L8225'></a>  8225         <a href='../S/2215.html#L250' title='Defined at 250 in src/w32term.c.'>XChangeGC</a> (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;scratch_cursor_gc,
<a id='L8226' name='L8226'></a>  8226                    mask, &amp;xgcv);
<a id='L8227' name='L8227'></a>  8227       <strong class='reserved'>else</strong>
<a id='L8228' name='L8228'></a>  8228         <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;scratch_cursor_gc
<a id='L8229' name='L8229'></a>  8229           = <a href='../S/2215.html#L260' title='Defined at 260 in src/w32term.c.'>XCreateGC</a> (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../S/2212.html#L1352' title='Defined at 1352 in src/xterm.h.'>FRAME_X_DRAWABLE</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), mask, &amp;xgcv);
<a id='L8230' name='L8230'></a>  8230 
<a id='L8231' name='L8231'></a>  8231       s-&gt;gc = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;scratch_cursor_gc;
<a id='L8232' name='L8232'></a>  8232 
<a id='L8233' name='L8233'></a>  8233     <em class='brace'>}</em>
<a id='L8234' name='L8234'></a>  8234   <a href='../D/10871.html' title='Multiple defined in 5 places.'>eassert</a> (s-&gt;gc != 0);
<a id='L8235' name='L8235'></a>  8235 <em class='brace'>}</em>
<a id='L8236' name='L8236'></a>  8236 
<a id='L8237' name='L8237'></a>  8237 
<a id='L8238' name='L8238'></a>  8238 <em class='comment'>/* Set S-&gt;gc of glyph string S to a GC suitable for drawing a mode line.</em>
<a id='L8239' name='L8239'></a>  8239 <em class='comment'>   Faces to use in the mode line have already been computed when the</em>
<a id='L8240' name='L8240'></a>  8240 <em class='comment'>   matrix was built, so there isn't much to do, here.  */</em>
<a id='L8241' name='L8241'></a>  8241 
<a id='L8242' name='L8242'></a>  8242 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L8243' name='L8243'></a>  8243 <a href='../S/2289.html#L8265' title='Referred from 8265 in src/xterm.c.'>x_set_mode_line_face_gc</a> (<strong class='reserved'>struct</strong> <a href='../S/2315.html#L1336' title='Defined at 1336 in src/dispextern.h.'>glyph_string</a> *s)
<a id='L8244' name='L8244'></a>  8244 <em class='brace'>{</em>
<a id='L8245' name='L8245'></a>  8245   s-&gt;gc = s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;gc;
<a id='L8246' name='L8246'></a>  8246 <em class='brace'>}</em>
<a id='L8247' name='L8247'></a>  8247 
<a id='L8248' name='L8248'></a>  8248 
<a id='L8249' name='L8249'></a>  8249 <em class='comment'>/* Set S-&gt;gc of glyph string S for drawing that glyph string.  Set</em>
<a id='L8250' name='L8250'></a>  8250 <em class='comment'>   S-&gt;stippled_p to a non-zero value if the face of S has a stipple</em>
<a id='L8251' name='L8251'></a>  8251 <em class='comment'>   pattern.  */</em>
<a id='L8252' name='L8252'></a>  8252 
<a id='L8253' name='L8253'></a>  8253 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L8254' name='L8254'></a>  8254 <a href='../R/18307.html' title='Multiple referred from 4 places.'>x_set_glyph_string_gc</a> (<strong class='reserved'>struct</strong> <a href='../S/2315.html#L1336' title='Defined at 1336 in src/dispextern.h.'>glyph_string</a> *s)
<a id='L8255' name='L8255'></a>  8255 <em class='brace'>{</em>
<a id='L8256' name='L8256'></a>  8256   <a href='../S/2239.html#L4574' title='Defined at 4574 in src/xfaces.c.'>prepare_face_for_display</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>);
<a id='L8257' name='L8257'></a>  8257 
<a id='L8258' name='L8258'></a>  8258   <strong class='reserved'>if</strong> (s-&gt;hl == <a href='../S/2315.html#L1324' title='Defined at 1324 in src/dispextern.h.'>DRAW_NORMAL_TEXT</a>)
<a id='L8259' name='L8259'></a>  8259     <em class='brace'>{</em>
<a id='L8260' name='L8260'></a>  8260       s-&gt;gc = s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;gc;
<a id='L8261' name='L8261'></a>  8261       s-&gt;stippled_p = s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;stipple != 0;
<a id='L8262' name='L8262'></a>  8262     <em class='brace'>}</em>
<a id='L8263' name='L8263'></a>  8263   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (s-&gt;hl == <a href='../S/2315.html#L1325' title='Defined at 1325 in src/dispextern.h.'>DRAW_INVERSE_VIDEO</a>)
<a id='L8264' name='L8264'></a>  8264     <em class='brace'>{</em>
<a id='L8265' name='L8265'></a>  8265       <a href='../S/2289.html#L8243' title='Defined at 8243 in src/xterm.c.'>x_set_mode_line_face_gc</a> (s);
<a id='L8266' name='L8266'></a>  8266       s-&gt;stippled_p = s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;stipple != 0;
<a id='L8267' name='L8267'></a>  8267     <em class='brace'>}</em>
<a id='L8268' name='L8268'></a>  8268   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (s-&gt;hl == <a href='../S/2315.html#L1326' title='Defined at 1326 in src/dispextern.h.'>DRAW_CURSOR</a>)
<a id='L8269' name='L8269'></a>  8269     <em class='brace'>{</em>
<a id='L8270' name='L8270'></a>  8270       <a href='../S/2289.html#L8148' title='Defined at 8148 in src/xterm.c.'>x_set_cursor_gc</a> (s);
<a id='L8271' name='L8271'></a>  8271       s-&gt;stippled_p = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L8272' name='L8272'></a>  8272     <em class='brace'>}</em>
<a id='L8273' name='L8273'></a>  8273   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (s-&gt;hl == <a href='../S/2315.html#L1327' title='Defined at 1327 in src/dispextern.h.'>DRAW_MOUSE_FACE</a>)
<a id='L8274' name='L8274'></a>  8274     <em class='brace'>{</em>
<a id='L8275' name='L8275'></a>  8275       <a href='../S/2289.html#L8203' title='Defined at 8203 in src/xterm.c.'>x_set_mouse_face_gc</a> (s);
<a id='L8276' name='L8276'></a>  8276       s-&gt;stippled_p = s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;stipple != 0;
<a id='L8277' name='L8277'></a>  8277     <em class='brace'>}</em>
<a id='L8278' name='L8278'></a>  8278   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (s-&gt;hl == <a href='../S/2315.html#L1328' title='Defined at 1328 in src/dispextern.h.'>DRAW_IMAGE_RAISED</a>
<a id='L8279' name='L8279'></a>  8279            || s-&gt;hl == <a href='../S/2315.html#L1329' title='Defined at 1329 in src/dispextern.h.'>DRAW_IMAGE_SUNKEN</a>)
<a id='L8280' name='L8280'></a>  8280     <em class='brace'>{</em>
<a id='L8281' name='L8281'></a>  8281       s-&gt;gc = s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;gc;
<a id='L8282' name='L8282'></a>  8282       s-&gt;stippled_p = s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;stipple != 0;
<a id='L8283' name='L8283'></a>  8283     <em class='brace'>}</em>
<a id='L8284' name='L8284'></a>  8284   <strong class='reserved'>else</strong>
<a id='L8285' name='L8285'></a>  8285     <a href='../D/10893.html' title='Multiple defined in 6 places.'>emacs_abort</a> ();
<a id='L8286' name='L8286'></a>  8286 
<a id='L8287' name='L8287'></a>  8287   <em class='comment'>/* GC must have been set.  */</em>
<a id='L8288' name='L8288'></a>  8288   <a href='../D/10871.html' title='Multiple defined in 5 places.'>eassert</a> (s-&gt;gc != 0);
<a id='L8289' name='L8289'></a>  8289 <em class='brace'>}</em>
<a id='L8290' name='L8290'></a>  8290 
<a id='L8291' name='L8291'></a>  8291 
<a id='L8292' name='L8292'></a>  8292 <em class='comment'>/* Set clipping for output of glyph string S.  S may be part of a mode</em>
<a id='L8293' name='L8293'></a>  8293 <em class='comment'>   line or menu if we don't have X toolkit support.  */</em>
<a id='L8294' name='L8294'></a>  8294 
<a id='L8295' name='L8295'></a>  8295 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L8296' name='L8296'></a>  8296 <a href='../R/18305.html' title='Multiple referred from 6 places.'>x_set_glyph_string_clipping</a> (<strong class='reserved'>struct</strong> <a href='../S/2315.html#L1336' title='Defined at 1336 in src/dispextern.h.'>glyph_string</a> *s)
<a id='L8297' name='L8297'></a>  8297 <em class='brace'>{</em>
<a id='L8298' name='L8298'></a>  8298   <a href='../S/2150.html#L62' title='Defined at 62 in src/pgtkgui.h.'>XRectangle</a> *r = s-&gt;clip;
<a id='L8299' name='L8299'></a>  8299   <strong class='reserved'>int</strong> n = <a href='../S/2224.html#L2435' title='Defined at 2435 in src/xdisp.c.'>get_glyph_string_clip_rects</a> (s, r, 2);
<a id='L8300' name='L8300'></a>  8300 
<a id='L8301' name='L8301'></a>  8301   <strong class='reserved'>if</strong> (n &gt; 0)
<a id='L8302' name='L8302'></a>  8302     <a href='../S/2289.html#L6374' title='Defined at 6374 in src/xterm.c.'>x_set_clip_rectangles</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, s-&gt;gc, r, n);
<a id='L8303' name='L8303'></a>  8303   s-&gt;num_clips = n;
<a id='L8304' name='L8304'></a>  8304 <em class='brace'>}</em>
<a id='L8305' name='L8305'></a>  8305 
<a id='L8306' name='L8306'></a>  8306 
<a id='L8307' name='L8307'></a>  8307 <em class='comment'>/* Set SRC's clipping for output of glyph string DST.  This is called</em>
<a id='L8308' name='L8308'></a>  8308 <em class='comment'>   when we are drawing DST's left_overhang or right_overhang only in</em>
<a id='L8309' name='L8309'></a>  8309 <em class='comment'>   the area of SRC.  */</em>
<a id='L8310' name='L8310'></a>  8310 
<a id='L8311' name='L8311'></a>  8311 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L8312' name='L8312'></a>  8312 <a href='../R/18306.html' title='Multiple referred from 3 places.'>x_set_glyph_string_clipping_exactly</a> (<strong class='reserved'>struct</strong> <a href='../S/2315.html#L1336' title='Defined at 1336 in src/dispextern.h.'>glyph_string</a> *src, <strong class='reserved'>struct</strong> <a href='../S/2315.html#L1336' title='Defined at 1336 in src/dispextern.h.'>glyph_string</a> *dst)
<a id='L8313' name='L8313'></a>  8313 <em class='brace'>{</em>
<a id='L8314' name='L8314'></a>  8314   <a href='../S/2150.html#L62' title='Defined at 62 in src/pgtkgui.h.'>XRectangle</a> r;
<a id='L8315' name='L8315'></a>  8315 
<a id='L8316' name='L8316'></a>  8316   r.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = src-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L8317' name='L8317'></a>  8317   r.width = src-&gt;width;
<a id='L8318' name='L8318'></a>  8318   r.y = src-&gt;y;
<a id='L8319' name='L8319'></a>  8319   r.height = src-&gt;height;
<a id='L8320' name='L8320'></a>  8320   dst-&gt;clip[0] = r;
<a id='L8321' name='L8321'></a>  8321   dst-&gt;num_clips = 1;
<a id='L8322' name='L8322'></a>  8322   <a href='../S/2289.html#L6374' title='Defined at 6374 in src/xterm.c.'>x_set_clip_rectangles</a> (dst-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, dst-&gt;gc, &amp;r, 1);
<a id='L8323' name='L8323'></a>  8323 <em class='brace'>}</em>
<a id='L8324' name='L8324'></a>  8324 
<a id='L8325' name='L8325'></a>  8325 
<a id='L8326' name='L8326'></a>  8326 <em class='comment'>/* RIF:</em>
<a id='L8327' name='L8327'></a>  8327 <em class='comment'>   Compute left and right overhang of glyph string S.  */</em>
<a id='L8328' name='L8328'></a>  8328 
<a id='L8329' name='L8329'></a>  8329 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L8330' name='L8330'></a>  8330 <a href='../S/2289.html#L31333' title='Referred from 31333 in src/xterm.c.'>x_compute_glyph_string_overhangs</a> (<strong class='reserved'>struct</strong> <a href='../S/2315.html#L1336' title='Defined at 1336 in src/dispextern.h.'>glyph_string</a> *s)
<a id='L8331' name='L8331'></a>  8331 <em class='brace'>{</em>
<a id='L8332' name='L8332'></a>  8332   <strong class='reserved'>if</strong> (s-&gt;cmp == <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>
<a id='L8333' name='L8333'></a>  8333       &amp;&amp; (s-&gt;first_glyph-&gt;type == <a href='../S/2315.html#L416' title='Defined at 416 in src/dispextern.h.'>CHAR_GLYPH</a>
<a id='L8334' name='L8334'></a>  8334           || s-&gt;first_glyph-&gt;type == <a href='../S/2315.html#L419' title='Defined at 419 in src/dispextern.h.'>COMPOSITE_GLYPH</a>))
<a id='L8335' name='L8335'></a>  8335     <em class='brace'>{</em>
<a id='L8336' name='L8336'></a>  8336       <strong class='reserved'>struct</strong> <a href='../S/2293.html#L408' title='Defined at 408 in src/font.h.'>font_metrics</a> metrics;
<a id='L8337' name='L8337'></a>  8337 
<a id='L8338' name='L8338'></a>  8338       <strong class='reserved'>if</strong> (s-&gt;first_glyph-&gt;type == <a href='../S/2315.html#L416' title='Defined at 416 in src/dispextern.h.'>CHAR_GLYPH</a>)
<a id='L8339' name='L8339'></a>  8339         <em class='brace'>{</em>
<a id='L8340' name='L8340'></a>  8340           <strong class='reserved'>struct</strong> <a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a> *<a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a> = s-&gt;<a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>;
<a id='L8341' name='L8341'></a>  8341           <a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>-&gt;driver-&gt;text_extents (<a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>, s-&gt;char2b, s-&gt;nchars, &amp;metrics);
<a id='L8342' name='L8342'></a>  8342         <em class='brace'>}</em>
<a id='L8343' name='L8343'></a>  8343       <strong class='reserved'>else</strong>
<a id='L8344' name='L8344'></a>  8344         <em class='brace'>{</em>
<a id='L8345' name='L8345'></a>  8345           <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> gstring = <a href='../S/2165.html#L675' title='Defined at 675 in src/composite.c.'>composition_gstring_from_id</a> (s-&gt;cmp_id);
<a id='L8346' name='L8346'></a>  8346 
<a id='L8347' name='L8347'></a>  8347           <a href='../S/2165.html#L749' title='Defined at 749 in src/composite.c.'>composition_gstring_width</a> (gstring, s-&gt;cmp_from, s-&gt;cmp_to, &amp;metrics);
<a id='L8348' name='L8348'></a>  8348         <em class='brace'>}</em>
<a id='L8349' name='L8349'></a>  8349       s-&gt;right_overhang = (metrics.rbearing &gt; metrics.width
<a id='L8350' name='L8350'></a>  8350                            ? metrics.rbearing - metrics.width : 0);
<a id='L8351' name='L8351'></a>  8351       s-&gt;left_overhang = metrics.lbearing &lt; 0 ? - metrics.lbearing : 0;
<a id='L8352' name='L8352'></a>  8352     <em class='brace'>}</em>
<a id='L8353' name='L8353'></a>  8353   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (s-&gt;cmp)
<a id='L8354' name='L8354'></a>  8354     <em class='brace'>{</em>
<a id='L8355' name='L8355'></a>  8355       s-&gt;right_overhang = s-&gt;cmp-&gt;rbearing - s-&gt;cmp-&gt;pixel_width;
<a id='L8356' name='L8356'></a>  8356       s-&gt;left_overhang = - s-&gt;cmp-&gt;lbearing;
<a id='L8357' name='L8357'></a>  8357     <em class='brace'>}</em>
<a id='L8358' name='L8358'></a>  8358 <em class='brace'>}</em>
<a id='L8359' name='L8359'></a>  8359 
<a id='L8360' name='L8360'></a>  8360 
<a id='L8361' name='L8361'></a>  8361 <em class='comment'>/* Fill rectangle X, Y, W, H with background color of glyph string S.  */</em>
<a id='L8362' name='L8362'></a>  8362 
<a id='L8363' name='L8363'></a>  8363 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L8364' name='L8364'></a>  8364 <a href='../R/18072.html' title='Multiple referred from 3 places.'>x_clear_glyph_string_rect</a> (<strong class='reserved'>struct</strong> <a href='../S/2315.html#L1336' title='Defined at 1336 in src/dispextern.h.'>glyph_string</a> *s, <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, <strong class='reserved'>int</strong> y, <strong class='reserved'>int</strong> w, <strong class='reserved'>int</strong> h)
<a id='L8365' name='L8365'></a>  8365 <em class='brace'>{</em>
<a id='L8366' name='L8366'></a>  8366   <a href='../S/2289.html#L6577' title='Defined at 6577 in src/xterm.c.'>x_clear_rectangle</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, s-&gt;gc, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, w, h, s-&gt;hl != <a href='../S/2315.html#L1326' title='Defined at 1326 in src/dispextern.h.'>DRAW_CURSOR</a>);
<a id='L8367' name='L8367'></a>  8367 <em class='brace'>}</em>
<a id='L8368' name='L8368'></a>  8368 
<a id='L8369' name='L8369'></a>  8369 <em class='sharp'>#ifndef</em> USE_CAIRO
<a id='L8370' name='L8370'></a>  8370 
<a id='L8371' name='L8371'></a>  8371 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L8372' name='L8372'></a>  8372 <a href='../R/18073.html' title='Multiple referred from 4 places.'>x_clear_point</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/2619.html' title='Multiple defined in 2 places.'>GC</a> gc, <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, <strong class='reserved'>int</strong> y,
<a id='L8373' name='L8373'></a>  8373                <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> respect_alpha_background)
<a id='L8374' name='L8374'></a>  8374 <em class='brace'>{</em>
<a id='L8375' name='L8375'></a>  8375   XGCValues xgcv;
<a id='L8376' name='L8376'></a>  8376   <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy;
<a id='L8377' name='L8377'></a>  8377 
<a id='L8378' name='L8378'></a>  8378   dpy = <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L8379' name='L8379'></a>  8379 
<a id='L8380' name='L8380'></a>  8380   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;alpha_background != 1.0
<a id='L8381' name='L8381'></a>  8381       &amp;&amp; respect_alpha_background)
<a id='L8382' name='L8382'></a>  8382     <em class='brace'>{</em>
<a id='L8383' name='L8383'></a>  8383       <a href='../S/2289.html#L6577' title='Defined at 6577 in src/xterm.c.'>x_clear_rectangle</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, 1, 1, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L8384' name='L8384'></a>  8384       <strong class='reserved'>return</strong>;
<a id='L8385' name='L8385'></a>  8385     <em class='brace'>}</em>
<a id='L8386' name='L8386'></a>  8386 
<a id='L8387' name='L8387'></a>  8387   <a href='../S/2215.html#L271' title='Defined at 271 in src/w32term.c.'>XGetGCValues</a> (dpy, gc, <a href='../S/2315.html#L90' title='Defined at 90 in src/dispextern.h.'>GCBackground</a> | <a href='../S/2315.html#L89' title='Defined at 89 in src/dispextern.h.'>GCForeground</a>, &amp;xgcv);
<a id='L8388' name='L8388'></a>  8388   XSetForeground (dpy, gc, xgcv.background);
<a id='L8389' name='L8389'></a>  8389   XDrawPoint (dpy, <a href='../S/2212.html#L1352' title='Defined at 1352 in src/xterm.h.'>FRAME_X_DRAWABLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), gc, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y);
<a id='L8390' name='L8390'></a>  8390   XSetForeground (dpy, gc, xgcv.foreground);
<a id='L8391' name='L8391'></a>  8391 <em class='brace'>}</em>
<a id='L8392' name='L8392'></a>  8392 
<a id='L8393' name='L8393'></a>  8393 <em class='sharp'>#endif</em>
<a id='L8394' name='L8394'></a>  8394 
<a id='L8395' name='L8395'></a>  8395 <em class='comment'>/* Draw the background of glyph_string S.  If S-&gt;background_filled_p</em>
<a id='L8396' name='L8396'></a>  8396 <em class='comment'>   is non-zero don't draw it.  FORCE_P non-zero means draw the</em>
<a id='L8397' name='L8397'></a>  8397 <em class='comment'>   background even if it wouldn't be drawn normally.  This is used</em>
<a id='L8398' name='L8398'></a>  8398 <em class='comment'>   when a string preceding S draws into the background of S, or S</em>
<a id='L8399' name='L8399'></a>  8399 <em class='comment'>   contains the first component of a composition.  */</em>
<a id='L8400' name='L8400'></a>  8400 
<a id='L8401' name='L8401'></a>  8401 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L8402' name='L8402'></a>  8402 <a href='../R/18154.html' title='Multiple referred from 5 places.'>x_draw_glyph_string_background</a> (<strong class='reserved'>struct</strong> <a href='../S/2315.html#L1336' title='Defined at 1336 in src/dispextern.h.'>glyph_string</a> *s, <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> force_p)
<a id='L8403' name='L8403'></a>  8403 <em class='brace'>{</em>
<a id='L8404' name='L8404'></a>  8404   <em class='comment'>/* Nothing to do if background has already been drawn or if it</em>
<a id='L8405' name='L8405'></a>  8405 <em class='comment'>     shouldn't be drawn in the first place.  */</em>
<a id='L8406' name='L8406'></a>  8406   <strong class='reserved'>if</strong> (!s-&gt;background_filled_p)
<a id='L8407' name='L8407'></a>  8407     <em class='brace'>{</em>
<a id='L8408' name='L8408'></a>  8408       <strong class='reserved'>int</strong> box_line_width = <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;box_horizontal_line_width, 0);
<a id='L8409' name='L8409'></a>  8409 
<a id='L8410' name='L8410'></a>  8410       <strong class='reserved'>if</strong> (s-&gt;stippled_p)
<a id='L8411' name='L8411'></a>  8411         <em class='brace'>{</em>
<a id='L8412' name='L8412'></a>  8412           <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> = <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L8413' name='L8413'></a>  8413 
<a id='L8414' name='L8414'></a>  8414           <em class='comment'>/* Fill background with a stipple pattern.  */</em>
<a id='L8415' name='L8415'></a>  8415           XSetFillStyle (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, s-&gt;gc, FillOpaqueStippled);
<a id='L8416' name='L8416'></a>  8416           <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, s-&gt;gc, s-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>,
<a id='L8417' name='L8417'></a>  8417                             s-&gt;y + box_line_width,
<a id='L8418' name='L8418'></a>  8418                             s-&gt;background_width,
<a id='L8419' name='L8419'></a>  8419                             s-&gt;height - 2 * box_line_width,
<a id='L8420' name='L8420'></a>  8420                             s-&gt;hl != <a href='../S/2315.html#L1326' title='Defined at 1326 in src/dispextern.h.'>DRAW_CURSOR</a>);
<a id='L8421' name='L8421'></a>  8421           XSetFillStyle (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, s-&gt;gc, FillSolid);
<a id='L8422' name='L8422'></a>  8422           s-&gt;background_filled_p = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L8423' name='L8423'></a>  8423         <em class='brace'>}</em>
<a id='L8424' name='L8424'></a>  8424       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (<a href='../S/2293.html#L244' title='Defined at 244 in src/font.h.'>FONT_HEIGHT</a> (s-&gt;<a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>) &lt; s-&gt;height - 2 * box_line_width
<a id='L8425' name='L8425'></a>  8425                <em class='comment'>/* When xdisp.c ignores FONT_HEIGHT, we cannot trust</em>
<a id='L8426' name='L8426'></a>  8426 <em class='comment'>                  font dimensions, since the actual glyphs might be</em>
<a id='L8427' name='L8427'></a>  8427 <em class='comment'>                  much smaller.  So in that case we always clear the</em>
<a id='L8428' name='L8428'></a>  8428 <em class='comment'>                  rectangle with background color.  */</em>
<a id='L8429' name='L8429'></a>  8429                || <a href='../S/2315.html#L1637' title='Defined at 1637 in src/dispextern.h.'>FONT_TOO_HIGH</a> (s-&gt;<a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>)
<a id='L8430' name='L8430'></a>  8430                || s-&gt;font_not_found_p
<a id='L8431' name='L8431'></a>  8431                || s-&gt;extends_to_end_of_line_p
<a id='L8432' name='L8432'></a>  8432                || force_p)
<a id='L8433' name='L8433'></a>  8433         <em class='brace'>{</em>
<a id='L8434' name='L8434'></a>  8434           <a href='../S/2289.html#L8364' title='Defined at 8364 in src/xterm.c.'>x_clear_glyph_string_rect</a> (s, s-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, s-&gt;y + box_line_width,
<a id='L8435' name='L8435'></a>  8435                                      s-&gt;background_width,
<a id='L8436' name='L8436'></a>  8436                                      s-&gt;height - 2 * box_line_width);
<a id='L8437' name='L8437'></a>  8437           s-&gt;background_filled_p = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L8438' name='L8438'></a>  8438         <em class='brace'>}</em>
<a id='L8439' name='L8439'></a>  8439     <em class='brace'>}</em>
<a id='L8440' name='L8440'></a>  8440 <em class='brace'>}</em>
<a id='L8441' name='L8441'></a>  8441 
<a id='L8442' name='L8442'></a>  8442 
<a id='L8443' name='L8443'></a>  8443 <em class='comment'>/* Draw the foreground of glyph string S.  */</em>
<a id='L8444' name='L8444'></a>  8444 
<a id='L8445' name='L8445'></a>  8445 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L8446' name='L8446'></a>  8446 <a href='../R/18157.html' title='Multiple referred from 3 places.'>x_draw_glyph_string_foreground</a> (<strong class='reserved'>struct</strong> <a href='../S/2315.html#L1336' title='Defined at 1336 in src/dispextern.h.'>glyph_string</a> *s)
<a id='L8447' name='L8447'></a>  8447 <em class='brace'>{</em>
<a id='L8448' name='L8448'></a>  8448   <strong class='reserved'>int</strong> i, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L8449' name='L8449'></a>  8449 
<a id='L8450' name='L8450'></a>  8450   <em class='comment'>/* If first glyph of S has a left box line, start drawing the text</em>
<a id='L8451' name='L8451'></a>  8451 <em class='comment'>     of S to the right of that box line.  */</em>
<a id='L8452' name='L8452'></a>  8452   <strong class='reserved'>if</strong> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;box != <a href='../S/2315.html#L1678' title='Defined at 1678 in src/dispextern.h.'>FACE_NO_BOX</a>
<a id='L8453' name='L8453'></a>  8453       &amp;&amp; s-&gt;first_glyph-&gt;left_box_line_p)
<a id='L8454' name='L8454'></a>  8454     <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = s-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;box_vertical_line_width, 0);
<a id='L8455' name='L8455'></a>  8455   <strong class='reserved'>else</strong>
<a id='L8456' name='L8456'></a>  8456     <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = s-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L8457' name='L8457'></a>  8457 
<a id='L8458' name='L8458'></a>  8458   <em class='comment'>/* Draw characters of S as rectangles if S's font could not be</em>
<a id='L8459' name='L8459'></a>  8459 <em class='comment'>     loaded.  */</em>
<a id='L8460' name='L8460'></a>  8460   <strong class='reserved'>if</strong> (s-&gt;font_not_found_p)
<a id='L8461' name='L8461'></a>  8461     <em class='brace'>{</em>
<a id='L8462' name='L8462'></a>  8462       <strong class='reserved'>for</strong> (i = 0; i &lt; s-&gt;nchars; ++i)
<a id='L8463' name='L8463'></a>  8463         <em class='brace'>{</em>
<a id='L8464' name='L8464'></a>  8464           <strong class='reserved'>struct</strong> <a href='../S/2315.html#L454' title='Defined at 454 in src/dispextern.h.'>glyph</a> *<a href='../S/4101.html#L90' title='Defined at 90 in test/manual/etags/cp-src/c.C.'>g</a> = s-&gt;first_glyph + i;
<a id='L8465' name='L8465'></a>  8465           <a href='../S/2289.html#L6625' title='Defined at 6625 in src/xterm.c.'>x_draw_rectangle</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>,
<a id='L8466' name='L8466'></a>  8466                           s-&gt;gc, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, s-&gt;y, <a href='../S/4101.html#L90' title='Defined at 90 in test/manual/etags/cp-src/c.C.'>g</a>-&gt;pixel_width - 1,
<a id='L8467' name='L8467'></a>  8467                           s-&gt;height - 1);
<a id='L8468' name='L8468'></a>  8468           <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> += <a href='../S/4101.html#L90' title='Defined at 90 in test/manual/etags/cp-src/c.C.'>g</a>-&gt;pixel_width;
<a id='L8469' name='L8469'></a>  8469         <em class='brace'>}</em>
<a id='L8470' name='L8470'></a>  8470     <em class='brace'>}</em>
<a id='L8471' name='L8471'></a>  8471   <strong class='reserved'>else</strong>
<a id='L8472' name='L8472'></a>  8472     <em class='brace'>{</em>
<a id='L8473' name='L8473'></a>  8473       <strong class='reserved'>struct</strong> <a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a> *<a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a> = s-&gt;<a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>;
<a id='L8474' name='L8474'></a>  8474 <em class='sharp'>#ifdef</em> USE_CAIRO
<a id='L8475' name='L8475'></a>  8475       <strong class='reserved'>if</strong> (!<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (<a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>-&gt;driver-&gt;type, Qx)
<a id='L8476' name='L8476'></a>  8476           || <a href='../S/2289.html#L6025' title='Defined at 6025 in src/xterm.c.'>x_try_cr_xlib_drawable</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, s-&gt;gc))
<a id='L8477' name='L8477'></a>  8477         <em class='brace'>{</em>
<a id='L8478' name='L8478'></a>  8478 <em class='sharp'>#endif</em>  <em class='comment'>/* USE_CAIRO */</em>
<a id='L8479' name='L8479'></a>  8479           <strong class='reserved'>int</strong> boff = <a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>-&gt;baseline_offset;
<a id='L8480' name='L8480'></a>  8480           <strong class='reserved'>int</strong> y;
<a id='L8481' name='L8481'></a>  8481 
<a id='L8482' name='L8482'></a>  8482           <strong class='reserved'>if</strong> (<a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>-&gt;vertical_centering)
<a id='L8483' name='L8483'></a>  8483             boff = <a href='../S/2315.html#L1627' title='Defined at 1627 in src/dispextern.h.'>VCENTER_BASELINE_OFFSET</a> (<a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>, s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) - boff;
<a id='L8484' name='L8484'></a>  8484 
<a id='L8485' name='L8485'></a>  8485           y = s-&gt;ybase - boff;
<a id='L8486' name='L8486'></a>  8486           <strong class='reserved'>if</strong> (s-&gt;for_overlaps
<a id='L8487' name='L8487'></a>  8487               || (s-&gt;background_filled_p &amp;&amp; s-&gt;hl != <a href='../S/2315.html#L1326' title='Defined at 1326 in src/dispextern.h.'>DRAW_CURSOR</a>))
<a id='L8488' name='L8488'></a>  8488             <a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>-&gt;driver-&gt;<a href='../D/10617.html' title='Multiple defined in 2 places.'>draw</a> (s, 0, s-&gt;nchars, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L8489' name='L8489'></a>  8489           <strong class='reserved'>else</strong>
<a id='L8490' name='L8490'></a>  8490             <a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>-&gt;driver-&gt;<a href='../D/10617.html' title='Multiple defined in 2 places.'>draw</a> (s, 0, s-&gt;nchars, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L8491' name='L8491'></a>  8491           <strong class='reserved'>if</strong> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;overstrike)
<a id='L8492' name='L8492'></a>  8492             <a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>-&gt;driver-&gt;<a href='../D/10617.html' title='Multiple defined in 2 places.'>draw</a> (s, 0, s-&gt;nchars, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + 1, y, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L8493' name='L8493'></a>  8493 <em class='sharp'>#ifdef</em> USE_CAIRO
<a id='L8494' name='L8494'></a>  8494           <strong class='reserved'>if</strong> (<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (<a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>-&gt;driver-&gt;type, Qx))
<a id='L8495' name='L8495'></a>  8495             <a href='../S/2289.html#L6090' title='Defined at 6090 in src/xterm.c.'>x_end_cr_xlib_drawable</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, s-&gt;gc);
<a id='L8496' name='L8496'></a>  8496         <em class='brace'>}</em>
<a id='L8497' name='L8497'></a>  8497       <strong class='reserved'>else</strong>
<a id='L8498' name='L8498'></a>  8498         <em class='brace'>{</em>
<a id='L8499' name='L8499'></a>  8499           <em class='comment'>/* Fallback for the case that no Xlib Drawable is available</em>
<a id='L8500' name='L8500'></a>  8500 <em class='comment'>             for drawing text with X core fonts.  */</em>
<a id='L8501' name='L8501'></a>  8501           <strong class='reserved'>if</strong> (!(s-&gt;for_overlaps
<a id='L8502' name='L8502'></a>  8502                 || (s-&gt;background_filled_p &amp;&amp; s-&gt;hl != <a href='../S/2315.html#L1326' title='Defined at 1326 in src/dispextern.h.'>DRAW_CURSOR</a>)))
<a id='L8503' name='L8503'></a>  8503             <em class='brace'>{</em>
<a id='L8504' name='L8504'></a>  8504               <strong class='reserved'>int</strong> box_line_width = <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;box_horizontal_line_width, 0);
<a id='L8505' name='L8505'></a>  8505 
<a id='L8506' name='L8506'></a>  8506               <strong class='reserved'>if</strong> (s-&gt;stippled_p)
<a id='L8507' name='L8507'></a>  8507                 <em class='brace'>{</em>
<a id='L8508' name='L8508'></a>  8508                   <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> = <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L8509' name='L8509'></a>  8509 
<a id='L8510' name='L8510'></a>  8510                   <em class='comment'>/* Fill background with a stipple pattern.  */</em>
<a id='L8511' name='L8511'></a>  8511                   XSetFillStyle (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, s-&gt;gc, FillOpaqueStippled);
<a id='L8512' name='L8512'></a>  8512                   <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, s-&gt;gc, s-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>,
<a id='L8513' name='L8513'></a>  8513                                     s-&gt;y + box_line_width,
<a id='L8514' name='L8514'></a>  8514                                     s-&gt;background_width,
<a id='L8515' name='L8515'></a>  8515                                     s-&gt;height - 2 * box_line_width,
<a id='L8516' name='L8516'></a>  8516                                     <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L8517' name='L8517'></a>  8517                   XSetFillStyle (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, s-&gt;gc, FillSolid);
<a id='L8518' name='L8518'></a>  8518                 <em class='brace'>}</em>
<a id='L8519' name='L8519'></a>  8519               <strong class='reserved'>else</strong>
<a id='L8520' name='L8520'></a>  8520                 <a href='../S/2289.html#L8364' title='Defined at 8364 in src/xterm.c.'>x_clear_glyph_string_rect</a> (s, s-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, s-&gt;y + box_line_width,
<a id='L8521' name='L8521'></a>  8521                                            s-&gt;background_width,
<a id='L8522' name='L8522'></a>  8522                                            s-&gt;height - 2 * box_line_width);
<a id='L8523' name='L8523'></a>  8523             <em class='brace'>}</em>
<a id='L8524' name='L8524'></a>  8524           <strong class='reserved'>for</strong> (i = 0; i &lt; s-&gt;nchars; ++i)
<a id='L8525' name='L8525'></a>  8525             <em class='brace'>{</em>
<a id='L8526' name='L8526'></a>  8526               <strong class='reserved'>struct</strong> <a href='../S/2315.html#L454' title='Defined at 454 in src/dispextern.h.'>glyph</a> *<a href='../S/4101.html#L90' title='Defined at 90 in test/manual/etags/cp-src/c.C.'>g</a> = s-&gt;first_glyph + i;
<a id='L8527' name='L8527'></a>  8527               <a href='../S/2289.html#L6625' title='Defined at 6625 in src/xterm.c.'>x_draw_rectangle</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>,
<a id='L8528' name='L8528'></a>  8528                                 s-&gt;gc, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, s-&gt;y, <a href='../S/4101.html#L90' title='Defined at 90 in test/manual/etags/cp-src/c.C.'>g</a>-&gt;pixel_width - 1,
<a id='L8529' name='L8529'></a>  8529                                 s-&gt;height - 1);
<a id='L8530' name='L8530'></a>  8530               <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> += <a href='../S/4101.html#L90' title='Defined at 90 in test/manual/etags/cp-src/c.C.'>g</a>-&gt;pixel_width;
<a id='L8531' name='L8531'></a>  8531             <em class='brace'>}</em>
<a id='L8532' name='L8532'></a>  8532         <em class='brace'>}</em>
<a id='L8533' name='L8533'></a>  8533 <em class='sharp'>#endif</em>  <em class='comment'>/* USE_CAIRO */</em>
<a id='L8534' name='L8534'></a>  8534     <em class='brace'>}</em>
<a id='L8535' name='L8535'></a>  8535 <em class='brace'>}</em>
<a id='L8536' name='L8536'></a>  8536 
<a id='L8537' name='L8537'></a>  8537 <em class='comment'>/* Draw the foreground of composite glyph string S.  */</em>
<a id='L8538' name='L8538'></a>  8538 
<a id='L8539' name='L8539'></a>  8539 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L8540' name='L8540'></a>  8540 <a href='../R/18151.html' title='Multiple referred from 3 places.'>x_draw_composite_glyph_string_foreground</a> (<strong class='reserved'>struct</strong> <a href='../S/2315.html#L1336' title='Defined at 1336 in src/dispextern.h.'>glyph_string</a> *s)
<a id='L8541' name='L8541'></a>  8541 <em class='brace'>{</em>
<a id='L8542' name='L8542'></a>  8542   <strong class='reserved'>int</strong> i, j, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L8543' name='L8543'></a>  8543   <strong class='reserved'>struct</strong> <a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a> *<a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a> = s-&gt;<a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>;
<a id='L8544' name='L8544'></a>  8544 
<a id='L8545' name='L8545'></a>  8545   <em class='comment'>/* If first glyph of S has a left box line, start drawing the text</em>
<a id='L8546' name='L8546'></a>  8546 <em class='comment'>     of S to the right of that box line.  */</em>
<a id='L8547' name='L8547'></a>  8547   <strong class='reserved'>if</strong> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a> &amp;&amp; s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;box != <a href='../S/2315.html#L1678' title='Defined at 1678 in src/dispextern.h.'>FACE_NO_BOX</a>
<a id='L8548' name='L8548'></a>  8548       &amp;&amp; s-&gt;first_glyph-&gt;left_box_line_p)
<a id='L8549' name='L8549'></a>  8549     <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = s-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;box_vertical_line_width, 0);
<a id='L8550' name='L8550'></a>  8550   <strong class='reserved'>else</strong>
<a id='L8551' name='L8551'></a>  8551     <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = s-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L8552' name='L8552'></a>  8552 
<a id='L8553' name='L8553'></a>  8553   <em class='comment'>/* S is a glyph string for a composition.  S-&gt;cmp_from is the index</em>
<a id='L8554' name='L8554'></a>  8554 <em class='comment'>     of the first character drawn for glyphs of this composition.</em>
<a id='L8555' name='L8555'></a>  8555 <em class='comment'>     S-&gt;cmp_from == 0 means we are drawing the very first character of</em>
<a id='L8556' name='L8556'></a>  8556 <em class='comment'>     this composition.  */</em>
<a id='L8557' name='L8557'></a>  8557 
<a id='L8558' name='L8558'></a>  8558   <em class='comment'>/* Draw a rectangle for the composition if the font for the very</em>
<a id='L8559' name='L8559'></a>  8559 <em class='comment'>     first character of the composition could not be loaded.  */</em>
<a id='L8560' name='L8560'></a>  8560   <strong class='reserved'>if</strong> (s-&gt;font_not_found_p)
<a id='L8561' name='L8561'></a>  8561     <em class='brace'>{</em>
<a id='L8562' name='L8562'></a>  8562       <strong class='reserved'>if</strong> (s-&gt;cmp_from == 0)
<a id='L8563' name='L8563'></a>  8563         <a href='../S/2289.html#L6625' title='Defined at 6625 in src/xterm.c.'>x_draw_rectangle</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, s-&gt;gc, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, s-&gt;y,
<a id='L8564' name='L8564'></a>  8564                         s-&gt;width - 1, s-&gt;height - 1);
<a id='L8565' name='L8565'></a>  8565     <em class='brace'>}</em>
<a id='L8566' name='L8566'></a>  8566   <strong class='reserved'>else</strong>
<a id='L8567' name='L8567'></a>  8567 <em class='sharp'>#ifdef</em> USE_CAIRO
<a id='L8568' name='L8568'></a>  8568     <strong class='reserved'>if</strong> (!<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (<a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>-&gt;driver-&gt;type, Qx)
<a id='L8569' name='L8569'></a>  8569         || <a href='../S/2289.html#L6025' title='Defined at 6025 in src/xterm.c.'>x_try_cr_xlib_drawable</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, s-&gt;gc))
<a id='L8570' name='L8570'></a>  8570       <em class='brace'>{</em>
<a id='L8571' name='L8571'></a>  8571 <em class='sharp'>#endif</em>  <em class='comment'>/* USE_CAIRO */</em>
<a id='L8572' name='L8572'></a>  8572         <strong class='reserved'>if</strong> (! s-&gt;first_glyph-&gt;u.cmp.automatic)
<a id='L8573' name='L8573'></a>  8573           <em class='brace'>{</em>
<a id='L8574' name='L8574'></a>  8574             <strong class='reserved'>int</strong> y = s-&gt;ybase;
<a id='L8575' name='L8575'></a>  8575 
<a id='L8576' name='L8576'></a>  8576             <strong class='reserved'>for</strong> (i = 0, j = s-&gt;cmp_from; i &lt; s-&gt;nchars; i++, j++)
<a id='L8577' name='L8577'></a>  8577               <em class='comment'>/* TAB in a composition means display glyphs with</em>
<a id='L8578' name='L8578'></a>  8578 <em class='comment'>                 padding space on the left or right.  */</em>
<a id='L8579' name='L8579'></a>  8579               <strong class='reserved'>if</strong> (<a href='../S/2177.html#L89' title='Defined at 89 in src/composite.h.'>COMPOSITION_GLYPH</a> (s-&gt;cmp, j) != '\t')
<a id='L8580' name='L8580'></a>  8580                 <em class='brace'>{</em>
<a id='L8581' name='L8581'></a>  8581                   <strong class='reserved'>int</strong> <a href='../S/3351.html#L108' title='Defined at 108 in test/lisp/cedet/semantic-utest-ia-resources/testdoublens.cpp.'>xx</a> = <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + s-&gt;cmp-&gt;offsets[j * 2];
<a id='L8582' name='L8582'></a>  8582                   <strong class='reserved'>int</strong> yy = y - s-&gt;cmp-&gt;offsets[j * 2 + 1];
<a id='L8583' name='L8583'></a>  8583 
<a id='L8584' name='L8584'></a>  8584                   <a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>-&gt;driver-&gt;<a href='../D/10617.html' title='Multiple defined in 2 places.'>draw</a> (s, j, j + 1, <a href='../S/3351.html#L108' title='Defined at 108 in test/lisp/cedet/semantic-utest-ia-resources/testdoublens.cpp.'>xx</a>, yy, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L8585' name='L8585'></a>  8585                   <strong class='reserved'>if</strong> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;overstrike)
<a id='L8586' name='L8586'></a>  8586                     <a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>-&gt;driver-&gt;<a href='../D/10617.html' title='Multiple defined in 2 places.'>draw</a> (s, j, j + 1, <a href='../S/3351.html#L108' title='Defined at 108 in test/lisp/cedet/semantic-utest-ia-resources/testdoublens.cpp.'>xx</a> + 1, yy, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L8587' name='L8587'></a>  8587                 <em class='brace'>}</em>
<a id='L8588' name='L8588'></a>  8588           <em class='brace'>}</em>
<a id='L8589' name='L8589'></a>  8589         <strong class='reserved'>else</strong>
<a id='L8590' name='L8590'></a>  8590           <em class='brace'>{</em>
<a id='L8591' name='L8591'></a>  8591             <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> gstring = <a href='../S/2165.html#L675' title='Defined at 675 in src/composite.c.'>composition_gstring_from_id</a> (s-&gt;cmp_id);
<a id='L8592' name='L8592'></a>  8592             <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../S/2315.html#L454' title='Defined at 454 in src/dispextern.h.'>glyph</a>;
<a id='L8593' name='L8593'></a>  8593             <strong class='reserved'>int</strong> y = s-&gt;ybase;
<a id='L8594' name='L8594'></a>  8594             <strong class='reserved'>int</strong> width = 0;
<a id='L8595' name='L8595'></a>  8595 
<a id='L8596' name='L8596'></a>  8596             <strong class='reserved'>for</strong> (i = j = s-&gt;cmp_from; i &lt; s-&gt;cmp_to; i++)
<a id='L8597' name='L8597'></a>  8597               <em class='brace'>{</em>
<a id='L8598' name='L8598'></a>  8598                 <a href='../S/2315.html#L454' title='Defined at 454 in src/dispextern.h.'>glyph</a> = <a href='../S/2177.html#L276' title='Defined at 276 in src/composite.h.'>LGSTRING_GLYPH</a> (gstring, i);
<a id='L8599' name='L8599'></a>  8599                 <strong class='reserved'>if</strong> (<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (<a href='../S/2177.html#L315' title='Defined at 315 in src/composite.h.'>LGLYPH_ADJUSTMENT</a> (<a href='../S/2315.html#L454' title='Defined at 454 in src/dispextern.h.'>glyph</a>)))
<a id='L8600' name='L8600'></a>  8600                   width += <a href='../S/2177.html#L310' title='Defined at 310 in src/composite.h.'>LGLYPH_WIDTH</a> (<a href='../S/2315.html#L454' title='Defined at 454 in src/dispextern.h.'>glyph</a>);
<a id='L8601' name='L8601'></a>  8601                 <strong class='reserved'>else</strong>
<a id='L8602' name='L8602'></a>  8602                   <em class='brace'>{</em>
<a id='L8603' name='L8603'></a>  8603                     <strong class='reserved'>int</strong> xoff, yoff, wadjust;
<a id='L8604' name='L8604'></a>  8604 
<a id='L8605' name='L8605'></a>  8605                     <strong class='reserved'>if</strong> (j &lt; i)
<a id='L8606' name='L8606'></a>  8606                       <em class='brace'>{</em>
<a id='L8607' name='L8607'></a>  8607                         <a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>-&gt;driver-&gt;<a href='../D/10617.html' title='Multiple defined in 2 places.'>draw</a> (s, j, i, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L8608' name='L8608'></a>  8608                         <strong class='reserved'>if</strong> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;overstrike)
<a id='L8609' name='L8609'></a>  8609                           <a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>-&gt;driver-&gt;<a href='../D/10617.html' title='Multiple defined in 2 places.'>draw</a> (s, j, i, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + 1, y, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L8610' name='L8610'></a>  8610                         <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> += width;
<a id='L8611' name='L8611'></a>  8611                       <em class='brace'>}</em>
<a id='L8612' name='L8612'></a>  8612                     xoff = <a href='../S/2177.html#L331' title='Defined at 331 in src/composite.h.'>LGLYPH_XOFF</a> (<a href='../S/2315.html#L454' title='Defined at 454 in src/dispextern.h.'>glyph</a>);
<a id='L8613' name='L8613'></a>  8613                     yoff = <a href='../S/2177.html#L333' title='Defined at 333 in src/composite.h.'>LGLYPH_YOFF</a> (<a href='../S/2315.html#L454' title='Defined at 454 in src/dispextern.h.'>glyph</a>);
<a id='L8614' name='L8614'></a>  8614                     wadjust = <a href='../S/2177.html#L335' title='Defined at 335 in src/composite.h.'>LGLYPH_WADJUST</a> (<a href='../S/2315.html#L454' title='Defined at 454 in src/dispextern.h.'>glyph</a>);
<a id='L8615' name='L8615'></a>  8615                     <a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>-&gt;driver-&gt;<a href='../D/10617.html' title='Multiple defined in 2 places.'>draw</a> (s, i, i + 1, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + xoff, y + yoff, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L8616' name='L8616'></a>  8616                     <strong class='reserved'>if</strong> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;overstrike)
<a id='L8617' name='L8617'></a>  8617                       <a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>-&gt;driver-&gt;<a href='../D/10617.html' title='Multiple defined in 2 places.'>draw</a> (s, i, i + 1, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + xoff + 1, y + yoff,
<a id='L8618' name='L8618'></a>  8618                                           <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L8619' name='L8619'></a>  8619                     <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> += wadjust;
<a id='L8620' name='L8620'></a>  8620                     j = i + 1;
<a id='L8621' name='L8621'></a>  8621                     width = 0;
<a id='L8622' name='L8622'></a>  8622                   <em class='brace'>}</em>
<a id='L8623' name='L8623'></a>  8623               <em class='brace'>}</em>
<a id='L8624' name='L8624'></a>  8624             <strong class='reserved'>if</strong> (j &lt; i)
<a id='L8625' name='L8625'></a>  8625               <em class='brace'>{</em>
<a id='L8626' name='L8626'></a>  8626                 <a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>-&gt;driver-&gt;<a href='../D/10617.html' title='Multiple defined in 2 places.'>draw</a> (s, j, i, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L8627' name='L8627'></a>  8627                 <strong class='reserved'>if</strong> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;overstrike)
<a id='L8628' name='L8628'></a>  8628                   <a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>-&gt;driver-&gt;<a href='../D/10617.html' title='Multiple defined in 2 places.'>draw</a> (s, j, i, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + 1, y, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L8629' name='L8629'></a>  8629               <em class='brace'>}</em>
<a id='L8630' name='L8630'></a>  8630           <em class='brace'>}</em>
<a id='L8631' name='L8631'></a>  8631 <em class='sharp'>#ifdef</em> USE_CAIRO
<a id='L8632' name='L8632'></a>  8632         <strong class='reserved'>if</strong> (<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (<a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>-&gt;driver-&gt;type, Qx))
<a id='L8633' name='L8633'></a>  8633           <a href='../S/2289.html#L6090' title='Defined at 6090 in src/xterm.c.'>x_end_cr_xlib_drawable</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, s-&gt;gc);
<a id='L8634' name='L8634'></a>  8634       <em class='brace'>}</em>
<a id='L8635' name='L8635'></a>  8635     <strong class='reserved'>else</strong>
<a id='L8636' name='L8636'></a>  8636       <em class='brace'>{</em>
<a id='L8637' name='L8637'></a>  8637         <em class='comment'>/* Fallback for the case that no Xlib Drawable is available</em>
<a id='L8638' name='L8638'></a>  8638 <em class='comment'>           for drawing text with X core fonts.  */</em>
<a id='L8639' name='L8639'></a>  8639         <strong class='reserved'>if</strong> (s-&gt;cmp_from == 0)
<a id='L8640' name='L8640'></a>  8640           <a href='../S/2289.html#L6625' title='Defined at 6625 in src/xterm.c.'>x_draw_rectangle</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, s-&gt;gc, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, s-&gt;y,
<a id='L8641' name='L8641'></a>  8641                             s-&gt;width - 1, s-&gt;height - 1);
<a id='L8642' name='L8642'></a>  8642       <em class='brace'>}</em>
<a id='L8643' name='L8643'></a>  8643 <em class='sharp'>#endif</em>  <em class='comment'>/* USE_CAIRO */</em>
<a id='L8644' name='L8644'></a>  8644 <em class='brace'>}</em>
<a id='L8645' name='L8645'></a>  8645 
<a id='L8646' name='L8646'></a>  8646 
<a id='L8647' name='L8647'></a>  8647 <em class='comment'>/* Draw the foreground of glyph string S for glyphless characters.  */</em>
<a id='L8648' name='L8648'></a>  8648 
<a id='L8649' name='L8649'></a>  8649 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L8650' name='L8650'></a>  8650 <a href='../S/2289.html#L10777' title='Referred from 10777 in src/xterm.c.'>x_draw_glyphless_glyph_string_foreground</a> (<strong class='reserved'>struct</strong> <a href='../S/2315.html#L1336' title='Defined at 1336 in src/dispextern.h.'>glyph_string</a> *s)
<a id='L8651' name='L8651'></a>  8651 <em class='brace'>{</em>
<a id='L8652' name='L8652'></a>  8652   <strong class='reserved'>struct</strong> <a href='../S/2315.html#L454' title='Defined at 454 in src/dispextern.h.'>glyph</a> *<a href='../S/2315.html#L454' title='Defined at 454 in src/dispextern.h.'>glyph</a> = s-&gt;first_glyph;
<a id='L8653' name='L8653'></a>  8653   <strong class='reserved'>unsigned</strong> char2b[8];
<a id='L8654' name='L8654'></a>  8654   <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, i, j;
<a id='L8655' name='L8655'></a>  8655 
<a id='L8656' name='L8656'></a>  8656   <em class='comment'>/* If first glyph of S has a left box line, start drawing the text</em>
<a id='L8657' name='L8657'></a>  8657 <em class='comment'>     of S to the right of that box line.  */</em>
<a id='L8658' name='L8658'></a>  8658   <strong class='reserved'>if</strong> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a> &amp;&amp; s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;box != <a href='../S/2315.html#L1678' title='Defined at 1678 in src/dispextern.h.'>FACE_NO_BOX</a>
<a id='L8659' name='L8659'></a>  8659       &amp;&amp; s-&gt;first_glyph-&gt;left_box_line_p)
<a id='L8660' name='L8660'></a>  8660     <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = s-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;box_vertical_line_width, 0);
<a id='L8661' name='L8661'></a>  8661   <strong class='reserved'>else</strong>
<a id='L8662' name='L8662'></a>  8662     <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = s-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L8663' name='L8663'></a>  8663 
<a id='L8664' name='L8664'></a>  8664   s-&gt;char2b = char2b;
<a id='L8665' name='L8665'></a>  8665 
<a id='L8666' name='L8666'></a>  8666   <strong class='reserved'>for</strong> (i = 0; i &lt; s-&gt;nchars; i++, <a href='../S/2315.html#L454' title='Defined at 454 in src/dispextern.h.'>glyph</a>++)
<a id='L8667' name='L8667'></a>  8667     <em class='brace'>{</em>
<a id='L8668' name='L8668'></a>  8668 <em class='sharp'>#ifdef</em> <a href='../S/2936.html#L45' title='Defined at 45 in lib/canonicalize-lgpl.c.'>GCC_LINT</a>
<a id='L8669' name='L8669'></a>  8669       <strong class='reserved'>enum</strong> <em class='brace'>{</em> <a href='../R/4250.html' title='Multiple referred from 4 places.'>PACIFY_GCC_BUG_81401</a> = 1 <em class='brace'>}</em>;
<a id='L8670' name='L8670'></a>  8670 <em class='sharp'>#else</em>
<a id='L8671' name='L8671'></a>  8671       <strong class='reserved'>enum</strong> <em class='brace'>{</em> <a href='../R/4250.html' title='Multiple referred from 4 places.'>PACIFY_GCC_BUG_81401</a> = 0 <em class='brace'>}</em>;
<a id='L8672' name='L8672'></a>  8672 <em class='sharp'>#endif</em>
<a id='L8673' name='L8673'></a>  8673       <strong class='reserved'>char</strong> buf[7 + <a href='../D/4718.html' title='Multiple defined in 8 places.'>PACIFY_GCC_BUG_81401</a>];
<a id='L8674' name='L8674'></a>  8674       <strong class='reserved'>char</strong> *str = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L8675' name='L8675'></a>  8675       <strong class='reserved'>int</strong> len = <a href='../S/2315.html#L454' title='Defined at 454 in src/dispextern.h.'>glyph</a>-&gt;u.glyphless.len;
<a id='L8676' name='L8676'></a>  8676 
<a id='L8677' name='L8677'></a>  8677       <strong class='reserved'>if</strong> (<a href='../S/2315.html#L454' title='Defined at 454 in src/dispextern.h.'>glyph</a>-&gt;u.glyphless.method == <a href='../S/2315.html#L2271' title='Defined at 2271 in src/dispextern.h.'>GLYPHLESS_DISPLAY_ACRONYM</a>)
<a id='L8678' name='L8678'></a>  8678         <em class='brace'>{</em>
<a id='L8679' name='L8679'></a>  8679           <strong class='reserved'>if</strong> (len &gt; 0
<a id='L8680' name='L8680'></a>  8680               &amp;&amp; <a href='../D/917.html' title='Multiple defined in 2 places.'>CHAR_TABLE_P</a> (Vglyphless_char_display)
<a id='L8681' name='L8681'></a>  8681               &amp;&amp; (<a href='../D/916.html' title='Multiple defined in 2 places.'>CHAR_TABLE_EXTRA_SLOTS</a> (<a href='../D/7025.html' title='Multiple defined in 2 places.'>XCHAR_TABLE</a> (Vglyphless_char_display))
<a id='L8682' name='L8682'></a>  8682                   &gt;= 1))
<a id='L8683' name='L8683'></a>  8683             <em class='brace'>{</em>
<a id='L8684' name='L8684'></a>  8684               <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> acronym
<a id='L8685' name='L8685'></a>  8685                 = (! <a href='../S/2315.html#L454' title='Defined at 454 in src/dispextern.h.'>glyph</a>-&gt;u.glyphless.for_no_font
<a id='L8686' name='L8686'></a>  8686                    ? <a href='../D/918.html' title='Multiple defined in 2 places.'>CHAR_TABLE_REF</a> (Vglyphless_char_display,
<a id='L8687' name='L8687'></a>  8687                                      <a href='../S/2315.html#L454' title='Defined at 454 in src/dispextern.h.'>glyph</a>-&gt;u.glyphless.ch)
<a id='L8688' name='L8688'></a>  8688                    : <a href='../D/7025.html' title='Multiple defined in 2 places.'>XCHAR_TABLE</a> (Vglyphless_char_display)-&gt;extras[0]);
<a id='L8689' name='L8689'></a>  8689               <strong class='reserved'>if</strong> (<a href='../D/1228.html' title='Multiple defined in 2 places.'>CONSP</a> (acronym))
<a id='L8690' name='L8690'></a>  8690                 acronym = <a href='../D/7021.html' title='Multiple defined in 2 places.'>XCAR</a> (acronym);
<a id='L8691' name='L8691'></a>  8691               <strong class='reserved'>if</strong> (<a href='../S/2267.html#L1597' title='Defined at 1597 in src/lisp.h.'>STRINGP</a> (acronym))
<a id='L8692' name='L8692'></a>  8692                 str = <a href='../D/5917.html' title='Multiple defined in 2 places.'>SSDATA</a> (acronym);
<a id='L8693' name='L8693'></a>  8693             <em class='brace'>}</em>
<a id='L8694' name='L8694'></a>  8694         <em class='brace'>}</em>
<a id='L8695' name='L8695'></a>  8695       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (<a href='../S/2315.html#L454' title='Defined at 454 in src/dispextern.h.'>glyph</a>-&gt;u.glyphless.method == <a href='../S/2315.html#L2273' title='Defined at 2273 in src/dispextern.h.'>GLYPHLESS_DISPLAY_HEX_CODE</a>)
<a id='L8696' name='L8696'></a>  8696         <em class='brace'>{</em>
<a id='L8697' name='L8697'></a>  8697           <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> ch = <a href='../S/2315.html#L454' title='Defined at 454 in src/dispextern.h.'>glyph</a>-&gt;u.glyphless.ch;
<a id='L8698' name='L8698'></a>  8698           <a href='../D/10872.html' title='Multiple defined in 5 places.'>eassume</a> (ch &lt;= <a href='../S/2218.html#L50' title='Defined at 50 in src/character.h.'>MAX_CHAR</a>);
<a id='L8699' name='L8699'></a>  8699           <a href='../D/17583.html' title='Multiple defined in 3 places.'>sprintf</a> (buf, "%0*X", ch &lt; 0x10000 ? 4 : 6, ch);
<a id='L8700' name='L8700'></a>  8700           str = buf;
<a id='L8701' name='L8701'></a>  8701         <em class='brace'>}</em>
<a id='L8702' name='L8702'></a>  8702 
<a id='L8703' name='L8703'></a>  8703       <strong class='reserved'>if</strong> (str)
<a id='L8704' name='L8704'></a>  8704         <em class='brace'>{</em>
<a id='L8705' name='L8705'></a>  8705           <strong class='reserved'>int</strong> upper_len = (len + 1) / 2;
<a id='L8706' name='L8706'></a>  8706 
<a id='L8707' name='L8707'></a>  8707           <em class='comment'>/* It is assured that all LEN characters in STR is ASCII.  */</em>
<a id='L8708' name='L8708'></a>  8708           <strong class='reserved'>for</strong> (j = 0; j &lt; len; j++)
<a id='L8709' name='L8709'></a>  8709             char2b[j] = s-&gt;<a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>-&gt;driver-&gt;<a href='../S/2250.html#L1728' title='Defined at 1728 in src/charset.c.'>encode_char</a> (s-&gt;<a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>, str[j]) &amp; 0xFFFF;
<a id='L8710' name='L8710'></a>  8710           s-&gt;<a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>-&gt;driver-&gt;<a href='../D/10617.html' title='Multiple defined in 2 places.'>draw</a> (s, 0, upper_len,
<a id='L8711' name='L8711'></a>  8711                                  <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + <a href='../S/2315.html#L454' title='Defined at 454 in src/dispextern.h.'>glyph</a>-&gt;slice.glyphless.upper_xoff,
<a id='L8712' name='L8712'></a>  8712                                  s-&gt;ybase + <a href='../S/2315.html#L454' title='Defined at 454 in src/dispextern.h.'>glyph</a>-&gt;slice.glyphless.upper_yoff,
<a id='L8713' name='L8713'></a>  8713                                  <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L8714' name='L8714'></a>  8714           s-&gt;<a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>-&gt;driver-&gt;<a href='../D/10617.html' title='Multiple defined in 2 places.'>draw</a> (s, upper_len, len,
<a id='L8715' name='L8715'></a>  8715                                  <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + <a href='../S/2315.html#L454' title='Defined at 454 in src/dispextern.h.'>glyph</a>-&gt;slice.glyphless.lower_xoff,
<a id='L8716' name='L8716'></a>  8716                                  s-&gt;ybase + <a href='../S/2315.html#L454' title='Defined at 454 in src/dispextern.h.'>glyph</a>-&gt;slice.glyphless.lower_yoff,
<a id='L8717' name='L8717'></a>  8717                                  <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L8718' name='L8718'></a>  8718         <em class='brace'>}</em>
<a id='L8719' name='L8719'></a>  8719       <strong class='reserved'>if</strong> (<a href='../S/2315.html#L454' title='Defined at 454 in src/dispextern.h.'>glyph</a>-&gt;u.glyphless.method != <a href='../S/2315.html#L2267' title='Defined at 2267 in src/dispextern.h.'>GLYPHLESS_DISPLAY_THIN_SPACE</a>)
<a id='L8720' name='L8720'></a>  8720         <a href='../S/2289.html#L6625' title='Defined at 6625 in src/xterm.c.'>x_draw_rectangle</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, s-&gt;gc,
<a id='L8721' name='L8721'></a>  8721                         <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, s-&gt;ybase - <a href='../S/2315.html#L454' title='Defined at 454 in src/dispextern.h.'>glyph</a>-&gt;ascent,
<a id='L8722' name='L8722'></a>  8722                         <a href='../S/2315.html#L454' title='Defined at 454 in src/dispextern.h.'>glyph</a>-&gt;pixel_width - 1,
<a id='L8723' name='L8723'></a>  8723                         <a href='../S/2315.html#L454' title='Defined at 454 in src/dispextern.h.'>glyph</a>-&gt;ascent + <a href='../S/2315.html#L454' title='Defined at 454 in src/dispextern.h.'>glyph</a>-&gt;descent - 1);
<a id='L8724' name='L8724'></a>  8724       <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> += <a href='../S/2315.html#L454' title='Defined at 454 in src/dispextern.h.'>glyph</a>-&gt;pixel_width;
<a id='L8725' name='L8725'></a>  8725    <em class='brace'>}</em>
<a id='L8726' name='L8726'></a>  8726 
<a id='L8727' name='L8727'></a>  8727   <em class='comment'>/* Defend against hypothetical bad code elsewhere that uses</em>
<a id='L8728' name='L8728'></a>  8728 <em class='comment'>     s-&gt;char2b after this function returns.  */</em>
<a id='L8729' name='L8729'></a>  8729   s-&gt;char2b = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L8730' name='L8730'></a>  8730 <em class='brace'>}</em>
<a id='L8731' name='L8731'></a>  8731 
<a id='L8732' name='L8732'></a>  8732 <em class='sharp'>#ifdef</em> USE_X_TOOLKIT
<a id='L8733' name='L8733'></a>  8733 
<a id='L8734' name='L8734'></a>  8734 <em class='sharp'>#ifdef</em> USE_LUCID
<a id='L8735' name='L8735'></a>  8735 
<a id='L8736' name='L8736'></a>  8736 <em class='comment'>/* Return the frame on which widget WIDGET is used.. Abort if frame</em>
<a id='L8737' name='L8737'></a>  8737 <em class='comment'>   cannot be determined.  */</em>
<a id='L8738' name='L8738'></a>  8738 
<a id='L8739' name='L8739'></a>  8739 <strong class='reserved'>static</strong> <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *
<a id='L8740' name='L8740'></a>  8740 <a href='../S/2289.html#L8779' title='Referred from 8779 in src/xterm.c.'>x_frame_of_widget</a> (Widget widget)
<a id='L8741' name='L8741'></a>  8741 <em class='brace'>{</em>
<a id='L8742' name='L8742'></a>  8742   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L8743' name='L8743'></a>  8743   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>;
<a id='L8744' name='L8744'></a>  8744   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L8745' name='L8745'></a>  8745 
<a id='L8746' name='L8746'></a>  8746   dpyinfo = <a href='../S/2289.html#L6774' title='Defined at 6774 in src/xterm.c.'>x_display_info_for_display</a> (XtDisplay (widget));
<a id='L8747' name='L8747'></a>  8747 
<a id='L8748' name='L8748'></a>  8748   <em class='comment'>/* Find the top-level shell of the widget.  Note that this function</em>
<a id='L8749' name='L8749'></a>  8749 <em class='comment'>     can be called when the widget is not yet realized, so XtWindow</em>
<a id='L8750' name='L8750'></a>  8750 <em class='comment'>     (widget) == 0.  That's the reason we can't simply use</em>
<a id='L8751' name='L8751'></a>  8751 <em class='comment'>     x_any_window_to_frame.  */</em>
<a id='L8752' name='L8752'></a>  8752   <strong class='reserved'>while</strong> (!XtIsTopLevelShell (widget))
<a id='L8753' name='L8753'></a>  8753     widget = XtParent (widget);
<a id='L8754' name='L8754'></a>  8754 
<a id='L8755' name='L8755'></a>  8755   <em class='comment'>/* Look for a frame with that top-level widget.  Allocate the color</em>
<a id='L8756' name='L8756'></a>  8756 <em class='comment'>     on that frame to get the right gamma correction value.  */</em>
<a id='L8757' name='L8757'></a>  8757   <a href='../S/2183.html#L1405' title='Defined at 1405 in src/frame.h.'>FOR_EACH_FRAME</a> (<a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)
<a id='L8758' name='L8758'></a>  8758     <em class='brace'>{</em>
<a id='L8759' name='L8759'></a>  8759       <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>);
<a id='L8760' name='L8760'></a>  8760       <strong class='reserved'>if</strong> (<a href='../S/2183.html#L919' title='Defined at 919 in src/frame.h.'>FRAME_X_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L8761' name='L8761'></a>  8761           &amp;&amp; <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) == dpyinfo
<a id='L8762' name='L8762'></a>  8762           &amp;&amp; <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;widget == widget)
<a id='L8763' name='L8763'></a>  8763         <strong class='reserved'>return</strong> <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L8764' name='L8764'></a>  8764     <em class='brace'>}</em>
<a id='L8765' name='L8765'></a>  8765   <a href='../D/10893.html' title='Multiple defined in 6 places.'>emacs_abort</a> ();
<a id='L8766' name='L8766'></a>  8766 <em class='brace'>}</em>
<a id='L8767' name='L8767'></a>  8767 
<a id='L8768' name='L8768'></a>  8768 <em class='comment'>/* Allocate a color which is lighter or darker than *PIXEL by FACTOR</em>
<a id='L8769' name='L8769'></a>  8769 <em class='comment'>   or DELTA.  Try a color with RGB values multiplied by FACTOR first.</em>
<a id='L8770' name='L8770'></a>  8770 <em class='comment'>   If this produces the same color as PIXEL, try a color where all RGB</em>
<a id='L8771' name='L8771'></a>  8771 <em class='comment'>   values have DELTA added.  Return the allocated color in *PIXEL.</em>
<a id='L8772' name='L8772'></a>  8772 <em class='comment'>   DISPLAY is the X display, CMAP is the colormap to operate on.</em>
<a id='L8773' name='L8773'></a>  8773 <em class='comment'>   Value is true if successful.  */</em>
<a id='L8774' name='L8774'></a>  8774 
<a id='L8775' name='L8775'></a>  8775 <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L8776' name='L8776'></a>  8776 <a href='../R/18046.html' title='Multiple referred from 4 places.'>x_alloc_lighter_color_for_widget</a> (Widget widget, <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, Colormap cmap,
<a id='L8777' name='L8777'></a>  8777                                   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> *pixel, <strong class='reserved'>double</strong> factor, <strong class='reserved'>int</strong> delta)
<a id='L8778' name='L8778'></a>  8778 <em class='brace'>{</em>
<a id='L8779' name='L8779'></a>  8779   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2289.html#L8740' title='Defined at 8740 in src/xterm.c.'>x_frame_of_widget</a> (widget);
<a id='L8780' name='L8780'></a>  8780   <strong class='reserved'>return</strong> <a href='../S/2289.html#L9430' title='Defined at 9430 in src/xterm.c.'>x_alloc_lighter_color</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, cmap, pixel, factor, delta);
<a id='L8781' name='L8781'></a>  8781 <em class='brace'>}</em>
<a id='L8782' name='L8782'></a>  8782 
<a id='L8783' name='L8783'></a>  8783 <em class='sharp'>#endif</em> <em class='comment'>/* USE_LUCID */</em>
<a id='L8784' name='L8784'></a>  8784 
<a id='L8785' name='L8785'></a>  8785 
<a id='L8786' name='L8786'></a>  8786 <em class='comment'>/* Structure specifying which arguments should be passed by Xt to</em>
<a id='L8787' name='L8787'></a>  8787 <em class='comment'>   cvt_string_to_pixel.  We want the widget's screen and colormap.  */</em>
<a id='L8788' name='L8788'></a>  8788 
<a id='L8789' name='L8789'></a>  8789 <strong class='reserved'>static</strong> XtConvertArgRec cvt_string_to_pixel_args[] =
<a id='L8790' name='L8790'></a>  8790   <em class='brace'>{</em>
<a id='L8791' name='L8791'></a>  8791     <em class='brace'>{</em>XtWidgetBaseOffset, (XtPointer) offsetof (WidgetRec, core.screen),
<a id='L8792' name='L8792'></a>  8792      <strong class='reserved'>sizeof</strong> (Screen *)<em class='brace'>}</em>,
<a id='L8793' name='L8793'></a>  8793     <em class='brace'>{</em>XtWidgetBaseOffset, (XtPointer) offsetof (WidgetRec, core.colormap),
<a id='L8794' name='L8794'></a>  8794      <strong class='reserved'>sizeof</strong> (Colormap)<em class='brace'>}</em>
<a id='L8795' name='L8795'></a>  8795   <em class='brace'>}</em>;
<a id='L8796' name='L8796'></a>  8796 
<a id='L8797' name='L8797'></a>  8797 
<a id='L8798' name='L8798'></a>  8798 <em class='comment'>/* The address of this variable is returned by</em>
<a id='L8799' name='L8799'></a>  8799 <em class='comment'>   cvt_string_to_pixel.  */</em>
<a id='L8800' name='L8800'></a>  8800 
<a id='L8801' name='L8801'></a>  8801 <strong class='reserved'>static</strong> <a href='../S/193.html#L65' title='Defined at 65 in oldXMenu/XMenuInt.h.'>Pixel</a> cvt_string_to_pixel_value;
<a id='L8802' name='L8802'></a>  8802 
<a id='L8803' name='L8803'></a>  8803 
<a id='L8804' name='L8804'></a>  8804 <em class='comment'>/* Convert a color name to a pixel color.</em>
<a id='L8805' name='L8805'></a>  8805 <em class='comment'></em>
<a id='L8806' name='L8806'></a>  8806 <em class='comment'>   DPY is the display we are working on.</em>
<a id='L8807' name='L8807'></a>  8807 <em class='comment'></em>
<a id='L8808' name='L8808'></a>  8808 <em class='comment'>   ARGS is an array of *NARGS XrmValue structures holding additional</em>
<a id='L8809' name='L8809'></a>  8809 <em class='comment'>   information about the widget for which the conversion takes place.</em>
<a id='L8810' name='L8810'></a>  8810 <em class='comment'>   The contents of this array are determined by the specification</em>
<a id='L8811' name='L8811'></a>  8811 <em class='comment'>   in cvt_string_to_pixel_args.</em>
<a id='L8812' name='L8812'></a>  8812 <em class='comment'></em>
<a id='L8813' name='L8813'></a>  8813 <em class='comment'>   FROM is a pointer to an XrmValue which points to the color name to</em>
<a id='L8814' name='L8814'></a>  8814 <em class='comment'>   convert.  TO is an XrmValue in which to return the pixel color.</em>
<a id='L8815' name='L8815'></a>  8815 <em class='comment'></em>
<a id='L8816' name='L8816'></a>  8816 <em class='comment'>   CLOSURE_RET is a pointer to user-data, in which we record if</em>
<a id='L8817' name='L8817'></a>  8817 <em class='comment'>   we allocated the color or not.</em>
<a id='L8818' name='L8818'></a>  8818 <em class='comment'></em>
<a id='L8819' name='L8819'></a>  8819 <em class='comment'>   Value is True if successful, False otherwise.  */</em>
<a id='L8820' name='L8820'></a>  8820 
<a id='L8821' name='L8821'></a>  8821 <strong class='reserved'>static</strong> Boolean
<a id='L8822' name='L8822'></a>  8822 <a href='../S/2289.html#L31618' title='Referred from 31618 in src/xterm.c.'>cvt_string_to_pixel</a> (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy, XrmValue *<a href='../S/4038.html#L30' title='Defined at 30 in test/manual/etags/c-src/h.h.'>args</a>, Cardinal *nargs,
<a id='L8823' name='L8823'></a>  8823                      XrmValue *from, XrmValue *to,
<a id='L8824' name='L8824'></a>  8824                      XtPointer *closure_ret)
<a id='L8825' name='L8825'></a>  8825 <em class='brace'>{</em>
<a id='L8826' name='L8826'></a>  8826   Screen *screen;
<a id='L8827' name='L8827'></a>  8827   Colormap cmap;
<a id='L8828' name='L8828'></a>  8828   <a href='../S/193.html#L65' title='Defined at 65 in oldXMenu/XMenuInt.h.'>Pixel</a> pixel;
<a id='L8829' name='L8829'></a>  8829   String color_name;
<a id='L8830' name='L8830'></a>  8830   <a href='../D/7038.html' title='Multiple defined in 2 places.'>XColor</a> color;
<a id='L8831' name='L8831'></a>  8831 
<a id='L8832' name='L8832'></a>  8832   <strong class='reserved'>if</strong> (*nargs != 2)
<a id='L8833' name='L8833'></a>  8833     <em class='brace'>{</em>
<a id='L8834' name='L8834'></a>  8834       XtAppWarningMsg (XtDisplayToApplicationContext (dpy),
<a id='L8835' name='L8835'></a>  8835                        "wrongParameters", "cvt_string_to_pixel",
<a id='L8836' name='L8836'></a>  8836                        "XtToolkitError",
<a id='L8837' name='L8837'></a>  8837                        "Screen and colormap args required", <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L8838' name='L8838'></a>  8838       <strong class='reserved'>return</strong> False;
<a id='L8839' name='L8839'></a>  8839     <em class='brace'>}</em>
<a id='L8840' name='L8840'></a>  8840 
<a id='L8841' name='L8841'></a>  8841   screen = *(Screen **) <a href='../S/4038.html#L30' title='Defined at 30 in test/manual/etags/c-src/h.h.'>args</a>[0].addr;
<a id='L8842' name='L8842'></a>  8842   cmap = *(Colormap *) <a href='../S/4038.html#L30' title='Defined at 30 in test/manual/etags/c-src/h.h.'>args</a>[1].addr;
<a id='L8843' name='L8843'></a>  8843   color_name = (String) from-&gt;addr;
<a id='L8844' name='L8844'></a>  8844 
<a id='L8845' name='L8845'></a>  8845   <strong class='reserved'>if</strong> (strcmp (color_name, XtDefaultBackground) == 0)
<a id='L8846' name='L8846'></a>  8846     <em class='brace'>{</em>
<a id='L8847' name='L8847'></a>  8847       *closure_ret = (XtPointer) False;
<a id='L8848' name='L8848'></a>  8848       pixel = WhitePixelOfScreen (screen);
<a id='L8849' name='L8849'></a>  8849     <em class='brace'>}</em>
<a id='L8850' name='L8850'></a>  8850   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (strcmp (color_name, XtDefaultForeground) == 0)
<a id='L8851' name='L8851'></a>  8851     <em class='brace'>{</em>
<a id='L8852' name='L8852'></a>  8852       *closure_ret = (XtPointer) False;
<a id='L8853' name='L8853'></a>  8853       pixel = BlackPixelOfScreen (screen);
<a id='L8854' name='L8854'></a>  8854     <em class='brace'>}</em>
<a id='L8855' name='L8855'></a>  8855   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (XParseColor (dpy, cmap, color_name, &amp;color)
<a id='L8856' name='L8856'></a>  8856            &amp;&amp; <a href='../S/2289.html#L9214' title='Defined at 9214 in src/xterm.c.'>x_alloc_nearest_color_1</a> (dpy, cmap, &amp;color))
<a id='L8857' name='L8857'></a>  8857     <em class='brace'>{</em>
<a id='L8858' name='L8858'></a>  8858       pixel = color.pixel;
<a id='L8859' name='L8859'></a>  8859       *closure_ret = (XtPointer) True;
<a id='L8860' name='L8860'></a>  8860     <em class='brace'>}</em>
<a id='L8861' name='L8861'></a>  8861   <strong class='reserved'>else</strong>
<a id='L8862' name='L8862'></a>  8862     <em class='brace'>{</em>
<a id='L8863' name='L8863'></a>  8863       String params[1];
<a id='L8864' name='L8864'></a>  8864       Cardinal nparams = 1;
<a id='L8865' name='L8865'></a>  8865 
<a id='L8866' name='L8866'></a>  8866       params[0] = color_name;
<a id='L8867' name='L8867'></a>  8867       XtAppWarningMsg (XtDisplayToApplicationContext (dpy),
<a id='L8868' name='L8868'></a>  8868                        "badValue", "cvt_string_to_pixel",
<a id='L8869' name='L8869'></a>  8869                        "XtToolkitError", "Invalid color '%s'",
<a id='L8870' name='L8870'></a>  8870                        params, &amp;nparams);
<a id='L8871' name='L8871'></a>  8871       <strong class='reserved'>return</strong> False;
<a id='L8872' name='L8872'></a>  8872     <em class='brace'>}</em>
<a id='L8873' name='L8873'></a>  8873 
<a id='L8874' name='L8874'></a>  8874   <strong class='reserved'>if</strong> (to-&gt;addr != <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>)
<a id='L8875' name='L8875'></a>  8875     <em class='brace'>{</em>
<a id='L8876' name='L8876'></a>  8876       <strong class='reserved'>if</strong> (to-&gt;<a href='../D/17482.html' title='Multiple defined in 5 places.'>size</a> &lt; <strong class='reserved'>sizeof</strong> (<a href='../S/193.html#L65' title='Defined at 65 in oldXMenu/XMenuInt.h.'>Pixel</a>))
<a id='L8877' name='L8877'></a>  8877         <em class='brace'>{</em>
<a id='L8878' name='L8878'></a>  8878           to-&gt;<a href='../D/17482.html' title='Multiple defined in 5 places.'>size</a> = <strong class='reserved'>sizeof</strong> (<a href='../S/193.html#L65' title='Defined at 65 in oldXMenu/XMenuInt.h.'>Pixel</a>);
<a id='L8879' name='L8879'></a>  8879           <strong class='reserved'>return</strong> False;
<a id='L8880' name='L8880'></a>  8880         <em class='brace'>}</em>
<a id='L8881' name='L8881'></a>  8881 
<a id='L8882' name='L8882'></a>  8882       *(<a href='../S/193.html#L65' title='Defined at 65 in oldXMenu/XMenuInt.h.'>Pixel</a> *) to-&gt;addr = pixel;
<a id='L8883' name='L8883'></a>  8883     <em class='brace'>}</em>
<a id='L8884' name='L8884'></a>  8884   <strong class='reserved'>else</strong>
<a id='L8885' name='L8885'></a>  8885     <em class='brace'>{</em>
<a id='L8886' name='L8886'></a>  8886       cvt_string_to_pixel_value = pixel;
<a id='L8887' name='L8887'></a>  8887       to-&gt;addr = (XtPointer) &amp;cvt_string_to_pixel_value;
<a id='L8888' name='L8888'></a>  8888     <em class='brace'>}</em>
<a id='L8889' name='L8889'></a>  8889 
<a id='L8890' name='L8890'></a>  8890   to-&gt;<a href='../D/17482.html' title='Multiple defined in 5 places.'>size</a> = <strong class='reserved'>sizeof</strong> (<a href='../S/193.html#L65' title='Defined at 65 in oldXMenu/XMenuInt.h.'>Pixel</a>);
<a id='L8891' name='L8891'></a>  8891   <strong class='reserved'>return</strong> True;
<a id='L8892' name='L8892'></a>  8892 <em class='brace'>}</em>
<a id='L8893' name='L8893'></a>  8893 
<a id='L8894' name='L8894'></a>  8894 
<a id='L8895' name='L8895'></a>  8895 <em class='comment'>/* Free a pixel color which was previously allocated via</em>
<a id='L8896' name='L8896'></a>  8896 <em class='comment'>   cvt_string_to_pixel.  This is registered as the destructor</em>
<a id='L8897' name='L8897'></a>  8897 <em class='comment'>   for this type of resource via XtSetTypeConverter.</em>
<a id='L8898' name='L8898'></a>  8898 <em class='comment'></em>
<a id='L8899' name='L8899'></a>  8899 <em class='comment'>   APP is the application context in which we work.</em>
<a id='L8900' name='L8900'></a>  8900 <em class='comment'></em>
<a id='L8901' name='L8901'></a>  8901 <em class='comment'>   TO is a pointer to an XrmValue holding the color to free.</em>
<a id='L8902' name='L8902'></a>  8902 <em class='comment'>   CLOSURE is the value we stored in CLOSURE_RET for this color</em>
<a id='L8903' name='L8903'></a>  8903 <em class='comment'>   in cvt_string_to_pixel.</em>
<a id='L8904' name='L8904'></a>  8904 <em class='comment'></em>
<a id='L8905' name='L8905'></a>  8905 <em class='comment'>   ARGS and NARGS are like for cvt_string_to_pixel.  */</em>
<a id='L8906' name='L8906'></a>  8906 
<a id='L8907' name='L8907'></a>  8907 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L8908' name='L8908'></a>  8908 <a href='../S/2289.html#L31621' title='Referred from 31621 in src/xterm.c.'>cvt_pixel_dtor</a> (XtAppContext app, XrmValuePtr to, XtPointer closure, XrmValuePtr <a href='../S/4038.html#L30' title='Defined at 30 in test/manual/etags/c-src/h.h.'>args</a>,
<a id='L8909' name='L8909'></a>  8909                 Cardinal *nargs)
<a id='L8910' name='L8910'></a>  8910 <em class='brace'>{</em>
<a id='L8911' name='L8911'></a>  8911   <strong class='reserved'>if</strong> (*nargs != 2)
<a id='L8912' name='L8912'></a>  8912     <em class='brace'>{</em>
<a id='L8913' name='L8913'></a>  8913       XtAppWarningMsg (app, "wrongParameters", "cvt_pixel_dtor",
<a id='L8914' name='L8914'></a>  8914                        "XtToolkitError",
<a id='L8915' name='L8915'></a>  8915                        "Screen and colormap arguments required",
<a id='L8916' name='L8916'></a>  8916                        <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L8917' name='L8917'></a>  8917     <em class='brace'>}</em>
<a id='L8918' name='L8918'></a>  8918   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (closure != <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>)
<a id='L8919' name='L8919'></a>  8919     <em class='brace'>{</em>
<a id='L8920' name='L8920'></a>  8920       <em class='comment'>/* We did allocate the pixel, so free it.  */</em>
<a id='L8921' name='L8921'></a>  8921       Screen *screen = *(Screen **) <a href='../S/4038.html#L30' title='Defined at 30 in test/manual/etags/c-src/h.h.'>args</a>[0].addr;
<a id='L8922' name='L8922'></a>  8922       Colormap cmap = *(Colormap *) <a href='../S/4038.html#L30' title='Defined at 30 in test/manual/etags/c-src/h.h.'>args</a>[1].addr;
<a id='L8923' name='L8923'></a>  8923       <a href='../S/2239.html#L504' title='Defined at 504 in src/xfaces.c.'>x_free_dpy_colors</a> (DisplayOfScreen (screen), screen, cmap,
<a id='L8924' name='L8924'></a>  8924                          (<a href='../S/193.html#L65' title='Defined at 65 in oldXMenu/XMenuInt.h.'>Pixel</a> *) to-&gt;addr, 1);
<a id='L8925' name='L8925'></a>  8925     <em class='brace'>}</em>
<a id='L8926' name='L8926'></a>  8926 <em class='brace'>}</em>
<a id='L8927' name='L8927'></a>  8927 
<a id='L8928' name='L8928'></a>  8928 
<a id='L8929' name='L8929'></a>  8929 <em class='sharp'>#endif</em> <em class='comment'>/* USE_X_TOOLKIT */</em>
<a id='L8930' name='L8930'></a>  8930 
<a id='L8931' name='L8931'></a>  8931 
<a id='L8932' name='L8932'></a>  8932 <em class='comment'>/* Value is an array of XColor structures for the contents of the</em>
<a id='L8933' name='L8933'></a>  8933 <em class='comment'>   color map of display DPY.  Set *NCELLS to the size of the array.</em>
<a id='L8934' name='L8934'></a>  8934 <em class='comment'>   Note that this probably shouldn't be called for large color maps,</em>
<a id='L8935' name='L8935'></a>  8935 <em class='comment'>   say a 24-bit TrueColor map.  */</em>
<a id='L8936' name='L8936'></a>  8936 
<a id='L8937' name='L8937'></a>  8937 <strong class='reserved'>static</strong> <strong class='reserved'>const</strong> <a href='../D/7038.html' title='Multiple defined in 2 places.'>XColor</a> *
<a id='L8938' name='L8938'></a>  8938 <a href='../S/2289.html#L9244' title='Referred from 9244 in src/xterm.c.'>x_color_cells</a> (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy, <strong class='reserved'>int</strong> *ncells)
<a id='L8939' name='L8939'></a>  8939 <em class='brace'>{</em>
<a id='L8940' name='L8940'></a>  8940   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo = <a href='../S/2289.html#L6774' title='Defined at 6774 in src/xterm.c.'>x_display_info_for_display</a> (dpy);
<a id='L8941' name='L8941'></a>  8941   <a href='../D/10872.html' title='Multiple defined in 5 places.'>eassume</a> (dpyinfo);
<a id='L8942' name='L8942'></a>  8942 
<a id='L8943' name='L8943'></a>  8943   <strong class='reserved'>if</strong> (dpyinfo-&gt;color_cells == <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>)
<a id='L8944' name='L8944'></a>  8944     <em class='brace'>{</em>
<a id='L8945' name='L8945'></a>  8945       <strong class='reserved'>int</strong> ncolor_cells = dpyinfo-&gt;visual_info.colormap_size;
<a id='L8946' name='L8946'></a>  8946       <strong class='reserved'>int</strong> i;
<a id='L8947' name='L8947'></a>  8947 
<a id='L8948' name='L8948'></a>  8948       dpyinfo-&gt;color_cells = <a href='../D/20078.html' title='Multiple defined in 2 places.'>xnmalloc</a> (ncolor_cells,
<a id='L8949' name='L8949'></a>  8949                                        <strong class='reserved'>sizeof</strong> *dpyinfo-&gt;color_cells);
<a id='L8950' name='L8950'></a>  8950       dpyinfo-&gt;ncolor_cells = ncolor_cells;
<a id='L8951' name='L8951'></a>  8951 
<a id='L8952' name='L8952'></a>  8952       <strong class='reserved'>for</strong> (i = 0; i &lt; ncolor_cells; ++i)
<a id='L8953' name='L8953'></a>  8953         dpyinfo-&gt;color_cells[i].pixel = i;
<a id='L8954' name='L8954'></a>  8954 
<a id='L8955' name='L8955'></a>  8955       XQueryColors (dpy, dpyinfo-&gt;cmap,
<a id='L8956' name='L8956'></a>  8956                     dpyinfo-&gt;color_cells, ncolor_cells);
<a id='L8957' name='L8957'></a>  8957     <em class='brace'>}</em>
<a id='L8958' name='L8958'></a>  8958 
<a id='L8959' name='L8959'></a>  8959   *ncells = dpyinfo-&gt;ncolor_cells;
<a id='L8960' name='L8960'></a>  8960   <strong class='reserved'>return</strong> dpyinfo-&gt;color_cells;
<a id='L8961' name='L8961'></a>  8961 <em class='brace'>}</em>
<a id='L8962' name='L8962'></a>  8962 
<a id='L8963' name='L8963'></a>  8963 
<a id='L8964' name='L8964'></a>  8964 <em class='comment'>/* On frame F, translate pixel colors to RGB values for the NCOLORS</em>
<a id='L8965' name='L8965'></a>  8965 <em class='comment'>   colors in COLORS.  Use cached information, if available.</em>
<a id='L8966' name='L8966'></a>  8966 <em class='comment'></em>
<a id='L8967' name='L8967'></a>  8967 <em class='comment'>   Pixel values are in unsigned normalized format, meaning that</em>
<a id='L8968' name='L8968'></a>  8968 <em class='comment'>   extending missing bits is done straightforwardly without any</em>
<a id='L8969' name='L8969'></a>  8969 <em class='comment'>   complex colorspace conversions.  */</em>
<a id='L8970' name='L8970'></a>  8970 
<a id='L8971' name='L8971'></a>  8971 <strong class='reserved'>void</strong>
<a id='L8972' name='L8972'></a>  8972 <a href='../R/18268.html' title='Multiple referred from 14 places.'>x_query_colors</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/7038.html' title='Multiple defined in 2 places.'>XColor</a> *colors, <strong class='reserved'>int</strong> ncolors)
<a id='L8973' name='L8973'></a>  8973 <em class='brace'>{</em>
<a id='L8974' name='L8974'></a>  8974   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L8975' name='L8975'></a>  8975   <strong class='reserved'>int</strong> i;
<a id='L8976' name='L8976'></a>  8976 
<a id='L8977' name='L8977'></a>  8977   <strong class='reserved'>if</strong> (dpyinfo-&gt;red_bits &gt; 0)
<a id='L8978' name='L8978'></a>  8978     <em class='brace'>{</em>
<a id='L8979' name='L8979'></a>  8979       <em class='comment'>/* For TrueColor displays, we can decompose the RGB value</em>
<a id='L8980' name='L8980'></a>  8980 <em class='comment'>         directly.  */</em>
<a id='L8981' name='L8981'></a>  8981       <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> rmult, gmult, bmult;
<a id='L8982' name='L8982'></a>  8982       <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> rmask, gmask, bmask;
<a id='L8983' name='L8983'></a>  8983 
<a id='L8984' name='L8984'></a>  8984       rmask = (1 &lt;&lt; dpyinfo-&gt;red_bits) - 1;
<a id='L8985' name='L8985'></a>  8985       gmask = (1 &lt;&lt; dpyinfo-&gt;green_bits) - 1;
<a id='L8986' name='L8986'></a>  8986       bmask = (1 &lt;&lt; dpyinfo-&gt;blue_bits) - 1;
<a id='L8987' name='L8987'></a>  8987       <em class='comment'>/* If we're widening, for example, 8 bits in the pixel value to</em>
<a id='L8988' name='L8988'></a>  8988 <em class='comment'>         16 bits for the separate-color representation, we want to</em>
<a id='L8989' name='L8989'></a>  8989 <em class='comment'>         extrapolate the lower bits based on those bits available --</em>
<a id='L8990' name='L8990'></a>  8990 <em class='comment'>         in other words, we'd like 0xff to become 0xffff instead of</em>
<a id='L8991' name='L8991'></a>  8991 <em class='comment'>         the 0xff00 we'd get by just zero-filling the lower bits.</em>
<a id='L8992' name='L8992'></a>  8992 <em class='comment'></em>
<a id='L8993' name='L8993'></a>  8993 <em class='comment'>         We generate a 32-bit scaled-up value and shift it, in case</em>
<a id='L8994' name='L8994'></a>  8994 <em class='comment'>         the bit count doesn't divide 16 evenly (e.g., when dealing</em>
<a id='L8995' name='L8995'></a>  8995 <em class='comment'>         with a 3-3-2 bit RGB display), to get more of the lower bits</em>
<a id='L8996' name='L8996'></a>  8996 <em class='comment'>         correct.</em>
<a id='L8997' name='L8997'></a>  8997 <em class='comment'></em>
<a id='L8998' name='L8998'></a>  8998 <em class='comment'>         Should we cache the multipliers in dpyinfo?  Maybe</em>
<a id='L8999' name='L8999'></a>  8999 <em class='comment'>         special-case the 8-8-8 common case?  */</em>
<a id='L9000' name='L9000'></a>  9000       rmult = 0xffffffff / rmask;
<a id='L9001' name='L9001'></a>  9001       gmult = 0xffffffff / gmask;
<a id='L9002' name='L9002'></a>  9002       bmult = 0xffffffff / bmask;
<a id='L9003' name='L9003'></a>  9003 
<a id='L9004' name='L9004'></a>  9004       <strong class='reserved'>for</strong> (i = 0; i &lt; ncolors; ++i)
<a id='L9005' name='L9005'></a>  9005         <em class='brace'>{</em>
<a id='L9006' name='L9006'></a>  9006           <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> r, <a href='../S/4101.html#L90' title='Defined at 90 in test/manual/etags/cp-src/c.C.'>g</a>, <a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>;
<a id='L9007' name='L9007'></a>  9007           <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> pixel = colors[i].pixel;
<a id='L9008' name='L9008'></a>  9008 
<a id='L9009' name='L9009'></a>  9009           r = (pixel &gt;&gt; dpyinfo-&gt;red_offset) &amp; rmask;
<a id='L9010' name='L9010'></a>  9010           <a href='../S/4101.html#L90' title='Defined at 90 in test/manual/etags/cp-src/c.C.'>g</a> = (pixel &gt;&gt; dpyinfo-&gt;green_offset) &amp; gmask;
<a id='L9011' name='L9011'></a>  9011           <a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a> = (pixel &gt;&gt; dpyinfo-&gt;blue_offset) &amp; bmask;
<a id='L9012' name='L9012'></a>  9012 
<a id='L9013' name='L9013'></a>  9013           colors[i].red = (r * rmult) &gt;&gt; 16;
<a id='L9014' name='L9014'></a>  9014           colors[i].green = (<a href='../S/4101.html#L90' title='Defined at 90 in test/manual/etags/cp-src/c.C.'>g</a> * gmult) &gt;&gt; 16;
<a id='L9015' name='L9015'></a>  9015           colors[i].blue = (<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a> * bmult) &gt;&gt; 16;
<a id='L9016' name='L9016'></a>  9016         <em class='brace'>}</em>
<a id='L9017' name='L9017'></a>  9017 
<a id='L9018' name='L9018'></a>  9018       <strong class='reserved'>return</strong>;
<a id='L9019' name='L9019'></a>  9019     <em class='brace'>}</em>
<a id='L9020' name='L9020'></a>  9020 
<a id='L9021' name='L9021'></a>  9021   <strong class='reserved'>if</strong> (dpyinfo-&gt;color_cells)
<a id='L9022' name='L9022'></a>  9022     <em class='brace'>{</em>
<a id='L9023' name='L9023'></a>  9023       <strong class='reserved'>int</strong> i;
<a id='L9024' name='L9024'></a>  9024       <strong class='reserved'>for</strong> (i = 0; i &lt; ncolors; ++i)
<a id='L9025' name='L9025'></a>  9025         <em class='brace'>{</em>
<a id='L9026' name='L9026'></a>  9026           <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> pixel = colors[i].pixel;
<a id='L9027' name='L9027'></a>  9027           <a href='../D/10871.html' title='Multiple defined in 5 places.'>eassert</a> (pixel &lt; dpyinfo-&gt;ncolor_cells);
<a id='L9028' name='L9028'></a>  9028           <a href='../D/10871.html' title='Multiple defined in 5 places.'>eassert</a> (dpyinfo-&gt;color_cells[pixel].pixel == pixel);
<a id='L9029' name='L9029'></a>  9029           colors[i] = dpyinfo-&gt;color_cells[pixel];
<a id='L9030' name='L9030'></a>  9030         <em class='brace'>}</em>
<a id='L9031' name='L9031'></a>  9031       <strong class='reserved'>return</strong>;
<a id='L9032' name='L9032'></a>  9032     <em class='brace'>}</em>
<a id='L9033' name='L9033'></a>  9033 
<a id='L9034' name='L9034'></a>  9034   XQueryColors (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../S/2212.html#L1468' title='Defined at 1468 in src/xterm.h.'>FRAME_X_COLORMAP</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), colors, ncolors);
<a id='L9035' name='L9035'></a>  9035 <em class='brace'>}</em>
<a id='L9036' name='L9036'></a>  9036 
<a id='L9037' name='L9037'></a>  9037 <em class='comment'>/* Store F's real background color into *BGCOLOR.  */</em>
<a id='L9038' name='L9038'></a>  9038 
<a id='L9039' name='L9039'></a>  9039 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L9040' name='L9040'></a>  9040 <a href='../S/2289.html#L31539' title='Referred from 31539 in src/xterm.c.'>x_query_frame_background_color</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/7038.html' title='Multiple defined in 2 places.'>XColor</a> *bgcolor)
<a id='L9041' name='L9041'></a>  9041 <em class='brace'>{</em>
<a id='L9042' name='L9042'></a>  9042   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> background = <a href='../S/2183.html#L1377' title='Defined at 1377 in src/frame.h.'>FRAME_BACKGROUND_PIXEL</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L9043' name='L9043'></a>  9043 <em class='sharp'>#ifndef</em> USE_CAIRO
<a id='L9044' name='L9044'></a>  9044   <a href='../D/7038.html' title='Multiple defined in 2 places.'>XColor</a> bg;
<a id='L9045' name='L9045'></a>  9045 <em class='sharp'>#endif</em>
<a id='L9046' name='L9046'></a>  9046 
<a id='L9047' name='L9047'></a>  9047   <strong class='reserved'>if</strong> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;alpha_bits)
<a id='L9048' name='L9048'></a>  9048     <em class='brace'>{</em>
<a id='L9049' name='L9049'></a>  9049 <em class='sharp'>#ifdef</em> USE_CAIRO
<a id='L9050' name='L9050'></a>  9050       background = (background &amp; ~<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;alpha_mask);
<a id='L9051' name='L9051'></a>  9051       background |= (((<strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong>) (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;alpha_background * 0xffff)
<a id='L9052' name='L9052'></a>  9052                       &gt;&gt; (16 - <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;alpha_bits))
<a id='L9053' name='L9053'></a>  9053                      &lt;&lt; <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;alpha_offset);
<a id='L9054' name='L9054'></a>  9054 <em class='sharp'>#else</em>
<a id='L9055' name='L9055'></a>  9055       <strong class='reserved'>if</strong> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;alpha_bits
<a id='L9056' name='L9056'></a>  9056           &amp;&amp; <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;alpha_background &lt; 1.0)
<a id='L9057' name='L9057'></a>  9057         <em class='brace'>{</em>
<a id='L9058' name='L9058'></a>  9058           bg.pixel = background;
<a id='L9059' name='L9059'></a>  9059           <a href='../S/2289.html#L8972' title='Defined at 8972 in src/xterm.c.'>x_query_colors</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, &amp;bg, 1);
<a id='L9060' name='L9060'></a>  9060 
<a id='L9061' name='L9061'></a>  9061           background
<a id='L9062' name='L9062'></a>  9062             = <a href='../S/2289.html#L7690' title='Defined at 7690 in src/xterm.c.'>x_premultiply_pixel</a> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L9063' name='L9063'></a>  9063                                    &amp;bg, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;alpha_background);
<a id='L9064' name='L9064'></a>  9064         <em class='brace'>}</em>
<a id='L9065' name='L9065'></a>  9065 <em class='sharp'>#endif</em>
<a id='L9066' name='L9066'></a>  9066     <em class='brace'>}</em>
<a id='L9067' name='L9067'></a>  9067 
<a id='L9068' name='L9068'></a>  9068   bgcolor-&gt;pixel = background;
<a id='L9069' name='L9069'></a>  9069 
<a id='L9070' name='L9070'></a>  9070   <a href='../S/2289.html#L8972' title='Defined at 8972 in src/xterm.c.'>x_query_colors</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, bgcolor, 1);
<a id='L9071' name='L9071'></a>  9071 <em class='brace'>}</em>
<a id='L9072' name='L9072'></a>  9072 
<a id='L9073' name='L9073'></a>  9073 <strong class='reserved'>static</strong> <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong>
<a id='L9074' name='L9074'></a>  9074 <a href='../S/2289.html#L9129' title='Referred from 9129 in src/xterm.c.'>x_hash_string_ignore_case</a> (<strong class='reserved'>const</strong> <strong class='reserved'>char</strong> *string)
<a id='L9075' name='L9075'></a>  9075 <em class='brace'>{</em>
<a id='L9076' name='L9076'></a>  9076   <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> i;
<a id='L9077' name='L9077'></a>  9077 
<a id='L9078' name='L9078'></a>  9078   i = 3323198485ul;
<a id='L9079' name='L9079'></a>  9079   <strong class='reserved'>for</strong> (; *string; ++string)
<a id='L9080' name='L9080'></a>  9080     <em class='brace'>{</em>
<a id='L9081' name='L9081'></a>  9081       i ^= <a href='../S/2829.html#L337' title='Defined at 337 in lib/c-ctype.h.'>c_tolower</a> (*string);
<a id='L9082' name='L9082'></a>  9082       i *= 0x5bd1e995;
<a id='L9083' name='L9083'></a>  9083       i ^= i &gt;&gt; 15;
<a id='L9084' name='L9084'></a>  9084     <em class='brace'>}</em>
<a id='L9085' name='L9085'></a>  9085   <strong class='reserved'>return</strong> i;
<a id='L9086' name='L9086'></a>  9086 <em class='brace'>}</em>
<a id='L9087' name='L9087'></a>  9087 
<a id='L9088' name='L9088'></a>  9088 <em class='comment'>/* On frame F, translate the color name to RGB values.  Use cached</em>
<a id='L9089' name='L9089'></a>  9089 <em class='comment'>   information, if possible.</em>
<a id='L9090' name='L9090'></a>  9090 <em class='comment'></em>
<a id='L9091' name='L9091'></a>  9091 <em class='comment'>   If too many entries are placed in the cache, the least recently</em>
<a id='L9092' name='L9092'></a>  9092 <em class='comment'>   used entries are removed.  */</em>
<a id='L9093' name='L9093'></a>  9093 
<a id='L9094' name='L9094'></a>  9094 Status
<a id='L9095' name='L9095'></a>  9095 <a href='../R/18261.html' title='Multiple referred from 5 places.'>x_parse_color</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <strong class='reserved'>const</strong> <strong class='reserved'>char</strong> *color_name,
<a id='L9096' name='L9096'></a>  9096                <a href='../D/7038.html' title='Multiple defined in 2 places.'>XColor</a> *color)
<a id='L9097' name='L9097'></a>  9097 <em class='brace'>{</em>
<a id='L9098' name='L9098'></a>  9098   <strong class='reserved'>unsigned</strong> <strong class='reserved'>short</strong> r, <a href='../S/4101.html#L90' title='Defined at 90 in test/manual/etags/cp-src/c.C.'>g</a>, <a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>;
<a id='L9099' name='L9099'></a>  9099   <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy;
<a id='L9100' name='L9100'></a>  9100   Colormap cmap;
<a id='L9101' name='L9101'></a>  9101   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L9102' name='L9102'></a>  9102   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L215' title='Defined at 215 in src/xterm.h.'>color_name_cache_entry</a> *cache_entry, *last;
<a id='L9103' name='L9103'></a>  9103   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L215' title='Defined at 215 in src/xterm.h.'>color_name_cache_entry</a> *next, *color_entry;
<a id='L9104' name='L9104'></a>  9104   <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> <a href='../D/12944.html' title='Multiple defined in 2 places.'>hash</a>, idx;
<a id='L9105' name='L9105'></a>  9105   <strong class='reserved'>int</strong> rc, i;
<a id='L9106' name='L9106'></a>  9106 
<a id='L9107' name='L9107'></a>  9107   <em class='comment'>/* Don't pass #RGB strings directly to XParseColor, because that</em>
<a id='L9108' name='L9108'></a>  9108 <em class='comment'>     follows the X convention of zero-extending each channel</em>
<a id='L9109' name='L9109'></a>  9109 <em class='comment'>     value: #f00 means #f00000.  We want the convention of scaling</em>
<a id='L9110' name='L9110'></a>  9110 <em class='comment'>     channel values, so #f00 means #ff0000, just as it does for</em>
<a id='L9111' name='L9111'></a>  9111 <em class='comment'>     HTML, SVG, and CSS.  */</em>
<a id='L9112' name='L9112'></a>  9112   <strong class='reserved'>if</strong> (<a href='../S/2239.html#L955' title='Defined at 955 in src/xfaces.c.'>parse_color_spec</a> (color_name, &amp;r, &amp;<a href='../S/4101.html#L90' title='Defined at 90 in test/manual/etags/cp-src/c.C.'>g</a>, &amp;<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>))
<a id='L9113' name='L9113'></a>  9113     <em class='brace'>{</em>
<a id='L9114' name='L9114'></a>  9114       color-&gt;red = r;
<a id='L9115' name='L9115'></a>  9115       color-&gt;green = <a href='../S/4101.html#L90' title='Defined at 90 in test/manual/etags/cp-src/c.C.'>g</a>;
<a id='L9116' name='L9116'></a>  9116       color-&gt;blue = <a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>;
<a id='L9117' name='L9117'></a>  9117 
<a id='L9118' name='L9118'></a>  9118       <strong class='reserved'>return</strong> 1;
<a id='L9119' name='L9119'></a>  9119     <em class='brace'>}</em>
<a id='L9120' name='L9120'></a>  9120 
<a id='L9121' name='L9121'></a>  9121   <em class='comment'>/* Some X servers send BadValue on empty color names.  */</em>
<a id='L9122' name='L9122'></a>  9122   <strong class='reserved'>if</strong> (!strlen (color_name))
<a id='L9123' name='L9123'></a>  9123     <strong class='reserved'>return</strong> 0;
<a id='L9124' name='L9124'></a>  9124 
<a id='L9125' name='L9125'></a>  9125   cmap = <a href='../S/2212.html#L1468' title='Defined at 1468 in src/xterm.h.'>FRAME_X_COLORMAP</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L9126' name='L9126'></a>  9126   dpy = <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L9127' name='L9127'></a>  9127   dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L9128' name='L9128'></a>  9128 
<a id='L9129' name='L9129'></a>  9129   <a href='../D/12944.html' title='Multiple defined in 2 places.'>hash</a> = <a href='../S/2289.html#L9074' title='Defined at 9074 in src/xterm.c.'>x_hash_string_ignore_case</a> (color_name);
<a id='L9130' name='L9130'></a>  9130   idx = <a href='../D/12944.html' title='Multiple defined in 2 places.'>hash</a> % dpyinfo-&gt;color_names_size;
<a id='L9131' name='L9131'></a>  9131 
<a id='L9132' name='L9132'></a>  9132   last = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L9133' name='L9133'></a>  9133 
<a id='L9134' name='L9134'></a>  9134   <strong class='reserved'>for</strong> (cache_entry = dpyinfo-&gt;color_names[idx];
<a id='L9135' name='L9135'></a>  9135        cache_entry; cache_entry = cache_entry-&gt;next)
<a id='L9136' name='L9136'></a>  9136     <em class='brace'>{</em>
<a id='L9137' name='L9137'></a>  9137       <strong class='reserved'>if</strong> (!<a href='../S/2315.html#L102' title='Defined at 102 in src/dispextern.h.'>xstrcasecmp</a> (cache_entry-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>, color_name))
<a id='L9138' name='L9138'></a>  9138         <em class='brace'>{</em>
<a id='L9139' name='L9139'></a>  9139           <em class='comment'>/* Move recently used entries to the start of the color</em>
<a id='L9140' name='L9140'></a>  9140 <em class='comment'>             cache.  */</em>
<a id='L9141' name='L9141'></a>  9141 
<a id='L9142' name='L9142'></a>  9142           <strong class='reserved'>if</strong> (last)
<a id='L9143' name='L9143'></a>  9143             <em class='brace'>{</em>
<a id='L9144' name='L9144'></a>  9144               last-&gt;next = cache_entry-&gt;next;
<a id='L9145' name='L9145'></a>  9145               cache_entry-&gt;next = dpyinfo-&gt;color_names[idx];
<a id='L9146' name='L9146'></a>  9146 
<a id='L9147' name='L9147'></a>  9147               dpyinfo-&gt;color_names[idx] = cache_entry;
<a id='L9148' name='L9148'></a>  9148             <em class='brace'>}</em>
<a id='L9149' name='L9149'></a>  9149 
<a id='L9150' name='L9150'></a>  9150           <strong class='reserved'>if</strong> (cache_entry-&gt;valid)
<a id='L9151' name='L9151'></a>  9151             *color = cache_entry-&gt;rgb;
<a id='L9152' name='L9152'></a>  9152 
<a id='L9153' name='L9153'></a>  9153           <strong class='reserved'>return</strong> cache_entry-&gt;valid;
<a id='L9154' name='L9154'></a>  9154         <em class='brace'>}</em>
<a id='L9155' name='L9155'></a>  9155 
<a id='L9156' name='L9156'></a>  9156       last = cache_entry;
<a id='L9157' name='L9157'></a>  9157     <em class='brace'>}</em>
<a id='L9158' name='L9158'></a>  9158 
<a id='L9159' name='L9159'></a>  9159   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L9160' name='L9160'></a>  9160   rc = XParseColor (dpy, cmap, color_name, color);
<a id='L9161' name='L9161'></a>  9161   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L9162' name='L9162'></a>  9162 
<a id='L9163' name='L9163'></a>  9163   cache_entry = <a href='../S/2350.html#L802' title='Defined at 802 in src/alloc.c.'>xzalloc</a> (<strong class='reserved'>sizeof</strong> *cache_entry);
<a id='L9164' name='L9164'></a>  9164   dpyinfo-&gt;color_names_length[idx] += 1;
<a id='L9165' name='L9165'></a>  9165 
<a id='L9166' name='L9166'></a>  9166   <strong class='reserved'>if</strong> (rc)
<a id='L9167' name='L9167'></a>  9167     cache_entry-&gt;rgb = *color;
<a id='L9168' name='L9168'></a>  9168 
<a id='L9169' name='L9169'></a>  9169   cache_entry-&gt;valid = rc;
<a id='L9170' name='L9170'></a>  9170   cache_entry-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a> = <a href='../D/20121.html' title='Multiple defined in 3 places.'>xstrdup</a> (color_name);
<a id='L9171' name='L9171'></a>  9171   cache_entry-&gt;next = dpyinfo-&gt;color_names[idx];
<a id='L9172' name='L9172'></a>  9172 
<a id='L9173' name='L9173'></a>  9173   dpyinfo-&gt;color_names[idx] = cache_entry;
<a id='L9174' name='L9174'></a>  9174 
<a id='L9175' name='L9175'></a>  9175   <em class='comment'>/* Don't let the color cache become too big.  */</em>
<a id='L9176' name='L9176'></a>  9176   <strong class='reserved'>if</strong> (dpyinfo-&gt;color_names_length[idx] &gt; (x_color_cache_bucket_size &gt; 0
<a id='L9177' name='L9177'></a>  9177                                           ? x_color_cache_bucket_size : 128))
<a id='L9178' name='L9178'></a>  9178     <em class='brace'>{</em>
<a id='L9179' name='L9179'></a>  9179       i = 0;
<a id='L9180' name='L9180'></a>  9180 
<a id='L9181' name='L9181'></a>  9181       <strong class='reserved'>for</strong> (last = dpyinfo-&gt;color_names[idx]; last; last = last-&gt;next)
<a id='L9182' name='L9182'></a>  9182         <em class='brace'>{</em>
<a id='L9183' name='L9183'></a>  9183           <strong class='reserved'>if</strong> (++i == (x_color_cache_bucket_size &gt; 0
<a id='L9184' name='L9184'></a>  9184                       ? x_color_cache_bucket_size : 128))
<a id='L9185' name='L9185'></a>  9185             <em class='brace'>{</em>
<a id='L9186' name='L9186'></a>  9186               next = last-&gt;next;
<a id='L9187' name='L9187'></a>  9187               last-&gt;next = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L9188' name='L9188'></a>  9188 
<a id='L9189' name='L9189'></a>  9189               <strong class='reserved'>for</strong> (color_entry = next; color_entry; color_entry = last)
<a id='L9190' name='L9190'></a>  9190                 <em class='brace'>{</em>
<a id='L9191' name='L9191'></a>  9191                   last = color_entry-&gt;next;
<a id='L9192' name='L9192'></a>  9192 
<a id='L9193' name='L9193'></a>  9193                   <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (color_entry-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>);
<a id='L9194' name='L9194'></a>  9194                   <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (color_entry);
<a id='L9195' name='L9195'></a>  9195 
<a id='L9196' name='L9196'></a>  9196                   dpyinfo-&gt;color_names_length[idx] -= 1;
<a id='L9197' name='L9197'></a>  9197                 <em class='brace'>}</em>
<a id='L9198' name='L9198'></a>  9198 
<a id='L9199' name='L9199'></a>  9199               <strong class='reserved'>return</strong> rc;
<a id='L9200' name='L9200'></a>  9200             <em class='brace'>}</em>
<a id='L9201' name='L9201'></a>  9201         <em class='brace'>}</em>
<a id='L9202' name='L9202'></a>  9202     <em class='brace'>}</em>
<a id='L9203' name='L9203'></a>  9203 
<a id='L9204' name='L9204'></a>  9204   <strong class='reserved'>return</strong> rc;
<a id='L9205' name='L9205'></a>  9205 <em class='brace'>}</em>
<a id='L9206' name='L9206'></a>  9206 
<a id='L9207' name='L9207'></a>  9207 
<a id='L9208' name='L9208'></a>  9208 <em class='comment'>/* Allocate the color COLOR-&gt;pixel on DISPLAY, colormap CMAP.  If an</em>
<a id='L9209' name='L9209'></a>  9209 <em class='comment'>   exact match can't be allocated, try the nearest color available.</em>
<a id='L9210' name='L9210'></a>  9210 <em class='comment'>   Value is true if successful.  Set *COLOR to the color</em>
<a id='L9211' name='L9211'></a>  9211 <em class='comment'>   allocated.  */</em>
<a id='L9212' name='L9212'></a>  9212 
<a id='L9213' name='L9213'></a>  9213 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L9214' name='L9214'></a>  9214 <a href='../R/18048.html' title='Multiple referred from 3 places.'>x_alloc_nearest_color_1</a> (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy, Colormap cmap, <a href='../D/7038.html' title='Multiple defined in 2 places.'>XColor</a> *color)
<a id='L9215' name='L9215'></a>  9215 <em class='brace'>{</em>
<a id='L9216' name='L9216'></a>  9216   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo = <a href='../S/2289.html#L6774' title='Defined at 6774 in src/xterm.c.'>x_display_info_for_display</a> (dpy);
<a id='L9217' name='L9217'></a>  9217   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> rc;
<a id='L9218' name='L9218'></a>  9218 
<a id='L9219' name='L9219'></a>  9219   <a href='../D/10872.html' title='Multiple defined in 5 places.'>eassume</a> (dpyinfo);
<a id='L9220' name='L9220'></a>  9220   rc = XAllocColor (dpy, cmap, color) != 0;
<a id='L9221' name='L9221'></a>  9221 
<a id='L9222' name='L9222'></a>  9222   <strong class='reserved'>if</strong> (dpyinfo-&gt;visual_info.class == DirectColor)
<a id='L9223' name='L9223'></a>  9223     <strong class='reserved'>return</strong> rc;
<a id='L9224' name='L9224'></a>  9224 
<a id='L9225' name='L9225'></a>  9225   <strong class='reserved'>if</strong> (rc == 0)
<a id='L9226' name='L9226'></a>  9226     <em class='brace'>{</em>
<a id='L9227' name='L9227'></a>  9227       <em class='comment'>/* If we got to this point, the colormap is full, so we're going</em>
<a id='L9228' name='L9228'></a>  9228 <em class='comment'>         to try and get the next closest color.  The algorithm used is</em>
<a id='L9229' name='L9229'></a>  9229 <em class='comment'>         a least-squares matching, which is what X uses for closest</em>
<a id='L9230' name='L9230'></a>  9230 <em class='comment'>         color matching with StaticColor visuals.  */</em>
<a id='L9231' name='L9231'></a>  9231 
<a id='L9232' name='L9232'></a>  9232       <strong class='reserved'>const</strong> <a href='../D/7038.html' title='Multiple defined in 2 places.'>XColor</a> *cells;
<a id='L9233' name='L9233'></a>  9233       <strong class='reserved'>int</strong> no_cells;
<a id='L9234' name='L9234'></a>  9234       <strong class='reserved'>int</strong> nearest;
<a id='L9235' name='L9235'></a>  9235       <strong class='reserved'>long</strong> nearest_delta, trial_delta;
<a id='L9236' name='L9236'></a>  9236       <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L9237' name='L9237'></a>  9237       Status status;
<a id='L9238' name='L9238'></a>  9238       <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> retry = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L9239' name='L9239'></a>  9239       <strong class='reserved'>int</strong> ncolor_cells, i;
<a id='L9240' name='L9240'></a>  9240       <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> temp_allocated;
<a id='L9241' name='L9241'></a>  9241       <a href='../D/7038.html' title='Multiple defined in 2 places.'>XColor</a> temp;
<a id='L9242' name='L9242'></a>  9242 
<a id='L9243' name='L9243'></a>  9243     <a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a>:
<a id='L9244' name='L9244'></a>  9244       cells = <a href='../S/2289.html#L8938' title='Defined at 8938 in src/xterm.c.'>x_color_cells</a> (dpy, &amp;no_cells);
<a id='L9245' name='L9245'></a>  9245       temp_allocated = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L9246' name='L9246'></a>  9246 
<a id='L9247' name='L9247'></a>  9247       nearest = 0;
<a id='L9248' name='L9248'></a>  9248       <em class='comment'>/* I'm assuming CSE so I'm not going to condense this. */</em>
<a id='L9249' name='L9249'></a>  9249       nearest_delta = ((((color-&gt;red &gt;&gt; 8) - (cells[0].red &gt;&gt; 8))
<a id='L9250' name='L9250'></a>  9250                         * ((color-&gt;red &gt;&gt; 8) - (cells[0].red &gt;&gt; 8)))
<a id='L9251' name='L9251'></a>  9251                        + (((color-&gt;green &gt;&gt; 8) - (cells[0].green &gt;&gt; 8))
<a id='L9252' name='L9252'></a>  9252                           * ((color-&gt;green &gt;&gt; 8) - (cells[0].green &gt;&gt; 8)))
<a id='L9253' name='L9253'></a>  9253                        + (((color-&gt;blue &gt;&gt; 8) - (cells[0].blue &gt;&gt; 8))
<a id='L9254' name='L9254'></a>  9254                           * ((color-&gt;blue &gt;&gt; 8) - (cells[0].blue &gt;&gt; 8))));
<a id='L9255' name='L9255'></a>  9255       <strong class='reserved'>for</strong> (<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = 1; <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> &lt; no_cells; <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>++)
<a id='L9256' name='L9256'></a>  9256         <em class='brace'>{</em>
<a id='L9257' name='L9257'></a>  9257           trial_delta = ((((color-&gt;red &gt;&gt; 8) - (cells[<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>].red &gt;&gt; 8))
<a id='L9258' name='L9258'></a>  9258                           * ((color-&gt;red &gt;&gt; 8) - (cells[<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>].red &gt;&gt; 8)))
<a id='L9259' name='L9259'></a>  9259                          + (((color-&gt;green &gt;&gt; 8) - (cells[<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>].green &gt;&gt; 8))
<a id='L9260' name='L9260'></a>  9260                             * ((color-&gt;green &gt;&gt; 8) - (cells[<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>].green &gt;&gt; 8)))
<a id='L9261' name='L9261'></a>  9261                          + (((color-&gt;blue &gt;&gt; 8) - (cells[<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>].blue &gt;&gt; 8))
<a id='L9262' name='L9262'></a>  9262                             * ((color-&gt;blue &gt;&gt; 8) - (cells[<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>].blue &gt;&gt; 8))));
<a id='L9263' name='L9263'></a>  9263           <strong class='reserved'>if</strong> (trial_delta &lt; nearest_delta)
<a id='L9264' name='L9264'></a>  9264             <em class='brace'>{</em>
<a id='L9265' name='L9265'></a>  9265               <em class='comment'>/* We didn't decide to use this color, so free it.  */</em>
<a id='L9266' name='L9266'></a>  9266               <strong class='reserved'>if</strong> (temp_allocated)
<a id='L9267' name='L9267'></a>  9267                 <em class='brace'>{</em>
<a id='L9268' name='L9268'></a>  9268                   XFreeColors (dpy, cmap, &amp;temp.pixel, 1, 0);
<a id='L9269' name='L9269'></a>  9269                   temp_allocated = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L9270' name='L9270'></a>  9270                 <em class='brace'>}</em>
<a id='L9271' name='L9271'></a>  9271 
<a id='L9272' name='L9272'></a>  9272               temp.red = cells[<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>].red;
<a id='L9273' name='L9273'></a>  9273               temp.green = cells[<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>].green;
<a id='L9274' name='L9274'></a>  9274               temp.blue = cells[<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>].blue;
<a id='L9275' name='L9275'></a>  9275               status = XAllocColor (dpy, cmap, &amp;temp);
<a id='L9276' name='L9276'></a>  9276 
<a id='L9277' name='L9277'></a>  9277               <strong class='reserved'>if</strong> (status)
<a id='L9278' name='L9278'></a>  9278                 <em class='brace'>{</em>
<a id='L9279' name='L9279'></a>  9279                   temp_allocated = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L9280' name='L9280'></a>  9280                   nearest = <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L9281' name='L9281'></a>  9281                   nearest_delta = trial_delta;
<a id='L9282' name='L9282'></a>  9282                 <em class='brace'>}</em>
<a id='L9283' name='L9283'></a>  9283             <em class='brace'>}</em>
<a id='L9284' name='L9284'></a>  9284         <em class='brace'>}</em>
<a id='L9285' name='L9285'></a>  9285       color-&gt;red = cells[nearest].red;
<a id='L9286' name='L9286'></a>  9286       color-&gt;green = cells[nearest].green;
<a id='L9287' name='L9287'></a>  9287       color-&gt;blue = cells[nearest].blue;
<a id='L9288' name='L9288'></a>  9288 
<a id='L9289' name='L9289'></a>  9289       <strong class='reserved'>if</strong> (!temp_allocated)
<a id='L9290' name='L9290'></a>  9290         status = XAllocColor (dpy, cmap, color);
<a id='L9291' name='L9291'></a>  9291       <strong class='reserved'>else</strong>
<a id='L9292' name='L9292'></a>  9292         <em class='brace'>{</em>
<a id='L9293' name='L9293'></a>  9293           *color = temp;
<a id='L9294' name='L9294'></a>  9294           status = 1;
<a id='L9295' name='L9295'></a>  9295         <em class='brace'>}</em>
<a id='L9296' name='L9296'></a>  9296 
<a id='L9297' name='L9297'></a>  9297       <strong class='reserved'>if</strong> (status == 0 &amp;&amp; !retry)
<a id='L9298' name='L9298'></a>  9298         <em class='brace'>{</em>
<a id='L9299' name='L9299'></a>  9299           <em class='comment'>/* Our private cache of color cells is probably out of date.</em>
<a id='L9300' name='L9300'></a>  9300 <em class='comment'>             Refresh it here, and try to allocate the nearest color</em>
<a id='L9301' name='L9301'></a>  9301 <em class='comment'>             from the new colormap.  */</em>
<a id='L9302' name='L9302'></a>  9302 
<a id='L9303' name='L9303'></a>  9303           retry = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L9304' name='L9304'></a>  9304           <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (dpyinfo-&gt;color_cells);
<a id='L9305' name='L9305'></a>  9305 
<a id='L9306' name='L9306'></a>  9306           ncolor_cells = dpyinfo-&gt;visual_info.colormap_size;
<a id='L9307' name='L9307'></a>  9307 
<a id='L9308' name='L9308'></a>  9308           dpyinfo-&gt;color_cells = <a href='../D/20078.html' title='Multiple defined in 2 places.'>xnmalloc</a> (ncolor_cells,
<a id='L9309' name='L9309'></a>  9309                                            <strong class='reserved'>sizeof</strong> *dpyinfo-&gt;color_cells);
<a id='L9310' name='L9310'></a>  9310           dpyinfo-&gt;ncolor_cells = ncolor_cells;
<a id='L9311' name='L9311'></a>  9311 
<a id='L9312' name='L9312'></a>  9312           <strong class='reserved'>for</strong> (i = 0; i &lt; ncolor_cells; ++i)
<a id='L9313' name='L9313'></a>  9313             dpyinfo-&gt;color_cells[i].pixel = i;
<a id='L9314' name='L9314'></a>  9314 
<a id='L9315' name='L9315'></a>  9315           XQueryColors (dpy, dpyinfo-&gt;cmap,
<a id='L9316' name='L9316'></a>  9316                         dpyinfo-&gt;color_cells, ncolor_cells);
<a id='L9317' name='L9317'></a>  9317 
<a id='L9318' name='L9318'></a>  9318           <strong class='reserved'>goto</strong> <a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a>;
<a id='L9319' name='L9319'></a>  9319         <em class='brace'>}</em>
<a id='L9320' name='L9320'></a>  9320 
<a id='L9321' name='L9321'></a>  9321       rc = status != 0;
<a id='L9322' name='L9322'></a>  9322     <em class='brace'>}</em>
<a id='L9323' name='L9323'></a>  9323   <strong class='reserved'>else</strong>
<a id='L9324' name='L9324'></a>  9324     <em class='brace'>{</em>
<a id='L9325' name='L9325'></a>  9325       <em class='comment'>/* If allocation succeeded, and the allocated pixel color is not</em>
<a id='L9326' name='L9326'></a>  9326 <em class='comment'>         equal to a cached pixel color recorded earlier, there was a</em>
<a id='L9327' name='L9327'></a>  9327 <em class='comment'>         change in the colormap, so clear the color cache.  */</em>
<a id='L9328' name='L9328'></a>  9328       <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo = <a href='../S/2289.html#L6774' title='Defined at 6774 in src/xterm.c.'>x_display_info_for_display</a> (dpy);
<a id='L9329' name='L9329'></a>  9329       <a href='../D/10872.html' title='Multiple defined in 5 places.'>eassume</a> (dpyinfo);
<a id='L9330' name='L9330'></a>  9330 
<a id='L9331' name='L9331'></a>  9331       <strong class='reserved'>if</strong> (dpyinfo-&gt;color_cells)
<a id='L9332' name='L9332'></a>  9332         <em class='brace'>{</em>
<a id='L9333' name='L9333'></a>  9333           <a href='../D/7038.html' title='Multiple defined in 2 places.'>XColor</a> *cached_color = &amp;dpyinfo-&gt;color_cells[color-&gt;pixel];
<a id='L9334' name='L9334'></a>  9334           <strong class='reserved'>if</strong> (cached_color-&gt;red != color-&gt;red
<a id='L9335' name='L9335'></a>  9335               || cached_color-&gt;blue != color-&gt;blue
<a id='L9336' name='L9336'></a>  9336               || cached_color-&gt;green != color-&gt;green)
<a id='L9337' name='L9337'></a>  9337             <em class='brace'>{</em>
<a id='L9338' name='L9338'></a>  9338               <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (dpyinfo-&gt;color_cells);
<a id='L9339' name='L9339'></a>  9339               dpyinfo-&gt;color_cells = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L9340' name='L9340'></a>  9340               dpyinfo-&gt;ncolor_cells = 0;
<a id='L9341' name='L9341'></a>  9341             <em class='brace'>}</em>
<a id='L9342' name='L9342'></a>  9342         <em class='brace'>}</em>
<a id='L9343' name='L9343'></a>  9343     <em class='brace'>}</em>
<a id='L9344' name='L9344'></a>  9344 
<a id='L9345' name='L9345'></a>  9345 <em class='sharp'>#ifdef</em> DEBUG_X_COLORS
<a id='L9346' name='L9346'></a>  9346   <strong class='reserved'>if</strong> (rc)
<a id='L9347' name='L9347'></a>  9347     <a href='../S/2239.html#L422' title='Defined at 422 in src/xfaces.c.'>register_color</a> (color-&gt;pixel);
<a id='L9348' name='L9348'></a>  9348 <em class='sharp'>#endif</em> <em class='comment'>/* DEBUG_X_COLORS */</em>
<a id='L9349' name='L9349'></a>  9349 
<a id='L9350' name='L9350'></a>  9350   <strong class='reserved'>return</strong> rc;
<a id='L9351' name='L9351'></a>  9351 <em class='brace'>}</em>
<a id='L9352' name='L9352'></a>  9352 
<a id='L9353' name='L9353'></a>  9353 
<a id='L9354' name='L9354'></a>  9354 <em class='comment'>/* Allocate the color COLOR-&gt;pixel on frame F, colormap CMAP, after</em>
<a id='L9355' name='L9355'></a>  9355 <em class='comment'>   gamma correction.  If an exact match can't be allocated, try the</em>
<a id='L9356' name='L9356'></a>  9356 <em class='comment'>   nearest color available.  Value is true if successful.  Set *COLOR</em>
<a id='L9357' name='L9357'></a>  9357 <em class='comment'>   to the color allocated.  */</em>
<a id='L9358' name='L9358'></a>  9358 
<a id='L9359' name='L9359'></a>  9359 <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L9360' name='L9360'></a>  9360 <a href='../R/18047.html' title='Multiple referred from 7 places.'>x_alloc_nearest_color</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, Colormap cmap, <a href='../D/7038.html' title='Multiple defined in 2 places.'>XColor</a> *color)
<a id='L9361' name='L9361'></a>  9361 <em class='brace'>{</em>
<a id='L9362' name='L9362'></a>  9362   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L9363' name='L9363'></a>  9363 
<a id='L9364' name='L9364'></a>  9364   <a href='../D/11951.html' title='Multiple defined in 4 places.'>gamma_correct</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, color);
<a id='L9365' name='L9365'></a>  9365 
<a id='L9366' name='L9366'></a>  9366   <strong class='reserved'>if</strong> (dpyinfo-&gt;red_bits &gt; 0)
<a id='L9367' name='L9367'></a>  9367     <em class='brace'>{</em>
<a id='L9368' name='L9368'></a>  9368       color-&gt;pixel = <a href='../S/2212.html#L1813' title='Defined at 1813 in src/xterm.h.'>x_make_truecolor_pixel</a> (dpyinfo,
<a id='L9369' name='L9369'></a>  9369                                              color-&gt;red,
<a id='L9370' name='L9370'></a>  9370                                              color-&gt;green,
<a id='L9371' name='L9371'></a>  9371                                              color-&gt;blue);
<a id='L9372' name='L9372'></a>  9372       <strong class='reserved'>return</strong> <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L9373' name='L9373'></a>  9373     <em class='brace'>}</em>
<a id='L9374' name='L9374'></a>  9374 
<a id='L9375' name='L9375'></a>  9375   <strong class='reserved'>return</strong> <a href='../S/2289.html#L9214' title='Defined at 9214 in src/xterm.c.'>x_alloc_nearest_color_1</a> (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), cmap, color);
<a id='L9376' name='L9376'></a>  9376 <em class='brace'>}</em>
<a id='L9377' name='L9377'></a>  9377 
<a id='L9378' name='L9378'></a>  9378 
<a id='L9379' name='L9379'></a>  9379 <em class='comment'>/* Allocate color PIXEL on frame F.  PIXEL must already be allocated.</em>
<a id='L9380' name='L9380'></a>  9380 <em class='comment'>   It's necessary to do this instead of just using PIXEL directly to</em>
<a id='L9381' name='L9381'></a>  9381 <em class='comment'>   get color reference counts right.  */</em>
<a id='L9382' name='L9382'></a>  9382 
<a id='L9383' name='L9383'></a>  9383 <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong>
<a id='L9384' name='L9384'></a>  9384 <a href='../R/18088.html' title='Multiple referred from 5 places.'>x_copy_color</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> pixel)
<a id='L9385' name='L9385'></a>  9385 <em class='brace'>{</em>
<a id='L9386' name='L9386'></a>  9386   <a href='../D/7038.html' title='Multiple defined in 2 places.'>XColor</a> color;
<a id='L9387' name='L9387'></a>  9387 
<a id='L9388' name='L9388'></a>  9388   <em class='comment'>/* If display has an immutable color map, freeing colors is not</em>
<a id='L9389' name='L9389'></a>  9389 <em class='comment'>     necessary and some servers don't allow it.  Since we won't free a</em>
<a id='L9390' name='L9390'></a>  9390 <em class='comment'>     color once we've allocated it, we don't need to re-allocate it to</em>
<a id='L9391' name='L9391'></a>  9391 <em class='comment'>     maintain the server's reference count.  */</em>
<a id='L9392' name='L9392'></a>  9392   <strong class='reserved'>if</strong> (!<a href='../S/2212.html#L1833' title='Defined at 1833 in src/xterm.h.'>x_mutable_colormap</a> (<a href='../S/2212.html#L1437' title='Defined at 1437 in src/xterm.h.'>FRAME_X_VISUAL_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)))
<a id='L9393' name='L9393'></a>  9393     <strong class='reserved'>return</strong> pixel;
<a id='L9394' name='L9394'></a>  9394 
<a id='L9395' name='L9395'></a>  9395   color.pixel = pixel;
<a id='L9396' name='L9396'></a>  9396   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L9397' name='L9397'></a>  9397   <em class='comment'>/* The color could still be found in the color_cells array.  */</em>
<a id='L9398' name='L9398'></a>  9398   <a href='../S/2289.html#L8972' title='Defined at 8972 in src/xterm.c.'>x_query_colors</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, &amp;color, 1);
<a id='L9399' name='L9399'></a>  9399   XAllocColor (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../S/2212.html#L1468' title='Defined at 1468 in src/xterm.h.'>FRAME_X_COLORMAP</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), &amp;color);
<a id='L9400' name='L9400'></a>  9400   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L9401' name='L9401'></a>  9401 <em class='sharp'>#ifdef</em> DEBUG_X_COLORS
<a id='L9402' name='L9402'></a>  9402   <a href='../S/2239.html#L422' title='Defined at 422 in src/xfaces.c.'>register_color</a> (pixel);
<a id='L9403' name='L9403'></a>  9403 <em class='sharp'>#endif</em>
<a id='L9404' name='L9404'></a>  9404   <strong class='reserved'>return</strong> color.pixel;
<a id='L9405' name='L9405'></a>  9405 <em class='brace'>}</em>
<a id='L9406' name='L9406'></a>  9406 
<a id='L9407' name='L9407'></a>  9407 
<a id='L9408' name='L9408'></a>  9408 <em class='comment'>/* Brightness beyond which a color won't have its highlight brightness</em>
<a id='L9409' name='L9409'></a>  9409 <em class='comment'>   boosted.</em>
<a id='L9410' name='L9410'></a>  9410 <em class='comment'></em>
<a id='L9411' name='L9411'></a>  9411 <em class='comment'>   Nominally, highlight colors for `3d' faces are calculated by</em>
<a id='L9412' name='L9412'></a>  9412 <em class='comment'>   brightening an object's color by a constant scale factor, but this</em>
<a id='L9413' name='L9413'></a>  9413 <em class='comment'>   doesn't yield good results for dark colors, so for colors who's</em>
<a id='L9414' name='L9414'></a>  9414 <em class='comment'>   brightness is less than this value (on a scale of 0-65535) have an</em>
<a id='L9415' name='L9415'></a>  9415 <em class='comment'>   use an additional additive factor.</em>
<a id='L9416' name='L9416'></a>  9416 <em class='comment'></em>
<a id='L9417' name='L9417'></a>  9417 <em class='comment'>   The value here is set so that the default menu-bar/mode-line color</em>
<a id='L9418' name='L9418'></a>  9418 <em class='comment'>   (grey75) will not have its highlights changed at all.  */</em>
<a id='L9419' name='L9419'></a>  9419 <em class='sharp'>#define</em> <a href='../R/2805.html' title='Multiple referred from 8 places.'>HIGHLIGHT_COLOR_DARK_BOOST_LIMIT</a> 48000
<a id='L9420' name='L9420'></a>  9420 
<a id='L9421' name='L9421'></a>  9421 
<a id='L9422' name='L9422'></a>  9422 <em class='comment'>/* Allocate a color which is lighter or darker than *PIXEL by FACTOR</em>
<a id='L9423' name='L9423'></a>  9423 <em class='comment'>   or DELTA.  Try a color with RGB values multiplied by FACTOR first.</em>
<a id='L9424' name='L9424'></a>  9424 <em class='comment'>   If this produces the same color as PIXEL, try a color where all RGB</em>
<a id='L9425' name='L9425'></a>  9425 <em class='comment'>   values have DELTA added.  Return the allocated color in *PIXEL.</em>
<a id='L9426' name='L9426'></a>  9426 <em class='comment'>   DISPLAY is the X display, CMAP is the colormap to operate on.</em>
<a id='L9427' name='L9427'></a>  9427 <em class='comment'>   Value is non-zero if successful.  */</em>
<a id='L9428' name='L9428'></a>  9428 
<a id='L9429' name='L9429'></a>  9429 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L9430' name='L9430'></a>  9430 <a href='../R/18045.html' title='Multiple referred from 7 places.'>x_alloc_lighter_color</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, Colormap cmap,
<a id='L9431' name='L9431'></a>  9431                        <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> *pixel, <strong class='reserved'>double</strong> factor, <strong class='reserved'>int</strong> delta)
<a id='L9432' name='L9432'></a>  9432 <em class='brace'>{</em>
<a id='L9433' name='L9433'></a>  9433   <a href='../D/7038.html' title='Multiple defined in 2 places.'>XColor</a> color, new;
<a id='L9434' name='L9434'></a>  9434   <strong class='reserved'>long</strong> bright;
<a id='L9435' name='L9435'></a>  9435   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> success_p;
<a id='L9436' name='L9436'></a>  9436 
<a id='L9437' name='L9437'></a>  9437   <em class='comment'>/* Get RGB color values.  */</em>
<a id='L9438' name='L9438'></a>  9438   color.pixel = *pixel;
<a id='L9439' name='L9439'></a>  9439   <a href='../S/2289.html#L8972' title='Defined at 8972 in src/xterm.c.'>x_query_colors</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, &amp;color, 1);
<a id='L9440' name='L9440'></a>  9440 
<a id='L9441' name='L9441'></a>  9441   <em class='comment'>/* Change RGB values by specified FACTOR.  Avoid overflow!  */</em>
<a id='L9442' name='L9442'></a>  9442   <a href='../D/10871.html' title='Multiple defined in 5 places.'>eassert</a> (factor &gt;= 0);
<a id='L9443' name='L9443'></a>  9443   new.red = <a href='../D/14475.html' title='Multiple defined in 11 places.'>min</a> (0xffff, factor * color.red);
<a id='L9444' name='L9444'></a>  9444   new.green = <a href='../D/14475.html' title='Multiple defined in 11 places.'>min</a> (0xffff, factor * color.green);
<a id='L9445' name='L9445'></a>  9445   new.blue = <a href='../D/14475.html' title='Multiple defined in 11 places.'>min</a> (0xffff, factor * color.blue);
<a id='L9446' name='L9446'></a>  9446 
<a id='L9447' name='L9447'></a>  9447   <em class='comment'>/* Calculate brightness of COLOR.  */</em>
<a id='L9448' name='L9448'></a>  9448   bright = (2 * color.red + 3 * color.green + color.blue) / 6;
<a id='L9449' name='L9449'></a>  9449 
<a id='L9450' name='L9450'></a>  9450   <em class='comment'>/* We only boost colors that are darker than</em>
<a id='L9451' name='L9451'></a>  9451 <em class='comment'>     HIGHLIGHT_COLOR_DARK_BOOST_LIMIT.  */</em>
<a id='L9452' name='L9452'></a>  9452   <strong class='reserved'>if</strong> (bright &lt; <a href='../D/3070.html' title='Multiple defined in 4 places.'>HIGHLIGHT_COLOR_DARK_BOOST_LIMIT</a>)
<a id='L9453' name='L9453'></a>  9453     <em class='comment'>/* Make an additive adjustment to NEW, because it's dark enough so</em>
<a id='L9454' name='L9454'></a>  9454 <em class='comment'>       that scaling by FACTOR alone isn't enough.  */</em>
<a id='L9455' name='L9455'></a>  9455     <em class='brace'>{</em>
<a id='L9456' name='L9456'></a>  9456       <em class='comment'>/* How far below the limit this color is (0 - 1, 1 being darker).  */</em>
<a id='L9457' name='L9457'></a>  9457       <strong class='reserved'>double</strong> dimness = 1 - (<strong class='reserved'>double</strong>) bright / <a href='../D/3070.html' title='Multiple defined in 4 places.'>HIGHLIGHT_COLOR_DARK_BOOST_LIMIT</a>;
<a id='L9458' name='L9458'></a>  9458       <em class='comment'>/* The additive adjustment.  */</em>
<a id='L9459' name='L9459'></a>  9459       <strong class='reserved'>int</strong> min_delta = delta * dimness * factor / 2;
<a id='L9460' name='L9460'></a>  9460 
<a id='L9461' name='L9461'></a>  9461       <strong class='reserved'>if</strong> (factor &lt; 1)
<a id='L9462' name='L9462'></a>  9462         <em class='brace'>{</em>
<a id='L9463' name='L9463'></a>  9463           new.red =   <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> (0, new.red -   min_delta);
<a id='L9464' name='L9464'></a>  9464           new.green = <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> (0, new.green - min_delta);
<a id='L9465' name='L9465'></a>  9465           new.blue =  <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> (0, new.blue -  min_delta);
<a id='L9466' name='L9466'></a>  9466         <em class='brace'>}</em>
<a id='L9467' name='L9467'></a>  9467       <strong class='reserved'>else</strong>
<a id='L9468' name='L9468'></a>  9468         <em class='brace'>{</em>
<a id='L9469' name='L9469'></a>  9469           new.red =   <a href='../D/14475.html' title='Multiple defined in 11 places.'>min</a> (0xffff, min_delta + new.red);
<a id='L9470' name='L9470'></a>  9470           new.green = <a href='../D/14475.html' title='Multiple defined in 11 places.'>min</a> (0xffff, min_delta + new.green);
<a id='L9471' name='L9471'></a>  9471           new.blue =  <a href='../D/14475.html' title='Multiple defined in 11 places.'>min</a> (0xffff, min_delta + new.blue);
<a id='L9472' name='L9472'></a>  9472         <em class='brace'>}</em>
<a id='L9473' name='L9473'></a>  9473     <em class='brace'>}</em>
<a id='L9474' name='L9474'></a>  9474 
<a id='L9475' name='L9475'></a>  9475   <em class='comment'>/* Try to allocate the color.  */</em>
<a id='L9476' name='L9476'></a>  9476   success_p = <a href='../S/2289.html#L9360' title='Defined at 9360 in src/xterm.c.'>x_alloc_nearest_color</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, cmap, &amp;new);
<a id='L9477' name='L9477'></a>  9477   <strong class='reserved'>if</strong> (success_p)
<a id='L9478' name='L9478'></a>  9478     <em class='brace'>{</em>
<a id='L9479' name='L9479'></a>  9479       <strong class='reserved'>if</strong> (new.pixel == *pixel)
<a id='L9480' name='L9480'></a>  9480         <em class='brace'>{</em>
<a id='L9481' name='L9481'></a>  9481           <em class='comment'>/* If we end up with the same color as before, try adding</em>
<a id='L9482' name='L9482'></a>  9482 <em class='comment'>             delta to the RGB values.  */</em>
<a id='L9483' name='L9483'></a>  9483           <a href='../S/2239.html#L482' title='Defined at 482 in src/xfaces.c.'>x_free_colors</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, &amp;new.pixel, 1);
<a id='L9484' name='L9484'></a>  9484 
<a id='L9485' name='L9485'></a>  9485           new.red = <a href='../D/14475.html' title='Multiple defined in 11 places.'>min</a> (0xffff, delta + color.red);
<a id='L9486' name='L9486'></a>  9486           new.green = <a href='../D/14475.html' title='Multiple defined in 11 places.'>min</a> (0xffff, delta + color.green);
<a id='L9487' name='L9487'></a>  9487           new.blue = <a href='../D/14475.html' title='Multiple defined in 11 places.'>min</a> (0xffff, delta + color.blue);
<a id='L9488' name='L9488'></a>  9488           success_p = <a href='../S/2289.html#L9360' title='Defined at 9360 in src/xterm.c.'>x_alloc_nearest_color</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, cmap, &amp;new);
<a id='L9489' name='L9489'></a>  9489         <em class='brace'>}</em>
<a id='L9490' name='L9490'></a>  9490       <strong class='reserved'>else</strong>
<a id='L9491' name='L9491'></a>  9491         success_p = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L9492' name='L9492'></a>  9492       *pixel = new.pixel;
<a id='L9493' name='L9493'></a>  9493     <em class='brace'>}</em>
<a id='L9494' name='L9494'></a>  9494 
<a id='L9495' name='L9495'></a>  9495   <strong class='reserved'>return</strong> success_p;
<a id='L9496' name='L9496'></a>  9496 <em class='brace'>}</em>
<a id='L9497' name='L9497'></a>  9497 
<a id='L9498' name='L9498'></a>  9498 
<a id='L9499' name='L9499'></a>  9499 <em class='comment'>/* Set up the foreground color for drawing relief lines of glyph</em>
<a id='L9500' name='L9500'></a>  9500 <em class='comment'>   string S.  RELIEF is a pointer to a struct relief containing the GC</em>
<a id='L9501' name='L9501'></a>  9501 <em class='comment'>   with which lines will be drawn.  Use a color that is FACTOR or</em>
<a id='L9502' name='L9502'></a>  9502 <em class='comment'>   DELTA lighter or darker than the relief's background which is found</em>
<a id='L9503' name='L9503'></a>  9503 <em class='comment'>   in S-&gt;f-&gt;output_data.x-&gt;relief_background.  If such a color cannot</em>
<a id='L9504' name='L9504'></a>  9504 <em class='comment'>   be allocated, use DEFAULT_PIXEL, instead.  */</em>
<a id='L9505' name='L9505'></a>  9505 
<a id='L9506' name='L9506'></a>  9506 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L9507' name='L9507'></a>  9507 <a href='../R/18336.html' title='Multiple referred from 2 places.'>x_setup_relief_color</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <strong class='reserved'>struct</strong> <a href='../D/16285.html' title='Multiple defined in 4 places.'>relief</a> *<a href='../D/16285.html' title='Multiple defined in 4 places.'>relief</a>, <strong class='reserved'>double</strong> factor,
<a id='L9508' name='L9508'></a>  9508                       <strong class='reserved'>int</strong> delta, <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> default_pixel)
<a id='L9509' name='L9509'></a>  9509 <em class='brace'>{</em>
<a id='L9510' name='L9510'></a>  9510   XGCValues xgcv;
<a id='L9511' name='L9511'></a>  9511   <strong class='reserved'>struct</strong> <a href='../D/19627.html' title='Multiple defined in 5 places.'>x_output</a> *di = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L9512' name='L9512'></a>  9512   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> mask = <a href='../S/2315.html#L89' title='Defined at 89 in src/dispextern.h.'>GCForeground</a> | GCLineWidth | <a href='../D/2628.html' title='Multiple defined in 5 places.'>GCGraphicsExposures</a>;
<a id='L9513' name='L9513'></a>  9513   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> pixel;
<a id='L9514' name='L9514'></a>  9514   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> background = di-&gt;relief_background;
<a id='L9515' name='L9515'></a>  9515   Colormap cmap = <a href='../S/2212.html#L1468' title='Defined at 1468 in src/xterm.h.'>FRAME_X_COLORMAP</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L9516' name='L9516'></a>  9516   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L9517' name='L9517'></a>  9517   <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy = <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L9518' name='L9518'></a>  9518 
<a id='L9519' name='L9519'></a>  9519   xgcv.graphics_exposures = False;
<a id='L9520' name='L9520'></a>  9520   xgcv.line_width = 1;
<a id='L9521' name='L9521'></a>  9521 
<a id='L9522' name='L9522'></a>  9522   <em class='comment'>/* Free previously allocated color.  The color cell will be reused</em>
<a id='L9523' name='L9523'></a>  9523 <em class='comment'>     when it has been freed as many times as it was allocated, so this</em>
<a id='L9524' name='L9524'></a>  9524 <em class='comment'>     doesn't affect faces using the same colors.  */</em>
<a id='L9525' name='L9525'></a>  9525   <strong class='reserved'>if</strong> (<a href='../D/16285.html' title='Multiple defined in 4 places.'>relief</a>-&gt;gc &amp;&amp; <a href='../D/16285.html' title='Multiple defined in 4 places.'>relief</a>-&gt;pixel != -1)
<a id='L9526' name='L9526'></a>  9526     <em class='brace'>{</em>
<a id='L9527' name='L9527'></a>  9527       <a href='../S/2239.html#L482' title='Defined at 482 in src/xfaces.c.'>x_free_colors</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, &amp;<a href='../D/16285.html' title='Multiple defined in 4 places.'>relief</a>-&gt;pixel, 1);
<a id='L9528' name='L9528'></a>  9528       <a href='../D/16285.html' title='Multiple defined in 4 places.'>relief</a>-&gt;pixel = -1;
<a id='L9529' name='L9529'></a>  9529     <em class='brace'>}</em>
<a id='L9530' name='L9530'></a>  9530 
<a id='L9531' name='L9531'></a>  9531   <em class='comment'>/* Allocate new color.  */</em>
<a id='L9532' name='L9532'></a>  9532   xgcv.foreground = default_pixel;
<a id='L9533' name='L9533'></a>  9533   pixel = background;
<a id='L9534' name='L9534'></a>  9534   <strong class='reserved'>if</strong> (dpyinfo-&gt;n_planes != 1
<a id='L9535' name='L9535'></a>  9535       &amp;&amp; <a href='../S/2289.html#L9430' title='Defined at 9430 in src/xterm.c.'>x_alloc_lighter_color</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, dpy, cmap, &amp;pixel, factor, delta))
<a id='L9536' name='L9536'></a>  9536     xgcv.foreground = <a href='../D/16285.html' title='Multiple defined in 4 places.'>relief</a>-&gt;pixel = pixel;
<a id='L9537' name='L9537'></a>  9537 
<a id='L9538' name='L9538'></a>  9538   <strong class='reserved'>if</strong> (<a href='../D/16285.html' title='Multiple defined in 4 places.'>relief</a>-&gt;gc == 0)
<a id='L9539' name='L9539'></a>  9539     <em class='brace'>{</em>
<a id='L9540' name='L9540'></a>  9540       xgcv.stipple = dpyinfo-&gt;gray;
<a id='L9541' name='L9541'></a>  9541       mask |= GCStipple;
<a id='L9542' name='L9542'></a>  9542       <a href='../D/16285.html' title='Multiple defined in 4 places.'>relief</a>-&gt;gc = <a href='../S/2215.html#L260' title='Defined at 260 in src/w32term.c.'>XCreateGC</a> (dpy, <a href='../S/2212.html#L1352' title='Defined at 1352 in src/xterm.h.'>FRAME_X_DRAWABLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), mask, &amp;xgcv);
<a id='L9543' name='L9543'></a>  9543     <em class='brace'>}</em>
<a id='L9544' name='L9544'></a>  9544   <strong class='reserved'>else</strong>
<a id='L9545' name='L9545'></a>  9545     <a href='../S/2215.html#L250' title='Defined at 250 in src/w32term.c.'>XChangeGC</a> (dpy, <a href='../D/16285.html' title='Multiple defined in 4 places.'>relief</a>-&gt;gc, mask, &amp;xgcv);
<a id='L9546' name='L9546'></a>  9546 <em class='brace'>}</em>
<a id='L9547' name='L9547'></a>  9547 
<a id='L9548' name='L9548'></a>  9548 
<a id='L9549' name='L9549'></a>  9549 <em class='comment'>/* Set up colors for the relief lines around glyph string S.  */</em>
<a id='L9550' name='L9550'></a>  9550 
<a id='L9551' name='L9551'></a>  9551 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L9552' name='L9552'></a>  9552 <a href='../R/18337.html' title='Multiple referred from 2 places.'>x_setup_relief_colors</a> (<strong class='reserved'>struct</strong> <a href='../S/2315.html#L1336' title='Defined at 1336 in src/dispextern.h.'>glyph_string</a> *s)
<a id='L9553' name='L9553'></a>  9553 <em class='brace'>{</em>
<a id='L9554' name='L9554'></a>  9554   <strong class='reserved'>struct</strong> <a href='../D/19627.html' title='Multiple defined in 5 places.'>x_output</a> *di = s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L9555' name='L9555'></a>  9555   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> color;
<a id='L9556' name='L9556'></a>  9556 
<a id='L9557' name='L9557'></a>  9557   <strong class='reserved'>if</strong> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;use_box_color_for_shadows_p)
<a id='L9558' name='L9558'></a>  9558     color = s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;box_color;
<a id='L9559' name='L9559'></a>  9559   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (s-&gt;first_glyph-&gt;type == <a href='../S/2315.html#L425' title='Defined at 425 in src/dispextern.h.'>IMAGE_GLYPH</a>
<a id='L9560' name='L9560'></a>  9560            &amp;&amp; s-&gt;img-&gt;pixmap
<a id='L9561' name='L9561'></a>  9561            &amp;&amp; !<a href='../S/2315.html#L3727' title='Defined at 3727 in src/dispextern.h.'>IMAGE_BACKGROUND_TRANSPARENT</a> (s-&gt;img, s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 0))
<a id='L9562' name='L9562'></a>  9562     color = <a href='../S/2315.html#L3718' title='Defined at 3718 in src/dispextern.h.'>IMAGE_BACKGROUND</a> (s-&gt;img, s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 0);
<a id='L9563' name='L9563'></a>  9563   <strong class='reserved'>else</strong>
<a id='L9564' name='L9564'></a>  9564     <em class='brace'>{</em>
<a id='L9565' name='L9565'></a>  9565       XGCValues xgcv;
<a id='L9566' name='L9566'></a>  9566 
<a id='L9567' name='L9567'></a>  9567       <em class='comment'>/* Get the background color of the face.  */</em>
<a id='L9568' name='L9568'></a>  9568       <a href='../S/2215.html#L271' title='Defined at 271 in src/w32term.c.'>XGetGCValues</a> (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), s-&gt;gc, <a href='../S/2315.html#L90' title='Defined at 90 in src/dispextern.h.'>GCBackground</a>, &amp;xgcv);
<a id='L9569' name='L9569'></a>  9569       color = xgcv.background;
<a id='L9570' name='L9570'></a>  9570     <em class='brace'>}</em>
<a id='L9571' name='L9571'></a>  9571 
<a id='L9572' name='L9572'></a>  9572   <strong class='reserved'>if</strong> (di-&gt;white_relief.gc == 0
<a id='L9573' name='L9573'></a>  9573       || color != di-&gt;relief_background)
<a id='L9574' name='L9574'></a>  9574     <em class='brace'>{</em>
<a id='L9575' name='L9575'></a>  9575       di-&gt;relief_background = color;
<a id='L9576' name='L9576'></a>  9576       <a href='../S/2289.html#L9507' title='Defined at 9507 in src/xterm.c.'>x_setup_relief_color</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, &amp;di-&gt;white_relief, 1.2, 0x8000,
<a id='L9577' name='L9577'></a>  9577                             <a href='../D/6781.html' title='Multiple defined in 5 places.'>WHITE_PIX_DEFAULT</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L9578' name='L9578'></a>  9578       <a href='../S/2289.html#L9507' title='Defined at 9507 in src/xterm.c.'>x_setup_relief_color</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, &amp;di-&gt;black_relief, 0.6, 0x4000,
<a id='L9579' name='L9579'></a>  9579                             <a href='../D/423.html' title='Multiple defined in 5 places.'>BLACK_PIX_DEFAULT</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L9580' name='L9580'></a>  9580     <em class='brace'>}</em>
<a id='L9581' name='L9581'></a>  9581 <em class='brace'>}</em>
<a id='L9582' name='L9582'></a>  9582 
<a id='L9583' name='L9583'></a>  9583 <em class='sharp'>#ifndef</em> USE_CAIRO
<a id='L9584' name='L9584'></a>  9584 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L9585' name='L9585'></a>  9585 <a href='../R/18185.html' title='Multiple referred from 2 places.'>x_fill_triangle</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/2619.html' title='Multiple defined in 2 places.'>GC</a> gc, XPoint point1,
<a id='L9586' name='L9586'></a>  9586                  XPoint point2, XPoint point3)
<a id='L9587' name='L9587'></a>  9587 <em class='brace'>{</em>
<a id='L9588' name='L9588'></a>  9588   XPoint <a href='../D/8271.html' title='Multiple defined in 2 places.'>abc</a>[3];
<a id='L9589' name='L9589'></a>  9589 
<a id='L9590' name='L9590'></a>  9590   <a href='../D/8271.html' title='Multiple defined in 2 places.'>abc</a>[0] = point1;
<a id='L9591' name='L9591'></a>  9591   <a href='../D/8271.html' title='Multiple defined in 2 places.'>abc</a>[1] = point2;
<a id='L9592' name='L9592'></a>  9592   <a href='../D/8271.html' title='Multiple defined in 2 places.'>abc</a>[2] = point3;
<a id='L9593' name='L9593'></a>  9593 
<a id='L9594' name='L9594'></a>  9594   XFillPolygon (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../S/2212.html#L1352' title='Defined at 1352 in src/xterm.h.'>FRAME_X_DRAWABLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L9595' name='L9595'></a>  9595                 gc, <a href='../D/8271.html' title='Multiple defined in 2 places.'>abc</a>, 3, Convex, CoordModeOrigin);
<a id='L9596' name='L9596'></a>  9596 <em class='brace'>}</em>
<a id='L9597' name='L9597'></a>  9597 
<a id='L9598' name='L9598'></a>  9598 <strong class='reserved'>static</strong> XPoint
<a id='L9599' name='L9599'></a>  9599 <a href='../R/18245.html' title='Multiple referred from 6 places.'>x_make_point</a> (<strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, <strong class='reserved'>int</strong> y)
<a id='L9600' name='L9600'></a>  9600 <em class='brace'>{</em>
<a id='L9601' name='L9601'></a>  9601   XPoint pt;
<a id='L9602' name='L9602'></a>  9602 
<a id='L9603' name='L9603'></a>  9603   pt.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L9604' name='L9604'></a>  9604   pt.y = y;
<a id='L9605' name='L9605'></a>  9605 
<a id='L9606' name='L9606'></a>  9606   <strong class='reserved'>return</strong> pt;
<a id='L9607' name='L9607'></a>  9607 <em class='brace'>}</em>
<a id='L9608' name='L9608'></a>  9608 
<a id='L9609' name='L9609'></a>  9609 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L9610' name='L9610'></a>  9610 <a href='../R/18240.html' title='Multiple referred from 4 places.'>x_inside_rect_p</a> (<a href='../S/2150.html#L62' title='Defined at 62 in src/pgtkgui.h.'>XRectangle</a> *rects, <strong class='reserved'>int</strong> nrects, <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, <strong class='reserved'>int</strong> y)
<a id='L9611' name='L9611'></a>  9611 <em class='brace'>{</em>
<a id='L9612' name='L9612'></a>  9612   <strong class='reserved'>int</strong> i;
<a id='L9613' name='L9613'></a>  9613 
<a id='L9614' name='L9614'></a>  9614   <strong class='reserved'>for</strong> (i = 0; i &lt; nrects; ++i)
<a id='L9615' name='L9615'></a>  9615     <em class='brace'>{</em>
<a id='L9616' name='L9616'></a>  9616       <strong class='reserved'>if</strong> (<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> &gt;= rects[i].<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> &amp;&amp; y &gt;= rects[i].y
<a id='L9617' name='L9617'></a>  9617           &amp;&amp; <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> &lt; rects[i].<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + rects[i].width
<a id='L9618' name='L9618'></a>  9618           &amp;&amp; y &lt; rects[i].y + rects[i].height)
<a id='L9619' name='L9619'></a>  9619         <strong class='reserved'>return</strong> <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L9620' name='L9620'></a>  9620     <em class='brace'>}</em>
<a id='L9621' name='L9621'></a>  9621 
<a id='L9622' name='L9622'></a>  9622   <strong class='reserved'>return</strong> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L9623' name='L9623'></a>  9623 <em class='brace'>}</em>
<a id='L9624' name='L9624'></a>  9624 <em class='sharp'>#endif</em>
<a id='L9625' name='L9625'></a>  9625 
<a id='L9626' name='L9626'></a>  9626 <em class='comment'>/* Draw a relief on frame F inside the rectangle given by LEFT_X,</em>
<a id='L9627' name='L9627'></a>  9627 <em class='comment'>   TOP_Y, RIGHT_X, and BOTTOM_Y.  VWIDTH and HWIDTH are respectively</em>
<a id='L9628' name='L9628'></a>  9628 <em class='comment'>   the thickness of the vertical relief (left and right) and</em>
<a id='L9629' name='L9629'></a>  9629 <em class='comment'>   horizontal relief (top and bottom) to draw, it must be &gt;= 0.</em>
<a id='L9630' name='L9630'></a>  9630 <em class='comment'>   RAISED_P means draw a raised relief.  LEFT_P means draw a relief on</em>
<a id='L9631' name='L9631'></a>  9631 <em class='comment'>   the left side of the rectangle.  RIGHT_P means draw a relief on the</em>
<a id='L9632' name='L9632'></a>  9632 <em class='comment'>   right side of the rectangle.  CLIP_RECT is the clipping rectangle</em>
<a id='L9633' name='L9633'></a>  9633 <em class='comment'>   to use when drawing.  */</em>
<a id='L9634' name='L9634'></a>  9634 
<a id='L9635' name='L9635'></a>  9635 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L9636' name='L9636'></a>  9636 <a href='../R/18165.html' title='Multiple referred from 2 places.'>x_draw_relief_rect</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <strong class='reserved'>int</strong> left_x, <strong class='reserved'>int</strong> top_y, <strong class='reserved'>int</strong> right_x,
<a id='L9637' name='L9637'></a>  9637                     <strong class='reserved'>int</strong> bottom_y, <strong class='reserved'>int</strong> hwidth, <strong class='reserved'>int</strong> vwidth, <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> raised_p,
<a id='L9638' name='L9638'></a>  9638                     <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> top_p, <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> bot_p, <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> left_p, <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> right_p,
<a id='L9639' name='L9639'></a>  9639                     <a href='../S/2150.html#L62' title='Defined at 62 in src/pgtkgui.h.'>XRectangle</a> *clip_rect)
<a id='L9640' name='L9640'></a>  9640 <em class='brace'>{</em>
<a id='L9641' name='L9641'></a>  9641 <em class='sharp'>#ifdef</em> USE_CAIRO
<a id='L9642' name='L9642'></a>  9642   <a href='../D/2619.html' title='Multiple defined in 2 places.'>GC</a> top_left_gc, bottom_right_gc;
<a id='L9643' name='L9643'></a>  9643   <strong class='reserved'>int</strong> <a href='../D/10126.html' title='Multiple defined in 2 places.'>corners</a> = 0;
<a id='L9644' name='L9644'></a>  9644 
<a id='L9645' name='L9645'></a>  9645   <strong class='reserved'>if</strong> (raised_p)
<a id='L9646' name='L9646'></a>  9646     <em class='brace'>{</em>
<a id='L9647' name='L9647'></a>  9647       top_left_gc = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;white_relief.gc;
<a id='L9648' name='L9648'></a>  9648       bottom_right_gc = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;black_relief.gc;
<a id='L9649' name='L9649'></a>  9649     <em class='brace'>}</em>
<a id='L9650' name='L9650'></a>  9650   <strong class='reserved'>else</strong>
<a id='L9651' name='L9651'></a>  9651     <em class='brace'>{</em>
<a id='L9652' name='L9652'></a>  9652       top_left_gc = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;black_relief.gc;
<a id='L9653' name='L9653'></a>  9653       bottom_right_gc = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;white_relief.gc;
<a id='L9654' name='L9654'></a>  9654     <em class='brace'>}</em>
<a id='L9655' name='L9655'></a>  9655 
<a id='L9656' name='L9656'></a>  9656   <a href='../S/2289.html#L6374' title='Defined at 6374 in src/xterm.c.'>x_set_clip_rectangles</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, top_left_gc, clip_rect, 1);
<a id='L9657' name='L9657'></a>  9657   <a href='../S/2289.html#L6374' title='Defined at 6374 in src/xterm.c.'>x_set_clip_rectangles</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, bottom_right_gc, clip_rect, 1);
<a id='L9658' name='L9658'></a>  9658 
<a id='L9659' name='L9659'></a>  9659   <strong class='reserved'>if</strong> (left_p)
<a id='L9660' name='L9660'></a>  9660     <em class='brace'>{</em>
<a id='L9661' name='L9661'></a>  9661       <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, top_left_gc, left_x, top_y,
<a id='L9662' name='L9662'></a>  9662                         vwidth, bottom_y + 1 - top_y, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L9663' name='L9663'></a>  9663       <strong class='reserved'>if</strong> (top_p)
<a id='L9664' name='L9664'></a>  9664         <a href='../D/10126.html' title='Multiple defined in 2 places.'>corners</a> |= 1 &lt;&lt; <a href='../D/1250.html' title='Multiple defined in 2 places.'>CORNER_TOP_LEFT</a>;
<a id='L9665' name='L9665'></a>  9665       <strong class='reserved'>if</strong> (bot_p)
<a id='L9666' name='L9666'></a>  9666         <a href='../D/10126.html' title='Multiple defined in 2 places.'>corners</a> |= 1 &lt;&lt; <a href='../D/1247.html' title='Multiple defined in 2 places.'>CORNER_BOTTOM_LEFT</a>;
<a id='L9667' name='L9667'></a>  9667     <em class='brace'>}</em>
<a id='L9668' name='L9668'></a>  9668   <strong class='reserved'>if</strong> (right_p)
<a id='L9669' name='L9669'></a>  9669     <em class='brace'>{</em>
<a id='L9670' name='L9670'></a>  9670       <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, bottom_right_gc, right_x + 1 - vwidth, top_y,
<a id='L9671' name='L9671'></a>  9671                         vwidth, bottom_y + 1 - top_y, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L9672' name='L9672'></a>  9672       <strong class='reserved'>if</strong> (top_p)
<a id='L9673' name='L9673'></a>  9673         <a href='../D/10126.html' title='Multiple defined in 2 places.'>corners</a> |= 1 &lt;&lt; <a href='../D/1251.html' title='Multiple defined in 2 places.'>CORNER_TOP_RIGHT</a>;
<a id='L9674' name='L9674'></a>  9674       <strong class='reserved'>if</strong> (bot_p)
<a id='L9675' name='L9675'></a>  9675         <a href='../D/10126.html' title='Multiple defined in 2 places.'>corners</a> |= 1 &lt;&lt; <a href='../D/1248.html' title='Multiple defined in 2 places.'>CORNER_BOTTOM_RIGHT</a>;
<a id='L9676' name='L9676'></a>  9676     <em class='brace'>}</em>
<a id='L9677' name='L9677'></a>  9677   <strong class='reserved'>if</strong> (top_p)
<a id='L9678' name='L9678'></a>  9678     <em class='brace'>{</em>
<a id='L9679' name='L9679'></a>  9679       <strong class='reserved'>if</strong> (!right_p)
<a id='L9680' name='L9680'></a>  9680         <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, top_left_gc, left_x, top_y,
<a id='L9681' name='L9681'></a>  9681                           right_x + 1 - left_x, hwidth, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L9682' name='L9682'></a>  9682       <strong class='reserved'>else</strong>
<a id='L9683' name='L9683'></a>  9683         <a href='../S/2289.html#L6671' title='Defined at 6671 in src/xterm.c.'>x_fill_trapezoid_for_relief</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, top_left_gc, left_x, top_y,
<a id='L9684' name='L9684'></a>  9684                                      right_x + 1 - left_x, hwidth, 1);
<a id='L9685' name='L9685'></a>  9685     <em class='brace'>}</em>
<a id='L9686' name='L9686'></a>  9686   <strong class='reserved'>if</strong> (bot_p)
<a id='L9687' name='L9687'></a>  9687     <em class='brace'>{</em>
<a id='L9688' name='L9688'></a>  9688       <strong class='reserved'>if</strong> (!left_p)
<a id='L9689' name='L9689'></a>  9689         <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, bottom_right_gc, left_x, bottom_y + 1 - hwidth,
<a id='L9690' name='L9690'></a>  9690                           right_x + 1 - left_x, hwidth, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L9691' name='L9691'></a>  9691       <strong class='reserved'>else</strong>
<a id='L9692' name='L9692'></a>  9692         <a href='../S/2289.html#L6671' title='Defined at 6671 in src/xterm.c.'>x_fill_trapezoid_for_relief</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, bottom_right_gc,
<a id='L9693' name='L9693'></a>  9693                                      left_x, bottom_y + 1 - hwidth,
<a id='L9694' name='L9694'></a>  9694                                      right_x + 1 - left_x, hwidth, 0);
<a id='L9695' name='L9695'></a>  9695     <em class='brace'>}</em>
<a id='L9696' name='L9696'></a>  9696   <strong class='reserved'>if</strong> (left_p &amp;&amp; vwidth &gt; 1)
<a id='L9697' name='L9697'></a>  9697     <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, bottom_right_gc, left_x, top_y,
<a id='L9698' name='L9698'></a>  9698                       1, bottom_y + 1 - top_y, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L9699' name='L9699'></a>  9699   <strong class='reserved'>if</strong> (top_p &amp;&amp; hwidth &gt; 1)
<a id='L9700' name='L9700'></a>  9700     <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, bottom_right_gc, left_x, top_y,
<a id='L9701' name='L9701'></a>  9701                       right_x + 1 - left_x, 1, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L9702' name='L9702'></a>  9702   <strong class='reserved'>if</strong> (<a href='../D/10126.html' title='Multiple defined in 2 places.'>corners</a>)
<a id='L9703' name='L9703'></a>  9703     <em class='brace'>{</em>
<a id='L9704' name='L9704'></a>  9704       XSetBackground (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), top_left_gc,
<a id='L9705' name='L9705'></a>  9705                       <a href='../S/2183.html#L1377' title='Defined at 1377 in src/frame.h.'>FRAME_BACKGROUND_PIXEL</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L9706' name='L9706'></a>  9706       <a href='../S/2289.html#L6696' title='Defined at 6696 in src/xterm.c.'>x_erase_corners_for_relief</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, top_left_gc, left_x, top_y,
<a id='L9707' name='L9707'></a>  9707                                   right_x - left_x + 1, bottom_y - top_y + 1,
<a id='L9708' name='L9708'></a>  9708                                   6, 1, <a href='../D/10126.html' title='Multiple defined in 2 places.'>corners</a>);
<a id='L9709' name='L9709'></a>  9709     <em class='brace'>}</em>
<a id='L9710' name='L9710'></a>  9710 
<a id='L9711' name='L9711'></a>  9711   <a href='../S/2289.html#L6390' title='Defined at 6390 in src/xterm.c.'>x_reset_clip_rectangles</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, top_left_gc);
<a id='L9712' name='L9712'></a>  9712   <a href='../S/2289.html#L6390' title='Defined at 6390 in src/xterm.c.'>x_reset_clip_rectangles</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, bottom_right_gc);
<a id='L9713' name='L9713'></a>  9713 <em class='sharp'>#else</em>
<a id='L9714' name='L9714'></a>  9714   <a href='../D/2619.html' title='Multiple defined in 2 places.'>GC</a> gc, white_gc, black_gc, normal_gc;
<a id='L9715' name='L9715'></a>  9715   <a href='../D/1653.html' title='Multiple defined in 2 places.'>Drawable</a> drawable;
<a id='L9716' name='L9716'></a>  9716   <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy;
<a id='L9717' name='L9717'></a>  9717 
<a id='L9718' name='L9718'></a>  9718   <em class='comment'>/* This code is more complicated than it has to be, because of two</em>
<a id='L9719' name='L9719'></a>  9719 <em class='comment'>     minor hacks to make the boxes look nicer: (i) if width &gt; 1, draw</em>
<a id='L9720' name='L9720'></a>  9720 <em class='comment'>     the outermost line using the black relief.  (ii) Omit the four</em>
<a id='L9721' name='L9721'></a>  9721 <em class='comment'>     corner pixels.  */</em>
<a id='L9722' name='L9722'></a>  9722 
<a id='L9723' name='L9723'></a>  9723   white_gc = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;white_relief.gc;
<a id='L9724' name='L9724'></a>  9724   black_gc = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;black_relief.gc;
<a id='L9725' name='L9725'></a>  9725   normal_gc = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;normal_gc;
<a id='L9726' name='L9726'></a>  9726 
<a id='L9727' name='L9727'></a>  9727   drawable = <a href='../S/2212.html#L1352' title='Defined at 1352 in src/xterm.h.'>FRAME_X_DRAWABLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L9728' name='L9728'></a>  9728   dpy = <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L9729' name='L9729'></a>  9729 
<a id='L9730' name='L9730'></a>  9730   <a href='../S/2289.html#L6374' title='Defined at 6374 in src/xterm.c.'>x_set_clip_rectangles</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, white_gc, clip_rect, 1);
<a id='L9731' name='L9731'></a>  9731   <a href='../S/2289.html#L6374' title='Defined at 6374 in src/xterm.c.'>x_set_clip_rectangles</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, black_gc, clip_rect, 1);
<a id='L9732' name='L9732'></a>  9732 
<a id='L9733' name='L9733'></a>  9733   <strong class='reserved'>if</strong> (raised_p)
<a id='L9734' name='L9734'></a>  9734     gc = white_gc;
<a id='L9735' name='L9735'></a>  9735   <strong class='reserved'>else</strong>
<a id='L9736' name='L9736'></a>  9736     gc = black_gc;
<a id='L9737' name='L9737'></a>  9737 
<a id='L9738' name='L9738'></a>  9738   <em class='comment'>/* Draw lines.  */</em>
<a id='L9739' name='L9739'></a>  9739 
<a id='L9740' name='L9740'></a>  9740   <strong class='reserved'>if</strong> (top_p)
<a id='L9741' name='L9741'></a>  9741     <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, left_x, top_y,
<a id='L9742' name='L9742'></a>  9742                       right_x - left_x + 1, hwidth,
<a id='L9743' name='L9743'></a>  9743                       <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L9744' name='L9744'></a>  9744 
<a id='L9745' name='L9745'></a>  9745   <strong class='reserved'>if</strong> (left_p)
<a id='L9746' name='L9746'></a>  9746     <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, left_x, top_y, vwidth,
<a id='L9747' name='L9747'></a>  9747                       bottom_y - top_y + 1, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L9748' name='L9748'></a>  9748 
<a id='L9749' name='L9749'></a>  9749   <strong class='reserved'>if</strong> (raised_p)
<a id='L9750' name='L9750'></a>  9750     gc = black_gc;
<a id='L9751' name='L9751'></a>  9751   <strong class='reserved'>else</strong>
<a id='L9752' name='L9752'></a>  9752     gc = white_gc;
<a id='L9753' name='L9753'></a>  9753 
<a id='L9754' name='L9754'></a>  9754   <strong class='reserved'>if</strong> (bot_p)
<a id='L9755' name='L9755'></a>  9755     <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, left_x, bottom_y - hwidth + 1,
<a id='L9756' name='L9756'></a>  9756                       right_x - left_x + 1, hwidth, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L9757' name='L9757'></a>  9757 
<a id='L9758' name='L9758'></a>  9758   <strong class='reserved'>if</strong> (right_p)
<a id='L9759' name='L9759'></a>  9759     <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, right_x - vwidth + 1, top_y,
<a id='L9760' name='L9760'></a>  9760                       vwidth, bottom_y - top_y + 1, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L9761' name='L9761'></a>  9761 
<a id='L9762' name='L9762'></a>  9762   <em class='comment'>/* Draw corners.  */</em>
<a id='L9763' name='L9763'></a>  9763 
<a id='L9764' name='L9764'></a>  9764   <strong class='reserved'>if</strong> (bot_p &amp;&amp; left_p)
<a id='L9765' name='L9765'></a>  9765     <a href='../S/2289.html#L9585' title='Defined at 9585 in src/xterm.c.'>x_fill_triangle</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, raised_p ? white_gc : black_gc,
<a id='L9766' name='L9766'></a>  9766                      <a href='../S/2289.html#L9599' title='Defined at 9599 in src/xterm.c.'>x_make_point</a> (left_x, bottom_y - hwidth),
<a id='L9767' name='L9767'></a>  9767                      <a href='../S/2289.html#L9599' title='Defined at 9599 in src/xterm.c.'>x_make_point</a> (left_x + vwidth, bottom_y - hwidth),
<a id='L9768' name='L9768'></a>  9768                      <a href='../S/2289.html#L9599' title='Defined at 9599 in src/xterm.c.'>x_make_point</a> (left_x, bottom_y));
<a id='L9769' name='L9769'></a>  9769 
<a id='L9770' name='L9770'></a>  9770   <strong class='reserved'>if</strong> (top_p &amp;&amp; right_p)
<a id='L9771' name='L9771'></a>  9771     <a href='../S/2289.html#L9585' title='Defined at 9585 in src/xterm.c.'>x_fill_triangle</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, raised_p ? white_gc : black_gc,
<a id='L9772' name='L9772'></a>  9772                      <a href='../S/2289.html#L9599' title='Defined at 9599 in src/xterm.c.'>x_make_point</a> (right_x - vwidth, top_y),
<a id='L9773' name='L9773'></a>  9773                      <a href='../S/2289.html#L9599' title='Defined at 9599 in src/xterm.c.'>x_make_point</a> (right_x, top_y),
<a id='L9774' name='L9774'></a>  9774                      <a href='../S/2289.html#L9599' title='Defined at 9599 in src/xterm.c.'>x_make_point</a> (right_x - vwidth, top_y + hwidth));
<a id='L9775' name='L9775'></a>  9775 
<a id='L9776' name='L9776'></a>  9776   <em class='comment'>/* Draw outer line.  */</em>
<a id='L9777' name='L9777'></a>  9777 
<a id='L9778' name='L9778'></a>  9778   <strong class='reserved'>if</strong> (top_p &amp;&amp; left_p &amp;&amp; bot_p &amp;&amp; right_p
<a id='L9779' name='L9779'></a>  9779       &amp;&amp; hwidth &gt; 1 &amp;&amp; vwidth &gt; 1)
<a id='L9780' name='L9780'></a>  9780     <a href='../S/2289.html#L6625' title='Defined at 6625 in src/xterm.c.'>x_draw_rectangle</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, black_gc, left_x, top_y,
<a id='L9781' name='L9781'></a>  9781                       right_x - left_x, bottom_y - top_y);
<a id='L9782' name='L9782'></a>  9782   <strong class='reserved'>else</strong>
<a id='L9783' name='L9783'></a>  9783     <em class='brace'>{</em>
<a id='L9784' name='L9784'></a>  9784       <strong class='reserved'>if</strong> (top_p &amp;&amp; hwidth &gt; 1)
<a id='L9785' name='L9785'></a>  9785         XDrawLine (dpy, drawable, black_gc, left_x, top_y,
<a id='L9786' name='L9786'></a>  9786                    right_x + 1, top_y);
<a id='L9787' name='L9787'></a>  9787 
<a id='L9788' name='L9788'></a>  9788       <strong class='reserved'>if</strong> (bot_p &amp;&amp; hwidth &gt; 1)
<a id='L9789' name='L9789'></a>  9789         XDrawLine (dpy, drawable, black_gc, left_x, bottom_y,
<a id='L9790' name='L9790'></a>  9790                    right_x + 1, bottom_y);
<a id='L9791' name='L9791'></a>  9791 
<a id='L9792' name='L9792'></a>  9792       <strong class='reserved'>if</strong> (left_p &amp;&amp; vwidth &gt; 1)
<a id='L9793' name='L9793'></a>  9793         XDrawLine (dpy, drawable, black_gc, left_x, top_y,
<a id='L9794' name='L9794'></a>  9794                    left_x, bottom_y + 1);
<a id='L9795' name='L9795'></a>  9795 
<a id='L9796' name='L9796'></a>  9796       <strong class='reserved'>if</strong> (right_p &amp;&amp; vwidth &gt; 1)
<a id='L9797' name='L9797'></a>  9797         XDrawLine (dpy, drawable, black_gc, right_x, top_y,
<a id='L9798' name='L9798'></a>  9798                    right_x, bottom_y + 1);
<a id='L9799' name='L9799'></a>  9799     <em class='brace'>}</em>
<a id='L9800' name='L9800'></a>  9800 
<a id='L9801' name='L9801'></a>  9801   <em class='comment'>/* Erase corners.  */</em>
<a id='L9802' name='L9802'></a>  9802 
<a id='L9803' name='L9803'></a>  9803   <strong class='reserved'>if</strong> (hwidth &gt; 1 &amp;&amp; vwidth &gt; 1)
<a id='L9804' name='L9804'></a>  9804     <em class='brace'>{</em>
<a id='L9805' name='L9805'></a>  9805       <strong class='reserved'>if</strong> (left_p &amp;&amp; top_p &amp;&amp; <a href='../S/2289.html#L9610' title='Defined at 9610 in src/xterm.c.'>x_inside_rect_p</a> (clip_rect, 1,
<a id='L9806' name='L9806'></a>  9806                                               left_x, top_y))
<a id='L9807' name='L9807'></a>  9807         <em class='comment'>/* This should respect `alpha-background' since it's being</em>
<a id='L9808' name='L9808'></a>  9808 <em class='comment'>           cleared with the background color of the frame.  */</em>
<a id='L9809' name='L9809'></a>  9809         <a href='../S/2289.html#L8372' title='Defined at 8372 in src/xterm.c.'>x_clear_point</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, normal_gc, left_x, top_y, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L9810' name='L9810'></a>  9810 
<a id='L9811' name='L9811'></a>  9811       <strong class='reserved'>if</strong> (left_p &amp;&amp; bot_p &amp;&amp; <a href='../S/2289.html#L9610' title='Defined at 9610 in src/xterm.c.'>x_inside_rect_p</a> (clip_rect, 1,
<a id='L9812' name='L9812'></a>  9812                                               left_x, bottom_y))
<a id='L9813' name='L9813'></a>  9813         <a href='../S/2289.html#L8372' title='Defined at 8372 in src/xterm.c.'>x_clear_point</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, normal_gc, left_x, bottom_y, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L9814' name='L9814'></a>  9814 
<a id='L9815' name='L9815'></a>  9815       <strong class='reserved'>if</strong> (right_p &amp;&amp; top_p &amp;&amp; <a href='../S/2289.html#L9610' title='Defined at 9610 in src/xterm.c.'>x_inside_rect_p</a> (clip_rect, 1,
<a id='L9816' name='L9816'></a>  9816                                                right_x, top_y))
<a id='L9817' name='L9817'></a>  9817         <a href='../S/2289.html#L8372' title='Defined at 8372 in src/xterm.c.'>x_clear_point</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, normal_gc, right_x, top_y, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L9818' name='L9818'></a>  9818 
<a id='L9819' name='L9819'></a>  9819       <strong class='reserved'>if</strong> (right_p &amp;&amp; bot_p &amp;&amp; <a href='../S/2289.html#L9610' title='Defined at 9610 in src/xterm.c.'>x_inside_rect_p</a> (clip_rect, 1,
<a id='L9820' name='L9820'></a>  9820                                                right_x, bottom_y))
<a id='L9821' name='L9821'></a>  9821         <a href='../S/2289.html#L8372' title='Defined at 8372 in src/xterm.c.'>x_clear_point</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, normal_gc, right_x, bottom_y, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L9822' name='L9822'></a>  9822     <em class='brace'>}</em>
<a id='L9823' name='L9823'></a>  9823 
<a id='L9824' name='L9824'></a>  9824   <a href='../S/2289.html#L6390' title='Defined at 6390 in src/xterm.c.'>x_reset_clip_rectangles</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, white_gc);
<a id='L9825' name='L9825'></a>  9825   <a href='../S/2289.html#L6390' title='Defined at 6390 in src/xterm.c.'>x_reset_clip_rectangles</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, black_gc);
<a id='L9826' name='L9826'></a>  9826 <em class='sharp'>#endif</em>
<a id='L9827' name='L9827'></a>  9827 <em class='brace'>}</em>
<a id='L9828' name='L9828'></a>  9828 
<a id='L9829' name='L9829'></a>  9829 
<a id='L9830' name='L9830'></a>  9830 <em class='comment'>/* Draw a box on frame F inside the rectangle given by LEFT_X, TOP_Y,</em>
<a id='L9831' name='L9831'></a>  9831 <em class='comment'>   RIGHT_X, and BOTTOM_Y.  WIDTH is the thickness of the lines to</em>
<a id='L9832' name='L9832'></a>  9832 <em class='comment'>   draw, it must be &gt;= 0.  LEFT_P means draw a line on the</em>
<a id='L9833' name='L9833'></a>  9833 <em class='comment'>   left side of the rectangle.  RIGHT_P means draw a line</em>
<a id='L9834' name='L9834'></a>  9834 <em class='comment'>   on the right side of the rectangle.  CLIP_RECT is the clipping</em>
<a id='L9835' name='L9835'></a>  9835 <em class='comment'>   rectangle to use when drawing.  */</em>
<a id='L9836' name='L9836'></a>  9836 
<a id='L9837' name='L9837'></a>  9837 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L9838' name='L9838'></a>  9838 <a href='../S/2289.html#L9933' title='Referred from 9933 in src/xterm.c.'>x_draw_box_rect</a> (<strong class='reserved'>struct</strong> <a href='../S/2315.html#L1336' title='Defined at 1336 in src/dispextern.h.'>glyph_string</a> *s,
<a id='L9839' name='L9839'></a>  9839                  <strong class='reserved'>int</strong> left_x, <strong class='reserved'>int</strong> top_y, <strong class='reserved'>int</strong> right_x, <strong class='reserved'>int</strong> bottom_y, <strong class='reserved'>int</strong> hwidth,
<a id='L9840' name='L9840'></a>  9840                  <strong class='reserved'>int</strong> vwidth, <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> left_p, <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> right_p, <a href='../S/2150.html#L62' title='Defined at 62 in src/pgtkgui.h.'>XRectangle</a> *clip_rect)
<a id='L9841' name='L9841'></a>  9841 <em class='brace'>{</em>
<a id='L9842' name='L9842'></a>  9842   <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> = <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L9843' name='L9843'></a>  9843   XGCValues xgcv;
<a id='L9844' name='L9844'></a>  9844 
<a id='L9845' name='L9845'></a>  9845   <a href='../S/2215.html#L271' title='Defined at 271 in src/w32term.c.'>XGetGCValues</a> (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, s-&gt;gc, <a href='../S/2315.html#L89' title='Defined at 89 in src/dispextern.h.'>GCForeground</a>, &amp;xgcv);
<a id='L9846' name='L9846'></a>  9846   XSetForeground (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, s-&gt;gc, s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;box_color);
<a id='L9847' name='L9847'></a>  9847   <a href='../S/2289.html#L6374' title='Defined at 6374 in src/xterm.c.'>x_set_clip_rectangles</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, s-&gt;gc, clip_rect, 1);
<a id='L9848' name='L9848'></a>  9848 
<a id='L9849' name='L9849'></a>  9849   <em class='comment'>/* Top.  */</em>
<a id='L9850' name='L9850'></a>  9850   <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, s-&gt;gc,
<a id='L9851' name='L9851'></a>  9851                     left_x, top_y, right_x - left_x + 1, hwidth,
<a id='L9852' name='L9852'></a>  9852                     <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L9853' name='L9853'></a>  9853 
<a id='L9854' name='L9854'></a>  9854   <em class='comment'>/* Left.  */</em>
<a id='L9855' name='L9855'></a>  9855   <strong class='reserved'>if</strong> (left_p)
<a id='L9856' name='L9856'></a>  9856     <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, s-&gt;gc,
<a id='L9857' name='L9857'></a>  9857                       left_x, top_y, vwidth, bottom_y - top_y + 1,
<a id='L9858' name='L9858'></a>  9858                       <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L9859' name='L9859'></a>  9859 
<a id='L9860' name='L9860'></a>  9860   <em class='comment'>/* Bottom.  */</em>
<a id='L9861' name='L9861'></a>  9861   <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, s-&gt;gc,
<a id='L9862' name='L9862'></a>  9862                     left_x, bottom_y - hwidth + 1, right_x - left_x + 1, hwidth,
<a id='L9863' name='L9863'></a>  9863                     <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L9864' name='L9864'></a>  9864 
<a id='L9865' name='L9865'></a>  9865   <em class='comment'>/* Right.  */</em>
<a id='L9866' name='L9866'></a>  9866   <strong class='reserved'>if</strong> (right_p)
<a id='L9867' name='L9867'></a>  9867     <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, s-&gt;gc,
<a id='L9868' name='L9868'></a>  9868                       right_x - vwidth + 1, top_y, vwidth, bottom_y - top_y + 1,
<a id='L9869' name='L9869'></a>  9869                       <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L9870' name='L9870'></a>  9870 
<a id='L9871' name='L9871'></a>  9871   XSetForeground (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, s-&gt;gc, xgcv.foreground);
<a id='L9872' name='L9872'></a>  9872   <a href='../S/2289.html#L6390' title='Defined at 6390 in src/xterm.c.'>x_reset_clip_rectangles</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, s-&gt;gc);
<a id='L9873' name='L9873'></a>  9873 <em class='brace'>}</em>
<a id='L9874' name='L9874'></a>  9874 
<a id='L9875' name='L9875'></a>  9875 
<a id='L9876' name='L9876'></a>  9876 <em class='comment'>/* Draw a box around glyph string S.  */</em>
<a id='L9877' name='L9877'></a>  9877 
<a id='L9878' name='L9878'></a>  9878 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L9879' name='L9879'></a>  9879 <a href='../R/18156.html' title='Multiple referred from 2 places.'>x_draw_glyph_string_box</a> (<strong class='reserved'>struct</strong> <a href='../S/2315.html#L1336' title='Defined at 1336 in src/dispextern.h.'>glyph_string</a> *s)
<a id='L9880' name='L9880'></a>  9880 <em class='brace'>{</em>
<a id='L9881' name='L9881'></a>  9881   <strong class='reserved'>int</strong> hwidth, vwidth, left_x, right_x, top_y, bottom_y, last_x;
<a id='L9882' name='L9882'></a>  9882   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> raised_p, left_p, right_p;
<a id='L9883' name='L9883'></a>  9883   <strong class='reserved'>struct</strong> <a href='../S/2315.html#L454' title='Defined at 454 in src/dispextern.h.'>glyph</a> *last_glyph;
<a id='L9884' name='L9884'></a>  9884   <a href='../S/2150.html#L62' title='Defined at 62 in src/pgtkgui.h.'>XRectangle</a> clip_rect;
<a id='L9885' name='L9885'></a>  9885 
<a id='L9886' name='L9886'></a>  9886   last_x = ((s-&gt;row-&gt;full_width_p &amp;&amp; !s-&gt;w-&gt;pseudo_window_p)
<a id='L9887' name='L9887'></a>  9887             ? <a href='../S/2317.html#L757' title='Defined at 757 in src/window.h.'>WINDOW_RIGHT_EDGE_X</a> (s-&gt;w)
<a id='L9888' name='L9888'></a>  9888             : <a href='../S/2224.html#L1405' title='Defined at 1405 in src/xdisp.c.'>window_box_right</a> (s-&gt;w, s-&gt;area));
<a id='L9889' name='L9889'></a>  9889 
<a id='L9890' name='L9890'></a>  9890   <em class='comment'>/* The glyph that may have a right box line.  For static</em>
<a id='L9891' name='L9891'></a>  9891 <em class='comment'>     compositions and images, the right-box flag is on the first glyph</em>
<a id='L9892' name='L9892'></a>  9892 <em class='comment'>     of the glyph string; for other types it's on the last glyph.  */</em>
<a id='L9893' name='L9893'></a>  9893   <strong class='reserved'>if</strong> (s-&gt;cmp || s-&gt;img)
<a id='L9894' name='L9894'></a>  9894     last_glyph = s-&gt;first_glyph;
<a id='L9895' name='L9895'></a>  9895   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (s-&gt;first_glyph-&gt;type == <a href='../S/2315.html#L419' title='Defined at 419 in src/dispextern.h.'>COMPOSITE_GLYPH</a>
<a id='L9896' name='L9896'></a>  9896            &amp;&amp; s-&gt;first_glyph-&gt;u.cmp.automatic)
<a id='L9897' name='L9897'></a>  9897     <em class='brace'>{</em>
<a id='L9898' name='L9898'></a>  9898       <em class='comment'>/* For automatic compositions, we need to look up the last glyph</em>
<a id='L9899' name='L9899'></a>  9899 <em class='comment'>         in the composition.  */</em>
<a id='L9900' name='L9900'></a>  9900         <strong class='reserved'>struct</strong> <a href='../S/2315.html#L454' title='Defined at 454 in src/dispextern.h.'>glyph</a> *end = s-&gt;row-&gt;glyphs[s-&gt;area] + s-&gt;row-&gt;used[s-&gt;area];
<a id='L9901' name='L9901'></a>  9901         <strong class='reserved'>struct</strong> <a href='../S/2315.html#L454' title='Defined at 454 in src/dispextern.h.'>glyph</a> *<a href='../S/4101.html#L90' title='Defined at 90 in test/manual/etags/cp-src/c.C.'>g</a> = s-&gt;first_glyph;
<a id='L9902' name='L9902'></a>  9902         <strong class='reserved'>for</strong> (last_glyph = <a href='../S/4101.html#L90' title='Defined at 90 in test/manual/etags/cp-src/c.C.'>g</a>++;
<a id='L9903' name='L9903'></a>  9903              <a href='../S/4101.html#L90' title='Defined at 90 in test/manual/etags/cp-src/c.C.'>g</a> &lt; end &amp;&amp; <a href='../S/4101.html#L90' title='Defined at 90 in test/manual/etags/cp-src/c.C.'>g</a>-&gt;u.cmp.automatic &amp;&amp; <a href='../S/4101.html#L90' title='Defined at 90 in test/manual/etags/cp-src/c.C.'>g</a>-&gt;u.cmp.id == s-&gt;cmp_id
<a id='L9904' name='L9904'></a>  9904                &amp;&amp; <a href='../S/4101.html#L90' title='Defined at 90 in test/manual/etags/cp-src/c.C.'>g</a>-&gt;slice.cmp.to &lt; s-&gt;cmp_to;
<a id='L9905' name='L9905'></a>  9905              last_glyph = <a href='../S/4101.html#L90' title='Defined at 90 in test/manual/etags/cp-src/c.C.'>g</a>++)
<a id='L9906' name='L9906'></a>  9906           ;
<a id='L9907' name='L9907'></a>  9907     <em class='brace'>}</em>
<a id='L9908' name='L9908'></a>  9908   <strong class='reserved'>else</strong>
<a id='L9909' name='L9909'></a>  9909     last_glyph = s-&gt;first_glyph + s-&gt;nchars - 1;
<a id='L9910' name='L9910'></a>  9910 
<a id='L9911' name='L9911'></a>  9911   vwidth = <a href='../D/10870.html' title='Multiple defined in 2 places.'>eabs</a> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;box_vertical_line_width);
<a id='L9912' name='L9912'></a>  9912   hwidth = <a href='../D/10870.html' title='Multiple defined in 2 places.'>eabs</a> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;box_horizontal_line_width);
<a id='L9913' name='L9913'></a>  9913   raised_p = s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;box == <a href='../S/2315.html#L1686' title='Defined at 1686 in src/dispextern.h.'>FACE_RAISED_BOX</a>;
<a id='L9914' name='L9914'></a>  9914   left_x = s-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L9915' name='L9915'></a>  9915   right_x = (s-&gt;row-&gt;full_width_p &amp;&amp; s-&gt;extends_to_end_of_line_p
<a id='L9916' name='L9916'></a>  9916              ? last_x - 1
<a id='L9917' name='L9917'></a>  9917              : <a href='../D/14475.html' title='Multiple defined in 11 places.'>min</a> (last_x, s-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + s-&gt;background_width) - 1);
<a id='L9918' name='L9918'></a>  9918   top_y = s-&gt;y;
<a id='L9919' name='L9919'></a>  9919   bottom_y = top_y + s-&gt;height - 1;
<a id='L9920' name='L9920'></a>  9920 
<a id='L9921' name='L9921'></a>  9921   left_p = (s-&gt;first_glyph-&gt;left_box_line_p
<a id='L9922' name='L9922'></a>  9922             || (s-&gt;hl == <a href='../S/2315.html#L1327' title='Defined at 1327 in src/dispextern.h.'>DRAW_MOUSE_FACE</a>
<a id='L9923' name='L9923'></a>  9923                 &amp;&amp; (s-&gt;prev == <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>
<a id='L9924' name='L9924'></a>  9924                     || s-&gt;prev-&gt;hl != s-&gt;hl)));
<a id='L9925' name='L9925'></a>  9925   right_p = (last_glyph-&gt;right_box_line_p
<a id='L9926' name='L9926'></a>  9926              || (s-&gt;hl == <a href='../S/2315.html#L1327' title='Defined at 1327 in src/dispextern.h.'>DRAW_MOUSE_FACE</a>
<a id='L9927' name='L9927'></a>  9927                  &amp;&amp; (s-&gt;next == <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>
<a id='L9928' name='L9928'></a>  9928                      || s-&gt;next-&gt;hl != s-&gt;hl)));
<a id='L9929' name='L9929'></a>  9929 
<a id='L9930' name='L9930'></a>  9930   <a href='../S/2224.html#L2635' title='Defined at 2635 in src/xdisp.c.'>get_glyph_string_clip_rect</a> (s, &amp;clip_rect);
<a id='L9931' name='L9931'></a>  9931 
<a id='L9932' name='L9932'></a>  9932   <strong class='reserved'>if</strong> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;box == <a href='../S/2315.html#L1682' title='Defined at 1682 in src/dispextern.h.'>FACE_SIMPLE_BOX</a>)
<a id='L9933' name='L9933'></a>  9933     <a href='../S/2289.html#L9838' title='Defined at 9838 in src/xterm.c.'>x_draw_box_rect</a> (s, left_x, top_y, right_x, bottom_y, hwidth,
<a id='L9934' name='L9934'></a>  9934                      vwidth, left_p, right_p, &amp;clip_rect);
<a id='L9935' name='L9935'></a>  9935   <strong class='reserved'>else</strong>
<a id='L9936' name='L9936'></a>  9936     <em class='brace'>{</em>
<a id='L9937' name='L9937'></a>  9937       <a href='../S/2289.html#L9552' title='Defined at 9552 in src/xterm.c.'>x_setup_relief_colors</a> (s);
<a id='L9938' name='L9938'></a>  9938       <a href='../S/2289.html#L9636' title='Defined at 9636 in src/xterm.c.'>x_draw_relief_rect</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, left_x, top_y, right_x, bottom_y, hwidth,
<a id='L9939' name='L9939'></a>  9939                           vwidth, raised_p, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>, left_p, right_p,
<a id='L9940' name='L9940'></a>  9940                           &amp;clip_rect);
<a id='L9941' name='L9941'></a>  9941     <em class='brace'>}</em>
<a id='L9942' name='L9942'></a>  9942 <em class='brace'>}</em>
<a id='L9943' name='L9943'></a>  9943 
<a id='L9944' name='L9944'></a>  9944 
<a id='L9945' name='L9945'></a>  9945 <em class='sharp'>#ifndef</em> USE_CAIRO
<a id='L9946' name='L9946'></a>  9946 
<a id='L9947' name='L9947'></a>  9947 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L9948' name='L9948'></a>  9948 <a href='../R/18084.html' title='Multiple referred from 3 places.'>x_composite_image</a> (<strong class='reserved'>struct</strong> <a href='../S/2315.html#L1336' title='Defined at 1336 in src/dispextern.h.'>glyph_string</a> *s, <a href='../D/5058.html' title='Multiple defined in 2 places.'>Pixmap</a> dest,
<a id='L9949' name='L9949'></a>  9949 <em class='sharp'>#ifdef</em> HAVE_XRENDER
<a id='L9950' name='L9950'></a>  9950                    <a href='../S/2204.html#L1049' title='Defined at 1049 in src/image.c.'>Picture</a> destination,
<a id='L9951' name='L9951'></a>  9951 <em class='sharp'>#endif</em>
<a id='L9952' name='L9952'></a>  9952                    <strong class='reserved'>int</strong> srcX, <strong class='reserved'>int</strong> srcY, <strong class='reserved'>int</strong> dstX, <strong class='reserved'>int</strong> dstY,
<a id='L9953' name='L9953'></a>  9953                    <strong class='reserved'>int</strong> width, <strong class='reserved'>int</strong> height)
<a id='L9954' name='L9954'></a>  9954 <em class='brace'>{</em>
<a id='L9955' name='L9955'></a>  9955   <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>;
<a id='L9956' name='L9956'></a>  9956 <em class='sharp'>#ifdef</em> HAVE_XRENDER
<a id='L9957' name='L9957'></a>  9957   XRenderPictFormat *default_format;
<a id='L9958' name='L9958'></a>  9958   XRenderPictureAttributes attr <a href='../D/6570.html' title='Multiple defined in 2 places.'>UNINIT</a>;
<a id='L9959' name='L9959'></a>  9959 <em class='sharp'>#endif</em>
<a id='L9960' name='L9960'></a>  9960 
<a id='L9961' name='L9961'></a>  9961   <a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> = <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L9962' name='L9962'></a>  9962 
<a id='L9963' name='L9963'></a>  9963 <em class='sharp'>#ifdef</em> HAVE_XRENDER
<a id='L9964' name='L9964'></a>  9964   <strong class='reserved'>if</strong> (s-&gt;img-&gt;picture &amp;&amp; <a href='../S/2212.html#L1445' title='Defined at 1445 in src/xterm.h.'>FRAME_X_PICTURE_FORMAT</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L9965' name='L9965'></a>  9965     <em class='brace'>{</em>
<a id='L9966' name='L9966'></a>  9966       <strong class='reserved'>if</strong> (destination == None)
<a id='L9967' name='L9967'></a>  9967         <em class='brace'>{</em>
<a id='L9968' name='L9968'></a>  9968           <em class='comment'>/* The destination picture was not specified.  This means we</em>
<a id='L9969' name='L9969'></a>  9969 <em class='comment'>             have to create a picture representing the */</em>
<a id='L9970' name='L9970'></a>  9970           default_format = <a href='../S/2212.html#L1445' title='Defined at 1445 in src/xterm.h.'>FRAME_X_PICTURE_FORMAT</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L9971' name='L9971'></a>  9971           destination = XRenderCreatePicture (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, dest,
<a id='L9972' name='L9972'></a>  9972                                               default_format, 0, &amp;attr);
<a id='L9973' name='L9973'></a>  9973 
<a id='L9974' name='L9974'></a>  9974           XRenderComposite (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, (s-&gt;img-&gt;mask_picture
<a id='L9975' name='L9975'></a>  9975                                       ? PictOpOver : PictOpSrc),
<a id='L9976' name='L9976'></a>  9976                             s-&gt;img-&gt;picture, s-&gt;img-&gt;mask_picture,
<a id='L9977' name='L9977'></a>  9977                             destination, srcX, srcY, srcX, srcY,
<a id='L9978' name='L9978'></a>  9978                             dstX, dstY, width, height);
<a id='L9979' name='L9979'></a>  9979 
<a id='L9980' name='L9980'></a>  9980           XRenderFreePicture (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, destination);
<a id='L9981' name='L9981'></a>  9981         <em class='brace'>}</em>
<a id='L9982' name='L9982'></a>  9982       <strong class='reserved'>else</strong>
<a id='L9983' name='L9983'></a>  9983         XRenderComposite (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, (s-&gt;img-&gt;mask_picture
<a id='L9984' name='L9984'></a>  9984                                     ? PictOpOver : PictOpSrc),
<a id='L9985' name='L9985'></a>  9985                           s-&gt;img-&gt;picture, s-&gt;img-&gt;mask_picture,
<a id='L9986' name='L9986'></a>  9986                           destination, srcX, srcY, srcX, srcY,
<a id='L9987' name='L9987'></a>  9987                           dstX, dstY, width, height);
<a id='L9988' name='L9988'></a>  9988 
<a id='L9989' name='L9989'></a>  9989       <strong class='reserved'>return</strong>;
<a id='L9990' name='L9990'></a>  9990     <em class='brace'>}</em>
<a id='L9991' name='L9991'></a>  9991 <em class='sharp'>#endif</em>
<a id='L9992' name='L9992'></a>  9992 
<a id='L9993' name='L9993'></a>  9993   XCopyArea (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, s-&gt;img-&gt;pixmap,
<a id='L9994' name='L9994'></a>  9994              dest, s-&gt;gc,
<a id='L9995' name='L9995'></a>  9995              srcX, srcY,
<a id='L9996' name='L9996'></a>  9996              width, height, dstX, dstY);
<a id='L9997' name='L9997'></a>  9997 <em class='brace'>}</em>
<a id='L9998' name='L9998'></a>  9998 
<a id='L9999' name='L9999'></a>  9999 <em class='sharp'>#endif</em>  <em class='comment'>/* !USE_CAIRO */</em>
<a id='L10000' name='L10000'></a> 10000 
<a id='L10001' name='L10001'></a> 10001 
<a id='L10002' name='L10002'></a> 10002 <em class='comment'>/* Draw foreground of image glyph string S.  */</em>
<a id='L10003' name='L10003'></a> 10003 
<a id='L10004' name='L10004'></a> 10004 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L10005' name='L10005'></a> 10005 <a href='../S/2289.html#L10462' title='Referred from 10462 in src/xterm.c.'>x_draw_image_foreground</a> (<strong class='reserved'>struct</strong> <a href='../S/2315.html#L1336' title='Defined at 1336 in src/dispextern.h.'>glyph_string</a> *s)
<a id='L10006' name='L10006'></a> 10006 <em class='brace'>{</em>
<a id='L10007' name='L10007'></a> 10007   <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = s-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L10008' name='L10008'></a> 10008   <strong class='reserved'>int</strong> y = s-&gt;ybase - <a href='../S/2204.html#L1737' title='Defined at 1737 in src/image.c.'>image_ascent</a> (s-&gt;img, s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>, &amp;s-&gt;slice);
<a id='L10009' name='L10009'></a> 10009 
<a id='L10010' name='L10010'></a> 10010   <em class='comment'>/* If first glyph of S has a left box line, start drawing it to the</em>
<a id='L10011' name='L10011'></a> 10011 <em class='comment'>     right of that line.  */</em>
<a id='L10012' name='L10012'></a> 10012   <strong class='reserved'>if</strong> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;box != <a href='../S/2315.html#L1678' title='Defined at 1678 in src/dispextern.h.'>FACE_NO_BOX</a>
<a id='L10013' name='L10013'></a> 10013       &amp;&amp; s-&gt;first_glyph-&gt;left_box_line_p
<a id='L10014' name='L10014'></a> 10014       &amp;&amp; s-&gt;slice.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> == 0)
<a id='L10015' name='L10015'></a> 10015     <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> += <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;box_vertical_line_width, 0);
<a id='L10016' name='L10016'></a> 10016 
<a id='L10017' name='L10017'></a> 10017   <em class='comment'>/* If there is a margin around the image, adjust x- and y-position</em>
<a id='L10018' name='L10018'></a> 10018 <em class='comment'>     by that margin.  */</em>
<a id='L10019' name='L10019'></a> 10019   <strong class='reserved'>if</strong> (s-&gt;slice.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> == 0)
<a id='L10020' name='L10020'></a> 10020     <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> += s-&gt;img-&gt;hmargin;
<a id='L10021' name='L10021'></a> 10021   <strong class='reserved'>if</strong> (s-&gt;slice.y == 0)
<a id='L10022' name='L10022'></a> 10022     y += s-&gt;img-&gt;vmargin;
<a id='L10023' name='L10023'></a> 10023 
<a id='L10024' name='L10024'></a> 10024 <em class='sharp'>#ifdef</em> USE_CAIRO
<a id='L10025' name='L10025'></a> 10025   <strong class='reserved'>if</strong> (s-&gt;img-&gt;cr_data)
<a id='L10026' name='L10026'></a> 10026     <em class='brace'>{</em>
<a id='L10027' name='L10027'></a> 10027       <a href='../S/2289.html#L8296' title='Defined at 8296 in src/xterm.c.'>x_set_glyph_string_clipping</a> (s);
<a id='L10028' name='L10028'></a> 10028       <a href='../S/2289.html#L6183' title='Defined at 6183 in src/xterm.c.'>x_cr_draw_image</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, s-&gt;gc, s-&gt;img-&gt;cr_data,
<a id='L10029' name='L10029'></a> 10029                        s-&gt;slice.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, s-&gt;slice.y, s-&gt;slice.width, s-&gt;slice.height,
<a id='L10030' name='L10030'></a> 10030                        <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L10031' name='L10031'></a> 10031       <strong class='reserved'>if</strong> (!s-&gt;img-&gt;mask)
<a id='L10032' name='L10032'></a> 10032         <em class='brace'>{</em>
<a id='L10033' name='L10033'></a> 10033           <em class='comment'>/* When the image has a mask, we can expect that at</em>
<a id='L10034' name='L10034'></a> 10034 <em class='comment'>             least part of a mouse highlight or a block cursor will</em>
<a id='L10035' name='L10035'></a> 10035 <em class='comment'>             be visible.  If the image doesn't have a mask, make</em>
<a id='L10036' name='L10036'></a> 10036 <em class='comment'>             a block cursor visible by drawing a rectangle around</em>
<a id='L10037' name='L10037'></a> 10037 <em class='comment'>             the image.  I believe it's looking better if we do</em>
<a id='L10038' name='L10038'></a> 10038 <em class='comment'>             nothing here for mouse-face.  */</em>
<a id='L10039' name='L10039'></a> 10039           <strong class='reserved'>if</strong> (s-&gt;hl == <a href='../S/2315.html#L1326' title='Defined at 1326 in src/dispextern.h.'>DRAW_CURSOR</a>)
<a id='L10040' name='L10040'></a> 10040             <em class='brace'>{</em>
<a id='L10041' name='L10041'></a> 10041               <strong class='reserved'>int</strong> <a href='../D/16285.html' title='Multiple defined in 4 places.'>relief</a> = <a href='../D/10870.html' title='Multiple defined in 2 places.'>eabs</a> (s-&gt;img-&gt;<a href='../D/16285.html' title='Multiple defined in 4 places.'>relief</a>);
<a id='L10042' name='L10042'></a> 10042               <a href='../S/2289.html#L6625' title='Defined at 6625 in src/xterm.c.'>x_draw_rectangle</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, s-&gt;gc, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> - <a href='../D/16285.html' title='Multiple defined in 4 places.'>relief</a>, y - <a href='../D/16285.html' title='Multiple defined in 4 places.'>relief</a>,
<a id='L10043' name='L10043'></a> 10043                                 s-&gt;slice.width + <a href='../D/16285.html' title='Multiple defined in 4 places.'>relief</a>*2 - 1,
<a id='L10044' name='L10044'></a> 10044                                 s-&gt;slice.height + <a href='../D/16285.html' title='Multiple defined in 4 places.'>relief</a>*2 - 1);
<a id='L10045' name='L10045'></a> 10045             <em class='brace'>}</em>
<a id='L10046' name='L10046'></a> 10046         <em class='brace'>}</em>
<a id='L10047' name='L10047'></a> 10047     <em class='brace'>}</em>
<a id='L10048' name='L10048'></a> 10048 <em class='sharp'>#else</em>  <em class='comment'>/* ! USE_CAIRO */</em>
<a id='L10049' name='L10049'></a> 10049   <strong class='reserved'>if</strong> (s-&gt;img-&gt;pixmap)
<a id='L10050' name='L10050'></a> 10050     <em class='brace'>{</em>
<a id='L10051' name='L10051'></a> 10051       <strong class='reserved'>if</strong> (s-&gt;img-&gt;mask)
<a id='L10052' name='L10052'></a> 10052         <em class='brace'>{</em>
<a id='L10053' name='L10053'></a> 10053           <em class='comment'>/* We can't set both a clip mask and use XSetClipRectangles</em>
<a id='L10054' name='L10054'></a> 10054 <em class='comment'>             because the latter also sets a clip mask.  We also can't</em>
<a id='L10055' name='L10055'></a> 10055 <em class='comment'>             trust on the shape extension to be available</em>
<a id='L10056' name='L10056'></a> 10056 <em class='comment'>             (XShapeCombineRegion).  So, compute the rectangle to draw</em>
<a id='L10057' name='L10057'></a> 10057 <em class='comment'>             manually.  */</em>
<a id='L10058' name='L10058'></a> 10058           <em class='comment'>/* FIXME: Do we need to do this when using XRender compositing?  */</em>
<a id='L10059' name='L10059'></a> 10059           <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> mask = (GCClipMask | GCClipXOrigin | GCClipYOrigin
<a id='L10060' name='L10060'></a> 10060                                 | GCFunction);
<a id='L10061' name='L10061'></a> 10061           XGCValues xgcv;
<a id='L10062' name='L10062'></a> 10062           <a href='../S/2150.html#L62' title='Defined at 62 in src/pgtkgui.h.'>XRectangle</a> clip_rect, image_rect, r;
<a id='L10063' name='L10063'></a> 10063 
<a id='L10064' name='L10064'></a> 10064           xgcv.clip_mask = s-&gt;img-&gt;mask;
<a id='L10065' name='L10065'></a> 10065           xgcv.clip_x_origin = <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L10066' name='L10066'></a> 10066           xgcv.clip_y_origin = y;
<a id='L10067' name='L10067'></a> 10067           xgcv.function = GXcopy;
<a id='L10068' name='L10068'></a> 10068           <a href='../S/2215.html#L250' title='Defined at 250 in src/w32term.c.'>XChangeGC</a> (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), s-&gt;gc, mask, &amp;xgcv);
<a id='L10069' name='L10069'></a> 10069 
<a id='L10070' name='L10070'></a> 10070           <a href='../S/2224.html#L2635' title='Defined at 2635 in src/xdisp.c.'>get_glyph_string_clip_rect</a> (s, &amp;clip_rect);
<a id='L10071' name='L10071'></a> 10071           image_rect.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L10072' name='L10072'></a> 10072           image_rect.y = y;
<a id='L10073' name='L10073'></a> 10073           image_rect.width = s-&gt;slice.width;
<a id='L10074' name='L10074'></a> 10074           image_rect.height = s-&gt;slice.height;
<a id='L10075' name='L10075'></a> 10075           <strong class='reserved'>if</strong> (<a href='../S/2224.html#L36555' title='Defined at 36555 in src/xdisp.c.'>gui_intersect_rectangles</a> (&amp;clip_rect, &amp;image_rect, &amp;r))
<a id='L10076' name='L10076'></a> 10076             <a href='../S/2289.html#L9948' title='Defined at 9948 in src/xterm.c.'>x_composite_image</a> (s, <a href='../S/2212.html#L1352' title='Defined at 1352 in src/xterm.h.'>FRAME_X_DRAWABLE</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L10077' name='L10077'></a> 10077 <em class='sharp'>#ifdef</em> HAVE_XRENDER
<a id='L10078' name='L10078'></a> 10078                                <a href='../S/2212.html#L1446' title='Defined at 1446 in src/xterm.h.'>FRAME_X_PICTURE</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L10079' name='L10079'></a> 10079 <em class='sharp'>#endif</em>
<a id='L10080' name='L10080'></a> 10080                                s-&gt;slice.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + r.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> - <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, s-&gt;slice.y + r.y - y,
<a id='L10081' name='L10081'></a> 10081                                r.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, r.y, r.width, r.height);
<a id='L10082' name='L10082'></a> 10082         <em class='brace'>}</em>
<a id='L10083' name='L10083'></a> 10083       <strong class='reserved'>else</strong>
<a id='L10084' name='L10084'></a> 10084         <em class='brace'>{</em>
<a id='L10085' name='L10085'></a> 10085           <a href='../S/2150.html#L62' title='Defined at 62 in src/pgtkgui.h.'>XRectangle</a> clip_rect, image_rect, r;
<a id='L10086' name='L10086'></a> 10086 
<a id='L10087' name='L10087'></a> 10087           <a href='../S/2224.html#L2635' title='Defined at 2635 in src/xdisp.c.'>get_glyph_string_clip_rect</a> (s, &amp;clip_rect);
<a id='L10088' name='L10088'></a> 10088           image_rect.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L10089' name='L10089'></a> 10089           image_rect.y = y;
<a id='L10090' name='L10090'></a> 10090           image_rect.width = s-&gt;slice.width;
<a id='L10091' name='L10091'></a> 10091           image_rect.height = s-&gt;slice.height;
<a id='L10092' name='L10092'></a> 10092           <strong class='reserved'>if</strong> (<a href='../S/2224.html#L36555' title='Defined at 36555 in src/xdisp.c.'>gui_intersect_rectangles</a> (&amp;clip_rect, &amp;image_rect, &amp;r))
<a id='L10093' name='L10093'></a> 10093             <a href='../S/2289.html#L9948' title='Defined at 9948 in src/xterm.c.'>x_composite_image</a> (s, <a href='../S/2212.html#L1352' title='Defined at 1352 in src/xterm.h.'>FRAME_X_DRAWABLE</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L10094' name='L10094'></a> 10094 <em class='sharp'>#ifdef</em> HAVE_XRENDER
<a id='L10095' name='L10095'></a> 10095                                <a href='../S/2212.html#L1446' title='Defined at 1446 in src/xterm.h.'>FRAME_X_PICTURE</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L10096' name='L10096'></a> 10096 <em class='sharp'>#endif</em>
<a id='L10097' name='L10097'></a> 10097                                s-&gt;slice.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + r.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> - <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>,
<a id='L10098' name='L10098'></a> 10098                                s-&gt;slice.y + r.y - y,
<a id='L10099' name='L10099'></a> 10099                                r.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, r.y, r.width, r.height);
<a id='L10100' name='L10100'></a> 10100 
<a id='L10101' name='L10101'></a> 10101           <em class='comment'>/* When the image has a mask, we can expect that at</em>
<a id='L10102' name='L10102'></a> 10102 <em class='comment'>             least part of a mouse highlight or a block cursor will</em>
<a id='L10103' name='L10103'></a> 10103 <em class='comment'>             be visible.  If the image doesn't have a mask, make</em>
<a id='L10104' name='L10104'></a> 10104 <em class='comment'>             a block cursor visible by drawing a rectangle around</em>
<a id='L10105' name='L10105'></a> 10105 <em class='comment'>             the image.  I believe it's looking better if we do</em>
<a id='L10106' name='L10106'></a> 10106 <em class='comment'>             nothing here for mouse-face.  */</em>
<a id='L10107' name='L10107'></a> 10107           <strong class='reserved'>if</strong> (s-&gt;hl == <a href='../S/2315.html#L1326' title='Defined at 1326 in src/dispextern.h.'>DRAW_CURSOR</a>)
<a id='L10108' name='L10108'></a> 10108             <em class='brace'>{</em>
<a id='L10109' name='L10109'></a> 10109               <strong class='reserved'>int</strong> <a href='../D/16285.html' title='Multiple defined in 4 places.'>relief</a> = <a href='../D/10870.html' title='Multiple defined in 2 places.'>eabs</a> (s-&gt;img-&gt;<a href='../D/16285.html' title='Multiple defined in 4 places.'>relief</a>);
<a id='L10110' name='L10110'></a> 10110               <a href='../S/2289.html#L6625' title='Defined at 6625 in src/xterm.c.'>x_draw_rectangle</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, s-&gt;gc,
<a id='L10111' name='L10111'></a> 10111                               <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> - <a href='../D/16285.html' title='Multiple defined in 4 places.'>relief</a>, y - <a href='../D/16285.html' title='Multiple defined in 4 places.'>relief</a>,
<a id='L10112' name='L10112'></a> 10112                               s-&gt;slice.width + <a href='../D/16285.html' title='Multiple defined in 4 places.'>relief</a>*2 - 1,
<a id='L10113' name='L10113'></a> 10113                               s-&gt;slice.height + <a href='../D/16285.html' title='Multiple defined in 4 places.'>relief</a>*2 - 1);
<a id='L10114' name='L10114'></a> 10114             <em class='brace'>}</em>
<a id='L10115' name='L10115'></a> 10115         <em class='brace'>}</em>
<a id='L10116' name='L10116'></a> 10116     <em class='brace'>}</em>
<a id='L10117' name='L10117'></a> 10117 <em class='sharp'>#endif</em>  <em class='comment'>/* ! USE_CAIRO */</em>
<a id='L10118' name='L10118'></a> 10118   <strong class='reserved'>else</strong>
<a id='L10119' name='L10119'></a> 10119     <em class='comment'>/* Draw a rectangle if image could not be loaded.  */</em>
<a id='L10120' name='L10120'></a> 10120     <a href='../S/2289.html#L6625' title='Defined at 6625 in src/xterm.c.'>x_draw_rectangle</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, s-&gt;gc, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y,
<a id='L10121' name='L10121'></a> 10121                     s-&gt;slice.width - 1, s-&gt;slice.height - 1);
<a id='L10122' name='L10122'></a> 10122 <em class='brace'>}</em>
<a id='L10123' name='L10123'></a> 10123 
<a id='L10124' name='L10124'></a> 10124 
<a id='L10125' name='L10125'></a> 10125 <em class='comment'>/* Draw a relief around the image glyph string S.  */</em>
<a id='L10126' name='L10126'></a> 10126 
<a id='L10127' name='L10127'></a> 10127 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L10128' name='L10128'></a> 10128 <a href='../S/2289.html#L10468' title='Referred from 10468 in src/xterm.c.'>x_draw_image_relief</a> (<strong class='reserved'>struct</strong> <a href='../S/2315.html#L1336' title='Defined at 1336 in src/dispextern.h.'>glyph_string</a> *s)
<a id='L10129' name='L10129'></a> 10129 <em class='brace'>{</em>
<a id='L10130' name='L10130'></a> 10130   <strong class='reserved'>int</strong> x1, <a href='../D/20170.html' title='Multiple defined in 2 places.'>y1</a>, thick;
<a id='L10131' name='L10131'></a> 10131   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> raised_p, top_p, bot_p, left_p, right_p;
<a id='L10132' name='L10132'></a> 10132   <strong class='reserved'>int</strong> extra_x, extra_y;
<a id='L10133' name='L10133'></a> 10133   <a href='../S/2150.html#L62' title='Defined at 62 in src/pgtkgui.h.'>XRectangle</a> r;
<a id='L10134' name='L10134'></a> 10134   <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = s-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L10135' name='L10135'></a> 10135   <strong class='reserved'>int</strong> y = s-&gt;ybase - <a href='../S/2204.html#L1737' title='Defined at 1737 in src/image.c.'>image_ascent</a> (s-&gt;img, s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>, &amp;s-&gt;slice);
<a id='L10136' name='L10136'></a> 10136 
<a id='L10137' name='L10137'></a> 10137   <em class='comment'>/* If first glyph of S has a left box line, start drawing it to the</em>
<a id='L10138' name='L10138'></a> 10138 <em class='comment'>     right of that line.  */</em>
<a id='L10139' name='L10139'></a> 10139   <strong class='reserved'>if</strong> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;box != <a href='../S/2315.html#L1678' title='Defined at 1678 in src/dispextern.h.'>FACE_NO_BOX</a>
<a id='L10140' name='L10140'></a> 10140       &amp;&amp; s-&gt;first_glyph-&gt;left_box_line_p
<a id='L10141' name='L10141'></a> 10141       &amp;&amp; s-&gt;slice.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> == 0)
<a id='L10142' name='L10142'></a> 10142     <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> += <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;box_vertical_line_width, 0);
<a id='L10143' name='L10143'></a> 10143 
<a id='L10144' name='L10144'></a> 10144   <em class='comment'>/* If there is a margin around the image, adjust x- and y-position</em>
<a id='L10145' name='L10145'></a> 10145 <em class='comment'>     by that margin.  */</em>
<a id='L10146' name='L10146'></a> 10146   <strong class='reserved'>if</strong> (s-&gt;slice.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> == 0)
<a id='L10147' name='L10147'></a> 10147     <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> += s-&gt;img-&gt;hmargin;
<a id='L10148' name='L10148'></a> 10148   <strong class='reserved'>if</strong> (s-&gt;slice.y == 0)
<a id='L10149' name='L10149'></a> 10149     y += s-&gt;img-&gt;vmargin;
<a id='L10150' name='L10150'></a> 10150 
<a id='L10151' name='L10151'></a> 10151   <strong class='reserved'>if</strong> (s-&gt;hl == <a href='../S/2315.html#L1329' title='Defined at 1329 in src/dispextern.h.'>DRAW_IMAGE_SUNKEN</a>
<a id='L10152' name='L10152'></a> 10152       || s-&gt;hl == <a href='../S/2315.html#L1328' title='Defined at 1328 in src/dispextern.h.'>DRAW_IMAGE_RAISED</a>)
<a id='L10153' name='L10153'></a> 10153     <em class='brace'>{</em>
<a id='L10154' name='L10154'></a> 10154       <strong class='reserved'>if</strong> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;id == <a href='../S/2315.html#L1897' title='Defined at 1897 in src/dispextern.h.'>TAB_BAR_FACE_ID</a>)
<a id='L10155' name='L10155'></a> 10155         thick = (tab_bar_button_relief &lt; 0
<a id='L10156' name='L10156'></a> 10156                  ? <a href='../S/2315.html#L3314' title='Defined at 3314 in src/dispextern.h.'>DEFAULT_TAB_BAR_BUTTON_RELIEF</a>
<a id='L10157' name='L10157'></a> 10157                  : <a href='../D/14475.html' title='Multiple defined in 11 places.'>min</a> (tab_bar_button_relief, 1000000));
<a id='L10158' name='L10158'></a> 10158       <strong class='reserved'>else</strong>
<a id='L10159' name='L10159'></a> 10159         thick = (tool_bar_button_relief &lt; 0
<a id='L10160' name='L10160'></a> 10160                  ? <a href='../S/2315.html#L3393' title='Defined at 3393 in src/dispextern.h.'>DEFAULT_TOOL_BAR_BUTTON_RELIEF</a>
<a id='L10161' name='L10161'></a> 10161                  : <a href='../D/14475.html' title='Multiple defined in 11 places.'>min</a> (tool_bar_button_relief, 1000000));
<a id='L10162' name='L10162'></a> 10162       raised_p = s-&gt;hl == <a href='../S/2315.html#L1328' title='Defined at 1328 in src/dispextern.h.'>DRAW_IMAGE_RAISED</a>;
<a id='L10163' name='L10163'></a> 10163     <em class='brace'>}</em>
<a id='L10164' name='L10164'></a> 10164   <strong class='reserved'>else</strong>
<a id='L10165' name='L10165'></a> 10165     <em class='brace'>{</em>
<a id='L10166' name='L10166'></a> 10166       thick = <a href='../D/10870.html' title='Multiple defined in 2 places.'>eabs</a> (s-&gt;img-&gt;<a href='../D/16285.html' title='Multiple defined in 4 places.'>relief</a>);
<a id='L10167' name='L10167'></a> 10167       raised_p = s-&gt;img-&gt;<a href='../D/16285.html' title='Multiple defined in 4 places.'>relief</a> &gt; 0;
<a id='L10168' name='L10168'></a> 10168     <em class='brace'>}</em>
<a id='L10169' name='L10169'></a> 10169 
<a id='L10170' name='L10170'></a> 10170   x1 = <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + s-&gt;slice.width - 1;
<a id='L10171' name='L10171'></a> 10171   <a href='../D/20170.html' title='Multiple defined in 2 places.'>y1</a> = y + s-&gt;slice.height - 1;
<a id='L10172' name='L10172'></a> 10172 
<a id='L10173' name='L10173'></a> 10173   extra_x = extra_y = 0;
<a id='L10174' name='L10174'></a> 10174   <strong class='reserved'>if</strong> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;id == <a href='../S/2315.html#L1897' title='Defined at 1897 in src/dispextern.h.'>TAB_BAR_FACE_ID</a>)
<a id='L10175' name='L10175'></a> 10175     <em class='brace'>{</em>
<a id='L10176' name='L10176'></a> 10176       <strong class='reserved'>if</strong> (<a href='../D/1228.html' title='Multiple defined in 2 places.'>CONSP</a> (Vtab_bar_button_margin)
<a id='L10177' name='L10177'></a> 10177           &amp;&amp; <a href='../S/2267.html#L469' title='Defined at 469 in src/lisp.h.'>FIXNUMP</a> (<a href='../D/7021.html' title='Multiple defined in 2 places.'>XCAR</a> (Vtab_bar_button_margin))
<a id='L10178' name='L10178'></a> 10178           &amp;&amp; <a href='../S/2267.html#L469' title='Defined at 469 in src/lisp.h.'>FIXNUMP</a> (<a href='../D/7022.html' title='Multiple defined in 2 places.'>XCDR</a> (Vtab_bar_button_margin)))
<a id='L10179' name='L10179'></a> 10179         <em class='brace'>{</em>
<a id='L10180' name='L10180'></a> 10180           extra_x = <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (<a href='../D/7021.html' title='Multiple defined in 2 places.'>XCAR</a> (Vtab_bar_button_margin)) - thick;
<a id='L10181' name='L10181'></a> 10181           extra_y = <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (<a href='../D/7022.html' title='Multiple defined in 2 places.'>XCDR</a> (Vtab_bar_button_margin)) - thick;
<a id='L10182' name='L10182'></a> 10182         <em class='brace'>}</em>
<a id='L10183' name='L10183'></a> 10183       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (<a href='../S/2267.html#L469' title='Defined at 469 in src/lisp.h.'>FIXNUMP</a> (Vtab_bar_button_margin))
<a id='L10184' name='L10184'></a> 10184         extra_x = extra_y = <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (Vtab_bar_button_margin) - thick;
<a id='L10185' name='L10185'></a> 10185     <em class='brace'>}</em>
<a id='L10186' name='L10186'></a> 10186 
<a id='L10187' name='L10187'></a> 10187   <strong class='reserved'>if</strong> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;id == <a href='../S/2315.html#L1883' title='Defined at 1883 in src/dispextern.h.'>TOOL_BAR_FACE_ID</a>)
<a id='L10188' name='L10188'></a> 10188     <em class='brace'>{</em>
<a id='L10189' name='L10189'></a> 10189       <strong class='reserved'>if</strong> (<a href='../D/1228.html' title='Multiple defined in 2 places.'>CONSP</a> (Vtool_bar_button_margin)
<a id='L10190' name='L10190'></a> 10190           &amp;&amp; <a href='../S/2267.html#L469' title='Defined at 469 in src/lisp.h.'>FIXNUMP</a> (<a href='../D/7021.html' title='Multiple defined in 2 places.'>XCAR</a> (Vtool_bar_button_margin))
<a id='L10191' name='L10191'></a> 10191           &amp;&amp; <a href='../S/2267.html#L469' title='Defined at 469 in src/lisp.h.'>FIXNUMP</a> (<a href='../D/7022.html' title='Multiple defined in 2 places.'>XCDR</a> (Vtool_bar_button_margin)))
<a id='L10192' name='L10192'></a> 10192         <em class='brace'>{</em>
<a id='L10193' name='L10193'></a> 10193           extra_x = <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (<a href='../D/7021.html' title='Multiple defined in 2 places.'>XCAR</a> (Vtool_bar_button_margin));
<a id='L10194' name='L10194'></a> 10194           extra_y = <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (<a href='../D/7022.html' title='Multiple defined in 2 places.'>XCDR</a> (Vtool_bar_button_margin));
<a id='L10195' name='L10195'></a> 10195         <em class='brace'>}</em>
<a id='L10196' name='L10196'></a> 10196       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (<a href='../S/2267.html#L469' title='Defined at 469 in src/lisp.h.'>FIXNUMP</a> (Vtool_bar_button_margin))
<a id='L10197' name='L10197'></a> 10197         extra_x = extra_y = <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (Vtool_bar_button_margin);
<a id='L10198' name='L10198'></a> 10198     <em class='brace'>}</em>
<a id='L10199' name='L10199'></a> 10199 
<a id='L10200' name='L10200'></a> 10200   top_p = bot_p = left_p = right_p = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L10201' name='L10201'></a> 10201 
<a id='L10202' name='L10202'></a> 10202   <strong class='reserved'>if</strong> (s-&gt;slice.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> == 0)
<a id='L10203' name='L10203'></a> 10203     <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> -= thick + extra_x, left_p = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L10204' name='L10204'></a> 10204   <strong class='reserved'>if</strong> (s-&gt;slice.y == 0)
<a id='L10205' name='L10205'></a> 10205     y -= thick + extra_y, top_p = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L10206' name='L10206'></a> 10206   <strong class='reserved'>if</strong> (s-&gt;slice.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + s-&gt;slice.width == s-&gt;img-&gt;width)
<a id='L10207' name='L10207'></a> 10207     x1 += thick + extra_x, right_p = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L10208' name='L10208'></a> 10208   <strong class='reserved'>if</strong> (s-&gt;slice.y + s-&gt;slice.height == s-&gt;img-&gt;height)
<a id='L10209' name='L10209'></a> 10209     <a href='../D/20170.html' title='Multiple defined in 2 places.'>y1</a> += thick + extra_y, bot_p = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L10210' name='L10210'></a> 10210 
<a id='L10211' name='L10211'></a> 10211   <a href='../S/2289.html#L9552' title='Defined at 9552 in src/xterm.c.'>x_setup_relief_colors</a> (s);
<a id='L10212' name='L10212'></a> 10212   <a href='../S/2224.html#L2635' title='Defined at 2635 in src/xdisp.c.'>get_glyph_string_clip_rect</a> (s, &amp;r);
<a id='L10213' name='L10213'></a> 10213   <a href='../S/2289.html#L9636' title='Defined at 9636 in src/xterm.c.'>x_draw_relief_rect</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, x1, <a href='../D/20170.html' title='Multiple defined in 2 places.'>y1</a>, thick, thick, raised_p,
<a id='L10214' name='L10214'></a> 10214                       top_p, bot_p, left_p, right_p, &amp;r);
<a id='L10215' name='L10215'></a> 10215 <em class='brace'>}</em>
<a id='L10216' name='L10216'></a> 10216 
<a id='L10217' name='L10217'></a> 10217 
<a id='L10218' name='L10218'></a> 10218 <em class='sharp'>#ifndef</em> USE_CAIRO
<a id='L10219' name='L10219'></a> 10219 <em class='comment'>/* Draw the foreground of image glyph string S to PIXMAP.  */</em>
<a id='L10220' name='L10220'></a> 10220 
<a id='L10221' name='L10221'></a> 10221 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L10222' name='L10222'></a> 10222 <a href='../S/2289.html#L10454' title='Referred from 10454 in src/xterm.c.'>x_draw_image_foreground_1</a> (<strong class='reserved'>struct</strong> <a href='../S/2315.html#L1336' title='Defined at 1336 in src/dispextern.h.'>glyph_string</a> *s, <a href='../D/5058.html' title='Multiple defined in 2 places.'>Pixmap</a> pixmap)
<a id='L10223' name='L10223'></a> 10223 <em class='brace'>{</em>
<a id='L10224' name='L10224'></a> 10224   <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = 0;
<a id='L10225' name='L10225'></a> 10225   <strong class='reserved'>int</strong> y = s-&gt;ybase - s-&gt;y - <a href='../S/2204.html#L1737' title='Defined at 1737 in src/image.c.'>image_ascent</a> (s-&gt;img, s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>, &amp;s-&gt;slice);
<a id='L10226' name='L10226'></a> 10226 
<a id='L10227' name='L10227'></a> 10227   <em class='comment'>/* If first glyph of S has a left box line, start drawing it to the</em>
<a id='L10228' name='L10228'></a> 10228 <em class='comment'>     right of that line.  */</em>
<a id='L10229' name='L10229'></a> 10229   <strong class='reserved'>if</strong> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;box != <a href='../S/2315.html#L1678' title='Defined at 1678 in src/dispextern.h.'>FACE_NO_BOX</a>
<a id='L10230' name='L10230'></a> 10230       &amp;&amp; s-&gt;first_glyph-&gt;left_box_line_p
<a id='L10231' name='L10231'></a> 10231       &amp;&amp; s-&gt;slice.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> == 0)
<a id='L10232' name='L10232'></a> 10232     <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> += <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;box_vertical_line_width, 0);
<a id='L10233' name='L10233'></a> 10233 
<a id='L10234' name='L10234'></a> 10234   <em class='comment'>/* If there is a margin around the image, adjust x- and y-position</em>
<a id='L10235' name='L10235'></a> 10235 <em class='comment'>     by that margin.  */</em>
<a id='L10236' name='L10236'></a> 10236   <strong class='reserved'>if</strong> (s-&gt;slice.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> == 0)
<a id='L10237' name='L10237'></a> 10237     <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> += s-&gt;img-&gt;hmargin;
<a id='L10238' name='L10238'></a> 10238   <strong class='reserved'>if</strong> (s-&gt;slice.y == 0)
<a id='L10239' name='L10239'></a> 10239     y += s-&gt;img-&gt;vmargin;
<a id='L10240' name='L10240'></a> 10240 
<a id='L10241' name='L10241'></a> 10241   <strong class='reserved'>if</strong> (s-&gt;img-&gt;pixmap)
<a id='L10242' name='L10242'></a> 10242     <em class='brace'>{</em>
<a id='L10243' name='L10243'></a> 10243       <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> = <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L10244' name='L10244'></a> 10244 
<a id='L10245' name='L10245'></a> 10245       <strong class='reserved'>if</strong> (s-&gt;img-&gt;mask)
<a id='L10246' name='L10246'></a> 10246         <em class='brace'>{</em>
<a id='L10247' name='L10247'></a> 10247           <em class='comment'>/* We can't set both a clip mask and use XSetClipRectangles</em>
<a id='L10248' name='L10248'></a> 10248 <em class='comment'>             because the latter also sets a clip mask.  We also can't</em>
<a id='L10249' name='L10249'></a> 10249 <em class='comment'>             trust on the shape extension to be available</em>
<a id='L10250' name='L10250'></a> 10250 <em class='comment'>             (XShapeCombineRegion).  So, compute the rectangle to draw</em>
<a id='L10251' name='L10251'></a> 10251 <em class='comment'>             manually.  */</em>
<a id='L10252' name='L10252'></a> 10252           <em class='comment'>/* FIXME: Do we need to do this when using XRender compositing?  */</em>
<a id='L10253' name='L10253'></a> 10253           <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> mask = (GCClipMask | GCClipXOrigin | GCClipYOrigin
<a id='L10254' name='L10254'></a> 10254                                 | GCFunction);
<a id='L10255' name='L10255'></a> 10255           XGCValues xgcv;
<a id='L10256' name='L10256'></a> 10256 
<a id='L10257' name='L10257'></a> 10257           xgcv.clip_mask = s-&gt;img-&gt;mask;
<a id='L10258' name='L10258'></a> 10258           xgcv.clip_x_origin = <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> - s-&gt;slice.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L10259' name='L10259'></a> 10259           xgcv.clip_y_origin = y - s-&gt;slice.y;
<a id='L10260' name='L10260'></a> 10260           xgcv.function = GXcopy;
<a id='L10261' name='L10261'></a> 10261           <a href='../S/2215.html#L250' title='Defined at 250 in src/w32term.c.'>XChangeGC</a> (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, s-&gt;gc, mask, &amp;xgcv);
<a id='L10262' name='L10262'></a> 10262 
<a id='L10263' name='L10263'></a> 10263           <a href='../S/2289.html#L9948' title='Defined at 9948 in src/xterm.c.'>x_composite_image</a> (s, pixmap,
<a id='L10264' name='L10264'></a> 10264 <em class='sharp'>#ifdef</em> HAVE_XRENDER
<a id='L10265' name='L10265'></a> 10265                              None,
<a id='L10266' name='L10266'></a> 10266 <em class='sharp'>#endif</em>
<a id='L10267' name='L10267'></a> 10267                              s-&gt;slice.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, s-&gt;slice.y, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y,
<a id='L10268' name='L10268'></a> 10268                              s-&gt;slice.width, s-&gt;slice.height);
<a id='L10269' name='L10269'></a> 10269           XSetClipMask (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, s-&gt;gc, None);
<a id='L10270' name='L10270'></a> 10270         <em class='brace'>}</em>
<a id='L10271' name='L10271'></a> 10271       <strong class='reserved'>else</strong>
<a id='L10272' name='L10272'></a> 10272         <em class='brace'>{</em>
<a id='L10273' name='L10273'></a> 10273           XCopyArea (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, s-&gt;img-&gt;pixmap, pixmap, s-&gt;gc,
<a id='L10274' name='L10274'></a> 10274                      s-&gt;slice.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, s-&gt;slice.y,
<a id='L10275' name='L10275'></a> 10275                      s-&gt;slice.width, s-&gt;slice.height, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y);
<a id='L10276' name='L10276'></a> 10276 
<a id='L10277' name='L10277'></a> 10277           <em class='comment'>/* When the image has a mask, we can expect that at</em>
<a id='L10278' name='L10278'></a> 10278 <em class='comment'>             least part of a mouse highlight or a block cursor will</em>
<a id='L10279' name='L10279'></a> 10279 <em class='comment'>             be visible.  If the image doesn't have a mask, make</em>
<a id='L10280' name='L10280'></a> 10280 <em class='comment'>             a block cursor visible by drawing a rectangle around</em>
<a id='L10281' name='L10281'></a> 10281 <em class='comment'>             the image.  I believe it's looking better if we do</em>
<a id='L10282' name='L10282'></a> 10282 <em class='comment'>             nothing here for mouse-face.  */</em>
<a id='L10283' name='L10283'></a> 10283           <strong class='reserved'>if</strong> (s-&gt;hl == <a href='../S/2315.html#L1326' title='Defined at 1326 in src/dispextern.h.'>DRAW_CURSOR</a>)
<a id='L10284' name='L10284'></a> 10284             <em class='brace'>{</em>
<a id='L10285' name='L10285'></a> 10285               <strong class='reserved'>int</strong> r = <a href='../D/10870.html' title='Multiple defined in 2 places.'>eabs</a> (s-&gt;img-&gt;<a href='../D/16285.html' title='Multiple defined in 4 places.'>relief</a>);
<a id='L10286' name='L10286'></a> 10286               <a href='../S/2289.html#L6625' title='Defined at 6625 in src/xterm.c.'>x_draw_rectangle</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, s-&gt;gc, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> - r, y - r,
<a id='L10287' name='L10287'></a> 10287                               s-&gt;slice.width + r*2 - 1,
<a id='L10288' name='L10288'></a> 10288                               s-&gt;slice.height + r*2 - 1);
<a id='L10289' name='L10289'></a> 10289             <em class='brace'>}</em>
<a id='L10290' name='L10290'></a> 10290         <em class='brace'>}</em>
<a id='L10291' name='L10291'></a> 10291     <em class='brace'>}</em>
<a id='L10292' name='L10292'></a> 10292   <strong class='reserved'>else</strong>
<a id='L10293' name='L10293'></a> 10293     <em class='comment'>/* Draw a rectangle if image could not be loaded.  */</em>
<a id='L10294' name='L10294'></a> 10294     <a href='../S/2289.html#L6625' title='Defined at 6625 in src/xterm.c.'>x_draw_rectangle</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, s-&gt;gc, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y,
<a id='L10295' name='L10295'></a> 10295                     s-&gt;slice.width - 1, s-&gt;slice.height - 1);
<a id='L10296' name='L10296'></a> 10296 <em class='brace'>}</em>
<a id='L10297' name='L10297'></a> 10297 <em class='sharp'>#endif</em>  <em class='comment'>/* ! USE_CAIRO */</em>
<a id='L10298' name='L10298'></a> 10298 
<a id='L10299' name='L10299'></a> 10299 
<a id='L10300' name='L10300'></a> 10300 <em class='comment'>/* Draw part of the background of glyph string S.  X, Y, W, and H</em>
<a id='L10301' name='L10301'></a> 10301 <em class='comment'>   give the rectangle to draw.  */</em>
<a id='L10302' name='L10302'></a> 10302 
<a id='L10303' name='L10303'></a> 10303 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L10304' name='L10304'></a> 10304 <a href='../R/18155.html' title='Multiple referred from 3 places.'>x_draw_glyph_string_bg_rect</a> (<strong class='reserved'>struct</strong> <a href='../S/2315.html#L1336' title='Defined at 1336 in src/dispextern.h.'>glyph_string</a> *s, <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, <strong class='reserved'>int</strong> y, <strong class='reserved'>int</strong> w, <strong class='reserved'>int</strong> h)
<a id='L10305' name='L10305'></a> 10305 <em class='brace'>{</em>
<a id='L10306' name='L10306'></a> 10306   <strong class='reserved'>if</strong> (s-&gt;stippled_p)
<a id='L10307' name='L10307'></a> 10307     <em class='brace'>{</em>
<a id='L10308' name='L10308'></a> 10308       <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> = <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L10309' name='L10309'></a> 10309 
<a id='L10310' name='L10310'></a> 10310       <em class='comment'>/* Fill background with a stipple pattern.  */</em>
<a id='L10311' name='L10311'></a> 10311       XSetFillStyle (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, s-&gt;gc, FillOpaqueStippled);
<a id='L10312' name='L10312'></a> 10312       <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, s-&gt;gc, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, w, h, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L10313' name='L10313'></a> 10313       XSetFillStyle (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, s-&gt;gc, FillSolid);
<a id='L10314' name='L10314'></a> 10314     <em class='brace'>}</em>
<a id='L10315' name='L10315'></a> 10315   <strong class='reserved'>else</strong>
<a id='L10316' name='L10316'></a> 10316     <a href='../S/2289.html#L8364' title='Defined at 8364 in src/xterm.c.'>x_clear_glyph_string_rect</a> (s, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, w, h);
<a id='L10317' name='L10317'></a> 10317 <em class='brace'>}</em>
<a id='L10318' name='L10318'></a> 10318 
<a id='L10319' name='L10319'></a> 10319 
<a id='L10320' name='L10320'></a> 10320 <em class='comment'>/* Draw image glyph string S.</em>
<a id='L10321' name='L10321'></a> 10321 <em class='comment'></em>
<a id='L10322' name='L10322'></a> 10322 <em class='comment'>            s-&gt;y</em>
<a id='L10323' name='L10323'></a> 10323 <em class='comment'>   s-&gt;x      +-------------------------</em>
<a id='L10324' name='L10324'></a> 10324 <em class='comment'>             |   s-&gt;face-&gt;box</em>
<a id='L10325' name='L10325'></a> 10325 <em class='comment'>             |</em>
<a id='L10326' name='L10326'></a> 10326 <em class='comment'>             |     +-------------------------</em>
<a id='L10327' name='L10327'></a> 10327 <em class='comment'>             |     |  s-&gt;img-&gt;margin</em>
<a id='L10328' name='L10328'></a> 10328 <em class='comment'>             |     |</em>
<a id='L10329' name='L10329'></a> 10329 <em class='comment'>             |     |       +-------------------</em>
<a id='L10330' name='L10330'></a> 10330 <em class='comment'>             |     |       |  the image</em>
<a id='L10331' name='L10331'></a> 10331 <em class='comment'></em>
<a id='L10332' name='L10332'></a> 10332 <em class='comment'> */</em>
<a id='L10333' name='L10333'></a> 10333 
<a id='L10334' name='L10334'></a> 10334 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L10335' name='L10335'></a> 10335 <a href='../S/2289.html#L10744' title='Referred from 10744 in src/xterm.c.'>x_draw_image_glyph_string</a> (<strong class='reserved'>struct</strong> <a href='../S/2315.html#L1336' title='Defined at 1336 in src/dispextern.h.'>glyph_string</a> *s)
<a id='L10336' name='L10336'></a> 10336 <em class='brace'>{</em>
<a id='L10337' name='L10337'></a> 10337   <strong class='reserved'>int</strong> box_line_hwidth = <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;box_vertical_line_width, 0);
<a id='L10338' name='L10338'></a> 10338   <strong class='reserved'>int</strong> box_line_vwidth = <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;box_horizontal_line_width, 0);
<a id='L10339' name='L10339'></a> 10339   <strong class='reserved'>int</strong> height;
<a id='L10340' name='L10340'></a> 10340 <em class='sharp'>#ifndef</em> USE_CAIRO
<a id='L10341' name='L10341'></a> 10341   <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> = <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L10342' name='L10342'></a> 10342   <a href='../D/5058.html' title='Multiple defined in 2 places.'>Pixmap</a> pixmap = None;
<a id='L10343' name='L10343'></a> 10343 <em class='sharp'>#endif</em>
<a id='L10344' name='L10344'></a> 10344 
<a id='L10345' name='L10345'></a> 10345   height = s-&gt;height;
<a id='L10346' name='L10346'></a> 10346   <strong class='reserved'>if</strong> (s-&gt;slice.y == 0)
<a id='L10347' name='L10347'></a> 10347     height -= box_line_vwidth;
<a id='L10348' name='L10348'></a> 10348   <strong class='reserved'>if</strong> (s-&gt;slice.y + s-&gt;slice.height &gt;= s-&gt;img-&gt;height)
<a id='L10349' name='L10349'></a> 10349     height -= box_line_vwidth;
<a id='L10350' name='L10350'></a> 10350 
<a id='L10351' name='L10351'></a> 10351   <em class='comment'>/* Fill background with face under the image.  Do it only if row is</em>
<a id='L10352' name='L10352'></a> 10352 <em class='comment'>     taller than image or if image has a clip mask to reduce</em>
<a id='L10353' name='L10353'></a> 10353 <em class='comment'>     flickering.  */</em>
<a id='L10354' name='L10354'></a> 10354   s-&gt;stippled_p = s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;stipple != 0;
<a id='L10355' name='L10355'></a> 10355   <strong class='reserved'>if</strong> (height &gt; s-&gt;slice.height
<a id='L10356' name='L10356'></a> 10356       || s-&gt;img-&gt;hmargin
<a id='L10357' name='L10357'></a> 10357       || s-&gt;img-&gt;vmargin
<a id='L10358' name='L10358'></a> 10358       || s-&gt;img-&gt;mask
<a id='L10359' name='L10359'></a> 10359       || s-&gt;img-&gt;pixmap == 0
<a id='L10360' name='L10360'></a> 10360       || s-&gt;width != s-&gt;background_width)
<a id='L10361' name='L10361'></a> 10361     <em class='brace'>{</em>
<a id='L10362' name='L10362'></a> 10362       <strong class='reserved'>if</strong> (s-&gt;stippled_p)
<a id='L10363' name='L10363'></a> 10363         s-&gt;row-&gt;stipple_p = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L10364' name='L10364'></a> 10364 
<a id='L10365' name='L10365'></a> 10365 <em class='sharp'>#ifndef</em> USE_CAIRO
<a id='L10366' name='L10366'></a> 10366       <strong class='reserved'>if</strong> (s-&gt;img-&gt;mask)
<a id='L10367' name='L10367'></a> 10367         <em class='brace'>{</em>
<a id='L10368' name='L10368'></a> 10368           <em class='comment'>/* Create a pixmap as large as the glyph string.  Fill it</em>
<a id='L10369' name='L10369'></a> 10369 <em class='comment'>             with the background color.  Copy the image to it, using</em>
<a id='L10370' name='L10370'></a> 10370 <em class='comment'>             its mask.  Copy the temporary pixmap to the display.  */</em>
<a id='L10371' name='L10371'></a> 10371           <strong class='reserved'>int</strong> depth = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;n_planes;
<a id='L10372' name='L10372'></a> 10372 
<a id='L10373' name='L10373'></a> 10373           <em class='comment'>/* Create a pixmap as large as the glyph string.  */</em>
<a id='L10374' name='L10374'></a> 10374           pixmap = XCreatePixmap (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../S/2212.html#L1352' title='Defined at 1352 in src/xterm.h.'>FRAME_X_DRAWABLE</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L10375' name='L10375'></a> 10375                                   s-&gt;background_width,
<a id='L10376' name='L10376'></a> 10376                                   s-&gt;height, depth);
<a id='L10377' name='L10377'></a> 10377 
<a id='L10378' name='L10378'></a> 10378           <em class='comment'>/* Don't clip in the following because we're working on the</em>
<a id='L10379' name='L10379'></a> 10379 <em class='comment'>             pixmap.  */</em>
<a id='L10380' name='L10380'></a> 10380           XSetClipMask (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, s-&gt;gc, None);
<a id='L10381' name='L10381'></a> 10381 
<a id='L10382' name='L10382'></a> 10382           <em class='comment'>/* Fill the pixmap with the background color/stipple.  */</em>
<a id='L10383' name='L10383'></a> 10383           <strong class='reserved'>if</strong> (s-&gt;stippled_p)
<a id='L10384' name='L10384'></a> 10384             <em class='brace'>{</em>
<a id='L10385' name='L10385'></a> 10385               <em class='comment'>/* Fill background with a stipple pattern.  */</em>
<a id='L10386' name='L10386'></a> 10386               XSetFillStyle (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, s-&gt;gc, FillOpaqueStippled);
<a id='L10387' name='L10387'></a> 10387               XSetTSOrigin (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, s-&gt;gc, - s-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, - s-&gt;y);
<a id='L10388' name='L10388'></a> 10388               XFillRectangle (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, pixmap, s-&gt;gc,
<a id='L10389' name='L10389'></a> 10389                               0, 0, s-&gt;background_width, s-&gt;height);
<a id='L10390' name='L10390'></a> 10390               XSetFillStyle (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, s-&gt;gc, FillSolid);
<a id='L10391' name='L10391'></a> 10391               XSetTSOrigin (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, s-&gt;gc, 0, 0);
<a id='L10392' name='L10392'></a> 10392             <em class='brace'>}</em>
<a id='L10393' name='L10393'></a> 10393           <strong class='reserved'>else</strong>
<a id='L10394' name='L10394'></a> 10394             <em class='brace'>{</em>
<a id='L10395' name='L10395'></a> 10395               XGCValues xgcv;
<a id='L10396' name='L10396'></a> 10396 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XRENDER &amp;&amp; (RENDER_MAJOR &gt; 0 || (RENDER_MINOR &gt;= 2))
<a id='L10397' name='L10397'></a> 10397               <strong class='reserved'>if</strong> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;alpha_bits
<a id='L10398' name='L10398'></a> 10398                   &amp;&amp; s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;alpha_background != 1.0
<a id='L10399' name='L10399'></a> 10399                   &amp;&amp; <a href='../S/2212.html#L1447' title='Defined at 1447 in src/xterm.h.'>FRAME_CHECK_XR_VERSION</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 0, 2)
<a id='L10400' name='L10400'></a> 10400                   &amp;&amp; <a href='../S/2212.html#L1445' title='Defined at 1445 in src/xterm.h.'>FRAME_X_PICTURE_FORMAT</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L10401' name='L10401'></a> 10401                 <em class='brace'>{</em>
<a id='L10402' name='L10402'></a> 10402                   XRenderColor xc;
<a id='L10403' name='L10403'></a> 10403                   XRenderPictureAttributes attrs;
<a id='L10404' name='L10404'></a> 10404                   <a href='../S/2204.html#L1049' title='Defined at 1049 in src/image.c.'>Picture</a> pict;
<a id='L10405' name='L10405'></a> 10405                   memset (&amp;attrs, 0, <strong class='reserved'>sizeof</strong> attrs);
<a id='L10406' name='L10406'></a> 10406 
<a id='L10407' name='L10407'></a> 10407                   pict = XRenderCreatePicture (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, pixmap,
<a id='L10408' name='L10408'></a> 10408                                                <a href='../S/2212.html#L1445' title='Defined at 1445 in src/xterm.h.'>FRAME_X_PICTURE_FORMAT</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L10409' name='L10409'></a> 10409                                                0, &amp;attrs);
<a id='L10410' name='L10410'></a> 10410                   <a href='../S/2289.html#L6436' title='Defined at 6436 in src/xterm.c.'>x_xrender_color_from_gc_background</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, s-&gt;gc, &amp;xc, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L10411' name='L10411'></a> 10411                   XRenderFillRectangle (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), PictOpSrc, pict,
<a id='L10412' name='L10412'></a> 10412                                         &amp;xc, 0, 0, s-&gt;background_width, s-&gt;height);
<a id='L10413' name='L10413'></a> 10413                   XRenderFreePicture (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, pict);
<a id='L10414' name='L10414'></a> 10414                 <em class='brace'>}</em>
<a id='L10415' name='L10415'></a> 10415               <strong class='reserved'>else</strong>
<a id='L10416' name='L10416'></a> 10416 <em class='sharp'>#endif</em>
<a id='L10417' name='L10417'></a> 10417                 <em class='brace'>{</em>
<a id='L10418' name='L10418'></a> 10418                   <a href='../S/2215.html#L271' title='Defined at 271 in src/w32term.c.'>XGetGCValues</a> (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, s-&gt;gc, <a href='../S/2315.html#L89' title='Defined at 89 in src/dispextern.h.'>GCForeground</a> | <a href='../S/2315.html#L90' title='Defined at 90 in src/dispextern.h.'>GCBackground</a>,
<a id='L10419' name='L10419'></a> 10419                                 &amp;xgcv);
<a id='L10420' name='L10420'></a> 10420                   XSetForeground (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, s-&gt;gc, xgcv.background);
<a id='L10421' name='L10421'></a> 10421                   XFillRectangle (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, pixmap, s-&gt;gc,
<a id='L10422' name='L10422'></a> 10422                                   0, 0, s-&gt;background_width, s-&gt;height);
<a id='L10423' name='L10423'></a> 10423                   XSetForeground (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, s-&gt;gc, xgcv.foreground);
<a id='L10424' name='L10424'></a> 10424                 <em class='brace'>}</em>
<a id='L10425' name='L10425'></a> 10425             <em class='brace'>}</em>
<a id='L10426' name='L10426'></a> 10426         <em class='brace'>}</em>
<a id='L10427' name='L10427'></a> 10427       <strong class='reserved'>else</strong>
<a id='L10428' name='L10428'></a> 10428 <em class='sharp'>#endif</em>  <em class='comment'>/* ! USE_CAIRO */</em>
<a id='L10429' name='L10429'></a> 10429         <em class='brace'>{</em>
<a id='L10430' name='L10430'></a> 10430           <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = s-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L10431' name='L10431'></a> 10431           <strong class='reserved'>int</strong> y = s-&gt;y;
<a id='L10432' name='L10432'></a> 10432           <strong class='reserved'>int</strong> width = s-&gt;background_width;
<a id='L10433' name='L10433'></a> 10433 
<a id='L10434' name='L10434'></a> 10434           <strong class='reserved'>if</strong> (s-&gt;first_glyph-&gt;left_box_line_p
<a id='L10435' name='L10435'></a> 10435               &amp;&amp; s-&gt;slice.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> == 0)
<a id='L10436' name='L10436'></a> 10436             <em class='brace'>{</em>
<a id='L10437' name='L10437'></a> 10437               <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> += box_line_hwidth;
<a id='L10438' name='L10438'></a> 10438               width -= box_line_hwidth;
<a id='L10439' name='L10439'></a> 10439             <em class='brace'>}</em>
<a id='L10440' name='L10440'></a> 10440 
<a id='L10441' name='L10441'></a> 10441           <strong class='reserved'>if</strong> (s-&gt;slice.y == 0)
<a id='L10442' name='L10442'></a> 10442             y += box_line_vwidth;
<a id='L10443' name='L10443'></a> 10443 
<a id='L10444' name='L10444'></a> 10444           <a href='../S/2289.html#L10304' title='Defined at 10304 in src/xterm.c.'>x_draw_glyph_string_bg_rect</a> (s, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, width, height);
<a id='L10445' name='L10445'></a> 10445         <em class='brace'>}</em>
<a id='L10446' name='L10446'></a> 10446 
<a id='L10447' name='L10447'></a> 10447       s-&gt;background_filled_p = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L10448' name='L10448'></a> 10448     <em class='brace'>}</em>
<a id='L10449' name='L10449'></a> 10449 
<a id='L10450' name='L10450'></a> 10450   <em class='comment'>/* Draw the foreground.  */</em>
<a id='L10451' name='L10451'></a> 10451 <em class='sharp'>#ifndef</em> USE_CAIRO
<a id='L10452' name='L10452'></a> 10452   <strong class='reserved'>if</strong> (pixmap != None)
<a id='L10453' name='L10453'></a> 10453     <em class='brace'>{</em>
<a id='L10454' name='L10454'></a> 10454       <a href='../S/2289.html#L10222' title='Defined at 10222 in src/xterm.c.'>x_draw_image_foreground_1</a> (s, pixmap);
<a id='L10455' name='L10455'></a> 10455       <a href='../S/2289.html#L8296' title='Defined at 8296 in src/xterm.c.'>x_set_glyph_string_clipping</a> (s);
<a id='L10456' name='L10456'></a> 10456       XCopyArea (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, pixmap, <a href='../S/2212.html#L1352' title='Defined at 1352 in src/xterm.h.'>FRAME_X_DRAWABLE</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), s-&gt;gc,
<a id='L10457' name='L10457'></a> 10457                  0, 0, s-&gt;background_width, s-&gt;height, s-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, s-&gt;y);
<a id='L10458' name='L10458'></a> 10458       XFreePixmap (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, pixmap);
<a id='L10459' name='L10459'></a> 10459     <em class='brace'>}</em>
<a id='L10460' name='L10460'></a> 10460   <strong class='reserved'>else</strong>
<a id='L10461' name='L10461'></a> 10461 <em class='sharp'>#endif</em>  <em class='comment'>/* ! USE_CAIRO */</em>
<a id='L10462' name='L10462'></a> 10462     <a href='../S/2289.html#L10005' title='Defined at 10005 in src/xterm.c.'>x_draw_image_foreground</a> (s);
<a id='L10463' name='L10463'></a> 10463 
<a id='L10464' name='L10464'></a> 10464   <em class='comment'>/* If we must draw a relief around the image, do it.  */</em>
<a id='L10465' name='L10465'></a> 10465   <strong class='reserved'>if</strong> (s-&gt;img-&gt;<a href='../D/16285.html' title='Multiple defined in 4 places.'>relief</a>
<a id='L10466' name='L10466'></a> 10466       || s-&gt;hl == <a href='../S/2315.html#L1328' title='Defined at 1328 in src/dispextern.h.'>DRAW_IMAGE_RAISED</a>
<a id='L10467' name='L10467'></a> 10467       || s-&gt;hl == <a href='../S/2315.html#L1329' title='Defined at 1329 in src/dispextern.h.'>DRAW_IMAGE_SUNKEN</a>)
<a id='L10468' name='L10468'></a> 10468     <a href='../S/2289.html#L10128' title='Defined at 10128 in src/xterm.c.'>x_draw_image_relief</a> (s);
<a id='L10469' name='L10469'></a> 10469 <em class='brace'>}</em>
<a id='L10470' name='L10470'></a> 10470 
<a id='L10471' name='L10471'></a> 10471 
<a id='L10472' name='L10472'></a> 10472 <em class='comment'>/* Draw stretch glyph string S.  */</em>
<a id='L10473' name='L10473'></a> 10473 
<a id='L10474' name='L10474'></a> 10474 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L10475' name='L10475'></a> 10475 <a href='../R/18166.html' title='Multiple referred from 2 places.'>x_draw_stretch_glyph_string</a> (<strong class='reserved'>struct</strong> <a href='../S/2315.html#L1336' title='Defined at 1336 in src/dispextern.h.'>glyph_string</a> *s)
<a id='L10476' name='L10476'></a> 10476 <em class='brace'>{</em>
<a id='L10477' name='L10477'></a> 10477   <a href='../D/10871.html' title='Multiple defined in 5 places.'>eassert</a> (s-&gt;first_glyph-&gt;type == <a href='../S/2315.html#L428' title='Defined at 428 in src/dispextern.h.'>STRETCH_GLYPH</a>);
<a id='L10478' name='L10478'></a> 10478 
<a id='L10479' name='L10479'></a> 10479   <strong class='reserved'>if</strong> (s-&gt;hl == <a href='../S/2315.html#L1326' title='Defined at 1326 in src/dispextern.h.'>DRAW_CURSOR</a>
<a id='L10480' name='L10480'></a> 10480       &amp;&amp; !x_stretch_cursor_p)
<a id='L10481' name='L10481'></a> 10481     <em class='brace'>{</em>
<a id='L10482' name='L10482'></a> 10482       <em class='comment'>/* If `x-stretch-cursor' is nil, don't draw a block cursor as</em>
<a id='L10483' name='L10483'></a> 10483 <em class='comment'>         wide as the stretch glyph.  */</em>
<a id='L10484' name='L10484'></a> 10484       <strong class='reserved'>int</strong> width, background_width = s-&gt;background_width;
<a id='L10485' name='L10485'></a> 10485       <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = s-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L10486' name='L10486'></a> 10486 
<a id='L10487' name='L10487'></a> 10487       <strong class='reserved'>if</strong> (!s-&gt;row-&gt;reversed_p)
<a id='L10488' name='L10488'></a> 10488         <em class='brace'>{</em>
<a id='L10489' name='L10489'></a> 10489           <strong class='reserved'>int</strong> left_x = <a href='../S/2224.html#L1340' title='Defined at 1340 in src/xdisp.c.'>window_box_left_offset</a> (s-&gt;w, <a href='../S/2315.html#L859' title='Defined at 859 in src/dispextern.h.'>TEXT_AREA</a>);
<a id='L10490' name='L10490'></a> 10490 
<a id='L10491' name='L10491'></a> 10491           <strong class='reserved'>if</strong> (<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> &lt; left_x)
<a id='L10492' name='L10492'></a> 10492             <em class='brace'>{</em>
<a id='L10493' name='L10493'></a> 10493               background_width -= left_x - <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L10494' name='L10494'></a> 10494               <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = left_x;
<a id='L10495' name='L10495'></a> 10495             <em class='brace'>}</em>
<a id='L10496' name='L10496'></a> 10496         <em class='brace'>}</em>
<a id='L10497' name='L10497'></a> 10497       <strong class='reserved'>else</strong>
<a id='L10498' name='L10498'></a> 10498         <em class='brace'>{</em>
<a id='L10499' name='L10499'></a> 10499           <em class='comment'>/* In R2L rows, draw the cursor on the right edge of the</em>
<a id='L10500' name='L10500'></a> 10500 <em class='comment'>             stretch glyph.  */</em>
<a id='L10501' name='L10501'></a> 10501           <strong class='reserved'>int</strong> right_x = <a href='../S/2224.html#L1405' title='Defined at 1405 in src/xdisp.c.'>window_box_right</a> (s-&gt;w, <a href='../S/2315.html#L859' title='Defined at 859 in src/dispextern.h.'>TEXT_AREA</a>);
<a id='L10502' name='L10502'></a> 10502 
<a id='L10503' name='L10503'></a> 10503           <strong class='reserved'>if</strong> (<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + background_width &gt; right_x)
<a id='L10504' name='L10504'></a> 10504             background_width -= <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> - right_x;
<a id='L10505' name='L10505'></a> 10505           <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> += background_width;
<a id='L10506' name='L10506'></a> 10506         <em class='brace'>}</em>
<a id='L10507' name='L10507'></a> 10507       width = <a href='../D/14475.html' title='Multiple defined in 11 places.'>min</a> (<a href='../S/2183.html#L1547' title='Defined at 1547 in src/frame.h.'>FRAME_COLUMN_WIDTH</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), background_width);
<a id='L10508' name='L10508'></a> 10508       <strong class='reserved'>if</strong> (s-&gt;row-&gt;reversed_p)
<a id='L10509' name='L10509'></a> 10509         <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> -= width;
<a id='L10510' name='L10510'></a> 10510 
<a id='L10511' name='L10511'></a> 10511       <em class='comment'>/* Draw cursor.  */</em>
<a id='L10512' name='L10512'></a> 10512       <a href='../S/2289.html#L10304' title='Defined at 10304 in src/xterm.c.'>x_draw_glyph_string_bg_rect</a> (s, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, s-&gt;y, width, s-&gt;height);
<a id='L10513' name='L10513'></a> 10513 
<a id='L10514' name='L10514'></a> 10514       <em class='comment'>/* Clear rest using the GC of the original non-cursor face.  */</em>
<a id='L10515' name='L10515'></a> 10515       <strong class='reserved'>if</strong> (width &lt; background_width)
<a id='L10516' name='L10516'></a> 10516         <em class='brace'>{</em>
<a id='L10517' name='L10517'></a> 10517           <strong class='reserved'>int</strong> y = s-&gt;y;
<a id='L10518' name='L10518'></a> 10518           <strong class='reserved'>int</strong> w = background_width - width, h = s-&gt;height;
<a id='L10519' name='L10519'></a> 10519           <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> = <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L10520' name='L10520'></a> 10520           <a href='../S/2150.html#L62' title='Defined at 62 in src/pgtkgui.h.'>XRectangle</a> r;
<a id='L10521' name='L10521'></a> 10521           <a href='../D/2619.html' title='Multiple defined in 2 places.'>GC</a> gc;
<a id='L10522' name='L10522'></a> 10522 
<a id='L10523' name='L10523'></a> 10523           <strong class='reserved'>if</strong> (!s-&gt;row-&gt;reversed_p)
<a id='L10524' name='L10524'></a> 10524             <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> += width;
<a id='L10525' name='L10525'></a> 10525           <strong class='reserved'>else</strong>
<a id='L10526' name='L10526'></a> 10526             <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = s-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L10527' name='L10527'></a> 10527           <strong class='reserved'>if</strong> (s-&gt;row-&gt;mouse_face_p
<a id='L10528' name='L10528'></a> 10528               &amp;&amp; <a href='../S/2224.html#L34079' title='Defined at 34079 in src/xdisp.c.'>cursor_in_mouse_face_p</a> (s-&gt;w))
<a id='L10529' name='L10529'></a> 10529             <em class='brace'>{</em>
<a id='L10530' name='L10530'></a> 10530               <a href='../S/2289.html#L8203' title='Defined at 8203 in src/xterm.c.'>x_set_mouse_face_gc</a> (s);
<a id='L10531' name='L10531'></a> 10531               gc = s-&gt;gc;
<a id='L10532' name='L10532'></a> 10532             <em class='brace'>}</em>
<a id='L10533' name='L10533'></a> 10533           <strong class='reserved'>else</strong>
<a id='L10534' name='L10534'></a> 10534             gc = s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;gc;
<a id='L10535' name='L10535'></a> 10535 
<a id='L10536' name='L10536'></a> 10536           <a href='../S/2224.html#L2635' title='Defined at 2635 in src/xdisp.c.'>get_glyph_string_clip_rect</a> (s, &amp;r);
<a id='L10537' name='L10537'></a> 10537           <a href='../S/2289.html#L6374' title='Defined at 6374 in src/xterm.c.'>x_set_clip_rectangles</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, &amp;r, 1);
<a id='L10538' name='L10538'></a> 10538 
<a id='L10539' name='L10539'></a> 10539           <strong class='reserved'>if</strong> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;stipple)
<a id='L10540' name='L10540'></a> 10540             <em class='brace'>{</em>
<a id='L10541' name='L10541'></a> 10541               <em class='comment'>/* Fill background with a stipple pattern.  */</em>
<a id='L10542' name='L10542'></a> 10542               XSetFillStyle (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, gc, FillOpaqueStippled);
<a id='L10543' name='L10543'></a> 10543               <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, w, h, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L10544' name='L10544'></a> 10544               XSetFillStyle (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, gc, FillSolid);
<a id='L10545' name='L10545'></a> 10545 
<a id='L10546' name='L10546'></a> 10546               s-&gt;row-&gt;stipple_p = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L10547' name='L10547'></a> 10547             <em class='brace'>}</em>
<a id='L10548' name='L10548'></a> 10548           <strong class='reserved'>else</strong>
<a id='L10549' name='L10549'></a> 10549             <em class='brace'>{</em>
<a id='L10550' name='L10550'></a> 10550               XGCValues xgcv;
<a id='L10551' name='L10551'></a> 10551               <a href='../S/2215.html#L271' title='Defined at 271 in src/w32term.c.'>XGetGCValues</a> (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, gc, <a href='../S/2315.html#L89' title='Defined at 89 in src/dispextern.h.'>GCForeground</a> | <a href='../S/2315.html#L90' title='Defined at 90 in src/dispextern.h.'>GCBackground</a>, &amp;xgcv);
<a id='L10552' name='L10552'></a> 10552               XSetForeground (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, gc, xgcv.background);
<a id='L10553' name='L10553'></a> 10553               <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, w, h, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L10554' name='L10554'></a> 10554               XSetForeground (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, gc, xgcv.foreground);
<a id='L10555' name='L10555'></a> 10555             <em class='brace'>}</em>
<a id='L10556' name='L10556'></a> 10556 
<a id='L10557' name='L10557'></a> 10557           <a href='../S/2289.html#L6390' title='Defined at 6390 in src/xterm.c.'>x_reset_clip_rectangles</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc);
<a id='L10558' name='L10558'></a> 10558         <em class='brace'>}</em>
<a id='L10559' name='L10559'></a> 10559     <em class='brace'>}</em>
<a id='L10560' name='L10560'></a> 10560   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (!s-&gt;background_filled_p)
<a id='L10561' name='L10561'></a> 10561     <em class='brace'>{</em>
<a id='L10562' name='L10562'></a> 10562       <strong class='reserved'>int</strong> background_width = s-&gt;background_width;
<a id='L10563' name='L10563'></a> 10563       <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = s-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, text_left_x = <a href='../S/2224.html#L1385' title='Defined at 1385 in src/xdisp.c.'>window_box_left</a> (s-&gt;w, <a href='../S/2315.html#L859' title='Defined at 859 in src/dispextern.h.'>TEXT_AREA</a>);
<a id='L10564' name='L10564'></a> 10564 
<a id='L10565' name='L10565'></a> 10565       <em class='comment'>/* Don't draw into left fringe or scrollbar area except for</em>
<a id='L10566' name='L10566'></a> 10566 <em class='comment'>         header line and mode line.  */</em>
<a id='L10567' name='L10567'></a> 10567       <strong class='reserved'>if</strong> (s-&gt;area == <a href='../S/2315.html#L859' title='Defined at 859 in src/dispextern.h.'>TEXT_AREA</a>
<a id='L10568' name='L10568'></a> 10568           &amp;&amp; <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> &lt; text_left_x &amp;&amp; !s-&gt;row-&gt;mode_line_p)
<a id='L10569' name='L10569'></a> 10569         <em class='brace'>{</em>
<a id='L10570' name='L10570'></a> 10570           background_width -= text_left_x - <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L10571' name='L10571'></a> 10571           <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = text_left_x;
<a id='L10572' name='L10572'></a> 10572         <em class='brace'>}</em>
<a id='L10573' name='L10573'></a> 10573 
<a id='L10574' name='L10574'></a> 10574       <strong class='reserved'>if</strong> (!s-&gt;row-&gt;stipple_p)
<a id='L10575' name='L10575'></a> 10575         s-&gt;row-&gt;stipple_p = s-&gt;stippled_p;
<a id='L10576' name='L10576'></a> 10576 
<a id='L10577' name='L10577'></a> 10577       <strong class='reserved'>if</strong> (background_width &gt; 0)
<a id='L10578' name='L10578'></a> 10578         <a href='../S/2289.html#L10304' title='Defined at 10304 in src/xterm.c.'>x_draw_glyph_string_bg_rect</a> (s, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, s-&gt;y,
<a id='L10579' name='L10579'></a> 10579                                      background_width, s-&gt;height);
<a id='L10580' name='L10580'></a> 10580     <em class='brace'>}</em>
<a id='L10581' name='L10581'></a> 10581 
<a id='L10582' name='L10582'></a> 10582   s-&gt;background_filled_p = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L10583' name='L10583'></a> 10583 <em class='brace'>}</em>
<a id='L10584' name='L10584'></a> 10584 
<a id='L10585' name='L10585'></a> 10585 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L10586' name='L10586'></a> 10586 <a href='../S/2289.html#L10620' title='Referred from 10620 in src/xterm.c.'>x_get_scale_factor</a> (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *disp, <strong class='reserved'>int</strong> *scale_x, <strong class='reserved'>int</strong> *scale_y)
<a id='L10587' name='L10587'></a> 10587 <em class='brace'>{</em>
<a id='L10588' name='L10588'></a> 10588   <strong class='reserved'>const</strong> <strong class='reserved'>int</strong> base_res = 96;
<a id='L10589' name='L10589'></a> 10589   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> * dpyinfo = <a href='../S/2289.html#L6774' title='Defined at 6774 in src/xterm.c.'>x_display_info_for_display</a> (disp);
<a id='L10590' name='L10590'></a> 10590 
<a id='L10591' name='L10591'></a> 10591   *scale_x = *scale_y = 1;
<a id='L10592' name='L10592'></a> 10592 
<a id='L10593' name='L10593'></a> 10593   <strong class='reserved'>if</strong> (dpyinfo)
<a id='L10594' name='L10594'></a> 10594     <em class='brace'>{</em>
<a id='L10595' name='L10595'></a> 10595       <strong class='reserved'>if</strong> (dpyinfo-&gt;resx &gt; base_res)
<a id='L10596' name='L10596'></a> 10596         *scale_x = <a href='../D/11518.html' title='Multiple defined in 2 places.'>floor</a> (dpyinfo-&gt;resx / base_res);
<a id='L10597' name='L10597'></a> 10597       <strong class='reserved'>if</strong> (dpyinfo-&gt;resy &gt; base_res)
<a id='L10598' name='L10598'></a> 10598         *scale_y = <a href='../D/11518.html' title='Multiple defined in 2 places.'>floor</a> (dpyinfo-&gt;resy / base_res);
<a id='L10599' name='L10599'></a> 10599     <em class='brace'>}</em>
<a id='L10600' name='L10600'></a> 10600 <em class='brace'>}</em>
<a id='L10601' name='L10601'></a> 10601 
<a id='L10602' name='L10602'></a> 10602 <em class='comment'>/*</em>
<a id='L10603' name='L10603'></a> 10603 <em class='comment'>   Draw a wavy line under S. The wave fills wave_height pixels from y0.</em>
<a id='L10604' name='L10604'></a> 10604 <em class='comment'></em>
<a id='L10605' name='L10605'></a> 10605 <em class='comment'>                    x0         wave_length = 2</em>
<a id='L10606' name='L10606'></a> 10606 <em class='comment'>                                 --</em>
<a id='L10607' name='L10607'></a> 10607 <em class='comment'>                y0   *   *   *   *   *</em>
<a id='L10608' name='L10608'></a> 10608 <em class='comment'>                     |* * * * * * * * *</em>
<a id='L10609' name='L10609'></a> 10609 <em class='comment'>    wave_height = 3  | *   *   *   *</em>
<a id='L10610' name='L10610'></a> 10610 <em class='comment'></em>
<a id='L10611' name='L10611'></a> 10611 <em class='comment'>*/</em>
<a id='L10612' name='L10612'></a> 10612 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L10613' name='L10613'></a> 10613 <a href='../R/18167.html' title='Multiple referred from 2 places.'>x_draw_underwave</a> (<strong class='reserved'>struct</strong> <a href='../S/2315.html#L1336' title='Defined at 1336 in src/dispextern.h.'>glyph_string</a> *s, <strong class='reserved'>int</strong> decoration_width)
<a id='L10614' name='L10614'></a> 10614 <em class='brace'>{</em>
<a id='L10615' name='L10615'></a> 10615   <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> = <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L10616' name='L10616'></a> 10616 
<a id='L10617' name='L10617'></a> 10617   <em class='comment'>/* Adjust for scale/HiDPI.  */</em>
<a id='L10618' name='L10618'></a> 10618   <strong class='reserved'>int</strong> scale_x, scale_y;
<a id='L10619' name='L10619'></a> 10619 
<a id='L10620' name='L10620'></a> 10620   <a href='../S/2289.html#L10586' title='Defined at 10586 in src/xterm.c.'>x_get_scale_factor</a> (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, &amp;scale_x, &amp;scale_y);
<a id='L10621' name='L10621'></a> 10621 
<a id='L10622' name='L10622'></a> 10622   <strong class='reserved'>int</strong> wave_height = 3 * scale_y, wave_length = 2 * scale_x;
<a id='L10623' name='L10623'></a> 10623 
<a id='L10624' name='L10624'></a> 10624 <em class='sharp'>#ifdef</em> USE_CAIRO
<a id='L10625' name='L10625'></a> 10625   <a href='../S/2289.html#L6729' title='Defined at 6729 in src/xterm.c.'>x_draw_horizontal_wave</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, s-&gt;gc, s-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, s-&gt;ybase - wave_height + 3,
<a id='L10626' name='L10626'></a> 10626                           decoration_width, wave_height, wave_length);
<a id='L10627' name='L10627'></a> 10627 <em class='sharp'>#else</em>  <em class='comment'>/* not USE_CAIRO */</em>
<a id='L10628' name='L10628'></a> 10628   <strong class='reserved'>int</strong> dx, dy, x0, <a href='../D/20169.html' title='Multiple defined in 2 places.'>y0</a>, width, x1, <a href='../D/20170.html' title='Multiple defined in 2 places.'>y1</a>, x2, y2, <a href='../S/2885.html#L87' title='Defined at 87 in lib/xsize.h.'>xmax</a>, thickness = scale_y;;
<a id='L10629' name='L10629'></a> 10629   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> odd;
<a id='L10630' name='L10630'></a> 10630   <a href='../S/2150.html#L62' title='Defined at 62 in src/pgtkgui.h.'>XRectangle</a> wave_clip, string_clip, final_clip;
<a id='L10631' name='L10631'></a> 10631 
<a id='L10632' name='L10632'></a> 10632   dx = wave_length;
<a id='L10633' name='L10633'></a> 10633   dy = wave_height - 1;
<a id='L10634' name='L10634'></a> 10634   x0 = s-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L10635' name='L10635'></a> 10635   <a href='../D/20169.html' title='Multiple defined in 2 places.'>y0</a> = s-&gt;ybase + wave_height / 2 - scale_y;
<a id='L10636' name='L10636'></a> 10636   width = decoration_width;
<a id='L10637' name='L10637'></a> 10637   <a href='../S/2885.html#L87' title='Defined at 87 in lib/xsize.h.'>xmax</a> = x0 + width;
<a id='L10638' name='L10638'></a> 10638 
<a id='L10639' name='L10639'></a> 10639   <em class='comment'>/* Find and set clipping rectangle */</em>
<a id='L10640' name='L10640'></a> 10640 
<a id='L10641' name='L10641'></a> 10641   wave_clip.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = x0;
<a id='L10642' name='L10642'></a> 10642   wave_clip.y = <a href='../D/20169.html' title='Multiple defined in 2 places.'>y0</a>;
<a id='L10643' name='L10643'></a> 10643   wave_clip.width = width;
<a id='L10644' name='L10644'></a> 10644   wave_clip.height = wave_height;
<a id='L10645' name='L10645'></a> 10645   <a href='../S/2224.html#L2635' title='Defined at 2635 in src/xdisp.c.'>get_glyph_string_clip_rect</a> (s, &amp;string_clip);
<a id='L10646' name='L10646'></a> 10646 
<a id='L10647' name='L10647'></a> 10647   <strong class='reserved'>if</strong> (!<a href='../S/2224.html#L36555' title='Defined at 36555 in src/xdisp.c.'>gui_intersect_rectangles</a> (&amp;wave_clip, &amp;string_clip, &amp;final_clip))
<a id='L10648' name='L10648'></a> 10648     <strong class='reserved'>return</strong>;
<a id='L10649' name='L10649'></a> 10649 
<a id='L10650' name='L10650'></a> 10650   XSetClipRectangles (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, s-&gt;gc, 0, 0, &amp;final_clip, 1, Unsorted);
<a id='L10651' name='L10651'></a> 10651 
<a id='L10652' name='L10652'></a> 10652   <em class='comment'>/* Draw the waves */</em>
<a id='L10653' name='L10653'></a> 10653 
<a id='L10654' name='L10654'></a> 10654   x1 = x0 - (x0 % dx);
<a id='L10655' name='L10655'></a> 10655   x2 = x1 + dx;
<a id='L10656' name='L10656'></a> 10656   odd = (x1 / dx) &amp; 1;
<a id='L10657' name='L10657'></a> 10657   <a href='../D/20170.html' title='Multiple defined in 2 places.'>y1</a> = y2 = <a href='../D/20169.html' title='Multiple defined in 2 places.'>y0</a>;
<a id='L10658' name='L10658'></a> 10658 
<a id='L10659' name='L10659'></a> 10659   <strong class='reserved'>if</strong> (odd)
<a id='L10660' name='L10660'></a> 10660     <a href='../D/20170.html' title='Multiple defined in 2 places.'>y1</a> += dy;
<a id='L10661' name='L10661'></a> 10661   <strong class='reserved'>else</strong>
<a id='L10662' name='L10662'></a> 10662     y2 += dy;
<a id='L10663' name='L10663'></a> 10663 
<a id='L10664' name='L10664'></a> 10664   <strong class='reserved'>if</strong> (INT_MAX - dx &lt; <a href='../S/2885.html#L87' title='Defined at 87 in lib/xsize.h.'>xmax</a>)
<a id='L10665' name='L10665'></a> 10665     <a href='../D/10893.html' title='Multiple defined in 6 places.'>emacs_abort</a> ();
<a id='L10666' name='L10666'></a> 10666 
<a id='L10667' name='L10667'></a> 10667   <strong class='reserved'>while</strong> (x1 &lt;= <a href='../S/2885.html#L87' title='Defined at 87 in lib/xsize.h.'>xmax</a>)
<a id='L10668' name='L10668'></a> 10668     <em class='brace'>{</em>
<a id='L10669' name='L10669'></a> 10669       XSetLineAttributes (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, s-&gt;gc, thickness, LineSolid, CapButt,
<a id='L10670' name='L10670'></a> 10670                           JoinRound);
<a id='L10671' name='L10671'></a> 10671       XDrawLine (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../S/2212.html#L1352' title='Defined at 1352 in src/xterm.h.'>FRAME_X_DRAWABLE</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), s-&gt;gc, x1, <a href='../D/20170.html' title='Multiple defined in 2 places.'>y1</a>, x2, y2);
<a id='L10672' name='L10672'></a> 10672       x1  = x2, <a href='../D/20170.html' title='Multiple defined in 2 places.'>y1</a> = y2;
<a id='L10673' name='L10673'></a> 10673       x2 += dx, y2 = <a href='../D/20169.html' title='Multiple defined in 2 places.'>y0</a> + odd*dy;
<a id='L10674' name='L10674'></a> 10674       odd = !odd;
<a id='L10675' name='L10675'></a> 10675     <em class='brace'>}</em>
<a id='L10676' name='L10676'></a> 10676 
<a id='L10677' name='L10677'></a> 10677   <em class='comment'>/* Restore previous clipping rectangle(s) */</em>
<a id='L10678' name='L10678'></a> 10678   XSetClipRectangles (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, s-&gt;gc, 0, 0, s-&gt;clip, s-&gt;num_clips, Unsorted);
<a id='L10679' name='L10679'></a> 10679 <em class='sharp'>#endif</em>  <em class='comment'>/* not USE_CAIRO */</em>
<a id='L10680' name='L10680'></a> 10680 <em class='brace'>}</em>
<a id='L10681' name='L10681'></a> 10681 
<a id='L10682' name='L10682'></a> 10682 
<a id='L10683' name='L10683'></a> 10683 <em class='comment'>/* Draw glyph string S.  */</em>
<a id='L10684' name='L10684'></a> 10684 
<a id='L10685' name='L10685'></a> 10685 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L10686' name='L10686'></a> 10686 <a href='../S/2289.html#L31334' title='Referred from 31334 in src/xterm.c.'>x_draw_glyph_string</a> (<strong class='reserved'>struct</strong> <a href='../S/2315.html#L1336' title='Defined at 1336 in src/dispextern.h.'>glyph_string</a> *s)
<a id='L10687' name='L10687'></a> 10687 <em class='brace'>{</em>
<a id='L10688' name='L10688'></a> 10688   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> relief_drawn_p = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L10689' name='L10689'></a> 10689 
<a id='L10690' name='L10690'></a> 10690   <em class='comment'>/* If S draws into the background of its successors, draw the</em>
<a id='L10691' name='L10691'></a> 10691 <em class='comment'>     background of the successors first so that S can draw into it.</em>
<a id='L10692' name='L10692'></a> 10692 <em class='comment'>     This makes S-&gt;next use XDrawString instead of XDrawImageString.  */</em>
<a id='L10693' name='L10693'></a> 10693   <strong class='reserved'>if</strong> (s-&gt;next &amp;&amp; s-&gt;right_overhang &amp;&amp; !s-&gt;for_overlaps)
<a id='L10694' name='L10694'></a> 10694     <em class='brace'>{</em>
<a id='L10695' name='L10695'></a> 10695       <strong class='reserved'>int</strong> width;
<a id='L10696' name='L10696'></a> 10696       <strong class='reserved'>struct</strong> <a href='../S/2315.html#L1336' title='Defined at 1336 in src/dispextern.h.'>glyph_string</a> *next;
<a id='L10697' name='L10697'></a> 10697 
<a id='L10698' name='L10698'></a> 10698       <strong class='reserved'>for</strong> (width = 0, next = s-&gt;next;
<a id='L10699' name='L10699'></a> 10699            next &amp;&amp; width &lt; s-&gt;right_overhang;
<a id='L10700' name='L10700'></a> 10700            width += next-&gt;width, next = next-&gt;next)
<a id='L10701' name='L10701'></a> 10701         <strong class='reserved'>if</strong> (next-&gt;first_glyph-&gt;type != <a href='../S/2315.html#L425' title='Defined at 425 in src/dispextern.h.'>IMAGE_GLYPH</a>)
<a id='L10702' name='L10702'></a> 10702           <em class='brace'>{</em>
<a id='L10703' name='L10703'></a> 10703             <a href='../S/2289.html#L8254' title='Defined at 8254 in src/xterm.c.'>x_set_glyph_string_gc</a> (next);
<a id='L10704' name='L10704'></a> 10704             <a href='../S/2289.html#L8296' title='Defined at 8296 in src/xterm.c.'>x_set_glyph_string_clipping</a> (next);
<a id='L10705' name='L10705'></a> 10705             <strong class='reserved'>if</strong> (next-&gt;first_glyph-&gt;type == <a href='../S/2315.html#L428' title='Defined at 428 in src/dispextern.h.'>STRETCH_GLYPH</a>)
<a id='L10706' name='L10706'></a> 10706               <a href='../S/2289.html#L10475' title='Defined at 10475 in src/xterm.c.'>x_draw_stretch_glyph_string</a> (next);
<a id='L10707' name='L10707'></a> 10707             <strong class='reserved'>else</strong>
<a id='L10708' name='L10708'></a> 10708               <a href='../S/2289.html#L8402' title='Defined at 8402 in src/xterm.c.'>x_draw_glyph_string_background</a> (next, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L10709' name='L10709'></a> 10709             next-&gt;num_clips = 0;
<a id='L10710' name='L10710'></a> 10710           <em class='brace'>}</em>
<a id='L10711' name='L10711'></a> 10711     <em class='brace'>}</em>
<a id='L10712' name='L10712'></a> 10712 
<a id='L10713' name='L10713'></a> 10713   <em class='comment'>/* Set up S-&gt;gc, set clipping and draw S.  */</em>
<a id='L10714' name='L10714'></a> 10714   <a href='../S/2289.html#L8254' title='Defined at 8254 in src/xterm.c.'>x_set_glyph_string_gc</a> (s);
<a id='L10715' name='L10715'></a> 10715 
<a id='L10716' name='L10716'></a> 10716   <em class='comment'>/* Draw relief (if any) in advance for char/composition so that the</em>
<a id='L10717' name='L10717'></a> 10717 <em class='comment'>     glyph string can be drawn over it.  */</em>
<a id='L10718' name='L10718'></a> 10718   <strong class='reserved'>if</strong> (!s-&gt;for_overlaps
<a id='L10719' name='L10719'></a> 10719       &amp;&amp; s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;box != <a href='../S/2315.html#L1678' title='Defined at 1678 in src/dispextern.h.'>FACE_NO_BOX</a>
<a id='L10720' name='L10720'></a> 10720       &amp;&amp; (s-&gt;first_glyph-&gt;type == <a href='../S/2315.html#L416' title='Defined at 416 in src/dispextern.h.'>CHAR_GLYPH</a>
<a id='L10721' name='L10721'></a> 10721           || s-&gt;first_glyph-&gt;type == <a href='../S/2315.html#L419' title='Defined at 419 in src/dispextern.h.'>COMPOSITE_GLYPH</a>))
<a id='L10722' name='L10722'></a> 10722 
<a id='L10723' name='L10723'></a> 10723     <em class='brace'>{</em>
<a id='L10724' name='L10724'></a> 10724       <a href='../S/2289.html#L8296' title='Defined at 8296 in src/xterm.c.'>x_set_glyph_string_clipping</a> (s);
<a id='L10725' name='L10725'></a> 10725       <a href='../S/2289.html#L8402' title='Defined at 8402 in src/xterm.c.'>x_draw_glyph_string_background</a> (s, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L10726' name='L10726'></a> 10726       <a href='../S/2289.html#L9879' title='Defined at 9879 in src/xterm.c.'>x_draw_glyph_string_box</a> (s);
<a id='L10727' name='L10727'></a> 10727       <a href='../S/2289.html#L8296' title='Defined at 8296 in src/xterm.c.'>x_set_glyph_string_clipping</a> (s);
<a id='L10728' name='L10728'></a> 10728       relief_drawn_p = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L10729' name='L10729'></a> 10729     <em class='brace'>}</em>
<a id='L10730' name='L10730'></a> 10730   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (!s-&gt;clip_head <em class='comment'>/* draw_glyphs didn't specify a clip mask. */</em>
<a id='L10731' name='L10731'></a> 10731            &amp;&amp; !s-&gt;clip_tail
<a id='L10732' name='L10732'></a> 10732            &amp;&amp; ((s-&gt;prev &amp;&amp; s-&gt;prev-&gt;hl != s-&gt;hl &amp;&amp; s-&gt;left_overhang)
<a id='L10733' name='L10733'></a> 10733                || (s-&gt;next &amp;&amp; s-&gt;next-&gt;hl != s-&gt;hl &amp;&amp; s-&gt;right_overhang)))
<a id='L10734' name='L10734'></a> 10734     <em class='comment'>/* We must clip just this glyph.  left_overhang part has already</em>
<a id='L10735' name='L10735'></a> 10735 <em class='comment'>       drawn when s-&gt;prev was drawn, and right_overhang part will be</em>
<a id='L10736' name='L10736'></a> 10736 <em class='comment'>       drawn later when s-&gt;next is drawn. */</em>
<a id='L10737' name='L10737'></a> 10737     <a href='../S/2289.html#L8312' title='Defined at 8312 in src/xterm.c.'>x_set_glyph_string_clipping_exactly</a> (s, s);
<a id='L10738' name='L10738'></a> 10738   <strong class='reserved'>else</strong>
<a id='L10739' name='L10739'></a> 10739     <a href='../S/2289.html#L8296' title='Defined at 8296 in src/xterm.c.'>x_set_glyph_string_clipping</a> (s);
<a id='L10740' name='L10740'></a> 10740 
<a id='L10741' name='L10741'></a> 10741   <strong class='reserved'>switch</strong> (s-&gt;first_glyph-&gt;type)
<a id='L10742' name='L10742'></a> 10742     <em class='brace'>{</em>
<a id='L10743' name='L10743'></a> 10743     <strong class='reserved'>case</strong> <a href='../S/2315.html#L425' title='Defined at 425 in src/dispextern.h.'>IMAGE_GLYPH</a>:
<a id='L10744' name='L10744'></a> 10744       <a href='../S/2289.html#L10335' title='Defined at 10335 in src/xterm.c.'>x_draw_image_glyph_string</a> (s);
<a id='L10745' name='L10745'></a> 10745       <strong class='reserved'>break</strong>;
<a id='L10746' name='L10746'></a> 10746 
<a id='L10747' name='L10747'></a> 10747     <strong class='reserved'>case</strong> <a href='../S/2315.html#L431' title='Defined at 431 in src/dispextern.h.'>XWIDGET_GLYPH</a>:
<a id='L10748' name='L10748'></a> 10748       <a href='../D/19538.html' title='Multiple defined in 2 places.'>x_draw_xwidget_glyph_string</a> (s);
<a id='L10749' name='L10749'></a> 10749       <strong class='reserved'>break</strong>;
<a id='L10750' name='L10750'></a> 10750 
<a id='L10751' name='L10751'></a> 10751     <strong class='reserved'>case</strong> <a href='../S/2315.html#L428' title='Defined at 428 in src/dispextern.h.'>STRETCH_GLYPH</a>:
<a id='L10752' name='L10752'></a> 10752       <a href='../S/2289.html#L10475' title='Defined at 10475 in src/xterm.c.'>x_draw_stretch_glyph_string</a> (s);
<a id='L10753' name='L10753'></a> 10753       <strong class='reserved'>break</strong>;
<a id='L10754' name='L10754'></a> 10754 
<a id='L10755' name='L10755'></a> 10755     <strong class='reserved'>case</strong> <a href='../S/2315.html#L416' title='Defined at 416 in src/dispextern.h.'>CHAR_GLYPH</a>:
<a id='L10756' name='L10756'></a> 10756       <strong class='reserved'>if</strong> (s-&gt;for_overlaps)
<a id='L10757' name='L10757'></a> 10757         s-&gt;background_filled_p = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L10758' name='L10758'></a> 10758       <strong class='reserved'>else</strong>
<a id='L10759' name='L10759'></a> 10759         <a href='../S/2289.html#L8402' title='Defined at 8402 in src/xterm.c.'>x_draw_glyph_string_background</a> (s, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L10760' name='L10760'></a> 10760       <a href='../S/2289.html#L8446' title='Defined at 8446 in src/xterm.c.'>x_draw_glyph_string_foreground</a> (s);
<a id='L10761' name='L10761'></a> 10761       <strong class='reserved'>break</strong>;
<a id='L10762' name='L10762'></a> 10762 
<a id='L10763' name='L10763'></a> 10763     <strong class='reserved'>case</strong> <a href='../S/2315.html#L419' title='Defined at 419 in src/dispextern.h.'>COMPOSITE_GLYPH</a>:
<a id='L10764' name='L10764'></a> 10764       <strong class='reserved'>if</strong> (s-&gt;for_overlaps || (s-&gt;cmp_from &gt; 0
<a id='L10765' name='L10765'></a> 10765                               &amp;&amp; ! s-&gt;first_glyph-&gt;u.cmp.automatic))
<a id='L10766' name='L10766'></a> 10766         s-&gt;background_filled_p = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L10767' name='L10767'></a> 10767       <strong class='reserved'>else</strong>
<a id='L10768' name='L10768'></a> 10768         <a href='../S/2289.html#L8402' title='Defined at 8402 in src/xterm.c.'>x_draw_glyph_string_background</a> (s, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L10769' name='L10769'></a> 10769       <a href='../S/2289.html#L8540' title='Defined at 8540 in src/xterm.c.'>x_draw_composite_glyph_string_foreground</a> (s);
<a id='L10770' name='L10770'></a> 10770       <strong class='reserved'>break</strong>;
<a id='L10771' name='L10771'></a> 10771 
<a id='L10772' name='L10772'></a> 10772     <strong class='reserved'>case</strong> <a href='../S/2315.html#L422' title='Defined at 422 in src/dispextern.h.'>GLYPHLESS_GLYPH</a>:
<a id='L10773' name='L10773'></a> 10773       <strong class='reserved'>if</strong> (s-&gt;for_overlaps)
<a id='L10774' name='L10774'></a> 10774         s-&gt;background_filled_p = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L10775' name='L10775'></a> 10775       <strong class='reserved'>else</strong>
<a id='L10776' name='L10776'></a> 10776         <a href='../S/2289.html#L8402' title='Defined at 8402 in src/xterm.c.'>x_draw_glyph_string_background</a> (s, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L10777' name='L10777'></a> 10777       <a href='../S/2289.html#L8650' title='Defined at 8650 in src/xterm.c.'>x_draw_glyphless_glyph_string_foreground</a> (s);
<a id='L10778' name='L10778'></a> 10778       <strong class='reserved'>break</strong>;
<a id='L10779' name='L10779'></a> 10779 
<a id='L10780' name='L10780'></a> 10780     <strong class='reserved'>default</strong>:
<a id='L10781' name='L10781'></a> 10781       <a href='../D/10893.html' title='Multiple defined in 6 places.'>emacs_abort</a> ();
<a id='L10782' name='L10782'></a> 10782     <em class='brace'>}</em>
<a id='L10783' name='L10783'></a> 10783 
<a id='L10784' name='L10784'></a> 10784   <strong class='reserved'>if</strong> (!s-&gt;for_overlaps)
<a id='L10785' name='L10785'></a> 10785     <em class='brace'>{</em>
<a id='L10786' name='L10786'></a> 10786       <strong class='reserved'>int</strong> area_x, area_y, area_width, area_height;
<a id='L10787' name='L10787'></a> 10787       <strong class='reserved'>int</strong> area_max_x, decoration_width;
<a id='L10788' name='L10788'></a> 10788 
<a id='L10789' name='L10789'></a> 10789       <em class='comment'>/* Prevent the underline from overwriting surrounding areas</em>
<a id='L10790' name='L10790'></a> 10790 <em class='comment'>         and the fringe.  */</em>
<a id='L10791' name='L10791'></a> 10791       <a href='../S/2224.html#L1418' title='Defined at 1418 in src/xdisp.c.'>window_box</a> (s-&gt;w, s-&gt;area, &amp;area_x, &amp;area_y,
<a id='L10792' name='L10792'></a> 10792                   &amp;area_width, &amp;area_height);
<a id='L10793' name='L10793'></a> 10793       area_max_x = area_x + area_width - 1;
<a id='L10794' name='L10794'></a> 10794 
<a id='L10795' name='L10795'></a> 10795       decoration_width = s-&gt;width;
<a id='L10796' name='L10796'></a> 10796       <strong class='reserved'>if</strong> (!s-&gt;row-&gt;mode_line_p
<a id='L10797' name='L10797'></a> 10797           &amp;&amp; !s-&gt;row-&gt;tab_line_p
<a id='L10798' name='L10798'></a> 10798           &amp;&amp; area_max_x &lt; (s-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + decoration_width - 1))
<a id='L10799' name='L10799'></a> 10799         decoration_width -= (s-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + decoration_width - 1) - area_max_x;
<a id='L10800' name='L10800'></a> 10800 
<a id='L10801' name='L10801'></a> 10801       <em class='comment'>/* Draw relief if not yet drawn.  */</em>
<a id='L10802' name='L10802'></a> 10802       <strong class='reserved'>if</strong> (!relief_drawn_p &amp;&amp; s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;box != <a href='../S/2315.html#L1678' title='Defined at 1678 in src/dispextern.h.'>FACE_NO_BOX</a>)
<a id='L10803' name='L10803'></a> 10803         <a href='../S/2289.html#L9879' title='Defined at 9879 in src/xterm.c.'>x_draw_glyph_string_box</a> (s);
<a id='L10804' name='L10804'></a> 10804 
<a id='L10805' name='L10805'></a> 10805       <em class='comment'>/* Draw underline.  */</em>
<a id='L10806' name='L10806'></a> 10806       <strong class='reserved'>if</strong> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;underline)
<a id='L10807' name='L10807'></a> 10807         <em class='brace'>{</em>
<a id='L10808' name='L10808'></a> 10808           <strong class='reserved'>if</strong> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;underline == <a href='../S/2315.html#L1696' title='Defined at 1696 in src/dispextern.h.'>FACE_UNDER_WAVE</a>)
<a id='L10809' name='L10809'></a> 10809             <em class='brace'>{</em>
<a id='L10810' name='L10810'></a> 10810               <strong class='reserved'>if</strong> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;underline_defaulted_p)
<a id='L10811' name='L10811'></a> 10811                 <a href='../S/2289.html#L10613' title='Defined at 10613 in src/xterm.c.'>x_draw_underwave</a> (s, decoration_width);
<a id='L10812' name='L10812'></a> 10812               <strong class='reserved'>else</strong>
<a id='L10813' name='L10813'></a> 10813                 <em class='brace'>{</em>
<a id='L10814' name='L10814'></a> 10814                   <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> = <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L10815' name='L10815'></a> 10815                   XGCValues xgcv;
<a id='L10816' name='L10816'></a> 10816                   <a href='../S/2215.html#L271' title='Defined at 271 in src/w32term.c.'>XGetGCValues</a> (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, s-&gt;gc, <a href='../S/2315.html#L89' title='Defined at 89 in src/dispextern.h.'>GCForeground</a>, &amp;xgcv);
<a id='L10817' name='L10817'></a> 10817                   XSetForeground (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, s-&gt;gc, s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;underline_color);
<a id='L10818' name='L10818'></a> 10818                   <a href='../S/2289.html#L10613' title='Defined at 10613 in src/xterm.c.'>x_draw_underwave</a> (s, decoration_width);
<a id='L10819' name='L10819'></a> 10819                   XSetForeground (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, s-&gt;gc, xgcv.foreground);
<a id='L10820' name='L10820'></a> 10820                 <em class='brace'>}</em>
<a id='L10821' name='L10821'></a> 10821             <em class='brace'>}</em>
<a id='L10822' name='L10822'></a> 10822           <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;underline == <a href='../S/2315.html#L1695' title='Defined at 1695 in src/dispextern.h.'>FACE_UNDER_LINE</a>)
<a id='L10823' name='L10823'></a> 10823             <em class='brace'>{</em>
<a id='L10824' name='L10824'></a> 10824               <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> thickness, <a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a>;
<a id='L10825' name='L10825'></a> 10825               <strong class='reserved'>int</strong> y;
<a id='L10826' name='L10826'></a> 10826 
<a id='L10827' name='L10827'></a> 10827               <strong class='reserved'>if</strong> (s-&gt;prev
<a id='L10828' name='L10828'></a> 10828                   &amp;&amp; s-&gt;prev-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;underline == <a href='../S/2315.html#L1695' title='Defined at 1695 in src/dispextern.h.'>FACE_UNDER_LINE</a>
<a id='L10829' name='L10829'></a> 10829                   &amp;&amp; (s-&gt;prev-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;underline_at_descent_line_p
<a id='L10830' name='L10830'></a> 10830                       == s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;underline_at_descent_line_p)
<a id='L10831' name='L10831'></a> 10831                   &amp;&amp; (s-&gt;prev-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;underline_pixels_above_descent_line
<a id='L10832' name='L10832'></a> 10832                       == s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;underline_pixels_above_descent_line))
<a id='L10833' name='L10833'></a> 10833                 <em class='brace'>{</em>
<a id='L10834' name='L10834'></a> 10834                   <em class='comment'>/* We use the same underline style as the previous one.  */</em>
<a id='L10835' name='L10835'></a> 10835                   thickness = s-&gt;prev-&gt;underline_thickness;
<a id='L10836' name='L10836'></a> 10836                   <a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a> = s-&gt;prev-&gt;underline_position;
<a id='L10837' name='L10837'></a> 10837                 <em class='brace'>}</em>
<a id='L10838' name='L10838'></a> 10838               <strong class='reserved'>else</strong>
<a id='L10839' name='L10839'></a> 10839                 <em class='brace'>{</em>
<a id='L10840' name='L10840'></a> 10840                   <strong class='reserved'>struct</strong> <a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a> *<a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a> = <a href='../S/2224.html#L30889' title='Defined at 30889 in src/xdisp.c.'>font_for_underline_metrics</a> (s);
<a id='L10841' name='L10841'></a> 10841                   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> minimum_offset;
<a id='L10842' name='L10842'></a> 10842                   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> underline_at_descent_line;
<a id='L10843' name='L10843'></a> 10843                   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> use_underline_position_properties;
<a id='L10844' name='L10844'></a> 10844                   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> val = (<a href='../S/2317.html#L626' title='Defined at 626 in src/window.h.'>WINDOW_BUFFER_LOCAL_VALUE</a>
<a id='L10845' name='L10845'></a> 10845                                      (Qunderline_minimum_offset, s-&gt;w));
<a id='L10846' name='L10846'></a> 10846 
<a id='L10847' name='L10847'></a> 10847                   <strong class='reserved'>if</strong> (<a href='../S/2267.html#L469' title='Defined at 469 in src/lisp.h.'>FIXNUMP</a> (val))
<a id='L10848' name='L10848'></a> 10848                     minimum_offset = <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> (0, <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (val));
<a id='L10849' name='L10849'></a> 10849                   <strong class='reserved'>else</strong>
<a id='L10850' name='L10850'></a> 10850                     minimum_offset = 1;
<a id='L10851' name='L10851'></a> 10851 
<a id='L10852' name='L10852'></a> 10852                   val = (<a href='../S/2317.html#L626' title='Defined at 626 in src/window.h.'>WINDOW_BUFFER_LOCAL_VALUE</a>
<a id='L10853' name='L10853'></a> 10853                          (Qx_underline_at_descent_line, s-&gt;w));
<a id='L10854' name='L10854'></a> 10854                   underline_at_descent_line
<a id='L10855' name='L10855'></a> 10855                     = (!(<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (val) || <a href='../S/2267.html#L466' title='Defined at 466 in src/lisp.h.'>BASE_EQ</a> (val, Qunbound))
<a id='L10856' name='L10856'></a> 10856                        || s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;underline_at_descent_line_p);
<a id='L10857' name='L10857'></a> 10857 
<a id='L10858' name='L10858'></a> 10858                   val = (<a href='../S/2317.html#L626' title='Defined at 626 in src/window.h.'>WINDOW_BUFFER_LOCAL_VALUE</a>
<a id='L10859' name='L10859'></a> 10859                          (Qx_use_underline_position_properties, s-&gt;w));
<a id='L10860' name='L10860'></a> 10860                   use_underline_position_properties
<a id='L10861' name='L10861'></a> 10861                     = !(<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (val) || <a href='../S/2267.html#L466' title='Defined at 466 in src/lisp.h.'>BASE_EQ</a> (val, Qunbound));
<a id='L10862' name='L10862'></a> 10862 
<a id='L10863' name='L10863'></a> 10863                   <em class='comment'>/* Get the underline thickness.  Default is 1 pixel.  */</em>
<a id='L10864' name='L10864'></a> 10864                   <strong class='reserved'>if</strong> (<a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a> &amp;&amp; <a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>-&gt;underline_thickness &gt; 0)
<a id='L10865' name='L10865'></a> 10865                     thickness = <a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>-&gt;underline_thickness;
<a id='L10866' name='L10866'></a> 10866                   <strong class='reserved'>else</strong>
<a id='L10867' name='L10867'></a> 10867                     thickness = 1;
<a id='L10868' name='L10868'></a> 10868                   <strong class='reserved'>if</strong> (underline_at_descent_line)
<a id='L10869' name='L10869'></a> 10869                     <a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a> = ((s-&gt;height - thickness)
<a id='L10870' name='L10870'></a> 10870                                 - (s-&gt;ybase - s-&gt;y)
<a id='L10871' name='L10871'></a> 10871                                 - s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;underline_pixels_above_descent_line);
<a id='L10872' name='L10872'></a> 10872                   <strong class='reserved'>else</strong>
<a id='L10873' name='L10873'></a> 10873                     <em class='brace'>{</em>
<a id='L10874' name='L10874'></a> 10874                       <em class='comment'>/* Get the underline position.  This is the</em>
<a id='L10875' name='L10875'></a> 10875 <em class='comment'>                         recommended vertical offset in pixels from</em>
<a id='L10876' name='L10876'></a> 10876 <em class='comment'>                         the baseline to the top of the underline.</em>
<a id='L10877' name='L10877'></a> 10877 <em class='comment'>                         This is a signed value according to the</em>
<a id='L10878' name='L10878'></a> 10878 <em class='comment'>                         specs, and its default is</em>
<a id='L10879' name='L10879'></a> 10879 <em class='comment'></em>
<a id='L10880' name='L10880'></a> 10880 <em class='comment'>                         ROUND ((maximum descent) / 2), with</em>
<a id='L10881' name='L10881'></a> 10881 <em class='comment'>                         ROUND(x) = floor (x + 0.5)  */</em>
<a id='L10882' name='L10882'></a> 10882 
<a id='L10883' name='L10883'></a> 10883                       <strong class='reserved'>if</strong> (use_underline_position_properties
<a id='L10884' name='L10884'></a> 10884                           &amp;&amp; <a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a> &amp;&amp; <a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>-&gt;underline_position &gt;= 0)
<a id='L10885' name='L10885'></a> 10885                         <a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a> = <a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>-&gt;underline_position;
<a id='L10886' name='L10886'></a> 10886                       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (<a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>)
<a id='L10887' name='L10887'></a> 10887                         <a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a> = (<a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>-&gt;descent + 1) / 2;
<a id='L10888' name='L10888'></a> 10888                       <strong class='reserved'>else</strong>
<a id='L10889' name='L10889'></a> 10889                         <a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a> = minimum_offset;
<a id='L10890' name='L10890'></a> 10890                     <em class='brace'>}</em>
<a id='L10891' name='L10891'></a> 10891 
<a id='L10892' name='L10892'></a> 10892                   <em class='comment'>/* Ignore minimum_offset if the amount of pixels was</em>
<a id='L10893' name='L10893'></a> 10893 <em class='comment'>                     explicitly specified.  */</em>
<a id='L10894' name='L10894'></a> 10894                   <strong class='reserved'>if</strong> (!s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;underline_pixels_above_descent_line)
<a id='L10895' name='L10895'></a> 10895                     <a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a> = <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> (<a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a>, minimum_offset);
<a id='L10896' name='L10896'></a> 10896                 <em class='brace'>}</em>
<a id='L10897' name='L10897'></a> 10897               <em class='comment'>/* Check the sanity of thickness and position.  We should</em>
<a id='L10898' name='L10898'></a> 10898 <em class='comment'>                 avoid drawing underline out of the current line area.  */</em>
<a id='L10899' name='L10899'></a> 10899               <strong class='reserved'>if</strong> (s-&gt;y + s-&gt;height &lt;= s-&gt;ybase + <a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a>)
<a id='L10900' name='L10900'></a> 10900                 <a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a> = (s-&gt;height - 1) - (s-&gt;ybase - s-&gt;y);
<a id='L10901' name='L10901'></a> 10901               <strong class='reserved'>if</strong> (s-&gt;y + s-&gt;height &lt; s-&gt;ybase + <a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a> + thickness)
<a id='L10902' name='L10902'></a> 10902                 thickness = (s-&gt;y + s-&gt;height) - (s-&gt;ybase + <a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a>);
<a id='L10903' name='L10903'></a> 10903               s-&gt;underline_thickness = thickness;
<a id='L10904' name='L10904'></a> 10904               s-&gt;underline_position = <a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a>;
<a id='L10905' name='L10905'></a> 10905               y = s-&gt;ybase + <a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a>;
<a id='L10906' name='L10906'></a> 10906               <strong class='reserved'>if</strong> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;underline_defaulted_p)
<a id='L10907' name='L10907'></a> 10907                 <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, s-&gt;gc,
<a id='L10908' name='L10908'></a> 10908                                   s-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, decoration_width, thickness,
<a id='L10909' name='L10909'></a> 10909                                   <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L10910' name='L10910'></a> 10910               <strong class='reserved'>else</strong>
<a id='L10911' name='L10911'></a> 10911                 <em class='brace'>{</em>
<a id='L10912' name='L10912'></a> 10912                   <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> = <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L10913' name='L10913'></a> 10913                   XGCValues xgcv;
<a id='L10914' name='L10914'></a> 10914                   <a href='../S/2215.html#L271' title='Defined at 271 in src/w32term.c.'>XGetGCValues</a> (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, s-&gt;gc, <a href='../S/2315.html#L89' title='Defined at 89 in src/dispextern.h.'>GCForeground</a>, &amp;xgcv);
<a id='L10915' name='L10915'></a> 10915                   XSetForeground (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, s-&gt;gc, s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;underline_color);
<a id='L10916' name='L10916'></a> 10916                   <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, s-&gt;gc,
<a id='L10917' name='L10917'></a> 10917                                     s-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, decoration_width, thickness,
<a id='L10918' name='L10918'></a> 10918                                     <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L10919' name='L10919'></a> 10919                   XSetForeground (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, s-&gt;gc, xgcv.foreground);
<a id='L10920' name='L10920'></a> 10920                 <em class='brace'>}</em>
<a id='L10921' name='L10921'></a> 10921             <em class='brace'>}</em>
<a id='L10922' name='L10922'></a> 10922         <em class='brace'>}</em>
<a id='L10923' name='L10923'></a> 10923       <em class='comment'>/* Draw overline.  */</em>
<a id='L10924' name='L10924'></a> 10924       <strong class='reserved'>if</strong> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;overline_p)
<a id='L10925' name='L10925'></a> 10925         <em class='brace'>{</em>
<a id='L10926' name='L10926'></a> 10926           <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> dy = 0, h = 1;
<a id='L10927' name='L10927'></a> 10927 
<a id='L10928' name='L10928'></a> 10928           <strong class='reserved'>if</strong> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;overline_color_defaulted_p)
<a id='L10929' name='L10929'></a> 10929             <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, s-&gt;gc, s-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, s-&gt;y + dy,
<a id='L10930' name='L10930'></a> 10930                               decoration_width, h, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L10931' name='L10931'></a> 10931           <strong class='reserved'>else</strong>
<a id='L10932' name='L10932'></a> 10932             <em class='brace'>{</em>
<a id='L10933' name='L10933'></a> 10933               <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> = <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L10934' name='L10934'></a> 10934               XGCValues xgcv;
<a id='L10935' name='L10935'></a> 10935               <a href='../S/2215.html#L271' title='Defined at 271 in src/w32term.c.'>XGetGCValues</a> (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, s-&gt;gc, <a href='../S/2315.html#L89' title='Defined at 89 in src/dispextern.h.'>GCForeground</a>, &amp;xgcv);
<a id='L10936' name='L10936'></a> 10936               XSetForeground (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, s-&gt;gc, s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;overline_color);
<a id='L10937' name='L10937'></a> 10937               <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, s-&gt;gc, s-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, s-&gt;y + dy,
<a id='L10938' name='L10938'></a> 10938                                 decoration_width, h, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L10939' name='L10939'></a> 10939               XSetForeground (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, s-&gt;gc, xgcv.foreground);
<a id='L10940' name='L10940'></a> 10940             <em class='brace'>}</em>
<a id='L10941' name='L10941'></a> 10941         <em class='brace'>}</em>
<a id='L10942' name='L10942'></a> 10942 
<a id='L10943' name='L10943'></a> 10943       <em class='comment'>/* Draw strike-through.  */</em>
<a id='L10944' name='L10944'></a> 10944       <strong class='reserved'>if</strong> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;strike_through_p)
<a id='L10945' name='L10945'></a> 10945         <em class='brace'>{</em>
<a id='L10946' name='L10946'></a> 10946           <em class='comment'>/* Y-coordinate and height of the glyph string's first</em>
<a id='L10947' name='L10947'></a> 10947 <em class='comment'>             glyph.  We cannot use s-&gt;y and s-&gt;height because those</em>
<a id='L10948' name='L10948'></a> 10948 <em class='comment'>             could be larger if there are taller display elements</em>
<a id='L10949' name='L10949'></a> 10949 <em class='comment'>             (e.g., characters displayed with a larger font) in the</em>
<a id='L10950' name='L10950'></a> 10950 <em class='comment'>             same glyph row.  */</em>
<a id='L10951' name='L10951'></a> 10951           <strong class='reserved'>int</strong> glyph_y = s-&gt;ybase - s-&gt;first_glyph-&gt;ascent;
<a id='L10952' name='L10952'></a> 10952           <strong class='reserved'>int</strong> glyph_height = s-&gt;first_glyph-&gt;ascent + s-&gt;first_glyph-&gt;descent;
<a id='L10953' name='L10953'></a> 10953           <em class='comment'>/* Strike-through width and offset from the glyph string's</em>
<a id='L10954' name='L10954'></a> 10954 <em class='comment'>             top edge.  */</em>
<a id='L10955' name='L10955'></a> 10955           <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> h = 1;
<a id='L10956' name='L10956'></a> 10956           <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> dy = (glyph_height - h) / 2;
<a id='L10957' name='L10957'></a> 10957 
<a id='L10958' name='L10958'></a> 10958           <strong class='reserved'>if</strong> (s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;strike_through_color_defaulted_p)
<a id='L10959' name='L10959'></a> 10959             <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, s-&gt;gc, s-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, glyph_y + dy,
<a id='L10960' name='L10960'></a> 10960                               s-&gt;width, h, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L10961' name='L10961'></a> 10961           <strong class='reserved'>else</strong>
<a id='L10962' name='L10962'></a> 10962             <em class='brace'>{</em>
<a id='L10963' name='L10963'></a> 10963               <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> = <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L10964' name='L10964'></a> 10964               XGCValues xgcv;
<a id='L10965' name='L10965'></a> 10965               <a href='../S/2215.html#L271' title='Defined at 271 in src/w32term.c.'>XGetGCValues</a> (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, s-&gt;gc, <a href='../S/2315.html#L89' title='Defined at 89 in src/dispextern.h.'>GCForeground</a>, &amp;xgcv);
<a id='L10966' name='L10966'></a> 10966               XSetForeground (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, s-&gt;gc, s-&gt;<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;strike_through_color);
<a id='L10967' name='L10967'></a> 10967               <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, s-&gt;gc, s-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, glyph_y + dy,
<a id='L10968' name='L10968'></a> 10968                                 decoration_width, h, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L10969' name='L10969'></a> 10969               XSetForeground (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, s-&gt;gc, xgcv.foreground);
<a id='L10970' name='L10970'></a> 10970             <em class='brace'>}</em>
<a id='L10971' name='L10971'></a> 10971         <em class='brace'>}</em>
<a id='L10972' name='L10972'></a> 10972 
<a id='L10973' name='L10973'></a> 10973       <strong class='reserved'>if</strong> (s-&gt;prev)
<a id='L10974' name='L10974'></a> 10974         <em class='brace'>{</em>
<a id='L10975' name='L10975'></a> 10975           <strong class='reserved'>struct</strong> <a href='../S/2315.html#L1336' title='Defined at 1336 in src/dispextern.h.'>glyph_string</a> *prev;
<a id='L10976' name='L10976'></a> 10976 
<a id='L10977' name='L10977'></a> 10977           <strong class='reserved'>for</strong> (prev = s-&gt;prev; prev; prev = prev-&gt;prev)
<a id='L10978' name='L10978'></a> 10978             <strong class='reserved'>if</strong> (prev-&gt;hl != s-&gt;hl
<a id='L10979' name='L10979'></a> 10979                 &amp;&amp; prev-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + prev-&gt;width + prev-&gt;right_overhang &gt; s-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>)
<a id='L10980' name='L10980'></a> 10980               <em class='brace'>{</em>
<a id='L10981' name='L10981'></a> 10981                 <em class='comment'>/* As prev was drawn while clipped to its own area, we</em>
<a id='L10982' name='L10982'></a> 10982 <em class='comment'>                   must draw the right_overhang part using s-&gt;hl now.  */</em>
<a id='L10983' name='L10983'></a> 10983                 <strong class='reserved'>enum</strong> <a href='../S/2315.html#L1322' title='Defined at 1322 in src/dispextern.h.'>draw_glyphs_face</a> save = prev-&gt;hl;
<a id='L10984' name='L10984'></a> 10984 
<a id='L10985' name='L10985'></a> 10985                 prev-&gt;hl = s-&gt;hl;
<a id='L10986' name='L10986'></a> 10986                 <a href='../S/2289.html#L8254' title='Defined at 8254 in src/xterm.c.'>x_set_glyph_string_gc</a> (prev);
<a id='L10987' name='L10987'></a> 10987                 <a href='../S/2289.html#L8312' title='Defined at 8312 in src/xterm.c.'>x_set_glyph_string_clipping_exactly</a> (s, prev);
<a id='L10988' name='L10988'></a> 10988                 <strong class='reserved'>if</strong> (prev-&gt;first_glyph-&gt;type == <a href='../S/2315.html#L416' title='Defined at 416 in src/dispextern.h.'>CHAR_GLYPH</a>)
<a id='L10989' name='L10989'></a> 10989                   <a href='../S/2289.html#L8446' title='Defined at 8446 in src/xterm.c.'>x_draw_glyph_string_foreground</a> (prev);
<a id='L10990' name='L10990'></a> 10990                 <strong class='reserved'>else</strong>
<a id='L10991' name='L10991'></a> 10991                   <a href='../S/2289.html#L8540' title='Defined at 8540 in src/xterm.c.'>x_draw_composite_glyph_string_foreground</a> (prev);
<a id='L10992' name='L10992'></a> 10992                 <a href='../S/2289.html#L6390' title='Defined at 6390 in src/xterm.c.'>x_reset_clip_rectangles</a> (prev-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, prev-&gt;gc);
<a id='L10993' name='L10993'></a> 10993                 prev-&gt;hl = save;
<a id='L10994' name='L10994'></a> 10994                 prev-&gt;num_clips = 0;
<a id='L10995' name='L10995'></a> 10995               <em class='brace'>}</em>
<a id='L10996' name='L10996'></a> 10996         <em class='brace'>}</em>
<a id='L10997' name='L10997'></a> 10997 
<a id='L10998' name='L10998'></a> 10998       <strong class='reserved'>if</strong> (s-&gt;next)
<a id='L10999' name='L10999'></a> 10999         <em class='brace'>{</em>
<a id='L11000' name='L11000'></a> 11000           <strong class='reserved'>struct</strong> <a href='../S/2315.html#L1336' title='Defined at 1336 in src/dispextern.h.'>glyph_string</a> *next;
<a id='L11001' name='L11001'></a> 11001 
<a id='L11002' name='L11002'></a> 11002           <strong class='reserved'>for</strong> (next = s-&gt;next; next; next = next-&gt;next)
<a id='L11003' name='L11003'></a> 11003             <strong class='reserved'>if</strong> (next-&gt;hl != s-&gt;hl
<a id='L11004' name='L11004'></a> 11004                 &amp;&amp; next-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> - next-&gt;left_overhang &lt; s-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + s-&gt;width)
<a id='L11005' name='L11005'></a> 11005               <em class='brace'>{</em>
<a id='L11006' name='L11006'></a> 11006                 <em class='comment'>/* As next will be drawn while clipped to its own area,</em>
<a id='L11007' name='L11007'></a> 11007 <em class='comment'>                   we must draw the left_overhang part using s-&gt;hl now.  */</em>
<a id='L11008' name='L11008'></a> 11008                 <strong class='reserved'>enum</strong> <a href='../S/2315.html#L1322' title='Defined at 1322 in src/dispextern.h.'>draw_glyphs_face</a> save = next-&gt;hl;
<a id='L11009' name='L11009'></a> 11009 
<a id='L11010' name='L11010'></a> 11010                 next-&gt;hl = s-&gt;hl;
<a id='L11011' name='L11011'></a> 11011                 <a href='../S/2289.html#L8254' title='Defined at 8254 in src/xterm.c.'>x_set_glyph_string_gc</a> (next);
<a id='L11012' name='L11012'></a> 11012                 <a href='../S/2289.html#L8312' title='Defined at 8312 in src/xterm.c.'>x_set_glyph_string_clipping_exactly</a> (s, next);
<a id='L11013' name='L11013'></a> 11013                 <strong class='reserved'>if</strong> (next-&gt;first_glyph-&gt;type == <a href='../S/2315.html#L416' title='Defined at 416 in src/dispextern.h.'>CHAR_GLYPH</a>)
<a id='L11014' name='L11014'></a> 11014                   <a href='../S/2289.html#L8446' title='Defined at 8446 in src/xterm.c.'>x_draw_glyph_string_foreground</a> (next);
<a id='L11015' name='L11015'></a> 11015                 <strong class='reserved'>else</strong>
<a id='L11016' name='L11016'></a> 11016                   <a href='../S/2289.html#L8540' title='Defined at 8540 in src/xterm.c.'>x_draw_composite_glyph_string_foreground</a> (next);
<a id='L11017' name='L11017'></a> 11017                 <a href='../S/2289.html#L6390' title='Defined at 6390 in src/xterm.c.'>x_reset_clip_rectangles</a> (next-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, next-&gt;gc);
<a id='L11018' name='L11018'></a> 11018                 next-&gt;hl = save;
<a id='L11019' name='L11019'></a> 11019                 next-&gt;num_clips = 0;
<a id='L11020' name='L11020'></a> 11020                 next-&gt;clip_head = s-&gt;next;
<a id='L11021' name='L11021'></a> 11021               <em class='brace'>}</em>
<a id='L11022' name='L11022'></a> 11022         <em class='brace'>}</em>
<a id='L11023' name='L11023'></a> 11023     <em class='brace'>}</em>
<a id='L11024' name='L11024'></a> 11024 
<a id='L11025' name='L11025'></a> 11025   <em class='comment'>/* Reset clipping.  */</em>
<a id='L11026' name='L11026'></a> 11026   <a href='../S/2289.html#L6390' title='Defined at 6390 in src/xterm.c.'>x_reset_clip_rectangles</a> (s-&gt;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, s-&gt;gc);
<a id='L11027' name='L11027'></a> 11027   s-&gt;num_clips = 0;
<a id='L11028' name='L11028'></a> 11028 
<a id='L11029' name='L11029'></a> 11029   <em class='comment'>/* Set the stippled flag that tells redisplay whether or not a</em>
<a id='L11030' name='L11030'></a> 11030 <em class='comment'>     stipple was actually draw.  */</em>
<a id='L11031' name='L11031'></a> 11031 
<a id='L11032' name='L11032'></a> 11032   <strong class='reserved'>if</strong> (s-&gt;first_glyph-&gt;type != <a href='../S/2315.html#L428' title='Defined at 428 in src/dispextern.h.'>STRETCH_GLYPH</a>
<a id='L11033' name='L11033'></a> 11033       &amp;&amp; s-&gt;first_glyph-&gt;type != <a href='../S/2315.html#L425' title='Defined at 425 in src/dispextern.h.'>IMAGE_GLYPH</a>
<a id='L11034' name='L11034'></a> 11034       &amp;&amp; !s-&gt;row-&gt;stipple_p)
<a id='L11035' name='L11035'></a> 11035     s-&gt;row-&gt;stipple_p = s-&gt;stippled_p;
<a id='L11036' name='L11036'></a> 11036 <em class='brace'>}</em>
<a id='L11037' name='L11037'></a> 11037 
<a id='L11038' name='L11038'></a> 11038 <em class='comment'>/* Shift display to make room for inserted glyphs.   */</em>
<a id='L11039' name='L11039'></a> 11039 
<a id='L11040' name='L11040'></a> 11040 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L11041' name='L11041'></a> 11041 <a href='../S/2289.html#L31341' title='Referred from 31341 in src/xterm.c.'>x_shift_glyphs_for_insert</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, <strong class='reserved'>int</strong> y, <strong class='reserved'>int</strong> width, <strong class='reserved'>int</strong> height, <strong class='reserved'>int</strong> shift_by)
<a id='L11042' name='L11042'></a> 11042 <em class='brace'>{</em>
<a id='L11043' name='L11043'></a> 11043 <em class='comment'>/* Never called on a GUI frame, see</em>
<a id='L11044' name='L11044'></a> 11044 <em class='comment'>   https://lists.gnu.org/r/emacs-devel/2015-05/msg00456.html</em>
<a id='L11045' name='L11045'></a> 11045 <em class='comment'>*/</em>
<a id='L11046' name='L11046'></a> 11046   XCopyArea (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../S/2212.html#L1352' title='Defined at 1352 in src/xterm.h.'>FRAME_X_DRAWABLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../S/2212.html#L1352' title='Defined at 1352 in src/xterm.h.'>FRAME_X_DRAWABLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L11047' name='L11047'></a> 11047              <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;normal_gc,
<a id='L11048' name='L11048'></a> 11048              <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, width, height,
<a id='L11049' name='L11049'></a> 11049              <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + shift_by, y);
<a id='L11050' name='L11050'></a> 11050 <em class='brace'>}</em>
<a id='L11051' name='L11051'></a> 11051 
<a id='L11052' name='L11052'></a> 11052 <em class='comment'>/* Delete N glyphs at the nominal cursor position.  Not implemented</em>
<a id='L11053' name='L11053'></a> 11053 <em class='comment'>   for X frames.  */</em>
<a id='L11054' name='L11054'></a> 11054 
<a id='L11055' name='L11055'></a> 11055 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L11056' name='L11056'></a> 11056 <a href='../S/2289.html#L31528' title='Referred from 31528 in src/xterm.c.'>x_delete_glyphs</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <strong class='reserved'>int</strong> n)
<a id='L11057' name='L11057'></a> 11057 <em class='brace'>{</em>
<a id='L11058' name='L11058'></a> 11058   <a href='../D/10893.html' title='Multiple defined in 6 places.'>emacs_abort</a> ();
<a id='L11059' name='L11059'></a> 11059 <em class='brace'>}</em>
<a id='L11060' name='L11060'></a> 11060 
<a id='L11061' name='L11061'></a> 11061 
<a id='L11062' name='L11062'></a> 11062 <em class='comment'>/* Like XClearArea, but check that WIDTH and HEIGHT are reasonable.</em>
<a id='L11063' name='L11063'></a> 11063 <em class='comment'>   If they are &lt;= 0, this is probably an error.  */</em>
<a id='L11064' name='L11064'></a> 11064 
<a id='L11065' name='L11065'></a> 11065 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> USE_GTK || !<strong class='reserved'>defined</strong> USE_CAIRO
<a id='L11066' name='L11066'></a> 11066 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L11067' name='L11067'></a> 11067 <a href='../R/18067.html' title='Multiple referred from 2 places.'>x_clear_area1</a> (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>,
<a id='L11068' name='L11068'></a> 11068                <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, <strong class='reserved'>int</strong> y, <strong class='reserved'>int</strong> width, <strong class='reserved'>int</strong> height, <strong class='reserved'>int</strong> exposures)
<a id='L11069' name='L11069'></a> 11069 <em class='brace'>{</em>
<a id='L11070' name='L11070'></a> 11070   <a href='../D/10871.html' title='Multiple defined in 5 places.'>eassert</a> (width &gt; 0 &amp;&amp; height &gt; 0);
<a id='L11071' name='L11071'></a> 11071   XClearArea (dpy, <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, width, height, exposures);
<a id='L11072' name='L11072'></a> 11072 <em class='brace'>}</em>
<a id='L11073' name='L11073'></a> 11073 <em class='sharp'>#endif</em>
<a id='L11074' name='L11074'></a> 11074 
<a id='L11075' name='L11075'></a> 11075 <strong class='reserved'>void</strong>
<a id='L11076' name='L11076'></a> 11076 <a href='../R/18066.html' title='Multiple referred from 22 places.'>x_clear_area</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, <strong class='reserved'>int</strong> y, <strong class='reserved'>int</strong> width, <strong class='reserved'>int</strong> height)
<a id='L11077' name='L11077'></a> 11077 <em class='brace'>{</em>
<a id='L11078' name='L11078'></a> 11078 <em class='sharp'>#ifdef</em> USE_CAIRO
<a id='L11079' name='L11079'></a> 11079   cairo_t *cr;
<a id='L11080' name='L11080'></a> 11080 
<a id='L11081' name='L11081'></a> 11081   <a href='../D/10871.html' title='Multiple defined in 5 places.'>eassert</a> (width &gt; 0 &amp;&amp; height &gt; 0);
<a id='L11082' name='L11082'></a> 11082 
<a id='L11083' name='L11083'></a> 11083   cr = <a href='../S/2289.html#L5908' title='Defined at 5908 in src/xterm.c.'>x_begin_cr_clip</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L11084' name='L11084'></a> 11084   <a href='../S/2289.html#L5980' title='Defined at 5980 in src/xterm.c.'>x_set_cr_source_with_gc_background</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;normal_gc,
<a id='L11085' name='L11085'></a> 11085                                       <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L11086' name='L11086'></a> 11086   cairo_rectangle (cr, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, width, height);
<a id='L11087' name='L11087'></a> 11087   cairo_fill (cr);
<a id='L11088' name='L11088'></a> 11088   <a href='../S/2289.html#L5940' title='Defined at 5940 in src/xterm.c.'>x_end_cr_clip</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L11089' name='L11089'></a> 11089 <em class='sharp'>#else</em>
<a id='L11090' name='L11090'></a> 11090 <em class='sharp'>#ifndef</em> USE_GTK
<a id='L11091' name='L11091'></a> 11091   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;alpha_background != 1.0
<a id='L11092' name='L11092'></a> 11092 <em class='sharp'>#ifdef</em> HAVE_XDBE
<a id='L11093' name='L11093'></a> 11093       || <a href='../S/2212.html#L1356' title='Defined at 1356 in src/xterm.h.'>FRAME_X_DOUBLE_BUFFERED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L11094' name='L11094'></a> 11094 <em class='sharp'>#endif</em>
<a id='L11095' name='L11095'></a> 11095       )
<a id='L11096' name='L11096'></a> 11096 <em class='sharp'>#endif</em>
<a id='L11097' name='L11097'></a> 11097     <em class='brace'>{</em>
<a id='L11098' name='L11098'></a> 11098 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XRENDER &amp;&amp; \
<a id='L11099' name='L11099'></a> 11099   (RENDER_MAJOR &gt; 0 || (RENDER_MINOR &gt;= 2))
<a id='L11100' name='L11100'></a> 11100       <a href='../S/2289.html#L5089' title='Defined at 5089 in src/xterm.c.'>x_xr_ensure_picture</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L11101' name='L11101'></a> 11101       <strong class='reserved'>if</strong> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;alpha_bits
<a id='L11102' name='L11102'></a> 11102           &amp;&amp; <a href='../S/2212.html#L1446' title='Defined at 1446 in src/xterm.h.'>FRAME_X_PICTURE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) != None
<a id='L11103' name='L11103'></a> 11103           &amp;&amp; <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;alpha_background != 1.0
<a id='L11104' name='L11104'></a> 11104           &amp;&amp; <a href='../S/2212.html#L1447' title='Defined at 1447 in src/xterm.h.'>FRAME_CHECK_XR_VERSION</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 0, 2))
<a id='L11105' name='L11105'></a> 11105         <em class='brace'>{</em>
<a id='L11106' name='L11106'></a> 11106           XRenderColor xc;
<a id='L11107' name='L11107'></a> 11107           <a href='../D/2619.html' title='Multiple defined in 2 places.'>GC</a> gc = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;normal_gc;
<a id='L11108' name='L11108'></a> 11108 
<a id='L11109' name='L11109'></a> 11109           <a href='../S/2289.html#L6349' title='Defined at 6349 in src/xterm.c.'>x_xr_apply_ext_clip</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc);
<a id='L11110' name='L11110'></a> 11110           <a href='../S/2289.html#L6436' title='Defined at 6436 in src/xterm.c.'>x_xrender_color_from_gc_background</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, &amp;xc, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L11111' name='L11111'></a> 11111           XRenderFillRectangle (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L11112' name='L11112'></a> 11112                                 PictOpSrc, <a href='../S/2212.html#L1446' title='Defined at 1446 in src/xterm.h.'>FRAME_X_PICTURE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L11113' name='L11113'></a> 11113                                 &amp;xc, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, width, height);
<a id='L11114' name='L11114'></a> 11114           <a href='../S/2289.html#L6363' title='Defined at 6363 in src/xterm.c.'>x_xr_reset_ext_clip</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L11115' name='L11115'></a> 11115           <a href='../S/2296.html#L3928' title='Defined at 3928 in src/xfns.c.'>x_mark_frame_dirty</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L11116' name='L11116'></a> 11116         <em class='brace'>}</em>
<a id='L11117' name='L11117'></a> 11117       <strong class='reserved'>else</strong>
<a id='L11118' name='L11118'></a> 11118 <em class='sharp'>#endif</em>
<a id='L11119' name='L11119'></a> 11119         XFillRectangle (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L11120' name='L11120'></a> 11120                         <a href='../S/2212.html#L1352' title='Defined at 1352 in src/xterm.h.'>FRAME_X_DRAWABLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L11121' name='L11121'></a> 11121                         <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;reverse_gc,
<a id='L11122' name='L11122'></a> 11122                         <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, width, height);
<a id='L11123' name='L11123'></a> 11123     <em class='brace'>}</em>
<a id='L11124' name='L11124'></a> 11124 <em class='sharp'>#ifndef</em> USE_GTK
<a id='L11125' name='L11125'></a> 11125   <strong class='reserved'>else</strong>
<a id='L11126' name='L11126'></a> 11126     <a href='../S/2289.html#L11067' title='Defined at 11067 in src/xterm.c.'>x_clear_area1</a> (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L11127' name='L11127'></a> 11127                    <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, width, height, False);
<a id='L11128' name='L11128'></a> 11128 <em class='sharp'>#endif</em>
<a id='L11129' name='L11129'></a> 11129 <em class='sharp'>#endif</em>
<a id='L11130' name='L11130'></a> 11130 <em class='brace'>}</em>
<a id='L11131' name='L11131'></a> 11131 
<a id='L11132' name='L11132'></a> 11132 
<a id='L11133' name='L11133'></a> 11133 <em class='comment'>/* Clear an entire frame.  */</em>
<a id='L11134' name='L11134'></a> 11134 
<a id='L11135' name='L11135'></a> 11135 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L11136' name='L11136'></a> 11136 <a href='../S/2289.html#L31526' title='Referred from 31526 in src/xterm.c.'>x_clear_frame</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L11137' name='L11137'></a> 11137 <em class='brace'>{</em>
<a id='L11138' name='L11138'></a> 11138   <em class='comment'>/* Clearing the frame will erase any cursor, so mark them all as no</em>
<a id='L11139' name='L11139'></a> 11139 <em class='comment'>     longer visible.  */</em>
<a id='L11140' name='L11140'></a> 11140   <a href='../S/2108.html#L5434' title='Defined at 5434 in src/window.c.'>mark_window_cursors_off</a> (<a href='../D/7409.html' title='Multiple defined in 2 places.'>XWINDOW</a> (<a href='../S/2183.html#L1203' title='Defined at 1203 in src/frame.h.'>FRAME_ROOT_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)));
<a id='L11141' name='L11141'></a> 11141 
<a id='L11142' name='L11142'></a> 11142   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L11143' name='L11143'></a> 11143   <a href='../S/2262.html#L5564' title='Defined at 5564 in src/font.c.'>font_drop_xrender_surfaces</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L11144' name='L11144'></a> 11144   <a href='../S/2289.html#L6643' title='Defined at 6643 in src/xterm.c.'>x_clear_window</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L11145' name='L11145'></a> 11145 
<a id='L11146' name='L11146'></a> 11146   <em class='comment'>/* We have to clear the scroll bars.  If we have changed colors or</em>
<a id='L11147' name='L11147'></a> 11147 <em class='comment'>     something like that, then they should be notified.  */</em>
<a id='L11148' name='L11148'></a> 11148   x_scroll_bar_clear (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L11149' name='L11149'></a> 11149 
<a id='L11150' name='L11150'></a> 11150   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L11151' name='L11151'></a> 11151 <em class='brace'>}</em>
<a id='L11152' name='L11152'></a> 11152 
<a id='L11153' name='L11153'></a> 11153 <em class='comment'>/* Send a message to frame F telling the event loop to track whether</em>
<a id='L11154' name='L11154'></a> 11154 <em class='comment'>   or not an hourglass is being displayed.  This is required to ignore</em>
<a id='L11155' name='L11155'></a> 11155 <em class='comment'>   the right events when the hourglass is mapped without callig XSync</em>
<a id='L11156' name='L11156'></a> 11156 <em class='comment'>   after displaying or hiding the hourglass.  */</em>
<a id='L11157' name='L11157'></a> 11157 
<a id='L11158' name='L11158'></a> 11158 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L11159' name='L11159'></a> 11159 <a href='../R/18285.html' title='Multiple referred from 2 places.'>x_send_hourglass_message</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> hourglass_enabled)
<a id='L11160' name='L11160'></a> 11160 <em class='brace'>{</em>
<a id='L11161' name='L11161'></a> 11161   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L11162' name='L11162'></a> 11162   XEvent msg;
<a id='L11163' name='L11163'></a> 11163 
<a id='L11164' name='L11164'></a> 11164   dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L11165' name='L11165'></a> 11165   memset (&amp;msg, 0, <strong class='reserved'>sizeof</strong> msg);
<a id='L11166' name='L11166'></a> 11166 
<a id='L11167' name='L11167'></a> 11167   msg.xclient.type = ClientMessage;
<a id='L11168' name='L11168'></a> 11168   msg.xclient.message_type
<a id='L11169' name='L11169'></a> 11169     = dpyinfo-&gt;Xatom_EMACS_TMP;
<a id='L11170' name='L11170'></a> 11170   msg.xclient.format = 8;
<a id='L11171' name='L11171'></a> 11171   msg.xclient.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L11172' name='L11172'></a> 11172   msg.xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[0] = hourglass_enabled ? 1 : 0;
<a id='L11173' name='L11173'></a> 11173 
<a id='L11174' name='L11174'></a> 11174   XSendEvent (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L11175' name='L11175'></a> 11175               False, NoEventMask, &amp;msg);
<a id='L11176' name='L11176'></a> 11176 <em class='brace'>}</em>
<a id='L11177' name='L11177'></a> 11177 
<a id='L11178' name='L11178'></a> 11178 <em class='comment'>/* RIF: Show hourglass cursor on frame F.  */</em>
<a id='L11179' name='L11179'></a> 11179 
<a id='L11180' name='L11180'></a> 11180 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L11181' name='L11181'></a> 11181 <a href='../S/2289.html#L31342' title='Referred from 31342 in src/xterm.c.'>x_show_hourglass</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L11182' name='L11182'></a> 11182 <em class='brace'>{</em>
<a id='L11183' name='L11183'></a> 11183   <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy = <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L11184' name='L11184'></a> 11184 
<a id='L11185' name='L11185'></a> 11185   <strong class='reserved'>if</strong> (dpy)
<a id='L11186' name='L11186'></a> 11186     <em class='brace'>{</em>
<a id='L11187' name='L11187'></a> 11187       <strong class='reserved'>struct</strong> <a href='../D/19627.html' title='Multiple defined in 5 places.'>x_output</a> *<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L11188' name='L11188'></a> 11188 
<a id='L11189' name='L11189'></a> 11189       <em class='comment'>/* If the hourglass window is mapped inside a popup menu, input</em>
<a id='L11190' name='L11190'></a> 11190 <em class='comment'>         could be lost if the menu is popped down and the grab is</em>
<a id='L11191' name='L11191'></a> 11191 <em class='comment'>         relinquished, but the hourglass window is still up.  Just</em>
<a id='L11192' name='L11192'></a> 11192 <em class='comment'>         avoid displaying the hourglass at all while popups are</em>
<a id='L11193' name='L11193'></a> 11193 <em class='comment'>         active.  */</em>
<a id='L11194' name='L11194'></a> 11194 
<a id='L11195' name='L11195'></a> 11195       <strong class='reserved'>if</strong> (<a href='../D/15672.html' title='Multiple defined in 5 places.'>popup_activated</a> ())
<a id='L11196' name='L11196'></a> 11196         <strong class='reserved'>return</strong>;
<a id='L11197' name='L11197'></a> 11197 
<a id='L11198' name='L11198'></a> 11198       <a href='../S/2289.html#L11159' title='Defined at 11159 in src/xterm.c.'>x_send_hourglass_message</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L11199' name='L11199'></a> 11199 
<a id='L11200' name='L11200'></a> 11200 <em class='sharp'>#ifdef</em> USE_X_TOOLKIT
<a id='L11201' name='L11201'></a> 11201       <strong class='reserved'>if</strong> (<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;widget)
<a id='L11202' name='L11202'></a> 11202 <em class='sharp'>#else</em>
<a id='L11203' name='L11203'></a> 11203       <strong class='reserved'>if</strong> (<a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L11204' name='L11204'></a> 11204 <em class='sharp'>#endif</em>
<a id='L11205' name='L11205'></a> 11205        <em class='brace'>{</em>
<a id='L11206' name='L11206'></a> 11206          <strong class='reserved'>if</strong> (!<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;hourglass_window)
<a id='L11207' name='L11207'></a> 11207            <em class='brace'>{</em>
<a id='L11208' name='L11208'></a> 11208 <em class='sharp'>#ifndef</em> USE_XCB
<a id='L11209' name='L11209'></a> 11209              <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> mask = CWCursor;
<a id='L11210' name='L11210'></a> 11210              XSetWindowAttributes attrs;
<a id='L11211' name='L11211'></a> 11211 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L11212' name='L11212'></a> 11212              <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> <a href='../D/15236.html' title='Multiple defined in 2 places.'>parent</a> = <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L11213' name='L11213'></a> 11213 <em class='sharp'>#else</em>
<a id='L11214' name='L11214'></a> 11214              <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> <a href='../D/15236.html' title='Multiple defined in 2 places.'>parent</a> = <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L11215' name='L11215'></a> 11215 <em class='sharp'>#endif</em>
<a id='L11216' name='L11216'></a> 11216              attrs.cursor = <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;hourglass_cursor;
<a id='L11217' name='L11217'></a> 11217 
<a id='L11218' name='L11218'></a> 11218              <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;hourglass_window = XCreateWindow
<a id='L11219' name='L11219'></a> 11219                (dpy, <a href='../D/15236.html' title='Multiple defined in 2 places.'>parent</a>, 0, 0, 32000, 32000, 0, 0,
<a id='L11220' name='L11220'></a> 11220                 InputOnly, CopyFromParent, mask, &amp;attrs);
<a id='L11221' name='L11221'></a> 11221 <em class='sharp'>#else</em>
<a id='L11222' name='L11222'></a> 11222              <a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> cursor = (<a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a>) <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;hourglass_cursor;
<a id='L11223' name='L11223'></a> 11223 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L11224' name='L11224'></a> 11224              xcb_window_t <a href='../D/15236.html' title='Multiple defined in 2 places.'>parent</a> = (xcb_window_t) <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L11225' name='L11225'></a> 11225 <em class='sharp'>#else</em>
<a id='L11226' name='L11226'></a> 11226              xcb_window_t <a href='../D/15236.html' title='Multiple defined in 2 places.'>parent</a> = (xcb_window_t) <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L11227' name='L11227'></a> 11227 <em class='sharp'>#endif</em>
<a id='L11228' name='L11228'></a> 11228              <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;hourglass_window
<a id='L11229' name='L11229'></a> 11229                = (<a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a>) xcb_generate_id (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;xcb_connection);
<a id='L11230' name='L11230'></a> 11230 
<a id='L11231' name='L11231'></a> 11231              xcb_create_window (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;xcb_connection,
<a id='L11232' name='L11232'></a> 11232                                 XCB_COPY_FROM_PARENT,
<a id='L11233' name='L11233'></a> 11233                                 (xcb_window_t) <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;hourglass_window,
<a id='L11234' name='L11234'></a> 11234                                 <a href='../D/15236.html' title='Multiple defined in 2 places.'>parent</a>, 0, 0, <a href='../S/2183.html#L1051' title='Defined at 1051 in src/frame.h.'>FRAME_PIXEL_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L11235' name='L11235'></a> 11235                                 <a href='../S/2183.html#L1052' title='Defined at 1052 in src/frame.h.'>FRAME_PIXEL_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), 0,
<a id='L11236' name='L11236'></a> 11236                                 XCB_WINDOW_CLASS_INPUT_ONLY,
<a id='L11237' name='L11237'></a> 11237                                 XCB_COPY_FROM_PARENT, XCB_CW_CURSOR,
<a id='L11238' name='L11238'></a> 11238                                 &amp;cursor);
<a id='L11239' name='L11239'></a> 11239 <em class='sharp'>#endif</em>
<a id='L11240' name='L11240'></a> 11240            <em class='brace'>}</em>
<a id='L11241' name='L11241'></a> 11241 
<a id='L11242' name='L11242'></a> 11242 <em class='sharp'>#ifndef</em> USE_XCB
<a id='L11243' name='L11243'></a> 11243          XMapRaised (dpy, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;hourglass_window);
<a id='L11244' name='L11244'></a> 11244          <em class='comment'>/* Ensure that the spinning hourglass is shown.  */</em>
<a id='L11245' name='L11245'></a> 11245          <a href='../S/2183.html#L1896' title='Defined at 1896 in src/frame.h.'>flush_frame</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L11246' name='L11246'></a> 11246 <em class='sharp'>#else</em>
<a id='L11247' name='L11247'></a> 11247          <a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a> = XCB_STACK_MODE_ABOVE;
<a id='L11248' name='L11248'></a> 11248 
<a id='L11249' name='L11249'></a> 11249          xcb_configure_window (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;xcb_connection,
<a id='L11250' name='L11250'></a> 11250                                (xcb_window_t) <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;hourglass_window,
<a id='L11251' name='L11251'></a> 11251                                XCB_CONFIG_WINDOW_STACK_MODE, &amp;<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>);
<a id='L11252' name='L11252'></a> 11252          xcb_map_window (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;xcb_connection,
<a id='L11253' name='L11253'></a> 11253                          (xcb_window_t) <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;hourglass_window);
<a id='L11254' name='L11254'></a> 11254          xcb_flush (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;xcb_connection);
<a id='L11255' name='L11255'></a> 11255 <em class='sharp'>#endif</em>
<a id='L11256' name='L11256'></a> 11256        <em class='brace'>}</em>
<a id='L11257' name='L11257'></a> 11257     <em class='brace'>}</em>
<a id='L11258' name='L11258'></a> 11258 <em class='brace'>}</em>
<a id='L11259' name='L11259'></a> 11259 
<a id='L11260' name='L11260'></a> 11260 <em class='comment'>/* RIF: Cancel hourglass cursor on frame F.  */</em>
<a id='L11261' name='L11261'></a> 11261 
<a id='L11262' name='L11262'></a> 11262 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L11263' name='L11263'></a> 11263 <a href='../S/2289.html#L31343' title='Referred from 31343 in src/xterm.c.'>x_hide_hourglass</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L11264' name='L11264'></a> 11264 <em class='brace'>{</em>
<a id='L11265' name='L11265'></a> 11265   <strong class='reserved'>struct</strong> <a href='../D/19627.html' title='Multiple defined in 5 places.'>x_output</a> *<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L11266' name='L11266'></a> 11266 
<a id='L11267' name='L11267'></a> 11267   <em class='comment'>/* Watch out for newly created frames.  */</em>
<a id='L11268' name='L11268'></a> 11268   <strong class='reserved'>if</strong> (<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;hourglass_window)
<a id='L11269' name='L11269'></a> 11269     <em class='brace'>{</em>
<a id='L11270' name='L11270'></a> 11270 <em class='sharp'>#ifndef</em> USE_XCB
<a id='L11271' name='L11271'></a> 11271       XUnmapWindow (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;hourglass_window);
<a id='L11272' name='L11272'></a> 11272 <em class='sharp'>#else</em>
<a id='L11273' name='L11273'></a> 11273       xcb_unmap_window (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;xcb_connection,
<a id='L11274' name='L11274'></a> 11274                         (xcb_window_t) <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;hourglass_window);
<a id='L11275' name='L11275'></a> 11275 <em class='sharp'>#endif</em>
<a id='L11276' name='L11276'></a> 11276       <a href='../S/2289.html#L11159' title='Defined at 11159 in src/xterm.c.'>x_send_hourglass_message</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L11277' name='L11277'></a> 11277     <em class='brace'>}</em>
<a id='L11278' name='L11278'></a> 11278 <em class='brace'>}</em>
<a id='L11279' name='L11279'></a> 11279 
<a id='L11280' name='L11280'></a> 11280 <em class='comment'>/* Invert the middle quarter of the frame for .15 sec.  */</em>
<a id='L11281' name='L11281'></a> 11281 
<a id='L11282' name='L11282'></a> 11282 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L11283' name='L11283'></a> 11283 <a href='../S/2289.html#L11410' title='Referred from 11410 in src/xterm.c.'>XTflash</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L11284' name='L11284'></a> 11284 <em class='brace'>{</em>
<a id='L11285' name='L11285'></a> 11285   <a href='../D/2619.html' title='Multiple defined in 2 places.'>GC</a> gc;
<a id='L11286' name='L11286'></a> 11286   XGCValues values;
<a id='L11287' name='L11287'></a> 11287   <a href='../D/11311.html' title='Multiple defined in 3 places.'>fd_set</a> fds;
<a id='L11288' name='L11288'></a> 11288   <strong class='reserved'>int</strong> fd, rc;
<a id='L11289' name='L11289'></a> 11289 
<a id='L11290' name='L11290'></a> 11290   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L11291' name='L11291'></a> 11291 
<a id='L11292' name='L11292'></a> 11292   <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1437' title='Defined at 1437 in src/xterm.h.'>FRAME_X_VISUAL_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;class == TrueColor)
<a id='L11293' name='L11293'></a> 11293     <em class='brace'>{</em>
<a id='L11294' name='L11294'></a> 11294       values.function = GXxor;
<a id='L11295' name='L11295'></a> 11295       values.foreground = (<a href='../S/2183.html#L1376' title='Defined at 1376 in src/frame.h.'>FRAME_FOREGROUND_PIXEL</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L11296' name='L11296'></a> 11296                            ^ <a href='../S/2183.html#L1377' title='Defined at 1377 in src/frame.h.'>FRAME_BACKGROUND_PIXEL</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L11297' name='L11297'></a> 11297 
<a id='L11298' name='L11298'></a> 11298       gc = <a href='../S/2215.html#L260' title='Defined at 260 in src/w32term.c.'>XCreateGC</a> (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L11299' name='L11299'></a> 11299                       GCFunction | <a href='../S/2315.html#L89' title='Defined at 89 in src/dispextern.h.'>GCForeground</a>, &amp;values);
<a id='L11300' name='L11300'></a> 11300     <em class='brace'>}</em>
<a id='L11301' name='L11301'></a> 11301   <strong class='reserved'>else</strong>
<a id='L11302' name='L11302'></a> 11302     gc = <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;normal_gc;
<a id='L11303' name='L11303'></a> 11303 
<a id='L11304' name='L11304'></a> 11304 
<a id='L11305' name='L11305'></a> 11305   <em class='comment'>/* Get the height not including a menu bar widget.  */</em>
<a id='L11306' name='L11306'></a> 11306   <strong class='reserved'>int</strong> height = <a href='../S/2183.html#L1052' title='Defined at 1052 in src/frame.h.'>FRAME_PIXEL_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L11307' name='L11307'></a> 11307   <em class='comment'>/* Height of each line to flash.  */</em>
<a id='L11308' name='L11308'></a> 11308   <strong class='reserved'>int</strong> flash_height = <a href='../S/2183.html#L1543' title='Defined at 1543 in src/frame.h.'>FRAME_LINE_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L11309' name='L11309'></a> 11309   <em class='comment'>/* These will be the left and right margins of the rectangles.  */</em>
<a id='L11310' name='L11310'></a> 11310   <strong class='reserved'>int</strong> flash_left = <a href='../S/2183.html#L1603' title='Defined at 1603 in src/frame.h.'>FRAME_INTERNAL_BORDER_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L11311' name='L11311'></a> 11311   <strong class='reserved'>int</strong> flash_right = <a href='../S/2183.html#L1051' title='Defined at 1051 in src/frame.h.'>FRAME_PIXEL_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) - <a href='../S/2183.html#L1603' title='Defined at 1603 in src/frame.h.'>FRAME_INTERNAL_BORDER_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L11312' name='L11312'></a> 11312   <strong class='reserved'>int</strong> width = flash_right - flash_left;
<a id='L11313' name='L11313'></a> 11313 
<a id='L11314' name='L11314'></a> 11314   <em class='comment'>/* If window is tall, flash top and bottom line.  */</em>
<a id='L11315' name='L11315'></a> 11315   <strong class='reserved'>if</strong> (height &gt; 3 * <a href='../S/2183.html#L1543' title='Defined at 1543 in src/frame.h.'>FRAME_LINE_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L11316' name='L11316'></a> 11316     <em class='brace'>{</em>
<a id='L11317' name='L11317'></a> 11317       XFillRectangle (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), gc,
<a id='L11318' name='L11318'></a> 11318                       flash_left,
<a id='L11319' name='L11319'></a> 11319                       (<a href='../S/2183.html#L1603' title='Defined at 1603 in src/frame.h.'>FRAME_INTERNAL_BORDER_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L11320' name='L11320'></a> 11320                        + <a href='../S/2183.html#L1124' title='Defined at 1124 in src/frame.h.'>FRAME_TOP_MARGIN_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)),
<a id='L11321' name='L11321'></a> 11321                       width, flash_height);
<a id='L11322' name='L11322'></a> 11322       XFillRectangle (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), gc,
<a id='L11323' name='L11323'></a> 11323                       flash_left,
<a id='L11324' name='L11324'></a> 11324                       (height - flash_height
<a id='L11325' name='L11325'></a> 11325                        - <a href='../S/2183.html#L1603' title='Defined at 1603 in src/frame.h.'>FRAME_INTERNAL_BORDER_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L11326' name='L11326'></a> 11326                        - <a href='../S/2183.html#L1136' title='Defined at 1136 in src/frame.h.'>FRAME_BOTTOM_MARGIN_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)),
<a id='L11327' name='L11327'></a> 11327                       width, flash_height);
<a id='L11328' name='L11328'></a> 11328 
<a id='L11329' name='L11329'></a> 11329     <em class='brace'>}</em>
<a id='L11330' name='L11330'></a> 11330   <strong class='reserved'>else</strong>
<a id='L11331' name='L11331'></a> 11331     <em class='comment'>/* If it is short, flash it all.  */</em>
<a id='L11332' name='L11332'></a> 11332     XFillRectangle (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), gc,
<a id='L11333' name='L11333'></a> 11333                     flash_left, <a href='../S/2183.html#L1603' title='Defined at 1603 in src/frame.h.'>FRAME_INTERNAL_BORDER_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L11334' name='L11334'></a> 11334                     width, height - 2 * <a href='../S/2183.html#L1603' title='Defined at 1603 in src/frame.h.'>FRAME_INTERNAL_BORDER_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L11335' name='L11335'></a> 11335 
<a id='L11336' name='L11336'></a> 11336   <a href='../S/2289.html#L5056' title='Defined at 5056 in src/xterm.c.'>x_flush</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L11337' name='L11337'></a> 11337 
<a id='L11338' name='L11338'></a> 11338   <strong class='reserved'>struct</strong> <a href='../D/18278.html' title='Multiple defined in 3 places.'>timespec</a> delay = <a href='../S/2788.html#L56' title='Defined at 56 in lib/timespec.h.'>make_timespec</a> (0, 150 * 1000 * 1000);
<a id='L11339' name='L11339'></a> 11339   <strong class='reserved'>struct</strong> <a href='../D/18278.html' title='Multiple defined in 3 places.'>timespec</a> wakeup = <a href='../D/18279.html' title='Multiple defined in 2 places.'>timespec_add</a> (<a href='../S/2947.html#L46' title='Defined at 46 in lib/gettime.c.'>current_timespec</a> (), delay);
<a id='L11340' name='L11340'></a> 11340   fd = ConnectionNumber (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L11341' name='L11341'></a> 11341 
<a id='L11342' name='L11342'></a> 11342   <em class='comment'>/* Keep waiting until past the time wakeup or any input gets</em>
<a id='L11343' name='L11343'></a> 11343 <em class='comment'>     available.  */</em>
<a id='L11344' name='L11344'></a> 11344   <strong class='reserved'>while</strong> (! <a href='../D/10455.html' title='Multiple defined in 2 places.'>detect_input_pending</a> ())
<a id='L11345' name='L11345'></a> 11345     <em class='brace'>{</em>
<a id='L11346' name='L11346'></a> 11346       <strong class='reserved'>struct</strong> <a href='../D/18278.html' title='Multiple defined in 3 places.'>timespec</a> current = <a href='../S/2947.html#L46' title='Defined at 46 in lib/gettime.c.'>current_timespec</a> ();
<a id='L11347' name='L11347'></a> 11347       <strong class='reserved'>struct</strong> <a href='../D/18278.html' title='Multiple defined in 3 places.'>timespec</a> timeout;
<a id='L11348' name='L11348'></a> 11348 
<a id='L11349' name='L11349'></a> 11349       <em class='comment'>/* Break if result would not be positive.  */</em>
<a id='L11350' name='L11350'></a> 11350       <strong class='reserved'>if</strong> (<a href='../S/2788.html#L64' title='Defined at 64 in lib/timespec.h.'>timespec_cmp</a> (wakeup, current) &lt;= 0)
<a id='L11351' name='L11351'></a> 11351         <strong class='reserved'>break</strong>;
<a id='L11352' name='L11352'></a> 11352 
<a id='L11353' name='L11353'></a> 11353       <em class='comment'>/* How long `select' should wait.  */</em>
<a id='L11354' name='L11354'></a> 11354       timeout = <a href='../S/2788.html#L56' title='Defined at 56 in lib/timespec.h.'>make_timespec</a> (0, 10 * 1000 * 1000);
<a id='L11355' name='L11355'></a> 11355 
<a id='L11356' name='L11356'></a> 11356       <em class='comment'>/* Wait for some input to become available on the X</em>
<a id='L11357' name='L11357'></a> 11357 <em class='comment'>         connection.  */</em>
<a id='L11358' name='L11358'></a> 11358       <a href='../D/2046.html' title='Multiple defined in 4 places.'>FD_ZERO</a> (&amp;fds);
<a id='L11359' name='L11359'></a> 11359       <a href='../D/2044.html' title='Multiple defined in 6 places.'>FD_SET</a> (fd, &amp;fds);
<a id='L11360' name='L11360'></a> 11360 
<a id='L11361' name='L11361'></a> 11361       <em class='comment'>/* Try to wait that long--but we might wake up sooner.  */</em>
<a id='L11362' name='L11362'></a> 11362       rc = <a href='../D/15844.html' title='Multiple defined in 7 places.'>pselect</a> (fd + 1, &amp;fds, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, &amp;timeout, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L11363' name='L11363'></a> 11363 
<a id='L11364' name='L11364'></a> 11364       <em class='comment'>/* Some input is available, exit the visible bell.  */</em>
<a id='L11365' name='L11365'></a> 11365       <strong class='reserved'>if</strong> (rc &gt;= 0 &amp;&amp; <a href='../D/2043.html' title='Multiple defined in 8 places.'>FD_ISSET</a> (fd, &amp;fds))
<a id='L11366' name='L11366'></a> 11366         <strong class='reserved'>break</strong>;
<a id='L11367' name='L11367'></a> 11367     <em class='brace'>}</em>
<a id='L11368' name='L11368'></a> 11368 
<a id='L11369' name='L11369'></a> 11369   <em class='comment'>/* If window is tall, flash top and bottom line.  */</em>
<a id='L11370' name='L11370'></a> 11370   <strong class='reserved'>if</strong> (height &gt; 3 * <a href='../S/2183.html#L1543' title='Defined at 1543 in src/frame.h.'>FRAME_LINE_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L11371' name='L11371'></a> 11371     <em class='brace'>{</em>
<a id='L11372' name='L11372'></a> 11372       XFillRectangle (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), gc,
<a id='L11373' name='L11373'></a> 11373                       flash_left,
<a id='L11374' name='L11374'></a> 11374                       (<a href='../S/2183.html#L1603' title='Defined at 1603 in src/frame.h.'>FRAME_INTERNAL_BORDER_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L11375' name='L11375'></a> 11375                        + <a href='../S/2183.html#L1124' title='Defined at 1124 in src/frame.h.'>FRAME_TOP_MARGIN_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)),
<a id='L11376' name='L11376'></a> 11376                       width, flash_height);
<a id='L11377' name='L11377'></a> 11377       XFillRectangle (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), gc,
<a id='L11378' name='L11378'></a> 11378                       flash_left,
<a id='L11379' name='L11379'></a> 11379                       (height - flash_height
<a id='L11380' name='L11380'></a> 11380                        - <a href='../S/2183.html#L1603' title='Defined at 1603 in src/frame.h.'>FRAME_INTERNAL_BORDER_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L11381' name='L11381'></a> 11381                        - <a href='../S/2183.html#L1136' title='Defined at 1136 in src/frame.h.'>FRAME_BOTTOM_MARGIN_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)),
<a id='L11382' name='L11382'></a> 11382                       width, flash_height);
<a id='L11383' name='L11383'></a> 11383     <em class='brace'>}</em>
<a id='L11384' name='L11384'></a> 11384   <strong class='reserved'>else</strong>
<a id='L11385' name='L11385'></a> 11385     <em class='comment'>/* If it is short, flash it all.  */</em>
<a id='L11386' name='L11386'></a> 11386     XFillRectangle (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), gc,
<a id='L11387' name='L11387'></a> 11387                     flash_left, <a href='../S/2183.html#L1603' title='Defined at 1603 in src/frame.h.'>FRAME_INTERNAL_BORDER_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L11388' name='L11388'></a> 11388                     width, height - 2 * <a href='../S/2183.html#L1603' title='Defined at 1603 in src/frame.h.'>FRAME_INTERNAL_BORDER_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L11389' name='L11389'></a> 11389 
<a id='L11390' name='L11390'></a> 11390   <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1437' title='Defined at 1437 in src/xterm.h.'>FRAME_X_VISUAL_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;class == TrueColor)
<a id='L11391' name='L11391'></a> 11391     <a href='../S/2321.html#L121' title='Defined at 121 in src/msdos.h.'>XFreeGC</a> (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), gc);
<a id='L11392' name='L11392'></a> 11392   <a href='../S/2289.html#L5056' title='Defined at 5056 in src/xterm.c.'>x_flush</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L11393' name='L11393'></a> 11393 
<a id='L11394' name='L11394'></a> 11394   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L11395' name='L11395'></a> 11395 <em class='brace'>}</em>
<a id='L11396' name='L11396'></a> 11396 
<a id='L11397' name='L11397'></a> 11397 <em class='comment'>/* Make audible bell.  */</em>
<a id='L11398' name='L11398'></a> 11398 
<a id='L11399' name='L11399'></a> 11399 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L11400' name='L11400'></a> 11400 <a href='../S/2289.html#L31529' title='Referred from 31529 in src/xterm.c.'>XTring_bell</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L11401' name='L11401'></a> 11401 <em class='brace'>{</em>
<a id='L11402' name='L11402'></a> 11402   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L11403' name='L11403'></a> 11403 
<a id='L11404' name='L11404'></a> 11404   <strong class='reserved'>if</strong> (!<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L11405' name='L11405'></a> 11405     <strong class='reserved'>return</strong>;
<a id='L11406' name='L11406'></a> 11406 
<a id='L11407' name='L11407'></a> 11407   dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L11408' name='L11408'></a> 11408 
<a id='L11409' name='L11409'></a> 11409   <strong class='reserved'>if</strong> (visible_bell)
<a id='L11410' name='L11410'></a> 11410     <a href='../S/2289.html#L11283' title='Defined at 11283 in src/xterm.c.'>XTflash</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L11411' name='L11411'></a> 11411   <strong class='reserved'>else</strong>
<a id='L11412' name='L11412'></a> 11412     <em class='brace'>{</em>
<a id='L11413' name='L11413'></a> 11413       <em class='comment'>/* When Emacs is untrusted, Bell requests sometimes generate</em>
<a id='L11414' name='L11414'></a> 11414 <em class='comment'>         Access errors.  This is not in the security extension</em>
<a id='L11415' name='L11415'></a> 11415 <em class='comment'>         specification but seems to be a bug in the X consortium XKB</em>
<a id='L11416' name='L11416'></a> 11416 <em class='comment'>         implementation.  */</em>
<a id='L11417' name='L11417'></a> 11417 
<a id='L11418' name='L11418'></a> 11418       <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L11419' name='L11419'></a> 11419       x_ignore_errors_for_next_request (dpyinfo, 0);
<a id='L11420' name='L11420'></a> 11420 <em class='sharp'>#ifdef</em> HAVE_XKB
<a id='L11421' name='L11421'></a> 11421       XkbBell (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), 0, None);
<a id='L11422' name='L11422'></a> 11422 <em class='sharp'>#else</em>
<a id='L11423' name='L11423'></a> 11423       XBell (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), 0);
<a id='L11424' name='L11424'></a> 11424 <em class='sharp'>#endif</em>
<a id='L11425' name='L11425'></a> 11425       XFlush (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L11426' name='L11426'></a> 11426       x_stop_ignoring_errors (dpyinfo);
<a id='L11427' name='L11427'></a> 11427       <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L11428' name='L11428'></a> 11428     <em class='brace'>}</em>
<a id='L11429' name='L11429'></a> 11429 <em class='brace'>}</em>
<a id='L11430' name='L11430'></a> 11430 
<a id='L11431' name='L11431'></a> 11431 <em class='comment'>/***********************************************************************</em>
<a id='L11432' name='L11432'></a> 11432 <em class='comment'>                              Line Dance</em>
<a id='L11433' name='L11433'></a> 11433 <em class='comment'> ***********************************************************************/</em>
<a id='L11434' name='L11434'></a> 11434 
<a id='L11435' name='L11435'></a> 11435 <em class='comment'>/* Perform an insert-lines or delete-lines operation, inserting N</em>
<a id='L11436' name='L11436'></a> 11436 <em class='comment'>   lines or deleting -N lines at vertical position VPOS.  */</em>
<a id='L11437' name='L11437'></a> 11437 
<a id='L11438' name='L11438'></a> 11438 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L11439' name='L11439'></a> 11439 <a href='../S/2289.html#L31527' title='Referred from 31527 in src/xterm.c.'>x_ins_del_lines</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <strong class='reserved'>int</strong> vpos, <strong class='reserved'>int</strong> n)
<a id='L11440' name='L11440'></a> 11440 <em class='brace'>{</em>
<a id='L11441' name='L11441'></a> 11441   <a href='../D/10893.html' title='Multiple defined in 6 places.'>emacs_abort</a> ();
<a id='L11442' name='L11442'></a> 11442 <em class='brace'>}</em>
<a id='L11443' name='L11443'></a> 11443 
<a id='L11444' name='L11444'></a> 11444 
<a id='L11445' name='L11445'></a> 11445 <em class='comment'>/* Scroll part of the display as described by RUN.  */</em>
<a id='L11446' name='L11446'></a> 11446 
<a id='L11447' name='L11447'></a> 11447 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L11448' name='L11448'></a> 11448 <a href='../S/2289.html#L31317' title='Referred from 31317 in src/xterm.c.'>x_scroll_run</a> (<strong class='reserved'>struct</strong> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> *w, <strong class='reserved'>struct</strong> <a href='../D/16514.html' title='Multiple defined in 3 places.'>run</a> *<a href='../D/16514.html' title='Multiple defined in 3 places.'>run</a>)
<a id='L11449' name='L11449'></a> 11449 <em class='brace'>{</em>
<a id='L11450' name='L11450'></a> 11450   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (w-&gt;<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>);
<a id='L11451' name='L11451'></a> 11451   <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, width, height, from_y, to_y, bottom_y;
<a id='L11452' name='L11452'></a> 11452 
<a id='L11453' name='L11453'></a> 11453   <em class='comment'>/* Get frame-relative bounding box of the text display area of W,</em>
<a id='L11454' name='L11454'></a> 11454 <em class='comment'>     without mode lines.  Include in this box the left and right</em>
<a id='L11455' name='L11455'></a> 11455 <em class='comment'>     fringe of W.  */</em>
<a id='L11456' name='L11456'></a> 11456   <a href='../S/2224.html#L1418' title='Defined at 1418 in src/xdisp.c.'>window_box</a> (w, <a href='../S/2315.html#L857' title='Defined at 857 in src/dispextern.h.'>ANY_AREA</a>, &amp;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, &amp;y, &amp;width, &amp;height);
<a id='L11457' name='L11457'></a> 11457 
<a id='L11458' name='L11458'></a> 11458   from_y = <a href='../S/2317.html#L1071' title='Defined at 1071 in src/window.h.'>WINDOW_TO_FRAME_PIXEL_Y</a> (w, <a href='../D/16514.html' title='Multiple defined in 3 places.'>run</a>-&gt;current_y);
<a id='L11459' name='L11459'></a> 11459   to_y = <a href='../S/2317.html#L1071' title='Defined at 1071 in src/window.h.'>WINDOW_TO_FRAME_PIXEL_Y</a> (w, <a href='../D/16514.html' title='Multiple defined in 3 places.'>run</a>-&gt;desired_y);
<a id='L11460' name='L11460'></a> 11460   bottom_y = y + height;
<a id='L11461' name='L11461'></a> 11461 
<a id='L11462' name='L11462'></a> 11462   <strong class='reserved'>if</strong> (to_y &lt; from_y)
<a id='L11463' name='L11463'></a> 11463     <em class='brace'>{</em>
<a id='L11464' name='L11464'></a> 11464       <em class='comment'>/* Scrolling up.  Make sure we don't copy part of the mode</em>
<a id='L11465' name='L11465'></a> 11465 <em class='comment'>         line at the bottom.  */</em>
<a id='L11466' name='L11466'></a> 11466       <strong class='reserved'>if</strong> (from_y + <a href='../D/16514.html' title='Multiple defined in 3 places.'>run</a>-&gt;height &gt; bottom_y)
<a id='L11467' name='L11467'></a> 11467         height = bottom_y - from_y;
<a id='L11468' name='L11468'></a> 11468       <strong class='reserved'>else</strong>
<a id='L11469' name='L11469'></a> 11469         height = <a href='../D/16514.html' title='Multiple defined in 3 places.'>run</a>-&gt;height;
<a id='L11470' name='L11470'></a> 11470     <em class='brace'>}</em>
<a id='L11471' name='L11471'></a> 11471   <strong class='reserved'>else</strong>
<a id='L11472' name='L11472'></a> 11472     <em class='brace'>{</em>
<a id='L11473' name='L11473'></a> 11473       <em class='comment'>/* Scrolling down.  Make sure we don't copy over the mode line.</em>
<a id='L11474' name='L11474'></a> 11474 <em class='comment'>         at the bottom.  */</em>
<a id='L11475' name='L11475'></a> 11475       <strong class='reserved'>if</strong> (to_y + <a href='../D/16514.html' title='Multiple defined in 3 places.'>run</a>-&gt;height &gt; bottom_y)
<a id='L11476' name='L11476'></a> 11476         height = bottom_y - to_y;
<a id='L11477' name='L11477'></a> 11477       <strong class='reserved'>else</strong>
<a id='L11478' name='L11478'></a> 11478         height = <a href='../D/16514.html' title='Multiple defined in 3 places.'>run</a>-&gt;height;
<a id='L11479' name='L11479'></a> 11479     <em class='brace'>}</em>
<a id='L11480' name='L11480'></a> 11480 
<a id='L11481' name='L11481'></a> 11481   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L11482' name='L11482'></a> 11482 
<a id='L11483' name='L11483'></a> 11483   <em class='comment'>/* Cursor off.  Will be switched on again in gui_update_window_end.  */</em>
<a id='L11484' name='L11484'></a> 11484   <a href='../S/2224.html#L33818' title='Defined at 33818 in src/xdisp.c.'>gui_clear_cursor</a> (w);
<a id='L11485' name='L11485'></a> 11485 
<a id='L11486' name='L11486'></a> 11486 <em class='sharp'>#ifdef</em> HAVE_XWIDGETS
<a id='L11487' name='L11487'></a> 11487   <em class='comment'>/* "Copy" xwidget windows in the area that will be scrolled.  */</em>
<a id='L11488' name='L11488'></a> 11488   <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy = <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L11489' name='L11489'></a> 11489   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L11490' name='L11490'></a> 11490 
<a id='L11491' name='L11491'></a> 11491   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> root, <a href='../D/15236.html' title='Multiple defined in 2 places.'>parent</a>, *children;
<a id='L11492' name='L11492'></a> 11492   <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> nchildren;
<a id='L11493' name='L11493'></a> 11493 
<a id='L11494' name='L11494'></a> 11494   <strong class='reserved'>if</strong> (XQueryTree (dpy, <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, &amp;root, &amp;<a href='../D/15236.html' title='Multiple defined in 2 places.'>parent</a>, &amp;children, &amp;nchildren))
<a id='L11495' name='L11495'></a> 11495     <em class='brace'>{</em>
<a id='L11496' name='L11496'></a> 11496       <em class='comment'>/* Now find xwidget views situated between from_y and to_y, and</em>
<a id='L11497' name='L11497'></a> 11497 <em class='comment'>         attached to w.  */</em>
<a id='L11498' name='L11498'></a> 11498       <strong class='reserved'>for</strong> (<strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> i = 0; i &lt; nchildren; ++i)
<a id='L11499' name='L11499'></a> 11499         <em class='brace'>{</em>
<a id='L11500' name='L11500'></a> 11500           <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> child = children[i];
<a id='L11501' name='L11501'></a> 11501           <strong class='reserved'>struct</strong> <a href='../S/2261.html#L102' title='Defined at 102 in src/xwidget.h.'>xwidget_view</a> *view = <a href='../S/2334.html#L2116' title='Defined at 2116 in src/xwidget.c.'>xwidget_view_from_window</a> (child);
<a id='L11502' name='L11502'></a> 11502 
<a id='L11503' name='L11503'></a> 11503           <strong class='reserved'>if</strong> (view &amp;&amp; !view-&gt;hidden)
<a id='L11504' name='L11504'></a> 11504             <em class='brace'>{</em>
<a id='L11505' name='L11505'></a> 11505               <strong class='reserved'>int</strong> window_y = view-&gt;y + view-&gt;clip_top;
<a id='L11506' name='L11506'></a> 11506               <strong class='reserved'>int</strong> window_height = view-&gt;clip_bottom - view-&gt;clip_top;
<a id='L11507' name='L11507'></a> 11507 
<a id='L11508' name='L11508'></a> 11508               <a href='../D/1995.html' title='Multiple defined in 3 places.'>Emacs_Rectangle</a> <a href='../S/4051.html#L55' title='Defined at 55 in test/manual/etags/c-src/sysdep.h.'>r1</a>, r2, result;
<a id='L11509' name='L11509'></a> 11509               <a href='../S/4051.html#L55' title='Defined at 55 in test/manual/etags/c-src/sysdep.h.'>r1</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = w-&gt;pixel_left;
<a id='L11510' name='L11510'></a> 11510               <a href='../S/4051.html#L55' title='Defined at 55 in test/manual/etags/c-src/sysdep.h.'>r1</a>.y = from_y;
<a id='L11511' name='L11511'></a> 11511               <a href='../S/4051.html#L55' title='Defined at 55 in test/manual/etags/c-src/sysdep.h.'>r1</a>.width = w-&gt;pixel_width;
<a id='L11512' name='L11512'></a> 11512               <a href='../S/4051.html#L55' title='Defined at 55 in test/manual/etags/c-src/sysdep.h.'>r1</a>.height = height;
<a id='L11513' name='L11513'></a> 11513               r2 = <a href='../S/4051.html#L55' title='Defined at 55 in test/manual/etags/c-src/sysdep.h.'>r1</a>;
<a id='L11514' name='L11514'></a> 11514               r2.y = window_y;
<a id='L11515' name='L11515'></a> 11515               r2.height = window_height;
<a id='L11516' name='L11516'></a> 11516 
<a id='L11517' name='L11517'></a> 11517               <em class='comment'>/* The window is offscreen, just unmap it.  */</em>
<a id='L11518' name='L11518'></a> 11518               <strong class='reserved'>if</strong> (window_height == 0)
<a id='L11519' name='L11519'></a> 11519                 <em class='brace'>{</em>
<a id='L11520' name='L11520'></a> 11520                   view-&gt;hidden = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L11521' name='L11521'></a> 11521                   XUnmapWindow (dpy, child);
<a id='L11522' name='L11522'></a> 11522                   <strong class='reserved'>continue</strong>;
<a id='L11523' name='L11523'></a> 11523                 <em class='brace'>}</em>
<a id='L11524' name='L11524'></a> 11524 
<a id='L11525' name='L11525'></a> 11525               <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> intersects_p =
<a id='L11526' name='L11526'></a> 11526                 <a href='../S/2224.html#L36555' title='Defined at 36555 in src/xdisp.c.'>gui_intersect_rectangles</a> (&amp;<a href='../S/4051.html#L55' title='Defined at 55 in test/manual/etags/c-src/sysdep.h.'>r1</a>, &amp;r2, &amp;result);
<a id='L11527' name='L11527'></a> 11527 
<a id='L11528' name='L11528'></a> 11528               <strong class='reserved'>if</strong> (<a href='../D/7409.html' title='Multiple defined in 2 places.'>XWINDOW</a> (view-&gt;w) == w &amp;&amp; intersects_p)
<a id='L11529' name='L11529'></a> 11529                 <em class='brace'>{</em>
<a id='L11530' name='L11530'></a> 11530                   <strong class='reserved'>int</strong> y = view-&gt;y + (to_y - from_y);
<a id='L11531' name='L11531'></a> 11531                   <strong class='reserved'>int</strong> text_area_x, text_area_y, text_area_width, text_area_height;
<a id='L11532' name='L11532'></a> 11532                   <strong class='reserved'>int</strong> clip_top, clip_bottom;
<a id='L11533' name='L11533'></a> 11533 
<a id='L11534' name='L11534'></a> 11534                   <a href='../S/2224.html#L1418' title='Defined at 1418 in src/xdisp.c.'>window_box</a> (w, view-&gt;area, &amp;text_area_x, &amp;text_area_y,
<a id='L11535' name='L11535'></a> 11535                               &amp;text_area_width, &amp;text_area_height);
<a id='L11536' name='L11536'></a> 11536 
<a id='L11537' name='L11537'></a> 11537                   view-&gt;y = y;
<a id='L11538' name='L11538'></a> 11538 
<a id='L11539' name='L11539'></a> 11539                   clip_top = 0;
<a id='L11540' name='L11540'></a> 11540                   clip_bottom = <a href='../S/2261.html#L160' title='Defined at 160 in src/xwidget.h.'>XXWIDGET</a> (view-&gt;model)-&gt;height;
<a id='L11541' name='L11541'></a> 11541 
<a id='L11542' name='L11542'></a> 11542                   <strong class='reserved'>if</strong> (y &lt; text_area_y)
<a id='L11543' name='L11543'></a> 11543                     clip_top = text_area_y - y;
<a id='L11544' name='L11544'></a> 11544 
<a id='L11545' name='L11545'></a> 11545                   <strong class='reserved'>if</strong> ((y + clip_bottom) &gt; (text_area_y + text_area_height))
<a id='L11546' name='L11546'></a> 11546                     <em class='brace'>{</em>
<a id='L11547' name='L11547'></a> 11547                       clip_bottom -= (y + clip_bottom) - (text_area_y + text_area_height);
<a id='L11548' name='L11548'></a> 11548                     <em class='brace'>}</em>
<a id='L11549' name='L11549'></a> 11549 
<a id='L11550' name='L11550'></a> 11550                   view-&gt;clip_top = clip_top;
<a id='L11551' name='L11551'></a> 11551                   view-&gt;clip_bottom = clip_bottom;
<a id='L11552' name='L11552'></a> 11552 
<a id='L11553' name='L11553'></a> 11553                   <em class='comment'>/* This means the view has moved offscreen.  Unmap</em>
<a id='L11554' name='L11554'></a> 11554 <em class='comment'>                     it and hide it here.  */</em>
<a id='L11555' name='L11555'></a> 11555                   <strong class='reserved'>if</strong> ((view-&gt;clip_bottom - view-&gt;clip_top) &lt;= 0)
<a id='L11556' name='L11556'></a> 11556                     <em class='brace'>{</em>
<a id='L11557' name='L11557'></a> 11557                       view-&gt;hidden = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L11558' name='L11558'></a> 11558                       XUnmapWindow (dpy, child);
<a id='L11559' name='L11559'></a> 11559                     <em class='brace'>}</em>
<a id='L11560' name='L11560'></a> 11560                   <strong class='reserved'>else</strong>
<a id='L11561' name='L11561'></a> 11561                     <em class='brace'>{</em>
<a id='L11562' name='L11562'></a> 11562                       XMoveResizeWindow (dpy, child, view-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + view-&gt;clip_left,
<a id='L11563' name='L11563'></a> 11563                                          view-&gt;y + view-&gt;clip_top,
<a id='L11564' name='L11564'></a> 11564                                          view-&gt;clip_right - view-&gt;clip_left,
<a id='L11565' name='L11565'></a> 11565                                          view-&gt;clip_bottom - view-&gt;clip_top);
<a id='L11566' name='L11566'></a> 11566                       cairo_xlib_surface_set_size (view-&gt;cr_surface,
<a id='L11567' name='L11567'></a> 11567                                                    view-&gt;clip_right - view-&gt;clip_left,
<a id='L11568' name='L11568'></a> 11568                                                    view-&gt;clip_bottom - view-&gt;clip_top);
<a id='L11569' name='L11569'></a> 11569                     <em class='brace'>}</em>
<a id='L11570' name='L11570'></a> 11570                   <a href='../S/2334.html#L2253' title='Defined at 2253 in src/xwidget.c.'>xwidget_expose</a> (view);
<a id='L11571' name='L11571'></a> 11571                 <em class='brace'>}</em>
<a id='L11572' name='L11572'></a> 11572             <em class='brace'>}</em>
<a id='L11573' name='L11573'></a> 11573         <em class='brace'>}</em>
<a id='L11574' name='L11574'></a> 11574       XFree (children);
<a id='L11575' name='L11575'></a> 11575     <em class='brace'>}</em>
<a id='L11576' name='L11576'></a> 11576 <em class='sharp'>#endif</em>
<a id='L11577' name='L11577'></a> 11577 
<a id='L11578' name='L11578'></a> 11578 <em class='sharp'>#ifdef</em> <a href='../S/2289.html#L798' title='Defined at 798 in src/xterm.c.'>USE_CAIRO_XCB_SURFACE</a>
<a id='L11579' name='L11579'></a> 11579   <em class='comment'>/* Some of the following code depends on `normal_gc' being</em>
<a id='L11580' name='L11580'></a> 11580 <em class='comment'>     up-to-date on the X server, but doesn't call a routine that will</em>
<a id='L11581' name='L11581'></a> 11581 <em class='comment'>     flush it first.  So do this ourselves instead.  */</em>
<a id='L11582' name='L11582'></a> 11582   XFlushGC (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L11583' name='L11583'></a> 11583             <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;normal_gc);
<a id='L11584' name='L11584'></a> 11584 <em class='sharp'>#endif</em>
<a id='L11585' name='L11585'></a> 11585 
<a id='L11586' name='L11586'></a> 11586 <em class='sharp'>#ifdef</em> USE_CAIRO
<a id='L11587' name='L11587'></a> 11587   <strong class='reserved'>if</strong> (<a href='../D/2280.html' title='Multiple defined in 3 places.'>FRAME_CR_CONTEXT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L11588' name='L11588'></a> 11588     <em class='brace'>{</em>
<a id='L11589' name='L11589'></a> 11589       cairo_surface_t *surface = cairo_get_target (<a href='../D/2280.html' title='Multiple defined in 3 places.'>FRAME_CR_CONTEXT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L11590' name='L11590'></a> 11590       <strong class='reserved'>if</strong> (cairo_surface_get_type (surface) == CAIRO_SURFACE_TYPE_XLIB)
<a id='L11591' name='L11591'></a> 11591         <em class='brace'>{</em>
<a id='L11592' name='L11592'></a> 11592           <a href='../D/10871.html' title='Multiple defined in 5 places.'>eassert</a> (cairo_xlib_surface_get_display (surface)
<a id='L11593' name='L11593'></a> 11593                    == <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L11594' name='L11594'></a> 11594           <a href='../D/10871.html' title='Multiple defined in 5 places.'>eassert</a> (cairo_xlib_surface_get_drawable (surface)
<a id='L11595' name='L11595'></a> 11595                    == <a href='../S/2212.html#L1344' title='Defined at 1344 in src/xterm.h.'>FRAME_X_RAW_DRAWABLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L11596' name='L11596'></a> 11596           cairo_surface_flush (surface);
<a id='L11597' name='L11597'></a> 11597           XCopyArea (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L11598' name='L11598'></a> 11598                      <a href='../S/2212.html#L1352' title='Defined at 1352 in src/xterm.h.'>FRAME_X_DRAWABLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../S/2212.html#L1352' title='Defined at 1352 in src/xterm.h.'>FRAME_X_DRAWABLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L11599' name='L11599'></a> 11599                      <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;normal_gc,
<a id='L11600' name='L11600'></a> 11600                      <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, from_y,
<a id='L11601' name='L11601'></a> 11601                      width, height,
<a id='L11602' name='L11602'></a> 11602                      <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, to_y);
<a id='L11603' name='L11603'></a> 11603           cairo_surface_mark_dirty_rectangle (surface, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, to_y, width, height);
<a id='L11604' name='L11604'></a> 11604         <em class='brace'>}</em>
<a id='L11605' name='L11605'></a> 11605 <em class='sharp'>#ifdef</em> <a href='../S/2289.html#L798' title='Defined at 798 in src/xterm.c.'>USE_CAIRO_XCB_SURFACE</a>
<a id='L11606' name='L11606'></a> 11606       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (cairo_surface_get_type (surface) == CAIRO_SURFACE_TYPE_XCB)
<a id='L11607' name='L11607'></a> 11607         <em class='brace'>{</em>
<a id='L11608' name='L11608'></a> 11608           cairo_surface_flush (surface);
<a id='L11609' name='L11609'></a> 11609           xcb_copy_area (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;xcb_connection,
<a id='L11610' name='L11610'></a> 11610                          (xcb_drawable_t) <a href='../S/2212.html#L1352' title='Defined at 1352 in src/xterm.h.'>FRAME_X_DRAWABLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L11611' name='L11611'></a> 11611                          (xcb_drawable_t) <a href='../S/2212.html#L1352' title='Defined at 1352 in src/xterm.h.'>FRAME_X_DRAWABLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L11612' name='L11612'></a> 11612                          (xcb_gcontext_t) XGContextFromGC (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;normal_gc),
<a id='L11613' name='L11613'></a> 11613                          <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, from_y, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, to_y, width, height);
<a id='L11614' name='L11614'></a> 11614           cairo_surface_mark_dirty_rectangle (surface, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, to_y, width, height);
<a id='L11615' name='L11615'></a> 11615         <em class='brace'>}</em>
<a id='L11616' name='L11616'></a> 11616 <em class='sharp'>#endif</em>
<a id='L11617' name='L11617'></a> 11617       <strong class='reserved'>else</strong>
<a id='L11618' name='L11618'></a> 11618         <em class='brace'>{</em>
<a id='L11619' name='L11619'></a> 11619           cairo_surface_t *s
<a id='L11620' name='L11620'></a> 11620             = cairo_surface_create_similar (surface,
<a id='L11621' name='L11621'></a> 11621                                             cairo_surface_get_content (surface),
<a id='L11622' name='L11622'></a> 11622                                             width, height);
<a id='L11623' name='L11623'></a> 11623           cairo_t *cr = cairo_create (s);
<a id='L11624' name='L11624'></a> 11624           cairo_set_source_surface (cr, surface, -<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, -from_y);
<a id='L11625' name='L11625'></a> 11625           cairo_paint (cr);
<a id='L11626' name='L11626'></a> 11626           cairo_destroy (cr);
<a id='L11627' name='L11627'></a> 11627 
<a id='L11628' name='L11628'></a> 11628           cr = <a href='../D/2280.html' title='Multiple defined in 3 places.'>FRAME_CR_CONTEXT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L11629' name='L11629'></a> 11629           cairo_save (cr);
<a id='L11630' name='L11630'></a> 11630           cairo_set_source_surface (cr, s, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, to_y);
<a id='L11631' name='L11631'></a> 11631           cairo_set_operator (cr, CAIRO_OPERATOR_SOURCE);
<a id='L11632' name='L11632'></a> 11632           cairo_rectangle (cr, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, to_y, width, height);
<a id='L11633' name='L11633'></a> 11633           cairo_fill (cr);
<a id='L11634' name='L11634'></a> 11634           cairo_restore (cr);
<a id='L11635' name='L11635'></a> 11635           cairo_surface_destroy (s);
<a id='L11636' name='L11636'></a> 11636         <em class='brace'>}</em>
<a id='L11637' name='L11637'></a> 11637     <em class='brace'>}</em>
<a id='L11638' name='L11638'></a> 11638   <strong class='reserved'>else</strong>
<a id='L11639' name='L11639'></a> 11639 <em class='sharp'>#endif</em>  <em class='comment'>/* USE_CAIRO */</em>
<a id='L11640' name='L11640'></a> 11640     XCopyArea (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L11641' name='L11641'></a> 11641                <a href='../S/2212.html#L1352' title='Defined at 1352 in src/xterm.h.'>FRAME_X_DRAWABLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../S/2212.html#L1352' title='Defined at 1352 in src/xterm.h.'>FRAME_X_DRAWABLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L11642' name='L11642'></a> 11642                <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;normal_gc,
<a id='L11643' name='L11643'></a> 11643                <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, from_y,
<a id='L11644' name='L11644'></a> 11644                width, height,
<a id='L11645' name='L11645'></a> 11645                <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, to_y);
<a id='L11646' name='L11646'></a> 11646 
<a id='L11647' name='L11647'></a> 11647   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L11648' name='L11648'></a> 11648 <em class='brace'>}</em>
<a id='L11649' name='L11649'></a> 11649 
<a id='L11650' name='L11650'></a> 11650 
<a id='L11651' name='L11651'></a> 11651 
<a id='L11652' name='L11652'></a> 11652 <em class='comment'>/***********************************************************************</em>
<a id='L11653' name='L11653'></a> 11653 <em class='comment'>                           Exposure Events</em>
<a id='L11654' name='L11654'></a> 11654 <em class='comment'> ***********************************************************************/</em>
<a id='L11655' name='L11655'></a> 11655 
<a id='L11656' name='L11656'></a> 11656 
<a id='L11657' name='L11657'></a> 11657 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L11658' name='L11658'></a> 11658 <a href='../S/2289.html#L13817' title='Referred from 13817 in src/xterm.c.'>x_frame_highlight</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L11659' name='L11659'></a> 11659 <em class='brace'>{</em>
<a id='L11660' name='L11660'></a> 11660   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L11661' name='L11661'></a> 11661 
<a id='L11662' name='L11662'></a> 11662   dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L11663' name='L11663'></a> 11663 
<a id='L11664' name='L11664'></a> 11664   <em class='comment'>/* We used to only do this if Vx_no_window_manager was non-nil, but</em>
<a id='L11665' name='L11665'></a> 11665 <em class='comment'>     the ICCCM (section 4.1.6) says that the window's border pixmap</em>
<a id='L11666' name='L11666'></a> 11666 <em class='comment'>     and border pixel are window attributes which are "private to the</em>
<a id='L11667' name='L11667'></a> 11667 <em class='comment'>     client", so we can always change it to whatever we want.  */</em>
<a id='L11668' name='L11668'></a> 11668   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L11669' name='L11669'></a> 11669   <em class='comment'>/* I recently started to get errors in this XSetWindowBorder, depending on</em>
<a id='L11670' name='L11670'></a> 11670 <em class='comment'>     the window-manager in use, tho something more is at play since I've been</em>
<a id='L11671' name='L11671'></a> 11671 <em class='comment'>     using that same window-manager binary for ever.  Let's not crash just</em>
<a id='L11672' name='L11672'></a> 11672 <em class='comment'>     because of this (bug#9310).  */</em>
<a id='L11673' name='L11673'></a> 11673   x_ignore_errors_for_next_request (dpyinfo, 0);
<a id='L11674' name='L11674'></a> 11674   XSetWindowBorder (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L11675' name='L11675'></a> 11675                     <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;border_pixel);
<a id='L11676' name='L11676'></a> 11676   x_stop_ignoring_errors (dpyinfo);
<a id='L11677' name='L11677'></a> 11677   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L11678' name='L11678'></a> 11678   <a href='../S/2224.html#L33806' title='Defined at 33806 in src/xdisp.c.'>gui_update_cursor</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L11679' name='L11679'></a> 11679   <a href='../S/2289.html#L6811' title='Defined at 6811 in src/xterm.c.'>x_set_frame_alpha</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L11680' name='L11680'></a> 11680 <em class='brace'>}</em>
<a id='L11681' name='L11681'></a> 11681 
<a id='L11682' name='L11682'></a> 11682 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L11683' name='L11683'></a> 11683 <a href='../S/2289.html#L13815' title='Referred from 13815 in src/xterm.c.'>x_frame_unhighlight</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L11684' name='L11684'></a> 11684 <em class='brace'>{</em>
<a id='L11685' name='L11685'></a> 11685   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L11686' name='L11686'></a> 11686 
<a id='L11687' name='L11687'></a> 11687   dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L11688' name='L11688'></a> 11688 
<a id='L11689' name='L11689'></a> 11689   <em class='comment'>/* We used to only do this if Vx_no_window_manager was non-nil, but</em>
<a id='L11690' name='L11690'></a> 11690 <em class='comment'>     the ICCCM (section 4.1.6) says that the window's border pixmap</em>
<a id='L11691' name='L11691'></a> 11691 <em class='comment'>     and border pixel are window attributes which are "private to the</em>
<a id='L11692' name='L11692'></a> 11692 <em class='comment'>     client", so we can always change it to whatever we want.  */</em>
<a id='L11693' name='L11693'></a> 11693 
<a id='L11694' name='L11694'></a> 11694   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L11695' name='L11695'></a> 11695   <em class='comment'>/* Same as above for XSetWindowBorder (bug#9310).  */</em>
<a id='L11696' name='L11696'></a> 11696   x_ignore_errors_for_next_request (dpyinfo, 0);
<a id='L11697' name='L11697'></a> 11697   XSetWindowBorderPixmap (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L11698' name='L11698'></a> 11698                           <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;border_tile);
<a id='L11699' name='L11699'></a> 11699   x_stop_ignoring_errors (dpyinfo);
<a id='L11700' name='L11700'></a> 11700   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L11701' name='L11701'></a> 11701 
<a id='L11702' name='L11702'></a> 11702   <a href='../S/2224.html#L33806' title='Defined at 33806 in src/xdisp.c.'>gui_update_cursor</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L11703' name='L11703'></a> 11703   <a href='../S/2289.html#L6811' title='Defined at 6811 in src/xterm.c.'>x_set_frame_alpha</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L11704' name='L11704'></a> 11704 <em class='brace'>}</em>
<a id='L11705' name='L11705'></a> 11705 
<a id='L11706' name='L11706'></a> 11706 <em class='comment'>/* The focus has changed.  Update the frames as necessary to reflect</em>
<a id='L11707' name='L11707'></a> 11707 <em class='comment'>   the new situation.  Note that we can't change the selected frame</em>
<a id='L11708' name='L11708'></a> 11708 <em class='comment'>   here, because the Lisp code we are interrupting might become confused.</em>
<a id='L11709' name='L11709'></a> 11709 <em class='comment'>   Each event gets marked with the frame in which it occurred, so the</em>
<a id='L11710' name='L11710'></a> 11710 <em class='comment'>   Lisp code can tell when the switch took place by examining the events.  */</em>
<a id='L11711' name='L11711'></a> 11711 
<a id='L11712' name='L11712'></a> 11712 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L11713' name='L11713'></a> 11713 <a href='../R/18257.html' title='Multiple referred from 4 places.'>x_new_focus_frame</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo, <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)
<a id='L11714' name='L11714'></a> 11714 <em class='brace'>{</em>
<a id='L11715' name='L11715'></a> 11715   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *old_focus = dpyinfo-&gt;x_focus_frame;
<a id='L11716' name='L11716'></a> 11716 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> USE_GTK &amp;&amp; !<strong class='reserved'>defined</strong> HAVE_GTK3 &amp;&amp; <strong class='reserved'>defined</strong> HAVE_XINPUT2
<a id='L11717' name='L11717'></a> 11717   XIEventMask mask;
<a id='L11718' name='L11718'></a> 11718   ptrdiff_t l;
<a id='L11719' name='L11719'></a> 11719 
<a id='L11720' name='L11720'></a> 11720   <strong class='reserved'>if</strong> (dpyinfo-&gt;supports_xi2)
<a id='L11721' name='L11721'></a> 11721     <em class='brace'>{</em>
<a id='L11722' name='L11722'></a> 11722       l = XIMaskLen (XI_LASTEVENT);
<a id='L11723' name='L11723'></a> 11723       mask.mask = <a href='../D/8439.html' title='Multiple defined in 8 places.'>alloca</a> (l);
<a id='L11724' name='L11724'></a> 11724       mask.mask_len = l;
<a id='L11725' name='L11725'></a> 11725       memset (mask.mask, 0, l);
<a id='L11726' name='L11726'></a> 11726 
<a id='L11727' name='L11727'></a> 11727       mask.deviceid = XIAllDevices;
<a id='L11728' name='L11728'></a> 11728     <em class='brace'>}</em>
<a id='L11729' name='L11729'></a> 11729 <em class='sharp'>#endif</em>
<a id='L11730' name='L11730'></a> 11730 
<a id='L11731' name='L11731'></a> 11731   <strong class='reserved'>if</strong> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> != dpyinfo-&gt;x_focus_frame)
<a id='L11732' name='L11732'></a> 11732     <em class='brace'>{</em>
<a id='L11733' name='L11733'></a> 11733       <em class='comment'>/* Set this before calling other routines, so that they see</em>
<a id='L11734' name='L11734'></a> 11734 <em class='comment'>         the correct value of x_focus_frame.  */</em>
<a id='L11735' name='L11735'></a> 11735       dpyinfo-&gt;x_focus_frame = <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>;
<a id='L11736' name='L11736'></a> 11736 
<a id='L11737' name='L11737'></a> 11737       <em class='comment'>/* Once none of our frames are focused anymore, stop selecting</em>
<a id='L11738' name='L11738'></a> 11738 <em class='comment'>         for raw input events from the root window.  */</em>
<a id='L11739' name='L11739'></a> 11739 
<a id='L11740' name='L11740'></a> 11740 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> USE_GTK &amp;&amp; !<strong class='reserved'>defined</strong> HAVE_GTK3 &amp;&amp; <strong class='reserved'>defined</strong> HAVE_XINPUT2
<a id='L11741' name='L11741'></a> 11741       <strong class='reserved'>if</strong> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> &amp;&amp; dpyinfo-&gt;supports_xi2)
<a id='L11742' name='L11742'></a> 11742         XISetMask (mask.mask, XI_RawKeyPress);
<a id='L11743' name='L11743'></a> 11743 
<a id='L11744' name='L11744'></a> 11744       <strong class='reserved'>if</strong> (dpyinfo-&gt;supports_xi2)
<a id='L11745' name='L11745'></a> 11745         XISelectEvents (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, dpyinfo-&gt;root_window, &amp;mask, 1);
<a id='L11746' name='L11746'></a> 11746 <em class='sharp'>#endif</em>
<a id='L11747' name='L11747'></a> 11747 
<a id='L11748' name='L11748'></a> 11748       <strong class='reserved'>if</strong> (old_focus &amp;&amp; old_focus-&gt;auto_lower)
<a id='L11749' name='L11749'></a> 11749         x_lower_frame (old_focus);
<a id='L11750' name='L11750'></a> 11750 
<a id='L11751' name='L11751'></a> 11751       <strong class='reserved'>if</strong> (dpyinfo-&gt;x_focus_frame &amp;&amp; dpyinfo-&gt;x_focus_frame-&gt;auto_raise)
<a id='L11752' name='L11752'></a> 11752         dpyinfo-&gt;x_pending_autoraise_frame = dpyinfo-&gt;x_focus_frame;
<a id='L11753' name='L11753'></a> 11753       <strong class='reserved'>else</strong>
<a id='L11754' name='L11754'></a> 11754         dpyinfo-&gt;x_pending_autoraise_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L11755' name='L11755'></a> 11755     <em class='brace'>}</em>
<a id='L11756' name='L11756'></a> 11756 
<a id='L11757' name='L11757'></a> 11757   x_frame_rehighlight (dpyinfo);
<a id='L11758' name='L11758'></a> 11758 <em class='brace'>}</em>
<a id='L11759' name='L11759'></a> 11759 
<a id='L11760' name='L11760'></a> 11760 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XFIXES &amp;&amp; XFIXES_VERSION &gt;= 40000
<a id='L11761' name='L11761'></a> 11761 
<a id='L11762' name='L11762'></a> 11762 <em class='comment'>/* True if the display in DPYINFO supports a version of Xfixes</em>
<a id='L11763' name='L11763'></a> 11763 <em class='comment'>   sufficient for pointer blanking.  */</em>
<a id='L11764' name='L11764'></a> 11764 
<a id='L11765' name='L11765'></a> 11765 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L11766' name='L11766'></a> 11766 <a href='../R/18187.html' title='Multiple referred from 2 places.'>x_fixes_pointer_blanking_supported</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo)
<a id='L11767' name='L11767'></a> 11767 <em class='brace'>{</em>
<a id='L11768' name='L11768'></a> 11768   <strong class='reserved'>return</strong> (dpyinfo-&gt;xfixes_supported_p
<a id='L11769' name='L11769'></a> 11769           &amp;&amp; dpyinfo-&gt;xfixes_major &gt;= 4);
<a id='L11770' name='L11770'></a> 11770 <em class='brace'>}</em>
<a id='L11771' name='L11771'></a> 11771 
<a id='L11772' name='L11772'></a> 11772 <em class='sharp'>#endif</em> <em class='comment'>/* HAVE_XFIXES &amp;&amp; XFIXES_VERSION &gt;= 40000 */</em>
<a id='L11773' name='L11773'></a> 11773 
<a id='L11774' name='L11774'></a> 11774 <em class='comment'>/* Toggle mouse pointer visibility on frame F using the XFixes</em>
<a id='L11775' name='L11775'></a> 11775 <em class='comment'>   extension.  */</em>
<a id='L11776' name='L11776'></a> 11776 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XFIXES &amp;&amp; XFIXES_VERSION &gt;= 40000
<a id='L11777' name='L11777'></a> 11777 
<a id='L11778' name='L11778'></a> 11778 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L11779' name='L11779'></a> 11779 <a href='../R/18422.html' title='Multiple referred from 2 places.'>xfixes_toggle_visible_pointer</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> invisible)
<a id='L11780' name='L11780'></a> 11780 
<a id='L11781' name='L11781'></a> 11781 <em class='brace'>{</em>
<a id='L11782' name='L11782'></a> 11782   <strong class='reserved'>if</strong> (invisible)
<a id='L11783' name='L11783'></a> 11783     XFixesHideCursor (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L11784' name='L11784'></a> 11784   <strong class='reserved'>else</strong>
<a id='L11785' name='L11785'></a> 11785     XFixesShowCursor (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L11786' name='L11786'></a> 11786   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;pointer_invisible = invisible;
<a id='L11787' name='L11787'></a> 11787 <em class='brace'>}</em>
<a id='L11788' name='L11788'></a> 11788 
<a id='L11789' name='L11789'></a> 11789 <em class='sharp'>#endif</em> <em class='comment'>/* HAVE_XFIXES */</em>
<a id='L11790' name='L11790'></a> 11790 
<a id='L11791' name='L11791'></a> 11791 <em class='comment'>/* Create invisible cursor on the X display referred by DPYINFO.  */</em>
<a id='L11792' name='L11792'></a> 11792 <strong class='reserved'>static</strong> <a href='../D/1354.html' title='Multiple defined in 2 places.'>Cursor</a>
<a id='L11793' name='L11793'></a> 11793 <a href='../R/13000.html' title='Multiple referred from 4 places.'>make_invisible_cursor</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo)
<a id='L11794' name='L11794'></a> 11794 <em class='brace'>{</em>
<a id='L11795' name='L11795'></a> 11795   <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy = dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>;
<a id='L11796' name='L11796'></a> 11796   <strong class='reserved'>static</strong> <strong class='reserved'>char</strong> <strong class='reserved'>const</strong> no_data[] = <em class='brace'>{</em> 0 <em class='brace'>}</em>;
<a id='L11797' name='L11797'></a> 11797   <a href='../D/5058.html' title='Multiple defined in 2 places.'>Pixmap</a> pix;
<a id='L11798' name='L11798'></a> 11798   <a href='../D/7038.html' title='Multiple defined in 2 places.'>XColor</a> col;
<a id='L11799' name='L11799'></a> 11799   <a href='../D/1354.html' title='Multiple defined in 2 places.'>Cursor</a> <a href='../D/9440.html' title='Multiple defined in 2 places.'>c</a>;
<a id='L11800' name='L11800'></a> 11800 
<a id='L11801' name='L11801'></a> 11801   <a href='../D/9440.html' title='Multiple defined in 2 places.'>c</a> = None;
<a id='L11802' name='L11802'></a> 11802 
<a id='L11803' name='L11803'></a> 11803   x_catch_errors (dpy);
<a id='L11804' name='L11804'></a> 11804   pix = XCreateBitmapFromData (dpy, dpyinfo-&gt;root_window, no_data, 1, 1);
<a id='L11805' name='L11805'></a> 11805   <strong class='reserved'>if</strong> (!x_had_errors_p (dpy) &amp;&amp; pix != None)
<a id='L11806' name='L11806'></a> 11806     <em class='brace'>{</em>
<a id='L11807' name='L11807'></a> 11807       <a href='../D/1354.html' title='Multiple defined in 2 places.'>Cursor</a> pixc;
<a id='L11808' name='L11808'></a> 11808       col.pixel = 0;
<a id='L11809' name='L11809'></a> 11809       col.red = col.green = col.blue = 0;
<a id='L11810' name='L11810'></a> 11810       col.flags = DoRed | DoGreen | DoBlue;
<a id='L11811' name='L11811'></a> 11811       pixc = XCreatePixmapCursor (dpy, pix, pix, &amp;col, &amp;col, 0, 0);
<a id='L11812' name='L11812'></a> 11812       <strong class='reserved'>if</strong> (! x_had_errors_p (dpy) &amp;&amp; pixc != None)
<a id='L11813' name='L11813'></a> 11813         <a href='../D/9440.html' title='Multiple defined in 2 places.'>c</a> = pixc;
<a id='L11814' name='L11814'></a> 11814       XFreePixmap (dpy, pix);
<a id='L11815' name='L11815'></a> 11815     <em class='brace'>}</em>
<a id='L11816' name='L11816'></a> 11816 
<a id='L11817' name='L11817'></a> 11817   x_uncatch_errors ();
<a id='L11818' name='L11818'></a> 11818 
<a id='L11819' name='L11819'></a> 11819   <strong class='reserved'>return</strong> <a href='../D/9440.html' title='Multiple defined in 2 places.'>c</a>;
<a id='L11820' name='L11820'></a> 11820 <em class='brace'>}</em>
<a id='L11821' name='L11821'></a> 11821 
<a id='L11822' name='L11822'></a> 11822 <em class='comment'>/* Toggle mouse pointer visibility on frame F by using an invisible</em>
<a id='L11823' name='L11823'></a> 11823 <em class='comment'>   cursor.  */</em>
<a id='L11824' name='L11824'></a> 11824 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L11825' name='L11825'></a> 11825 <a href='../S/2289.html#L11876' title='Referred from 11876 in src/xterm.c.'>x_toggle_visible_pointer</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> invisible)
<a id='L11826' name='L11826'></a> 11826 <em class='brace'>{</em>
<a id='L11827' name='L11827'></a> 11827   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L11828' name='L11828'></a> 11828 
<a id='L11829' name='L11829'></a> 11829   dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L11830' name='L11830'></a> 11830 
<a id='L11831' name='L11831'></a> 11831   <em class='comment'>/* We could have gotten a BadAlloc error while creating the</em>
<a id='L11832' name='L11832'></a> 11832 <em class='comment'>     invisible cursor.  Try to create it again, but if that fails,</em>
<a id='L11833' name='L11833'></a> 11833 <em class='comment'>     just give up.  */</em>
<a id='L11834' name='L11834'></a> 11834   <strong class='reserved'>if</strong> (dpyinfo-&gt;invisible_cursor == None)
<a id='L11835' name='L11835'></a> 11835     dpyinfo-&gt;invisible_cursor = <a href='../D/14122.html' title='Multiple defined in 2 places.'>make_invisible_cursor</a> (dpyinfo);
<a id='L11836' name='L11836'></a> 11836 
<a id='L11837' name='L11837'></a> 11837 <em class='sharp'>#if</em> !<strong class='reserved'>defined</strong> HAVE_XFIXES || XFIXES_VERSION &lt; 40000
<a id='L11838' name='L11838'></a> 11838   <strong class='reserved'>if</strong> (dpyinfo-&gt;invisible_cursor == None)
<a id='L11839' name='L11839'></a> 11839     invisible = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L11840' name='L11840'></a> 11840 <em class='sharp'>#else</em>
<a id='L11841' name='L11841'></a> 11841   <em class='comment'>/* But if Xfixes is available, try using it instead.  */</em>
<a id='L11842' name='L11842'></a> 11842   <strong class='reserved'>if</strong> (dpyinfo-&gt;invisible_cursor == None)
<a id='L11843' name='L11843'></a> 11843     <em class='brace'>{</em>
<a id='L11844' name='L11844'></a> 11844       <strong class='reserved'>if</strong> (<a href='../S/2289.html#L11766' title='Defined at 11766 in src/xterm.c.'>x_fixes_pointer_blanking_supported</a> (dpyinfo))
<a id='L11845' name='L11845'></a> 11845         <em class='brace'>{</em>
<a id='L11846' name='L11846'></a> 11846           dpyinfo-&gt;fixes_pointer_blanking = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L11847' name='L11847'></a> 11847           <a href='../S/2289.html#L11779' title='Defined at 11779 in src/xterm.c.'>xfixes_toggle_visible_pointer</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, invisible);
<a id='L11848' name='L11848'></a> 11848 
<a id='L11849' name='L11849'></a> 11849           <strong class='reserved'>return</strong>;
<a id='L11850' name='L11850'></a> 11850         <em class='brace'>}</em>
<a id='L11851' name='L11851'></a> 11851       <strong class='reserved'>else</strong>
<a id='L11852' name='L11852'></a> 11852         invisible = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L11853' name='L11853'></a> 11853     <em class='brace'>}</em>
<a id='L11854' name='L11854'></a> 11854 <em class='sharp'>#endif</em>
<a id='L11855' name='L11855'></a> 11855 
<a id='L11856' name='L11856'></a> 11856   <strong class='reserved'>if</strong> (invisible)
<a id='L11857' name='L11857'></a> 11857     XDefineCursor (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L11858' name='L11858'></a> 11858                    dpyinfo-&gt;invisible_cursor);
<a id='L11859' name='L11859'></a> 11859   <strong class='reserved'>else</strong>
<a id='L11860' name='L11860'></a> 11860     XDefineCursor (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L11861' name='L11861'></a> 11861                    <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;current_cursor);
<a id='L11862' name='L11862'></a> 11862 
<a id='L11863' name='L11863'></a> 11863   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;pointer_invisible = invisible;
<a id='L11864' name='L11864'></a> 11864 <em class='brace'>}</em>
<a id='L11865' name='L11865'></a> 11865 
<a id='L11866' name='L11866'></a> 11866 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L11867' name='L11867'></a> 11867 <a href='../R/6640.html' title='Multiple referred from 5 places.'>XTtoggle_invisible_pointer</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> invisible)
<a id='L11868' name='L11868'></a> 11868 <em class='brace'>{</em>
<a id='L11869' name='L11869'></a> 11869   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L11870' name='L11870'></a> 11870 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XFIXES &amp;&amp; XFIXES_VERSION &gt;= 40000
<a id='L11871' name='L11871'></a> 11871   <strong class='reserved'>if</strong> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;fixes_pointer_blanking
<a id='L11872' name='L11872'></a> 11872       &amp;&amp; <a href='../S/2289.html#L11766' title='Defined at 11766 in src/xterm.c.'>x_fixes_pointer_blanking_supported</a> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)))
<a id='L11873' name='L11873'></a> 11873     <a href='../S/2289.html#L11779' title='Defined at 11779 in src/xterm.c.'>xfixes_toggle_visible_pointer</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, invisible);
<a id='L11874' name='L11874'></a> 11874   <strong class='reserved'>else</strong>
<a id='L11875' name='L11875'></a> 11875 <em class='sharp'>#endif</em>
<a id='L11876' name='L11876'></a> 11876     <a href='../S/2289.html#L11825' title='Defined at 11825 in src/xterm.c.'>x_toggle_visible_pointer</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, invisible);
<a id='L11877' name='L11877'></a> 11877   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L11878' name='L11878'></a> 11878 <em class='brace'>}</em>
<a id='L11879' name='L11879'></a> 11879 
<a id='L11880' name='L11880'></a> 11880 <em class='comment'>/* Handle FocusIn and FocusOut state changes for FRAME.  If FRAME has</em>
<a id='L11881' name='L11881'></a> 11881 <em class='comment'>   focus and there exists more than one frame, puts a FOCUS_IN_EVENT</em>
<a id='L11882' name='L11882'></a> 11882 <em class='comment'>   into *BUFP.  Note that this code is not used to handle focus</em>
<a id='L11883' name='L11883'></a> 11883 <em class='comment'>   changes on builds that can use the X Input extension for handling</em>
<a id='L11884' name='L11884'></a> 11884 <em class='comment'>   input focus when it is available (currently the no toolkit and GTK</em>
<a id='L11885' name='L11885'></a> 11885 <em class='comment'>   3 toolkits).  */</em>
<a id='L11886' name='L11886'></a> 11886 
<a id='L11887' name='L11887'></a> 11887 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L11888' name='L11888'></a> 11888 <a href='../R/18190.html' title='Multiple referred from 3 places.'>x_focus_changed</a> (<strong class='reserved'>int</strong> type, <strong class='reserved'>int</strong> state, <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L11889' name='L11889'></a> 11889                  <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <strong class='reserved'>struct</strong> <a href='../S/2231.html#L350' title='Defined at 350 in src/termhooks.h.'>input_event</a> *bufp)
<a id='L11890' name='L11890'></a> 11890 <em class='brace'>{</em>
<a id='L11891' name='L11891'></a> 11891   <strong class='reserved'>if</strong> (type == FocusIn)
<a id='L11892' name='L11892'></a> 11892     <em class='brace'>{</em>
<a id='L11893' name='L11893'></a> 11893       <strong class='reserved'>if</strong> (dpyinfo-&gt;x_focus_event_frame != <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)
<a id='L11894' name='L11894'></a> 11894         <em class='brace'>{</em>
<a id='L11895' name='L11895'></a> 11895           <a href='../S/2289.html#L11713' title='Defined at 11713 in src/xterm.c.'>x_new_focus_frame</a> (dpyinfo, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>);
<a id='L11896' name='L11896'></a> 11896           dpyinfo-&gt;x_focus_event_frame = <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>;
<a id='L11897' name='L11897'></a> 11897           bufp-&gt;kind = <a href='../S/2231.html#L234' title='Defined at 234 in src/termhooks.h.'>FOCUS_IN_EVENT</a>;
<a id='L11898' name='L11898'></a> 11898           <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (bufp-&gt;frame_or_window, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>);
<a id='L11899' name='L11899'></a> 11899         <em class='brace'>}</em>
<a id='L11900' name='L11900'></a> 11900 
<a id='L11901' name='L11901'></a> 11901       <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;focus_state |= state;
<a id='L11902' name='L11902'></a> 11902 
<a id='L11903' name='L11903'></a> 11903 <em class='sharp'>#ifdef</em> HAVE_X_I18N
<a id='L11904' name='L11904'></a> 11904       <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1470' title='Defined at 1470 in src/xterm.h.'>FRAME_XIC</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>))
<a id='L11905' name='L11905'></a> 11905         XSetICFocus (<a href='../S/2212.html#L1470' title='Defined at 1470 in src/xterm.h.'>FRAME_XIC</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>));
<a id='L11906' name='L11906'></a> 11906 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L11907' name='L11907'></a> 11907       GtkWidget *widget;
<a id='L11908' name='L11908'></a> 11908 
<a id='L11909' name='L11909'></a> 11909       <strong class='reserved'>if</strong> (x_gtk_use_native_input)
<a id='L11910' name='L11910'></a> 11910         <em class='brace'>{</em>
<a id='L11911' name='L11911'></a> 11911           gtk_im_context_focus_in (<a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)-&gt;im_context);
<a id='L11912' name='L11912'></a> 11912           widget = <a href='../D/2309.html' title='Multiple defined in 2 places.'>FRAME_GTK_OUTER_WIDGET</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>);
<a id='L11913' name='L11913'></a> 11913           gtk_im_context_set_client_window (<a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)-&gt;im_context,
<a id='L11914' name='L11914'></a> 11914                                             gtk_widget_get_window (widget));
<a id='L11915' name='L11915'></a> 11915         <em class='brace'>}</em>
<a id='L11916' name='L11916'></a> 11916 <em class='sharp'>#endif</em>
<a id='L11917' name='L11917'></a> 11917 <em class='sharp'>#endif</em>
<a id='L11918' name='L11918'></a> 11918     <em class='brace'>}</em>
<a id='L11919' name='L11919'></a> 11919   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (type == FocusOut)
<a id='L11920' name='L11920'></a> 11920     <em class='brace'>{</em>
<a id='L11921' name='L11921'></a> 11921       <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;focus_state &amp;= ~state;
<a id='L11922' name='L11922'></a> 11922 
<a id='L11923' name='L11923'></a> 11923       <strong class='reserved'>if</strong> (dpyinfo-&gt;x_focus_event_frame == <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)
<a id='L11924' name='L11924'></a> 11924         <em class='brace'>{</em>
<a id='L11925' name='L11925'></a> 11925           dpyinfo-&gt;x_focus_event_frame = 0;
<a id='L11926' name='L11926'></a> 11926           <a href='../S/2289.html#L11713' title='Defined at 11713 in src/xterm.c.'>x_new_focus_frame</a> (dpyinfo, 0);
<a id='L11927' name='L11927'></a> 11927 
<a id='L11928' name='L11928'></a> 11928           bufp-&gt;kind = <a href='../S/2231.html#L236' title='Defined at 236 in src/termhooks.h.'>FOCUS_OUT_EVENT</a>;
<a id='L11929' name='L11929'></a> 11929           <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (bufp-&gt;frame_or_window, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>);
<a id='L11930' name='L11930'></a> 11930         <em class='brace'>}</em>
<a id='L11931' name='L11931'></a> 11931 
<a id='L11932' name='L11932'></a> 11932       <strong class='reserved'>if</strong> (!<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;focus_state)
<a id='L11933' name='L11933'></a> 11933         <em class='brace'>{</em>
<a id='L11934' name='L11934'></a> 11934 <em class='sharp'>#ifdef</em> HAVE_X_I18N
<a id='L11935' name='L11935'></a> 11935           <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1470' title='Defined at 1470 in src/xterm.h.'>FRAME_XIC</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>))
<a id='L11936' name='L11936'></a> 11936             XUnsetICFocus (<a href='../S/2212.html#L1470' title='Defined at 1470 in src/xterm.h.'>FRAME_XIC</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>));
<a id='L11937' name='L11937'></a> 11937 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L11938' name='L11938'></a> 11938           <strong class='reserved'>if</strong> (x_gtk_use_native_input)
<a id='L11939' name='L11939'></a> 11939             <em class='brace'>{</em>
<a id='L11940' name='L11940'></a> 11940               gtk_im_context_focus_out (<a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)-&gt;im_context);
<a id='L11941' name='L11941'></a> 11941               gtk_im_context_set_client_window (<a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)-&gt;im_context, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L11942' name='L11942'></a> 11942             <em class='brace'>}</em>
<a id='L11943' name='L11943'></a> 11943 <em class='sharp'>#endif</em>
<a id='L11944' name='L11944'></a> 11944 <em class='sharp'>#endif</em>
<a id='L11945' name='L11945'></a> 11945         <em class='brace'>}</em>
<a id='L11946' name='L11946'></a> 11946 
<a id='L11947' name='L11947'></a> 11947       <strong class='reserved'>if</strong> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>-&gt;pointer_invisible)
<a id='L11948' name='L11948'></a> 11948         <a href='../S/2289.html#L11867' title='Defined at 11867 in src/xterm.c.'>XTtoggle_invisible_pointer</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L11949' name='L11949'></a> 11949     <em class='brace'>}</em>
<a id='L11950' name='L11950'></a> 11950 <em class='brace'>}</em>
<a id='L11951' name='L11951'></a> 11951 
<a id='L11952' name='L11952'></a> 11952 <em class='comment'>/* Return the Emacs frame-object corresponding to an X window.  It</em>
<a id='L11953' name='L11953'></a> 11953 <em class='comment'>   could be the frame's main window, an icon window, or an xwidget</em>
<a id='L11954' name='L11954'></a> 11954 <em class='comment'>   window.  */</em>
<a id='L11955' name='L11955'></a> 11955 
<a id='L11956' name='L11956'></a> 11956 <strong class='reserved'>static</strong> <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *
<a id='L11957' name='L11957'></a> 11957 <a href='../R/18370.html' title='Multiple referred from 22 places.'>x_window_to_frame</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo, <strong class='reserved'>int</strong> wdesc)
<a id='L11958' name='L11958'></a> 11958 <em class='brace'>{</em>
<a id='L11959' name='L11959'></a> 11959   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>;
<a id='L11960' name='L11960'></a> 11960   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L11961' name='L11961'></a> 11961 
<a id='L11962' name='L11962'></a> 11962   <strong class='reserved'>if</strong> (wdesc == None)
<a id='L11963' name='L11963'></a> 11963     <strong class='reserved'>return</strong> <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L11964' name='L11964'></a> 11964 
<a id='L11965' name='L11965'></a> 11965 <em class='sharp'>#ifdef</em> HAVE_XWIDGETS
<a id='L11966' name='L11966'></a> 11966   <strong class='reserved'>struct</strong> <a href='../S/2261.html#L102' title='Defined at 102 in src/xwidget.h.'>xwidget_view</a> *xvw = <a href='../S/2334.html#L2116' title='Defined at 2116 in src/xwidget.c.'>xwidget_view_from_window</a> (wdesc);
<a id='L11967' name='L11967'></a> 11967 
<a id='L11968' name='L11968'></a> 11968   <strong class='reserved'>if</strong> (xvw &amp;&amp; xvw-&gt;<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)
<a id='L11969' name='L11969'></a> 11969     <strong class='reserved'>return</strong> xvw-&gt;<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>;
<a id='L11970' name='L11970'></a> 11970 <em class='sharp'>#endif</em>
<a id='L11971' name='L11971'></a> 11971 
<a id='L11972' name='L11972'></a> 11972   <a href='../S/2183.html#L1405' title='Defined at 1405 in src/frame.h.'>FOR_EACH_FRAME</a> (<a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)
<a id='L11973' name='L11973'></a> 11973     <em class='brace'>{</em>
<a id='L11974' name='L11974'></a> 11974       <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>);
<a id='L11975' name='L11975'></a> 11975       <strong class='reserved'>if</strong> (!<a href='../S/2183.html#L919' title='Defined at 919 in src/frame.h.'>FRAME_X_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) || <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) != dpyinfo)
<a id='L11976' name='L11976'></a> 11976         <strong class='reserved'>continue</strong>;
<a id='L11977' name='L11977'></a> 11977       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;hourglass_window == wdesc)
<a id='L11978' name='L11978'></a> 11978         <strong class='reserved'>return</strong> <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L11979' name='L11979'></a> 11979 <em class='sharp'>#ifdef</em> USE_X_TOOLKIT
<a id='L11980' name='L11980'></a> 11980       <strong class='reserved'>if</strong> ((<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;edit_widget
<a id='L11981' name='L11981'></a> 11981            &amp;&amp; XtWindow (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;edit_widget) == wdesc)
<a id='L11982' name='L11982'></a> 11982           <em class='comment'>/* A tooltip frame?  */</em>
<a id='L11983' name='L11983'></a> 11983           || (!<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;edit_widget
<a id='L11984' name='L11984'></a> 11984               &amp;&amp; <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) == wdesc)
<a id='L11985' name='L11985'></a> 11985           || <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;icon_desc == wdesc)
<a id='L11986' name='L11986'></a> 11986         <strong class='reserved'>return</strong> <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L11987' name='L11987'></a> 11987 <em class='sharp'>#else</em> <em class='comment'>/* not USE_X_TOOLKIT */</em>
<a id='L11988' name='L11988'></a> 11988 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L11989' name='L11989'></a> 11989       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;edit_widget)
<a id='L11990' name='L11990'></a> 11990       <em class='brace'>{</em>
<a id='L11991' name='L11991'></a> 11991         GtkWidget *gwdesc = <a href='../S/2362.html#L1386' title='Defined at 1386 in src/gtkutil.c.'>xg_win_to_widget</a> (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, wdesc);
<a id='L11992' name='L11992'></a> 11992         <strong class='reserved'>struct</strong> <a href='../D/19627.html' title='Multiple defined in 5 places.'>x_output</a> *<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L11993' name='L11993'></a> 11993         <strong class='reserved'>if</strong> (gwdesc != 0 &amp;&amp; gwdesc == <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;edit_widget)
<a id='L11994' name='L11994'></a> 11994           <strong class='reserved'>return</strong> <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L11995' name='L11995'></a> 11995       <em class='brace'>}</em>
<a id='L11996' name='L11996'></a> 11996 <em class='sharp'>#endif</em> <em class='comment'>/* USE_GTK */</em>
<a id='L11997' name='L11997'></a> 11997       <strong class='reserved'>if</strong> (<a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) == wdesc
<a id='L11998' name='L11998'></a> 11998           || <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;icon_desc == wdesc)
<a id='L11999' name='L11999'></a> 11999         <strong class='reserved'>return</strong> <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L12000' name='L12000'></a> 12000 <em class='sharp'>#endif</em> <em class='comment'>/* not USE_X_TOOLKIT */</em>
<a id='L12001' name='L12001'></a> 12001     <em class='brace'>}</em>
<a id='L12002' name='L12002'></a> 12002   <strong class='reserved'>return</strong> 0;
<a id='L12003' name='L12003'></a> 12003 <em class='brace'>}</em>
<a id='L12004' name='L12004'></a> 12004 
<a id='L12005' name='L12005'></a> 12005 <em class='comment'>/* Like x_any_window_to_frame but only try to find tooltip frames.</em>
<a id='L12006' name='L12006'></a> 12006 <em class='comment'></em>
<a id='L12007' name='L12007'></a> 12007 <em class='comment'>   If wdesc is a toolkit tooltip without an associated frame, set</em>
<a id='L12008' name='L12008'></a> 12008 <em class='comment'>   UNRELATED_TOOLTIP_P to true.  Otherwise, set it to false.  */</em>
<a id='L12009' name='L12009'></a> 12009 <strong class='reserved'>static</strong> <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *
<a id='L12010' name='L12010'></a> 12010 <a href='../R/18360.html' title='Multiple referred from 4 places.'>x_tooltip_window_to_frame</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L12011' name='L12011'></a> 12011                            <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> wdesc, <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> *unrelated_tooltip_p)
<a id='L12012' name='L12012'></a> 12012 <em class='brace'>{</em>
<a id='L12013' name='L12013'></a> 12013   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>;
<a id='L12014' name='L12014'></a> 12014   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L12015' name='L12015'></a> 12015 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L12016' name='L12016'></a> 12016   GtkWidget *widget;
<a id='L12017' name='L12017'></a> 12017   GdkWindow *tooltip_window;
<a id='L12018' name='L12018'></a> 12018 <em class='sharp'>#endif</em>
<a id='L12019' name='L12019'></a> 12019 
<a id='L12020' name='L12020'></a> 12020   <strong class='reserved'>if</strong> (unrelated_tooltip_p)
<a id='L12021' name='L12021'></a> 12021     *unrelated_tooltip_p = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L12022' name='L12022'></a> 12022 
<a id='L12023' name='L12023'></a> 12023   <a href='../S/2183.html#L1405' title='Defined at 1405 in src/frame.h.'>FOR_EACH_FRAME</a> (<a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)
<a id='L12024' name='L12024'></a> 12024     <em class='brace'>{</em>
<a id='L12025' name='L12025'></a> 12025       <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>);
<a id='L12026' name='L12026'></a> 12026 
<a id='L12027' name='L12027'></a> 12027       <strong class='reserved'>if</strong> (<a href='../S/2183.html#L919' title='Defined at 919 in src/frame.h.'>FRAME_X_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) &amp;&amp; <a href='../D/2425.html' title='Multiple defined in 2 places.'>FRAME_TOOLTIP_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L12028' name='L12028'></a> 12028           &amp;&amp; <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) == dpyinfo
<a id='L12029' name='L12029'></a> 12029           &amp;&amp; <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) == wdesc)
<a id='L12030' name='L12030'></a> 12030         <strong class='reserved'>return</strong> <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L12031' name='L12031'></a> 12031 
<a id='L12032' name='L12032'></a> 12032 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L12033' name='L12033'></a> 12033       <strong class='reserved'>if</strong> (!<a href='../S/2183.html#L919' title='Defined at 919 in src/frame.h.'>FRAME_X_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L12034' name='L12034'></a> 12034         <strong class='reserved'>continue</strong>;
<a id='L12035' name='L12035'></a> 12035 
<a id='L12036' name='L12036'></a> 12036       <strong class='reserved'>if</strong> (<a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;ttip_window)
<a id='L12037' name='L12037'></a> 12037         widget = GTK_WIDGET (<a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;ttip_window);
<a id='L12038' name='L12038'></a> 12038       <strong class='reserved'>else</strong>
<a id='L12039' name='L12039'></a> 12039         widget = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L12040' name='L12040'></a> 12040 
<a id='L12041' name='L12041'></a> 12041       <strong class='reserved'>if</strong> (widget)
<a id='L12042' name='L12042'></a> 12042         tooltip_window = gtk_widget_get_window (widget);
<a id='L12043' name='L12043'></a> 12043       <strong class='reserved'>else</strong>
<a id='L12044' name='L12044'></a> 12044         tooltip_window = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L12045' name='L12045'></a> 12045 
<a id='L12046' name='L12046'></a> 12046 <em class='sharp'>#ifdef</em> HAVE_GTK3
<a id='L12047' name='L12047'></a> 12047       <strong class='reserved'>if</strong> (tooltip_window
<a id='L12048' name='L12048'></a> 12048           &amp;&amp; (gdk_x11_window_get_xid (tooltip_window) == wdesc))
<a id='L12049' name='L12049'></a> 12049         <em class='brace'>{</em>
<a id='L12050' name='L12050'></a> 12050           <strong class='reserved'>if</strong> (unrelated_tooltip_p)
<a id='L12051' name='L12051'></a> 12051             *unrelated_tooltip_p = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L12052' name='L12052'></a> 12052           <strong class='reserved'>break</strong>;
<a id='L12053' name='L12053'></a> 12053         <em class='brace'>}</em>
<a id='L12054' name='L12054'></a> 12054 <em class='sharp'>#else</em>
<a id='L12055' name='L12055'></a> 12055       <strong class='reserved'>if</strong> (tooltip_window
<a id='L12056' name='L12056'></a> 12056           &amp;&amp; (<a href='../D/2665.html' title='Multiple defined in 2 places.'>GDK_WINDOW_XID</a> (tooltip_window) == wdesc))
<a id='L12057' name='L12057'></a> 12057         <em class='brace'>{</em>
<a id='L12058' name='L12058'></a> 12058           <strong class='reserved'>if</strong> (unrelated_tooltip_p)
<a id='L12059' name='L12059'></a> 12059             *unrelated_tooltip_p = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L12060' name='L12060'></a> 12060           <strong class='reserved'>break</strong>;
<a id='L12061' name='L12061'></a> 12061         <em class='brace'>}</em>
<a id='L12062' name='L12062'></a> 12062 <em class='sharp'>#endif</em>
<a id='L12063' name='L12063'></a> 12063 <em class='sharp'>#endif</em>
<a id='L12064' name='L12064'></a> 12064     <em class='brace'>}</em>
<a id='L12065' name='L12065'></a> 12065 
<a id='L12066' name='L12066'></a> 12066   <strong class='reserved'>return</strong> <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L12067' name='L12067'></a> 12067 <em class='brace'>}</em>
<a id='L12068' name='L12068'></a> 12068 
<a id='L12069' name='L12069'></a> 12069 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> (USE_X_TOOLKIT) || <strong class='reserved'>defined</strong> (USE_GTK)
<a id='L12070' name='L12070'></a> 12070 
<a id='L12071' name='L12071'></a> 12071 <em class='comment'>/* Like x_window_to_frame but also compares the window with the widget's</em>
<a id='L12072' name='L12072'></a> 12072 <em class='comment'>   windows.  */</em>
<a id='L12073' name='L12073'></a> 12073 
<a id='L12074' name='L12074'></a> 12074 <strong class='reserved'>static</strong> <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *
<a id='L12075' name='L12075'></a> 12075 <a href='../R/18049.html' title='Multiple referred from 22 places.'>x_any_window_to_frame</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo, <strong class='reserved'>int</strong> wdesc)
<a id='L12076' name='L12076'></a> 12076 <em class='brace'>{</em>
<a id='L12077' name='L12077'></a> 12077   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>;
<a id='L12078' name='L12078'></a> 12078   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, *found = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L12079' name='L12079'></a> 12079   <strong class='reserved'>struct</strong> <a href='../D/19627.html' title='Multiple defined in 5 places.'>x_output</a> *<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L12080' name='L12080'></a> 12080 
<a id='L12081' name='L12081'></a> 12081   <strong class='reserved'>if</strong> (wdesc == None)
<a id='L12082' name='L12082'></a> 12082     <strong class='reserved'>return</strong> <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L12083' name='L12083'></a> 12083 
<a id='L12084' name='L12084'></a> 12084 <em class='sharp'>#ifdef</em> HAVE_XWIDGETS
<a id='L12085' name='L12085'></a> 12085   <strong class='reserved'>struct</strong> <a href='../S/2261.html#L102' title='Defined at 102 in src/xwidget.h.'>xwidget_view</a> *xv = <a href='../S/2334.html#L2116' title='Defined at 2116 in src/xwidget.c.'>xwidget_view_from_window</a> (wdesc);
<a id='L12086' name='L12086'></a> 12086 
<a id='L12087' name='L12087'></a> 12087   <strong class='reserved'>if</strong> (xv)
<a id='L12088' name='L12088'></a> 12088     <strong class='reserved'>return</strong> xv-&gt;<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>;
<a id='L12089' name='L12089'></a> 12089 <em class='sharp'>#endif</em>
<a id='L12090' name='L12090'></a> 12090 
<a id='L12091' name='L12091'></a> 12091   <a href='../S/2183.html#L1405' title='Defined at 1405 in src/frame.h.'>FOR_EACH_FRAME</a> (<a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)
<a id='L12092' name='L12092'></a> 12092     <em class='brace'>{</em>
<a id='L12093' name='L12093'></a> 12093       <strong class='reserved'>if</strong> (found)
<a id='L12094' name='L12094'></a> 12094         <strong class='reserved'>break</strong>;
<a id='L12095' name='L12095'></a> 12095       <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>);
<a id='L12096' name='L12096'></a> 12096       <strong class='reserved'>if</strong> (<a href='../S/2183.html#L919' title='Defined at 919 in src/frame.h.'>FRAME_X_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) &amp;&amp; <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) == dpyinfo)
<a id='L12097' name='L12097'></a> 12097         <em class='brace'>{</em>
<a id='L12098' name='L12098'></a> 12098           <em class='comment'>/* This frame matches if the window is any of its widgets.  */</em>
<a id='L12099' name='L12099'></a> 12099           <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L12100' name='L12100'></a> 12100           <strong class='reserved'>if</strong> (<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;hourglass_window == wdesc)
<a id='L12101' name='L12101'></a> 12101             found = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L12102' name='L12102'></a> 12102           <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;widget)
<a id='L12103' name='L12103'></a> 12103             <em class='brace'>{</em>
<a id='L12104' name='L12104'></a> 12104 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L12105' name='L12105'></a> 12105               GtkWidget *gwdesc = <a href='../S/2362.html#L1386' title='Defined at 1386 in src/gtkutil.c.'>xg_win_to_widget</a> (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, wdesc);
<a id='L12106' name='L12106'></a> 12106               <strong class='reserved'>if</strong> (gwdesc != 0
<a id='L12107' name='L12107'></a> 12107                   &amp;&amp; gtk_widget_get_toplevel (gwdesc) == <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;widget)
<a id='L12108' name='L12108'></a> 12108                 found = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L12109' name='L12109'></a> 12109 <em class='sharp'>#else</em>
<a id='L12110' name='L12110'></a> 12110               <strong class='reserved'>if</strong> (wdesc == XtWindow (<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;widget)
<a id='L12111' name='L12111'></a> 12111                   || wdesc == XtWindow (<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;column_widget)
<a id='L12112' name='L12112'></a> 12112                   || wdesc == XtWindow (<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;edit_widget))
<a id='L12113' name='L12113'></a> 12113                 found = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L12114' name='L12114'></a> 12114               <em class='comment'>/* Match if the window is this frame's menubar.  */</em>
<a id='L12115' name='L12115'></a> 12115               <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (<a href='../S/2068.html#L1192' title='Defined at 1192 in lwlib/lwlib.c.'>lw_window_is_in_menubar</a> (wdesc, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;menubar_widget))
<a id='L12116' name='L12116'></a> 12116                 found = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L12117' name='L12117'></a> 12117 <em class='sharp'>#endif</em>
<a id='L12118' name='L12118'></a> 12118             <em class='brace'>}</em>
<a id='L12119' name='L12119'></a> 12119           <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (<a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) == wdesc)
<a id='L12120' name='L12120'></a> 12120             <em class='comment'>/* A tooltip frame.  */</em>
<a id='L12121' name='L12121'></a> 12121             found = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L12122' name='L12122'></a> 12122         <em class='brace'>}</em>
<a id='L12123' name='L12123'></a> 12123     <em class='brace'>}</em>
<a id='L12124' name='L12124'></a> 12124 
<a id='L12125' name='L12125'></a> 12125   <strong class='reserved'>return</strong> found;
<a id='L12126' name='L12126'></a> 12126 <em class='brace'>}</em>
<a id='L12127' name='L12127'></a> 12127 
<a id='L12128' name='L12128'></a> 12128 <em class='comment'>/* Likewise, but consider only the menu bar widget.  */</em>
<a id='L12129' name='L12129'></a> 12129 
<a id='L12130' name='L12130'></a> 12130 <strong class='reserved'>static</strong> <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *
<a id='L12131' name='L12131'></a> 12131 <a href='../R/18254.html' title='Multiple referred from 2 places.'>x_menubar_window_to_frame</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L12132' name='L12132'></a> 12132                            <strong class='reserved'>const</strong> XEvent *event)
<a id='L12133' name='L12133'></a> 12133 <em class='brace'>{</em>
<a id='L12134' name='L12134'></a> 12134   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> wdesc;
<a id='L12135' name='L12135'></a> 12135 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L12136' name='L12136'></a> 12136   <strong class='reserved'>if</strong> (event-&gt;type == GenericEvent
<a id='L12137' name='L12137'></a> 12137       &amp;&amp; dpyinfo-&gt;supports_xi2
<a id='L12138' name='L12138'></a> 12138       &amp;&amp; (event-&gt;xcookie.evtype == XI_ButtonPress
<a id='L12139' name='L12139'></a> 12139           || event-&gt;xcookie.evtype == XI_ButtonRelease))
<a id='L12140' name='L12140'></a> 12140     wdesc = ((XIDeviceEvent *) event-&gt;xcookie.data)-&gt;event;
<a id='L12141' name='L12141'></a> 12141   <strong class='reserved'>else</strong>
<a id='L12142' name='L12142'></a> 12142 <em class='sharp'>#endif</em>
<a id='L12143' name='L12143'></a> 12143     wdesc = event-&gt;xany.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>;
<a id='L12144' name='L12144'></a> 12144   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>;
<a id='L12145' name='L12145'></a> 12145   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L12146' name='L12146'></a> 12146   <strong class='reserved'>struct</strong> <a href='../D/19627.html' title='Multiple defined in 5 places.'>x_output</a> *<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L12147' name='L12147'></a> 12147 
<a id='L12148' name='L12148'></a> 12148   <strong class='reserved'>if</strong> (wdesc == None)
<a id='L12149' name='L12149'></a> 12149     <strong class='reserved'>return</strong> <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L12150' name='L12150'></a> 12150 
<a id='L12151' name='L12151'></a> 12151   <a href='../S/2183.html#L1405' title='Defined at 1405 in src/frame.h.'>FOR_EACH_FRAME</a> (<a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)
<a id='L12152' name='L12152'></a> 12152     <em class='brace'>{</em>
<a id='L12153' name='L12153'></a> 12153       <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>);
<a id='L12154' name='L12154'></a> 12154       <strong class='reserved'>if</strong> (!<a href='../S/2183.html#L919' title='Defined at 919 in src/frame.h.'>FRAME_X_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) || <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) != dpyinfo)
<a id='L12155' name='L12155'></a> 12155         <strong class='reserved'>continue</strong>;
<a id='L12156' name='L12156'></a> 12156       <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L12157' name='L12157'></a> 12157 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L12158' name='L12158'></a> 12158       <strong class='reserved'>if</strong> (<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;menubar_widget &amp;&amp; <a href='../S/2362.html#L4189' title='Defined at 4189 in src/gtkutil.c.'>xg_event_is_for_menubar</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, event))
<a id='L12159' name='L12159'></a> 12159         <strong class='reserved'>return</strong> <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L12160' name='L12160'></a> 12160 <em class='sharp'>#else</em>
<a id='L12161' name='L12161'></a> 12161       <em class='comment'>/* Match if the window is this frame's menubar.  */</em>
<a id='L12162' name='L12162'></a> 12162       <strong class='reserved'>if</strong> (<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;menubar_widget
<a id='L12163' name='L12163'></a> 12163           &amp;&amp; <a href='../S/2068.html#L1192' title='Defined at 1192 in lwlib/lwlib.c.'>lw_window_is_in_menubar</a> (wdesc, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;menubar_widget))
<a id='L12164' name='L12164'></a> 12164         <strong class='reserved'>return</strong> <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L12165' name='L12165'></a> 12165 <em class='sharp'>#endif</em>
<a id='L12166' name='L12166'></a> 12166     <em class='brace'>}</em>
<a id='L12167' name='L12167'></a> 12167   <strong class='reserved'>return</strong> 0;
<a id='L12168' name='L12168'></a> 12168 <em class='brace'>}</em>
<a id='L12169' name='L12169'></a> 12169 
<a id='L12170' name='L12170'></a> 12170 <em class='comment'>/* Return the frame whose principal (outermost) window is WDESC.</em>
<a id='L12171' name='L12171'></a> 12171 <em class='comment'>   If WDESC is some other (smaller) window, we return 0.  */</em>
<a id='L12172' name='L12172'></a> 12172 
<a id='L12173' name='L12173'></a> 12173 <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *
<a id='L12174' name='L12174'></a> 12174 <a href='../R/18361.html' title='Multiple referred from 25 places.'>x_top_window_to_frame</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo, <strong class='reserved'>int</strong> wdesc)
<a id='L12175' name='L12175'></a> 12175 <em class='brace'>{</em>
<a id='L12176' name='L12176'></a> 12176   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>;
<a id='L12177' name='L12177'></a> 12177   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L12178' name='L12178'></a> 12178   <strong class='reserved'>struct</strong> <a href='../D/19627.html' title='Multiple defined in 5 places.'>x_output</a> *<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L12179' name='L12179'></a> 12179 
<a id='L12180' name='L12180'></a> 12180   <strong class='reserved'>if</strong> (wdesc == None)
<a id='L12181' name='L12181'></a> 12181     <strong class='reserved'>return</strong> <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L12182' name='L12182'></a> 12182 
<a id='L12183' name='L12183'></a> 12183   <a href='../S/2183.html#L1405' title='Defined at 1405 in src/frame.h.'>FOR_EACH_FRAME</a> (<a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)
<a id='L12184' name='L12184'></a> 12184     <em class='brace'>{</em>
<a id='L12185' name='L12185'></a> 12185       <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>);
<a id='L12186' name='L12186'></a> 12186       <strong class='reserved'>if</strong> (!<a href='../S/2183.html#L919' title='Defined at 919 in src/frame.h.'>FRAME_X_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) || <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) != dpyinfo)
<a id='L12187' name='L12187'></a> 12187         <strong class='reserved'>continue</strong>;
<a id='L12188' name='L12188'></a> 12188       <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L12189' name='L12189'></a> 12189 
<a id='L12190' name='L12190'></a> 12190       <strong class='reserved'>if</strong> (<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;widget)
<a id='L12191' name='L12191'></a> 12191         <em class='brace'>{</em>
<a id='L12192' name='L12192'></a> 12192           <em class='comment'>/* This frame matches if the window is its topmost widget.  */</em>
<a id='L12193' name='L12193'></a> 12193 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L12194' name='L12194'></a> 12194           GtkWidget *gwdesc = <a href='../S/2362.html#L1386' title='Defined at 1386 in src/gtkutil.c.'>xg_win_to_widget</a> (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, wdesc);
<a id='L12195' name='L12195'></a> 12195           <strong class='reserved'>if</strong> (gwdesc == <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;widget)
<a id='L12196' name='L12196'></a> 12196             <strong class='reserved'>return</strong> <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L12197' name='L12197'></a> 12197 <em class='sharp'>#else</em>
<a id='L12198' name='L12198'></a> 12198           <strong class='reserved'>if</strong> (wdesc == XtWindow (<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;widget))
<a id='L12199' name='L12199'></a> 12199             <strong class='reserved'>return</strong> <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L12200' name='L12200'></a> 12200 <em class='sharp'>#endif</em>
<a id='L12201' name='L12201'></a> 12201         <em class='brace'>}</em>
<a id='L12202' name='L12202'></a> 12202       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (<a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) == wdesc)
<a id='L12203' name='L12203'></a> 12203         <em class='comment'>/* Tooltip frame.  */</em>
<a id='L12204' name='L12204'></a> 12204         <strong class='reserved'>return</strong> <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L12205' name='L12205'></a> 12205     <em class='brace'>}</em>
<a id='L12206' name='L12206'></a> 12206   <strong class='reserved'>return</strong> 0;
<a id='L12207' name='L12207'></a> 12207 <em class='brace'>}</em>
<a id='L12208' name='L12208'></a> 12208 
<a id='L12209' name='L12209'></a> 12209 <em class='sharp'>#else</em> <em class='comment'>/* !USE_X_TOOLKIT &amp;&amp; !USE_GTK */</em>
<a id='L12210' name='L12210'></a> 12210 
<a id='L12211' name='L12211'></a> 12211 <em class='sharp'>#define</em> <a href='../R/18049.html' title='Multiple referred from 22 places.'>x_any_window_to_frame</a>(<a href='../D/10238.html' title='Multiple defined in 2 places.'>d</a>, i) <a href='../S/2289.html#L11957' title='Defined at 11957 in src/xterm.c.'>x_window_to_frame</a> (<a href='../D/10238.html' title='Multiple defined in 2 places.'>d</a>, i)
<a id='L12212' name='L12212'></a> 12212 
<a id='L12213' name='L12213'></a> 12213 <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *
<a id='L12214' name='L12214'></a> 12214 <a href='../R/18361.html' title='Multiple referred from 25 places.'>x_top_window_to_frame</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo, <strong class='reserved'>int</strong> wdesc)
<a id='L12215' name='L12215'></a> 12215 <em class='brace'>{</em>
<a id='L12216' name='L12216'></a> 12216   <strong class='reserved'>return</strong> <a href='../S/2289.html#L11957' title='Defined at 11957 in src/xterm.c.'>x_window_to_frame</a> (dpyinfo, wdesc);
<a id='L12217' name='L12217'></a> 12217 <em class='brace'>}</em>
<a id='L12218' name='L12218'></a> 12218 
<a id='L12219' name='L12219'></a> 12219 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L12220' name='L12220'></a> 12220 <a href='../S/2289.html#L12748' title='Referred from 12748 in src/xterm.c.'>x_next_event_from_any_display</a> (XEvent *event)
<a id='L12221' name='L12221'></a> 12221 <em class='brace'>{</em>
<a id='L12222' name='L12222'></a> 12222   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L12223' name='L12223'></a> 12223   <a href='../D/11311.html' title='Multiple defined in 3 places.'>fd_set</a> fds, rfds;
<a id='L12224' name='L12224'></a> 12224   <strong class='reserved'>int</strong> fd, maxfd, rc;
<a id='L12225' name='L12225'></a> 12225 
<a id='L12226' name='L12226'></a> 12226   rc = -1;
<a id='L12227' name='L12227'></a> 12227   <a href='../D/2046.html' title='Multiple defined in 4 places.'>FD_ZERO</a> (&amp;rfds);
<a id='L12228' name='L12228'></a> 12228 
<a id='L12229' name='L12229'></a> 12229   <strong class='reserved'>while</strong> (<a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>)
<a id='L12230' name='L12230'></a> 12230     <em class='brace'>{</em>
<a id='L12231' name='L12231'></a> 12231       <a href='../D/2046.html' title='Multiple defined in 4 places.'>FD_ZERO</a> (&amp;fds);
<a id='L12232' name='L12232'></a> 12232       maxfd = -1;
<a id='L12233' name='L12233'></a> 12233 
<a id='L12234' name='L12234'></a> 12234       <strong class='reserved'>for</strong> (dpyinfo = x_display_list; dpyinfo;
<a id='L12235' name='L12235'></a> 12235            dpyinfo = dpyinfo-&gt;next)
<a id='L12236' name='L12236'></a> 12236         <em class='brace'>{</em>
<a id='L12237' name='L12237'></a> 12237           fd = ConnectionNumber (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L12238' name='L12238'></a> 12238 
<a id='L12239' name='L12239'></a> 12239           <strong class='reserved'>if</strong> ((rc &lt; 0 || <a href='../D/2043.html' title='Multiple defined in 8 places.'>FD_ISSET</a> (fd, &amp;rfds))
<a id='L12240' name='L12240'></a> 12240               &amp;&amp; XPending (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>))
<a id='L12241' name='L12241'></a> 12241             <em class='brace'>{</em>
<a id='L12242' name='L12242'></a> 12242               XNextEvent (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, event);
<a id='L12243' name='L12243'></a> 12243               <strong class='reserved'>return</strong>;
<a id='L12244' name='L12244'></a> 12244             <em class='brace'>}</em>
<a id='L12245' name='L12245'></a> 12245 
<a id='L12246' name='L12246'></a> 12246           <strong class='reserved'>if</strong> (fd &gt; maxfd)
<a id='L12247' name='L12247'></a> 12247             maxfd = fd;
<a id='L12248' name='L12248'></a> 12248 
<a id='L12249' name='L12249'></a> 12249           <a href='../D/10871.html' title='Multiple defined in 5 places.'>eassert</a> (fd &lt; <a href='../D/2045.html' title='Multiple defined in 4 places.'>FD_SETSIZE</a>);
<a id='L12250' name='L12250'></a> 12250           <a href='../D/2044.html' title='Multiple defined in 6 places.'>FD_SET</a> (fd, &amp;fds);
<a id='L12251' name='L12251'></a> 12251         <em class='brace'>}</em>
<a id='L12252' name='L12252'></a> 12252 
<a id='L12253' name='L12253'></a> 12253       <a href='../D/10871.html' title='Multiple defined in 5 places.'>eassert</a> (maxfd &gt;= 0);
<a id='L12254' name='L12254'></a> 12254 
<a id='L12255' name='L12255'></a> 12255       <em class='comment'>/* Continue to read input even if pselect fails, because if an</em>
<a id='L12256' name='L12256'></a> 12256 <em class='comment'>         error occurs XPending will call the IO error handler, which</em>
<a id='L12257' name='L12257'></a> 12257 <em class='comment'>         then brings us out of this loop.  */</em>
<a id='L12258' name='L12258'></a> 12258       rc = <a href='../D/15844.html' title='Multiple defined in 7 places.'>pselect</a> (maxfd + 1, &amp;fds, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L12259' name='L12259'></a> 12259 
<a id='L12260' name='L12260'></a> 12260       <strong class='reserved'>if</strong> (rc &gt;= 0)
<a id='L12261' name='L12261'></a> 12261         rfds = fds;
<a id='L12262' name='L12262'></a> 12262     <em class='brace'>}</em>
<a id='L12263' name='L12263'></a> 12263 <em class='brace'>}</em>
<a id='L12264' name='L12264'></a> 12264 
<a id='L12265' name='L12265'></a> 12265 <em class='sharp'>#endif</em> <em class='comment'>/* USE_X_TOOLKIT || USE_GTK */</em>
<a id='L12266' name='L12266'></a> 12266 
<a id='L12267' name='L12267'></a> 12267 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L12268' name='L12268'></a> 12268 <a href='../S/2289.html#L12293' title='Referred from 12293 in src/xterm.c.'>x_handle_pending_selection_requests_1</a> (<strong class='reserved'>struct</strong> <a href='../S/2289.html#L961' title='Defined at 961 in src/xterm.c.'>x_selection_request_event</a> *tem)
<a id='L12269' name='L12269'></a> 12269 <em class='brace'>{</em>
<a id='L12270' name='L12270'></a> 12270   <a href='../D/17570.html' title='Multiple defined in 2 places.'>specpdl_ref</a> count;
<a id='L12271' name='L12271'></a> 12271   <strong class='reserved'>struct</strong> <a href='../D/16706.html' title='Multiple defined in 2 places.'>selection_input_event</a> se;
<a id='L12272' name='L12272'></a> 12272 
<a id='L12273' name='L12273'></a> 12273   count = <a href='../D/5888.html' title='Multiple defined in 2 places.'>SPECPDL_INDEX</a> ();
<a id='L12274' name='L12274'></a> 12274   se = tem-&gt;se;
<a id='L12275' name='L12275'></a> 12275 
<a id='L12276' name='L12276'></a> 12276   <a href='../S/2188.html#L3559' title='Defined at 3559 in src/eval.c.'>record_unwind_protect_ptr</a> (<a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a>, tem);
<a id='L12277' name='L12277'></a> 12277   <a href='../S/2281.html#L1362' title='Defined at 1362 in src/xselect.c.'>x_handle_selection_event</a> (&amp;se);
<a id='L12278' name='L12278'></a> 12278   <a href='../S/2188.html#L3757' title='Defined at 3757 in src/eval.c.'>unbind_to</a> (count, Qnil);
<a id='L12279' name='L12279'></a> 12279 <em class='brace'>}</em>
<a id='L12280' name='L12280'></a> 12280 
<a id='L12281' name='L12281'></a> 12281 <em class='comment'>/* Handle all pending selection request events from modal event</em>
<a id='L12282' name='L12282'></a> 12282 <em class='comment'>   loops.  */</em>
<a id='L12283' name='L12283'></a> 12283 <strong class='reserved'>void</strong>
<a id='L12284' name='L12284'></a> 12284 <a href='../R/18224.html' title='Multiple referred from 5 places.'>x_handle_pending_selection_requests</a> (<strong class='reserved'>void</strong>)
<a id='L12285' name='L12285'></a> 12285 <em class='brace'>{</em>
<a id='L12286' name='L12286'></a> 12286   <strong class='reserved'>struct</strong> <a href='../S/2289.html#L961' title='Defined at 961 in src/xterm.c.'>x_selection_request_event</a> *tem;
<a id='L12287' name='L12287'></a> 12287 
<a id='L12288' name='L12288'></a> 12288   <strong class='reserved'>while</strong> (pending_selection_requests)
<a id='L12289' name='L12289'></a> 12289     <em class='brace'>{</em>
<a id='L12290' name='L12290'></a> 12290       tem = pending_selection_requests;
<a id='L12291' name='L12291'></a> 12291       pending_selection_requests = tem-&gt;next;
<a id='L12292' name='L12292'></a> 12292 
<a id='L12293' name='L12293'></a> 12293       <a href='../S/2289.html#L12268' title='Defined at 12268 in src/xterm.c.'>x_handle_pending_selection_requests_1</a> (tem);
<a id='L12294' name='L12294'></a> 12294     <em class='brace'>}</em>
<a id='L12295' name='L12295'></a> 12295 <em class='brace'>}</em>
<a id='L12296' name='L12296'></a> 12296 
<a id='L12297' name='L12297'></a> 12297 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L12298' name='L12298'></a> 12298 <a href='../R/18267.html' title='Multiple referred from 4 places.'>x_push_selection_request</a> (<strong class='reserved'>struct</strong> <a href='../D/16706.html' title='Multiple defined in 2 places.'>selection_input_event</a> *se)
<a id='L12299' name='L12299'></a> 12299 <em class='brace'>{</em>
<a id='L12300' name='L12300'></a> 12300   <strong class='reserved'>struct</strong> <a href='../S/2289.html#L961' title='Defined at 961 in src/xterm.c.'>x_selection_request_event</a> *tem;
<a id='L12301' name='L12301'></a> 12301 
<a id='L12302' name='L12302'></a> 12302   tem = <a href='../D/20068.html' title='Multiple defined in 10 places.'>xmalloc</a> (<strong class='reserved'>sizeof</strong> *tem);
<a id='L12303' name='L12303'></a> 12303   tem-&gt;next = pending_selection_requests;
<a id='L12304' name='L12304'></a> 12304   tem-&gt;se = *se;
<a id='L12305' name='L12305'></a> 12305   pending_selection_requests = tem;
<a id='L12306' name='L12306'></a> 12306 <em class='brace'>}</em>
<a id='L12307' name='L12307'></a> 12307 
<a id='L12308' name='L12308'></a> 12308 <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L12309' name='L12309'></a> 12309 <a href='../R/18115.html' title='Multiple referred from 3 places.'>x_detect_pending_selection_requests</a> (<strong class='reserved'>void</strong>)
<a id='L12310' name='L12310'></a> 12310 <em class='brace'>{</em>
<a id='L12311' name='L12311'></a> 12311   <strong class='reserved'>return</strong> !!pending_selection_requests;
<a id='L12312' name='L12312'></a> 12312 <em class='brace'>}</em>
<a id='L12313' name='L12313'></a> 12313 
<a id='L12314' name='L12314'></a> 12314 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L12315' name='L12315'></a> 12315 <a href='../S/2289.html#L12494' title='Referred from 12494 in src/xterm.c.'>x_clear_dnd_action</a> (<strong class='reserved'>void</strong>)
<a id='L12316' name='L12316'></a> 12316 <em class='brace'>{</em>
<a id='L12317' name='L12317'></a> 12317   x_dnd_action_symbol = Qnil;
<a id='L12318' name='L12318'></a> 12318 <em class='brace'>}</em>
<a id='L12319' name='L12319'></a> 12319 
<a id='L12320' name='L12320'></a> 12320 <em class='comment'>/* Delete action descriptions from F after drag-and-drop.  */</em>
<a id='L12321' name='L12321'></a> 12321 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L12322' name='L12322'></a> 12322 <a href='../S/2289.html#L12530' title='Referred from 12530 in src/xterm.c.'>x_dnd_delete_action_list</a> (<a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)
<a id='L12323' name='L12323'></a> 12323 <em class='brace'>{</em>
<a id='L12324' name='L12324'></a> 12324   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L12325' name='L12325'></a> 12325 
<a id='L12326' name='L12326'></a> 12326   <em class='comment'>/* Delete those two properties, since some clients look at them and</em>
<a id='L12327' name='L12327'></a> 12327 <em class='comment'>     not the action to decide whether or not the user should be</em>
<a id='L12328' name='L12328'></a> 12328 <em class='comment'>     prompted to select an action.  This can be called with FRAME no</em>
<a id='L12329' name='L12329'></a> 12329 <em class='comment'>     longer alive (or its display dead).  */</em>
<a id='L12330' name='L12330'></a> 12330 
<a id='L12331' name='L12331'></a> 12331   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>);
<a id='L12332' name='L12332'></a> 12332 
<a id='L12333' name='L12333'></a> 12333   <strong class='reserved'>if</strong> (!<a href='../S/2183.html#L1028' title='Defined at 1028 in src/frame.h.'>FRAME_LIVE_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) || !<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>)
<a id='L12334' name='L12334'></a> 12334     <strong class='reserved'>return</strong>;
<a id='L12335' name='L12335'></a> 12335 
<a id='L12336' name='L12336'></a> 12336   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L12337' name='L12337'></a> 12337   XDeleteProperty (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L12338' name='L12338'></a> 12338                    <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;Xatom_XdndActionList);
<a id='L12339' name='L12339'></a> 12339   XDeleteProperty (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L12340' name='L12340'></a> 12340                    <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;Xatom_XdndActionDescription);
<a id='L12341' name='L12341'></a> 12341   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L12342' name='L12342'></a> 12342 <em class='brace'>}</em>
<a id='L12343' name='L12343'></a> 12343 
<a id='L12344' name='L12344'></a> 12344 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L12345' name='L12345'></a> 12345 <a href='../S/2289.html#L12512' title='Referred from 12512 in src/xterm.c.'>x_dnd_lose_ownership</a> (<a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> timestamp_and_frame)
<a id='L12346' name='L12346'></a> 12346 <em class='brace'>{</em>
<a id='L12347' name='L12347'></a> 12347   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L12348' name='L12348'></a> 12348 
<a id='L12349' name='L12349'></a> 12349   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/7022.html' title='Multiple defined in 2 places.'>XCDR</a> (timestamp_and_frame));
<a id='L12350' name='L12350'></a> 12350 
<a id='L12351' name='L12351'></a> 12351   <strong class='reserved'>if</strong> (<a href='../S/2183.html#L1028' title='Defined at 1028 in src/frame.h.'>FRAME_LIVE_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L12352' name='L12352'></a> 12352     Fx_disown_selection_internal (QXdndSelection,
<a id='L12353' name='L12353'></a> 12353                                   <a href='../D/7021.html' title='Multiple defined in 2 places.'>XCAR</a> (timestamp_and_frame),
<a id='L12354' name='L12354'></a> 12354                                   <a href='../D/7022.html' title='Multiple defined in 2 places.'>XCDR</a> (timestamp_and_frame));
<a id='L12355' name='L12355'></a> 12355 <em class='brace'>}</em>
<a id='L12356' name='L12356'></a> 12356 
<a id='L12357' name='L12357'></a> 12357 <em class='comment'>/* Clean up an existing drag-and-drop operation in preparation for its</em>
<a id='L12358' name='L12358'></a> 12358 <em class='comment'>   sudden termination.  */</em>
<a id='L12359' name='L12359'></a> 12359 
<a id='L12360' name='L12360'></a> 12360 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L12361' name='L12361'></a> 12361 <a href='../R/18143.html' title='Multiple referred from 3 places.'>x_dnd_process_quit</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a> timestamp)
<a id='L12362' name='L12362'></a> 12362 <em class='brace'>{</em>
<a id='L12363' name='L12363'></a> 12363   <a href='../D/20018.html' title='Multiple defined in 2 places.'>xm_drop_start_message</a> dmsg;
<a id='L12364' name='L12364'></a> 12364 
<a id='L12365' name='L12365'></a> 12365   <strong class='reserved'>if</strong> (x_dnd_in_progress)
<a id='L12366' name='L12366'></a> 12366     <em class='brace'>{</em>
<a id='L12367' name='L12367'></a> 12367       <strong class='reserved'>if</strong> (x_dnd_last_seen_window != None
<a id='L12368' name='L12368'></a> 12368           &amp;&amp; x_dnd_last_protocol_version != -1)
<a id='L12369' name='L12369'></a> 12369         <a href='../S/2289.html#L4649' title='Defined at 4649 in src/xterm.c.'>x_dnd_send_leave</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, x_dnd_last_seen_window,
<a id='L12370' name='L12370'></a> 12370                           x_dnd_last_seen_toplevel);
<a id='L12371' name='L12371'></a> 12371       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (x_dnd_last_seen_window != None
<a id='L12372' name='L12372'></a> 12372                &amp;&amp; !<a href='../S/2289.html#L1748' title='Defined at 1748 in src/xterm.c.'>XM_DRAG_STYLE_IS_DROP_ONLY</a> (x_dnd_last_motif_style)
<a id='L12373' name='L12373'></a> 12373                &amp;&amp; x_dnd_last_motif_style != <a href='../S/2289.html#L1740' title='Defined at 1740 in src/xterm.c.'>XM_DRAG_STYLE_NONE</a>
<a id='L12374' name='L12374'></a> 12374                &amp;&amp; x_dnd_motif_setup_p)
<a id='L12375' name='L12375'></a> 12375         <em class='brace'>{</em>
<a id='L12376' name='L12376'></a> 12376           dmsg.reason = <a href='../S/2289.html#L1718' title='Defined at 1718 in src/xterm.c.'>XM_DRAG_REASON</a> (<a href='../S/2289.html#L1732' title='Defined at 1732 in src/xterm.c.'>XM_DRAG_ORIGINATOR_INITIATOR</a>,
<a id='L12377' name='L12377'></a> 12377                                         <a href='../S/2289.html#L1724' title='Defined at 1724 in src/xterm.c.'>XM_DRAG_REASON_DROP_START</a>);
<a id='L12378' name='L12378'></a> 12378           dmsg.byte_order = <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>;
<a id='L12379' name='L12379'></a> 12379           dmsg.timestamp = timestamp;
<a id='L12380' name='L12380'></a> 12380           dmsg.side_effects
<a id='L12381' name='L12381'></a> 12381             = <a href='../S/2289.html#L1689' title='Defined at 1689 in src/xterm.c.'>XM_DRAG_SIDE_EFFECT</a> (<a href='../S/2289.html#L1766' title='Defined at 1766 in src/xterm.c.'>xm_side_effect_from_action</a> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L12382' name='L12382'></a> 12382                                                                x_dnd_wanted_action),
<a id='L12383' name='L12383'></a> 12383                                    <a href='../S/2289.html#L1756' title='Defined at 1756 in src/xterm.c.'>XM_DROP_SITE_VALID</a>, x_dnd_motif_operations,
<a id='L12384' name='L12384'></a> 12384                                    <a href='../S/2289.html#L1715' title='Defined at 1715 in src/xterm.c.'>XM_DROP_ACTION_DROP_CANCEL</a>);
<a id='L12385' name='L12385'></a> 12385           dmsg.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = 0;
<a id='L12386' name='L12386'></a> 12386           dmsg.y = 0;
<a id='L12387' name='L12387'></a> 12387           dmsg.index_atom = x_dnd_motif_atom;
<a id='L12388' name='L12388'></a> 12388           dmsg.source_window = <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L12389' name='L12389'></a> 12389 
<a id='L12390' name='L12390'></a> 12390           <a href='../S/2289.html#L2899' title='Defined at 2899 in src/xterm.c.'>x_dnd_send_xm_leave_for_drop</a> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>,
<a id='L12391' name='L12391'></a> 12391                                         x_dnd_last_seen_window,
<a id='L12392' name='L12392'></a> 12392                                         timestamp);
<a id='L12393' name='L12393'></a> 12393           <a href='../S/2289.html#L2565' title='Defined at 2565 in src/xterm.c.'>xm_send_drop_message</a> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L12394' name='L12394'></a> 12394                                 x_dnd_last_seen_window, &amp;dmsg);
<a id='L12395' name='L12395'></a> 12395         <em class='brace'>}</em>
<a id='L12396' name='L12396'></a> 12396 
<a id='L12397' name='L12397'></a> 12397       x_dnd_end_window = x_dnd_last_seen_window;
<a id='L12398' name='L12398'></a> 12398       x_dnd_last_seen_window = None;
<a id='L12399' name='L12399'></a> 12399       x_dnd_last_seen_toplevel = None;
<a id='L12400' name='L12400'></a> 12400       x_dnd_in_progress = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L12401' name='L12401'></a> 12401       x_dnd_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L12402' name='L12402'></a> 12402     <em class='brace'>}</em>
<a id='L12403' name='L12403'></a> 12403 
<a id='L12404' name='L12404'></a> 12404   x_dnd_waiting_for_finish = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L12405' name='L12405'></a> 12405   x_dnd_return_frame_object = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L12406' name='L12406'></a> 12406   x_dnd_movement_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L12407' name='L12407'></a> 12407   x_dnd_wheel_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L12408' name='L12408'></a> 12408 <em class='brace'>}</em>
<a id='L12409' name='L12409'></a> 12409 
<a id='L12410' name='L12410'></a> 12410 <em class='comment'>/* This function is defined far away from the rest of the XDND code so</em>
<a id='L12411' name='L12411'></a> 12411 <em class='comment'>   it can utilize `x_any_window_to_frame'.  */</em>
<a id='L12412' name='L12412'></a> 12412 
<a id='L12413' name='L12413'></a> 12413 <em class='comment'>/* Implementors beware!  On most other platforms (where drag-and-drop</em>
<a id='L12414' name='L12414'></a> 12414 <em class='comment'>   data is not provided via selections, but some kind of serialization</em>
<a id='L12415' name='L12415'></a> 12415 <em class='comment'>   mechanism), it is usually much easier to implement a suitable</em>
<a id='L12416' name='L12416'></a> 12416 <em class='comment'>   primitive instead of copying the C code here, and then to build</em>
<a id='L12417' name='L12417'></a> 12417 <em class='comment'>   `x-begin-drag' on top of that, by making it a wrapper function in</em>
<a id='L12418' name='L12418'></a> 12418 <em class='comment'>   Lisp that converts the list of targets and value of `XdndSelection'</em>
<a id='L12419' name='L12419'></a> 12419 <em class='comment'>   to serialized data.  Also be sure to update the data types used in</em>
<a id='L12420' name='L12420'></a> 12420 <em class='comment'>   dnd.el.</em>
<a id='L12421' name='L12421'></a> 12421 <em class='comment'></em>
<a id='L12422' name='L12422'></a> 12422 <em class='comment'>   For examples of how to do this, see `haiku-drag-message' and</em>
<a id='L12423' name='L12423'></a> 12423 <em class='comment'>   `x-begin-drag' in haikuselect.c and lisp/term/haiku-win.el, and</em>
<a id='L12424' name='L12424'></a> 12424 <em class='comment'>   `ns-begin-drag' and `x-begin-drag' in nsselect.m and</em>
<a id='L12425' name='L12425'></a> 12425 <em class='comment'>   lisp/term/ns-win.el.  */</em>
<a id='L12426' name='L12426'></a> 12426 
<a id='L12427' name='L12427'></a> 12427 <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a>
<a id='L12428' name='L12428'></a> 12428 <a href='../R/18122.html' title='Multiple referred from 2 places.'>x_dnd_begin_drag_and_drop</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a> <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>, Atom xaction,
<a id='L12429' name='L12429'></a> 12429                            <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> return_frame, Atom *ask_action_list,
<a id='L12430' name='L12430'></a> 12430                            <strong class='reserved'>const</strong> <strong class='reserved'>char</strong> **ask_action_names, size_t n_ask_actions,
<a id='L12431' name='L12431'></a> 12431                            <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> allow_current_frame, Atom *target_atoms,
<a id='L12432' name='L12432'></a> 12432                            <strong class='reserved'>int</strong> ntargets, <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> selection_target_list,
<a id='L12433' name='L12433'></a> 12433                            <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> follow_tooltip)
<a id='L12434' name='L12434'></a> 12434 <em class='brace'>{</em>
<a id='L12435' name='L12435'></a> 12435 <em class='sharp'>#ifndef</em> USE_GTK
<a id='L12436' name='L12436'></a> 12436   XEvent next_event;
<a id='L12437' name='L12437'></a> 12437   <strong class='reserved'>int</strong> finish;
<a id='L12438' name='L12438'></a> 12438 <em class='sharp'>#endif</em>
<a id='L12439' name='L12439'></a> 12439   XWindowAttributes root_window_attrs;
<a id='L12440' name='L12440'></a> 12440   <strong class='reserved'>struct</strong> <a href='../S/2231.html#L350' title='Defined at 350 in src/termhooks.h.'>input_event</a> hold_quit;
<a id='L12441' name='L12441'></a> 12441   <strong class='reserved'>char</strong> *atom_name, *ask_actions;
<a id='L12442' name='L12442'></a> 12442   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> action, ltimestamp, val;
<a id='L12443' name='L12443'></a> 12443   <a href='../D/17570.html' title='Multiple defined in 2 places.'>specpdl_ref</a> <a href='../S/3345.html#L35' title='Defined at 35 in test/lisp/cedet/semantic-utest-ia-resources/testtemplates.cpp.'>ref</a>, count, <a href='../S/4101.html#L26' title='Defined at 26 in test/manual/etags/cp-src/c.C.'>base</a>;
<a id='L12444' name='L12444'></a> 12444   ptrdiff_t i, end, fill;
<a id='L12445' name='L12445'></a> 12445   XTextProperty prop;
<a id='L12446' name='L12446'></a> 12446   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> frame_object, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, local_value;
<a id='L12447' name='L12447'></a> 12447   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> signals_were_pending, need_sync;
<a id='L12448' name='L12448'></a> 12448 <em class='sharp'>#ifdef</em> HAVE_XKB
<a id='L12449' name='L12449'></a> 12449   XkbStateRec keyboard_state;
<a id='L12450' name='L12450'></a> 12450 <em class='sharp'>#endif</em>
<a id='L12451' name='L12451'></a> 12451 <em class='sharp'>#ifndef</em> USE_GTK
<a id='L12452' name='L12452'></a> 12452   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *event_display;
<a id='L12453' name='L12453'></a> 12453 <em class='sharp'>#endif</em>
<a id='L12454' name='L12454'></a> 12454   <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> additional_mask;
<a id='L12455' name='L12455'></a> 12455 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L12456' name='L12456'></a> 12456   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L275' title='Defined at 275 in src/xterm.h.'>xi_device_t</a> *device;
<a id='L12457' name='L12457'></a> 12457 <em class='sharp'>#endif</em>
<a id='L12458' name='L12458'></a> 12458 
<a id='L12459' name='L12459'></a> 12459   <strong class='reserved'>if</strong> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;untrusted)
<a id='L12460' name='L12460'></a> 12460     <em class='comment'>/* Untrusted clients cannot send messages to trusted clients or</em>
<a id='L12461' name='L12461'></a> 12461 <em class='comment'>       read the window tree, so drag and drop will likely not work at</em>
<a id='L12462' name='L12462'></a> 12462 <em class='comment'>       all.  */</em>
<a id='L12463' name='L12463'></a> 12463     <a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a> ("Drag-and-drop is not possible when the client is"
<a id='L12464' name='L12464'></a> 12464            " not trusted by the X server.");
<a id='L12465' name='L12465'></a> 12465 
<a id='L12466' name='L12466'></a> 12466   <a href='../S/4101.html#L26' title='Defined at 26 in test/manual/etags/cp-src/c.C.'>base</a> = <a href='../D/5888.html' title='Multiple defined in 2 places.'>SPECPDL_INDEX</a> ();
<a id='L12467' name='L12467'></a> 12467 
<a id='L12468' name='L12468'></a> 12468   <em class='comment'>/* Bind this here to avoid juggling bindings and SAFE_FREE in</em>
<a id='L12469' name='L12469'></a> 12469 <em class='comment'>     Fx_begin_drag.  */</em>
<a id='L12470' name='L12470'></a> 12470   <a href='../S/2188.html#L3480' title='Defined at 3480 in src/eval.c.'>specbind</a> (Qx_dnd_targets_list, selection_target_list);
<a id='L12471' name='L12471'></a> 12471 
<a id='L12472' name='L12472'></a> 12472   <strong class='reserved'>if</strong> (!<a href='../S/2183.html#L1152' title='Defined at 1152 in src/frame.h.'>FRAME_VISIBLE_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L12473' name='L12473'></a> 12473     <a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a> ("Frame must be visible");
<a id='L12474' name='L12474'></a> 12474 
<a id='L12475' name='L12475'></a> 12475   <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L12476' name='L12476'></a> 12476   local_value = <a href='../S/2320.html#L1962' title='Defined at 1962 in src/fns.c.'>assq_no_quit</a> (QXdndSelection,
<a id='L12477' name='L12477'></a> 12477                               <a href='../S/2231.html#L912' title='Defined at 912 in src/termhooks.h.'>FRAME_TERMINAL</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;Vselection_alist);
<a id='L12478' name='L12478'></a> 12478 
<a id='L12479' name='L12479'></a> 12479   <strong class='reserved'>if</strong> (x_dnd_in_progress || x_dnd_waiting_for_finish)
<a id='L12480' name='L12480'></a> 12480     <a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a> ("A drag-and-drop session is already in progress");
<a id='L12481' name='L12481'></a> 12481 
<a id='L12482' name='L12482'></a> 12482   <a href='../S/2212.html#L1793' title='Defined at 1793 in src/xterm.h.'>DEFER_SELECTIONS</a>;
<a id='L12483' name='L12483'></a> 12483 
<a id='L12484' name='L12484'></a> 12484   <em class='comment'>/* If local_value is nil, then we lost ownership of XdndSelection.</em>
<a id='L12485' name='L12485'></a> 12485 <em class='comment'>     Signal a more informative error than args-out-of-range.  */</em>
<a id='L12486' name='L12486'></a> 12486   <strong class='reserved'>if</strong> (<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (local_value))
<a id='L12487' name='L12487'></a> 12487     <a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a> ("No local value for XdndSelection");
<a id='L12488' name='L12488'></a> 12488 
<a id='L12489' name='L12489'></a> 12489   <strong class='reserved'>if</strong> (<a href='../D/15672.html' title='Multiple defined in 5 places.'>popup_activated</a> ())
<a id='L12490' name='L12490'></a> 12490     <a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a> ("Trying to drag-and-drop from within a menu-entry");
<a id='L12491' name='L12491'></a> 12491 
<a id='L12492' name='L12492'></a> 12492   <a href='../S/2289.html#L4720' title='Defined at 4720 in src/xterm.c.'>x_set_dnd_targets</a> (target_atoms, ntargets);
<a id='L12493' name='L12493'></a> 12493   <a href='../S/2188.html#L3608' title='Defined at 3608 in src/eval.c.'>record_unwind_protect_void</a> (<a href='../S/2289.html#L4735' title='Defined at 4735 in src/xterm.c.'>x_free_dnd_targets</a>);
<a id='L12494' name='L12494'></a> 12494   <a href='../S/2188.html#L3608' title='Defined at 3608 in src/eval.c.'>record_unwind_protect_void</a> (<a href='../S/2289.html#L12315' title='Defined at 12315 in src/xterm.c.'>x_clear_dnd_action</a>);
<a id='L12495' name='L12495'></a> 12495 
<a id='L12496' name='L12496'></a> 12496   ltimestamp = <a href='../S/2281.html#L3323' title='Defined at 3323 in src/xselect.c.'>x_timestamp_for_selection</a> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L12497' name='L12497'></a> 12497                                           QXdndSelection);
<a id='L12498' name='L12498'></a> 12498 
<a id='L12499' name='L12499'></a> 12499   <strong class='reserved'>if</strong> (<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (ltimestamp))
<a id='L12500' name='L12500'></a> 12500     <a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a> ("No local value for XdndSelection");
<a id='L12501' name='L12501'></a> 12501 
<a id='L12502' name='L12502'></a> 12502   <strong class='reserved'>if</strong> (<a href='../S/2267.html#L2789' title='Defined at 2789 in src/lisp.h.'>BIGNUMP</a> (ltimestamp))
<a id='L12503' name='L12503'></a> 12503     x_dnd_selection_timestamp = <a href='../D/9220.html' title='Multiple defined in 2 places.'>bignum_to_intmax</a> (ltimestamp);
<a id='L12504' name='L12504'></a> 12504   <strong class='reserved'>else</strong>
<a id='L12505' name='L12505'></a> 12505     x_dnd_selection_timestamp = <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (ltimestamp);
<a id='L12506' name='L12506'></a> 12506 
<a id='L12507' name='L12507'></a> 12507   <em class='comment'>/* Release ownership of XdndSelection after this function returns.</em>
<a id='L12508' name='L12508'></a> 12508 <em class='comment'>     VirtualBox uses the owner of XdndSelection to determine whether</em>
<a id='L12509' name='L12509'></a> 12509 <em class='comment'>     or not mouse motion is part of a drag-and-drop operation.  */</em>
<a id='L12510' name='L12510'></a> 12510 
<a id='L12511' name='L12511'></a> 12511   <strong class='reserved'>if</strong> (!x_dnd_preserve_selection_data)
<a id='L12512' name='L12512'></a> 12512     <a href='../S/2188.html#L3540' title='Defined at 3540 in src/eval.c.'>record_unwind_protect</a> (<a href='../S/2289.html#L12345' title='Defined at 12345 in src/xterm.c.'>x_dnd_lose_ownership</a>,
<a id='L12513' name='L12513'></a> 12513                            Fcons (ltimestamp, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>));
<a id='L12514' name='L12514'></a> 12514 
<a id='L12515' name='L12515'></a> 12515   x_dnd_motif_operations
<a id='L12516' name='L12516'></a> 12516     = <a href='../S/2289.html#L1766' title='Defined at 1766 in src/xterm.c.'>xm_side_effect_from_action</a> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), xaction);
<a id='L12517' name='L12517'></a> 12517 
<a id='L12518' name='L12518'></a> 12518   x_dnd_first_motif_operation = <a href='../S/2289.html#L1701' title='Defined at 1701 in src/xterm.c.'>XM_DRAG_NOOP</a>;
<a id='L12519' name='L12519'></a> 12519 
<a id='L12520' name='L12520'></a> 12520   <strong class='reserved'>if</strong> (n_ask_actions)
<a id='L12521' name='L12521'></a> 12521     <em class='brace'>{</em>
<a id='L12522' name='L12522'></a> 12522       x_dnd_motif_operations
<a id='L12523' name='L12523'></a> 12523         = <a href='../S/2289.html#L1781' title='Defined at 1781 in src/xterm.c.'>xm_operations_from_actions</a> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L12524' name='L12524'></a> 12524                                       ask_action_list,
<a id='L12525' name='L12525'></a> 12525                                       n_ask_actions);
<a id='L12526' name='L12526'></a> 12526       x_dnd_first_motif_operation
<a id='L12527' name='L12527'></a> 12527         = <a href='../S/2289.html#L1766' title='Defined at 1766 in src/xterm.c.'>xm_side_effect_from_action</a> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L12528' name='L12528'></a> 12528                                       ask_action_list[0]);
<a id='L12529' name='L12529'></a> 12529 
<a id='L12530' name='L12530'></a> 12530       <a href='../S/2188.html#L3540' title='Defined at 3540 in src/eval.c.'>record_unwind_protect</a> (<a href='../S/2289.html#L12322' title='Defined at 12322 in src/xterm.c.'>x_dnd_delete_action_list</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>);
<a id='L12531' name='L12531'></a> 12531 
<a id='L12532' name='L12532'></a> 12532       ask_actions = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L12533' name='L12533'></a> 12533       end = 0;
<a id='L12534' name='L12534'></a> 12534       count = <a href='../D/5888.html' title='Multiple defined in 2 places.'>SPECPDL_INDEX</a> ();
<a id='L12535' name='L12535'></a> 12535 
<a id='L12536' name='L12536'></a> 12536       <strong class='reserved'>for</strong> (i = 0; i &lt; n_ask_actions; ++i)
<a id='L12537' name='L12537'></a> 12537         <em class='brace'>{</em>
<a id='L12538' name='L12538'></a> 12538           fill = end;
<a id='L12539' name='L12539'></a> 12539           end += strlen (ask_action_names[i]) + 1;
<a id='L12540' name='L12540'></a> 12540 
<a id='L12541' name='L12541'></a> 12541           <strong class='reserved'>if</strong> (ask_actions)
<a id='L12542' name='L12542'></a> 12542             ask_actions = <a href='../D/20107.html' title='Multiple defined in 7 places.'>xrealloc</a> (ask_actions, end);
<a id='L12543' name='L12543'></a> 12543           <strong class='reserved'>else</strong>
<a id='L12544' name='L12544'></a> 12544             ask_actions = <a href='../D/20068.html' title='Multiple defined in 10 places.'>xmalloc</a> (end);
<a id='L12545' name='L12545'></a> 12545 
<a id='L12546' name='L12546'></a> 12546           strncpy (ask_actions + fill,
<a id='L12547' name='L12547'></a> 12547                    ask_action_names[i],
<a id='L12548' name='L12548'></a> 12548                    end - fill);
<a id='L12549' name='L12549'></a> 12549         <em class='brace'>}</em>
<a id='L12550' name='L12550'></a> 12550 
<a id='L12551' name='L12551'></a> 12551       prop.<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a> = (<strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *) ask_actions;
<a id='L12552' name='L12552'></a> 12552       prop.encoding = XA_STRING;
<a id='L12553' name='L12553'></a> 12553       prop.format = 8;
<a id='L12554' name='L12554'></a> 12554       prop.nitems = end;
<a id='L12555' name='L12555'></a> 12555 
<a id='L12556' name='L12556'></a> 12556       <a href='../S/2188.html#L3559' title='Defined at 3559 in src/eval.c.'>record_unwind_protect_ptr</a> (<a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a>, ask_actions);
<a id='L12557' name='L12557'></a> 12557 
<a id='L12558' name='L12558'></a> 12558       <em class='comment'>/* This can potentially store a lot of data in window</em>
<a id='L12559' name='L12559'></a> 12559 <em class='comment'>         properties, so check for allocation errors.  */</em>
<a id='L12560' name='L12560'></a> 12560       <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L12561' name='L12561'></a> 12561       x_catch_errors (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L12562' name='L12562'></a> 12562       XSetTextProperty (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L12563' name='L12563'></a> 12563                         &amp;prop, <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;Xatom_XdndActionDescription);
<a id='L12564' name='L12564'></a> 12564 
<a id='L12565' name='L12565'></a> 12565       XChangeProperty (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L12566' name='L12566'></a> 12566                        <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;Xatom_XdndActionList, XA_ATOM, 32,
<a id='L12567' name='L12567'></a> 12567                        PropModeReplace, (<strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *) ask_action_list,
<a id='L12568' name='L12568'></a> 12568                        n_ask_actions);
<a id='L12569' name='L12569'></a> 12569       x_check_errors (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L12570' name='L12570'></a> 12570                       "Can't set action descriptions: %s");
<a id='L12571' name='L12571'></a> 12571       x_uncatch_errors_after_check ();
<a id='L12572' name='L12572'></a> 12572       <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L12573' name='L12573'></a> 12573 
<a id='L12574' name='L12574'></a> 12574       <a href='../S/2188.html#L3757' title='Defined at 3757 in src/eval.c.'>unbind_to</a> (count, Qnil);
<a id='L12575' name='L12575'></a> 12575     <em class='brace'>}</em>
<a id='L12576' name='L12576'></a> 12576 
<a id='L12577' name='L12577'></a> 12577   <a href='../S/2188.html#L3608' title='Defined at 3608 in src/eval.c.'>record_unwind_protect_void</a> (<a href='../S/2289.html#L4749' title='Defined at 4749 in src/xterm.c.'>x_clear_dnd_variables</a>);
<a id='L12578' name='L12578'></a> 12578 
<a id='L12579' name='L12579'></a> 12579   <strong class='reserved'>if</strong> (follow_tooltip)
<a id='L12580' name='L12580'></a> 12580     <em class='brace'>{</em>
<a id='L12581' name='L12581'></a> 12581 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XRANDR || <strong class='reserved'>defined</strong> USE_GTK
<a id='L12582' name='L12582'></a> 12582       x_dnd_monitors
<a id='L12583' name='L12583'></a> 12583         = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;last_monitor_attributes_list;
<a id='L12584' name='L12584'></a> 12584 
<a id='L12585' name='L12585'></a> 12585       <strong class='reserved'>if</strong> (<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (x_dnd_monitors))
<a id='L12586' name='L12586'></a> 12586 <em class='sharp'>#endif</em>
<a id='L12587' name='L12587'></a> 12587         x_dnd_monitors
<a id='L12588' name='L12588'></a> 12588           = Fx_display_monitor_attributes_list (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>);
<a id='L12589' name='L12589'></a> 12589     <em class='brace'>}</em>
<a id='L12590' name='L12590'></a> 12590 
<a id='L12591' name='L12591'></a> 12591   x_dnd_update_tooltip = follow_tooltip;
<a id='L12592' name='L12592'></a> 12592 
<a id='L12593' name='L12593'></a> 12593   <em class='comment'>/* This shouldn't happen.  */</em>
<a id='L12594' name='L12594'></a> 12594   <strong class='reserved'>if</strong> (x_dnd_toplevels)
<a id='L12595' name='L12595'></a> 12595     <a href='../S/2289.html#L2918' title='Defined at 2918 in src/xterm.c.'>x_dnd_free_toplevels</a> (<a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L12596' name='L12596'></a> 12596 
<a id='L12597' name='L12597'></a> 12597 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L12598' name='L12598'></a> 12598   <em class='comment'>/* Prevent GTK+ timeouts from being run, since they can call</em>
<a id='L12599' name='L12599'></a> 12599 <em class='comment'>     handle_one_xevent behind our back.  */</em>
<a id='L12600' name='L12600'></a> 12600   <a href='../S/2119.html#L78' title='Defined at 78 in src/xgselect.c.'>suppress_xg_select</a> ();
<a id='L12601' name='L12601'></a> 12601   <a href='../S/2188.html#L3608' title='Defined at 3608 in src/eval.c.'>record_unwind_protect_void</a> (<a href='../S/2119.html#L84' title='Defined at 84 in src/xgselect.c.'>release_xg_select</a>);
<a id='L12602' name='L12602'></a> 12602 <em class='sharp'>#endif</em>
<a id='L12603' name='L12603'></a> 12603 
<a id='L12604' name='L12604'></a> 12604   <em class='comment'>/* Set up a meaningless alias.  */</em>
<a id='L12605' name='L12605'></a> 12605   <a href='../S/2267.html#L1528' title='Defined at 1528 in src/lisp.h.'>XSETCAR</a> (x_dnd_selection_alias_cell, QSECONDARY);
<a id='L12606' name='L12606'></a> 12606   <a href='../D/7333.html' title='Multiple defined in 2 places.'>XSETCDR</a> (x_dnd_selection_alias_cell, QSECONDARY);
<a id='L12607' name='L12607'></a> 12607 
<a id='L12608' name='L12608'></a> 12608   <em class='comment'>/* Bind this here.  The cell doesn't actually alias between</em>
<a id='L12609' name='L12609'></a> 12609 <em class='comment'>     anything until `xm_setup_dnd_targets' is called.  */</em>
<a id='L12610' name='L12610'></a> 12610   <a href='../S/2188.html#L3480' title='Defined at 3480 in src/eval.c.'>specbind</a> (Qx_selection_alias_alist,
<a id='L12611' name='L12611'></a> 12611             Fcons (x_dnd_selection_alias_cell,
<a id='L12612' name='L12612'></a> 12612                    Vx_selection_alias_alist));
<a id='L12613' name='L12613'></a> 12613 
<a id='L12614' name='L12614'></a> 12614   <em class='comment'>/* Initialize most of the state for the drag-and-drop operation.  */</em>
<a id='L12615' name='L12615'></a> 12615   x_dnd_in_progress = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L12616' name='L12616'></a> 12616   x_dnd_recursion_depth = command_loop_level + minibuf_level;
<a id='L12617' name='L12617'></a> 12617   x_dnd_frame = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L12618' name='L12618'></a> 12618   x_dnd_last_seen_window = None;
<a id='L12619' name='L12619'></a> 12619   x_dnd_last_seen_toplevel = None;
<a id='L12620' name='L12620'></a> 12620   x_dnd_last_protocol_version = -1;
<a id='L12621' name='L12621'></a> 12621   x_dnd_last_window_is_frame = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L12622' name='L12622'></a> 12622   x_dnd_last_motif_style = <a href='../S/2289.html#L1740' title='Defined at 1740 in src/xterm.c.'>XM_DRAG_STYLE_NONE</a>;
<a id='L12623' name='L12623'></a> 12623   x_dnd_mouse_rect_target = None;
<a id='L12624' name='L12624'></a> 12624   x_dnd_action = None;
<a id='L12625' name='L12625'></a> 12625   x_dnd_action_symbol = Qnil;
<a id='L12626' name='L12626'></a> 12626   x_dnd_wanted_action = xaction;
<a id='L12627' name='L12627'></a> 12627   x_dnd_return_frame = 0;
<a id='L12628' name='L12628'></a> 12628   x_dnd_waiting_for_finish = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L12629' name='L12629'></a> 12629   x_dnd_waiting_for_motif_finish = 0;
<a id='L12630' name='L12630'></a> 12630   x_dnd_waiting_for_status_window = None;
<a id='L12631' name='L12631'></a> 12631   x_dnd_pending_send_position.type = 0;
<a id='L12632' name='L12632'></a> 12632   x_dnd_xm_use_help = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L12633' name='L12633'></a> 12633   x_dnd_motif_setup_p = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L12634' name='L12634'></a> 12634   x_dnd_end_window = None;
<a id='L12635' name='L12635'></a> 12635   x_dnd_run_unsupported_drop_function = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L12636' name='L12636'></a> 12636   x_dnd_use_toplevels
<a id='L12637' name='L12637'></a> 12637     = x_wm_supports (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;Xatom_net_client_list_stacking);
<a id='L12638' name='L12638'></a> 12638   x_dnd_last_tooltip_valid = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L12639' name='L12639'></a> 12639   x_dnd_toplevels = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L12640' name='L12640'></a> 12640   x_dnd_allow_current_frame = allow_current_frame;
<a id='L12641' name='L12641'></a> 12641   x_dnd_movement_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L12642' name='L12642'></a> 12642   x_dnd_wheel_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L12643' name='L12643'></a> 12643   x_dnd_init_type_lists = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L12644' name='L12644'></a> 12644   x_dnd_need_send_drop = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L12645' name='L12645'></a> 12645 
<a id='L12646' name='L12646'></a> 12646 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L12647' name='L12647'></a> 12647 
<a id='L12648' name='L12648'></a> 12648   <strong class='reserved'>if</strong> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;supports_xi2)
<a id='L12649' name='L12649'></a> 12649     <em class='brace'>{</em>
<a id='L12650' name='L12650'></a> 12650       <em class='comment'>/* Only accept input from the last master pointer to have interacted</em>
<a id='L12651' name='L12651'></a> 12651 <em class='comment'>         with Emacs.  This prevents another pointer device getting our</em>
<a id='L12652' name='L12652'></a> 12652 <em class='comment'>         idea of the button state messed up.  */</em>
<a id='L12653' name='L12653'></a> 12653       <strong class='reserved'>if</strong> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;client_pointer_device != -1)
<a id='L12654' name='L12654'></a> 12654         x_dnd_pointer_device
<a id='L12655' name='L12655'></a> 12655           = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;client_pointer_device;
<a id='L12656' name='L12656'></a> 12656       <strong class='reserved'>else</strong>
<a id='L12657' name='L12657'></a> 12657         <em class='comment'>/* This returns Bool but cannot actually fail.  */</em>
<a id='L12658' name='L12658'></a> 12658         XIGetClientPointer (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), None,
<a id='L12659' name='L12659'></a> 12659                             &amp;x_dnd_pointer_device);
<a id='L12660' name='L12660'></a> 12660 
<a id='L12661' name='L12661'></a> 12661       x_dnd_keyboard_device = -1;
<a id='L12662' name='L12662'></a> 12662 
<a id='L12663' name='L12663'></a> 12663       device = <a href='../S/2289.html#L5732' title='Defined at 5732 in src/xterm.c.'>xi_device_from_id</a> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L12664' name='L12664'></a> 12664                                   x_dnd_pointer_device);
<a id='L12665' name='L12665'></a> 12665 
<a id='L12666' name='L12666'></a> 12666       <strong class='reserved'>if</strong> (device)
<a id='L12667' name='L12667'></a> 12667         x_dnd_keyboard_device = device-&gt;attachment;
<a id='L12668' name='L12668'></a> 12668     <em class='brace'>}</em>
<a id='L12669' name='L12669'></a> 12669   <strong class='reserved'>else</strong>
<a id='L12670' name='L12670'></a> 12670     <em class='brace'>{</em>
<a id='L12671' name='L12671'></a> 12671       x_dnd_pointer_device = -1;
<a id='L12672' name='L12672'></a> 12672       x_dnd_keyboard_device = -1;
<a id='L12673' name='L12673'></a> 12673     <em class='brace'>}</em>
<a id='L12674' name='L12674'></a> 12674 
<a id='L12675' name='L12675'></a> 12675 <em class='sharp'>#endif</em>
<a id='L12676' name='L12676'></a> 12676 
<a id='L12677' name='L12677'></a> 12677 <em class='sharp'>#ifdef</em> HAVE_XKB
<a id='L12678' name='L12678'></a> 12678   x_dnd_keyboard_state = 0;
<a id='L12679' name='L12679'></a> 12679 
<a id='L12680' name='L12680'></a> 12680   <strong class='reserved'>if</strong> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;supports_xkb)
<a id='L12681' name='L12681'></a> 12681     <em class='brace'>{</em>
<a id='L12682' name='L12682'></a> 12682       XkbSelectEvents (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), XkbUseCoreKbd,
<a id='L12683' name='L12683'></a> 12683                        XkbStateNotifyMask, XkbStateNotifyMask);
<a id='L12684' name='L12684'></a> 12684       XkbGetState (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), XkbUseCoreKbd,
<a id='L12685' name='L12685'></a> 12685                    &amp;keyboard_state);
<a id='L12686' name='L12686'></a> 12686 
<a id='L12687' name='L12687'></a> 12687       x_dnd_keyboard_state = (keyboard_state.mods
<a id='L12688' name='L12688'></a> 12688                               | keyboard_state.ptr_buttons);
<a id='L12689' name='L12689'></a> 12689     <em class='brace'>}</em>
<a id='L12690' name='L12690'></a> 12690 <em class='sharp'>#endif</em>
<a id='L12691' name='L12691'></a> 12691 
<a id='L12692' name='L12692'></a> 12692   <strong class='reserved'>if</strong> (x_dnd_use_toplevels)
<a id='L12693' name='L12693'></a> 12693     <em class='brace'>{</em>
<a id='L12694' name='L12694'></a> 12694       <strong class='reserved'>if</strong> (<a href='../S/2289.html#L3015' title='Defined at 3015 in src/xterm.c.'>x_dnd_compute_toplevels</a> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)))
<a id='L12695' name='L12695'></a> 12695         <em class='brace'>{</em>
<a id='L12696' name='L12696'></a> 12696           <a href='../S/2289.html#L2918' title='Defined at 2918 in src/xterm.c.'>x_dnd_free_toplevels</a> (<a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L12697' name='L12697'></a> 12697           x_dnd_use_toplevels = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L12698' name='L12698'></a> 12698         <em class='brace'>}</em>
<a id='L12699' name='L12699'></a> 12699       <strong class='reserved'>else</strong>
<a id='L12700' name='L12700'></a> 12700         <a href='../S/2188.html#L3608' title='Defined at 3608 in src/eval.c.'>record_unwind_protect_void</a> (<a href='../S/2289.html#L4756' title='Defined at 4756 in src/xterm.c.'>x_free_dnd_toplevels</a>);
<a id='L12701' name='L12701'></a> 12701     <em class='brace'>}</em>
<a id='L12702' name='L12702'></a> 12702 
<a id='L12703' name='L12703'></a> 12703   <strong class='reserved'>if</strong> (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (return_frame))
<a id='L12704' name='L12704'></a> 12704     x_dnd_return_frame = 1;
<a id='L12705' name='L12705'></a> 12705 
<a id='L12706' name='L12706'></a> 12706   <strong class='reserved'>if</strong> (<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (return_frame, Qnow))
<a id='L12707' name='L12707'></a> 12707     x_dnd_return_frame = 2;
<a id='L12708' name='L12708'></a> 12708 
<a id='L12709' name='L12709'></a> 12709   <em class='comment'>/* Now select for SubstructureNotifyMask and PropertyChangeMask on</em>
<a id='L12710' name='L12710'></a> 12710 <em class='comment'>     the root window, so we can get notified when window stacking</em>
<a id='L12711' name='L12711'></a> 12711 <em class='comment'>     changes, a common operation during drag-and-drop.  */</em>
<a id='L12712' name='L12712'></a> 12712 
<a id='L12713' name='L12713'></a> 12713   XGetWindowAttributes (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L12714' name='L12714'></a> 12714                         <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;root_window,
<a id='L12715' name='L12715'></a> 12715                         &amp;root_window_attrs);
<a id='L12716' name='L12716'></a> 12716 
<a id='L12717' name='L12717'></a> 12717   additional_mask = SubstructureNotifyMask;
<a id='L12718' name='L12718'></a> 12718 
<a id='L12719' name='L12719'></a> 12719   <strong class='reserved'>if</strong> (x_dnd_use_toplevels)
<a id='L12720' name='L12720'></a> 12720     additional_mask |= PropertyChangeMask;
<a id='L12721' name='L12721'></a> 12721 
<a id='L12722' name='L12722'></a> 12722   XSelectInput (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L12723' name='L12723'></a> 12723                 <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;root_window,
<a id='L12724' name='L12724'></a> 12724                 root_window_attrs.your_event_mask
<a id='L12725' name='L12725'></a> 12725                 | additional_mask);
<a id='L12726' name='L12726'></a> 12726 
<a id='L12727' name='L12727'></a> 12727   <strong class='reserved'>if</strong> (<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (return_frame, Qnow))
<a id='L12728' name='L12728'></a> 12728     x_dnd_update_state (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), CurrentTime);
<a id='L12729' name='L12729'></a> 12729 
<a id='L12730' name='L12730'></a> 12730   <strong class='reserved'>while</strong> (x_dnd_in_progress || x_dnd_waiting_for_finish)
<a id='L12731' name='L12731'></a> 12731     <em class='brace'>{</em>
<a id='L12732' name='L12732'></a> 12732       <a href='../S/2231.html#L393' title='Defined at 393 in src/termhooks.h.'>EVENT_INIT</a> (hold_quit);
<a id='L12733' name='L12733'></a> 12733 
<a id='L12734' name='L12734'></a> 12734 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L12735' name='L12735'></a> 12735       current_finish = <a href='../S/2289.html#L1134' title='Defined at 1134 in src/xterm.c.'>X_EVENT_NORMAL</a>;
<a id='L12736' name='L12736'></a> 12736       current_hold_quit = &amp;hold_quit;
<a id='L12737' name='L12737'></a> 12737       current_count = 0;
<a id='L12738' name='L12738'></a> 12738       xg_pending_quit_event.kind = <a href='../S/2231.html#L74' title='Defined at 74 in src/termhooks.h.'>NO_EVENT</a>;
<a id='L12739' name='L12739'></a> 12739 <em class='sharp'>#endif</em>
<a id='L12740' name='L12740'></a> 12740 
<a id='L12741' name='L12741'></a> 12741       <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L12742' name='L12742'></a> 12742       x_dnd_inside_handle_one_xevent = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L12743' name='L12743'></a> 12743 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L12744' name='L12744'></a> 12744       gtk_main_iteration ();
<a id='L12745' name='L12745'></a> 12745 <em class='sharp'>#elif</em> <strong class='reserved'>defined</strong> USE_X_TOOLKIT
<a id='L12746' name='L12746'></a> 12746       XtAppNextEvent (Xt_app_con, &amp;next_event);
<a id='L12747' name='L12747'></a> 12747 <em class='sharp'>#else</em>
<a id='L12748' name='L12748'></a> 12748       <a href='../S/2289.html#L12220' title='Defined at 12220 in src/xterm.c.'>x_next_event_from_any_display</a> (&amp;next_event);
<a id='L12749' name='L12749'></a> 12749 <em class='sharp'>#endif</em>
<a id='L12750' name='L12750'></a> 12750 
<a id='L12751' name='L12751'></a> 12751 <em class='sharp'>#ifndef</em> USE_GTK
<a id='L12752' name='L12752'></a> 12752       event_display
<a id='L12753' name='L12753'></a> 12753         = <a href='../S/2289.html#L6774' title='Defined at 6774 in src/xterm.c.'>x_display_info_for_display</a> (next_event.xany.<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L12754' name='L12754'></a> 12754 
<a id='L12755' name='L12755'></a> 12755       <strong class='reserved'>if</strong> (event_display)
<a id='L12756' name='L12756'></a> 12756         <em class='brace'>{</em>
<a id='L12757' name='L12757'></a> 12757 <em class='sharp'>#ifdef</em> HAVE_X_I18N
<a id='L12758' name='L12758'></a> 12758 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L12759' name='L12759'></a> 12759           <strong class='reserved'>if</strong> (next_event.type != GenericEvent
<a id='L12760' name='L12760'></a> 12760               || !event_display-&gt;supports_xi2
<a id='L12761' name='L12761'></a> 12761               || (next_event.xgeneric.extension
<a id='L12762' name='L12762'></a> 12762                   != event_display-&gt;xi2_opcode))
<a id='L12763' name='L12763'></a> 12763             <em class='brace'>{</em>
<a id='L12764' name='L12764'></a> 12764 <em class='sharp'>#endif</em>
<a id='L12765' name='L12765'></a> 12765               <strong class='reserved'>if</strong> (!x_filter_event (event_display, &amp;next_event))
<a id='L12766' name='L12766'></a> 12766                 handle_one_xevent (event_display,
<a id='L12767' name='L12767'></a> 12767                                    &amp;next_event, &amp;finish, &amp;hold_quit);
<a id='L12768' name='L12768'></a> 12768 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L12769' name='L12769'></a> 12769             <em class='brace'>}</em>
<a id='L12770' name='L12770'></a> 12770           <strong class='reserved'>else</strong>
<a id='L12771' name='L12771'></a> 12771             handle_one_xevent (event_display,
<a id='L12772' name='L12772'></a> 12772                                &amp;next_event, &amp;finish, &amp;hold_quit);
<a id='L12773' name='L12773'></a> 12773 <em class='sharp'>#endif</em>
<a id='L12774' name='L12774'></a> 12774 <em class='sharp'>#else</em>
<a id='L12775' name='L12775'></a> 12775           handle_one_xevent (event_display,
<a id='L12776' name='L12776'></a> 12776                              &amp;next_event, &amp;finish, &amp;hold_quit);
<a id='L12777' name='L12777'></a> 12777 <em class='sharp'>#endif</em>
<a id='L12778' name='L12778'></a> 12778         <em class='brace'>}</em>
<a id='L12779' name='L12779'></a> 12779 <em class='sharp'>#else</em>
<a id='L12780' name='L12780'></a> 12780       <em class='comment'>/* Clear these before the read_socket_hook can be called.  */</em>
<a id='L12781' name='L12781'></a> 12781       current_count = -1;
<a id='L12782' name='L12782'></a> 12782       current_hold_quit = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L12783' name='L12783'></a> 12783 <em class='sharp'>#endif</em>
<a id='L12784' name='L12784'></a> 12784       x_dnd_inside_handle_one_xevent = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L12785' name='L12785'></a> 12785 
<a id='L12786' name='L12786'></a> 12786       <em class='comment'>/* Clean up any event handlers that are now out of date.  */</em>
<a id='L12787' name='L12787'></a> 12787       x_clean_failable_requests (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L12788' name='L12788'></a> 12788 
<a id='L12789' name='L12789'></a> 12789       <em class='comment'>/* The unblock_input below might try to read input, but</em>
<a id='L12790' name='L12790'></a> 12790 <em class='comment'>         XTread_socket does nothing inside a drag-and-drop event</em>
<a id='L12791' name='L12791'></a> 12791 <em class='comment'>         loop, so don't let it clear the pending_signals flag.  */</em>
<a id='L12792' name='L12792'></a> 12792       signals_were_pending = pending_signals;
<a id='L12793' name='L12793'></a> 12793       <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L12794' name='L12794'></a> 12794       pending_signals = signals_were_pending;
<a id='L12795' name='L12795'></a> 12795 
<a id='L12796' name='L12796'></a> 12796       <em class='comment'>/* Ignore mouse movement from displays that aren't the DND</em>
<a id='L12797' name='L12797'></a> 12797 <em class='comment'>         display.  */</em>
<a id='L12798' name='L12798'></a> 12798 <em class='sharp'>#ifndef</em> USE_GTK
<a id='L12799' name='L12799'></a> 12799       <strong class='reserved'>if</strong> (event_display == <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L12800' name='L12800'></a> 12800         <em class='brace'>{</em>
<a id='L12801' name='L12801'></a> 12801 <em class='sharp'>#endif</em>
<a id='L12802' name='L12802'></a> 12802           <strong class='reserved'>if</strong> (x_dnd_movement_frame
<a id='L12803' name='L12803'></a> 12803               <em class='comment'>/* FIXME: how come this can end up with movement frames</em>
<a id='L12804' name='L12804'></a> 12804 <em class='comment'>                 from other displays on GTK builds?  */</em>
<a id='L12805' name='L12805'></a> 12805               &amp;&amp; (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (x_dnd_movement_frame)
<a id='L12806' name='L12806'></a> 12806                   == <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L12807' name='L12807'></a> 12807               <em class='comment'>/* If both those variables are false, then F is no</em>
<a id='L12808' name='L12808'></a> 12808 <em class='comment'>                 longer protected from deletion by Lisp code.  This</em>
<a id='L12809' name='L12809'></a> 12809 <em class='comment'>                 can only happen during the final iteration of the DND</em>
<a id='L12810' name='L12810'></a> 12810 <em class='comment'>                 event loop.  */</em>
<a id='L12811' name='L12811'></a> 12811               &amp;&amp; (x_dnd_in_progress || x_dnd_waiting_for_finish))
<a id='L12812' name='L12812'></a> 12812             <em class='brace'>{</em>
<a id='L12813' name='L12813'></a> 12813               <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (frame_object, x_dnd_movement_frame);
<a id='L12814' name='L12814'></a> 12814               <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, x_dnd_movement_x);
<a id='L12815' name='L12815'></a> 12815               <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (y, x_dnd_movement_y);
<a id='L12816' name='L12816'></a> 12816               x_dnd_movement_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L12817' name='L12817'></a> 12817 
<a id='L12818' name='L12818'></a> 12818               <strong class='reserved'>if</strong> (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (Vx_dnd_movement_function)
<a id='L12819' name='L12819'></a> 12819                   &amp;&amp; <a href='../S/2183.html#L1028' title='Defined at 1028 in src/frame.h.'>FRAME_LIVE_P</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (frame_object))
<a id='L12820' name='L12820'></a> 12820                   &amp;&amp; !<a href='../D/2425.html' title='Multiple defined in 2 places.'>FRAME_TOOLTIP_P</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (frame_object))
<a id='L12821' name='L12821'></a> 12821                   &amp;&amp; x_dnd_movement_x &gt;= 0
<a id='L12822' name='L12822'></a> 12822                   &amp;&amp; x_dnd_movement_y &gt;= 0
<a id='L12823' name='L12823'></a> 12823                   &amp;&amp; x_dnd_frame
<a id='L12824' name='L12824'></a> 12824                   &amp;&amp; (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (frame_object) != x_dnd_frame
<a id='L12825' name='L12825'></a> 12825                       || x_dnd_allow_current_frame))
<a id='L12826' name='L12826'></a> 12826                 <em class='brace'>{</em>
<a id='L12827' name='L12827'></a> 12827                   x_dnd_old_window_attrs = root_window_attrs;
<a id='L12828' name='L12828'></a> 12828                   x_dnd_unwind_flag = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L12829' name='L12829'></a> 12829 
<a id='L12830' name='L12830'></a> 12830                   <a href='../S/3345.html#L35' title='Defined at 35 in test/lisp/cedet/semantic-utest-ia-resources/testtemplates.cpp.'>ref</a> = <a href='../D/5888.html' title='Multiple defined in 2 places.'>SPECPDL_INDEX</a> ();
<a id='L12831' name='L12831'></a> 12831                   <a href='../S/2188.html#L3559' title='Defined at 3559 in src/eval.c.'>record_unwind_protect_ptr</a> (<a href='../S/2289.html#L4858' title='Defined at 4858 in src/xterm.c.'>x_dnd_cleanup_drag_and_drop</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L12832' name='L12832'></a> 12832                   <a href='../S/2267.html#L3249' title='Defined at 3249 in src/lisp.h.'>call2</a> (Vx_dnd_movement_function, frame_object,
<a id='L12833' name='L12833'></a> 12833                          Fposn_at_x_y (<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, frame_object, Qnil));
<a id='L12834' name='L12834'></a> 12834                   x_dnd_unwind_flag = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L12835' name='L12835'></a> 12835                   <a href='../S/2188.html#L3757' title='Defined at 3757 in src/eval.c.'>unbind_to</a> (<a href='../S/3345.html#L35' title='Defined at 35 in test/lisp/cedet/semantic-utest-ia-resources/testtemplates.cpp.'>ref</a>, Qnil);
<a id='L12836' name='L12836'></a> 12836 
<a id='L12837' name='L12837'></a> 12837                   <em class='comment'>/* Redisplay this way to preserve the echo area.</em>
<a id='L12838' name='L12838'></a> 12838 <em class='comment'>                     Otherwise, the contents will abruptly disappear</em>
<a id='L12839' name='L12839'></a> 12839 <em class='comment'>                     when the mouse moves over a frame.  */</em>
<a id='L12840' name='L12840'></a> 12840                   <a href='../S/2224.html#L17480' title='Defined at 17480 in src/xdisp.c.'>redisplay_preserve_echo_area</a> (33);
<a id='L12841' name='L12841'></a> 12841                 <em class='brace'>}</em>
<a id='L12842' name='L12842'></a> 12842             <em class='brace'>}</em>
<a id='L12843' name='L12843'></a> 12843 
<a id='L12844' name='L12844'></a> 12844           <strong class='reserved'>if</strong> (x_dnd_wheel_frame
<a id='L12845' name='L12845'></a> 12845               &amp;&amp; (x_dnd_in_progress || x_dnd_waiting_for_finish))
<a id='L12846' name='L12846'></a> 12846             <em class='brace'>{</em>
<a id='L12847' name='L12847'></a> 12847               <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (frame_object, x_dnd_wheel_frame);
<a id='L12848' name='L12848'></a> 12848               <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, x_dnd_wheel_x);
<a id='L12849' name='L12849'></a> 12849               <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (y, x_dnd_wheel_y);
<a id='L12850' name='L12850'></a> 12850               x_dnd_wheel_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L12851' name='L12851'></a> 12851 
<a id='L12852' name='L12852'></a> 12852               <strong class='reserved'>if</strong> (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (Vx_dnd_wheel_function)
<a id='L12853' name='L12853'></a> 12853                   &amp;&amp; <a href='../S/2183.html#L1028' title='Defined at 1028 in src/frame.h.'>FRAME_LIVE_P</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (frame_object))
<a id='L12854' name='L12854'></a> 12854                   &amp;&amp; !<a href='../D/2425.html' title='Multiple defined in 2 places.'>FRAME_TOOLTIP_P</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (frame_object))
<a id='L12855' name='L12855'></a> 12855                   &amp;&amp; x_dnd_movement_x &gt;= 0
<a id='L12856' name='L12856'></a> 12856                   &amp;&amp; x_dnd_movement_y &gt;= 0
<a id='L12857' name='L12857'></a> 12857                   &amp;&amp; x_dnd_frame
<a id='L12858' name='L12858'></a> 12858                   &amp;&amp; (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (frame_object) != x_dnd_frame
<a id='L12859' name='L12859'></a> 12859                       || x_dnd_allow_current_frame))
<a id='L12860' name='L12860'></a> 12860                 <em class='brace'>{</em>
<a id='L12861' name='L12861'></a> 12861                   x_dnd_old_window_attrs = root_window_attrs;
<a id='L12862' name='L12862'></a> 12862                   x_dnd_unwind_flag = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L12863' name='L12863'></a> 12863 
<a id='L12864' name='L12864'></a> 12864                   <a href='../S/3345.html#L35' title='Defined at 35 in test/lisp/cedet/semantic-utest-ia-resources/testtemplates.cpp.'>ref</a> = <a href='../D/5888.html' title='Multiple defined in 2 places.'>SPECPDL_INDEX</a> ();
<a id='L12865' name='L12865'></a> 12865                   <a href='../S/2188.html#L3559' title='Defined at 3559 in src/eval.c.'>record_unwind_protect_ptr</a> (<a href='../S/2289.html#L4858' title='Defined at 4858 in src/xterm.c.'>x_dnd_cleanup_drag_and_drop</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L12866' name='L12866'></a> 12866                   <a href='../S/2267.html#L3263' title='Defined at 3263 in src/lisp.h.'>call4</a> (Vx_dnd_wheel_function,
<a id='L12867' name='L12867'></a> 12867                          Fposn_at_x_y (<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, frame_object, Qnil),
<a id='L12868' name='L12868'></a> 12868                          <a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (x_dnd_wheel_button),
<a id='L12869' name='L12869'></a> 12869                          <a href='../S/2267.html#L2807' title='Defined at 2807 in src/lisp.h.'>make_uint</a> (x_dnd_wheel_state),
<a id='L12870' name='L12870'></a> 12870                          <a href='../S/2267.html#L2807' title='Defined at 2807 in src/lisp.h.'>make_uint</a> (x_dnd_wheel_time));
<a id='L12871' name='L12871'></a> 12871                   x_dnd_unwind_flag = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L12872' name='L12872'></a> 12872                   <a href='../S/2188.html#L3757' title='Defined at 3757 in src/eval.c.'>unbind_to</a> (<a href='../S/3345.html#L35' title='Defined at 35 in test/lisp/cedet/semantic-utest-ia-resources/testtemplates.cpp.'>ref</a>, Qnil);
<a id='L12873' name='L12873'></a> 12873 
<a id='L12874' name='L12874'></a> 12874                   <em class='comment'>/* Redisplay this way to preserve the echo area.</em>
<a id='L12875' name='L12875'></a> 12875 <em class='comment'>                     Otherwise, the contents will abruptly disappear</em>
<a id='L12876' name='L12876'></a> 12876 <em class='comment'>                     when the mouse moves over a frame.  */</em>
<a id='L12877' name='L12877'></a> 12877                   <a href='../S/2224.html#L17480' title='Defined at 17480 in src/xdisp.c.'>redisplay_preserve_echo_area</a> (33);
<a id='L12878' name='L12878'></a> 12878                 <em class='brace'>}</em>
<a id='L12879' name='L12879'></a> 12879             <em class='brace'>}</em>
<a id='L12880' name='L12880'></a> 12880 
<a id='L12881' name='L12881'></a> 12881           <strong class='reserved'>if</strong> (hold_quit.kind != <a href='../S/2231.html#L74' title='Defined at 74 in src/termhooks.h.'>NO_EVENT</a>)
<a id='L12882' name='L12882'></a> 12882             <em class='brace'>{</em>
<a id='L12883' name='L12883'></a> 12883               <a href='../S/2289.html#L12361' title='Defined at 12361 in src/xterm.c.'>x_dnd_process_quit</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, hold_quit.timestamp);
<a id='L12884' name='L12884'></a> 12884 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L12885' name='L12885'></a> 12885               current_hold_quit = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L12886' name='L12886'></a> 12886 <em class='sharp'>#endif</em>
<a id='L12887' name='L12887'></a> 12887               <em class='comment'>/* Restore the old event mask.  */</em>
<a id='L12888' name='L12888'></a> 12888               <a href='../S/2289.html#L4770' title='Defined at 4770 in src/xterm.c.'>x_restore_events_after_dnd</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, &amp;root_window_attrs);
<a id='L12889' name='L12889'></a> 12889 
<a id='L12890' name='L12890'></a> 12890               <em class='comment'>/* Call kbd_buffer_store event, which calls</em>
<a id='L12891' name='L12891'></a> 12891 <em class='comment'>                 handle_interrupt and sets `last-event-frame' along</em>
<a id='L12892' name='L12892'></a> 12892 <em class='comment'>                 with various other things.  */</em>
<a id='L12893' name='L12893'></a> 12893               <a href='../D/13636.html' title='Multiple defined in 2 places.'>kbd_buffer_store_event</a> (&amp;hold_quit);
<a id='L12894' name='L12894'></a> 12894               <em class='comment'>/* Now quit anyway.  */</em>
<a id='L12895' name='L12895'></a> 12895               <a href='../D/15933.html' title='Multiple defined in 2 places.'>quit</a> ();
<a id='L12896' name='L12896'></a> 12896             <em class='brace'>}</em>
<a id='L12897' name='L12897'></a> 12897 
<a id='L12898' name='L12898'></a> 12898           <strong class='reserved'>if</strong> (pending_selection_requests
<a id='L12899' name='L12899'></a> 12899               &amp;&amp; (x_dnd_in_progress || x_dnd_waiting_for_finish))
<a id='L12900' name='L12900'></a> 12900             <em class='brace'>{</em>
<a id='L12901' name='L12901'></a> 12901               x_dnd_old_window_attrs = root_window_attrs;
<a id='L12902' name='L12902'></a> 12902               x_dnd_unwind_flag = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L12903' name='L12903'></a> 12903 
<a id='L12904' name='L12904'></a> 12904               <a href='../S/3345.html#L35' title='Defined at 35 in test/lisp/cedet/semantic-utest-ia-resources/testtemplates.cpp.'>ref</a> = <a href='../D/5888.html' title='Multiple defined in 2 places.'>SPECPDL_INDEX</a> ();
<a id='L12905' name='L12905'></a> 12905               <a href='../S/2188.html#L3559' title='Defined at 3559 in src/eval.c.'>record_unwind_protect_ptr</a> (<a href='../S/2289.html#L4858' title='Defined at 4858 in src/xterm.c.'>x_dnd_cleanup_drag_and_drop</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L12906' name='L12906'></a> 12906               <a href='../S/2289.html#L12284' title='Defined at 12284 in src/xterm.c.'>x_handle_pending_selection_requests</a> ();
<a id='L12907' name='L12907'></a> 12907               x_dnd_unwind_flag = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L12908' name='L12908'></a> 12908               <a href='../S/2188.html#L3757' title='Defined at 3757 in src/eval.c.'>unbind_to</a> (<a href='../S/3345.html#L35' title='Defined at 35 in test/lisp/cedet/semantic-utest-ia-resources/testtemplates.cpp.'>ref</a>, Qnil);
<a id='L12909' name='L12909'></a> 12909             <em class='brace'>}</em>
<a id='L12910' name='L12910'></a> 12910 
<a id='L12911' name='L12911'></a> 12911           <em class='comment'>/* Sometimes C-g can be pressed inside a selection</em>
<a id='L12912' name='L12912'></a> 12912 <em class='comment'>             converter, where quitting is inhibited.  We want</em>
<a id='L12913' name='L12913'></a> 12913 <em class='comment'>             to quit after the converter exits.  */</em>
<a id='L12914' name='L12914'></a> 12914           <strong class='reserved'>if</strong> (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (Vquit_flag) &amp;&amp; !<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (Vinhibit_quit))
<a id='L12915' name='L12915'></a> 12915             <em class='brace'>{</em>
<a id='L12916' name='L12916'></a> 12916               <a href='../S/2289.html#L12361' title='Defined at 12361 in src/xterm.c.'>x_dnd_process_quit</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;last_user_time);
<a id='L12917' name='L12917'></a> 12917 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L12918' name='L12918'></a> 12918               current_hold_quit = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L12919' name='L12919'></a> 12919 <em class='sharp'>#endif</em>
<a id='L12920' name='L12920'></a> 12920               <a href='../S/2289.html#L4770' title='Defined at 4770 in src/xterm.c.'>x_restore_events_after_dnd</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, &amp;root_window_attrs);
<a id='L12921' name='L12921'></a> 12921               <a href='../D/15933.html' title='Multiple defined in 2 places.'>quit</a> ();
<a id='L12922' name='L12922'></a> 12922             <em class='brace'>}</em>
<a id='L12923' name='L12923'></a> 12923 
<a id='L12924' name='L12924'></a> 12924           <strong class='reserved'>if</strong> (x_dnd_run_unsupported_drop_function
<a id='L12925' name='L12925'></a> 12925               &amp;&amp; x_dnd_waiting_for_finish)
<a id='L12926' name='L12926'></a> 12926             <em class='brace'>{</em>
<a id='L12927' name='L12927'></a> 12927               x_dnd_run_unsupported_drop_function = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L12928' name='L12928'></a> 12928               x_dnd_waiting_for_finish = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L12929' name='L12929'></a> 12929               x_dnd_unwind_flag = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L12930' name='L12930'></a> 12930 
<a id='L12931' name='L12931'></a> 12931               <a href='../S/3345.html#L35' title='Defined at 35 in test/lisp/cedet/semantic-utest-ia-resources/testtemplates.cpp.'>ref</a> = <a href='../D/5888.html' title='Multiple defined in 2 places.'>SPECPDL_INDEX</a> ();
<a id='L12932' name='L12932'></a> 12932               <a href='../S/2188.html#L3559' title='Defined at 3559 in src/eval.c.'>record_unwind_protect_ptr</a> (<a href='../S/2289.html#L4858' title='Defined at 4858 in src/xterm.c.'>x_dnd_cleanup_drag_and_drop</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L12933' name='L12933'></a> 12933 
<a id='L12934' name='L12934'></a> 12934               <strong class='reserved'>if</strong> (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (Vx_dnd_unsupported_drop_function))
<a id='L12935' name='L12935'></a> 12935                 val = <a href='../S/2267.html#L3296' title='Defined at 3296 in src/lisp.h.'>call8</a> (Vx_dnd_unsupported_drop_function,
<a id='L12936' name='L12936'></a> 12936                              <a href='../D/7021.html' title='Multiple defined in 2 places.'>XCAR</a> (<a href='../D/7022.html' title='Multiple defined in 2 places.'>XCDR</a> (x_dnd_unsupported_drop_data)),
<a id='L12937' name='L12937'></a> 12937                              Fnth (<a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (3), x_dnd_unsupported_drop_data),
<a id='L12938' name='L12938'></a> 12938                              Fnth (<a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (4), x_dnd_unsupported_drop_data),
<a id='L12939' name='L12939'></a> 12939                              Fnth (<a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (2), x_dnd_unsupported_drop_data),
<a id='L12940' name='L12940'></a> 12940                              <a href='../S/2267.html#L2807' title='Defined at 2807 in src/lisp.h.'>make_uint</a> (x_dnd_unsupported_drop_window),
<a id='L12941' name='L12941'></a> 12941                              <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../S/2267.html#L2807' title='Defined at 2807 in src/lisp.h.'>make_uint</a> (x_dnd_unsupported_drop_time),
<a id='L12942' name='L12942'></a> 12942                              Fcopy_sequence (<a href='../D/7021.html' title='Multiple defined in 2 places.'>XCAR</a> (x_dnd_unsupported_drop_data)));
<a id='L12943' name='L12943'></a> 12943               <strong class='reserved'>else</strong>
<a id='L12944' name='L12944'></a> 12944                 val = Qnil;
<a id='L12945' name='L12945'></a> 12945 
<a id='L12946' name='L12946'></a> 12946               <strong class='reserved'>if</strong> (<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (val))
<a id='L12947' name='L12947'></a> 12947                 <a href='../S/2289.html#L3977' title='Defined at 3977 in src/xterm.c.'>x_dnd_do_unsupported_drop</a> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L12948' name='L12948'></a> 12948                                            <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../D/7021.html' title='Multiple defined in 2 places.'>XCAR</a> (x_dnd_unsupported_drop_data),
<a id='L12949' name='L12949'></a> 12949                                            <a href='../D/7021.html' title='Multiple defined in 2 places.'>XCAR</a> (<a href='../D/7022.html' title='Multiple defined in 2 places.'>XCDR</a> (x_dnd_unsupported_drop_data)),
<a id='L12950' name='L12950'></a> 12950                                            x_dnd_unsupported_drop_window,
<a id='L12951' name='L12951'></a> 12951                                            <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (Fnth (<a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (3),
<a id='L12952' name='L12952'></a> 12952                                                           x_dnd_unsupported_drop_data)),
<a id='L12953' name='L12953'></a> 12953                                            <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (Fnth (<a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (4),
<a id='L12954' name='L12954'></a> 12954                                                           x_dnd_unsupported_drop_data)),
<a id='L12955' name='L12955'></a> 12955                                            x_dnd_unsupported_drop_time);
<a id='L12956' name='L12956'></a> 12956               <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (<a href='../S/4044.html#L397' title='Defined at 397 in test/manual/etags/c-src/emacs/src/lisp.h.'>SYMBOLP</a> (val))
<a id='L12957' name='L12957'></a> 12957                 x_dnd_action_symbol = val;
<a id='L12958' name='L12958'></a> 12958 
<a id='L12959' name='L12959'></a> 12959               x_dnd_unwind_flag = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L12960' name='L12960'></a> 12960               <a href='../S/2188.html#L3757' title='Defined at 3757 in src/eval.c.'>unbind_to</a> (<a href='../S/3345.html#L35' title='Defined at 35 in test/lisp/cedet/semantic-utest-ia-resources/testtemplates.cpp.'>ref</a>, Qnil);
<a id='L12961' name='L12961'></a> 12961 
<a id='L12962' name='L12962'></a> 12962               <em class='comment'>/* Break out of the loop now, since DND has</em>
<a id='L12963' name='L12963'></a> 12963 <em class='comment'>                 completed.  */</em>
<a id='L12964' name='L12964'></a> 12964               <strong class='reserved'>break</strong>;
<a id='L12965' name='L12965'></a> 12965             <em class='brace'>}</em>
<a id='L12966' name='L12966'></a> 12966 
<a id='L12967' name='L12967'></a> 12967 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L12968' name='L12968'></a> 12968           <strong class='reserved'>if</strong> (xg_pending_quit_event.kind != <a href='../S/2231.html#L74' title='Defined at 74 in src/termhooks.h.'>NO_EVENT</a>)
<a id='L12969' name='L12969'></a> 12969             <em class='brace'>{</em>
<a id='L12970' name='L12970'></a> 12970               xg_pending_quit_event.kind = <a href='../S/2231.html#L74' title='Defined at 74 in src/termhooks.h.'>NO_EVENT</a>;
<a id='L12971' name='L12971'></a> 12971               current_hold_quit = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L12972' name='L12972'></a> 12972 
<a id='L12973' name='L12973'></a> 12973               <a href='../S/2289.html#L12361' title='Defined at 12361 in src/xterm.c.'>x_dnd_process_quit</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;last_user_time);
<a id='L12974' name='L12974'></a> 12974               <a href='../S/2289.html#L4770' title='Defined at 4770 in src/xterm.c.'>x_restore_events_after_dnd</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, &amp;root_window_attrs);
<a id='L12975' name='L12975'></a> 12975               <a href='../D/15933.html' title='Multiple defined in 2 places.'>quit</a> ();
<a id='L12976' name='L12976'></a> 12976             <em class='brace'>}</em>
<a id='L12977' name='L12977'></a> 12977 <em class='sharp'>#else</em>
<a id='L12978' name='L12978'></a> 12978         <em class='brace'>}</em>
<a id='L12979' name='L12979'></a> 12979       <strong class='reserved'>else</strong>
<a id='L12980' name='L12980'></a> 12980         <em class='brace'>{</em>
<a id='L12981' name='L12981'></a> 12981           <strong class='reserved'>if</strong> (x_dnd_movement_frame)
<a id='L12982' name='L12982'></a> 12982             x_dnd_movement_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L12983' name='L12983'></a> 12983 
<a id='L12984' name='L12984'></a> 12984           <strong class='reserved'>if</strong> (x_dnd_wheel_frame)
<a id='L12985' name='L12985'></a> 12985             x_dnd_wheel_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L12986' name='L12986'></a> 12986 
<a id='L12987' name='L12987'></a> 12987           <strong class='reserved'>if</strong> (hold_quit.kind != <a href='../S/2231.html#L74' title='Defined at 74 in src/termhooks.h.'>NO_EVENT</a>)
<a id='L12988' name='L12988'></a> 12988             <a href='../S/2231.html#L393' title='Defined at 393 in src/termhooks.h.'>EVENT_INIT</a> (hold_quit);
<a id='L12989' name='L12989'></a> 12989         <em class='brace'>}</em>
<a id='L12990' name='L12990'></a> 12990 <em class='sharp'>#endif</em>
<a id='L12991' name='L12991'></a> 12991     <em class='brace'>}</em>
<a id='L12992' name='L12992'></a> 12992 
<a id='L12993' name='L12993'></a> 12993   x_dnd_waiting_for_finish = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L12994' name='L12994'></a> 12994 
<a id='L12995' name='L12995'></a> 12995 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L12996' name='L12996'></a> 12996   current_hold_quit = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L12997' name='L12997'></a> 12997 <em class='sharp'>#endif</em>
<a id='L12998' name='L12998'></a> 12998   x_dnd_movement_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L12999' name='L12999'></a> 12999   x_dnd_wheel_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L13000' name='L13000'></a> 13000   <a href='../S/2289.html#L4770' title='Defined at 4770 in src/xterm.c.'>x_restore_events_after_dnd</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, &amp;root_window_attrs);
<a id='L13001' name='L13001'></a> 13001 
<a id='L13002' name='L13002'></a> 13002   <strong class='reserved'>if</strong> (x_dnd_return_frame == 3
<a id='L13003' name='L13003'></a> 13003       &amp;&amp; <a href='../S/2183.html#L1028' title='Defined at 1028 in src/frame.h.'>FRAME_LIVE_P</a> (x_dnd_return_frame_object))
<a id='L13004' name='L13004'></a> 13004     <em class='brace'>{</em>
<a id='L13005' name='L13005'></a> 13005       <em class='comment'>/* Deliberately preserve the last device if</em>
<a id='L13006' name='L13006'></a> 13006 <em class='comment'>         x_dnd_return_frame_object is the drag source.  */</em>
<a id='L13007' name='L13007'></a> 13007 
<a id='L13008' name='L13008'></a> 13008       <strong class='reserved'>if</strong> (x_dnd_return_frame_object != x_dnd_frame)
<a id='L13009' name='L13009'></a> 13009         x_dnd_return_frame_object-&gt;last_mouse_device = Qnil;
<a id='L13010' name='L13010'></a> 13010 
<a id='L13011' name='L13011'></a> 13011       x_dnd_return_frame_object-&gt;mouse_moved = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L13012' name='L13012'></a> 13012 
<a id='L13013' name='L13013'></a> 13013       <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (action, x_dnd_return_frame_object);
<a id='L13014' name='L13014'></a> 13014       x_dnd_return_frame_object = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L13015' name='L13015'></a> 13015 
<a id='L13016' name='L13016'></a> 13016       <strong class='reserved'>return</strong> <a href='../S/2188.html#L3757' title='Defined at 3757 in src/eval.c.'>unbind_to</a> (<a href='../S/4101.html#L26' title='Defined at 26 in test/manual/etags/cp-src/c.C.'>base</a>, action);
<a id='L13017' name='L13017'></a> 13017     <em class='brace'>}</em>
<a id='L13018' name='L13018'></a> 13018 
<a id='L13019' name='L13019'></a> 13019   x_dnd_return_frame_object = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L13020' name='L13020'></a> 13020   <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;grabbed = 0;
<a id='L13021' name='L13021'></a> 13021 
<a id='L13022' name='L13022'></a> 13022   <strong class='reserved'>if</strong> (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (x_dnd_action_symbol))
<a id='L13023' name='L13023'></a> 13023     <strong class='reserved'>return</strong> <a href='../S/2188.html#L3757' title='Defined at 3757 in src/eval.c.'>unbind_to</a> (<a href='../S/4101.html#L26' title='Defined at 26 in test/manual/etags/cp-src/c.C.'>base</a>, x_dnd_action_symbol);
<a id='L13024' name='L13024'></a> 13024 
<a id='L13025' name='L13025'></a> 13025   <strong class='reserved'>if</strong> (x_dnd_action != None)
<a id='L13026' name='L13026'></a> 13026     <em class='brace'>{</em>
<a id='L13027' name='L13027'></a> 13027       <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L13028' name='L13028'></a> 13028       x_catch_errors (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L13029' name='L13029'></a> 13029       atom_name = x_get_atom_name (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L13030' name='L13030'></a> 13030                                    x_dnd_action, &amp;need_sync);
<a id='L13031' name='L13031'></a> 13031 
<a id='L13032' name='L13032'></a> 13032       <strong class='reserved'>if</strong> (need_sync)
<a id='L13033' name='L13033'></a> 13033         x_uncatch_errors ();
<a id='L13034' name='L13034'></a> 13034       <strong class='reserved'>else</strong>
<a id='L13035' name='L13035'></a> 13035         <em class='comment'>/* No protocol request actually happened, so avoid the extra</em>
<a id='L13036' name='L13036'></a> 13036 <em class='comment'>           sync by calling x_uncatch_errors_after_check instead.  */</em>
<a id='L13037' name='L13037'></a> 13037         x_uncatch_errors_after_check ();
<a id='L13038' name='L13038'></a> 13038 
<a id='L13039' name='L13039'></a> 13039       <strong class='reserved'>if</strong> (atom_name)
<a id='L13040' name='L13040'></a> 13040         <em class='brace'>{</em>
<a id='L13041' name='L13041'></a> 13041           action = <a href='../D/13388.html' title='Multiple defined in 2 places.'>intern</a> (atom_name);
<a id='L13042' name='L13042'></a> 13042           <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (atom_name);
<a id='L13043' name='L13043'></a> 13043         <em class='brace'>}</em>
<a id='L13044' name='L13044'></a> 13044       <strong class='reserved'>else</strong>
<a id='L13045' name='L13045'></a> 13045         action = Qnil;
<a id='L13046' name='L13046'></a> 13046       <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L13047' name='L13047'></a> 13047 
<a id='L13048' name='L13048'></a> 13048       <strong class='reserved'>return</strong> <a href='../S/2188.html#L3757' title='Defined at 3757 in src/eval.c.'>unbind_to</a> (<a href='../S/4101.html#L26' title='Defined at 26 in test/manual/etags/cp-src/c.C.'>base</a>, action);
<a id='L13049' name='L13049'></a> 13049     <em class='brace'>}</em>
<a id='L13050' name='L13050'></a> 13050 
<a id='L13051' name='L13051'></a> 13051   <strong class='reserved'>return</strong> <a href='../S/2188.html#L3757' title='Defined at 3757 in src/eval.c.'>unbind_to</a> (<a href='../S/4101.html#L26' title='Defined at 26 in test/manual/etags/cp-src/c.C.'>base</a>, Qnil);
<a id='L13052' name='L13052'></a> 13052 <em class='brace'>}</em>
<a id='L13053' name='L13053'></a> 13053 
<a id='L13054' name='L13054'></a> 13054 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L13055' name='L13055'></a> 13055 
<a id='L13056' name='L13056'></a> 13056 <em class='comment'>/* Since the input extension assigns a keyboard focus to each master</em>
<a id='L13057' name='L13057'></a> 13057 <em class='comment'>   device, there is no longer a 1:1 correspondence between the</em>
<a id='L13058' name='L13058'></a> 13058 <em class='comment'>   selected frame and the focus frame immediately after the keyboard</em>
<a id='L13059' name='L13059'></a> 13059 <em class='comment'>   focus is switched to a given frame.  This situation is handled by</em>
<a id='L13060' name='L13060'></a> 13060 <em class='comment'>   keeping track of each master device's focus frame, the time of the</em>
<a id='L13061' name='L13061'></a> 13061 <em class='comment'>   last interaction with that frame, and always keeping the focus on</em>
<a id='L13062' name='L13062'></a> 13062 <em class='comment'>   the most recently selected frame.  We also use the pointer of the</em>
<a id='L13063' name='L13063'></a> 13063 <em class='comment'>   device that is keeping the current frame focused in functions like</em>
<a id='L13064' name='L13064'></a> 13064 <em class='comment'>   `mouse-position'.  */</em>
<a id='L13065' name='L13065'></a> 13065 
<a id='L13066' name='L13066'></a> 13066 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L13067' name='L13067'></a> 13067 xi_handle_focus_change (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo)
<a id='L13068' name='L13068'></a> 13068 <em class='brace'>{</em>
<a id='L13069' name='L13069'></a> 13069   <strong class='reserved'>struct</strong> <a href='../S/2231.html#L350' title='Defined at 350 in src/termhooks.h.'>input_event</a> ie;
<a id='L13070' name='L13070'></a> 13070   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *focus, *new;
<a id='L13071' name='L13071'></a> 13071   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L275' title='Defined at 275 in src/xterm.h.'>xi_device_t</a> *device, *source = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L13072' name='L13072'></a> 13072   ptrdiff_t i;
<a id='L13073' name='L13073'></a> 13073   <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a> <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L13074' name='L13074'></a> 13074 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L13075' name='L13075'></a> 13075   <strong class='reserved'>struct</strong> <a href='../D/19627.html' title='Multiple defined in 5 places.'>x_output</a> *output;
<a id='L13076' name='L13076'></a> 13076   GtkWidget *widget;
<a id='L13077' name='L13077'></a> 13077 <em class='sharp'>#endif</em>
<a id='L13078' name='L13078'></a> 13078 
<a id='L13079' name='L13079'></a> 13079   focus = dpyinfo-&gt;x_focus_frame;
<a id='L13080' name='L13080'></a> 13080   new = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L13081' name='L13081'></a> 13081   <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> = 0;
<a id='L13082' name='L13082'></a> 13082 
<a id='L13083' name='L13083'></a> 13083   dpyinfo-&gt;client_pointer_device = -1;
<a id='L13084' name='L13084'></a> 13084 
<a id='L13085' name='L13085'></a> 13085   <strong class='reserved'>for</strong> (i = 0; i &lt; dpyinfo-&gt;num_devices; ++i)
<a id='L13086' name='L13086'></a> 13086     <em class='brace'>{</em>
<a id='L13087' name='L13087'></a> 13087       device = &amp;dpyinfo-&gt;devices[i];
<a id='L13088' name='L13088'></a> 13088 
<a id='L13089' name='L13089'></a> 13089       <strong class='reserved'>if</strong> (device-&gt;focus_frame
<a id='L13090' name='L13090'></a> 13090           &amp;&amp; device-&gt;focus_frame_time &gt; <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>)
<a id='L13091' name='L13091'></a> 13091         <em class='brace'>{</em>
<a id='L13092' name='L13092'></a> 13092           new = device-&gt;focus_frame;
<a id='L13093' name='L13093'></a> 13093           <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> = device-&gt;focus_frame_time;
<a id='L13094' name='L13094'></a> 13094           source = device;
<a id='L13095' name='L13095'></a> 13095 
<a id='L13096' name='L13096'></a> 13096           <em class='comment'>/* Use this device for future calls to `mouse-position' etc.</em>
<a id='L13097' name='L13097'></a> 13097 <em class='comment'>             If it is a keyboard, use its attached pointer.  */</em>
<a id='L13098' name='L13098'></a> 13098 
<a id='L13099' name='L13099'></a> 13099           <strong class='reserved'>if</strong> (device-&gt;use == XIMasterKeyboard)
<a id='L13100' name='L13100'></a> 13100             dpyinfo-&gt;client_pointer_device = device-&gt;attachment;
<a id='L13101' name='L13101'></a> 13101           <strong class='reserved'>else</strong>
<a id='L13102' name='L13102'></a> 13102             dpyinfo-&gt;client_pointer_device = device-&gt;device_id;
<a id='L13103' name='L13103'></a> 13103         <em class='brace'>}</em>
<a id='L13104' name='L13104'></a> 13104       <em class='comment'>/* Even if the implicit focus was set after the explicit focus</em>
<a id='L13105' name='L13105'></a> 13105 <em class='comment'>         on this specific device, the explicit focus is what really</em>
<a id='L13106' name='L13106'></a> 13106 <em class='comment'>         matters.  So use it instead.  */</em>
<a id='L13107' name='L13107'></a> 13107       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (device-&gt;focus_implicit_frame
<a id='L13108' name='L13108'></a> 13108                &amp;&amp; device-&gt;focus_implicit_time &gt; <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>)
<a id='L13109' name='L13109'></a> 13109         <em class='brace'>{</em>
<a id='L13110' name='L13110'></a> 13110           new = device-&gt;focus_implicit_frame;
<a id='L13111' name='L13111'></a> 13111           <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> = device-&gt;focus_implicit_time;
<a id='L13112' name='L13112'></a> 13112           source = device;
<a id='L13113' name='L13113'></a> 13113 
<a id='L13114' name='L13114'></a> 13114           <em class='comment'>/* Use this device for future calls to `mouse-position' etc.</em>
<a id='L13115' name='L13115'></a> 13115 <em class='comment'>             If it is a keyboard, use its attached pointer.  */</em>
<a id='L13116' name='L13116'></a> 13116 
<a id='L13117' name='L13117'></a> 13117           <strong class='reserved'>if</strong> (device-&gt;use == XIMasterKeyboard)
<a id='L13118' name='L13118'></a> 13118             dpyinfo-&gt;client_pointer_device = device-&gt;attachment;
<a id='L13119' name='L13119'></a> 13119           <strong class='reserved'>else</strong>
<a id='L13120' name='L13120'></a> 13120             dpyinfo-&gt;client_pointer_device = device-&gt;device_id;
<a id='L13121' name='L13121'></a> 13121         <em class='brace'>}</em>
<a id='L13122' name='L13122'></a> 13122     <em class='brace'>}</em>
<a id='L13123' name='L13123'></a> 13123 
<a id='L13124' name='L13124'></a> 13124   <strong class='reserved'>if</strong> (new != focus &amp;&amp; focus)
<a id='L13125' name='L13125'></a> 13125     <em class='brace'>{</em>
<a id='L13126' name='L13126'></a> 13126 <em class='sharp'>#ifdef</em> HAVE_X_I18N
<a id='L13127' name='L13127'></a> 13127       <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1470' title='Defined at 1470 in src/xterm.h.'>FRAME_XIC</a> (focus))
<a id='L13128' name='L13128'></a> 13128         XUnsetICFocus (<a href='../S/2212.html#L1470' title='Defined at 1470 in src/xterm.h.'>FRAME_XIC</a> (focus));
<a id='L13129' name='L13129'></a> 13129 <em class='sharp'>#endif</em>
<a id='L13130' name='L13130'></a> 13130 
<a id='L13131' name='L13131'></a> 13131 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L13132' name='L13132'></a> 13132       output = <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (focus);
<a id='L13133' name='L13133'></a> 13133 
<a id='L13134' name='L13134'></a> 13134       <strong class='reserved'>if</strong> (x_gtk_use_native_input)
<a id='L13135' name='L13135'></a> 13135         <em class='brace'>{</em>
<a id='L13136' name='L13136'></a> 13136           gtk_im_context_focus_out (output-&gt;im_context);
<a id='L13137' name='L13137'></a> 13137           gtk_im_context_set_client_window (output-&gt;im_context,
<a id='L13138' name='L13138'></a> 13138                                             <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L13139' name='L13139'></a> 13139         <em class='brace'>}</em>
<a id='L13140' name='L13140'></a> 13140 <em class='sharp'>#endif</em>
<a id='L13141' name='L13141'></a> 13141 
<a id='L13142' name='L13142'></a> 13142       <a href='../S/2231.html#L393' title='Defined at 393 in src/termhooks.h.'>EVENT_INIT</a> (ie);
<a id='L13143' name='L13143'></a> 13143       ie.kind = <a href='../S/2231.html#L236' title='Defined at 236 in src/termhooks.h.'>FOCUS_OUT_EVENT</a>;
<a id='L13144' name='L13144'></a> 13144       <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (ie.frame_or_window, focus);
<a id='L13145' name='L13145'></a> 13145 
<a id='L13146' name='L13146'></a> 13146       <a href='../D/13636.html' title='Multiple defined in 2 places.'>kbd_buffer_store_event</a> (&amp;ie);
<a id='L13147' name='L13147'></a> 13147     <em class='brace'>}</em>
<a id='L13148' name='L13148'></a> 13148 
<a id='L13149' name='L13149'></a> 13149   <strong class='reserved'>if</strong> (new != focus &amp;&amp; new)
<a id='L13150' name='L13150'></a> 13150     <em class='brace'>{</em>
<a id='L13151' name='L13151'></a> 13151 <em class='sharp'>#ifdef</em> HAVE_X_I18N
<a id='L13152' name='L13152'></a> 13152       <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1470' title='Defined at 1470 in src/xterm.h.'>FRAME_XIC</a> (new))
<a id='L13153' name='L13153'></a> 13153         XSetICFocus (<a href='../S/2212.html#L1470' title='Defined at 1470 in src/xterm.h.'>FRAME_XIC</a> (new));
<a id='L13154' name='L13154'></a> 13154 <em class='sharp'>#endif</em>
<a id='L13155' name='L13155'></a> 13155 
<a id='L13156' name='L13156'></a> 13156 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L13157' name='L13157'></a> 13157       output = <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (new);
<a id='L13158' name='L13158'></a> 13158 
<a id='L13159' name='L13159'></a> 13159       <strong class='reserved'>if</strong> (x_gtk_use_native_input)
<a id='L13160' name='L13160'></a> 13160         <em class='brace'>{</em>
<a id='L13161' name='L13161'></a> 13161           widget = <a href='../D/2309.html' title='Multiple defined in 2 places.'>FRAME_GTK_OUTER_WIDGET</a> (new);
<a id='L13162' name='L13162'></a> 13162 
<a id='L13163' name='L13163'></a> 13163           gtk_im_context_focus_in (output-&gt;im_context);
<a id='L13164' name='L13164'></a> 13164           gtk_im_context_set_client_window (output-&gt;im_context,
<a id='L13165' name='L13165'></a> 13165                                             gtk_widget_get_window (widget));
<a id='L13166' name='L13166'></a> 13166         <em class='brace'>}</em>
<a id='L13167' name='L13167'></a> 13167 <em class='sharp'>#endif</em>
<a id='L13168' name='L13168'></a> 13168 
<a id='L13169' name='L13169'></a> 13169       <a href='../S/2231.html#L393' title='Defined at 393 in src/termhooks.h.'>EVENT_INIT</a> (ie);
<a id='L13170' name='L13170'></a> 13170       ie.kind = <a href='../S/2231.html#L234' title='Defined at 234 in src/termhooks.h.'>FOCUS_IN_EVENT</a>;
<a id='L13171' name='L13171'></a> 13171       ie.device = source-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>;
<a id='L13172' name='L13172'></a> 13172       <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (ie.frame_or_window, new);
<a id='L13173' name='L13173'></a> 13173 
<a id='L13174' name='L13174'></a> 13174       <a href='../D/13636.html' title='Multiple defined in 2 places.'>kbd_buffer_store_event</a> (&amp;ie);
<a id='L13175' name='L13175'></a> 13175     <em class='brace'>}</em>
<a id='L13176' name='L13176'></a> 13176 
<a id='L13177' name='L13177'></a> 13177   <a href='../S/2289.html#L11713' title='Defined at 11713 in src/xterm.c.'>x_new_focus_frame</a> (dpyinfo, new);
<a id='L13178' name='L13178'></a> 13178 <em class='brace'>}</em>
<a id='L13179' name='L13179'></a> 13179 
<a id='L13180' name='L13180'></a> 13180 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L13181' name='L13181'></a> 13181 xi_focus_handle_for_device (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L13182' name='L13182'></a> 13182                             <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *mentioned_frame,
<a id='L13183' name='L13183'></a> 13183                             XIEvent *base_event)
<a id='L13184' name='L13184'></a> 13184 <em class='brace'>{</em>
<a id='L13185' name='L13185'></a> 13185   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L275' title='Defined at 275 in src/xterm.h.'>xi_device_t</a> *device;
<a id='L13186' name='L13186'></a> 13186   XIEnterEvent *event;
<a id='L13187' name='L13187'></a> 13187 
<a id='L13188' name='L13188'></a> 13188   <em class='comment'>/* XILeaveEvent, XIFocusInEvent, etc are just synonyms for</em>
<a id='L13189' name='L13189'></a> 13189 <em class='comment'>     XIEnterEvent.  */</em>
<a id='L13190' name='L13190'></a> 13190   event = (XIEnterEvent *) base_event;
<a id='L13191' name='L13191'></a> 13191   device = <a href='../S/2289.html#L5732' title='Defined at 5732 in src/xterm.c.'>xi_device_from_id</a> (dpyinfo, event-&gt;deviceid);
<a id='L13192' name='L13192'></a> 13192 
<a id='L13193' name='L13193'></a> 13193   <strong class='reserved'>if</strong> (!device)
<a id='L13194' name='L13194'></a> 13194     <strong class='reserved'>return</strong>;
<a id='L13195' name='L13195'></a> 13195 
<a id='L13196' name='L13196'></a> 13196   <strong class='reserved'>switch</strong> (event-&gt;evtype)
<a id='L13197' name='L13197'></a> 13197     <em class='brace'>{</em>
<a id='L13198' name='L13198'></a> 13198     <strong class='reserved'>case</strong> XI_FocusIn:
<a id='L13199' name='L13199'></a> 13199       <em class='comment'>/* The last-focus-change time of the device changed, so update the</em>
<a id='L13200' name='L13200'></a> 13200 <em class='comment'>         frame's user time.  */</em>
<a id='L13201' name='L13201'></a> 13201       <a href='../S/2289.html#L7929' title='Defined at 7929 in src/xterm.c.'>x_display_set_last_user_time</a> (dpyinfo, event-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>,
<a id='L13202' name='L13202'></a> 13202                                     event-&gt;send_event, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L13203' name='L13203'></a> 13203 
<a id='L13204' name='L13204'></a> 13204       device-&gt;focus_frame = mentioned_frame;
<a id='L13205' name='L13205'></a> 13205       device-&gt;focus_frame_time = event-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L13206' name='L13206'></a> 13206       <strong class='reserved'>break</strong>;
<a id='L13207' name='L13207'></a> 13207 
<a id='L13208' name='L13208'></a> 13208     <strong class='reserved'>case</strong> XI_FocusOut:
<a id='L13209' name='L13209'></a> 13209       <em class='comment'>/* The last-focus-change time of the device changed, so update the</em>
<a id='L13210' name='L13210'></a> 13210 <em class='comment'>         frame's user time.  */</em>
<a id='L13211' name='L13211'></a> 13211       <a href='../S/2289.html#L7929' title='Defined at 7929 in src/xterm.c.'>x_display_set_last_user_time</a> (dpyinfo, event-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>,
<a id='L13212' name='L13212'></a> 13212                                     event-&gt;send_event, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L13213' name='L13213'></a> 13213 
<a id='L13214' name='L13214'></a> 13214       device-&gt;focus_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L13215' name='L13215'></a> 13215 
<a id='L13216' name='L13216'></a> 13216       <em class='comment'>/* So, unfortunately, the X Input Extension is implemented such</em>
<a id='L13217' name='L13217'></a> 13217 <em class='comment'>         that means XI_Leave events will not have their focus field</em>
<a id='L13218' name='L13218'></a> 13218 <em class='comment'>         set if the core focus is transferred to another window after</em>
<a id='L13219' name='L13219'></a> 13219 <em class='comment'>         an entry event that pretends to (or really does) set the</em>
<a id='L13220' name='L13220'></a> 13220 <em class='comment'>         implicit focus.  In addition, if the core focus is set, but</em>
<a id='L13221' name='L13221'></a> 13221 <em class='comment'>         the extension focus on the client pointer is not, all</em>
<a id='L13222' name='L13222'></a> 13222 <em class='comment'>         XI_Enter events will have their focus fields set, despite not</em>
<a id='L13223' name='L13223'></a> 13223 <em class='comment'>         actually changing the effective focus window.  Combined with</em>
<a id='L13224' name='L13224'></a> 13224 <em class='comment'>         almost all window managers not setting the focus on input</em>
<a id='L13225' name='L13225'></a> 13225 <em class='comment'>         extension devices, this means that Emacs will continue to</em>
<a id='L13226' name='L13226'></a> 13226 <em class='comment'>         think the implicit focus is set on one of its frames if the</em>
<a id='L13227' name='L13227'></a> 13227 <em class='comment'>         actual (core) focus is transferred to another window while</em>
<a id='L13228' name='L13228'></a> 13228 <em class='comment'>         the pointer remains inside a frame.  The only workaround in</em>
<a id='L13229' name='L13229'></a> 13229 <em class='comment'>         this case is to clear the implicit focus along with</em>
<a id='L13230' name='L13230'></a> 13230 <em class='comment'>         XI_FocusOut events, which is not correct at all, but better</em>
<a id='L13231' name='L13231'></a> 13231 <em class='comment'>         than leaving frames in an incorrectly-focused state.</em>
<a id='L13232' name='L13232'></a> 13232 <em class='comment'>         (bug#57468) */</em>
<a id='L13233' name='L13233'></a> 13233       device-&gt;focus_implicit_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L13234' name='L13234'></a> 13234       <strong class='reserved'>break</strong>;
<a id='L13235' name='L13235'></a> 13235 
<a id='L13236' name='L13236'></a> 13236     <strong class='reserved'>case</strong> XI_Enter:
<a id='L13237' name='L13237'></a> 13237       <strong class='reserved'>if</strong> (!event-&gt;focus)
<a id='L13238' name='L13238'></a> 13238         <strong class='reserved'>break</strong>;
<a id='L13239' name='L13239'></a> 13239 
<a id='L13240' name='L13240'></a> 13240       <strong class='reserved'>if</strong> (device-&gt;use == XIMasterPointer)
<a id='L13241' name='L13241'></a> 13241         device = <a href='../S/2289.html#L5732' title='Defined at 5732 in src/xterm.c.'>xi_device_from_id</a> (dpyinfo, device-&gt;attachment);
<a id='L13242' name='L13242'></a> 13242 
<a id='L13243' name='L13243'></a> 13243       <strong class='reserved'>if</strong> (!device)
<a id='L13244' name='L13244'></a> 13244         <strong class='reserved'>break</strong>;
<a id='L13245' name='L13245'></a> 13245 
<a id='L13246' name='L13246'></a> 13246       device-&gt;focus_implicit_frame = mentioned_frame;
<a id='L13247' name='L13247'></a> 13247       device-&gt;focus_implicit_time = event-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L13248' name='L13248'></a> 13248       <strong class='reserved'>break</strong>;
<a id='L13249' name='L13249'></a> 13249 
<a id='L13250' name='L13250'></a> 13250     <strong class='reserved'>case</strong> XI_Leave:
<a id='L13251' name='L13251'></a> 13251       <strong class='reserved'>if</strong> (!event-&gt;focus)
<a id='L13252' name='L13252'></a> 13252         <strong class='reserved'>break</strong>;
<a id='L13253' name='L13253'></a> 13253 
<a id='L13254' name='L13254'></a> 13254       <strong class='reserved'>if</strong> (device-&gt;use == XIMasterPointer)
<a id='L13255' name='L13255'></a> 13255         device = <a href='../S/2289.html#L5732' title='Defined at 5732 in src/xterm.c.'>xi_device_from_id</a> (dpyinfo, device-&gt;attachment);
<a id='L13256' name='L13256'></a> 13256 
<a id='L13257' name='L13257'></a> 13257       <strong class='reserved'>if</strong> (!device)
<a id='L13258' name='L13258'></a> 13258         <strong class='reserved'>break</strong>;
<a id='L13259' name='L13259'></a> 13259 
<a id='L13260' name='L13260'></a> 13260       device-&gt;focus_implicit_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L13261' name='L13261'></a> 13261       <strong class='reserved'>break</strong>;
<a id='L13262' name='L13262'></a> 13262     <em class='brace'>}</em>
<a id='L13263' name='L13263'></a> 13263 
<a id='L13264' name='L13264'></a> 13264   xi_handle_focus_change (dpyinfo);
<a id='L13265' name='L13265'></a> 13265 <em class='brace'>}</em>
<a id='L13266' name='L13266'></a> 13266 
<a id='L13267' name='L13267'></a> 13267 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L13268' name='L13268'></a> 13268 xi_handle_delete_frame (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L13269' name='L13269'></a> 13269                         <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L13270' name='L13270'></a> 13270 <em class='brace'>{</em>
<a id='L13271' name='L13271'></a> 13271   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L275' title='Defined at 275 in src/xterm.h.'>xi_device_t</a> *device;
<a id='L13272' name='L13272'></a> 13272   ptrdiff_t i;
<a id='L13273' name='L13273'></a> 13273 
<a id='L13274' name='L13274'></a> 13274   <strong class='reserved'>for</strong> (i = 0; i &lt; dpyinfo-&gt;num_devices; ++i)
<a id='L13275' name='L13275'></a> 13275     <em class='brace'>{</em>
<a id='L13276' name='L13276'></a> 13276       device = &amp;dpyinfo-&gt;devices[i];
<a id='L13277' name='L13277'></a> 13277 
<a id='L13278' name='L13278'></a> 13278       <strong class='reserved'>if</strong> (device-&gt;focus_frame == <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L13279' name='L13279'></a> 13279         device-&gt;focus_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L13280' name='L13280'></a> 13280 
<a id='L13281' name='L13281'></a> 13281       <strong class='reserved'>if</strong> (device-&gt;focus_implicit_frame == <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L13282' name='L13282'></a> 13282         device-&gt;focus_implicit_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L13283' name='L13283'></a> 13283     <em class='brace'>}</em>
<a id='L13284' name='L13284'></a> 13284 <em class='brace'>}</em>
<a id='L13285' name='L13285'></a> 13285 
<a id='L13286' name='L13286'></a> 13286 <em class='comment'>/* Handle an interaction by DEVICE on frame F.  TIME is the time of</em>
<a id='L13287' name='L13287'></a> 13287 <em class='comment'>   the interaction; if F isn't currently the global focus frame, but</em>
<a id='L13288' name='L13288'></a> 13288 <em class='comment'>   is the focus of DEVICE, make it the focus frame.  */</em>
<a id='L13289' name='L13289'></a> 13289 
<a id='L13290' name='L13290'></a> 13290 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L13291' name='L13291'></a> 13291 xi_handle_interaction (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L13292' name='L13292'></a> 13292                        <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <strong class='reserved'>struct</strong> <a href='../S/2212.html#L275' title='Defined at 275 in src/xterm.h.'>xi_device_t</a> *device,
<a id='L13293' name='L13293'></a> 13293                        <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a> <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>)
<a id='L13294' name='L13294'></a> 13294 <em class='brace'>{</em>
<a id='L13295' name='L13295'></a> 13295   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> change;
<a id='L13296' name='L13296'></a> 13296 
<a id='L13297' name='L13297'></a> 13297   <em class='comment'>/* If DEVICE is a pointer, use its attached keyboard device.  */</em>
<a id='L13298' name='L13298'></a> 13298   <strong class='reserved'>if</strong> (device-&gt;use == XIMasterPointer)
<a id='L13299' name='L13299'></a> 13299     device = <a href='../S/2289.html#L5732' title='Defined at 5732 in src/xterm.c.'>xi_device_from_id</a> (dpyinfo, device-&gt;attachment);
<a id='L13300' name='L13300'></a> 13300 
<a id='L13301' name='L13301'></a> 13301   <strong class='reserved'>if</strong> (!device)
<a id='L13302' name='L13302'></a> 13302     <strong class='reserved'>return</strong>;
<a id='L13303' name='L13303'></a> 13303 
<a id='L13304' name='L13304'></a> 13304   change = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L13305' name='L13305'></a> 13305 
<a id='L13306' name='L13306'></a> 13306   <strong class='reserved'>if</strong> (device-&gt;focus_frame == <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L13307' name='L13307'></a> 13307     <em class='brace'>{</em>
<a id='L13308' name='L13308'></a> 13308       device-&gt;focus_frame_time = <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L13309' name='L13309'></a> 13309       change = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L13310' name='L13310'></a> 13310     <em class='brace'>}</em>
<a id='L13311' name='L13311'></a> 13311 
<a id='L13312' name='L13312'></a> 13312   <strong class='reserved'>if</strong> (device-&gt;focus_implicit_frame == <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L13313' name='L13313'></a> 13313     <em class='brace'>{</em>
<a id='L13314' name='L13314'></a> 13314       device-&gt;focus_implicit_time = <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L13315' name='L13315'></a> 13315       change = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L13316' name='L13316'></a> 13316     <em class='brace'>}</em>
<a id='L13317' name='L13317'></a> 13317 
<a id='L13318' name='L13318'></a> 13318   <em class='comment'>/* If F isn't currently focused, update the focus state.  */</em>
<a id='L13319' name='L13319'></a> 13319   <strong class='reserved'>if</strong> (change &amp;&amp; <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> != dpyinfo-&gt;x_focus_frame)
<a id='L13320' name='L13320'></a> 13320     xi_handle_focus_change (dpyinfo);
<a id='L13321' name='L13321'></a> 13321 <em class='brace'>}</em>
<a id='L13322' name='L13322'></a> 13322 
<a id='L13323' name='L13323'></a> 13323 <em class='comment'>/* Return whether or not XEV actually represents a change in the</em>
<a id='L13324' name='L13324'></a> 13324 <em class='comment'>   position of the pointer on DEVICE, with respect to the last event</em>
<a id='L13325' name='L13325'></a> 13325 <em class='comment'>   received.  This is necessary because the input extension reports</em>
<a id='L13326' name='L13326'></a> 13326 <em class='comment'>   motion events in very high resolution, while Emacs is only fast</em>
<a id='L13327' name='L13327'></a> 13327 <em class='comment'>   enough to process motion events aligned to the pixel grid.  */</em>
<a id='L13328' name='L13328'></a> 13328 
<a id='L13329' name='L13329'></a> 13329 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L13330' name='L13330'></a> 13330 xi_position_changed (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L275' title='Defined at 275 in src/xterm.h.'>xi_device_t</a> *device, XIDeviceEvent *xev)
<a id='L13331' name='L13331'></a> 13331 <em class='brace'>{</em>
<a id='L13332' name='L13332'></a> 13332   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> changed;
<a id='L13333' name='L13333'></a> 13333 
<a id='L13334' name='L13334'></a> 13334   changed = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L13335' name='L13335'></a> 13335 
<a id='L13336' name='L13336'></a> 13336   <strong class='reserved'>if</strong> (xev-&gt;event != device-&gt;last_motion_window)
<a id='L13337' name='L13337'></a> 13337     <strong class='reserved'>goto</strong> out;
<a id='L13338' name='L13338'></a> 13338 
<a id='L13339' name='L13339'></a> 13339   <strong class='reserved'>if</strong> (lrint (xev-&gt;event_x) == device-&gt;last_motion_x
<a id='L13340' name='L13340'></a> 13340       &amp;&amp; lrint (xev-&gt;event_y) == device-&gt;last_motion_y)
<a id='L13341' name='L13341'></a> 13341     <em class='brace'>{</em>
<a id='L13342' name='L13342'></a> 13342       changed = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L13343' name='L13343'></a> 13343       <strong class='reserved'>goto</strong> out;
<a id='L13344' name='L13344'></a> 13344     <em class='brace'>}</em>
<a id='L13345' name='L13345'></a> 13345 
<a id='L13346' name='L13346'></a> 13346  out:
<a id='L13347' name='L13347'></a> 13347   device-&gt;last_motion_x = lrint (xev-&gt;event_x);
<a id='L13348' name='L13348'></a> 13348   device-&gt;last_motion_y = lrint (xev-&gt;event_y);
<a id='L13349' name='L13349'></a> 13349   device-&gt;last_motion_window = xev-&gt;event;
<a id='L13350' name='L13350'></a> 13350 
<a id='L13351' name='L13351'></a> 13351   <strong class='reserved'>return</strong> changed;
<a id='L13352' name='L13352'></a> 13352 <em class='brace'>}</em>
<a id='L13353' name='L13353'></a> 13353 
<a id='L13354' name='L13354'></a> 13354 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L13355' name='L13355'></a> 13355 xi_report_motion_window_clear (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L275' title='Defined at 275 in src/xterm.h.'>xi_device_t</a> *device)
<a id='L13356' name='L13356'></a> 13356 <em class='brace'>{</em>
<a id='L13357' name='L13357'></a> 13357   device-&gt;last_motion_window = None;
<a id='L13358' name='L13358'></a> 13358 <em class='brace'>}</em>
<a id='L13359' name='L13359'></a> 13359 
<a id='L13360' name='L13360'></a> 13360 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L168' title='Defined at 168 in src/xterm.h.'>HAVE_XINPUT2_1</a>
<a id='L13361' name='L13361'></a> 13361 
<a id='L13362' name='L13362'></a> 13362 <em class='comment'>/* Look up a scroll valuator in DEVICE by NUMBER.  */</em>
<a id='L13363' name='L13363'></a> 13363 
<a id='L13364' name='L13364'></a> 13364 <strong class='reserved'>static</strong> <strong class='reserved'>struct</strong> <a href='../S/2212.html#L233' title='Defined at 233 in src/xterm.h.'>xi_scroll_valuator_t</a> *
<a id='L13365' name='L13365'></a> 13365 xi_get_scroll_valuator (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L275' title='Defined at 275 in src/xterm.h.'>xi_device_t</a> *device, <strong class='reserved'>int</strong> number)
<a id='L13366' name='L13366'></a> 13366 <em class='brace'>{</em>
<a id='L13367' name='L13367'></a> 13367   <strong class='reserved'>int</strong> i;
<a id='L13368' name='L13368'></a> 13368 
<a id='L13369' name='L13369'></a> 13369   <strong class='reserved'>for</strong> (i = 0; i &lt; device-&gt;scroll_valuator_count; ++i)
<a id='L13370' name='L13370'></a> 13370     <em class='brace'>{</em>
<a id='L13371' name='L13371'></a> 13371       <strong class='reserved'>if</strong> (device-&gt;valuators[i].number == number)
<a id='L13372' name='L13372'></a> 13372         <strong class='reserved'>return</strong> &amp;device-&gt;valuators[i];
<a id='L13373' name='L13373'></a> 13373     <em class='brace'>}</em>
<a id='L13374' name='L13374'></a> 13374 
<a id='L13375' name='L13375'></a> 13375   <strong class='reserved'>return</strong> <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L13376' name='L13376'></a> 13376 <em class='brace'>}</em>
<a id='L13377' name='L13377'></a> 13377 
<a id='L13378' name='L13378'></a> 13378 <em class='comment'>/* Check if EVENT, a DeviceChanged event, contains any scroll</em>
<a id='L13379' name='L13379'></a> 13379 <em class='comment'>   valuators.  */</em>
<a id='L13380' name='L13380'></a> 13380 
<a id='L13381' name='L13381'></a> 13381 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L13382' name='L13382'></a> 13382 xi_has_scroll_valuators (XIDeviceChangedEvent *event)
<a id='L13383' name='L13383'></a> 13383 <em class='brace'>{</em>
<a id='L13384' name='L13384'></a> 13384   <strong class='reserved'>int</strong> i;
<a id='L13385' name='L13385'></a> 13385 
<a id='L13386' name='L13386'></a> 13386   <strong class='reserved'>for</strong> (i = 0; i &lt; event-&gt;num_classes; ++i)
<a id='L13387' name='L13387'></a> 13387     <em class='brace'>{</em>
<a id='L13388' name='L13388'></a> 13388       <strong class='reserved'>if</strong> (event-&gt;classes[i]-&gt;type == XIScrollClass)
<a id='L13389' name='L13389'></a> 13389         <strong class='reserved'>return</strong> <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L13390' name='L13390'></a> 13390     <em class='brace'>}</em>
<a id='L13391' name='L13391'></a> 13391 
<a id='L13392' name='L13392'></a> 13392   <strong class='reserved'>return</strong> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L13393' name='L13393'></a> 13393 <em class='brace'>}</em>
<a id='L13394' name='L13394'></a> 13394 
<a id='L13395' name='L13395'></a> 13395 <em class='comment'>/* Repopulate the information (touchpoint tracking information, scroll</em>
<a id='L13396' name='L13396'></a> 13396 <em class='comment'>   valuators, etc) in DEVICE with the device classes provided in</em>
<a id='L13397' name='L13397'></a> 13397 <em class='comment'>   CLASSES.  This is called upon receiving a DeviceChanged event.</em>
<a id='L13398' name='L13398'></a> 13398 <em class='comment'></em>
<a id='L13399' name='L13399'></a> 13399 <em class='comment'>   This function is not present on XI 2.0 as there are no worthwhile</em>
<a id='L13400' name='L13400'></a> 13400 <em class='comment'>   classes there.  */</em>
<a id='L13401' name='L13401'></a> 13401 
<a id='L13402' name='L13402'></a> 13402 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L13403' name='L13403'></a> 13403 xi_handle_new_classes (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo, <strong class='reserved'>struct</strong> <a href='../S/2212.html#L275' title='Defined at 275 in src/xterm.h.'>xi_device_t</a> *device,
<a id='L13404' name='L13404'></a> 13404                        XIAnyClassInfo **classes, <strong class='reserved'>int</strong> num_classes)
<a id='L13405' name='L13405'></a> 13405 <em class='brace'>{</em>
<a id='L13406' name='L13406'></a> 13406   XIScrollClassInfo *scroll;
<a id='L13407' name='L13407'></a> 13407   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L233' title='Defined at 233 in src/xterm.h.'>xi_scroll_valuator_t</a> *valuator;
<a id='L13408' name='L13408'></a> 13408   XIValuatorClassInfo *valuator_info;
<a id='L13409' name='L13409'></a> 13409   <strong class='reserved'>int</strong> i;
<a id='L13410' name='L13410'></a> 13410 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L171' title='Defined at 171 in src/xterm.h.'>HAVE_XINPUT2_2</a>
<a id='L13411' name='L13411'></a> 13411   XITouchClassInfo *touch;
<a id='L13412' name='L13412'></a> 13412 <em class='sharp'>#endif</em>
<a id='L13413' name='L13413'></a> 13413 
<a id='L13414' name='L13414'></a> 13414   <strong class='reserved'>if</strong> (dpyinfo-&gt;xi2_version &lt; 1)
<a id='L13415' name='L13415'></a> 13415     <em class='comment'>/* Emacs is connected to an XI 2.0 server, which reports no</em>
<a id='L13416' name='L13416'></a> 13416 <em class='comment'>       classes of interest.  */</em>
<a id='L13417' name='L13417'></a> 13417     <strong class='reserved'>return</strong>;
<a id='L13418' name='L13418'></a> 13418 
<a id='L13419' name='L13419'></a> 13419   device-&gt;valuators = <a href='../D/20078.html' title='Multiple defined in 2 places.'>xnmalloc</a> (num_classes,
<a id='L13420' name='L13420'></a> 13420                                 <strong class='reserved'>sizeof</strong> *device-&gt;valuators);
<a id='L13421' name='L13421'></a> 13421   device-&gt;scroll_valuator_count = 0;
<a id='L13422' name='L13422'></a> 13422 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L171' title='Defined at 171 in src/xterm.h.'>HAVE_XINPUT2_2</a>
<a id='L13423' name='L13423'></a> 13423   device-&gt;direct_p = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L13424' name='L13424'></a> 13424 <em class='sharp'>#endif</em>
<a id='L13425' name='L13425'></a> 13425 
<a id='L13426' name='L13426'></a> 13426   <strong class='reserved'>for</strong> (i = 0; i &lt; num_classes; ++i)
<a id='L13427' name='L13427'></a> 13427     <em class='brace'>{</em>
<a id='L13428' name='L13428'></a> 13428       <strong class='reserved'>switch</strong> (classes[i]-&gt;type)
<a id='L13429' name='L13429'></a> 13429         <em class='brace'>{</em>
<a id='L13430' name='L13430'></a> 13430         <strong class='reserved'>case</strong> XIScrollClass:
<a id='L13431' name='L13431'></a> 13431           scroll = (XIScrollClassInfo *) classes[i];
<a id='L13432' name='L13432'></a> 13432 
<a id='L13433' name='L13433'></a> 13433           <a href='../S/2289.html#L5430' title='Defined at 5430 in src/xterm.c.'>xi_populate_scroll_valuator</a> (device,
<a id='L13434' name='L13434'></a> 13434                                        device-&gt;scroll_valuator_count++,
<a id='L13435' name='L13435'></a> 13435                                        scroll);
<a id='L13436' name='L13436'></a> 13436           <strong class='reserved'>break</strong>;
<a id='L13437' name='L13437'></a> 13437 
<a id='L13438' name='L13438'></a> 13438 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L171' title='Defined at 171 in src/xterm.h.'>HAVE_XINPUT2_2</a>
<a id='L13439' name='L13439'></a> 13439         <strong class='reserved'>case</strong> XITouchClass:
<a id='L13440' name='L13440'></a> 13440           touch = (XITouchClassInfo *) classes[i];
<a id='L13441' name='L13441'></a> 13441 
<a id='L13442' name='L13442'></a> 13442           <strong class='reserved'>if</strong> (touch-&gt;mode == XIDirectTouch)
<a id='L13443' name='L13443'></a> 13443             device-&gt;direct_p = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L13444' name='L13444'></a> 13444           <strong class='reserved'>break</strong>;
<a id='L13445' name='L13445'></a> 13445 <em class='sharp'>#endif</em>
<a id='L13446' name='L13446'></a> 13446         <em class='brace'>}</em>
<a id='L13447' name='L13447'></a> 13447     <em class='brace'>}</em>
<a id='L13448' name='L13448'></a> 13448 
<a id='L13449' name='L13449'></a> 13449   <em class='comment'>/* Restore the values of any scroll valuators that we already</em>
<a id='L13450' name='L13450'></a> 13450 <em class='comment'>     know about.  */</em>
<a id='L13451' name='L13451'></a> 13451 
<a id='L13452' name='L13452'></a> 13452   <strong class='reserved'>for</strong> (i = 0; i &lt; num_classes; ++i)
<a id='L13453' name='L13453'></a> 13453     <em class='brace'>{</em>
<a id='L13454' name='L13454'></a> 13454       <strong class='reserved'>if</strong> (classes[i]-&gt;type != XIValuatorClass)
<a id='L13455' name='L13455'></a> 13455         <strong class='reserved'>continue</strong>;
<a id='L13456' name='L13456'></a> 13456 
<a id='L13457' name='L13457'></a> 13457       valuator_info = (XIValuatorClassInfo *) classes[i];
<a id='L13458' name='L13458'></a> 13458 
<a id='L13459' name='L13459'></a> 13459       <em class='comment'>/* Avoid restoring bogus values if some driver accidentally</em>
<a id='L13460' name='L13460'></a> 13460 <em class='comment'>         specifies relative values in scroll valuator classes how the</em>
<a id='L13461' name='L13461'></a> 13461 <em class='comment'>         input extension spec says they should be, but allow restoring</em>
<a id='L13462' name='L13462'></a> 13462 <em class='comment'>         values when a value is set, which is how the input extension</em>
<a id='L13463' name='L13463'></a> 13463 <em class='comment'>         actually behaves.  */</em>
<a id='L13464' name='L13464'></a> 13464 
<a id='L13465' name='L13465'></a> 13465       <strong class='reserved'>if</strong> (valuator_info-&gt;<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a> == 0.0
<a id='L13466' name='L13466'></a> 13466           &amp;&amp; valuator_info-&gt;mode != XIModeAbsolute)
<a id='L13467' name='L13467'></a> 13467         <strong class='reserved'>continue</strong>;
<a id='L13468' name='L13468'></a> 13468 
<a id='L13469' name='L13469'></a> 13469       valuator = xi_get_scroll_valuator (device,
<a id='L13470' name='L13470'></a> 13470                                          valuator_info-&gt;number);
<a id='L13471' name='L13471'></a> 13471 
<a id='L13472' name='L13472'></a> 13472       <strong class='reserved'>if</strong> (!valuator)
<a id='L13473' name='L13473'></a> 13473         <strong class='reserved'>continue</strong>;
<a id='L13474' name='L13474'></a> 13474 
<a id='L13475' name='L13475'></a> 13475       valuator-&gt;invalid_p = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L13476' name='L13476'></a> 13476       valuator-&gt;current_value = valuator_info-&gt;<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>;
<a id='L13477' name='L13477'></a> 13477       valuator-&gt;emacs_value = 0;
<a id='L13478' name='L13478'></a> 13478 
<a id='L13479' name='L13479'></a> 13479       <strong class='reserved'>break</strong>;
<a id='L13480' name='L13480'></a> 13480     <em class='brace'>}</em>
<a id='L13481' name='L13481'></a> 13481 <em class='brace'>}</em>
<a id='L13482' name='L13482'></a> 13482 
<a id='L13483' name='L13483'></a> 13483 <em class='sharp'>#endif</em>
<a id='L13484' name='L13484'></a> 13484 
<a id='L13485' name='L13485'></a> 13485 <em class='comment'>/* Handle EVENT, a DeviceChanged event.  Look up the device that</em>
<a id='L13486' name='L13486'></a> 13486 <em class='comment'>   changed, and update its information with the data in EVENT.  */</em>
<a id='L13487' name='L13487'></a> 13487 
<a id='L13488' name='L13488'></a> 13488 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L13489' name='L13489'></a> 13489 xi_handle_device_changed (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L13490' name='L13490'></a> 13490                           <strong class='reserved'>struct</strong> <a href='../S/2212.html#L275' title='Defined at 275 in src/xterm.h.'>xi_device_t</a> *device,
<a id='L13491' name='L13491'></a> 13491                           XIDeviceChangedEvent *event)
<a id='L13492' name='L13492'></a> 13492 <em class='brace'>{</em>
<a id='L13493' name='L13493'></a> 13493 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L168' title='Defined at 168 in src/xterm.h.'>HAVE_XINPUT2_1</a>
<a id='L13494' name='L13494'></a> 13494   <strong class='reserved'>int</strong> ndevices;
<a id='L13495' name='L13495'></a> 13495   XIDeviceInfo *<a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a>;
<a id='L13496' name='L13496'></a> 13496 <em class='sharp'>#endif</em>
<a id='L13497' name='L13497'></a> 13497 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L171' title='Defined at 171 in src/xterm.h.'>HAVE_XINPUT2_2</a>
<a id='L13498' name='L13498'></a> 13498   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L258' title='Defined at 258 in src/xterm.h.'>xi_touch_point_t</a> *tem, *last;
<a id='L13499' name='L13499'></a> 13499 <em class='sharp'>#endif</em>
<a id='L13500' name='L13500'></a> 13500 
<a id='L13501' name='L13501'></a> 13501 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L168' title='Defined at 168 in src/xterm.h.'>HAVE_XINPUT2_1</a>
<a id='L13502' name='L13502'></a> 13502   <strong class='reserved'>if</strong> (xi_has_scroll_valuators (event))
<a id='L13503' name='L13503'></a> 13503     <em class='comment'>/* Scroll valuators are provided by this event.  Use the values</em>
<a id='L13504' name='L13504'></a> 13504 <em class='comment'>       provided in this event to populate the device's new scroll</em>
<a id='L13505' name='L13505'></a> 13505 <em class='comment'>       valuator list: if this event is a SlaveSwitch event caused by</em>
<a id='L13506' name='L13506'></a> 13506 <em class='comment'>       wheel movement, then querying for the device info will probably</em>
<a id='L13507' name='L13507'></a> 13507 <em class='comment'>       return the value after the wheel movement, leading to a delta</em>
<a id='L13508' name='L13508'></a> 13508 <em class='comment'>       of 0 being computed upon handling the subsequent XI_Motion</em>
<a id='L13509' name='L13509'></a> 13509 <em class='comment'>       event.  (bug#58980) */</em>
<a id='L13510' name='L13510'></a> 13510     xi_handle_new_classes (dpyinfo, device, event-&gt;classes,
<a id='L13511' name='L13511'></a> 13511                            event-&gt;num_classes);
<a id='L13512' name='L13512'></a> 13512   <strong class='reserved'>else</strong>
<a id='L13513' name='L13513'></a> 13513     <em class='brace'>{</em>
<a id='L13514' name='L13514'></a> 13514       <em class='comment'>/* When a DeviceChange event is received for a master device,</em>
<a id='L13515' name='L13515'></a> 13515 <em class='comment'>         the X server sometimes does not send any scroll valuators</em>
<a id='L13516' name='L13516'></a> 13516 <em class='comment'>         along with it.  This is possibly an X server bug but I really</em>
<a id='L13517' name='L13517'></a> 13517 <em class='comment'>         don't want to dig any further, so fetch the scroll valuators</em>
<a id='L13518' name='L13518'></a> 13518 <em class='comment'>         manually.  (bug#57020) */</em>
<a id='L13519' name='L13519'></a> 13519 
<a id='L13520' name='L13520'></a> 13520       x_catch_errors (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L13521' name='L13521'></a> 13521       <a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a> = XIQueryDevice (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, event-&gt;deviceid,
<a id='L13522' name='L13522'></a> 13522                             <em class='comment'>/* ndevices is always 1 if a deviceid is</em>
<a id='L13523' name='L13523'></a> 13523 <em class='comment'>                               specified.  If the request fails, NULL will</em>
<a id='L13524' name='L13524'></a> 13524 <em class='comment'>                               be returned.  */</em>
<a id='L13525' name='L13525'></a> 13525                             &amp;ndevices);
<a id='L13526' name='L13526'></a> 13526       x_uncatch_errors ();
<a id='L13527' name='L13527'></a> 13527 
<a id='L13528' name='L13528'></a> 13528       <strong class='reserved'>if</strong> (!<a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a>)
<a id='L13529' name='L13529'></a> 13529         <strong class='reserved'>return</strong>;
<a id='L13530' name='L13530'></a> 13530 
<a id='L13531' name='L13531'></a> 13531       <em class='comment'>/* info contains the classes currently associated with the</em>
<a id='L13532' name='L13532'></a> 13532 <em class='comment'>         event.  Apply them.  */</em>
<a id='L13533' name='L13533'></a> 13533       xi_handle_new_classes (dpyinfo, device, <a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a>-&gt;classes,
<a id='L13534' name='L13534'></a> 13534                              <a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a>-&gt;num_classes);
<a id='L13535' name='L13535'></a> 13535     <em class='brace'>}</em>
<a id='L13536' name='L13536'></a> 13536 <em class='sharp'>#endif</em>
<a id='L13537' name='L13537'></a> 13537 
<a id='L13538' name='L13538'></a> 13538 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L171' title='Defined at 171 in src/xterm.h.'>HAVE_XINPUT2_2</a>
<a id='L13539' name='L13539'></a> 13539   <em class='comment'>/* The device is no longer a DirectTouch device, so remove any</em>
<a id='L13540' name='L13540'></a> 13540 <em class='comment'>     touchpoints that we might have recorded.  */</em>
<a id='L13541' name='L13541'></a> 13541   <strong class='reserved'>if</strong> (!device-&gt;direct_p)
<a id='L13542' name='L13542'></a> 13542     <em class='brace'>{</em>
<a id='L13543' name='L13543'></a> 13543       tem = device-&gt;touchpoints;
<a id='L13544' name='L13544'></a> 13544 
<a id='L13545' name='L13545'></a> 13545       <strong class='reserved'>while</strong> (tem)
<a id='L13546' name='L13546'></a> 13546         <em class='brace'>{</em>
<a id='L13547' name='L13547'></a> 13547           last = tem;
<a id='L13548' name='L13548'></a> 13548           tem = tem-&gt;next;
<a id='L13549' name='L13549'></a> 13549           <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (last);
<a id='L13550' name='L13550'></a> 13550         <em class='brace'>}</em>
<a id='L13551' name='L13551'></a> 13551 
<a id='L13552' name='L13552'></a> 13552       device-&gt;touchpoints = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L13553' name='L13553'></a> 13553     <em class='brace'>}</em>
<a id='L13554' name='L13554'></a> 13554 <em class='sharp'>#endif</em>
<a id='L13555' name='L13555'></a> 13555 <em class='brace'>}</em>
<a id='L13556' name='L13556'></a> 13556 
<a id='L13557' name='L13557'></a> 13557 <em class='comment'>/* Remove the client-side record of every device in TO_DISABLE.</em>
<a id='L13558' name='L13558'></a> 13558 <em class='comment'>   Called while processing XI_HierarchyChanged events.  We batch up</em>
<a id='L13559' name='L13559'></a> 13559 <em class='comment'>   multiple disabled devices because it is more efficient to disable</em>
<a id='L13560' name='L13560'></a> 13560 <em class='comment'>   them at once.  */</em>
<a id='L13561' name='L13561'></a> 13561 
<a id='L13562' name='L13562'></a> 13562 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L13563' name='L13563'></a> 13563 xi_disable_devices (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L13564' name='L13564'></a> 13564                     <strong class='reserved'>int</strong> *to_disable, <strong class='reserved'>int</strong> n_disabled)
<a id='L13565' name='L13565'></a> 13565 <em class='brace'>{</em>
<a id='L13566' name='L13566'></a> 13566   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L275' title='Defined at 275 in src/xterm.h.'>xi_device_t</a> *devices;
<a id='L13567' name='L13567'></a> 13567   <strong class='reserved'>int</strong> ndevices, i, j;
<a id='L13568' name='L13568'></a> 13568 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L171' title='Defined at 171 in src/xterm.h.'>HAVE_XINPUT2_2</a>
<a id='L13569' name='L13569'></a> 13569   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L258' title='Defined at 258 in src/xterm.h.'>xi_touch_point_t</a> *tem, *last;
<a id='L13570' name='L13570'></a> 13570 <em class='sharp'>#endif</em>
<a id='L13571' name='L13571'></a> 13571 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> <a href='../S/2212.html#L171' title='Defined at 171 in src/xterm.h.'>HAVE_XINPUT2_2</a> &amp;&amp; !<strong class='reserved'>defined</strong> <a href='../S/2267.html#L3724' title='Defined at 3724 in src/lisp.h.'>HAVE_EXT_TOOL_BAR</a>
<a id='L13572' name='L13572'></a> 13572   <strong class='reserved'>struct</strong> <a href='../D/19627.html' title='Multiple defined in 5 places.'>x_output</a> *output;
<a id='L13573' name='L13573'></a> 13573   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>;
<a id='L13574' name='L13574'></a> 13574 <em class='sharp'>#endif</em>
<a id='L13575' name='L13575'></a> 13575 
<a id='L13576' name='L13576'></a> 13576   <em class='comment'>/* Don't pointlessly copy dpyinfo-&gt;devices if there are no devices</em>
<a id='L13577' name='L13577'></a> 13577 <em class='comment'>     to disable.  */</em>
<a id='L13578' name='L13578'></a> 13578   <strong class='reserved'>if</strong> (!n_disabled)
<a id='L13579' name='L13579'></a> 13579     <strong class='reserved'>return</strong>;
<a id='L13580' name='L13580'></a> 13580 
<a id='L13581' name='L13581'></a> 13581   ndevices = 0;
<a id='L13582' name='L13582'></a> 13582   devices = <a href='../S/2350.html#L802' title='Defined at 802 in src/alloc.c.'>xzalloc</a> (<strong class='reserved'>sizeof</strong> *devices * dpyinfo-&gt;num_devices);
<a id='L13583' name='L13583'></a> 13583 
<a id='L13584' name='L13584'></a> 13584   <em class='comment'>/* Loop through every device currently in DPYINFO, and copy it to</em>
<a id='L13585' name='L13585'></a> 13585 <em class='comment'>     DEVICES if it is not in TO_DISABLE.  Note that this function</em>
<a id='L13586' name='L13586'></a> 13586 <em class='comment'>     should be called with input blocked, since xfree can otherwise</em>
<a id='L13587' name='L13587'></a> 13587 <em class='comment'>     call GC, which will call mark_xterm with invalid state.  */</em>
<a id='L13588' name='L13588'></a> 13588   <strong class='reserved'>for</strong> (i = 0; i &lt; dpyinfo-&gt;num_devices; ++i)
<a id='L13589' name='L13589'></a> 13589     <em class='brace'>{</em>
<a id='L13590' name='L13590'></a> 13590       <strong class='reserved'>for</strong> (j = 0; j &lt; n_disabled; ++j)
<a id='L13591' name='L13591'></a> 13591         <em class='brace'>{</em>
<a id='L13592' name='L13592'></a> 13592           <strong class='reserved'>if</strong> (to_disable[j] == dpyinfo-&gt;devices[i].device_id)
<a id='L13593' name='L13593'></a> 13593             <em class='brace'>{</em>
<a id='L13594' name='L13594'></a> 13594               <strong class='reserved'>if</strong> (x_dnd_in_progress
<a id='L13595' name='L13595'></a> 13595                   <em class='comment'>/* If the drag-and-drop pointer device is being</em>
<a id='L13596' name='L13596'></a> 13596 <em class='comment'>                     disabled, then cancel the drag and drop</em>
<a id='L13597' name='L13597'></a> 13597 <em class='comment'>                     operation.  */</em>
<a id='L13598' name='L13598'></a> 13598                   &amp;&amp; to_disable[j] == x_dnd_pointer_device)
<a id='L13599' name='L13599'></a> 13599                 <a href='../S/2289.html#L4803' title='Defined at 4803 in src/xterm.c.'>x_dnd_cancel_dnd_early</a> ();
<a id='L13600' name='L13600'></a> 13600 
<a id='L13601' name='L13601'></a> 13601               <em class='comment'>/* Free any scroll valuators that might be on this</em>
<a id='L13602' name='L13602'></a> 13602 <em class='comment'>                 device.  */</em>
<a id='L13603' name='L13603'></a> 13603 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L168' title='Defined at 168 in src/xterm.h.'>HAVE_XINPUT2_1</a>
<a id='L13604' name='L13604'></a> 13604               <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (dpyinfo-&gt;devices[i].valuators);
<a id='L13605' name='L13605'></a> 13605 <em class='sharp'>#endif</em>
<a id='L13606' name='L13606'></a> 13606 
<a id='L13607' name='L13607'></a> 13607               <em class='comment'>/* Free any currently active touch points on this</em>
<a id='L13608' name='L13608'></a> 13608 <em class='comment'>                 device.  */</em>
<a id='L13609' name='L13609'></a> 13609 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L171' title='Defined at 171 in src/xterm.h.'>HAVE_XINPUT2_2</a>
<a id='L13610' name='L13610'></a> 13610               tem = dpyinfo-&gt;devices[i].touchpoints;
<a id='L13611' name='L13611'></a> 13611               <strong class='reserved'>while</strong> (tem)
<a id='L13612' name='L13612'></a> 13612                 <em class='brace'>{</em>
<a id='L13613' name='L13613'></a> 13613                   last = tem;
<a id='L13614' name='L13614'></a> 13614                   tem = tem-&gt;next;
<a id='L13615' name='L13615'></a> 13615                   <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (last);
<a id='L13616' name='L13616'></a> 13616                 <em class='brace'>}</em>
<a id='L13617' name='L13617'></a> 13617 
<a id='L13618' name='L13618'></a> 13618 <em class='sharp'>#ifndef</em> <a href='../S/2267.html#L3724' title='Defined at 3724 in src/lisp.h.'>HAVE_EXT_TOOL_BAR</a>
<a id='L13619' name='L13619'></a> 13619 
<a id='L13620' name='L13620'></a> 13620               <em class='comment'>/* Now look through each frame on DPYINFO.  If it has an</em>
<a id='L13621' name='L13621'></a> 13621 <em class='comment'>                 outstanding tool bar press for this device, release</em>
<a id='L13622' name='L13622'></a> 13622 <em class='comment'>                 the tool bar.  */</em>
<a id='L13623' name='L13623'></a> 13623 
<a id='L13624' name='L13624'></a> 13624               <a href='../S/2183.html#L1405' title='Defined at 1405 in src/frame.h.'>FOR_EACH_FRAME</a> (<a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)
<a id='L13625' name='L13625'></a> 13625                 <em class='brace'>{</em>
<a id='L13626' name='L13626'></a> 13626                   <strong class='reserved'>if</strong> (!<a href='../S/2183.html#L919' title='Defined at 919 in src/frame.h.'>FRAME_X_P</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>))
<a id='L13627' name='L13627'></a> 13627                       || (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>))
<a id='L13628' name='L13628'></a> 13628                           != dpyinfo))
<a id='L13629' name='L13629'></a> 13629                     <strong class='reserved'>continue</strong>;
<a id='L13630' name='L13630'></a> 13630 
<a id='L13631' name='L13631'></a> 13631                   output = <a href='../D/2368.html' title='Multiple defined in 7 places.'>FRAME_OUTPUT_DATA</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>));
<a id='L13632' name='L13632'></a> 13632 
<a id='L13633' name='L13633'></a> 13633                   <strong class='reserved'>if</strong> (output-&gt;tool_bar_touch_device
<a id='L13634' name='L13634'></a> 13634                       == dpyinfo-&gt;devices[i].device_id)
<a id='L13635' name='L13635'></a> 13635                     <em class='brace'>{</em>
<a id='L13636' name='L13636'></a> 13636                       <strong class='reserved'>if</strong> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)-&gt;last_tool_bar_item != -1
<a id='L13637' name='L13637'></a> 13637                           &amp;&amp; <a href='../D/6789.html' title='Multiple defined in 2 places.'>WINDOWP</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)-&gt;tool_bar_window))
<a id='L13638' name='L13638'></a> 13638                         <a href='../S/2224.html#L15755' title='Defined at 15755 in src/xdisp.c.'>handle_tool_bar_click</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>), 0, 0,
<a id='L13639' name='L13639'></a> 13639                                                <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>, 0);
<a id='L13640' name='L13640'></a> 13640 
<a id='L13641' name='L13641'></a> 13641                       output-&gt;tool_bar_touch_device = 0;
<a id='L13642' name='L13642'></a> 13642                     <em class='brace'>}</em>
<a id='L13643' name='L13643'></a> 13643                 <em class='brace'>}</em>
<a id='L13644' name='L13644'></a> 13644 <em class='sharp'>#endif</em>
<a id='L13645' name='L13645'></a> 13645 <em class='sharp'>#endif</em>
<a id='L13646' name='L13646'></a> 13646 
<a id='L13647' name='L13647'></a> 13647               <strong class='reserved'>goto</strong> out;
<a id='L13648' name='L13648'></a> 13648             <em class='brace'>}</em>
<a id='L13649' name='L13649'></a> 13649 
<a id='L13650' name='L13650'></a> 13650           devices[ndevices++] = dpyinfo-&gt;devices[i];
<a id='L13651' name='L13651'></a> 13651 
<a id='L13652' name='L13652'></a> 13652         out:
<a id='L13653' name='L13653'></a> 13653           <strong class='reserved'>continue</strong>;
<a id='L13654' name='L13654'></a> 13654         <em class='brace'>}</em>
<a id='L13655' name='L13655'></a> 13655     <em class='brace'>}</em>
<a id='L13656' name='L13656'></a> 13656 
<a id='L13657' name='L13657'></a> 13657   <em class='comment'>/* Free the old devices array and replace it with ndevices.  */</em>
<a id='L13658' name='L13658'></a> 13658   <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (dpyinfo-&gt;devices);
<a id='L13659' name='L13659'></a> 13659 
<a id='L13660' name='L13660'></a> 13660   dpyinfo-&gt;devices = devices;
<a id='L13661' name='L13661'></a> 13661   dpyinfo-&gt;num_devices = ndevices;
<a id='L13662' name='L13662'></a> 13662 <em class='brace'>}</em>
<a id='L13663' name='L13663'></a> 13663 
<a id='L13664' name='L13664'></a> 13664 <em class='sharp'>#endif</em>
<a id='L13665' name='L13665'></a> 13665 
<a id='L13666' name='L13666'></a> 13666 <em class='comment'>/* The focus may have changed.  Figure out if it is a real focus change,</em>
<a id='L13667' name='L13667'></a> 13667 <em class='comment'>   by checking both FocusIn/Out and Enter/LeaveNotify events.</em>
<a id='L13668' name='L13668'></a> 13668 <em class='comment'></em>
<a id='L13669' name='L13669'></a> 13669 <em class='comment'>   Returns FOCUS_IN_EVENT event in *BUFP. */</em>
<a id='L13670' name='L13670'></a> 13670 
<a id='L13671' name='L13671'></a> 13671 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L13672' name='L13672'></a> 13672 x_detect_focus_change (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo, <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>,
<a id='L13673' name='L13673'></a> 13673                        <strong class='reserved'>const</strong> XEvent *event, <strong class='reserved'>struct</strong> <a href='../S/2231.html#L350' title='Defined at 350 in src/termhooks.h.'>input_event</a> *bufp)
<a id='L13674' name='L13674'></a> 13674 <em class='brace'>{</em>
<a id='L13675' name='L13675'></a> 13675   <strong class='reserved'>if</strong> (!<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)
<a id='L13676' name='L13676'></a> 13676     <strong class='reserved'>return</strong>;
<a id='L13677' name='L13677'></a> 13677 
<a id='L13678' name='L13678'></a> 13678   <strong class='reserved'>switch</strong> (event-&gt;type)
<a id='L13679' name='L13679'></a> 13679     <em class='brace'>{</em>
<a id='L13680' name='L13680'></a> 13680     <strong class='reserved'>case</strong> EnterNotify:
<a id='L13681' name='L13681'></a> 13681     <strong class='reserved'>case</strong> LeaveNotify:
<a id='L13682' name='L13682'></a> 13682       <em class='brace'>{</em>
<a id='L13683' name='L13683'></a> 13683         <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *focus_frame = dpyinfo-&gt;x_focus_event_frame;
<a id='L13684' name='L13684'></a> 13684         <strong class='reserved'>int</strong> focus_state
<a id='L13685' name='L13685'></a> 13685           = focus_frame ? focus_frame-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;focus_state : 0;
<a id='L13686' name='L13686'></a> 13686 
<a id='L13687' name='L13687'></a> 13687         <strong class='reserved'>if</strong> (event-&gt;xcrossing.detail != NotifyInferior
<a id='L13688' name='L13688'></a> 13688             &amp;&amp; event-&gt;xcrossing.focus
<a id='L13689' name='L13689'></a> 13689             &amp;&amp; ! (focus_state &amp; <a href='../D/2139.html' title='Multiple defined in 4 places.'>FOCUS_EXPLICIT</a>))
<a id='L13690' name='L13690'></a> 13690           <a href='../S/2289.html#L11888' title='Defined at 11888 in src/xterm.c.'>x_focus_changed</a> ((event-&gt;type == EnterNotify ? FocusIn : FocusOut),
<a id='L13691' name='L13691'></a> 13691                            <a href='../D/2140.html' title='Multiple defined in 4 places.'>FOCUS_IMPLICIT</a>,
<a id='L13692' name='L13692'></a> 13692                            dpyinfo, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, bufp);
<a id='L13693' name='L13693'></a> 13693       <em class='brace'>}</em>
<a id='L13694' name='L13694'></a> 13694       <strong class='reserved'>break</strong>;
<a id='L13695' name='L13695'></a> 13695 
<a id='L13696' name='L13696'></a> 13696     <strong class='reserved'>case</strong> FocusIn:
<a id='L13697' name='L13697'></a> 13697     <strong class='reserved'>case</strong> FocusOut:
<a id='L13698' name='L13698'></a> 13698       <em class='comment'>/* Ignore transient focus events from hotkeys, window manager</em>
<a id='L13699' name='L13699'></a> 13699 <em class='comment'>         gadgets, and other odd sources.  Some buggy window managers</em>
<a id='L13700' name='L13700'></a> 13700 <em class='comment'>         (e.g., Muffin 4.2.4) send FocusIn events of this type without</em>
<a id='L13701' name='L13701'></a> 13701 <em class='comment'>         corresponding FocusOut events even when some other window</em>
<a id='L13702' name='L13702'></a> 13702 <em class='comment'>         really has focus, and these kinds of focus event don't</em>
<a id='L13703' name='L13703'></a> 13703 <em class='comment'>         correspond to real user input changes.  GTK+ uses the same</em>
<a id='L13704' name='L13704'></a> 13704 <em class='comment'>         filtering. */</em>
<a id='L13705' name='L13705'></a> 13705       <strong class='reserved'>if</strong> (event-&gt;xfocus.mode == NotifyGrab
<a id='L13706' name='L13706'></a> 13706           || event-&gt;xfocus.mode == NotifyUngrab)
<a id='L13707' name='L13707'></a> 13707         <strong class='reserved'>return</strong>;
<a id='L13708' name='L13708'></a> 13708       <a href='../S/2289.html#L11888' title='Defined at 11888 in src/xterm.c.'>x_focus_changed</a> (event-&gt;type,
<a id='L13709' name='L13709'></a> 13709                        (event-&gt;xfocus.detail == NotifyPointer ?
<a id='L13710' name='L13710'></a> 13710                         <a href='../D/2140.html' title='Multiple defined in 4 places.'>FOCUS_IMPLICIT</a> : <a href='../D/2139.html' title='Multiple defined in 4 places.'>FOCUS_EXPLICIT</a>),
<a id='L13711' name='L13711'></a> 13711                        dpyinfo, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, bufp);
<a id='L13712' name='L13712'></a> 13712       <strong class='reserved'>break</strong>;
<a id='L13713' name='L13713'></a> 13713 
<a id='L13714' name='L13714'></a> 13714     <strong class='reserved'>case</strong> ClientMessage:
<a id='L13715' name='L13715'></a> 13715       <strong class='reserved'>if</strong> (event-&gt;xclient.message_type == dpyinfo-&gt;Xatom_XEMBED)
<a id='L13716' name='L13716'></a> 13716         <em class='brace'>{</em>
<a id='L13717' name='L13717'></a> 13717           <strong class='reserved'>enum</strong> <a href='../S/2289.html#L1144' title='Defined at 1144 in src/xterm.c.'>xembed_message</a> msg = event-&gt;xclient.data.l[1];
<a id='L13718' name='L13718'></a> 13718           <a href='../S/2289.html#L11888' title='Defined at 11888 in src/xterm.c.'>x_focus_changed</a> ((msg == <a href='../S/2289.html#L1150' title='Defined at 1150 in src/xterm.c.'>XEMBED_FOCUS_IN</a> ? FocusIn : FocusOut),
<a id='L13719' name='L13719'></a> 13719                            <a href='../D/2139.html' title='Multiple defined in 4 places.'>FOCUS_EXPLICIT</a>, dpyinfo, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, bufp);
<a id='L13720' name='L13720'></a> 13720         <em class='brace'>}</em>
<a id='L13721' name='L13721'></a> 13721       <strong class='reserved'>break</strong>;
<a id='L13722' name='L13722'></a> 13722     <em class='brace'>}</em>
<a id='L13723' name='L13723'></a> 13723 <em class='brace'>}</em>
<a id='L13724' name='L13724'></a> 13724 
<a id='L13725' name='L13725'></a> 13725 
<a id='L13726' name='L13726'></a> 13726 <em class='sharp'>#if</em> (<strong class='reserved'>defined</strong> USE_LUCID &amp;&amp; <strong class='reserved'>defined</strong> HAVE_XINPUT2) \
<a id='L13727' name='L13727'></a> 13727   || (!<strong class='reserved'>defined</strong> USE_X_TOOLKIT &amp;&amp; !<strong class='reserved'>defined</strong> USE_GTK)
<a id='L13728' name='L13728'></a> 13728 <em class='comment'>/* Handle an event saying the mouse has moved out of an Emacs frame.  */</em>
<a id='L13729' name='L13729'></a> 13729 
<a id='L13730' name='L13730'></a> 13730 <strong class='reserved'>void</strong>
<a id='L13731' name='L13731'></a> 13731 x_mouse_leave (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo)
<a id='L13732' name='L13732'></a> 13732 <em class='brace'>{</em>
<a id='L13733' name='L13733'></a> 13733 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XINPUT2 &amp;&amp; !<strong class='reserved'>defined</strong> USE_X_TOOLKIT
<a id='L13734' name='L13734'></a> 13734   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L275' title='Defined at 275 in src/xterm.h.'>xi_device_t</a> *device;
<a id='L13735' name='L13735'></a> 13735 <em class='sharp'>#endif</em>
<a id='L13736' name='L13736'></a> 13736   <a href='../S/2315.html#L2919' title='Defined at 2919 in src/dispextern.h.'>Mouse_HLInfo</a> *hlinfo;
<a id='L13737' name='L13737'></a> 13737 
<a id='L13738' name='L13738'></a> 13738   hlinfo = &amp;dpyinfo-&gt;mouse_highlight;
<a id='L13739' name='L13739'></a> 13739 
<a id='L13740' name='L13740'></a> 13740   <strong class='reserved'>if</strong> (hlinfo-&gt;mouse_face_mouse_frame)
<a id='L13741' name='L13741'></a> 13741     <em class='brace'>{</em>
<a id='L13742' name='L13742'></a> 13742       <a href='../S/2224.html#L34014' title='Defined at 34014 in src/xdisp.c.'>clear_mouse_face</a> (hlinfo);
<a id='L13743' name='L13743'></a> 13743       hlinfo-&gt;mouse_face_mouse_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L13744' name='L13744'></a> 13744     <em class='brace'>}</em>
<a id='L13745' name='L13745'></a> 13745 
<a id='L13746' name='L13746'></a> 13746 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XINPUT2 &amp;&amp; !<strong class='reserved'>defined</strong> USE_X_TOOLKIT
<a id='L13747' name='L13747'></a> 13747   <strong class='reserved'>if</strong> (!dpyinfo-&gt;supports_xi2)
<a id='L13748' name='L13748'></a> 13748     <em class='comment'>/* The call below is supposed to reset the implicit focus and</em>
<a id='L13749' name='L13749'></a> 13749 <em class='comment'>       revert the focus back to the last explicitly focused frame.  It</em>
<a id='L13750' name='L13750'></a> 13750 <em class='comment'>       doesn't work on input extension builds because focus tracking</em>
<a id='L13751' name='L13751'></a> 13751 <em class='comment'>       does not set x_focus_event_frame, and proceeds on a per-device</em>
<a id='L13752' name='L13752'></a> 13752 <em class='comment'>       basis.  On such builds, clear the implicit focus of the client</em>
<a id='L13753' name='L13753'></a> 13753 <em class='comment'>       pointer instead.  */</em>
<a id='L13754' name='L13754'></a> 13754 <em class='sharp'>#endif</em>
<a id='L13755' name='L13755'></a> 13755     <a href='../S/2289.html#L11713' title='Defined at 11713 in src/xterm.c.'>x_new_focus_frame</a> (dpyinfo, dpyinfo-&gt;x_focus_event_frame);
<a id='L13756' name='L13756'></a> 13756 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XINPUT2 &amp;&amp; !<strong class='reserved'>defined</strong> USE_X_TOOLKIT
<a id='L13757' name='L13757'></a> 13757   <strong class='reserved'>else</strong>
<a id='L13758' name='L13758'></a> 13758     <em class='brace'>{</em>
<a id='L13759' name='L13759'></a> 13759       <strong class='reserved'>if</strong> (dpyinfo-&gt;client_pointer_device == -1)
<a id='L13760' name='L13760'></a> 13760         <em class='comment'>/* If there's no client pointer device, then no implicit focus</em>
<a id='L13761' name='L13761'></a> 13761 <em class='comment'>           is currently set.  */</em>
<a id='L13762' name='L13762'></a> 13762         <strong class='reserved'>return</strong>;
<a id='L13763' name='L13763'></a> 13763 
<a id='L13764' name='L13764'></a> 13764       device = <a href='../S/2289.html#L5732' title='Defined at 5732 in src/xterm.c.'>xi_device_from_id</a> (dpyinfo, dpyinfo-&gt;client_pointer_device);
<a id='L13765' name='L13765'></a> 13765 
<a id='L13766' name='L13766'></a> 13766       <strong class='reserved'>if</strong> (device &amp;&amp; device-&gt;focus_implicit_frame)
<a id='L13767' name='L13767'></a> 13767         <em class='brace'>{</em>
<a id='L13768' name='L13768'></a> 13768           device-&gt;focus_implicit_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L13769' name='L13769'></a> 13769 
<a id='L13770' name='L13770'></a> 13770           <em class='comment'>/* The focus might have changed; compute the new focus.  */</em>
<a id='L13771' name='L13771'></a> 13771           xi_handle_focus_change (dpyinfo);
<a id='L13772' name='L13772'></a> 13772         <em class='brace'>}</em>
<a id='L13773' name='L13773'></a> 13773     <em class='brace'>}</em>
<a id='L13774' name='L13774'></a> 13774 <em class='sharp'>#endif</em>
<a id='L13775' name='L13775'></a> 13775 <em class='brace'>}</em>
<a id='L13776' name='L13776'></a> 13776 <em class='sharp'>#endif</em>
<a id='L13777' name='L13777'></a> 13777 
<a id='L13778' name='L13778'></a> 13778 <em class='comment'>/* The focus has changed, or we have redirected a frame's focus to</em>
<a id='L13779' name='L13779'></a> 13779 <em class='comment'>   another frame (this happens when a frame uses a surrogate</em>
<a id='L13780' name='L13780'></a> 13780 <em class='comment'>   mini-buffer frame).  Shift the highlight as appropriate.</em>
<a id='L13781' name='L13781'></a> 13781 <em class='comment'></em>
<a id='L13782' name='L13782'></a> 13782 <em class='comment'>   The FRAME argument doesn't necessarily have anything to do with which</em>
<a id='L13783' name='L13783'></a> 13783 <em class='comment'>   frame is being highlighted or un-highlighted; we only use it to find</em>
<a id='L13784' name='L13784'></a> 13784 <em class='comment'>   the appropriate X display info.  */</em>
<a id='L13785' name='L13785'></a> 13785 
<a id='L13786' name='L13786'></a> 13786 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L13787' name='L13787'></a> 13787 XTframe_rehighlight (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)
<a id='L13788' name='L13788'></a> 13788 <em class='brace'>{</em>
<a id='L13789' name='L13789'></a> 13789   x_frame_rehighlight (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>));
<a id='L13790' name='L13790'></a> 13790 <em class='brace'>}</em>
<a id='L13791' name='L13791'></a> 13791 
<a id='L13792' name='L13792'></a> 13792 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L13793' name='L13793'></a> 13793 x_frame_rehighlight (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo)
<a id='L13794' name='L13794'></a> 13794 <em class='brace'>{</em>
<a id='L13795' name='L13795'></a> 13795   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *old_highlight = dpyinfo-&gt;highlight_frame;
<a id='L13796' name='L13796'></a> 13796 
<a id='L13797' name='L13797'></a> 13797   <strong class='reserved'>if</strong> (dpyinfo-&gt;x_focus_frame)
<a id='L13798' name='L13798'></a> 13798     <em class='brace'>{</em>
<a id='L13799' name='L13799'></a> 13799       dpyinfo-&gt;highlight_frame
<a id='L13800' name='L13800'></a> 13800         = ((<a href='../D/2249.html' title='Multiple defined in 2 places.'>FRAMEP</a> (<a href='../S/2183.html#L1214' title='Defined at 1214 in src/frame.h.'>FRAME_FOCUS_FRAME</a> (dpyinfo-&gt;x_focus_frame)))
<a id='L13801' name='L13801'></a> 13801            ? <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../S/2183.html#L1214' title='Defined at 1214 in src/frame.h.'>FRAME_FOCUS_FRAME</a> (dpyinfo-&gt;x_focus_frame))
<a id='L13802' name='L13802'></a> 13802            : dpyinfo-&gt;x_focus_frame);
<a id='L13803' name='L13803'></a> 13803       <strong class='reserved'>if</strong> (! <a href='../S/2183.html#L1028' title='Defined at 1028 in src/frame.h.'>FRAME_LIVE_P</a> (dpyinfo-&gt;highlight_frame))
<a id='L13804' name='L13804'></a> 13804         <em class='brace'>{</em>
<a id='L13805' name='L13805'></a> 13805           <a href='../S/2183.html#L765' title='Defined at 765 in src/frame.h.'>fset_focus_frame</a> (dpyinfo-&gt;x_focus_frame, Qnil);
<a id='L13806' name='L13806'></a> 13806           dpyinfo-&gt;highlight_frame = dpyinfo-&gt;x_focus_frame;
<a id='L13807' name='L13807'></a> 13807         <em class='brace'>}</em>
<a id='L13808' name='L13808'></a> 13808     <em class='brace'>}</em>
<a id='L13809' name='L13809'></a> 13809   <strong class='reserved'>else</strong>
<a id='L13810' name='L13810'></a> 13810     dpyinfo-&gt;highlight_frame = 0;
<a id='L13811' name='L13811'></a> 13811 
<a id='L13812' name='L13812'></a> 13812   <strong class='reserved'>if</strong> (dpyinfo-&gt;highlight_frame != old_highlight)
<a id='L13813' name='L13813'></a> 13813     <em class='brace'>{</em>
<a id='L13814' name='L13814'></a> 13814       <strong class='reserved'>if</strong> (old_highlight)
<a id='L13815' name='L13815'></a> 13815         <a href='../S/2289.html#L11683' title='Defined at 11683 in src/xterm.c.'>x_frame_unhighlight</a> (old_highlight);
<a id='L13816' name='L13816'></a> 13816       <strong class='reserved'>if</strong> (dpyinfo-&gt;highlight_frame)
<a id='L13817' name='L13817'></a> 13817         <a href='../S/2289.html#L11658' title='Defined at 11658 in src/xterm.c.'>x_frame_highlight</a> (dpyinfo-&gt;highlight_frame);
<a id='L13818' name='L13818'></a> 13818     <em class='brace'>}</em>
<a id='L13819' name='L13819'></a> 13819 <em class='brace'>}</em>
<a id='L13820' name='L13820'></a> 13820 
<a id='L13821' name='L13821'></a> 13821 
<a id='L13822' name='L13822'></a> 13822 
<a id='L13823' name='L13823'></a> 13823 <em class='comment'>/* Keyboard processing - modifier keys, vendor-specific keysyms, etc.  */</em>
<a id='L13824' name='L13824'></a> 13824 
<a id='L13825' name='L13825'></a> 13825 <em class='comment'>/* Initialize mode_switch_bit and modifier_meaning.  */</em>
<a id='L13826' name='L13826'></a> 13826 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L13827' name='L13827'></a> 13827 x_find_modifier_meanings (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo)
<a id='L13828' name='L13828'></a> 13828 <em class='brace'>{</em>
<a id='L13829' name='L13829'></a> 13829   <strong class='reserved'>int</strong> min_code, max_code;
<a id='L13830' name='L13830'></a> 13830   KeySym *syms;
<a id='L13831' name='L13831'></a> 13831   <strong class='reserved'>int</strong> syms_per_code;
<a id='L13832' name='L13832'></a> 13832   XModifierKeymap *mods;
<a id='L13833' name='L13833'></a> 13833 <em class='sharp'>#ifdef</em> HAVE_XKB
<a id='L13834' name='L13834'></a> 13834   <strong class='reserved'>int</strong> i;
<a id='L13835' name='L13835'></a> 13835   <strong class='reserved'>int</strong> found_meta_p = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L13836' name='L13836'></a> 13836   <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> vmodmask;
<a id='L13837' name='L13837'></a> 13837 <em class='sharp'>#endif</em>
<a id='L13838' name='L13838'></a> 13838 
<a id='L13839' name='L13839'></a> 13839   dpyinfo-&gt;meta_mod_mask = 0;
<a id='L13840' name='L13840'></a> 13840   dpyinfo-&gt;shift_lock_mask = 0;
<a id='L13841' name='L13841'></a> 13841   dpyinfo-&gt;alt_mod_mask = 0;
<a id='L13842' name='L13842'></a> 13842   dpyinfo-&gt;super_mod_mask = 0;
<a id='L13843' name='L13843'></a> 13843   dpyinfo-&gt;hyper_mod_mask = 0;
<a id='L13844' name='L13844'></a> 13844 
<a id='L13845' name='L13845'></a> 13845 <em class='sharp'>#ifdef</em> HAVE_XKB
<a id='L13846' name='L13846'></a> 13846   <strong class='reserved'>if</strong> (dpyinfo-&gt;xkb_desc
<a id='L13847' name='L13847'></a> 13847       &amp;&amp; dpyinfo-&gt;xkb_desc-&gt;server)
<a id='L13848' name='L13848'></a> 13848     <em class='brace'>{</em>
<a id='L13849' name='L13849'></a> 13849       <strong class='reserved'>for</strong> (i = 0; i &lt; XkbNumVirtualMods; i++)
<a id='L13850' name='L13850'></a> 13850         <em class='brace'>{</em>
<a id='L13851' name='L13851'></a> 13851           vmodmask = dpyinfo-&gt;xkb_desc-&gt;server-&gt;vmods[i];
<a id='L13852' name='L13852'></a> 13852 
<a id='L13853' name='L13853'></a> 13853           <strong class='reserved'>if</strong> (dpyinfo-&gt;xkb_desc-&gt;names-&gt;vmods[i] == dpyinfo-&gt;Xatom_Meta)
<a id='L13854' name='L13854'></a> 13854             <em class='brace'>{</em>
<a id='L13855' name='L13855'></a> 13855               dpyinfo-&gt;meta_mod_mask |= vmodmask;
<a id='L13856' name='L13856'></a> 13856 
<a id='L13857' name='L13857'></a> 13857               <strong class='reserved'>if</strong> (vmodmask)
<a id='L13858' name='L13858'></a> 13858                 found_meta_p = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L13859' name='L13859'></a> 13859             <em class='brace'>}</em>
<a id='L13860' name='L13860'></a> 13860           <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (dpyinfo-&gt;xkb_desc-&gt;names-&gt;vmods[i] == dpyinfo-&gt;Xatom_Alt)
<a id='L13861' name='L13861'></a> 13861             dpyinfo-&gt;alt_mod_mask |= vmodmask;
<a id='L13862' name='L13862'></a> 13862           <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (dpyinfo-&gt;xkb_desc-&gt;names-&gt;vmods[i] == dpyinfo-&gt;Xatom_Super)
<a id='L13863' name='L13863'></a> 13863             dpyinfo-&gt;super_mod_mask |= vmodmask;
<a id='L13864' name='L13864'></a> 13864           <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (dpyinfo-&gt;xkb_desc-&gt;names-&gt;vmods[i] == dpyinfo-&gt;Xatom_Hyper)
<a id='L13865' name='L13865'></a> 13865             dpyinfo-&gt;hyper_mod_mask |= vmodmask;
<a id='L13866' name='L13866'></a> 13866           <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (dpyinfo-&gt;xkb_desc-&gt;names-&gt;vmods[i] == dpyinfo-&gt;Xatom_ShiftLock)
<a id='L13867' name='L13867'></a> 13867             dpyinfo-&gt;shift_lock_mask |= vmodmask;
<a id='L13868' name='L13868'></a> 13868         <em class='brace'>}</em>
<a id='L13869' name='L13869'></a> 13869 
<a id='L13870' name='L13870'></a> 13870       <strong class='reserved'>if</strong> (!found_meta_p)
<a id='L13871' name='L13871'></a> 13871         <em class='brace'>{</em>
<a id='L13872' name='L13872'></a> 13872           dpyinfo-&gt;meta_mod_mask = dpyinfo-&gt;alt_mod_mask;
<a id='L13873' name='L13873'></a> 13873           dpyinfo-&gt;alt_mod_mask = 0;
<a id='L13874' name='L13874'></a> 13874         <em class='brace'>}</em>
<a id='L13875' name='L13875'></a> 13875 
<a id='L13876' name='L13876'></a> 13876       <strong class='reserved'>if</strong> (dpyinfo-&gt;alt_mod_mask &amp; dpyinfo-&gt;meta_mod_mask)
<a id='L13877' name='L13877'></a> 13877         dpyinfo-&gt;alt_mod_mask &amp;= ~dpyinfo-&gt;meta_mod_mask;
<a id='L13878' name='L13878'></a> 13878 
<a id='L13879' name='L13879'></a> 13879       <strong class='reserved'>if</strong> (dpyinfo-&gt;hyper_mod_mask &amp; dpyinfo-&gt;super_mod_mask)
<a id='L13880' name='L13880'></a> 13880         dpyinfo-&gt;hyper_mod_mask &amp;= ~dpyinfo-&gt;super_mod_mask;
<a id='L13881' name='L13881'></a> 13881 
<a id='L13882' name='L13882'></a> 13882       <strong class='reserved'>return</strong>;
<a id='L13883' name='L13883'></a> 13883     <em class='brace'>}</em>
<a id='L13884' name='L13884'></a> 13884 <em class='sharp'>#endif</em>
<a id='L13885' name='L13885'></a> 13885 
<a id='L13886' name='L13886'></a> 13886   XDisplayKeycodes (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, &amp;min_code, &amp;max_code);
<a id='L13887' name='L13887'></a> 13887 
<a id='L13888' name='L13888'></a> 13888   syms = XGetKeyboardMapping (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L13889' name='L13889'></a> 13889                               min_code, max_code - min_code + 1,
<a id='L13890' name='L13890'></a> 13890                               &amp;syms_per_code);
<a id='L13891' name='L13891'></a> 13891 
<a id='L13892' name='L13892'></a> 13892   <strong class='reserved'>if</strong> (!syms)
<a id='L13893' name='L13893'></a> 13893     <em class='brace'>{</em>
<a id='L13894' name='L13894'></a> 13894       dpyinfo-&gt;meta_mod_mask = Mod1Mask;
<a id='L13895' name='L13895'></a> 13895       dpyinfo-&gt;super_mod_mask = Mod2Mask;
<a id='L13896' name='L13896'></a> 13896       <strong class='reserved'>return</strong>;
<a id='L13897' name='L13897'></a> 13897     <em class='brace'>}</em>
<a id='L13898' name='L13898'></a> 13898 
<a id='L13899' name='L13899'></a> 13899   mods = XGetModifierMapping (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L13900' name='L13900'></a> 13900 
<a id='L13901' name='L13901'></a> 13901   <em class='comment'>/* Scan the modifier table to see which modifier bits the Meta and</em>
<a id='L13902' name='L13902'></a> 13902 <em class='comment'>     Alt keysyms are on.  */</em>
<a id='L13903' name='L13903'></a> 13903   <em class='brace'>{</em>
<a id='L13904' name='L13904'></a> 13904     <strong class='reserved'>int</strong> row, col;       <em class='comment'>/* The row and column in the modifier table.  */</em>
<a id='L13905' name='L13905'></a> 13905     <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> found_alt_or_meta;
<a id='L13906' name='L13906'></a> 13906 
<a id='L13907' name='L13907'></a> 13907     <strong class='reserved'>for</strong> (row = 3; row &lt; 8; row++)
<a id='L13908' name='L13908'></a> 13908       <em class='brace'>{</em>
<a id='L13909' name='L13909'></a> 13909         found_alt_or_meta = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L13910' name='L13910'></a> 13910         <strong class='reserved'>for</strong> (col = 0; col &lt; mods-&gt;max_keypermod; col++)
<a id='L13911' name='L13911'></a> 13911           <em class='brace'>{</em>
<a id='L13912' name='L13912'></a> 13912             KeyCode code = mods-&gt;modifiermap[(row * mods-&gt;max_keypermod) + col];
<a id='L13913' name='L13913'></a> 13913 
<a id='L13914' name='L13914'></a> 13914             <em class='comment'>/* Zeroes are used for filler.  Skip them.  */</em>
<a id='L13915' name='L13915'></a> 13915             <strong class='reserved'>if</strong> (code == 0)
<a id='L13916' name='L13916'></a> 13916               <strong class='reserved'>continue</strong>;
<a id='L13917' name='L13917'></a> 13917 
<a id='L13918' name='L13918'></a> 13918             <em class='comment'>/* Are any of this keycode's keysyms a meta key?  */</em>
<a id='L13919' name='L13919'></a> 13919             <em class='brace'>{</em>
<a id='L13920' name='L13920'></a> 13920               <strong class='reserved'>int</strong> code_col;
<a id='L13921' name='L13921'></a> 13921 
<a id='L13922' name='L13922'></a> 13922               <strong class='reserved'>for</strong> (code_col = 0; code_col &lt; syms_per_code; code_col++)
<a id='L13923' name='L13923'></a> 13923                 <em class='brace'>{</em>
<a id='L13924' name='L13924'></a> 13924                   <strong class='reserved'>int</strong> <a href='../S/2974.html#L278' title='Defined at 278 in lib-src/ebrowse.c.'>sym</a> = syms[((code - min_code) * syms_per_code) + code_col];
<a id='L13925' name='L13925'></a> 13925 
<a id='L13926' name='L13926'></a> 13926                   <strong class='reserved'>switch</strong> (<a href='../S/2974.html#L278' title='Defined at 278 in lib-src/ebrowse.c.'>sym</a>)
<a id='L13927' name='L13927'></a> 13927                     <em class='brace'>{</em>
<a id='L13928' name='L13928'></a> 13928                     <strong class='reserved'>case</strong> XK_Meta_L:
<a id='L13929' name='L13929'></a> 13929                     <strong class='reserved'>case</strong> XK_Meta_R:
<a id='L13930' name='L13930'></a> 13930                       found_alt_or_meta = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L13931' name='L13931'></a> 13931                       dpyinfo-&gt;meta_mod_mask |= (1 &lt;&lt; row);
<a id='L13932' name='L13932'></a> 13932                       <strong class='reserved'>break</strong>;
<a id='L13933' name='L13933'></a> 13933 
<a id='L13934' name='L13934'></a> 13934                     <strong class='reserved'>case</strong> XK_Alt_L:
<a id='L13935' name='L13935'></a> 13935                     <strong class='reserved'>case</strong> XK_Alt_R:
<a id='L13936' name='L13936'></a> 13936                       found_alt_or_meta = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L13937' name='L13937'></a> 13937                       dpyinfo-&gt;alt_mod_mask |= (1 &lt;&lt; row);
<a id='L13938' name='L13938'></a> 13938                       <strong class='reserved'>break</strong>;
<a id='L13939' name='L13939'></a> 13939 
<a id='L13940' name='L13940'></a> 13940                     <strong class='reserved'>case</strong> XK_Hyper_L:
<a id='L13941' name='L13941'></a> 13941                     <strong class='reserved'>case</strong> XK_Hyper_R:
<a id='L13942' name='L13942'></a> 13942                       <strong class='reserved'>if</strong> (!found_alt_or_meta)
<a id='L13943' name='L13943'></a> 13943                         dpyinfo-&gt;hyper_mod_mask |= (1 &lt;&lt; row);
<a id='L13944' name='L13944'></a> 13944                       code_col = syms_per_code;
<a id='L13945' name='L13945'></a> 13945                       col = mods-&gt;max_keypermod;
<a id='L13946' name='L13946'></a> 13946                       <strong class='reserved'>break</strong>;
<a id='L13947' name='L13947'></a> 13947 
<a id='L13948' name='L13948'></a> 13948                     <strong class='reserved'>case</strong> XK_Super_L:
<a id='L13949' name='L13949'></a> 13949                     <strong class='reserved'>case</strong> XK_Super_R:
<a id='L13950' name='L13950'></a> 13950                       <strong class='reserved'>if</strong> (!found_alt_or_meta)
<a id='L13951' name='L13951'></a> 13951                         dpyinfo-&gt;super_mod_mask |= (1 &lt;&lt; row);
<a id='L13952' name='L13952'></a> 13952                       code_col = syms_per_code;
<a id='L13953' name='L13953'></a> 13953                       col = mods-&gt;max_keypermod;
<a id='L13954' name='L13954'></a> 13954                       <strong class='reserved'>break</strong>;
<a id='L13955' name='L13955'></a> 13955 
<a id='L13956' name='L13956'></a> 13956                     <strong class='reserved'>case</strong> XK_Shift_Lock:
<a id='L13957' name='L13957'></a> 13957                       <em class='comment'>/* Ignore this if it's not on the lock modifier.  */</em>
<a id='L13958' name='L13958'></a> 13958                       <strong class='reserved'>if</strong> (!found_alt_or_meta &amp;&amp; ((1 &lt;&lt; row) == LockMask))
<a id='L13959' name='L13959'></a> 13959                         dpyinfo-&gt;shift_lock_mask = LockMask;
<a id='L13960' name='L13960'></a> 13960                       code_col = syms_per_code;
<a id='L13961' name='L13961'></a> 13961                       col = mods-&gt;max_keypermod;
<a id='L13962' name='L13962'></a> 13962                       <strong class='reserved'>break</strong>;
<a id='L13963' name='L13963'></a> 13963                     <em class='brace'>}</em>
<a id='L13964' name='L13964'></a> 13964                 <em class='brace'>}</em>
<a id='L13965' name='L13965'></a> 13965             <em class='brace'>}</em>
<a id='L13966' name='L13966'></a> 13966           <em class='brace'>}</em>
<a id='L13967' name='L13967'></a> 13967       <em class='brace'>}</em>
<a id='L13968' name='L13968'></a> 13968   <em class='brace'>}</em>
<a id='L13969' name='L13969'></a> 13969 
<a id='L13970' name='L13970'></a> 13970   <em class='comment'>/* If we couldn't find any meta keys, accept any alt keys as meta keys.  */</em>
<a id='L13971' name='L13971'></a> 13971   <strong class='reserved'>if</strong> (! dpyinfo-&gt;meta_mod_mask)
<a id='L13972' name='L13972'></a> 13972     <em class='brace'>{</em>
<a id='L13973' name='L13973'></a> 13973       dpyinfo-&gt;meta_mod_mask = dpyinfo-&gt;alt_mod_mask;
<a id='L13974' name='L13974'></a> 13974       dpyinfo-&gt;alt_mod_mask = 0;
<a id='L13975' name='L13975'></a> 13975     <em class='brace'>}</em>
<a id='L13976' name='L13976'></a> 13976 
<a id='L13977' name='L13977'></a> 13977   <em class='comment'>/* If some keys are both alt and meta,</em>
<a id='L13978' name='L13978'></a> 13978 <em class='comment'>     make them just meta, not alt.  */</em>
<a id='L13979' name='L13979'></a> 13979   <strong class='reserved'>if</strong> (dpyinfo-&gt;alt_mod_mask &amp; dpyinfo-&gt;meta_mod_mask)
<a id='L13980' name='L13980'></a> 13980     <em class='brace'>{</em>
<a id='L13981' name='L13981'></a> 13981       dpyinfo-&gt;alt_mod_mask &amp;= ~dpyinfo-&gt;meta_mod_mask;
<a id='L13982' name='L13982'></a> 13982     <em class='brace'>}</em>
<a id='L13983' name='L13983'></a> 13983 
<a id='L13984' name='L13984'></a> 13984   <em class='comment'>/* If some keys are both super and hyper, make them just super.</em>
<a id='L13985' name='L13985'></a> 13985 <em class='comment'>     Many X servers are misconfigured so that super and hyper are both</em>
<a id='L13986' name='L13986'></a> 13986 <em class='comment'>     Mod4, but most users have no hyper key.  */</em>
<a id='L13987' name='L13987'></a> 13987   <strong class='reserved'>if</strong> (dpyinfo-&gt;hyper_mod_mask &amp; dpyinfo-&gt;super_mod_mask)
<a id='L13988' name='L13988'></a> 13988     dpyinfo-&gt;hyper_mod_mask &amp;= ~dpyinfo-&gt;super_mod_mask;
<a id='L13989' name='L13989'></a> 13989 
<a id='L13990' name='L13990'></a> 13990   XFree (syms);
<a id='L13991' name='L13991'></a> 13991 
<a id='L13992' name='L13992'></a> 13992   <strong class='reserved'>if</strong> (dpyinfo-&gt;modmap)
<a id='L13993' name='L13993'></a> 13993     XFreeModifiermap (dpyinfo-&gt;modmap);
<a id='L13994' name='L13994'></a> 13994   dpyinfo-&gt;modmap = mods;
<a id='L13995' name='L13995'></a> 13995 <em class='brace'>}</em>
<a id='L13996' name='L13996'></a> 13996 
<a id='L13997' name='L13997'></a> 13997 <em class='comment'>/* Convert between the modifier bits X uses and the modifier bits</em>
<a id='L13998' name='L13998'></a> 13998 <em class='comment'>   Emacs uses.  */</em>
<a id='L13999' name='L13999'></a> 13999 
<a id='L14000' name='L14000'></a> 14000 <strong class='reserved'>int</strong>
<a id='L14001' name='L14001'></a> 14001 x_x_to_emacs_modifiers (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo, <strong class='reserved'>int</strong> state)
<a id='L14002' name='L14002'></a> 14002 <em class='brace'>{</em>
<a id='L14003' name='L14003'></a> 14003   <strong class='reserved'>int</strong> mod_ctrl = <a href='../S/2231.html#L441' title='Defined at 441 in src/termhooks.h.'>ctrl_modifier</a>;
<a id='L14004' name='L14004'></a> 14004   <strong class='reserved'>int</strong> mod_meta = <a href='../S/2231.html#L442' title='Defined at 442 in src/termhooks.h.'>meta_modifier</a>;
<a id='L14005' name='L14005'></a> 14005   <strong class='reserved'>int</strong> mod_alt  = <a href='../S/2231.html#L437' title='Defined at 437 in src/termhooks.h.'>alt_modifier</a>;
<a id='L14006' name='L14006'></a> 14006   <strong class='reserved'>int</strong> mod_hyper = <a href='../S/2231.html#L439' title='Defined at 439 in src/termhooks.h.'>hyper_modifier</a>;
<a id='L14007' name='L14007'></a> 14007   <strong class='reserved'>int</strong> mod_super = <a href='../S/2231.html#L438' title='Defined at 438 in src/termhooks.h.'>super_modifier</a>;
<a id='L14008' name='L14008'></a> 14008   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> tem;
<a id='L14009' name='L14009'></a> 14009 
<a id='L14010' name='L14010'></a> 14010   tem = Fget (Vx_ctrl_keysym, Qmodifier_value);
<a id='L14011' name='L14011'></a> 14011   <strong class='reserved'>if</strong> (<a href='../S/2267.html#L469' title='Defined at 469 in src/lisp.h.'>FIXNUMP</a> (tem)) mod_ctrl = <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (tem) &amp; INT_MAX;
<a id='L14012' name='L14012'></a> 14012   tem = Fget (Vx_alt_keysym, Qmodifier_value);
<a id='L14013' name='L14013'></a> 14013   <strong class='reserved'>if</strong> (<a href='../S/2267.html#L469' title='Defined at 469 in src/lisp.h.'>FIXNUMP</a> (tem)) mod_alt = <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (tem) &amp; INT_MAX;
<a id='L14014' name='L14014'></a> 14014   tem = Fget (Vx_meta_keysym, Qmodifier_value);
<a id='L14015' name='L14015'></a> 14015   <strong class='reserved'>if</strong> (<a href='../S/2267.html#L469' title='Defined at 469 in src/lisp.h.'>FIXNUMP</a> (tem)) mod_meta = <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (tem) &amp; INT_MAX;
<a id='L14016' name='L14016'></a> 14016   tem = Fget (Vx_hyper_keysym, Qmodifier_value);
<a id='L14017' name='L14017'></a> 14017   <strong class='reserved'>if</strong> (<a href='../S/2267.html#L469' title='Defined at 469 in src/lisp.h.'>FIXNUMP</a> (tem)) mod_hyper = <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (tem) &amp; INT_MAX;
<a id='L14018' name='L14018'></a> 14018   tem = Fget (Vx_super_keysym, Qmodifier_value);
<a id='L14019' name='L14019'></a> 14019   <strong class='reserved'>if</strong> (<a href='../S/2267.html#L469' title='Defined at 469 in src/lisp.h.'>FIXNUMP</a> (tem)) mod_super = <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (tem) &amp; INT_MAX;
<a id='L14020' name='L14020'></a> 14020 
<a id='L14021' name='L14021'></a> 14021   <strong class='reserved'>return</strong> (  ((state &amp; (ShiftMask | dpyinfo-&gt;shift_lock_mask)) ? <a href='../S/2231.html#L440' title='Defined at 440 in src/termhooks.h.'>shift_modifier</a> : 0)
<a id='L14022' name='L14022'></a> 14022             | ((state &amp; ControlMask)                    ? mod_ctrl      : 0)
<a id='L14023' name='L14023'></a> 14023             | ((state &amp; dpyinfo-&gt;meta_mod_mask)         ? mod_meta      : 0)
<a id='L14024' name='L14024'></a> 14024             | ((state &amp; dpyinfo-&gt;alt_mod_mask)          ? mod_alt       : 0)
<a id='L14025' name='L14025'></a> 14025             | ((state &amp; dpyinfo-&gt;super_mod_mask)        ? mod_super     : 0)
<a id='L14026' name='L14026'></a> 14026             | ((state &amp; dpyinfo-&gt;hyper_mod_mask)        ? mod_hyper     : 0));
<a id='L14027' name='L14027'></a> 14027 <em class='brace'>}</em>
<a id='L14028' name='L14028'></a> 14028 
<a id='L14029' name='L14029'></a> 14029 <strong class='reserved'>int</strong>
<a id='L14030' name='L14030'></a> 14030 x_emacs_to_x_modifiers (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo, <a href='../D/13420.html' title='Multiple defined in 6 places.'>intmax_t</a> state)
<a id='L14031' name='L14031'></a> 14031 <em class='brace'>{</em>
<a id='L14032' name='L14032'></a> 14032   <a href='../D/1718.html' title='Multiple defined in 11 places.'>EMACS_INT</a> mod_ctrl = <a href='../S/2231.html#L441' title='Defined at 441 in src/termhooks.h.'>ctrl_modifier</a>;
<a id='L14033' name='L14033'></a> 14033   <a href='../D/1718.html' title='Multiple defined in 11 places.'>EMACS_INT</a> mod_meta = <a href='../S/2231.html#L442' title='Defined at 442 in src/termhooks.h.'>meta_modifier</a>;
<a id='L14034' name='L14034'></a> 14034   <a href='../D/1718.html' title='Multiple defined in 11 places.'>EMACS_INT</a> mod_alt  = <a href='../S/2231.html#L437' title='Defined at 437 in src/termhooks.h.'>alt_modifier</a>;
<a id='L14035' name='L14035'></a> 14035   <a href='../D/1718.html' title='Multiple defined in 11 places.'>EMACS_INT</a> mod_hyper = <a href='../S/2231.html#L439' title='Defined at 439 in src/termhooks.h.'>hyper_modifier</a>;
<a id='L14036' name='L14036'></a> 14036   <a href='../D/1718.html' title='Multiple defined in 11 places.'>EMACS_INT</a> mod_super = <a href='../S/2231.html#L438' title='Defined at 438 in src/termhooks.h.'>super_modifier</a>;
<a id='L14037' name='L14037'></a> 14037 
<a id='L14038' name='L14038'></a> 14038   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> tem;
<a id='L14039' name='L14039'></a> 14039 
<a id='L14040' name='L14040'></a> 14040   tem = Fget (Vx_ctrl_keysym, Qmodifier_value);
<a id='L14041' name='L14041'></a> 14041   <strong class='reserved'>if</strong> (<a href='../S/2267.html#L469' title='Defined at 469 in src/lisp.h.'>FIXNUMP</a> (tem)) mod_ctrl = <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (tem);
<a id='L14042' name='L14042'></a> 14042   tem = Fget (Vx_alt_keysym, Qmodifier_value);
<a id='L14043' name='L14043'></a> 14043   <strong class='reserved'>if</strong> (<a href='../S/2267.html#L469' title='Defined at 469 in src/lisp.h.'>FIXNUMP</a> (tem)) mod_alt = <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (tem);
<a id='L14044' name='L14044'></a> 14044   tem = Fget (Vx_meta_keysym, Qmodifier_value);
<a id='L14045' name='L14045'></a> 14045   <strong class='reserved'>if</strong> (<a href='../S/2267.html#L469' title='Defined at 469 in src/lisp.h.'>FIXNUMP</a> (tem)) mod_meta = <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (tem);
<a id='L14046' name='L14046'></a> 14046   tem = Fget (Vx_hyper_keysym, Qmodifier_value);
<a id='L14047' name='L14047'></a> 14047   <strong class='reserved'>if</strong> (<a href='../S/2267.html#L469' title='Defined at 469 in src/lisp.h.'>FIXNUMP</a> (tem)) mod_hyper = <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (tem);
<a id='L14048' name='L14048'></a> 14048   tem = Fget (Vx_super_keysym, Qmodifier_value);
<a id='L14049' name='L14049'></a> 14049   <strong class='reserved'>if</strong> (<a href='../S/2267.html#L469' title='Defined at 469 in src/lisp.h.'>FIXNUMP</a> (tem)) mod_super = <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (tem);
<a id='L14050' name='L14050'></a> 14050 
<a id='L14051' name='L14051'></a> 14051 
<a id='L14052' name='L14052'></a> 14052   <strong class='reserved'>return</strong> (  ((state &amp; mod_alt)          ? dpyinfo-&gt;alt_mod_mask   : 0)
<a id='L14053' name='L14053'></a> 14053             | ((state &amp; mod_super)      ? dpyinfo-&gt;super_mod_mask : 0)
<a id='L14054' name='L14054'></a> 14054             | ((state &amp; mod_hyper)      ? dpyinfo-&gt;hyper_mod_mask : 0)
<a id='L14055' name='L14055'></a> 14055             | ((state &amp; <a href='../S/2231.html#L440' title='Defined at 440 in src/termhooks.h.'>shift_modifier</a>) ? ShiftMask        : 0)
<a id='L14056' name='L14056'></a> 14056             | ((state &amp; mod_ctrl)       ? ControlMask      : 0)
<a id='L14057' name='L14057'></a> 14057             | ((state &amp; mod_meta)       ? dpyinfo-&gt;meta_mod_mask  : 0));
<a id='L14058' name='L14058'></a> 14058 <em class='brace'>}</em>
<a id='L14059' name='L14059'></a> 14059 
<a id='L14060' name='L14060'></a> 14060 <em class='comment'>/* Convert a keysym to its name.  */</em>
<a id='L14061' name='L14061'></a> 14061 
<a id='L14062' name='L14062'></a> 14062 <strong class='reserved'>char</strong> *
<a id='L14063' name='L14063'></a> 14063 <a href='../D/12153.html' title='Multiple defined in 4 places.'>get_keysym_name</a> (<strong class='reserved'>int</strong> keysym)
<a id='L14064' name='L14064'></a> 14064 <em class='brace'>{</em>
<a id='L14065' name='L14065'></a> 14065   <strong class='reserved'>char</strong> *<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>;
<a id='L14066' name='L14066'></a> 14066 
<a id='L14067' name='L14067'></a> 14067   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L14068' name='L14068'></a> 14068   <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a> = XKeysymToString (keysym);
<a id='L14069' name='L14069'></a> 14069   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L14070' name='L14070'></a> 14070 
<a id='L14071' name='L14071'></a> 14071   <strong class='reserved'>return</strong> <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>;
<a id='L14072' name='L14072'></a> 14072 <em class='brace'>}</em>
<a id='L14073' name='L14073'></a> 14073 
<a id='L14074' name='L14074'></a> 14074 <em class='comment'>/* Given the root and event coordinates of an X event destined for F's</em>
<a id='L14075' name='L14075'></a> 14075 <em class='comment'>   edit window, compute the offset between that window and F's root</em>
<a id='L14076' name='L14076'></a> 14076 <em class='comment'>   window.  This information is then used as an optimization to avoid</em>
<a id='L14077' name='L14077'></a> 14077 <em class='comment'>   synchronizing when converting coordinates from some other event to</em>
<a id='L14078' name='L14078'></a> 14078 <em class='comment'>   F's edit window.  */</em>
<a id='L14079' name='L14079'></a> 14079 
<a id='L14080' name='L14080'></a> 14080 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L14081' name='L14081'></a> 14081 x_compute_root_window_offset (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <strong class='reserved'>int</strong> root_x, <strong class='reserved'>int</strong> root_y,
<a id='L14082' name='L14082'></a> 14082                               <strong class='reserved'>int</strong> event_x, <strong class='reserved'>int</strong> event_y)
<a id='L14083' name='L14083'></a> 14083 <em class='brace'>{</em>
<a id='L14084' name='L14084'></a> 14084   <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;window_offset_certain_p = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L14085' name='L14085'></a> 14085   <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;root_x = root_x - event_x;
<a id='L14086' name='L14086'></a> 14086   <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;root_y = root_y - event_y;
<a id='L14087' name='L14087'></a> 14087 <em class='brace'>}</em>
<a id='L14088' name='L14088'></a> 14088 
<a id='L14089' name='L14089'></a> 14089 <em class='comment'>/* Translate the given coordinates from the root window to the edit</em>
<a id='L14090' name='L14090'></a> 14090 <em class='comment'>   window of FRAME, taking into account any cached root window</em>
<a id='L14091' name='L14091'></a> 14091 <em class='comment'>   offsets.  This allows Emacs to avoid excessive calls to _XReply in</em>
<a id='L14092' name='L14092'></a> 14092 <em class='comment'>   many cases while handling events, which would otherwise result in</em>
<a id='L14093' name='L14093'></a> 14093 <em class='comment'>   slowdowns over slow network connections.  */</em>
<a id='L14094' name='L14094'></a> 14094 
<a id='L14095' name='L14095'></a> 14095 <strong class='reserved'>void</strong>
<a id='L14096' name='L14096'></a> 14096 x_translate_coordinates (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <strong class='reserved'>int</strong> root_x, <strong class='reserved'>int</strong> root_y,
<a id='L14097' name='L14097'></a> 14097                          <strong class='reserved'>int</strong> *x_out, <strong class='reserved'>int</strong> *y_out)
<a id='L14098' name='L14098'></a> 14098 <em class='brace'>{</em>
<a id='L14099' name='L14099'></a> 14099   <strong class='reserved'>struct</strong> <a href='../D/19627.html' title='Multiple defined in 5 places.'>x_output</a> *output;
<a id='L14100' name='L14100'></a> 14100   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> <a href='../D/10645.html' title='Multiple defined in 5 places.'>dummy</a>;
<a id='L14101' name='L14101'></a> 14101 
<a id='L14102' name='L14102'></a> 14102   output = <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L14103' name='L14103'></a> 14103 
<a id='L14104' name='L14104'></a> 14104   <strong class='reserved'>if</strong> (output-&gt;window_offset_certain_p)
<a id='L14105' name='L14105'></a> 14105     <em class='brace'>{</em>
<a id='L14106' name='L14106'></a> 14106       <em class='comment'>/* Use the cached root window offset.  */</em>
<a id='L14107' name='L14107'></a> 14107       *x_out = root_x - output-&gt;root_x;
<a id='L14108' name='L14108'></a> 14108       *y_out = root_y - output-&gt;root_y;
<a id='L14109' name='L14109'></a> 14109 
<a id='L14110' name='L14110'></a> 14110       <strong class='reserved'>return</strong>;
<a id='L14111' name='L14111'></a> 14111     <em class='brace'>}</em>
<a id='L14112' name='L14112'></a> 14112 
<a id='L14113' name='L14113'></a> 14113   <em class='comment'>/* Otherwise, do the transformation manually.  Then, cache the root</em>
<a id='L14114' name='L14114'></a> 14114 <em class='comment'>     window position.  */</em>
<a id='L14115' name='L14115'></a> 14115   <strong class='reserved'>if</strong> (!XTranslateCoordinates (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L14116' name='L14116'></a> 14116                               <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;root_window,
<a id='L14117' name='L14117'></a> 14117                               <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), root_x, root_y,
<a id='L14118' name='L14118'></a> 14118                               x_out, y_out, &amp;<a href='../D/10645.html' title='Multiple defined in 5 places.'>dummy</a>))
<a id='L14119' name='L14119'></a> 14119     <em class='comment'>/* Use some dummy values.  This is not supposed to be called with</em>
<a id='L14120' name='L14120'></a> 14120 <em class='comment'>       coordinates out of the screen.  */</em>
<a id='L14121' name='L14121'></a> 14121     *x_out = 0, *y_out = 0;
<a id='L14122' name='L14122'></a> 14122   <strong class='reserved'>else</strong>
<a id='L14123' name='L14123'></a> 14123     <em class='brace'>{</em>
<a id='L14124' name='L14124'></a> 14124       <em class='comment'>/* Cache the root window offset of the edit window.  */</em>
<a id='L14125' name='L14125'></a> 14125       output-&gt;window_offset_certain_p = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L14126' name='L14126'></a> 14126       output-&gt;root_x = root_x - *x_out;
<a id='L14127' name='L14127'></a> 14127       output-&gt;root_y = root_y - *y_out;
<a id='L14128' name='L14128'></a> 14128     <em class='brace'>}</em>
<a id='L14129' name='L14129'></a> 14129 <em class='brace'>}</em>
<a id='L14130' name='L14130'></a> 14130 
<a id='L14131' name='L14131'></a> 14131 <em class='comment'>/* Translate the given coordinates from the edit window of FRAME,</em>
<a id='L14132' name='L14132'></a> 14132 <em class='comment'>   taking into account any cached root window offsets.  This is mainly</em>
<a id='L14133' name='L14133'></a> 14133 <em class='comment'>   used from the popup menu code.  */</em>
<a id='L14134' name='L14134'></a> 14134 
<a id='L14135' name='L14135'></a> 14135 <strong class='reserved'>void</strong>
<a id='L14136' name='L14136'></a> 14136 x_translate_coordinates_to_root (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, <strong class='reserved'>int</strong> y,
<a id='L14137' name='L14137'></a> 14137                                  <strong class='reserved'>int</strong> *x_out, <strong class='reserved'>int</strong> *y_out)
<a id='L14138' name='L14138'></a> 14138 <em class='brace'>{</em>
<a id='L14139' name='L14139'></a> 14139   <strong class='reserved'>struct</strong> <a href='../D/19627.html' title='Multiple defined in 5 places.'>x_output</a> *output;
<a id='L14140' name='L14140'></a> 14140   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> <a href='../D/10645.html' title='Multiple defined in 5 places.'>dummy</a>;
<a id='L14141' name='L14141'></a> 14141 
<a id='L14142' name='L14142'></a> 14142   output = <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L14143' name='L14143'></a> 14143 
<a id='L14144' name='L14144'></a> 14144   <strong class='reserved'>if</strong> (output-&gt;window_offset_certain_p)
<a id='L14145' name='L14145'></a> 14145     <em class='brace'>{</em>
<a id='L14146' name='L14146'></a> 14146       <em class='comment'>/* Use the cached root window offset.  */</em>
<a id='L14147' name='L14147'></a> 14147       *x_out = <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + output-&gt;root_x;
<a id='L14148' name='L14148'></a> 14148       *y_out = y + output-&gt;root_y;
<a id='L14149' name='L14149'></a> 14149 
<a id='L14150' name='L14150'></a> 14150       <strong class='reserved'>return</strong>;
<a id='L14151' name='L14151'></a> 14151     <em class='brace'>}</em>
<a id='L14152' name='L14152'></a> 14152 
<a id='L14153' name='L14153'></a> 14153   <em class='comment'>/* Otherwise, do the transform manually and compute and cache the</em>
<a id='L14154' name='L14154'></a> 14154 <em class='comment'>     root window position.  */</em>
<a id='L14155' name='L14155'></a> 14155   <strong class='reserved'>if</strong> (!XTranslateCoordinates (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L14156' name='L14156'></a> 14156                               <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;root_window,
<a id='L14157' name='L14157'></a> 14157                               <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, x_out, y_out, &amp;<a href='../D/10645.html' title='Multiple defined in 5 places.'>dummy</a>))
<a id='L14158' name='L14158'></a> 14158     *x_out = 0, *y_out = 0;
<a id='L14159' name='L14159'></a> 14159   <strong class='reserved'>else</strong>
<a id='L14160' name='L14160'></a> 14160     <em class='brace'>{</em>
<a id='L14161' name='L14161'></a> 14161       <em class='comment'>/* Cache the root window offset of the edit window.  */</em>
<a id='L14162' name='L14162'></a> 14162       output-&gt;window_offset_certain_p = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L14163' name='L14163'></a> 14163       output-&gt;root_x = *x_out - <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L14164' name='L14164'></a> 14164       output-&gt;root_y = *y_out - y;
<a id='L14165' name='L14165'></a> 14165     <em class='brace'>}</em>
<a id='L14166' name='L14166'></a> 14166 <em class='brace'>}</em>
<a id='L14167' name='L14167'></a> 14167 
<a id='L14168' name='L14168'></a> 14168 <em class='comment'>/* Do x-translate-coordinates, but try to avoid a roundtrip to the X</em>
<a id='L14169' name='L14169'></a> 14169 <em class='comment'>   server at the cost of not returning `child', which most callers</em>
<a id='L14170' name='L14170'></a> 14170 <em class='comment'>   have no reason to use.  */</em>
<a id='L14171' name='L14171'></a> 14171 
<a id='L14172' name='L14172'></a> 14172 <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a>
<a id='L14173' name='L14173'></a> 14173 x_handle_translate_coordinates (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> dest_window,
<a id='L14174' name='L14174'></a> 14174                                 <strong class='reserved'>int</strong> source_x, <strong class='reserved'>int</strong> source_y)
<a id='L14175' name='L14175'></a> 14175 <em class='brace'>{</em>
<a id='L14176' name='L14176'></a> 14176   <strong class='reserved'>if</strong> (<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (dest_window))
<a id='L14177' name='L14177'></a> 14177     <em class='brace'>{</em>
<a id='L14178' name='L14178'></a> 14178       <em class='comment'>/* We are translating coordinates from a frame to the root</em>
<a id='L14179' name='L14179'></a> 14179 <em class='comment'>         window.  Avoid a roundtrip if possible by using cached</em>
<a id='L14180' name='L14180'></a> 14180 <em class='comment'>         coordinates.  */</em>
<a id='L14181' name='L14181'></a> 14181 
<a id='L14182' name='L14182'></a> 14182       <strong class='reserved'>if</strong> (!<a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;window_offset_certain_p)
<a id='L14183' name='L14183'></a> 14183         <strong class='reserved'>return</strong> Qnil;
<a id='L14184' name='L14184'></a> 14184 
<a id='L14185' name='L14185'></a> 14185       <strong class='reserved'>return</strong> <a href='../S/2350.html#L2932' title='Defined at 2932 in src/alloc.c.'>list3</a> (<a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (source_x + <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;root_x),
<a id='L14186' name='L14186'></a> 14186                     <a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (source_y + <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;root_y),
<a id='L14187' name='L14187'></a> 14187                     Qnil);
<a id='L14188' name='L14188'></a> 14188     <em class='brace'>}</em>
<a id='L14189' name='L14189'></a> 14189 
<a id='L14190' name='L14190'></a> 14190   <strong class='reserved'>return</strong> Qnil;
<a id='L14191' name='L14191'></a> 14191 <em class='brace'>}</em>
<a id='L14192' name='L14192'></a> 14192 
<a id='L14193' name='L14193'></a> 14193 <em class='comment'>/* The same, but for an XIDeviceEvent.  */</em>
<a id='L14194' name='L14194'></a> 14194 
<a id='L14195' name='L14195'></a> 14195 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L14196' name='L14196'></a> 14196 
<a id='L14197' name='L14197'></a> 14197 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L14198' name='L14198'></a> 14198 xi_compute_root_window_offset (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, XIDeviceEvent *xev)
<a id='L14199' name='L14199'></a> 14199 <em class='brace'>{</em>
<a id='L14200' name='L14200'></a> 14200   <em class='comment'>/* Truncate coordinates instead of rounding them, because that is</em>
<a id='L14201' name='L14201'></a> 14201 <em class='comment'>     how the X server handles window hierarchy.  */</em>
<a id='L14202' name='L14202'></a> 14202   x_compute_root_window_offset (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, xev-&gt;root_x, xev-&gt;root_y,
<a id='L14203' name='L14203'></a> 14203                                 xev-&gt;event_x, xev-&gt;event_y);
<a id='L14204' name='L14204'></a> 14204 <em class='brace'>}</em>
<a id='L14205' name='L14205'></a> 14205 
<a id='L14206' name='L14206'></a> 14206 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L14207' name='L14207'></a> 14207 xi_compute_root_window_offset_enter (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, XIEnterEvent *enter)
<a id='L14208' name='L14208'></a> 14208 <em class='brace'>{</em>
<a id='L14209' name='L14209'></a> 14209   x_compute_root_window_offset (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, enter-&gt;root_x, enter-&gt;root_y,
<a id='L14210' name='L14210'></a> 14210                                 enter-&gt;event_x, enter-&gt;event_y);
<a id='L14211' name='L14211'></a> 14211 <em class='brace'>}</em>
<a id='L14212' name='L14212'></a> 14212 
<a id='L14213' name='L14213'></a> 14213 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L177' title='Defined at 177 in src/xterm.h.'>HAVE_XINPUT2_4</a>
<a id='L14214' name='L14214'></a> 14214 
<a id='L14215' name='L14215'></a> 14215 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L14216' name='L14216'></a> 14216 xi_compute_root_window_offset_pinch (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, XIGesturePinchEvent *pev)
<a id='L14217' name='L14217'></a> 14217 <em class='brace'>{</em>
<a id='L14218' name='L14218'></a> 14218   <em class='comment'>/* Truncate coordinates instead of rounding them, because that is</em>
<a id='L14219' name='L14219'></a> 14219 <em class='comment'>     how the X server handles window hierarchy.  */</em>
<a id='L14220' name='L14220'></a> 14220   x_compute_root_window_offset (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, pev-&gt;root_x, pev-&gt;root_y,
<a id='L14221' name='L14221'></a> 14221                                 pev-&gt;event_x, pev-&gt;event_y);
<a id='L14222' name='L14222'></a> 14222 <em class='brace'>}</em>
<a id='L14223' name='L14223'></a> 14223 
<a id='L14224' name='L14224'></a> 14224 <em class='sharp'>#endif</em>
<a id='L14225' name='L14225'></a> 14225 
<a id='L14226' name='L14226'></a> 14226 <em class='sharp'>#endif</em>
<a id='L14227' name='L14227'></a> 14227 
<a id='L14228' name='L14228'></a> 14228 <strong class='reserved'>static</strong> Bool
<a id='L14229' name='L14229'></a> 14229 x_query_pointer_1 (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L14230' name='L14230'></a> 14230                    <strong class='reserved'>int</strong> client_pointer_device, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> w,
<a id='L14231' name='L14231'></a> 14231                    <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> *root_return, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> *child_return,
<a id='L14232' name='L14232'></a> 14232                    <strong class='reserved'>int</strong> *root_x_return, <strong class='reserved'>int</strong> *root_y_return,
<a id='L14233' name='L14233'></a> 14233                    <strong class='reserved'>int</strong> *win_x_return, <strong class='reserved'>int</strong> *win_y_return,
<a id='L14234' name='L14234'></a> 14234                    <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> *mask_return)
<a id='L14235' name='L14235'></a> 14235 <em class='brace'>{</em>
<a id='L14236' name='L14236'></a> 14236   Bool rc;
<a id='L14237' name='L14237'></a> 14237   <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy;
<a id='L14238' name='L14238'></a> 14238 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L14239' name='L14239'></a> 14239   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> had_errors;
<a id='L14240' name='L14240'></a> 14240   XIModifierState modifiers;
<a id='L14241' name='L14241'></a> 14241   XIButtonState buttons;
<a id='L14242' name='L14242'></a> 14242   XIGroupState <a href='../S/56.html#L26' title='Defined at 26 in nt/inc/grp.h.'>group</a>; <em class='comment'>/* Unused.  */</em>
<a id='L14243' name='L14243'></a> 14243   <strong class='reserved'>double</strong> root_x, root_y, win_x, win_y;
<a id='L14244' name='L14244'></a> 14244   <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> state;
<a id='L14245' name='L14245'></a> 14245 <em class='sharp'>#endif</em>
<a id='L14246' name='L14246'></a> 14246 
<a id='L14247' name='L14247'></a> 14247   dpy = dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>;
<a id='L14248' name='L14248'></a> 14248 
<a id='L14249' name='L14249'></a> 14249 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L14250' name='L14250'></a> 14250   <strong class='reserved'>if</strong> (client_pointer_device != -1)
<a id='L14251' name='L14251'></a> 14251     <em class='brace'>{</em>
<a id='L14252' name='L14252'></a> 14252       <em class='comment'>/* Catch errors caused by the device going away.  This is not</em>
<a id='L14253' name='L14253'></a> 14253 <em class='comment'>         very expensive, since XIQueryPointer will sync anyway.  */</em>
<a id='L14254' name='L14254'></a> 14254       x_catch_errors (dpy);
<a id='L14255' name='L14255'></a> 14255       rc = XIQueryPointer (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L14256' name='L14256'></a> 14256                            dpyinfo-&gt;client_pointer_device,
<a id='L14257' name='L14257'></a> 14257                            w, root_return, child_return,
<a id='L14258' name='L14258'></a> 14258                            &amp;root_x, &amp;root_y, &amp;win_x, &amp;win_y,
<a id='L14259' name='L14259'></a> 14259                            &amp;buttons, &amp;modifiers, &amp;<a href='../S/56.html#L26' title='Defined at 26 in nt/inc/grp.h.'>group</a>);
<a id='L14260' name='L14260'></a> 14260       had_errors = x_had_errors_p (dpy);
<a id='L14261' name='L14261'></a> 14261       x_uncatch_errors_after_check ();
<a id='L14262' name='L14262'></a> 14262 
<a id='L14263' name='L14263'></a> 14263       <strong class='reserved'>if</strong> (had_errors)
<a id='L14264' name='L14264'></a> 14264         <em class='brace'>{</em>
<a id='L14265' name='L14265'></a> 14265           <em class='comment'>/* If the specified client pointer is the display's client</em>
<a id='L14266' name='L14266'></a> 14266 <em class='comment'>             pointer, clear it now.  A new client pointer might not be</em>
<a id='L14267' name='L14267'></a> 14267 <em class='comment'>             found before the next call to x_query_pointer_1 and</em>
<a id='L14268' name='L14268'></a> 14268 <em class='comment'>             waiting for the error leads to excessive syncing.  */</em>
<a id='L14269' name='L14269'></a> 14269 
<a id='L14270' name='L14270'></a> 14270           <strong class='reserved'>if</strong> (client_pointer_device == dpyinfo-&gt;client_pointer_device)
<a id='L14271' name='L14271'></a> 14271             dpyinfo-&gt;client_pointer_device = -1;
<a id='L14272' name='L14272'></a> 14272 
<a id='L14273' name='L14273'></a> 14273           rc = XQueryPointer (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, w, root_return,
<a id='L14274' name='L14274'></a> 14274                               child_return, root_x_return,
<a id='L14275' name='L14275'></a> 14275                               root_y_return, win_x_return,
<a id='L14276' name='L14276'></a> 14276                               win_y_return, mask_return);
<a id='L14277' name='L14277'></a> 14277         <em class='brace'>}</em>
<a id='L14278' name='L14278'></a> 14278       <strong class='reserved'>else</strong>
<a id='L14279' name='L14279'></a> 14279         <em class='brace'>{</em>
<a id='L14280' name='L14280'></a> 14280           state = 0;
<a id='L14281' name='L14281'></a> 14281 
<a id='L14282' name='L14282'></a> 14282           <a href='../S/2289.html#L5308' title='Defined at 5308 in src/xterm.c.'>xi_convert_button_state</a> (&amp;buttons, &amp;state);
<a id='L14283' name='L14283'></a> 14283           *mask_return = state | modifiers.effective;
<a id='L14284' name='L14284'></a> 14284 
<a id='L14285' name='L14285'></a> 14285           XFree (buttons.mask);
<a id='L14286' name='L14286'></a> 14286 
<a id='L14287' name='L14287'></a> 14287           *root_x_return = lrint (root_x);
<a id='L14288' name='L14288'></a> 14288           *root_y_return = lrint (root_y);
<a id='L14289' name='L14289'></a> 14289           *win_x_return = lrint (win_x);
<a id='L14290' name='L14290'></a> 14290           *win_y_return = lrint (win_y);
<a id='L14291' name='L14291'></a> 14291         <em class='brace'>}</em>
<a id='L14292' name='L14292'></a> 14292     <em class='brace'>}</em>
<a id='L14293' name='L14293'></a> 14293   <strong class='reserved'>else</strong>
<a id='L14294' name='L14294'></a> 14294 <em class='sharp'>#endif</em>
<a id='L14295' name='L14295'></a> 14295     rc = XQueryPointer (dpy, w, root_return, child_return,
<a id='L14296' name='L14296'></a> 14296                         root_x_return, root_y_return, win_x_return,
<a id='L14297' name='L14297'></a> 14297                         win_y_return, mask_return);
<a id='L14298' name='L14298'></a> 14298 
<a id='L14299' name='L14299'></a> 14299   <strong class='reserved'>return</strong> rc;
<a id='L14300' name='L14300'></a> 14300 <em class='brace'>}</em>
<a id='L14301' name='L14301'></a> 14301 
<a id='L14302' name='L14302'></a> 14302 Bool
<a id='L14303' name='L14303'></a> 14303 x_query_pointer (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> w, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> *root_return,
<a id='L14304' name='L14304'></a> 14304                  <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> *child_return, <strong class='reserved'>int</strong> *root_x_return,
<a id='L14305' name='L14305'></a> 14305                  <strong class='reserved'>int</strong> *root_y_return, <strong class='reserved'>int</strong> *win_x_return,
<a id='L14306' name='L14306'></a> 14306                  <strong class='reserved'>int</strong> *win_y_return, <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> *mask_return)
<a id='L14307' name='L14307'></a> 14307 <em class='brace'>{</em>
<a id='L14308' name='L14308'></a> 14308   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L14309' name='L14309'></a> 14309 
<a id='L14310' name='L14310'></a> 14310   dpyinfo = <a href='../S/2289.html#L6774' title='Defined at 6774 in src/xterm.c.'>x_display_info_for_display</a> (dpy);
<a id='L14311' name='L14311'></a> 14311 
<a id='L14312' name='L14312'></a> 14312   <strong class='reserved'>if</strong> (!dpyinfo)
<a id='L14313' name='L14313'></a> 14313     <a href='../D/10893.html' title='Multiple defined in 6 places.'>emacs_abort</a> ();
<a id='L14314' name='L14314'></a> 14314 
<a id='L14315' name='L14315'></a> 14315 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L14316' name='L14316'></a> 14316   <strong class='reserved'>return</strong> x_query_pointer_1 (dpyinfo, dpyinfo-&gt;client_pointer_device,
<a id='L14317' name='L14317'></a> 14317                             w, root_return, child_return, root_x_return,
<a id='L14318' name='L14318'></a> 14318                             root_y_return, win_x_return, win_y_return,
<a id='L14319' name='L14319'></a> 14319                             mask_return);
<a id='L14320' name='L14320'></a> 14320 <em class='sharp'>#else</em>
<a id='L14321' name='L14321'></a> 14321   <strong class='reserved'>return</strong> x_query_pointer_1 (dpyinfo, -1, w, root_return, child_return,
<a id='L14322' name='L14322'></a> 14322                             root_x_return, root_y_return, win_x_return,
<a id='L14323' name='L14323'></a> 14323                             win_y_return, mask_return);
<a id='L14324' name='L14324'></a> 14324 <em class='sharp'>#endif</em>
<a id='L14325' name='L14325'></a> 14325 <em class='brace'>}</em>
<a id='L14326' name='L14326'></a> 14326 
<a id='L14327' name='L14327'></a> 14327 <em class='comment'>/* Mouse clicks and mouse movement.  Rah.</em>
<a id='L14328' name='L14328'></a> 14328 <em class='comment'></em>
<a id='L14329' name='L14329'></a> 14329 <em class='comment'>   Formerly, we used PointerMotionHintMask (in standard_event_mask)</em>
<a id='L14330' name='L14330'></a> 14330 <em class='comment'>   so that we would have to call XQueryPointer after each MotionNotify</em>
<a id='L14331' name='L14331'></a> 14331 <em class='comment'>   event to ask for another such event.  However, this made mouse tracking</em>
<a id='L14332' name='L14332'></a> 14332 <em class='comment'>   slow, and there was a bug that made it eventually stop.</em>
<a id='L14333' name='L14333'></a> 14333 <em class='comment'></em>
<a id='L14334' name='L14334'></a> 14334 <em class='comment'>   Simply asking for MotionNotify all the time seems to work better.</em>
<a id='L14335' name='L14335'></a> 14335 <em class='comment'></em>
<a id='L14336' name='L14336'></a> 14336 <em class='comment'>   In order to avoid asking for motion events and then throwing most</em>
<a id='L14337' name='L14337'></a> 14337 <em class='comment'>   of them away or busy-polling the server for mouse positions, we ask</em>
<a id='L14338' name='L14338'></a> 14338 <em class='comment'>   the server for pointer motion hints.  This means that we get only</em>
<a id='L14339' name='L14339'></a> 14339 <em class='comment'>   one event per group of mouse movements.  "Groups" are delimited by</em>
<a id='L14340' name='L14340'></a> 14340 <em class='comment'>   other kinds of events (focus changes and button clicks, for</em>
<a id='L14341' name='L14341'></a> 14341 <em class='comment'>   example), or by XQueryPointer calls; when one of these happens, we</em>
<a id='L14342' name='L14342'></a> 14342 <em class='comment'>   get another MotionNotify event the next time the mouse moves.  This</em>
<a id='L14343' name='L14343'></a> 14343 <em class='comment'>   is at least as efficient as getting motion events when mouse</em>
<a id='L14344' name='L14344'></a> 14344 <em class='comment'>   tracking is on, and I suspect only negligibly worse when tracking</em>
<a id='L14345' name='L14345'></a> 14345 <em class='comment'>   is off.  */</em>
<a id='L14346' name='L14346'></a> 14346 
<a id='L14347' name='L14347'></a> 14347 <em class='comment'>/* Prepare a mouse-event in *RESULT for placement in the input queue.</em>
<a id='L14348' name='L14348'></a> 14348 <em class='comment'></em>
<a id='L14349' name='L14349'></a> 14349 <em class='comment'>   If the event is a button press, then note that we have grabbed</em>
<a id='L14350' name='L14350'></a> 14350 <em class='comment'>   the mouse.</em>
<a id='L14351' name='L14351'></a> 14351 <em class='comment'></em>
<a id='L14352' name='L14352'></a> 14352 <em class='comment'>   The XButtonEvent structure passed as EVENT might not come from the</em>
<a id='L14353' name='L14353'></a> 14353 <em class='comment'>   X server, and instead be artificially constructed from input</em>
<a id='L14354' name='L14354'></a> 14354 <em class='comment'>   extension events.  In these special events, the only fields that</em>
<a id='L14355' name='L14355'></a> 14355 <em class='comment'>   are initialized are `time', `button', `state', `type', `window' and</em>
<a id='L14356' name='L14356'></a> 14356 <em class='comment'>   `x', `y', `x_root' and `y_root'.  This function should not access</em>
<a id='L14357' name='L14357'></a> 14357 <em class='comment'>   any other fields in EVENT without also initializing the</em>
<a id='L14358' name='L14358'></a> 14358 <em class='comment'>   corresponding fields in `bv' under the XI_ButtonPress and</em>
<a id='L14359' name='L14359'></a> 14359 <em class='comment'>   XI_ButtonRelease labels inside `handle_one_xevent'.  */</em>
<a id='L14360' name='L14360'></a> 14360 
<a id='L14361' name='L14361'></a> 14361 <strong class='reserved'>static</strong> <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a>
<a id='L14362' name='L14362'></a> 14362 x_construct_mouse_click (<strong class='reserved'>struct</strong> <a href='../S/2231.html#L350' title='Defined at 350 in src/termhooks.h.'>input_event</a> *result,
<a id='L14363' name='L14363'></a> 14363                          <strong class='reserved'>const</strong> XButtonEvent *event,
<a id='L14364' name='L14364'></a> 14364                          <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L14365' name='L14365'></a> 14365 <em class='brace'>{</em>
<a id='L14366' name='L14366'></a> 14366   <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = event-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L14367' name='L14367'></a> 14367   <strong class='reserved'>int</strong> y = event-&gt;y;
<a id='L14368' name='L14368'></a> 14368 
<a id='L14369' name='L14369'></a> 14369   <em class='comment'>/* Make the event type NO_EVENT; we'll change that when we decide</em>
<a id='L14370' name='L14370'></a> 14370 <em class='comment'>     otherwise.  */</em>
<a id='L14371' name='L14371'></a> 14371   result-&gt;kind = <a href='../S/2231.html#L121' title='Defined at 121 in src/termhooks.h.'>MOUSE_CLICK_EVENT</a>;
<a id='L14372' name='L14372'></a> 14372   result-&gt;code = event-&gt;button - Button1;
<a id='L14373' name='L14373'></a> 14373   result-&gt;timestamp = event-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L14374' name='L14374'></a> 14374   result-&gt;modifiers = (x_x_to_emacs_modifiers (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L14375' name='L14375'></a> 14375                                                event-&gt;state)
<a id='L14376' name='L14376'></a> 14376                        | (event-&gt;type == ButtonRelease
<a id='L14377' name='L14377'></a> 14377                           ? <a href='../S/2231.html#L414' title='Defined at 414 in src/termhooks.h.'>up_modifier</a>
<a id='L14378' name='L14378'></a> 14378                           : <a href='../S/2231.html#L417' title='Defined at 417 in src/termhooks.h.'>down_modifier</a>));
<a id='L14379' name='L14379'></a> 14379 
<a id='L14380' name='L14380'></a> 14380   <em class='comment'>/* If result-&gt;window is not the frame's edit widget (which can</em>
<a id='L14381' name='L14381'></a> 14381 <em class='comment'>     happen with GTK+ scroll bars, for example), translate the</em>
<a id='L14382' name='L14382'></a> 14382 <em class='comment'>     coordinates so they appear at the correct position.  */</em>
<a id='L14383' name='L14383'></a> 14383   <strong class='reserved'>if</strong> (event-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> != <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L14384' name='L14384'></a> 14384     x_translate_coordinates (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, event-&gt;x_root, event-&gt;y_root,
<a id='L14385' name='L14385'></a> 14385                              &amp;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, &amp;y);
<a id='L14386' name='L14386'></a> 14386 
<a id='L14387' name='L14387'></a> 14387   <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (result-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>);
<a id='L14388' name='L14388'></a> 14388   <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (result-&gt;y, y);
<a id='L14389' name='L14389'></a> 14389   <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (result-&gt;frame_or_window, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L14390' name='L14390'></a> 14390   result-&gt;arg = Qnil;
<a id='L14391' name='L14391'></a> 14391   <strong class='reserved'>return</strong> Qnil;
<a id='L14392' name='L14392'></a> 14392 <em class='brace'>}</em>
<a id='L14393' name='L14393'></a> 14393 
<a id='L14394' name='L14394'></a> 14394 <em class='comment'>/* Function to report a mouse movement to the mainstream Emacs code.</em>
<a id='L14395' name='L14395'></a> 14395 <em class='comment'>   The input handler calls this.</em>
<a id='L14396' name='L14396'></a> 14396 <em class='comment'></em>
<a id='L14397' name='L14397'></a> 14397 <em class='comment'>   We have received a mouse movement event, which is given in *event.</em>
<a id='L14398' name='L14398'></a> 14398 <em class='comment'>   If the mouse is over a different glyph than it was last time, tell</em>
<a id='L14399' name='L14399'></a> 14399 <em class='comment'>   the mainstream emacs code by setting mouse_moved.  If not, ask for</em>
<a id='L14400' name='L14400'></a> 14400 <em class='comment'>   another motion event, so we can check again the next time it moves.</em>
<a id='L14401' name='L14401'></a> 14401 <em class='comment'></em>
<a id='L14402' name='L14402'></a> 14402 <em class='comment'>   The XMotionEvent structure passed as EVENT might not come from the</em>
<a id='L14403' name='L14403'></a> 14403 <em class='comment'>   X server, and instead be artificially constructed from input</em>
<a id='L14404' name='L14404'></a> 14404 <em class='comment'>   extension events.  In these special events, the only fields that</em>
<a id='L14405' name='L14405'></a> 14405 <em class='comment'>   are initialized are `time', `window', `send_event', `x' and `y'.</em>
<a id='L14406' name='L14406'></a> 14406 <em class='comment'>   This function should not access any other fields in EVENT without</em>
<a id='L14407' name='L14407'></a> 14407 <em class='comment'>   also initializing the corresponding fields in `ev' under the</em>
<a id='L14408' name='L14408'></a> 14408 <em class='comment'>   XI_Motion, XI_Enter and XI_Leave labels inside</em>
<a id='L14409' name='L14409'></a> 14409 <em class='comment'>   `handle_one_xevent'.  */</em>
<a id='L14410' name='L14410'></a> 14410 
<a id='L14411' name='L14411'></a> 14411 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L14412' name='L14412'></a> 14412 x_note_mouse_movement (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <strong class='reserved'>const</strong> XMotionEvent *event,
<a id='L14413' name='L14413'></a> 14413                        <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> device)
<a id='L14414' name='L14414'></a> 14414 <em class='brace'>{</em>
<a id='L14415' name='L14415'></a> 14415   <a href='../S/2150.html#L62' title='Defined at 62 in src/pgtkgui.h.'>XRectangle</a> *r;
<a id='L14416' name='L14416'></a> 14416   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L14417' name='L14417'></a> 14417 
<a id='L14418' name='L14418'></a> 14418   <strong class='reserved'>if</strong> (!<a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>))
<a id='L14419' name='L14419'></a> 14419     <strong class='reserved'>return</strong> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L14420' name='L14420'></a> 14420 
<a id='L14421' name='L14421'></a> 14421   dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>);
<a id='L14422' name='L14422'></a> 14422   dpyinfo-&gt;last_mouse_movement_time = event-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L14423' name='L14423'></a> 14423   dpyinfo-&gt;last_mouse_movement_time_send_event = event-&gt;send_event;
<a id='L14424' name='L14424'></a> 14424   dpyinfo-&gt;last_mouse_motion_frame = <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>;
<a id='L14425' name='L14425'></a> 14425   dpyinfo-&gt;last_mouse_motion_x = event-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L14426' name='L14426'></a> 14426   dpyinfo-&gt;last_mouse_motion_y = event-&gt;y;
<a id='L14427' name='L14427'></a> 14427 
<a id='L14428' name='L14428'></a> 14428   <strong class='reserved'>if</strong> (event-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> != <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>))
<a id='L14429' name='L14429'></a> 14429     <em class='brace'>{</em>
<a id='L14430' name='L14430'></a> 14430       <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>-&gt;mouse_moved = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L14431' name='L14431'></a> 14431       <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>-&gt;last_mouse_device = device;
<a id='L14432' name='L14432'></a> 14432       dpyinfo-&gt;last_mouse_scroll_bar = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L14433' name='L14433'></a> 14433       <a href='../S/2224.html#L35323' title='Defined at 35323 in src/xdisp.c.'>note_mouse_highlight</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, -1, -1);
<a id='L14434' name='L14434'></a> 14434       dpyinfo-&gt;last_mouse_glyph_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L14435' name='L14435'></a> 14435       <strong class='reserved'>return</strong> <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L14436' name='L14436'></a> 14436     <em class='brace'>}</em>
<a id='L14437' name='L14437'></a> 14437 
<a id='L14438' name='L14438'></a> 14438 
<a id='L14439' name='L14439'></a> 14439   <em class='comment'>/* Has the mouse moved off the glyph it was on at the last sighting?  */</em>
<a id='L14440' name='L14440'></a> 14440   r = &amp;dpyinfo-&gt;last_mouse_glyph;
<a id='L14441' name='L14441'></a> 14441   <strong class='reserved'>if</strong> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> != dpyinfo-&gt;last_mouse_glyph_frame
<a id='L14442' name='L14442'></a> 14442       || event-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> &lt; r-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> || event-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> &gt;= r-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + r-&gt;width
<a id='L14443' name='L14443'></a> 14443       || event-&gt;y &lt; r-&gt;y || event-&gt;y &gt;= r-&gt;y + r-&gt;height)
<a id='L14444' name='L14444'></a> 14444     <em class='brace'>{</em>
<a id='L14445' name='L14445'></a> 14445       <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>-&gt;mouse_moved = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L14446' name='L14446'></a> 14446       <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>-&gt;last_mouse_device = device;
<a id='L14447' name='L14447'></a> 14447       dpyinfo-&gt;last_mouse_scroll_bar = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L14448' name='L14448'></a> 14448       <a href='../S/2224.html#L35323' title='Defined at 35323 in src/xdisp.c.'>note_mouse_highlight</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, event-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, event-&gt;y);
<a id='L14449' name='L14449'></a> 14449       <em class='comment'>/* Remember which glyph we're now on.  */</em>
<a id='L14450' name='L14450'></a> 14450       <a href='../S/2224.html#L2719' title='Defined at 2719 in src/xdisp.c.'>remember_mouse_glyph</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, event-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, event-&gt;y, r);
<a id='L14451' name='L14451'></a> 14451       dpyinfo-&gt;last_mouse_glyph_frame = <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>;
<a id='L14452' name='L14452'></a> 14452       <strong class='reserved'>return</strong> <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L14453' name='L14453'></a> 14453     <em class='brace'>}</em>
<a id='L14454' name='L14454'></a> 14454 
<a id='L14455' name='L14455'></a> 14455   <strong class='reserved'>return</strong> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L14456' name='L14456'></a> 14456 <em class='brace'>}</em>
<a id='L14457' name='L14457'></a> 14457 
<a id='L14458' name='L14458'></a> 14458 <em class='comment'>/* Get a sibling below WINDOW on DPY at PARENT_X and PARENT_Y.  */</em>
<a id='L14459' name='L14459'></a> 14459 <strong class='reserved'>static</strong> <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a>
<a id='L14460' name='L14460'></a> 14460 x_get_window_below (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>,
<a id='L14461' name='L14461'></a> 14461                     <strong class='reserved'>int</strong> parent_x, <strong class='reserved'>int</strong> parent_y,
<a id='L14462' name='L14462'></a> 14462                     <strong class='reserved'>int</strong> *inner_x, <strong class='reserved'>int</strong> *inner_y)
<a id='L14463' name='L14463'></a> 14463 <em class='brace'>{</em>
<a id='L14464' name='L14464'></a> 14464   <strong class='reserved'>int</strong> rc, i, cx, cy;
<a id='L14465' name='L14465'></a> 14465   XWindowAttributes attrs;
<a id='L14466' name='L14466'></a> 14466   <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> nchildren;
<a id='L14467' name='L14467'></a> 14467   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> root, <a href='../D/15236.html' title='Multiple defined in 2 places.'>parent</a>, *children, <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>;
<a id='L14468' name='L14468'></a> 14468   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> window_seen;
<a id='L14469' name='L14469'></a> 14469 
<a id='L14470' name='L14470'></a> 14470   <em class='comment'>/* TODO: rewrite to have less dependencies.  */</em>
<a id='L14471' name='L14471'></a> 14471 
<a id='L14472' name='L14472'></a> 14472   children = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L14473' name='L14473'></a> 14473   window_seen = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L14474' name='L14474'></a> 14474   <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a> = None;
<a id='L14475' name='L14475'></a> 14475 
<a id='L14476' name='L14476'></a> 14476   rc = XQueryTree (dpy, <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, &amp;root, &amp;<a href='../D/15236.html' title='Multiple defined in 2 places.'>parent</a>,
<a id='L14477' name='L14477'></a> 14477                    &amp;children, &amp;nchildren);
<a id='L14478' name='L14478'></a> 14478 
<a id='L14479' name='L14479'></a> 14479   <strong class='reserved'>if</strong> (rc)
<a id='L14480' name='L14480'></a> 14480     <em class='brace'>{</em>
<a id='L14481' name='L14481'></a> 14481       <strong class='reserved'>if</strong> (children)
<a id='L14482' name='L14482'></a> 14482         XFree (children);
<a id='L14483' name='L14483'></a> 14483 
<a id='L14484' name='L14484'></a> 14484       rc = XQueryTree (dpy, <a href='../D/15236.html' title='Multiple defined in 2 places.'>parent</a>, &amp;root,
<a id='L14485' name='L14485'></a> 14485                        &amp;<a href='../D/15236.html' title='Multiple defined in 2 places.'>parent</a>, &amp;children, &amp;nchildren);
<a id='L14486' name='L14486'></a> 14486     <em class='brace'>}</em>
<a id='L14487' name='L14487'></a> 14487 
<a id='L14488' name='L14488'></a> 14488   <strong class='reserved'>if</strong> (rc)
<a id='L14489' name='L14489'></a> 14489     <em class='brace'>{</em>
<a id='L14490' name='L14490'></a> 14490       <strong class='reserved'>for</strong> (i = nchildren - 1; i &gt;= 0; --i)
<a id='L14491' name='L14491'></a> 14491         <em class='brace'>{</em>
<a id='L14492' name='L14492'></a> 14492           <strong class='reserved'>if</strong> (children[i] == <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>)
<a id='L14493' name='L14493'></a> 14493             <em class='brace'>{</em>
<a id='L14494' name='L14494'></a> 14494               window_seen = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L14495' name='L14495'></a> 14495               <strong class='reserved'>continue</strong>;
<a id='L14496' name='L14496'></a> 14496             <em class='brace'>}</em>
<a id='L14497' name='L14497'></a> 14497 
<a id='L14498' name='L14498'></a> 14498           <strong class='reserved'>if</strong> (!window_seen)
<a id='L14499' name='L14499'></a> 14499             <strong class='reserved'>continue</strong>;
<a id='L14500' name='L14500'></a> 14500 
<a id='L14501' name='L14501'></a> 14501           rc = XGetWindowAttributes (dpy, children[i], &amp;attrs);
<a id='L14502' name='L14502'></a> 14502 
<a id='L14503' name='L14503'></a> 14503           <strong class='reserved'>if</strong> (rc &amp;&amp; attrs.map_state != IsViewable)
<a id='L14504' name='L14504'></a> 14504             <strong class='reserved'>continue</strong>;
<a id='L14505' name='L14505'></a> 14505 
<a id='L14506' name='L14506'></a> 14506           <strong class='reserved'>if</strong> (rc &amp;&amp; parent_x &gt;= attrs.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>
<a id='L14507' name='L14507'></a> 14507               &amp;&amp; parent_y &gt;= attrs.y
<a id='L14508' name='L14508'></a> 14508               &amp;&amp; parent_x &lt; attrs.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + attrs.width
<a id='L14509' name='L14509'></a> 14509               &amp;&amp; parent_y &lt; attrs.y + attrs.height)
<a id='L14510' name='L14510'></a> 14510             <em class='brace'>{</em>
<a id='L14511' name='L14511'></a> 14511               <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a> = children[i];
<a id='L14512' name='L14512'></a> 14512               cx = parent_x - attrs.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L14513' name='L14513'></a> 14513               cy = parent_y - attrs.y;
<a id='L14514' name='L14514'></a> 14514 
<a id='L14515' name='L14515'></a> 14515               <strong class='reserved'>break</strong>;
<a id='L14516' name='L14516'></a> 14516             <em class='brace'>}</em>
<a id='L14517' name='L14517'></a> 14517         <em class='brace'>}</em>
<a id='L14518' name='L14518'></a> 14518     <em class='brace'>}</em>
<a id='L14519' name='L14519'></a> 14519 
<a id='L14520' name='L14520'></a> 14520   <strong class='reserved'>if</strong> (children)
<a id='L14521' name='L14521'></a> 14521     XFree (children);
<a id='L14522' name='L14522'></a> 14522 
<a id='L14523' name='L14523'></a> 14523   <strong class='reserved'>if</strong> (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>)
<a id='L14524' name='L14524'></a> 14524     <em class='brace'>{</em>
<a id='L14525' name='L14525'></a> 14525       *inner_x = cx;
<a id='L14526' name='L14526'></a> 14526       *inner_y = cy;
<a id='L14527' name='L14527'></a> 14527     <em class='brace'>}</em>
<a id='L14528' name='L14528'></a> 14528 
<a id='L14529' name='L14529'></a> 14529   <strong class='reserved'>return</strong> <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>;
<a id='L14530' name='L14530'></a> 14530 <em class='brace'>}</em>
<a id='L14531' name='L14531'></a> 14531 
<a id='L14532' name='L14532'></a> 14532 <em class='comment'>/* Like XTmouse_position, but much faster.  */</em>
<a id='L14533' name='L14533'></a> 14533 
<a id='L14534' name='L14534'></a> 14534 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L14535' name='L14535'></a> 14535 x_fast_mouse_position (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> **fp, <strong class='reserved'>int</strong> insist, <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> *bar_window,
<a id='L14536' name='L14536'></a> 14536                        <strong class='reserved'>enum</strong> <a href='../S/2231.html#L34' title='Defined at 34 in src/termhooks.h.'>scroll_bar_part</a> *part, <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> *<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> *y,
<a id='L14537' name='L14537'></a> 14537                        <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a> *timestamp)
<a id='L14538' name='L14538'></a> 14538 <em class='brace'>{</em>
<a id='L14539' name='L14539'></a> 14539   <strong class='reserved'>int</strong> root_x, root_y, win_x, win_y;
<a id='L14540' name='L14540'></a> 14540   <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> mask;
<a id='L14541' name='L14541'></a> 14541   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> <a href='../D/10645.html' title='Multiple defined in 5 places.'>dummy</a>;
<a id='L14542' name='L14542'></a> 14542   <strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>;
<a id='L14543' name='L14543'></a> 14543   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L14544' name='L14544'></a> 14544   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>;
<a id='L14545' name='L14545'></a> 14545   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a>;
<a id='L14546' name='L14546'></a> 14546 
<a id='L14547' name='L14547'></a> 14547   dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (*fp);
<a id='L14548' name='L14548'></a> 14548 
<a id='L14549' name='L14549'></a> 14549   <strong class='reserved'>if</strong> (dpyinfo-&gt;last_mouse_scroll_bar &amp;&amp; !insist)
<a id='L14550' name='L14550'></a> 14550     <em class='brace'>{</em>
<a id='L14551' name='L14551'></a> 14551       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> = dpyinfo-&gt;last_mouse_scroll_bar;
<a id='L14552' name='L14552'></a> 14552 
<a id='L14553' name='L14553'></a> 14553       <strong class='reserved'>if</strong> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;horizontal)
<a id='L14554' name='L14554'></a> 14554         x_horizontal_scroll_bar_report_motion (fp, bar_window, part,
<a id='L14555' name='L14555'></a> 14555                                                <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, timestamp);
<a id='L14556' name='L14556'></a> 14556       <strong class='reserved'>else</strong>
<a id='L14557' name='L14557'></a> 14557         x_scroll_bar_report_motion (fp, bar_window, part,
<a id='L14558' name='L14558'></a> 14558                                     <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, timestamp);
<a id='L14559' name='L14559'></a> 14559 
<a id='L14560' name='L14560'></a> 14560       <strong class='reserved'>return</strong>;
<a id='L14561' name='L14561'></a> 14561     <em class='brace'>}</em>
<a id='L14562' name='L14562'></a> 14562 
<a id='L14563' name='L14563'></a> 14563   <strong class='reserved'>if</strong> (!<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (Vx_use_fast_mouse_position, Qreally_fast))
<a id='L14564' name='L14564'></a> 14564     <em class='brace'>{</em>
<a id='L14565' name='L14565'></a> 14565       <em class='comment'>/* This means that Emacs should select a frame and report the</em>
<a id='L14566' name='L14566'></a> 14566 <em class='comment'>         mouse position relative to it.  The approach used here avoids</em>
<a id='L14567' name='L14567'></a> 14567 <em class='comment'>         making multiple roundtrips to the X server querying for the</em>
<a id='L14568' name='L14568'></a> 14568 <em class='comment'>         window beneath the pointer, and was borrowed from</em>
<a id='L14569' name='L14569'></a> 14569 <em class='comment'>         haiku_mouse_position in haikuterm.c.  */</em>
<a id='L14570' name='L14570'></a> 14570 
<a id='L14571' name='L14571'></a> 14571       <a href='../S/2183.html#L1405' title='Defined at 1405 in src/frame.h.'>FOR_EACH_FRAME</a> (<a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)
<a id='L14572' name='L14572'></a> 14572         <em class='brace'>{</em>
<a id='L14573' name='L14573'></a> 14573           <strong class='reserved'>if</strong> (<a href='../S/2183.html#L919' title='Defined at 919 in src/frame.h.'>FRAME_X_P</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>))
<a id='L14574' name='L14574'></a> 14574               &amp;&amp; (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>))
<a id='L14575' name='L14575'></a> 14575                   == dpyinfo))
<a id='L14576' name='L14576'></a> 14576             <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)-&gt;mouse_moved = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L14577' name='L14577'></a> 14577         <em class='brace'>}</em>
<a id='L14578' name='L14578'></a> 14578 
<a id='L14579' name='L14579'></a> 14579       <strong class='reserved'>if</strong> (<a href='../S/2247.html#L5226' title='Defined at 5226 in src/frame.c.'>gui_mouse_grabbed</a> (dpyinfo)
<a id='L14580' name='L14580'></a> 14580           &amp;&amp; !<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (track_mouse, Qdropping)
<a id='L14581' name='L14581'></a> 14581           &amp;&amp; !<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (track_mouse, Qdrag_source))
<a id='L14582' name='L14582'></a> 14582         <em class='comment'>/* Pick the last mouse frame if dropping.  */</em>
<a id='L14583' name='L14583'></a> 14583         <a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a> = dpyinfo-&gt;last_mouse_frame;
<a id='L14584' name='L14584'></a> 14584       <strong class='reserved'>else</strong>
<a id='L14585' name='L14585'></a> 14585         <em class='comment'>/* Otherwise, pick the last mouse motion frame.  */</em>
<a id='L14586' name='L14586'></a> 14586         <a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a> = dpyinfo-&gt;last_mouse_motion_frame;
<a id='L14587' name='L14587'></a> 14587 
<a id='L14588' name='L14588'></a> 14588       <strong class='reserved'>if</strong> (!<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a> &amp;&amp; (<a href='../S/2183.html#L919' title='Defined at 919 in src/frame.h.'>FRAME_X_P</a> (<a href='../S/2183.html#L1529' title='Defined at 1529 in src/frame.h.'>SELECTED_FRAME</a> ())
<a id='L14589' name='L14589'></a> 14589                   &amp;&amp; (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../S/2183.html#L1529' title='Defined at 1529 in src/frame.h.'>SELECTED_FRAME</a> ())
<a id='L14590' name='L14590'></a> 14590                       == dpyinfo)))
<a id='L14591' name='L14591'></a> 14591         <a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a> = <a href='../S/2183.html#L1529' title='Defined at 1529 in src/frame.h.'>SELECTED_FRAME</a> ();
<a id='L14592' name='L14592'></a> 14592 
<a id='L14593' name='L14593'></a> 14593       <strong class='reserved'>if</strong> (!<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a> || (!<a href='../S/2183.html#L919' title='Defined at 919 in src/frame.h.'>FRAME_X_P</a> (<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a>) &amp;&amp; (insist &gt; 0)))
<a id='L14594' name='L14594'></a> 14594         <a href='../S/2183.html#L1405' title='Defined at 1405 in src/frame.h.'>FOR_EACH_FRAME</a> (<a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)
<a id='L14595' name='L14595'></a> 14595           <strong class='reserved'>if</strong> (<a href='../S/2183.html#L919' title='Defined at 919 in src/frame.h.'>FRAME_X_P</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>))
<a id='L14596' name='L14596'></a> 14596               &amp;&amp; (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>))
<a id='L14597' name='L14597'></a> 14597                   == dpyinfo)
<a id='L14598' name='L14598'></a> 14598               &amp;&amp; !<a href='../D/2425.html' title='Multiple defined in 2 places.'>FRAME_TOOLTIP_P</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)))
<a id='L14599' name='L14599'></a> 14599             <a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>);
<a id='L14600' name='L14600'></a> 14600 
<a id='L14601' name='L14601'></a> 14601       <strong class='reserved'>if</strong> (<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a> &amp;&amp; <a href='../D/2425.html' title='Multiple defined in 2 places.'>FRAME_TOOLTIP_P</a> (<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a>))
<a id='L14602' name='L14602'></a> 14602         <a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a> = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L14603' name='L14603'></a> 14603 
<a id='L14604' name='L14604'></a> 14604       <strong class='reserved'>if</strong> (<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a> &amp;&amp; <a href='../S/2183.html#L919' title='Defined at 919 in src/frame.h.'>FRAME_X_P</a> (<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a>) &amp;&amp; <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a>))
<a id='L14605' name='L14605'></a> 14605         <em class='brace'>{</em>
<a id='L14606' name='L14606'></a> 14606           <strong class='reserved'>if</strong> (!x_query_pointer (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a>),
<a id='L14607' name='L14607'></a> 14607                                 &amp;<a href='../D/10645.html' title='Multiple defined in 5 places.'>dummy</a>, &amp;<a href='../D/10645.html' title='Multiple defined in 5 places.'>dummy</a>, &amp;root_x, &amp;root_y,
<a id='L14608' name='L14608'></a> 14608                                 &amp;win_x, &amp;win_y, &amp;mask))
<a id='L14609' name='L14609'></a> 14609             <em class='comment'>/* The pointer is out of the screen.  */</em>
<a id='L14610' name='L14610'></a> 14610             <strong class='reserved'>return</strong>;
<a id='L14611' name='L14611'></a> 14611 
<a id='L14612' name='L14612'></a> 14612           <a href='../S/2224.html#L2719' title='Defined at 2719 in src/xdisp.c.'>remember_mouse_glyph</a> (<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a>, win_x, win_y,
<a id='L14613' name='L14613'></a> 14613                                 &amp;dpyinfo-&gt;last_mouse_glyph);
<a id='L14614' name='L14614'></a> 14614           dpyinfo-&gt;last_mouse_glyph_frame = <a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a>;
<a id='L14615' name='L14615'></a> 14615 
<a id='L14616' name='L14616'></a> 14616           *bar_window = Qnil;
<a id='L14617' name='L14617'></a> 14617           *part = <a href='../S/2231.html#L36' title='Defined at 36 in src/termhooks.h.'>scroll_bar_nowhere</a>;
<a id='L14618' name='L14618'></a> 14618 
<a id='L14619' name='L14619'></a> 14619           <em class='comment'>/* If track-mouse is `drag-source' and the mouse pointer is</em>
<a id='L14620' name='L14620'></a> 14620 <em class='comment'>             certain to not be actually under the chosen frame, return</em>
<a id='L14621' name='L14621'></a> 14621 <em class='comment'>             NULL in FP.  */</em>
<a id='L14622' name='L14622'></a> 14622           <strong class='reserved'>if</strong> (<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (track_mouse, Qdrag_source)
<a id='L14623' name='L14623'></a> 14623               &amp;&amp; (win_x &lt; 0 || win_y &lt; 0
<a id='L14624' name='L14624'></a> 14624                   || win_x &gt;= <a href='../S/2183.html#L1051' title='Defined at 1051 in src/frame.h.'>FRAME_PIXEL_WIDTH</a> (<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a>)
<a id='L14625' name='L14625'></a> 14625                   || win_y &gt;= <a href='../S/2183.html#L1052' title='Defined at 1052 in src/frame.h.'>FRAME_PIXEL_HEIGHT</a> (<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a>)))
<a id='L14626' name='L14626'></a> 14626             *fp = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L14627' name='L14627'></a> 14627           <strong class='reserved'>else</strong>
<a id='L14628' name='L14628'></a> 14628             *fp = <a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a>;
<a id='L14629' name='L14629'></a> 14629 
<a id='L14630' name='L14630'></a> 14630           *timestamp = dpyinfo-&gt;last_mouse_movement_time;
<a id='L14631' name='L14631'></a> 14631           <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (*<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, win_x);
<a id='L14632' name='L14632'></a> 14632           <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (*y, win_y);
<a id='L14633' name='L14633'></a> 14633         <em class='brace'>}</em>
<a id='L14634' name='L14634'></a> 14634     <em class='brace'>}</em>
<a id='L14635' name='L14635'></a> 14635   <strong class='reserved'>else</strong>
<a id='L14636' name='L14636'></a> 14636     <em class='brace'>{</em>
<a id='L14637' name='L14637'></a> 14637       <em class='comment'>/* This means Emacs should only report the coordinates of the</em>
<a id='L14638' name='L14638'></a> 14638 <em class='comment'>         last mouse motion.  */</em>
<a id='L14639' name='L14639'></a> 14639 
<a id='L14640' name='L14640'></a> 14640       <strong class='reserved'>if</strong> (dpyinfo-&gt;last_mouse_motion_frame)
<a id='L14641' name='L14641'></a> 14641         <em class='brace'>{</em>
<a id='L14642' name='L14642'></a> 14642           *fp = dpyinfo-&gt;last_mouse_motion_frame;
<a id='L14643' name='L14643'></a> 14643           *timestamp = dpyinfo-&gt;last_mouse_movement_time;
<a id='L14644' name='L14644'></a> 14644           *<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = <a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (dpyinfo-&gt;last_mouse_motion_x);
<a id='L14645' name='L14645'></a> 14645           *y = <a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (dpyinfo-&gt;last_mouse_motion_y);
<a id='L14646' name='L14646'></a> 14646           *bar_window = Qnil;
<a id='L14647' name='L14647'></a> 14647           *part = <a href='../S/2231.html#L36' title='Defined at 36 in src/termhooks.h.'>scroll_bar_nowhere</a>;
<a id='L14648' name='L14648'></a> 14648 
<a id='L14649' name='L14649'></a> 14649           <a href='../S/2183.html#L1405' title='Defined at 1405 in src/frame.h.'>FOR_EACH_FRAME</a> (<a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)
<a id='L14650' name='L14650'></a> 14650             <em class='brace'>{</em>
<a id='L14651' name='L14651'></a> 14651               <strong class='reserved'>if</strong> (<a href='../S/2183.html#L919' title='Defined at 919 in src/frame.h.'>FRAME_X_P</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>))
<a id='L14652' name='L14652'></a> 14652                   &amp;&amp; (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>))
<a id='L14653' name='L14653'></a> 14653                       == dpyinfo))
<a id='L14654' name='L14654'></a> 14654                 <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)-&gt;mouse_moved = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L14655' name='L14655'></a> 14655             <em class='brace'>}</em>
<a id='L14656' name='L14656'></a> 14656 
<a id='L14657' name='L14657'></a> 14657           dpyinfo-&gt;last_mouse_motion_frame-&gt;mouse_moved = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L14658' name='L14658'></a> 14658         <em class='brace'>}</em>
<a id='L14659' name='L14659'></a> 14659     <em class='brace'>}</em>
<a id='L14660' name='L14660'></a> 14660 <em class='brace'>}</em>
<a id='L14661' name='L14661'></a> 14661 
<a id='L14662' name='L14662'></a> 14662 <em class='comment'>/* Return the current position of the mouse.</em>
<a id='L14663' name='L14663'></a> 14663 <em class='comment'>   *FP should be a frame which indicates which display to ask about.</em>
<a id='L14664' name='L14664'></a> 14664 <em class='comment'></em>
<a id='L14665' name='L14665'></a> 14665 <em class='comment'>   If the mouse movement started in a scroll bar, set *FP, *BAR_WINDOW,</em>
<a id='L14666' name='L14666'></a> 14666 <em class='comment'>   and *PART to the frame, window, and scroll bar part that the mouse</em>
<a id='L14667' name='L14667'></a> 14667 <em class='comment'>   is over.  Set *X and *Y to the portion and whole of the mouse's</em>
<a id='L14668' name='L14668'></a> 14668 <em class='comment'>   position on the scroll bar.</em>
<a id='L14669' name='L14669'></a> 14669 <em class='comment'></em>
<a id='L14670' name='L14670'></a> 14670 <em class='comment'>   If the mouse movement started elsewhere, set *FP to the frame the</em>
<a id='L14671' name='L14671'></a> 14671 <em class='comment'>   mouse is on, *BAR_WINDOW to nil, and *X and *Y to the character cell</em>
<a id='L14672' name='L14672'></a> 14672 <em class='comment'>   the mouse is over.</em>
<a id='L14673' name='L14673'></a> 14673 <em class='comment'></em>
<a id='L14674' name='L14674'></a> 14674 <em class='comment'>   Set *TIMESTAMP to the server time-stamp for the time at which the mouse</em>
<a id='L14675' name='L14675'></a> 14675 <em class='comment'>   was at this position.</em>
<a id='L14676' name='L14676'></a> 14676 <em class='comment'></em>
<a id='L14677' name='L14677'></a> 14677 <em class='comment'>   Don't store anything if we don't have a valid set of values to report.</em>
<a id='L14678' name='L14678'></a> 14678 <em class='comment'></em>
<a id='L14679' name='L14679'></a> 14679 <em class='comment'>   This clears the mouse_moved flag, so we can wait for the next mouse</em>
<a id='L14680' name='L14680'></a> 14680 <em class='comment'>   movement.  */</em>
<a id='L14681' name='L14681'></a> 14681 
<a id='L14682' name='L14682'></a> 14682 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L14683' name='L14683'></a> 14683 XTmouse_position (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> **fp, <strong class='reserved'>int</strong> insist, <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> *bar_window,
<a id='L14684' name='L14684'></a> 14684                   <strong class='reserved'>enum</strong> <a href='../S/2231.html#L34' title='Defined at 34 in src/termhooks.h.'>scroll_bar_part</a> *part, <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> *<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> *y,
<a id='L14685' name='L14685'></a> 14685                   <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a> *timestamp)
<a id='L14686' name='L14686'></a> 14686 <em class='brace'>{</em>
<a id='L14687' name='L14687'></a> 14687   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a>, *maybe_tooltip;
<a id='L14688' name='L14688'></a> 14688   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L14689' name='L14689'></a> 14689   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> unrelated_tooltip;
<a id='L14690' name='L14690'></a> 14690 
<a id='L14691' name='L14691'></a> 14691   dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (*fp);
<a id='L14692' name='L14692'></a> 14692 
<a id='L14693' name='L14693'></a> 14693   <strong class='reserved'>if</strong> (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (Vx_use_fast_mouse_position))
<a id='L14694' name='L14694'></a> 14694     <em class='brace'>{</em>
<a id='L14695' name='L14695'></a> 14695       <em class='comment'>/* The user says that Emacs is running over the network, and a</em>
<a id='L14696' name='L14696'></a> 14696 <em class='comment'>         fast approximation of `mouse-position' should be used.</em>
<a id='L14697' name='L14697'></a> 14697 <em class='comment'></em>
<a id='L14698' name='L14698'></a> 14698 <em class='comment'>         Depending on what the value of `x-use-fast-mouse-position'</em>
<a id='L14699' name='L14699'></a> 14699 <em class='comment'>         is, do one of two things: only perform the XQueryPointer to</em>
<a id='L14700' name='L14700'></a> 14700 <em class='comment'>         obtain the coordinates from the last mouse frame, or only</em>
<a id='L14701' name='L14701'></a> 14701 <em class='comment'>         return the last mouse motion frame and the</em>
<a id='L14702' name='L14702'></a> 14702 <em class='comment'>         last_mouse_motion_x and Y.  */</em>
<a id='L14703' name='L14703'></a> 14703 
<a id='L14704' name='L14704'></a> 14704       x_fast_mouse_position (fp, insist, bar_window, part, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>,
<a id='L14705' name='L14705'></a> 14705                              y, timestamp);
<a id='L14706' name='L14706'></a> 14706       <strong class='reserved'>return</strong>;
<a id='L14707' name='L14707'></a> 14707     <em class='brace'>}</em>
<a id='L14708' name='L14708'></a> 14708 
<a id='L14709' name='L14709'></a> 14709   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L14710' name='L14710'></a> 14710 
<a id='L14711' name='L14711'></a> 14711   <strong class='reserved'>if</strong> (dpyinfo-&gt;last_mouse_scroll_bar &amp;&amp; insist == 0)
<a id='L14712' name='L14712'></a> 14712     <em class='brace'>{</em>
<a id='L14713' name='L14713'></a> 14713       <strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> = dpyinfo-&gt;last_mouse_scroll_bar;
<a id='L14714' name='L14714'></a> 14714 
<a id='L14715' name='L14715'></a> 14715       <strong class='reserved'>if</strong> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;horizontal)
<a id='L14716' name='L14716'></a> 14716         x_horizontal_scroll_bar_report_motion (fp, bar_window, part, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, timestamp);
<a id='L14717' name='L14717'></a> 14717       <strong class='reserved'>else</strong>
<a id='L14718' name='L14718'></a> 14718         x_scroll_bar_report_motion (fp, bar_window, part, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, timestamp);
<a id='L14719' name='L14719'></a> 14719     <em class='brace'>}</em>
<a id='L14720' name='L14720'></a> 14720   <strong class='reserved'>else</strong>
<a id='L14721' name='L14721'></a> 14721     <em class='brace'>{</em>
<a id='L14722' name='L14722'></a> 14722       <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> root;
<a id='L14723' name='L14723'></a> 14723       <strong class='reserved'>int</strong> root_x, root_y;
<a id='L14724' name='L14724'></a> 14724 
<a id='L14725' name='L14725'></a> 14725       <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> dummy_window;
<a id='L14726' name='L14726'></a> 14726       <strong class='reserved'>int</strong> <a href='../D/10645.html' title='Multiple defined in 5 places.'>dummy</a>;
<a id='L14727' name='L14727'></a> 14727 
<a id='L14728' name='L14728'></a> 14728       <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>;
<a id='L14729' name='L14729'></a> 14729 
<a id='L14730' name='L14730'></a> 14730       <em class='comment'>/* Clear the mouse-moved flag for every frame on this display.  */</em>
<a id='L14731' name='L14731'></a> 14731       <a href='../S/2183.html#L1405' title='Defined at 1405 in src/frame.h.'>FOR_EACH_FRAME</a> (<a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)
<a id='L14732' name='L14732'></a> 14732         <strong class='reserved'>if</strong> (<a href='../S/2183.html#L919' title='Defined at 919 in src/frame.h.'>FRAME_X_P</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>))
<a id='L14733' name='L14733'></a> 14733             &amp;&amp; <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)) == <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (*fp))
<a id='L14734' name='L14734'></a> 14734           <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)-&gt;mouse_moved = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L14735' name='L14735'></a> 14735 
<a id='L14736' name='L14736'></a> 14736       dpyinfo-&gt;last_mouse_scroll_bar = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L14737' name='L14737'></a> 14737 
<a id='L14738' name='L14738'></a> 14738       <em class='comment'>/* Figure out which root window we're on.  */</em>
<a id='L14739' name='L14739'></a> 14739       x_query_pointer (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (*fp),
<a id='L14740' name='L14740'></a> 14740                        DefaultRootWindow (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (*fp)),
<a id='L14741' name='L14741'></a> 14741                        <em class='comment'>/* The root window which contains the pointer.  */</em>
<a id='L14742' name='L14742'></a> 14742                        &amp;root,
<a id='L14743' name='L14743'></a> 14743                        <em class='comment'>/* Trash which we can't trust if the pointer is on</em>
<a id='L14744' name='L14744'></a> 14744 <em class='comment'>                          a different screen.  */</em>
<a id='L14745' name='L14745'></a> 14745                        &amp;dummy_window,
<a id='L14746' name='L14746'></a> 14746                        <em class='comment'>/* The position on that root window.  */</em>
<a id='L14747' name='L14747'></a> 14747                        &amp;root_x, &amp;root_y,
<a id='L14748' name='L14748'></a> 14748                        <em class='comment'>/* More trash we can't trust.  */</em>
<a id='L14749' name='L14749'></a> 14749                        &amp;<a href='../D/10645.html' title='Multiple defined in 5 places.'>dummy</a>, &amp;<a href='../D/10645.html' title='Multiple defined in 5 places.'>dummy</a>,
<a id='L14750' name='L14750'></a> 14750                        <em class='comment'>/* Modifier keys and pointer buttons, about which</em>
<a id='L14751' name='L14751'></a> 14751 <em class='comment'>                          we don't care.  */</em>
<a id='L14752' name='L14752'></a> 14752                        (<strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> *) &amp;<a href='../D/10645.html' title='Multiple defined in 5 places.'>dummy</a>);
<a id='L14753' name='L14753'></a> 14753 
<a id='L14754' name='L14754'></a> 14754       <em class='comment'>/* Now we have a position on the root; find the innermost window</em>
<a id='L14755' name='L14755'></a> 14755 <em class='comment'>         containing the pointer.  */</em>
<a id='L14756' name='L14756'></a> 14756       <em class='brace'>{</em>
<a id='L14757' name='L14757'></a> 14757         <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> win, child;
<a id='L14758' name='L14758'></a> 14758 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L14759' name='L14759'></a> 14759         <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> first_win = 0;
<a id='L14760' name='L14760'></a> 14760 <em class='sharp'>#endif</em>
<a id='L14761' name='L14761'></a> 14761         <strong class='reserved'>int</strong> win_x, win_y;
<a id='L14762' name='L14762'></a> 14762         <strong class='reserved'>int</strong> parent_x, parent_y;
<a id='L14763' name='L14763'></a> 14763 
<a id='L14764' name='L14764'></a> 14764         win = root;
<a id='L14765' name='L14765'></a> 14765         parent_x = root_x;
<a id='L14766' name='L14766'></a> 14766         parent_y = root_y;
<a id='L14767' name='L14767'></a> 14767 
<a id='L14768' name='L14768'></a> 14768         <em class='comment'>/* XTranslateCoordinates can get errors if the window</em>
<a id='L14769' name='L14769'></a> 14769 <em class='comment'>           structure is changing at the same time this function</em>
<a id='L14770' name='L14770'></a> 14770 <em class='comment'>           is running.  So at least we must not crash from them.  */</em>
<a id='L14771' name='L14771'></a> 14771 
<a id='L14772' name='L14772'></a> 14772         x_catch_errors (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (*fp));
<a id='L14773' name='L14773'></a> 14773 
<a id='L14774' name='L14774'></a> 14774         <strong class='reserved'>if</strong> (<a href='../S/2247.html#L5226' title='Defined at 5226 in src/frame.c.'>gui_mouse_grabbed</a> (dpyinfo) &amp;&amp; !<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (track_mouse, Qdropping)
<a id='L14775' name='L14775'></a> 14775             &amp;&amp; !<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (track_mouse, Qdrag_source))
<a id='L14776' name='L14776'></a> 14776           <em class='brace'>{</em>
<a id='L14777' name='L14777'></a> 14777             <em class='comment'>/* If mouse was grabbed on a frame, give coords for that frame</em>
<a id='L14778' name='L14778'></a> 14778 <em class='comment'>               even if the mouse is now outside it.  */</em>
<a id='L14779' name='L14779'></a> 14779             XTranslateCoordinates (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (*fp),
<a id='L14780' name='L14780'></a> 14780                                    <em class='comment'>/* From-window.  */</em>
<a id='L14781' name='L14781'></a> 14781                                    root,
<a id='L14782' name='L14782'></a> 14782                                    <em class='comment'>/* To-window.  */</em>
<a id='L14783' name='L14783'></a> 14783                                    <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (dpyinfo-&gt;last_mouse_frame),
<a id='L14784' name='L14784'></a> 14784                                    <em class='comment'>/* From-position, to-position.  */</em>
<a id='L14785' name='L14785'></a> 14785                                    root_x, root_y, &amp;win_x, &amp;win_y,
<a id='L14786' name='L14786'></a> 14786                                    <em class='comment'>/* Child of win.  */</em>
<a id='L14787' name='L14787'></a> 14787                                    &amp;child);
<a id='L14788' name='L14788'></a> 14788             <a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a> = dpyinfo-&gt;last_mouse_frame;
<a id='L14789' name='L14789'></a> 14789           <em class='brace'>}</em>
<a id='L14790' name='L14790'></a> 14790         <strong class='reserved'>else</strong>
<a id='L14791' name='L14791'></a> 14791           <em class='brace'>{</em>
<a id='L14792' name='L14792'></a> 14792             <strong class='reserved'>while</strong> (<a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>)
<a id='L14793' name='L14793'></a> 14793               <em class='brace'>{</em>
<a id='L14794' name='L14794'></a> 14794                 XTranslateCoordinates (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (*fp),
<a id='L14795' name='L14795'></a> 14795                                        <em class='comment'>/* From-window, to-window.  */</em>
<a id='L14796' name='L14796'></a> 14796                                        root, win,
<a id='L14797' name='L14797'></a> 14797                                        <em class='comment'>/* From-position, to-position.  */</em>
<a id='L14798' name='L14798'></a> 14798                                        root_x, root_y, &amp;win_x, &amp;win_y,
<a id='L14799' name='L14799'></a> 14799                                        <em class='comment'>/* Child of win.  */</em>
<a id='L14800' name='L14800'></a> 14800                                        &amp;child);
<a id='L14801' name='L14801'></a> 14801 
<a id='L14802' name='L14802'></a> 14802                 <em class='comment'>/* If CHILD is a tooltip frame, look below it if</em>
<a id='L14803' name='L14803'></a> 14803 <em class='comment'>                   track-mouse is drag-source.  */</em>
<a id='L14804' name='L14804'></a> 14804                 <strong class='reserved'>if</strong> (child != None
<a id='L14805' name='L14805'></a> 14805                     &amp;&amp; (<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (track_mouse, Qdrag_source)
<a id='L14806' name='L14806'></a> 14806                         || <a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (track_mouse, Qdropping)))
<a id='L14807' name='L14807'></a> 14807                   <em class='brace'>{</em>
<a id='L14808' name='L14808'></a> 14808                     maybe_tooltip = <a href='../S/2289.html#L12010' title='Defined at 12010 in src/xterm.c.'>x_tooltip_window_to_frame</a> (dpyinfo, child,
<a id='L14809' name='L14809'></a> 14809                                                                &amp;unrelated_tooltip);
<a id='L14810' name='L14810'></a> 14810 
<a id='L14811' name='L14811'></a> 14811                     <strong class='reserved'>if</strong> (maybe_tooltip || unrelated_tooltip)
<a id='L14812' name='L14812'></a> 14812                       child = x_get_window_below (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, child,
<a id='L14813' name='L14813'></a> 14813                                                   parent_x, parent_y, &amp;win_x,
<a id='L14814' name='L14814'></a> 14814                                                   &amp;win_y);
<a id='L14815' name='L14815'></a> 14815                   <em class='brace'>}</em>
<a id='L14816' name='L14816'></a> 14816 
<a id='L14817' name='L14817'></a> 14817                 <strong class='reserved'>if</strong> (child == None || child == win)
<a id='L14818' name='L14818'></a> 14818                   <em class='brace'>{</em>
<a id='L14819' name='L14819'></a> 14819 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L14820' name='L14820'></a> 14820                     <em class='comment'>/* On GTK we have not inspected WIN yet.  If it has</em>
<a id='L14821' name='L14821'></a> 14821 <em class='comment'>                       a frame and that frame has a parent, use it.  */</em>
<a id='L14822' name='L14822'></a> 14822                     <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2289.html#L11957' title='Defined at 11957 in src/xterm.c.'>x_window_to_frame</a> (dpyinfo, win);
<a id='L14823' name='L14823'></a> 14823 
<a id='L14824' name='L14824'></a> 14824                     <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; <a href='../D/2370.html' title='Multiple defined in 2 places.'>FRAME_PARENT_FRAME</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L14825' name='L14825'></a> 14825                       first_win = win;
<a id='L14826' name='L14826'></a> 14826 <em class='sharp'>#endif</em>
<a id='L14827' name='L14827'></a> 14827                     <strong class='reserved'>break</strong>;
<a id='L14828' name='L14828'></a> 14828                   <em class='brace'>}</em>
<a id='L14829' name='L14829'></a> 14829 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L14830' name='L14830'></a> 14830                 <em class='comment'>/* We don't want to know the innermost window.  We</em>
<a id='L14831' name='L14831'></a> 14831 <em class='comment'>                   want the edit window.  For non-Gtk+ the innermost</em>
<a id='L14832' name='L14832'></a> 14832 <em class='comment'>                   window is the edit window.  For Gtk+ it might not</em>
<a id='L14833' name='L14833'></a> 14833 <em class='comment'>                   be.  It might be the tool bar for example.  */</em>
<a id='L14834' name='L14834'></a> 14834                 <strong class='reserved'>if</strong> (<a href='../S/2289.html#L11957' title='Defined at 11957 in src/xterm.c.'>x_window_to_frame</a> (dpyinfo, win))
<a id='L14835' name='L14835'></a> 14835                   <em class='comment'>/* But don't hurry.  We might find a child frame</em>
<a id='L14836' name='L14836'></a> 14836 <em class='comment'>                     beneath.  */</em>
<a id='L14837' name='L14837'></a> 14837                   first_win = win;
<a id='L14838' name='L14838'></a> 14838 <em class='sharp'>#endif</em>
<a id='L14839' name='L14839'></a> 14839                 win = child;
<a id='L14840' name='L14840'></a> 14840                 parent_x = win_x;
<a id='L14841' name='L14841'></a> 14841                 parent_y = win_y;
<a id='L14842' name='L14842'></a> 14842               <em class='brace'>}</em>
<a id='L14843' name='L14843'></a> 14843 
<a id='L14844' name='L14844'></a> 14844 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L14845' name='L14845'></a> 14845             <strong class='reserved'>if</strong> (first_win)
<a id='L14846' name='L14846'></a> 14846               win = first_win;
<a id='L14847' name='L14847'></a> 14847 <em class='sharp'>#endif</em>
<a id='L14848' name='L14848'></a> 14848 
<a id='L14849' name='L14849'></a> 14849             <em class='comment'>/* Now we know that:</em>
<a id='L14850' name='L14850'></a> 14850 <em class='comment'>               win is the innermost window containing the pointer</em>
<a id='L14851' name='L14851'></a> 14851 <em class='comment'>               (XTC says it has no child containing the pointer),</em>
<a id='L14852' name='L14852'></a> 14852 <em class='comment'>               win_x and win_y are the pointer's position in it</em>
<a id='L14853' name='L14853'></a> 14853 <em class='comment'>               (XTC did this the last time through), and</em>
<a id='L14854' name='L14854'></a> 14854 <em class='comment'>               parent_x and parent_y are the pointer's position in win's parent.</em>
<a id='L14855' name='L14855'></a> 14855 <em class='comment'>               (They are what win_x and win_y were when win was child.</em>
<a id='L14856' name='L14856'></a> 14856 <em class='comment'>               If win is the root window, it has no parent, and</em>
<a id='L14857' name='L14857'></a> 14857 <em class='comment'>               parent_{x,y} are invalid, but that's okay, because we'll</em>
<a id='L14858' name='L14858'></a> 14858 <em class='comment'>               never use them in that case.)  */</em>
<a id='L14859' name='L14859'></a> 14859 
<a id='L14860' name='L14860'></a> 14860 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L14861' name='L14861'></a> 14861             <em class='comment'>/* We don't want to know the innermost window.  We</em>
<a id='L14862' name='L14862'></a> 14862 <em class='comment'>               want the edit window.  */</em>
<a id='L14863' name='L14863'></a> 14863             <a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a> = <a href='../S/2289.html#L11957' title='Defined at 11957 in src/xterm.c.'>x_window_to_frame</a> (dpyinfo, win);
<a id='L14864' name='L14864'></a> 14864 <em class='sharp'>#else</em>
<a id='L14865' name='L14865'></a> 14865             <em class='comment'>/* Is win one of our frames?  */</em>
<a id='L14866' name='L14866'></a> 14866             <a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a> = <a href='../D/19416.html' title='Multiple defined in 2 places.'>x_any_window_to_frame</a> (dpyinfo, win);
<a id='L14867' name='L14867'></a> 14867 <em class='sharp'>#endif</em>
<a id='L14868' name='L14868'></a> 14868 
<a id='L14869' name='L14869'></a> 14869 <em class='sharp'>#ifdef</em> USE_X_TOOLKIT
<a id='L14870' name='L14870'></a> 14870             <em class='comment'>/* If we end up with the menu bar window, say it's not</em>
<a id='L14871' name='L14871'></a> 14871 <em class='comment'>               on the frame.  */</em>
<a id='L14872' name='L14872'></a> 14872             <strong class='reserved'>if</strong> (<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a> != <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>
<a id='L14873' name='L14873'></a> 14873                 &amp;&amp; <a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;menubar_widget
<a id='L14874' name='L14874'></a> 14874                 &amp;&amp; win == XtWindow (<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;menubar_widget))
<a id='L14875' name='L14875'></a> 14875               <a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a> = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L14876' name='L14876'></a> 14876 <em class='sharp'>#endif</em> <em class='comment'>/* USE_X_TOOLKIT */</em>
<a id='L14877' name='L14877'></a> 14877           <em class='brace'>}</em>
<a id='L14878' name='L14878'></a> 14878 
<a id='L14879' name='L14879'></a> 14879         <em class='comment'>/* Set last user time to avoid confusing some window managers</em>
<a id='L14880' name='L14880'></a> 14880 <em class='comment'>           about the tooltip displayed during drag-and-drop.  */</em>
<a id='L14881' name='L14881'></a> 14881 
<a id='L14882' name='L14882'></a> 14882         <strong class='reserved'>if</strong> ((<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (track_mouse, Qdrag_source)
<a id='L14883' name='L14883'></a> 14883              || <a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (track_mouse, Qdropping))
<a id='L14884' name='L14884'></a> 14884             &amp;&amp; (dpyinfo-&gt;last_user_time
<a id='L14885' name='L14885'></a> 14885                 &lt; dpyinfo-&gt;last_mouse_movement_time))
<a id='L14886' name='L14886'></a> 14886           <a href='../S/2289.html#L7929' title='Defined at 7929 in src/xterm.c.'>x_display_set_last_user_time</a> (dpyinfo,
<a id='L14887' name='L14887'></a> 14887                                         dpyinfo-&gt;last_mouse_movement_time,
<a id='L14888' name='L14888'></a> 14888                                         dpyinfo-&gt;last_mouse_movement_time_send_event,
<a id='L14889' name='L14889'></a> 14889                                         <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L14890' name='L14890'></a> 14890 
<a id='L14891' name='L14891'></a> 14891         <strong class='reserved'>if</strong> ((!<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a> || <a href='../D/2425.html' title='Multiple defined in 2 places.'>FRAME_TOOLTIP_P</a> (<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a>))
<a id='L14892' name='L14892'></a> 14892             &amp;&amp; (<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (track_mouse, Qdropping)
<a id='L14893' name='L14893'></a> 14893                 || <a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (track_mouse, Qdrag_source))
<a id='L14894' name='L14894'></a> 14894             &amp;&amp; <a href='../S/2247.html#L5226' title='Defined at 5226 in src/frame.c.'>gui_mouse_grabbed</a> (dpyinfo))
<a id='L14895' name='L14895'></a> 14895           <em class='brace'>{</em>
<a id='L14896' name='L14896'></a> 14896             <em class='comment'>/* When dropping then if we didn't get a frame or only a</em>
<a id='L14897' name='L14897'></a> 14897 <em class='comment'>               tooltip frame and the mouse was grabbed on a frame,</em>
<a id='L14898' name='L14898'></a> 14898 <em class='comment'>               give coords for that frame even if the mouse is now</em>
<a id='L14899' name='L14899'></a> 14899 <em class='comment'>               outside it.  */</em>
<a id='L14900' name='L14900'></a> 14900             XTranslateCoordinates (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (*fp),
<a id='L14901' name='L14901'></a> 14901                                    <em class='comment'>/* From-window.  */</em>
<a id='L14902' name='L14902'></a> 14902                                    root,
<a id='L14903' name='L14903'></a> 14903                                    <em class='comment'>/* To-window.  */</em>
<a id='L14904' name='L14904'></a> 14904                                    <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (dpyinfo-&gt;last_mouse_frame),
<a id='L14905' name='L14905'></a> 14905                                    <em class='comment'>/* From-position, to-position.  */</em>
<a id='L14906' name='L14906'></a> 14906                                    root_x, root_y, &amp;win_x, &amp;win_y,
<a id='L14907' name='L14907'></a> 14907                                    <em class='comment'>/* Child of win.  */</em>
<a id='L14908' name='L14908'></a> 14908                                    &amp;child);
<a id='L14909' name='L14909'></a> 14909 
<a id='L14910' name='L14910'></a> 14910             <strong class='reserved'>if</strong> (!<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (track_mouse, Qdrag_source)
<a id='L14911' name='L14911'></a> 14911                 <em class='comment'>/* Don't let tooltips interfere.  */</em>
<a id='L14912' name='L14912'></a> 14912                 || (<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a> &amp;&amp; <a href='../D/2425.html' title='Multiple defined in 2 places.'>FRAME_TOOLTIP_P</a> (<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a>)))
<a id='L14913' name='L14913'></a> 14913               <a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a> = dpyinfo-&gt;last_mouse_frame;
<a id='L14914' name='L14914'></a> 14914             <strong class='reserved'>else</strong>
<a id='L14915' name='L14915'></a> 14915               <em class='brace'>{</em>
<a id='L14916' name='L14916'></a> 14916                 <em class='comment'>/* Don't set FP but do set WIN_X and WIN_Y in this</em>
<a id='L14917' name='L14917'></a> 14917 <em class='comment'>                   case, so make_lispy_movement knows which</em>
<a id='L14918' name='L14918'></a> 14918 <em class='comment'>                   coordinates to report.  */</em>
<a id='L14919' name='L14919'></a> 14919                 *bar_window = Qnil;
<a id='L14920' name='L14920'></a> 14920                 *part = 0;
<a id='L14921' name='L14921'></a> 14921                 *fp = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L14922' name='L14922'></a> 14922                 <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (*<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, win_x);
<a id='L14923' name='L14923'></a> 14923                 <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (*y, win_y);
<a id='L14924' name='L14924'></a> 14924                 *timestamp = dpyinfo-&gt;last_mouse_movement_time;
<a id='L14925' name='L14925'></a> 14925               <em class='brace'>}</em>
<a id='L14926' name='L14926'></a> 14926           <em class='brace'>}</em>
<a id='L14927' name='L14927'></a> 14927         <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a> &amp;&amp; <a href='../D/2425.html' title='Multiple defined in 2 places.'>FRAME_TOOLTIP_P</a> (<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a>))
<a id='L14928' name='L14928'></a> 14928           <a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a> = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L14929' name='L14929'></a> 14929 
<a id='L14930' name='L14930'></a> 14930         <strong class='reserved'>if</strong> (x_had_errors_p (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>))
<a id='L14931' name='L14931'></a> 14931           <a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a> = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L14932' name='L14932'></a> 14932 
<a id='L14933' name='L14933'></a> 14933         x_uncatch_errors_after_check ();
<a id='L14934' name='L14934'></a> 14934 
<a id='L14935' name='L14935'></a> 14935         <em class='comment'>/* If not, is it one of our scroll bars?  */</em>
<a id='L14936' name='L14936'></a> 14936         <strong class='reserved'>if</strong> (!<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a>)
<a id='L14937' name='L14937'></a> 14937           <em class='brace'>{</em>
<a id='L14938' name='L14938'></a> 14938             <strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>;
<a id='L14939' name='L14939'></a> 14939 
<a id='L14940' name='L14940'></a> 14940             <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> = x_window_to_scroll_bar (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, win, 2);
<a id='L14941' name='L14941'></a> 14941 
<a id='L14942' name='L14942'></a> 14942             <strong class='reserved'>if</strong> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>)
<a id='L14943' name='L14943'></a> 14943               <em class='brace'>{</em>
<a id='L14944' name='L14944'></a> 14944                 <a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../S/2183.html#L914' title='Defined at 914 in src/frame.h.'>WINDOW_FRAME</a> (<a href='../D/7409.html' title='Multiple defined in 2 places.'>XWINDOW</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>)));
<a id='L14945' name='L14945'></a> 14945                 win_x = parent_x;
<a id='L14946' name='L14946'></a> 14946                 win_y = parent_y;
<a id='L14947' name='L14947'></a> 14947               <em class='brace'>}</em>
<a id='L14948' name='L14948'></a> 14948           <em class='brace'>}</em>
<a id='L14949' name='L14949'></a> 14949 
<a id='L14950' name='L14950'></a> 14950         <strong class='reserved'>if</strong> (!<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a> &amp;&amp; insist &gt; 0)
<a id='L14951' name='L14951'></a> 14951           <a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a> = <a href='../S/2183.html#L1529' title='Defined at 1529 in src/frame.h.'>SELECTED_FRAME</a> ();
<a id='L14952' name='L14952'></a> 14952 
<a id='L14953' name='L14953'></a> 14953         <strong class='reserved'>if</strong> (<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a> &amp;&amp; <a href='../S/2183.html#L919' title='Defined at 919 in src/frame.h.'>FRAME_X_P</a> (<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a>))
<a id='L14954' name='L14954'></a> 14954           <em class='brace'>{</em>
<a id='L14955' name='L14955'></a> 14955             <em class='comment'>/* Ok, we found a frame.  Store all the values.</em>
<a id='L14956' name='L14956'></a> 14956 <em class='comment'>               last_mouse_glyph is a rectangle used to reduce the</em>
<a id='L14957' name='L14957'></a> 14957 <em class='comment'>               generation of mouse events.  To not miss any motion</em>
<a id='L14958' name='L14958'></a> 14958 <em class='comment'>               events, we must divide the frame into rectangles of the</em>
<a id='L14959' name='L14959'></a> 14959 <em class='comment'>               size of the smallest character that could be displayed</em>
<a id='L14960' name='L14960'></a> 14960 <em class='comment'>               on it, i.e. into the same rectangles that matrices on</em>
<a id='L14961' name='L14961'></a> 14961 <em class='comment'>               the frame are divided into.  */</em>
<a id='L14962' name='L14962'></a> 14962 
<a id='L14963' name='L14963'></a> 14963             dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a>);
<a id='L14964' name='L14964'></a> 14964             <a href='../S/2224.html#L2719' title='Defined at 2719 in src/xdisp.c.'>remember_mouse_glyph</a> (<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a>, win_x, win_y, &amp;dpyinfo-&gt;last_mouse_glyph);
<a id='L14965' name='L14965'></a> 14965             dpyinfo-&gt;last_mouse_glyph_frame = <a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a>;
<a id='L14966' name='L14966'></a> 14966 
<a id='L14967' name='L14967'></a> 14967             *bar_window = Qnil;
<a id='L14968' name='L14968'></a> 14968             *part = 0;
<a id='L14969' name='L14969'></a> 14969             *fp = <a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a>;
<a id='L14970' name='L14970'></a> 14970             <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (*<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, win_x);
<a id='L14971' name='L14971'></a> 14971             <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (*y, win_y);
<a id='L14972' name='L14972'></a> 14972             *timestamp = dpyinfo-&gt;last_mouse_movement_time;
<a id='L14973' name='L14973'></a> 14973           <em class='brace'>}</em>
<a id='L14974' name='L14974'></a> 14974       <em class='brace'>}</em>
<a id='L14975' name='L14975'></a> 14975     <em class='brace'>}</em>
<a id='L14976' name='L14976'></a> 14976 
<a id='L14977' name='L14977'></a> 14977   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L14978' name='L14978'></a> 14978 <em class='brace'>}</em>
<a id='L14979' name='L14979'></a> 14979 
<a id='L14980' name='L14980'></a> 14980 
<a id='L14981' name='L14981'></a> 14981 
<a id='L14982' name='L14982'></a> 14982 <em class='comment'>/***********************************************************************</em>
<a id='L14983' name='L14983'></a> 14983 <em class='comment'>                               Scroll bars</em>
<a id='L14984' name='L14984'></a> 14984 <em class='comment'> ***********************************************************************/</em>
<a id='L14985' name='L14985'></a> 14985 
<a id='L14986' name='L14986'></a> 14986 <em class='comment'>/* Scroll bar support.  */</em>
<a id='L14987' name='L14987'></a> 14987 
<a id='L14988' name='L14988'></a> 14988 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XINPUT2
<a id='L14989' name='L14989'></a> 14989 
<a id='L14990' name='L14990'></a> 14990 <em class='comment'>/* Select for input extension events used by scroll bars.  This will</em>
<a id='L14991' name='L14991'></a> 14991 <em class='comment'>   result in the corresponding core events not being generated for</em>
<a id='L14992' name='L14992'></a> 14992 <em class='comment'>   SCROLL_BAR.  */</em>
<a id='L14993' name='L14993'></a> 14993 
<a id='L14994' name='L14994'></a> 14994 <a href='../S/2891.html#L155' title='Defined at 155 in lib/attribute.h.'>MAYBE_UNUSED</a> <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L14995' name='L14995'></a> 14995 xi_select_scroll_bar_events (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L14996' name='L14996'></a> 14996                              <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a>)
<a id='L14997' name='L14997'></a> 14997 <em class='brace'>{</em>
<a id='L14998' name='L14998'></a> 14998   XIEventMask mask;
<a id='L14999' name='L14999'></a> 14999   <strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *m;
<a id='L15000' name='L15000'></a> 15000   ptrdiff_t length;
<a id='L15001' name='L15001'></a> 15001 
<a id='L15002' name='L15002'></a> 15002   length = XIMaskLen (XI_LASTEVENT);
<a id='L15003' name='L15003'></a> 15003   mask.mask = m = <a href='../D/8439.html' title='Multiple defined in 8 places.'>alloca</a> (length);
<a id='L15004' name='L15004'></a> 15004   memset (m, 0, length);
<a id='L15005' name='L15005'></a> 15005   mask.mask_len = length;
<a id='L15006' name='L15006'></a> 15006 
<a id='L15007' name='L15007'></a> 15007   mask.deviceid = XIAllMasterDevices;
<a id='L15008' name='L15008'></a> 15008   XISetMask (m, XI_ButtonPress);
<a id='L15009' name='L15009'></a> 15009   XISetMask (m, XI_ButtonRelease);
<a id='L15010' name='L15010'></a> 15010   XISetMask (m, XI_Motion);
<a id='L15011' name='L15011'></a> 15011   XISetMask (m, XI_Enter);
<a id='L15012' name='L15012'></a> 15012   XISetMask (m, XI_Leave);
<a id='L15013' name='L15013'></a> 15013 
<a id='L15014' name='L15014'></a> 15014   XISelectEvents (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a>, &amp;mask, 1);
<a id='L15015' name='L15015'></a> 15015 <em class='brace'>}</em>
<a id='L15016' name='L15016'></a> 15016 
<a id='L15017' name='L15017'></a> 15017 <em class='sharp'>#endif</em>
<a id='L15018' name='L15018'></a> 15018 
<a id='L15019' name='L15019'></a> 15019 <em class='comment'>/* Given an X window ID and a DISPLAY, find the struct scroll_bar which</em>
<a id='L15020' name='L15020'></a> 15020 <em class='comment'>   manages it.</em>
<a id='L15021' name='L15021'></a> 15021 <em class='comment'>   This can be called in GC, so we have to make sure to strip off mark</em>
<a id='L15022' name='L15022'></a> 15022 <em class='comment'>   bits.  */</em>
<a id='L15023' name='L15023'></a> 15023 
<a id='L15024' name='L15024'></a> 15024 <strong class='reserved'>static</strong> <strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *
<a id='L15025' name='L15025'></a> 15025 x_window_to_scroll_bar (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> window_id, <strong class='reserved'>int</strong> type)
<a id='L15026' name='L15026'></a> 15026 <em class='brace'>{</em>
<a id='L15027' name='L15027'></a> 15027   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>;
<a id='L15028' name='L15028'></a> 15028 
<a id='L15029' name='L15029'></a> 15029 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> (USE_GTK) &amp;&amp; !<strong class='reserved'>defined</strong> (HAVE_GTK3) &amp;&amp; <strong class='reserved'>defined</strong> (USE_TOOLKIT_SCROLL_BARS)
<a id='L15030' name='L15030'></a> 15030   window_id = (<a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a>) <a href='../S/2362.html#L4467' title='Defined at 4467 in src/gtkutil.c.'>xg_get_scroll_id_for_window</a> (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, window_id);
<a id='L15031' name='L15031'></a> 15031 <em class='sharp'>#endif</em> <em class='comment'>/* USE_GTK &amp;&amp; !HAVE_GTK3  &amp;&amp; USE_TOOLKIT_SCROLL_BARS */</em>
<a id='L15032' name='L15032'></a> 15032 
<a id='L15033' name='L15033'></a> 15033   <a href='../S/2183.html#L1405' title='Defined at 1405 in src/frame.h.'>FOR_EACH_FRAME</a> (<a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)
<a id='L15034' name='L15034'></a> 15034     <em class='brace'>{</em>
<a id='L15035' name='L15035'></a> 15035       <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>, condemned;
<a id='L15036' name='L15036'></a> 15036 
<a id='L15037' name='L15037'></a> 15037       <strong class='reserved'>if</strong> (! <a href='../S/2183.html#L919' title='Defined at 919 in src/frame.h.'>FRAME_X_P</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)))
<a id='L15038' name='L15038'></a> 15038         <strong class='reserved'>continue</strong>;
<a id='L15039' name='L15039'></a> 15039 
<a id='L15040' name='L15040'></a> 15040       <em class='comment'>/* Scan this frame's scroll bar list for a scroll bar with the</em>
<a id='L15041' name='L15041'></a> 15041 <em class='comment'>         right window ID.  */</em>
<a id='L15042' name='L15042'></a> 15042       condemned = <a href='../S/2183.html#L1366' title='Defined at 1366 in src/frame.h.'>FRAME_CONDEMNED_SCROLL_BARS</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>));
<a id='L15043' name='L15043'></a> 15043       <strong class='reserved'>for</strong> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> = <a href='../S/2183.html#L1365' title='Defined at 1365 in src/frame.h.'>FRAME_SCROLL_BARS</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>));
<a id='L15044' name='L15044'></a> 15044            <em class='comment'>/* This trick allows us to search both the ordinary and</em>
<a id='L15045' name='L15045'></a> 15045 <em class='comment'>              condemned scroll bar lists with one loop.  */</em>
<a id='L15046' name='L15046'></a> 15046            ! <a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>) || (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> = condemned,
<a id='L15047' name='L15047'></a> 15047                                condemned = Qnil,
<a id='L15048' name='L15048'></a> 15048                                ! <a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>));
<a id='L15049' name='L15049'></a> 15049            <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> = <a href='../D/7329.html' title='Multiple defined in 5 places.'>XSCROLL_BAR</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>)-&gt;next)
<a id='L15050' name='L15050'></a> 15050         <strong class='reserved'>if</strong> (<a href='../D/7329.html' title='Multiple defined in 5 places.'>XSCROLL_BAR</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>)-&gt;<a href='../D/19737.html' title='Multiple defined in 3 places.'>x_window</a> == window_id
<a id='L15051' name='L15051'></a> 15051             &amp;&amp; <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)) == <a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>
<a id='L15052' name='L15052'></a> 15052             &amp;&amp; (type == 2
<a id='L15053' name='L15053'></a> 15053                 || (type == 1 &amp;&amp; <a href='../D/7329.html' title='Multiple defined in 5 places.'>XSCROLL_BAR</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>)-&gt;horizontal)
<a id='L15054' name='L15054'></a> 15054                 || (type == 0 &amp;&amp; !<a href='../D/7329.html' title='Multiple defined in 5 places.'>XSCROLL_BAR</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>)-&gt;horizontal)))
<a id='L15055' name='L15055'></a> 15055           <strong class='reserved'>return</strong> <a href='../D/7329.html' title='Multiple defined in 5 places.'>XSCROLL_BAR</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L15056' name='L15056'></a> 15056     <em class='brace'>}</em>
<a id='L15057' name='L15057'></a> 15057 
<a id='L15058' name='L15058'></a> 15058   <strong class='reserved'>return</strong> <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L15059' name='L15059'></a> 15059 <em class='brace'>}</em>
<a id='L15060' name='L15060'></a> 15060 
<a id='L15061' name='L15061'></a> 15061 
<a id='L15062' name='L15062'></a> 15062 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> USE_LUCID
<a id='L15063' name='L15063'></a> 15063 
<a id='L15064' name='L15064'></a> 15064 <em class='comment'>/* Return the Lucid menu bar WINDOW is part of.  Return null</em>
<a id='L15065' name='L15065'></a> 15065 <em class='comment'>   if WINDOW is not part of a menu bar.  */</em>
<a id='L15066' name='L15066'></a> 15066 
<a id='L15067' name='L15067'></a> 15067 <strong class='reserved'>static</strong> Widget
<a id='L15068' name='L15068'></a> 15068 x_window_to_menu_bar (<a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>)
<a id='L15069' name='L15069'></a> 15069 <em class='brace'>{</em>
<a id='L15070' name='L15070'></a> 15070   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>;
<a id='L15071' name='L15071'></a> 15071 
<a id='L15072' name='L15072'></a> 15072   <a href='../S/2183.html#L1405' title='Defined at 1405 in src/frame.h.'>FOR_EACH_FRAME</a> (<a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)
<a id='L15073' name='L15073'></a> 15073     <strong class='reserved'>if</strong> (<a href='../S/2183.html#L919' title='Defined at 919 in src/frame.h.'>FRAME_X_P</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)))
<a id='L15074' name='L15074'></a> 15074       <em class='brace'>{</em>
<a id='L15075' name='L15075'></a> 15075         Widget menu_bar = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;menubar_widget;
<a id='L15076' name='L15076'></a> 15076 
<a id='L15077' name='L15077'></a> 15077         <strong class='reserved'>if</strong> (menu_bar &amp;&amp; <a href='../S/2069.html#L1451' title='Defined at 1451 in lwlib/xlwmenu.c.'>xlwmenu_window_p</a> (menu_bar, <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>))
<a id='L15078' name='L15078'></a> 15078           <strong class='reserved'>return</strong> menu_bar;
<a id='L15079' name='L15079'></a> 15079       <em class='brace'>}</em>
<a id='L15080' name='L15080'></a> 15080   <strong class='reserved'>return</strong> <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L15081' name='L15081'></a> 15081 <em class='brace'>}</em>
<a id='L15082' name='L15082'></a> 15082 
<a id='L15083' name='L15083'></a> 15083 <em class='sharp'>#endif</em> <em class='comment'>/* USE_LUCID */</em>
<a id='L15084' name='L15084'></a> 15084 
<a id='L15085' name='L15085'></a> 15085 
<a id='L15086' name='L15086'></a> 15086 <em class='comment'>/************************************************************************</em>
<a id='L15087' name='L15087'></a> 15087 <em class='comment'>                         Toolkit scroll bars</em>
<a id='L15088' name='L15088'></a> 15088 <em class='comment'> ************************************************************************/</em>
<a id='L15089' name='L15089'></a> 15089 
<a id='L15090' name='L15090'></a> 15090 <em class='sharp'>#ifdef</em> USE_TOOLKIT_SCROLL_BARS
<a id='L15091' name='L15091'></a> 15091 
<a id='L15092' name='L15092'></a> 15092 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong> x_send_scroll_bar_event (<a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a>, <strong class='reserved'>enum</strong> <a href='../S/2231.html#L34' title='Defined at 34 in src/termhooks.h.'>scroll_bar_part</a>,
<a id='L15093' name='L15093'></a> 15093                                      <strong class='reserved'>int</strong>, <strong class='reserved'>int</strong>, <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>);
<a id='L15094' name='L15094'></a> 15094 
<a id='L15095' name='L15095'></a> 15095 <em class='comment'>/* Lisp window being scrolled.  Set when starting to interact with</em>
<a id='L15096' name='L15096'></a> 15096 <em class='comment'>   a toolkit scroll bar, reset to nil when ending the interaction.  */</em>
<a id='L15097' name='L15097'></a> 15097 
<a id='L15098' name='L15098'></a> 15098 <strong class='reserved'>static</strong> <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> window_being_scrolled;
<a id='L15099' name='L15099'></a> 15099 
<a id='L15100' name='L15100'></a> 15100 <strong class='reserved'>static</strong> <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a>
<a id='L15101' name='L15101'></a> 15101 x_get_last_toolkit_time (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo)
<a id='L15102' name='L15102'></a> 15102 <em class='brace'>{</em>
<a id='L15103' name='L15103'></a> 15103 <em class='sharp'>#ifdef</em> USE_X_TOOLKIT
<a id='L15104' name='L15104'></a> 15104   <strong class='reserved'>return</strong> XtLastTimestampProcessed (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L15105' name='L15105'></a> 15105 <em class='sharp'>#else</em>
<a id='L15106' name='L15106'></a> 15106   <strong class='reserved'>return</strong> dpyinfo-&gt;last_user_time;
<a id='L15107' name='L15107'></a> 15107 <em class='sharp'>#endif</em>
<a id='L15108' name='L15108'></a> 15108 <em class='brace'>}</em>
<a id='L15109' name='L15109'></a> 15109 
<a id='L15110' name='L15110'></a> 15110 <em class='sharp'>#ifndef</em> USE_GTK
<a id='L15111' name='L15111'></a> 15111 <em class='comment'>/* Id of action hook installed for scroll bars and horizontal scroll</em>
<a id='L15112' name='L15112'></a> 15112 <em class='comment'>   bars.  */</em>
<a id='L15113' name='L15113'></a> 15113 
<a id='L15114' name='L15114'></a> 15114 <strong class='reserved'>static</strong> XtActionHookId action_hook_id;
<a id='L15115' name='L15115'></a> 15115 <strong class='reserved'>static</strong> XtActionHookId horizontal_action_hook_id;
<a id='L15116' name='L15116'></a> 15116 
<a id='L15117' name='L15117'></a> 15117 <em class='comment'>/* Whether this is an Xaw with arrow-scrollbars.  This should imply</em>
<a id='L15118' name='L15118'></a> 15118 <em class='comment'>   that movements of 1/20 of the screen size are mapped to up/down.  */</em>
<a id='L15119' name='L15119'></a> 15119 
<a id='L15120' name='L15120'></a> 15120 <strong class='reserved'>static</strong> Boolean xaw3d_arrow_scroll;
<a id='L15121' name='L15121'></a> 15121 
<a id='L15122' name='L15122'></a> 15122 <em class='comment'>/* Whether the drag scrolling maintains the mouse at the top of the</em>
<a id='L15123' name='L15123'></a> 15123 <em class='comment'>   thumb.  If not, resizing the thumb needs to be done more carefully</em>
<a id='L15124' name='L15124'></a> 15124 <em class='comment'>   to avoid jerkiness.  */</em>
<a id='L15125' name='L15125'></a> 15125 
<a id='L15126' name='L15126'></a> 15126 <strong class='reserved'>static</strong> Boolean xaw3d_pick_top;
<a id='L15127' name='L15127'></a> 15127 
<a id='L15128' name='L15128'></a> 15128 <em class='comment'>/* Action hook installed via XtAppAddActionHook when toolkit scroll</em>
<a id='L15129' name='L15129'></a> 15129 <em class='comment'>   bars are used..  The hook is responsible for detecting when</em>
<a id='L15130' name='L15130'></a> 15130 <em class='comment'>   the user ends an interaction with the scroll bar, and generates</em>
<a id='L15131' name='L15131'></a> 15131 <em class='comment'>   a `end-scroll' SCROLL_BAR_CLICK_EVENT' event if so.  */</em>
<a id='L15132' name='L15132'></a> 15132 
<a id='L15133' name='L15133'></a> 15133 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L15134' name='L15134'></a> 15134 xt_action_hook (Widget widget, XtPointer client_data, String action_name,
<a id='L15135' name='L15135'></a> 15135                 XEvent *event, String *params, Cardinal *num_params)
<a id='L15136' name='L15136'></a> 15136 <em class='brace'>{</em>
<a id='L15137' name='L15137'></a> 15137   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> scroll_bar_p;
<a id='L15138' name='L15138'></a> 15138   <strong class='reserved'>const</strong> <strong class='reserved'>char</strong> *end_action;
<a id='L15139' name='L15139'></a> 15139 
<a id='L15140' name='L15140'></a> 15140 <em class='sharp'>#ifdef</em> USE_MOTIF
<a id='L15141' name='L15141'></a> 15141   scroll_bar_p = XmIsScrollBar (widget);
<a id='L15142' name='L15142'></a> 15142   end_action = "Release";
<a id='L15143' name='L15143'></a> 15143 <em class='sharp'>#else</em> <em class='comment'>/* !USE_MOTIF i.e. use Xaw */</em>
<a id='L15144' name='L15144'></a> 15144   scroll_bar_p = XtIsSubclass (widget, scrollbarWidgetClass);
<a id='L15145' name='L15145'></a> 15145   end_action = "EndScroll";
<a id='L15146' name='L15146'></a> 15146 <em class='sharp'>#endif</em> <em class='comment'>/* USE_MOTIF */</em>
<a id='L15147' name='L15147'></a> 15147 
<a id='L15148' name='L15148'></a> 15148   <strong class='reserved'>if</strong> (scroll_bar_p
<a id='L15149' name='L15149'></a> 15149       &amp;&amp; strcmp (action_name, end_action) == 0
<a id='L15150' name='L15150'></a> 15150       &amp;&amp; <a href='../D/6789.html' title='Multiple defined in 2 places.'>WINDOWP</a> (window_being_scrolled))
<a id='L15151' name='L15151'></a> 15151     <em class='brace'>{</em>
<a id='L15152' name='L15152'></a> 15152       <strong class='reserved'>struct</strong> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> *w;
<a id='L15153' name='L15153'></a> 15153       <strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>;
<a id='L15154' name='L15154'></a> 15154 
<a id='L15155' name='L15155'></a> 15155       x_send_scroll_bar_event (window_being_scrolled,
<a id='L15156' name='L15156'></a> 15156                                <a href='../S/2231.html#L44' title='Defined at 44 in src/termhooks.h.'>scroll_bar_end_scroll</a>, 0, 0, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L15157' name='L15157'></a> 15157       w = <a href='../D/7409.html' title='Multiple defined in 2 places.'>XWINDOW</a> (window_being_scrolled);
<a id='L15158' name='L15158'></a> 15158       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> = <a href='../D/7329.html' title='Multiple defined in 5 places.'>XSCROLL_BAR</a> (w-&gt;vertical_scroll_bar);
<a id='L15159' name='L15159'></a> 15159 
<a id='L15160' name='L15160'></a> 15160       <strong class='reserved'>if</strong> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging != -1)
<a id='L15161' name='L15161'></a> 15161         <em class='brace'>{</em>
<a id='L15162' name='L15162'></a> 15162           <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging = -1;
<a id='L15163' name='L15163'></a> 15163           <em class='comment'>/* The thumb size is incorrect while dragging: fix it.  */</em>
<a id='L15164' name='L15164'></a> 15164           <a href='../S/2224.html#L19462' title='Defined at 19462 in src/xdisp.c.'>set_vertical_scroll_bar</a> (w);
<a id='L15165' name='L15165'></a> 15165         <em class='brace'>}</em>
<a id='L15166' name='L15166'></a> 15166       window_being_scrolled = Qnil;
<a id='L15167' name='L15167'></a> 15167 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> (USE_LUCID)
<a id='L15168' name='L15168'></a> 15168       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;last_seen_part = <a href='../S/2231.html#L36' title='Defined at 36 in src/termhooks.h.'>scroll_bar_nowhere</a>;
<a id='L15169' name='L15169'></a> 15169 <em class='sharp'>#endif</em>
<a id='L15170' name='L15170'></a> 15170       <em class='comment'>/* Xt timeouts no longer needed.  */</em>
<a id='L15171' name='L15171'></a> 15171       toolkit_scroll_bar_interaction = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L15172' name='L15172'></a> 15172     <em class='brace'>}</em>
<a id='L15173' name='L15173'></a> 15173 <em class='brace'>}</em>
<a id='L15174' name='L15174'></a> 15174 
<a id='L15175' name='L15175'></a> 15175 
<a id='L15176' name='L15176'></a> 15176 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L15177' name='L15177'></a> 15177 xt_horizontal_action_hook (Widget widget, XtPointer client_data, String action_name,
<a id='L15178' name='L15178'></a> 15178                            XEvent *event, String *params, Cardinal *num_params)
<a id='L15179' name='L15179'></a> 15179 <em class='brace'>{</em>
<a id='L15180' name='L15180'></a> 15180   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> scroll_bar_p;
<a id='L15181' name='L15181'></a> 15181   <strong class='reserved'>const</strong> <strong class='reserved'>char</strong> *end_action;
<a id='L15182' name='L15182'></a> 15182 
<a id='L15183' name='L15183'></a> 15183 <em class='sharp'>#ifdef</em> USE_MOTIF
<a id='L15184' name='L15184'></a> 15184   scroll_bar_p = XmIsScrollBar (widget);
<a id='L15185' name='L15185'></a> 15185   end_action = "Release";
<a id='L15186' name='L15186'></a> 15186 <em class='sharp'>#else</em> <em class='comment'>/* !USE_MOTIF i.e. use Xaw */</em>
<a id='L15187' name='L15187'></a> 15187   scroll_bar_p = XtIsSubclass (widget, scrollbarWidgetClass);
<a id='L15188' name='L15188'></a> 15188   end_action = "EndScroll";
<a id='L15189' name='L15189'></a> 15189 <em class='sharp'>#endif</em> <em class='comment'>/* USE_MOTIF */</em>
<a id='L15190' name='L15190'></a> 15190 
<a id='L15191' name='L15191'></a> 15191   <strong class='reserved'>if</strong> (scroll_bar_p
<a id='L15192' name='L15192'></a> 15192       &amp;&amp; strcmp (action_name, end_action) == 0
<a id='L15193' name='L15193'></a> 15193       &amp;&amp; <a href='../D/6789.html' title='Multiple defined in 2 places.'>WINDOWP</a> (window_being_scrolled))
<a id='L15194' name='L15194'></a> 15194     <em class='brace'>{</em>
<a id='L15195' name='L15195'></a> 15195       <strong class='reserved'>struct</strong> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> *w;
<a id='L15196' name='L15196'></a> 15196       <strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>;
<a id='L15197' name='L15197'></a> 15197 
<a id='L15198' name='L15198'></a> 15198       x_send_scroll_bar_event (window_being_scrolled,
<a id='L15199' name='L15199'></a> 15199                                <a href='../S/2231.html#L44' title='Defined at 44 in src/termhooks.h.'>scroll_bar_end_scroll</a>, 0, 0, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L15200' name='L15200'></a> 15200       w = <a href='../D/7409.html' title='Multiple defined in 2 places.'>XWINDOW</a> (window_being_scrolled);
<a id='L15201' name='L15201'></a> 15201       <strong class='reserved'>if</strong> (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (w-&gt;horizontal_scroll_bar))
<a id='L15202' name='L15202'></a> 15202         <em class='brace'>{</em>
<a id='L15203' name='L15203'></a> 15203           <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> = <a href='../D/7329.html' title='Multiple defined in 5 places.'>XSCROLL_BAR</a> (w-&gt;horizontal_scroll_bar);
<a id='L15204' name='L15204'></a> 15204           <strong class='reserved'>if</strong> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging != -1)
<a id='L15205' name='L15205'></a> 15205             <em class='brace'>{</em>
<a id='L15206' name='L15206'></a> 15206               <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging = -1;
<a id='L15207' name='L15207'></a> 15207               <em class='comment'>/* The thumb size is incorrect while dragging: fix it.  */</em>
<a id='L15208' name='L15208'></a> 15208               <a href='../S/2224.html#L19519' title='Defined at 19519 in src/xdisp.c.'>set_horizontal_scroll_bar</a> (w);
<a id='L15209' name='L15209'></a> 15209             <em class='brace'>}</em>
<a id='L15210' name='L15210'></a> 15210           window_being_scrolled = Qnil;
<a id='L15211' name='L15211'></a> 15211 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> (USE_LUCID)
<a id='L15212' name='L15212'></a> 15212           <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;last_seen_part = <a href='../S/2231.html#L36' title='Defined at 36 in src/termhooks.h.'>scroll_bar_nowhere</a>;
<a id='L15213' name='L15213'></a> 15213 <em class='sharp'>#endif</em>
<a id='L15214' name='L15214'></a> 15214           <em class='comment'>/* Xt timeouts no longer needed.  */</em>
<a id='L15215' name='L15215'></a> 15215           toolkit_scroll_bar_interaction = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L15216' name='L15216'></a> 15216         <em class='brace'>}</em>
<a id='L15217' name='L15217'></a> 15217     <em class='brace'>}</em>
<a id='L15218' name='L15218'></a> 15218 <em class='brace'>}</em>
<a id='L15219' name='L15219'></a> 15219 <em class='sharp'>#endif</em> <em class='comment'>/* not USE_GTK */</em>
<a id='L15220' name='L15220'></a> 15220 
<a id='L15221' name='L15221'></a> 15221 <em class='comment'>/* Protect WINDOW from garbage collection until a matching scroll bar</em>
<a id='L15222' name='L15222'></a> 15222 <em class='comment'>   message is received.  Return whether or not protection</em>
<a id='L15223' name='L15223'></a> 15223 <em class='comment'>   succeeded.  */</em>
<a id='L15224' name='L15224'></a> 15224 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L15225' name='L15225'></a> 15225 x_protect_window_for_callback (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L15226' name='L15226'></a> 15226                                <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>)
<a id='L15227' name='L15227'></a> 15227 <em class='brace'>{</em>
<a id='L15228' name='L15228'></a> 15228   <strong class='reserved'>if</strong> (dpyinfo-&gt;n_protected_windows + 1
<a id='L15229' name='L15229'></a> 15229       &gt;= dpyinfo-&gt;protected_windows_max)
<a id='L15230' name='L15230'></a> 15230     <strong class='reserved'>return</strong> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L15231' name='L15231'></a> 15231 
<a id='L15232' name='L15232'></a> 15232   dpyinfo-&gt;protected_windows[dpyinfo-&gt;n_protected_windows++]
<a id='L15233' name='L15233'></a> 15233     = <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>;
<a id='L15234' name='L15234'></a> 15234   <strong class='reserved'>return</strong> <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L15235' name='L15235'></a> 15235 <em class='brace'>}</em>
<a id='L15236' name='L15236'></a> 15236 
<a id='L15237' name='L15237'></a> 15237 <strong class='reserved'>static</strong> <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a>
<a id='L15238' name='L15238'></a> 15238 x_unprotect_window_for_callback (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo)
<a id='L15239' name='L15239'></a> 15239 <em class='brace'>{</em>
<a id='L15240' name='L15240'></a> 15240   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>;
<a id='L15241' name='L15241'></a> 15241 
<a id='L15242' name='L15242'></a> 15242   <strong class='reserved'>if</strong> (!dpyinfo-&gt;n_protected_windows)
<a id='L15243' name='L15243'></a> 15243     <strong class='reserved'>return</strong> Qnil;
<a id='L15244' name='L15244'></a> 15244 
<a id='L15245' name='L15245'></a> 15245   <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = dpyinfo-&gt;protected_windows[0];
<a id='L15246' name='L15246'></a> 15246 
<a id='L15247' name='L15247'></a> 15247   dpyinfo-&gt;n_protected_windows--;
<a id='L15248' name='L15248'></a> 15248 
<a id='L15249' name='L15249'></a> 15249   <strong class='reserved'>if</strong> (dpyinfo-&gt;n_protected_windows)
<a id='L15250' name='L15250'></a> 15250     <a href='../S/2936.html#L81' title='Defined at 81 in lib/canonicalize-lgpl.c.'>memmove</a> (dpyinfo-&gt;protected_windows, &amp;dpyinfo-&gt;protected_windows[1],
<a id='L15251' name='L15251'></a> 15251              <strong class='reserved'>sizeof</strong> (<a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a>) * dpyinfo-&gt;n_protected_windows);
<a id='L15252' name='L15252'></a> 15252 
<a id='L15253' name='L15253'></a> 15253   <strong class='reserved'>return</strong> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>;
<a id='L15254' name='L15254'></a> 15254 <em class='brace'>}</em>
<a id='L15255' name='L15255'></a> 15255 
<a id='L15256' name='L15256'></a> 15256 <em class='comment'>/* Send a client message with message type Xatom_Scrollbar for a</em>
<a id='L15257' name='L15257'></a> 15257 <em class='comment'>   scroll action to the frame of WINDOW.  PART is a value identifying</em>
<a id='L15258' name='L15258'></a> 15258 <em class='comment'>   the part of the scroll bar that was clicked on.  PORTION is the</em>
<a id='L15259' name='L15259'></a> 15259 <em class='comment'>   amount to scroll of a whole of WHOLE.  */</em>
<a id='L15260' name='L15260'></a> 15260 
<a id='L15261' name='L15261'></a> 15261 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L15262' name='L15262'></a> 15262 x_send_scroll_bar_event (<a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, <strong class='reserved'>enum</strong> <a href='../S/2231.html#L34' title='Defined at 34 in src/termhooks.h.'>scroll_bar_part</a> part,
<a id='L15263' name='L15263'></a> 15263                          <strong class='reserved'>int</strong> portion, <strong class='reserved'>int</strong> whole, <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> horizontal)
<a id='L15264' name='L15264'></a> 15264 <em class='brace'>{</em>
<a id='L15265' name='L15265'></a> 15265   XEvent event;
<a id='L15266' name='L15266'></a> 15266   XClientMessageEvent *ev = &amp;event.xclient;
<a id='L15267' name='L15267'></a> 15267   <strong class='reserved'>struct</strong> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> *w = <a href='../D/7409.html' title='Multiple defined in 2 places.'>XWINDOW</a> (<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L15268' name='L15268'></a> 15268   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (w-&gt;<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>);
<a id='L15269' name='L15269'></a> 15269   <a href='../D/18842.html' title='Multiple defined in 4 places.'>verify</a> (<a href='../S/2742.html#L723' title='Defined at 723 in lib/stdint.in.h.'>INTPTR_WIDTH</a> &lt;= 64);
<a id='L15270' name='L15270'></a> 15270 
<a id='L15271' name='L15271'></a> 15271   <em class='comment'>/* Don't do anything if too many scroll bar events have been</em>
<a id='L15272' name='L15272'></a> 15272 <em class='comment'>     sent but not received.  */</em>
<a id='L15273' name='L15273'></a> 15273   <strong class='reserved'>if</strong> (!x_protect_window_for_callback (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>))
<a id='L15274' name='L15274'></a> 15274     <strong class='reserved'>return</strong>;
<a id='L15275' name='L15275'></a> 15275 
<a id='L15276' name='L15276'></a> 15276   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L15277' name='L15277'></a> 15277   <em class='comment'>/* Construct a ClientMessage event to send to the frame.  */</em>
<a id='L15278' name='L15278'></a> 15278   ev-&gt;type = ClientMessage;
<a id='L15279' name='L15279'></a> 15279   ev-&gt;message_type = (horizontal
<a id='L15280' name='L15280'></a> 15280                       ? <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;Xatom_Horizontal_Scrollbar
<a id='L15281' name='L15281'></a> 15281                       : <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;Xatom_Scrollbar);
<a id='L15282' name='L15282'></a> 15282   ev-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> = <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L15283' name='L15283'></a> 15283   ev-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L15284' name='L15284'></a> 15284   ev-&gt;format = 32;
<a id='L15285' name='L15285'></a> 15285 
<a id='L15286' name='L15286'></a> 15286   <em class='comment'>/* These messages formerly contained a pointer to the window, but</em>
<a id='L15287' name='L15287'></a> 15287 <em class='comment'>     now that information is kept internally.  The following two</em>
<a id='L15288' name='L15288'></a> 15288 <em class='comment'>     fields are thus zero.  */</em>
<a id='L15289' name='L15289'></a> 15289   ev-&gt;data.l[0] = 0;
<a id='L15290' name='L15290'></a> 15290   ev-&gt;data.l[1] = 0;
<a id='L15291' name='L15291'></a> 15291   ev-&gt;data.l[2] = part;
<a id='L15292' name='L15292'></a> 15292   ev-&gt;data.l[3] = portion;
<a id='L15293' name='L15293'></a> 15293   ev-&gt;data.l[4] = whole;
<a id='L15294' name='L15294'></a> 15294 
<a id='L15295' name='L15295'></a> 15295   <em class='comment'>/* Make Xt timeouts work while the scroll bar is active.  */</em>
<a id='L15296' name='L15296'></a> 15296 <em class='sharp'>#ifdef</em> USE_X_TOOLKIT
<a id='L15297' name='L15297'></a> 15297   toolkit_scroll_bar_interaction = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L15298' name='L15298'></a> 15298   x_activate_timeout_atimer ();
<a id='L15299' name='L15299'></a> 15299 <em class='sharp'>#endif</em>
<a id='L15300' name='L15300'></a> 15300 
<a id='L15301' name='L15301'></a> 15301   <em class='comment'>/* Setting the event mask to zero means that the message will</em>
<a id='L15302' name='L15302'></a> 15302 <em class='comment'>     be sent to the client that created the window, and if that</em>
<a id='L15303' name='L15303'></a> 15303 <em class='comment'>     window no longer exists, no event will be sent.  */</em>
<a id='L15304' name='L15304'></a> 15304   XSendEvent (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), False,
<a id='L15305' name='L15305'></a> 15305               NoEventMask, &amp;event);
<a id='L15306' name='L15306'></a> 15306   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L15307' name='L15307'></a> 15307 <em class='brace'>}</em>
<a id='L15308' name='L15308'></a> 15308 
<a id='L15309' name='L15309'></a> 15309 
<a id='L15310' name='L15310'></a> 15310 <em class='comment'>/* Transform a scroll bar ClientMessage EVENT to an Emacs input event</em>
<a id='L15311' name='L15311'></a> 15311 <em class='comment'>   in *IEVENT.  */</em>
<a id='L15312' name='L15312'></a> 15312 
<a id='L15313' name='L15313'></a> 15313 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L15314' name='L15314'></a> 15314 x_scroll_bar_to_input_event (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L15315' name='L15315'></a> 15315                              <strong class='reserved'>const</strong> XEvent *event,
<a id='L15316' name='L15316'></a> 15316                              <strong class='reserved'>struct</strong> <a href='../S/2231.html#L350' title='Defined at 350 in src/termhooks.h.'>input_event</a> *ievent)
<a id='L15317' name='L15317'></a> 15317 <em class='brace'>{</em>
<a id='L15318' name='L15318'></a> 15318   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>;
<a id='L15319' name='L15319'></a> 15319 
<a id='L15320' name='L15320'></a> 15320   <em class='comment'>/* Every time a scroll bar ClientMessage event is sent, the window</em>
<a id='L15321' name='L15321'></a> 15321 <em class='comment'>     is pushed onto a queue that is traced for garbage collection.</em>
<a id='L15322' name='L15322'></a> 15322 <em class='comment'>     Every time we need a window for a read scroll bar event, we</em>
<a id='L15323' name='L15323'></a> 15323 <em class='comment'>     simply read from the other side of the queue.  */</em>
<a id='L15324' name='L15324'></a> 15324   <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = x_unprotect_window_for_callback (dpyinfo);
<a id='L15325' name='L15325'></a> 15325 
<a id='L15326' name='L15326'></a> 15326   <strong class='reserved'>if</strong> (<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>))
<a id='L15327' name='L15327'></a> 15327     <em class='brace'>{</em>
<a id='L15328' name='L15328'></a> 15328       <em class='comment'>/* This means we are getting extra scroll bar events for some</em>
<a id='L15329' name='L15329'></a> 15329 <em class='comment'>         reason, and shouldn't be possible in practice.  */</em>
<a id='L15330' name='L15330'></a> 15330       <a href='../S/2231.html#L393' title='Defined at 393 in src/termhooks.h.'>EVENT_INIT</a> (*ievent);
<a id='L15331' name='L15331'></a> 15331       <strong class='reserved'>return</strong>;
<a id='L15332' name='L15332'></a> 15332     <em class='brace'>}</em>
<a id='L15333' name='L15333'></a> 15333 
<a id='L15334' name='L15334'></a> 15334   ievent-&gt;kind = <a href='../S/2231.html#L159' title='Defined at 159 in src/termhooks.h.'>SCROLL_BAR_CLICK_EVENT</a>;
<a id='L15335' name='L15335'></a> 15335   ievent-&gt;frame_or_window = <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>;
<a id='L15336' name='L15336'></a> 15336   ievent-&gt;arg = Qnil;
<a id='L15337' name='L15337'></a> 15337   ievent-&gt;timestamp = x_get_last_toolkit_time (dpyinfo);
<a id='L15338' name='L15338'></a> 15338   ievent-&gt;code = 0;
<a id='L15339' name='L15339'></a> 15339   ievent-&gt;part = event-&gt;xclient.data.l[2];
<a id='L15340' name='L15340'></a> 15340   ievent-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = <a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (event-&gt;xclient.data.l[3]);
<a id='L15341' name='L15341'></a> 15341   ievent-&gt;y = <a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (event-&gt;xclient.data.l[4]);
<a id='L15342' name='L15342'></a> 15342   ievent-&gt;modifiers = 0;
<a id='L15343' name='L15343'></a> 15343 <em class='brace'>}</em>
<a id='L15344' name='L15344'></a> 15344 
<a id='L15345' name='L15345'></a> 15345 <em class='comment'>/* Transform a horizontal scroll bar ClientMessage EVENT to an Emacs</em>
<a id='L15346' name='L15346'></a> 15346 <em class='comment'>   input event in *IEVENT.  */</em>
<a id='L15347' name='L15347'></a> 15347 
<a id='L15348' name='L15348'></a> 15348 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L15349' name='L15349'></a> 15349 x_horizontal_scroll_bar_to_input_event (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L15350' name='L15350'></a> 15350                                         <strong class='reserved'>const</strong> XEvent *event,
<a id='L15351' name='L15351'></a> 15351                                         <strong class='reserved'>struct</strong> <a href='../S/2231.html#L350' title='Defined at 350 in src/termhooks.h.'>input_event</a> *ievent)
<a id='L15352' name='L15352'></a> 15352 <em class='brace'>{</em>
<a id='L15353' name='L15353'></a> 15353   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>;
<a id='L15354' name='L15354'></a> 15354 
<a id='L15355' name='L15355'></a> 15355   <em class='comment'>/* Every time a scroll bar ClientMessage event is sent, the window</em>
<a id='L15356' name='L15356'></a> 15356 <em class='comment'>     is pushed onto a queue that is traced for garbage collection.</em>
<a id='L15357' name='L15357'></a> 15357 <em class='comment'>     Every time we need a window for a read scroll bar event, we</em>
<a id='L15358' name='L15358'></a> 15358 <em class='comment'>     simply read from the other side of the queue.  */</em>
<a id='L15359' name='L15359'></a> 15359   <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = x_unprotect_window_for_callback (dpyinfo);
<a id='L15360' name='L15360'></a> 15360 
<a id='L15361' name='L15361'></a> 15361   <strong class='reserved'>if</strong> (<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>))
<a id='L15362' name='L15362'></a> 15362     <em class='brace'>{</em>
<a id='L15363' name='L15363'></a> 15363       <em class='comment'>/* This means we are getting extra scroll bar events for some</em>
<a id='L15364' name='L15364'></a> 15364 <em class='comment'>         reason, and shouldn't be possible in practice.  */</em>
<a id='L15365' name='L15365'></a> 15365       <a href='../S/2231.html#L393' title='Defined at 393 in src/termhooks.h.'>EVENT_INIT</a> (*ievent);
<a id='L15366' name='L15366'></a> 15366       <strong class='reserved'>return</strong>;
<a id='L15367' name='L15367'></a> 15367     <em class='brace'>}</em>
<a id='L15368' name='L15368'></a> 15368 
<a id='L15369' name='L15369'></a> 15369   ievent-&gt;kind = <a href='../S/2231.html#L172' title='Defined at 172 in src/termhooks.h.'>HORIZONTAL_SCROLL_BAR_CLICK_EVENT</a>;
<a id='L15370' name='L15370'></a> 15370   ievent-&gt;frame_or_window = <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>;
<a id='L15371' name='L15371'></a> 15371   ievent-&gt;arg = Qnil;
<a id='L15372' name='L15372'></a> 15372   ievent-&gt;timestamp = x_get_last_toolkit_time (dpyinfo);
<a id='L15373' name='L15373'></a> 15373   ievent-&gt;code = 0;
<a id='L15374' name='L15374'></a> 15374   ievent-&gt;part = event-&gt;xclient.data.l[2];
<a id='L15375' name='L15375'></a> 15375   ievent-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = <a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (event-&gt;xclient.data.l[3]);
<a id='L15376' name='L15376'></a> 15376   ievent-&gt;y = <a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (event-&gt;xclient.data.l[4]);
<a id='L15377' name='L15377'></a> 15377   ievent-&gt;modifiers = 0;
<a id='L15378' name='L15378'></a> 15378 <em class='brace'>}</em>
<a id='L15379' name='L15379'></a> 15379 
<a id='L15380' name='L15380'></a> 15380 
<a id='L15381' name='L15381'></a> 15381 <em class='sharp'>#ifdef</em> USE_MOTIF
<a id='L15382' name='L15382'></a> 15382 
<a id='L15383' name='L15383'></a> 15383 <em class='comment'>/* Minimum and maximum values used for Motif scroll bars.  */</em>
<a id='L15384' name='L15384'></a> 15384 
<a id='L15385' name='L15385'></a> 15385 <em class='sharp'>#define</em> <a href='../R/6530.html' title='Multiple referred from 10 places.'>XM_SB_MAX</a> 10000000
<a id='L15386' name='L15386'></a> 15386 
<a id='L15387' name='L15387'></a> 15387 <em class='comment'>/* Scroll bar callback for Motif scroll bars.  WIDGET is the scroll</em>
<a id='L15388' name='L15388'></a> 15388 <em class='comment'>   bar widget.  CLIENT_DATA is a pointer to the scroll_bar structure.</em>
<a id='L15389' name='L15389'></a> 15389 <em class='comment'>   CALL_DATA is a pointer to a XmScrollBarCallbackStruct.  */</em>
<a id='L15390' name='L15390'></a> 15390 
<a id='L15391' name='L15391'></a> 15391 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L15392' name='L15392'></a> 15392 xm_scroll_callback (Widget widget, XtPointer client_data, XtPointer call_data)
<a id='L15393' name='L15393'></a> 15393 <em class='brace'>{</em>
<a id='L15394' name='L15394'></a> 15394   <strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> = client_data;
<a id='L15395' name='L15395'></a> 15395   XmScrollBarCallbackStruct *cs = call_data;
<a id='L15396' name='L15396'></a> 15396   <strong class='reserved'>enum</strong> <a href='../S/2231.html#L34' title='Defined at 34 in src/termhooks.h.'>scroll_bar_part</a> part = <a href='../S/2231.html#L36' title='Defined at 36 in src/termhooks.h.'>scroll_bar_nowhere</a>;
<a id='L15397' name='L15397'></a> 15397   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> horizontal = <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;horizontal;
<a id='L15398' name='L15398'></a> 15398   <strong class='reserved'>int</strong> whole = 0, portion = 0;
<a id='L15399' name='L15399'></a> 15399 
<a id='L15400' name='L15400'></a> 15400   <strong class='reserved'>switch</strong> (cs-&gt;reason)
<a id='L15401' name='L15401'></a> 15401     <em class='brace'>{</em>
<a id='L15402' name='L15402'></a> 15402     <strong class='reserved'>case</strong> XmCR_DECREMENT:
<a id='L15403' name='L15403'></a> 15403       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging = -1;
<a id='L15404' name='L15404'></a> 15404       part = horizontal ? <a href='../S/2231.html#L49' title='Defined at 49 in src/termhooks.h.'>scroll_bar_left_arrow</a> : <a href='../S/2231.html#L40' title='Defined at 40 in src/termhooks.h.'>scroll_bar_up_arrow</a>;
<a id='L15405' name='L15405'></a> 15405       <strong class='reserved'>break</strong>;
<a id='L15406' name='L15406'></a> 15406 
<a id='L15407' name='L15407'></a> 15407     <strong class='reserved'>case</strong> XmCR_INCREMENT:
<a id='L15408' name='L15408'></a> 15408       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging = -1;
<a id='L15409' name='L15409'></a> 15409       part = horizontal ? <a href='../S/2231.html#L50' title='Defined at 50 in src/termhooks.h.'>scroll_bar_right_arrow</a> : <a href='../S/2231.html#L41' title='Defined at 41 in src/termhooks.h.'>scroll_bar_down_arrow</a>;
<a id='L15410' name='L15410'></a> 15410       <strong class='reserved'>break</strong>;
<a id='L15411' name='L15411'></a> 15411 
<a id='L15412' name='L15412'></a> 15412     <strong class='reserved'>case</strong> XmCR_PAGE_DECREMENT:
<a id='L15413' name='L15413'></a> 15413       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging = -1;
<a id='L15414' name='L15414'></a> 15414       part = horizontal ? <a href='../S/2231.html#L46' title='Defined at 46 in src/termhooks.h.'>scroll_bar_before_handle</a> : <a href='../S/2231.html#L37' title='Defined at 37 in src/termhooks.h.'>scroll_bar_above_handle</a>;
<a id='L15415' name='L15415'></a> 15415       <strong class='reserved'>break</strong>;
<a id='L15416' name='L15416'></a> 15416 
<a id='L15417' name='L15417'></a> 15417     <strong class='reserved'>case</strong> XmCR_PAGE_INCREMENT:
<a id='L15418' name='L15418'></a> 15418       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging = -1;
<a id='L15419' name='L15419'></a> 15419       part = horizontal ? <a href='../S/2231.html#L48' title='Defined at 48 in src/termhooks.h.'>scroll_bar_after_handle</a> : <a href='../S/2231.html#L39' title='Defined at 39 in src/termhooks.h.'>scroll_bar_below_handle</a>;
<a id='L15420' name='L15420'></a> 15420       <strong class='reserved'>break</strong>;
<a id='L15421' name='L15421'></a> 15421 
<a id='L15422' name='L15422'></a> 15422     <strong class='reserved'>case</strong> XmCR_TO_TOP:
<a id='L15423' name='L15423'></a> 15423       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging = -1;
<a id='L15424' name='L15424'></a> 15424       part = horizontal ? <a href='../S/2231.html#L51' title='Defined at 51 in src/termhooks.h.'>scroll_bar_to_leftmost</a> : <a href='../S/2231.html#L42' title='Defined at 42 in src/termhooks.h.'>scroll_bar_to_top</a>;
<a id='L15425' name='L15425'></a> 15425       <strong class='reserved'>break</strong>;
<a id='L15426' name='L15426'></a> 15426 
<a id='L15427' name='L15427'></a> 15427     <strong class='reserved'>case</strong> XmCR_TO_BOTTOM:
<a id='L15428' name='L15428'></a> 15428       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging = -1;
<a id='L15429' name='L15429'></a> 15429       part = horizontal ? <a href='../S/2231.html#L52' title='Defined at 52 in src/termhooks.h.'>scroll_bar_to_rightmost</a> : <a href='../S/2231.html#L43' title='Defined at 43 in src/termhooks.h.'>scroll_bar_to_bottom</a>;
<a id='L15430' name='L15430'></a> 15430       <strong class='reserved'>break</strong>;
<a id='L15431' name='L15431'></a> 15431 
<a id='L15432' name='L15432'></a> 15432     <strong class='reserved'>case</strong> XmCR_DRAG:
<a id='L15433' name='L15433'></a> 15433       <em class='brace'>{</em>
<a id='L15434' name='L15434'></a> 15434         <strong class='reserved'>int</strong> slider_size;
<a id='L15435' name='L15435'></a> 15435 
<a id='L15436' name='L15436'></a> 15436         <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L15437' name='L15437'></a> 15437         XtVaGetValues (widget, XmNsliderSize, &amp;slider_size, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L15438' name='L15438'></a> 15438         <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L15439' name='L15439'></a> 15439 
<a id='L15440' name='L15440'></a> 15440         <strong class='reserved'>if</strong> (horizontal)
<a id='L15441' name='L15441'></a> 15441           <em class='brace'>{</em>
<a id='L15442' name='L15442'></a> 15442             portion = <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;whole * ((<strong class='reserved'>float</strong>)cs-&gt;<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a> / <a href='../S/2289.html#L15385' title='Defined at 15385 in src/xterm.c.'>XM_SB_MAX</a>);
<a id='L15443' name='L15443'></a> 15443             whole = <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;whole * ((<strong class='reserved'>float</strong>)(<a href='../S/2289.html#L15385' title='Defined at 15385 in src/xterm.c.'>XM_SB_MAX</a> - slider_size) / <a href='../S/2289.html#L15385' title='Defined at 15385 in src/xterm.c.'>XM_SB_MAX</a>);
<a id='L15444' name='L15444'></a> 15444             portion = <a href='../D/14475.html' title='Multiple defined in 11 places.'>min</a> (portion, whole);
<a id='L15445' name='L15445'></a> 15445             part = <a href='../S/2231.html#L47' title='Defined at 47 in src/termhooks.h.'>scroll_bar_horizontal_handle</a>;
<a id='L15446' name='L15446'></a> 15446           <em class='brace'>}</em>
<a id='L15447' name='L15447'></a> 15447         <strong class='reserved'>else</strong>
<a id='L15448' name='L15448'></a> 15448           <em class='brace'>{</em>
<a id='L15449' name='L15449'></a> 15449             whole = <a href='../S/2289.html#L15385' title='Defined at 15385 in src/xterm.c.'>XM_SB_MAX</a> - slider_size;
<a id='L15450' name='L15450'></a> 15450             portion = <a href='../D/14475.html' title='Multiple defined in 11 places.'>min</a> (cs-&gt;<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>, whole);
<a id='L15451' name='L15451'></a> 15451             part = <a href='../S/2231.html#L38' title='Defined at 38 in src/termhooks.h.'>scroll_bar_handle</a>;
<a id='L15452' name='L15452'></a> 15452           <em class='brace'>}</em>
<a id='L15453' name='L15453'></a> 15453 
<a id='L15454' name='L15454'></a> 15454         <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging = cs-&gt;<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>;
<a id='L15455' name='L15455'></a> 15455       <em class='brace'>}</em>
<a id='L15456' name='L15456'></a> 15456       <strong class='reserved'>break</strong>;
<a id='L15457' name='L15457'></a> 15457 
<a id='L15458' name='L15458'></a> 15458     <strong class='reserved'>case</strong> XmCR_VALUE_CHANGED:
<a id='L15459' name='L15459'></a> 15459       <strong class='reserved'>break</strong>;
<a id='L15460' name='L15460'></a> 15460     <em class='brace'>}</em>;
<a id='L15461' name='L15461'></a> 15461 
<a id='L15462' name='L15462'></a> 15462   <strong class='reserved'>if</strong> (part != <a href='../S/2231.html#L36' title='Defined at 36 in src/termhooks.h.'>scroll_bar_nowhere</a>)
<a id='L15463' name='L15463'></a> 15463     <em class='brace'>{</em>
<a id='L15464' name='L15464'></a> 15464       window_being_scrolled = <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>;
<a id='L15465' name='L15465'></a> 15465       x_send_scroll_bar_event (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, part, portion, whole,
<a id='L15466' name='L15466'></a> 15466                                <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;horizontal);
<a id='L15467' name='L15467'></a> 15467     <em class='brace'>}</em>
<a id='L15468' name='L15468'></a> 15468 <em class='brace'>}</em>
<a id='L15469' name='L15469'></a> 15469 
<a id='L15470' name='L15470'></a> 15470 <em class='sharp'>#elif</em> <strong class='reserved'>defined</strong> USE_GTK
<a id='L15471' name='L15471'></a> 15471 
<a id='L15472' name='L15472'></a> 15472 <em class='comment'>/* Scroll bar callback for GTK scroll bars.  WIDGET is the scroll</em>
<a id='L15473' name='L15473'></a> 15473 <em class='comment'>   bar widget.  DATA is a pointer to the scroll_bar structure. */</em>
<a id='L15474' name='L15474'></a> 15474 
<a id='L15475' name='L15475'></a> 15475 <strong class='reserved'>static</strong> gboolean
<a id='L15476' name='L15476'></a> 15476 <a href='../S/2355.html#L3899' title='Defined at 3899 in src/pgtkterm.c.'>xg_scroll_callback</a> (GtkRange *range, GtkScrollType scroll,
<a id='L15477' name='L15477'></a> 15477                     gdouble <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>, gpointer user_data)
<a id='L15478' name='L15478'></a> 15478 <em class='brace'>{</em>
<a id='L15479' name='L15479'></a> 15479   <strong class='reserved'>int</strong> whole, portion;
<a id='L15480' name='L15480'></a> 15480   <strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>;
<a id='L15481' name='L15481'></a> 15481   <strong class='reserved'>enum</strong> <a href='../S/2231.html#L34' title='Defined at 34 in src/termhooks.h.'>scroll_bar_part</a> part;
<a id='L15482' name='L15482'></a> 15482   GtkAdjustment *adj;
<a id='L15483' name='L15483'></a> 15483   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L15484' name='L15484'></a> 15484   guint32 <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L15485' name='L15485'></a> 15485   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L15486' name='L15486'></a> 15486 
<a id='L15487' name='L15487'></a> 15487   <strong class='reserved'>if</strong> (xg_ignore_gtk_scrollbar) <strong class='reserved'>return</strong> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L15488' name='L15488'></a> 15488 
<a id='L15489' name='L15489'></a> 15489   whole = 0;
<a id='L15490' name='L15490'></a> 15490   portion = 0;
<a id='L15491' name='L15491'></a> 15491   <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> = user_data;
<a id='L15492' name='L15492'></a> 15492   part = <a href='../S/2231.html#L36' title='Defined at 36 in src/termhooks.h.'>scroll_bar_nowhere</a>;
<a id='L15493' name='L15493'></a> 15493   adj = GTK_ADJUSTMENT (gtk_range_get_adjustment (range));
<a id='L15494' name='L15494'></a> 15494   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = g_object_get_data (G_OBJECT (range), <a href='../S/2238.html#L46' title='Defined at 46 in src/gtkutil.h.'>XG_FRAME_DATA</a>);
<a id='L15495' name='L15495'></a> 15495   <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> = gtk_get_current_event_time ();
<a id='L15496' name='L15496'></a> 15496   dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L15497' name='L15497'></a> 15497 
<a id='L15498' name='L15498'></a> 15498   <strong class='reserved'>if</strong> (<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> != GDK_CURRENT_TIME)
<a id='L15499' name='L15499'></a> 15499     <a href='../S/2289.html#L7929' title='Defined at 7929 in src/xterm.c.'>x_display_set_last_user_time</a> (dpyinfo, <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>,
<a id='L15500' name='L15500'></a> 15500                                   <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L15501' name='L15501'></a> 15501 
<a id='L15502' name='L15502'></a> 15502   <strong class='reserved'>switch</strong> (scroll)
<a id='L15503' name='L15503'></a> 15503     <em class='brace'>{</em>
<a id='L15504' name='L15504'></a> 15504     <strong class='reserved'>case</strong> GTK_SCROLL_JUMP:
<a id='L15505' name='L15505'></a> 15505       <em class='comment'>/* Buttons 1 2 or 3 must be grabbed.  */</em>
<a id='L15506' name='L15506'></a> 15506       <strong class='reserved'>if</strong> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;grabbed != 0
<a id='L15507' name='L15507'></a> 15507           &amp;&amp; <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;grabbed &lt; (1 &lt;&lt; 4))
<a id='L15508' name='L15508'></a> 15508         <em class='brace'>{</em>
<a id='L15509' name='L15509'></a> 15509           <strong class='reserved'>if</strong> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;horizontal)
<a id='L15510' name='L15510'></a> 15510             <em class='brace'>{</em>
<a id='L15511' name='L15511'></a> 15511               part = <a href='../S/2231.html#L47' title='Defined at 47 in src/termhooks.h.'>scroll_bar_horizontal_handle</a>;
<a id='L15512' name='L15512'></a> 15512               whole = (<strong class='reserved'>int</strong>)(gtk_adjustment_get_upper (adj) -
<a id='L15513' name='L15513'></a> 15513                             gtk_adjustment_get_page_size (adj));
<a id='L15514' name='L15514'></a> 15514               portion = <a href='../D/14475.html' title='Multiple defined in 11 places.'>min</a> ((<strong class='reserved'>int</strong>)<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>, whole);
<a id='L15515' name='L15515'></a> 15515               <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging = portion;
<a id='L15516' name='L15516'></a> 15516             <em class='brace'>}</em>
<a id='L15517' name='L15517'></a> 15517           <strong class='reserved'>else</strong>
<a id='L15518' name='L15518'></a> 15518             <em class='brace'>{</em>
<a id='L15519' name='L15519'></a> 15519               part = <a href='../S/2231.html#L38' title='Defined at 38 in src/termhooks.h.'>scroll_bar_handle</a>;
<a id='L15520' name='L15520'></a> 15520               whole = gtk_adjustment_get_upper (adj) -
<a id='L15521' name='L15521'></a> 15521                 gtk_adjustment_get_page_size (adj);
<a id='L15522' name='L15522'></a> 15522               portion = <a href='../D/14475.html' title='Multiple defined in 11 places.'>min</a> ((<strong class='reserved'>int</strong>)<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>, whole);
<a id='L15523' name='L15523'></a> 15523               <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging = portion;
<a id='L15524' name='L15524'></a> 15524             <em class='brace'>}</em>
<a id='L15525' name='L15525'></a> 15525         <em class='brace'>}</em>
<a id='L15526' name='L15526'></a> 15526       <strong class='reserved'>break</strong>;
<a id='L15527' name='L15527'></a> 15527     <strong class='reserved'>case</strong> GTK_SCROLL_STEP_BACKWARD:
<a id='L15528' name='L15528'></a> 15528       part = (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;horizontal
<a id='L15529' name='L15529'></a> 15529               ? <a href='../S/2231.html#L49' title='Defined at 49 in src/termhooks.h.'>scroll_bar_left_arrow</a> : <a href='../S/2231.html#L40' title='Defined at 40 in src/termhooks.h.'>scroll_bar_up_arrow</a>);
<a id='L15530' name='L15530'></a> 15530       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging = -1;
<a id='L15531' name='L15531'></a> 15531       <strong class='reserved'>break</strong>;
<a id='L15532' name='L15532'></a> 15532     <strong class='reserved'>case</strong> GTK_SCROLL_STEP_FORWARD:
<a id='L15533' name='L15533'></a> 15533       part = (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;horizontal
<a id='L15534' name='L15534'></a> 15534               ? <a href='../S/2231.html#L50' title='Defined at 50 in src/termhooks.h.'>scroll_bar_right_arrow</a> : <a href='../S/2231.html#L41' title='Defined at 41 in src/termhooks.h.'>scroll_bar_down_arrow</a>);
<a id='L15535' name='L15535'></a> 15535       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging = -1;
<a id='L15536' name='L15536'></a> 15536       <strong class='reserved'>break</strong>;
<a id='L15537' name='L15537'></a> 15537     <strong class='reserved'>case</strong> GTK_SCROLL_PAGE_BACKWARD:
<a id='L15538' name='L15538'></a> 15538       part = (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;horizontal
<a id='L15539' name='L15539'></a> 15539               ? <a href='../S/2231.html#L46' title='Defined at 46 in src/termhooks.h.'>scroll_bar_before_handle</a> : <a href='../S/2231.html#L37' title='Defined at 37 in src/termhooks.h.'>scroll_bar_above_handle</a>);
<a id='L15540' name='L15540'></a> 15540       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging = -1;
<a id='L15541' name='L15541'></a> 15541       <strong class='reserved'>break</strong>;
<a id='L15542' name='L15542'></a> 15542     <strong class='reserved'>case</strong> GTK_SCROLL_PAGE_FORWARD:
<a id='L15543' name='L15543'></a> 15543       part = (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;horizontal
<a id='L15544' name='L15544'></a> 15544               ? <a href='../S/2231.html#L48' title='Defined at 48 in src/termhooks.h.'>scroll_bar_after_handle</a> : <a href='../S/2231.html#L39' title='Defined at 39 in src/termhooks.h.'>scroll_bar_below_handle</a>);
<a id='L15545' name='L15545'></a> 15545       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging = -1;
<a id='L15546' name='L15546'></a> 15546       <strong class='reserved'>break</strong>;
<a id='L15547' name='L15547'></a> 15547     <strong class='reserved'>default</strong>:
<a id='L15548' name='L15548'></a> 15548       <strong class='reserved'>break</strong>;
<a id='L15549' name='L15549'></a> 15549     <em class='brace'>}</em>
<a id='L15550' name='L15550'></a> 15550 
<a id='L15551' name='L15551'></a> 15551   <strong class='reserved'>if</strong> (part != <a href='../S/2231.html#L36' title='Defined at 36 in src/termhooks.h.'>scroll_bar_nowhere</a>)
<a id='L15552' name='L15552'></a> 15552     <em class='brace'>{</em>
<a id='L15553' name='L15553'></a> 15553       window_being_scrolled = <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>;
<a id='L15554' name='L15554'></a> 15554       x_send_scroll_bar_event (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, part, portion, whole,
<a id='L15555' name='L15555'></a> 15555                                <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;horizontal);
<a id='L15556' name='L15556'></a> 15556     <em class='brace'>}</em>
<a id='L15557' name='L15557'></a> 15557 
<a id='L15558' name='L15558'></a> 15558   <strong class='reserved'>return</strong> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L15559' name='L15559'></a> 15559 <em class='brace'>}</em>
<a id='L15560' name='L15560'></a> 15560 
<a id='L15561' name='L15561'></a> 15561 <em class='comment'>/* Callback for button release. Sets dragging to -1 when dragging is done.  */</em>
<a id='L15562' name='L15562'></a> 15562 
<a id='L15563' name='L15563'></a> 15563 <strong class='reserved'>static</strong> gboolean
<a id='L15564' name='L15564'></a> 15564 <a href='../S/2355.html#L3966' title='Defined at 3966 in src/pgtkterm.c.'>xg_end_scroll_callback</a> (GtkWidget *widget,
<a id='L15565' name='L15565'></a> 15565                         GdkEventButton *event,
<a id='L15566' name='L15566'></a> 15566                         gpointer user_data)
<a id='L15567' name='L15567'></a> 15567 <em class='brace'>{</em>
<a id='L15568' name='L15568'></a> 15568   <strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>;
<a id='L15569' name='L15569'></a> 15569 
<a id='L15570' name='L15570'></a> 15570   <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> = user_data;
<a id='L15571' name='L15571'></a> 15571   <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging = -1;
<a id='L15572' name='L15572'></a> 15572 
<a id='L15573' name='L15573'></a> 15573   <strong class='reserved'>if</strong> (<a href='../D/6789.html' title='Multiple defined in 2 places.'>WINDOWP</a> (window_being_scrolled))
<a id='L15574' name='L15574'></a> 15574     <em class='brace'>{</em>
<a id='L15575' name='L15575'></a> 15575       x_send_scroll_bar_event (window_being_scrolled,
<a id='L15576' name='L15576'></a> 15576                                <a href='../S/2231.html#L44' title='Defined at 44 in src/termhooks.h.'>scroll_bar_end_scroll</a>, 0, 0, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;horizontal);
<a id='L15577' name='L15577'></a> 15577       window_being_scrolled = Qnil;
<a id='L15578' name='L15578'></a> 15578     <em class='brace'>}</em>
<a id='L15579' name='L15579'></a> 15579 
<a id='L15580' name='L15580'></a> 15580   <strong class='reserved'>return</strong> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L15581' name='L15581'></a> 15581 <em class='brace'>}</em>
<a id='L15582' name='L15582'></a> 15582 
<a id='L15583' name='L15583'></a> 15583 
<a id='L15584' name='L15584'></a> 15584 <em class='sharp'>#else</em> <em class='comment'>/* not USE_GTK and not USE_MOTIF */</em>
<a id='L15585' name='L15585'></a> 15585 
<a id='L15586' name='L15586'></a> 15586 <em class='comment'>/* Xaw scroll bar callback.  Invoked when the thumb is dragged.</em>
<a id='L15587' name='L15587'></a> 15587 <em class='comment'>   WIDGET is the scroll bar widget.  CLIENT_DATA is a pointer to the</em>
<a id='L15588' name='L15588'></a> 15588 <em class='comment'>   scroll bar struct.  CALL_DATA is a pointer to a float saying where</em>
<a id='L15589' name='L15589'></a> 15589 <em class='comment'>   the thumb is.  */</em>
<a id='L15590' name='L15590'></a> 15590 
<a id='L15591' name='L15591'></a> 15591 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L15592' name='L15592'></a> 15592 xaw_jump_callback (Widget widget, XtPointer client_data, XtPointer call_data)
<a id='L15593' name='L15593'></a> 15593 <em class='brace'>{</em>
<a id='L15594' name='L15594'></a> 15594   <strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> = client_data;
<a id='L15595' name='L15595'></a> 15595   <strong class='reserved'>float</strong> *top_addr = call_data;
<a id='L15596' name='L15596'></a> 15596   <strong class='reserved'>float</strong> top = *top_addr;
<a id='L15597' name='L15597'></a> 15597   <strong class='reserved'>float</strong> shown;
<a id='L15598' name='L15598'></a> 15598   <strong class='reserved'>int</strong> whole, portion, height, width;
<a id='L15599' name='L15599'></a> 15599   <strong class='reserved'>enum</strong> <a href='../S/2231.html#L34' title='Defined at 34 in src/termhooks.h.'>scroll_bar_part</a> part;
<a id='L15600' name='L15600'></a> 15600   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> horizontal = <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;horizontal;
<a id='L15601' name='L15601'></a> 15601 
<a id='L15602' name='L15602'></a> 15602   <strong class='reserved'>if</strong> (horizontal)
<a id='L15603' name='L15603'></a> 15603     <em class='brace'>{</em>
<a id='L15604' name='L15604'></a> 15604       <em class='comment'>/* Get the size of the thumb, a value between 0 and 1.  */</em>
<a id='L15605' name='L15605'></a> 15605       <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L15606' name='L15606'></a> 15606       XtVaGetValues (widget, XtNshown, &amp;shown, XtNwidth, &amp;width, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L15607' name='L15607'></a> 15607       <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L15608' name='L15608'></a> 15608 
<a id='L15609' name='L15609'></a> 15609       <strong class='reserved'>if</strong> (shown &lt; 1)
<a id='L15610' name='L15610'></a> 15610         <em class='brace'>{</em>
<a id='L15611' name='L15611'></a> 15611           whole = <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;whole - (shown * <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;whole);
<a id='L15612' name='L15612'></a> 15612           portion = <a href='../D/14475.html' title='Multiple defined in 11 places.'>min</a> (top * <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;whole, whole);
<a id='L15613' name='L15613'></a> 15613         <em class='brace'>}</em>
<a id='L15614' name='L15614'></a> 15614       <strong class='reserved'>else</strong>
<a id='L15615' name='L15615'></a> 15615         <em class='brace'>{</em>
<a id='L15616' name='L15616'></a> 15616           whole = <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;whole;
<a id='L15617' name='L15617'></a> 15617           portion = 0;
<a id='L15618' name='L15618'></a> 15618         <em class='brace'>}</em>
<a id='L15619' name='L15619'></a> 15619 
<a id='L15620' name='L15620'></a> 15620       part = <a href='../S/2231.html#L47' title='Defined at 47 in src/termhooks.h.'>scroll_bar_horizontal_handle</a>;
<a id='L15621' name='L15621'></a> 15621     <em class='brace'>}</em>
<a id='L15622' name='L15622'></a> 15622   <strong class='reserved'>else</strong>
<a id='L15623' name='L15623'></a> 15623     <em class='brace'>{</em>
<a id='L15624' name='L15624'></a> 15624       <em class='comment'>/* Get the size of the thumb, a value between 0 and 1.  */</em>
<a id='L15625' name='L15625'></a> 15625       <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L15626' name='L15626'></a> 15626       XtVaGetValues (widget, XtNshown, &amp;shown, XtNheight, &amp;height, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L15627' name='L15627'></a> 15627       <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L15628' name='L15628'></a> 15628 
<a id='L15629' name='L15629'></a> 15629       whole = 10000000;
<a id='L15630' name='L15630'></a> 15630       portion = shown &lt; 1 ? top * whole : 0;
<a id='L15631' name='L15631'></a> 15631 
<a id='L15632' name='L15632'></a> 15632       <strong class='reserved'>if</strong> (shown &lt; 1 &amp;&amp; (<a href='../D/10870.html' title='Multiple defined in 2 places.'>eabs</a> (top + shown - 1) &lt; 1.0f / height))
<a id='L15633' name='L15633'></a> 15633         <em class='comment'>/* Some derivatives of Xaw refuse to shrink the thumb when you reach</em>
<a id='L15634' name='L15634'></a> 15634 <em class='comment'>           the bottom, so we force the scrolling whenever we see that we're</em>
<a id='L15635' name='L15635'></a> 15635 <em class='comment'>           too close to the bottom (in x_set_toolkit_scroll_bar_thumb</em>
<a id='L15636' name='L15636'></a> 15636 <em class='comment'>           we try to ensure that we always stay two pixels away from the</em>
<a id='L15637' name='L15637'></a> 15637 <em class='comment'>           bottom).  */</em>
<a id='L15638' name='L15638'></a> 15638         part = <a href='../S/2231.html#L41' title='Defined at 41 in src/termhooks.h.'>scroll_bar_down_arrow</a>;
<a id='L15639' name='L15639'></a> 15639       <strong class='reserved'>else</strong>
<a id='L15640' name='L15640'></a> 15640         part = <a href='../S/2231.html#L38' title='Defined at 38 in src/termhooks.h.'>scroll_bar_handle</a>;
<a id='L15641' name='L15641'></a> 15641     <em class='brace'>}</em>
<a id='L15642' name='L15642'></a> 15642 
<a id='L15643' name='L15643'></a> 15643   window_being_scrolled = <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>;
<a id='L15644' name='L15644'></a> 15644   <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging = portion;
<a id='L15645' name='L15645'></a> 15645   <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;last_seen_part = part;
<a id='L15646' name='L15646'></a> 15646   x_send_scroll_bar_event (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, part, portion, whole, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;horizontal);
<a id='L15647' name='L15647'></a> 15647 <em class='brace'>}</em>
<a id='L15648' name='L15648'></a> 15648 
<a id='L15649' name='L15649'></a> 15649 
<a id='L15650' name='L15650'></a> 15650 <em class='comment'>/* Xaw scroll bar callback.  Invoked for incremental scrolling.,</em>
<a id='L15651' name='L15651'></a> 15651 <em class='comment'>   i.e. line or page up or down.  WIDGET is the Xaw scroll bar</em>
<a id='L15652' name='L15652'></a> 15652 <em class='comment'>   widget.  CLIENT_DATA is a pointer to the scroll_bar structure for</em>
<a id='L15653' name='L15653'></a> 15653 <em class='comment'>   the scroll bar.  CALL_DATA is an integer specifying the action that</em>
<a id='L15654' name='L15654'></a> 15654 <em class='comment'>   has taken place.  Its magnitude is in the range 0..height of the</em>
<a id='L15655' name='L15655'></a> 15655 <em class='comment'>   scroll bar.  Negative values mean scroll towards buffer start.</em>
<a id='L15656' name='L15656'></a> 15656 <em class='comment'>   Values &lt; height of scroll bar mean line-wise movement.  */</em>
<a id='L15657' name='L15657'></a> 15657 
<a id='L15658' name='L15658'></a> 15658 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L15659' name='L15659'></a> 15659 xaw_scroll_callback (Widget widget, XtPointer client_data, XtPointer call_data)
<a id='L15660' name='L15660'></a> 15660 <em class='brace'>{</em>
<a id='L15661' name='L15661'></a> 15661   <strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> = client_data;
<a id='L15662' name='L15662'></a> 15662   <em class='comment'>/* The position really is stored cast to a pointer.  */</em>
<a id='L15663' name='L15663'></a> 15663   <strong class='reserved'>int</strong> <a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a> = (<a href='../D/13424.html' title='Multiple defined in 4 places.'>intptr_t</a>) call_data;
<a id='L15664' name='L15664'></a> 15664   Dimension height, width;
<a id='L15665' name='L15665'></a> 15665   <strong class='reserved'>enum</strong> <a href='../S/2231.html#L34' title='Defined at 34 in src/termhooks.h.'>scroll_bar_part</a> part;
<a id='L15666' name='L15666'></a> 15666 
<a id='L15667' name='L15667'></a> 15667   <strong class='reserved'>if</strong> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;horizontal)
<a id='L15668' name='L15668'></a> 15668     <em class='brace'>{</em>
<a id='L15669' name='L15669'></a> 15669       <em class='comment'>/* Get the width of the scroll bar.  */</em>
<a id='L15670' name='L15670'></a> 15670       <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L15671' name='L15671'></a> 15671       XtVaGetValues (widget, XtNwidth, &amp;width, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L15672' name='L15672'></a> 15672       <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L15673' name='L15673'></a> 15673 
<a id='L15674' name='L15674'></a> 15674       <strong class='reserved'>if</strong> (<a href='../D/10870.html' title='Multiple defined in 2 places.'>eabs</a> (<a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a>) &gt;= width)
<a id='L15675' name='L15675'></a> 15675         part = (<a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a> &lt; 0) ? <a href='../S/2231.html#L46' title='Defined at 46 in src/termhooks.h.'>scroll_bar_before_handle</a> : <a href='../S/2231.html#L48' title='Defined at 48 in src/termhooks.h.'>scroll_bar_after_handle</a>;
<a id='L15676' name='L15676'></a> 15676 
<a id='L15677' name='L15677'></a> 15677       <em class='comment'>/* If Xaw3d was compiled with ARROW_SCROLLBAR,</em>
<a id='L15678' name='L15678'></a> 15678 <em class='comment'>         it maps line-movement to call_data = max(5, height/20).  */</em>
<a id='L15679' name='L15679'></a> 15679       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (xaw3d_arrow_scroll &amp;&amp; <a href='../D/10870.html' title='Multiple defined in 2 places.'>eabs</a> (<a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a>) &lt;= <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> (5, width / 20))
<a id='L15680' name='L15680'></a> 15680         part = (<a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a> &lt; 0) ? <a href='../S/2231.html#L49' title='Defined at 49 in src/termhooks.h.'>scroll_bar_left_arrow</a> : <a href='../S/2231.html#L50' title='Defined at 50 in src/termhooks.h.'>scroll_bar_right_arrow</a>;
<a id='L15681' name='L15681'></a> 15681       <strong class='reserved'>else</strong>
<a id='L15682' name='L15682'></a> 15682         part = <a href='../S/2231.html#L45' title='Defined at 45 in src/termhooks.h.'>scroll_bar_move_ratio</a>;
<a id='L15683' name='L15683'></a> 15683 
<a id='L15684' name='L15684'></a> 15684       window_being_scrolled = <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>;
<a id='L15685' name='L15685'></a> 15685       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging = -1;
<a id='L15686' name='L15686'></a> 15686       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;last_seen_part = part;
<a id='L15687' name='L15687'></a> 15687       x_send_scroll_bar_event (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, part, <a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a>, width,
<a id='L15688' name='L15688'></a> 15688                                <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;horizontal);
<a id='L15689' name='L15689'></a> 15689     <em class='brace'>}</em>
<a id='L15690' name='L15690'></a> 15690   <strong class='reserved'>else</strong>
<a id='L15691' name='L15691'></a> 15691     <em class='brace'>{</em>
<a id='L15692' name='L15692'></a> 15692 
<a id='L15693' name='L15693'></a> 15693       <em class='comment'>/* Get the height of the scroll bar.  */</em>
<a id='L15694' name='L15694'></a> 15694       <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L15695' name='L15695'></a> 15695       XtVaGetValues (widget, XtNheight, &amp;height, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L15696' name='L15696'></a> 15696       <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L15697' name='L15697'></a> 15697 
<a id='L15698' name='L15698'></a> 15698       <strong class='reserved'>if</strong> (<a href='../D/10870.html' title='Multiple defined in 2 places.'>eabs</a> (<a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a>) &gt;= height)
<a id='L15699' name='L15699'></a> 15699         part = (<a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a> &lt; 0) ? <a href='../S/2231.html#L37' title='Defined at 37 in src/termhooks.h.'>scroll_bar_above_handle</a> : <a href='../S/2231.html#L39' title='Defined at 39 in src/termhooks.h.'>scroll_bar_below_handle</a>;
<a id='L15700' name='L15700'></a> 15700 
<a id='L15701' name='L15701'></a> 15701       <em class='comment'>/* If Xaw3d was compiled with ARROW_SCROLLBAR,</em>
<a id='L15702' name='L15702'></a> 15702 <em class='comment'>         it maps line-movement to call_data = max(5, height/20).  */</em>
<a id='L15703' name='L15703'></a> 15703       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (xaw3d_arrow_scroll &amp;&amp; <a href='../D/10870.html' title='Multiple defined in 2 places.'>eabs</a> (<a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a>) &lt;= <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> (5, height / 20))
<a id='L15704' name='L15704'></a> 15704         part = (<a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a> &lt; 0) ? <a href='../S/2231.html#L40' title='Defined at 40 in src/termhooks.h.'>scroll_bar_up_arrow</a> : <a href='../S/2231.html#L41' title='Defined at 41 in src/termhooks.h.'>scroll_bar_down_arrow</a>;
<a id='L15705' name='L15705'></a> 15705       <strong class='reserved'>else</strong>
<a id='L15706' name='L15706'></a> 15706         part = <a href='../S/2231.html#L45' title='Defined at 45 in src/termhooks.h.'>scroll_bar_move_ratio</a>;
<a id='L15707' name='L15707'></a> 15707 
<a id='L15708' name='L15708'></a> 15708       window_being_scrolled = <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>;
<a id='L15709' name='L15709'></a> 15709       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging = -1;
<a id='L15710' name='L15710'></a> 15710       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;last_seen_part = part;
<a id='L15711' name='L15711'></a> 15711       x_send_scroll_bar_event (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, part, <a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a>, height,
<a id='L15712' name='L15712'></a> 15712                                <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;horizontal);
<a id='L15713' name='L15713'></a> 15713     <em class='brace'>}</em>
<a id='L15714' name='L15714'></a> 15714 <em class='brace'>}</em>
<a id='L15715' name='L15715'></a> 15715 
<a id='L15716' name='L15716'></a> 15716 <em class='sharp'>#endif</em> <em class='comment'>/* not USE_GTK and not USE_MOTIF */</em>
<a id='L15717' name='L15717'></a> 15717 
<a id='L15718' name='L15718'></a> 15718 <em class='sharp'>#define</em> <a href='../R/4991.html' title='Multiple referred from 3 places.'>SCROLL_BAR_NAME</a> "verticalScrollBar"
<a id='L15719' name='L15719'></a> 15719 <em class='sharp'>#define</em> <a href='../R/4990.html' title='Multiple referred from 3 places.'>SCROLL_BAR_HORIZONTAL_NAME</a> "horizontalScrollBar"
<a id='L15720' name='L15720'></a> 15720 
<a id='L15721' name='L15721'></a> 15721 <em class='comment'>/* Create the widget for scroll bar BAR on frame F.  Record the widget</em>
<a id='L15722' name='L15722'></a> 15722 <em class='comment'>   and X window of the scroll bar in BAR.  */</em>
<a id='L15723' name='L15723'></a> 15723 
<a id='L15724' name='L15724'></a> 15724 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L15725' name='L15725'></a> 15725 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L15726' name='L15726'></a> 15726 x_create_toolkit_scroll_bar (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>)
<a id='L15727' name='L15727'></a> 15727 <em class='brace'>{</em>
<a id='L15728' name='L15728'></a> 15728   <strong class='reserved'>const</strong> <strong class='reserved'>char</strong> *scroll_bar_name = <a href='../D/5524.html' title='Multiple defined in 2 places.'>SCROLL_BAR_NAME</a>;
<a id='L15729' name='L15729'></a> 15729 
<a id='L15730' name='L15730'></a> 15730   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L15731' name='L15731'></a> 15731   <a href='../S/2362.html#L4626' title='Defined at 4626 in src/gtkutil.c.'>xg_create_scroll_bar</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>, G_CALLBACK (<a href='../S/2355.html#L3899' title='Defined at 3899 in src/pgtkterm.c.'>xg_scroll_callback</a>),
<a id='L15732' name='L15732'></a> 15732                         G_CALLBACK (<a href='../S/2355.html#L3966' title='Defined at 3966 in src/pgtkterm.c.'>xg_end_scroll_callback</a>),
<a id='L15733' name='L15733'></a> 15733                         scroll_bar_name);
<a id='L15734' name='L15734'></a> 15734   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L15735' name='L15735'></a> 15735 <em class='brace'>}</em>
<a id='L15736' name='L15736'></a> 15736 
<a id='L15737' name='L15737'></a> 15737 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L15738' name='L15738'></a> 15738 x_create_horizontal_toolkit_scroll_bar (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>)
<a id='L15739' name='L15739'></a> 15739 <em class='brace'>{</em>
<a id='L15740' name='L15740'></a> 15740   <strong class='reserved'>const</strong> <strong class='reserved'>char</strong> *scroll_bar_name = <a href='../D/5523.html' title='Multiple defined in 2 places.'>SCROLL_BAR_HORIZONTAL_NAME</a>;
<a id='L15741' name='L15741'></a> 15741 
<a id='L15742' name='L15742'></a> 15742   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L15743' name='L15743'></a> 15743   <a href='../S/2362.html#L4658' title='Defined at 4658 in src/gtkutil.c.'>xg_create_horizontal_scroll_bar</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>, G_CALLBACK (<a href='../S/2355.html#L3899' title='Defined at 3899 in src/pgtkterm.c.'>xg_scroll_callback</a>),
<a id='L15744' name='L15744'></a> 15744                                    G_CALLBACK (<a href='../S/2355.html#L3966' title='Defined at 3966 in src/pgtkterm.c.'>xg_end_scroll_callback</a>),
<a id='L15745' name='L15745'></a> 15745                                    scroll_bar_name);
<a id='L15746' name='L15746'></a> 15746   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L15747' name='L15747'></a> 15747 <em class='brace'>}</em>
<a id='L15748' name='L15748'></a> 15748 
<a id='L15749' name='L15749'></a> 15749 <em class='sharp'>#else</em> <em class='comment'>/* not USE_GTK */</em>
<a id='L15750' name='L15750'></a> 15750 
<a id='L15751' name='L15751'></a> 15751 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L15752' name='L15752'></a> 15752 x_create_toolkit_scroll_bar (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>)
<a id='L15753' name='L15753'></a> 15753 <em class='brace'>{</em>
<a id='L15754' name='L15754'></a> 15754   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> xwindow;
<a id='L15755' name='L15755'></a> 15755   Widget widget;
<a id='L15756' name='L15756'></a> 15756   Arg av[20];
<a id='L15757' name='L15757'></a> 15757   <strong class='reserved'>int</strong> ac = 0;
<a id='L15758' name='L15758'></a> 15758   <strong class='reserved'>const</strong> <strong class='reserved'>char</strong> *scroll_bar_name = <a href='../D/5524.html' title='Multiple defined in 2 places.'>SCROLL_BAR_NAME</a>;
<a id='L15759' name='L15759'></a> 15759   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> pixel;
<a id='L15760' name='L15760'></a> 15760 
<a id='L15761' name='L15761'></a> 15761   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L15762' name='L15762'></a> 15762 
<a id='L15763' name='L15763'></a> 15763 <em class='sharp'>#ifdef</em> USE_MOTIF
<a id='L15764' name='L15764'></a> 15764   <em class='comment'>/* Set resources.  Create the widget.  */</em>
<a id='L15765' name='L15765'></a> 15765   XtSetArg (av[ac], XtNmappedWhenManaged, False); ++ac;
<a id='L15766' name='L15766'></a> 15766   XtSetArg (av[ac], XmNminimum, 0); ++ac;
<a id='L15767' name='L15767'></a> 15767   XtSetArg (av[ac], XmNmaximum, <a href='../S/2289.html#L15385' title='Defined at 15385 in src/xterm.c.'>XM_SB_MAX</a>); ++ac;
<a id='L15768' name='L15768'></a> 15768   XtSetArg (av[ac], XmNorientation, XmVERTICAL); ++ac;
<a id='L15769' name='L15769'></a> 15769   XtSetArg (av[ac], XmNprocessingDirection, XmMAX_ON_BOTTOM), ++ac;
<a id='L15770' name='L15770'></a> 15770   XtSetArg (av[ac], XmNincrement, 1); ++ac;
<a id='L15771' name='L15771'></a> 15771   XtSetArg (av[ac], XmNpageIncrement, 1); ++ac;
<a id='L15772' name='L15772'></a> 15772 
<a id='L15773' name='L15773'></a> 15773   <em class='comment'>/* Note: "background" is the thumb color, and "trough" is the color behind</em>
<a id='L15774' name='L15774'></a> 15774 <em class='comment'>     everything. */</em>
<a id='L15775' name='L15775'></a> 15775   pixel = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_foreground_pixel;
<a id='L15776' name='L15776'></a> 15776   <strong class='reserved'>if</strong> (pixel != -1)
<a id='L15777' name='L15777'></a> 15777     <em class='brace'>{</em>
<a id='L15778' name='L15778'></a> 15778       XtSetArg (av[ac], XmNbackground, pixel);
<a id='L15779' name='L15779'></a> 15779       ++ac;
<a id='L15780' name='L15780'></a> 15780     <em class='brace'>}</em>
<a id='L15781' name='L15781'></a> 15781 
<a id='L15782' name='L15782'></a> 15782   pixel = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_background_pixel;
<a id='L15783' name='L15783'></a> 15783   <strong class='reserved'>if</strong> (pixel != -1)
<a id='L15784' name='L15784'></a> 15784     <em class='brace'>{</em>
<a id='L15785' name='L15785'></a> 15785       XtSetArg (av[ac], XmNtroughColor, pixel);
<a id='L15786' name='L15786'></a> 15786       ++ac;
<a id='L15787' name='L15787'></a> 15787     <em class='brace'>}</em>
<a id='L15788' name='L15788'></a> 15788 
<a id='L15789' name='L15789'></a> 15789   widget = XmCreateScrollBar (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;edit_widget,
<a id='L15790' name='L15790'></a> 15790                               (<strong class='reserved'>char</strong> *) scroll_bar_name, av, ac);
<a id='L15791' name='L15791'></a> 15791 
<a id='L15792' name='L15792'></a> 15792   <em class='comment'>/* Add one callback for everything that can happen.  */</em>
<a id='L15793' name='L15793'></a> 15793   XtAddCallback (widget, XmNdecrementCallback, xm_scroll_callback,
<a id='L15794' name='L15794'></a> 15794                  (XtPointer) <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L15795' name='L15795'></a> 15795   XtAddCallback (widget, XmNdragCallback, xm_scroll_callback,
<a id='L15796' name='L15796'></a> 15796                  (XtPointer) <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L15797' name='L15797'></a> 15797   XtAddCallback (widget, XmNincrementCallback, xm_scroll_callback,
<a id='L15798' name='L15798'></a> 15798                  (XtPointer) <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L15799' name='L15799'></a> 15799   XtAddCallback (widget, XmNpageDecrementCallback, xm_scroll_callback,
<a id='L15800' name='L15800'></a> 15800                  (XtPointer) <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L15801' name='L15801'></a> 15801   XtAddCallback (widget, XmNpageIncrementCallback, xm_scroll_callback,
<a id='L15802' name='L15802'></a> 15802                  (XtPointer) <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L15803' name='L15803'></a> 15803   XtAddCallback (widget, XmNtoBottomCallback, xm_scroll_callback,
<a id='L15804' name='L15804'></a> 15804                  (XtPointer) <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L15805' name='L15805'></a> 15805   XtAddCallback (widget, XmNtoTopCallback, xm_scroll_callback,
<a id='L15806' name='L15806'></a> 15806                  (XtPointer) <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L15807' name='L15807'></a> 15807 
<a id='L15808' name='L15808'></a> 15808   <em class='comment'>/* Realize the widget.  Only after that is the X window created.  */</em>
<a id='L15809' name='L15809'></a> 15809   XtRealizeWidget (widget);
<a id='L15810' name='L15810'></a> 15810 
<a id='L15811' name='L15811'></a> 15811   <em class='comment'>/* Set the cursor to an arrow.  I didn't find a resource to do that.</em>
<a id='L15812' name='L15812'></a> 15812 <em class='comment'>     And I'm wondering why it hasn't an arrow cursor by default.  */</em>
<a id='L15813' name='L15813'></a> 15813   XDefineCursor (XtDisplay (widget), XtWindow (widget),
<a id='L15814' name='L15814'></a> 15814                  <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;nontext_cursor);
<a id='L15815' name='L15815'></a> 15815 
<a id='L15816' name='L15816'></a> 15816 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L15817' name='L15817'></a> 15817   <em class='comment'>/* Ask for input extension button and motion events.  This lets us</em>
<a id='L15818' name='L15818'></a> 15818 <em class='comment'>     send the proper `wheel-up' or `wheel-down' events to Emacs.  */</em>
<a id='L15819' name='L15819'></a> 15819   <strong class='reserved'>if</strong> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;supports_xi2)
<a id='L15820' name='L15820'></a> 15820     xi_select_scroll_bar_events (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L15821' name='L15821'></a> 15821                                  XtWindow (widget));
<a id='L15822' name='L15822'></a> 15822 <em class='sharp'>#endif</em>
<a id='L15823' name='L15823'></a> 15823 <em class='sharp'>#else</em> <em class='comment'>/* !USE_MOTIF i.e. use Xaw */</em>
<a id='L15824' name='L15824'></a> 15824 
<a id='L15825' name='L15825'></a> 15825   <em class='comment'>/* Set resources.  Create the widget.  The background of the</em>
<a id='L15826' name='L15826'></a> 15826 <em class='comment'>     Xaw3d scroll bar widget is a little bit light for my taste.</em>
<a id='L15827' name='L15827'></a> 15827 <em class='comment'>     We don't alter it here to let users change it according</em>
<a id='L15828' name='L15828'></a> 15828 <em class='comment'>     to their taste with `emacs*verticalScrollBar.background: xxx'.  */</em>
<a id='L15829' name='L15829'></a> 15829   XtSetArg (av[ac], XtNmappedWhenManaged, False); ++ac;
<a id='L15830' name='L15830'></a> 15830   XtSetArg (av[ac], XtNorientation, XtorientVertical); ++ac;
<a id='L15831' name='L15831'></a> 15831   <em class='comment'>/* For smoother scrolling with Xaw3d   -sm */</em>
<a id='L15832' name='L15832'></a> 15832   <em class='comment'>/* XtSetArg (av[ac], XtNpickTop, True); ++ac; */</em>
<a id='L15833' name='L15833'></a> 15833 
<a id='L15834' name='L15834'></a> 15834   pixel = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_foreground_pixel;
<a id='L15835' name='L15835'></a> 15835   <strong class='reserved'>if</strong> (pixel != -1)
<a id='L15836' name='L15836'></a> 15836     <em class='brace'>{</em>
<a id='L15837' name='L15837'></a> 15837       XtSetArg (av[ac], <a href='../S/2111.html#L42' title='Defined at 42 in src/widget.h.'>XtNforeground</a>, pixel);
<a id='L15838' name='L15838'></a> 15838       ++ac;
<a id='L15839' name='L15839'></a> 15839     <em class='brace'>}</em>
<a id='L15840' name='L15840'></a> 15840 
<a id='L15841' name='L15841'></a> 15841   pixel = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_background_pixel;
<a id='L15842' name='L15842'></a> 15842   <strong class='reserved'>if</strong> (pixel != -1)
<a id='L15843' name='L15843'></a> 15843     <em class='brace'>{</em>
<a id='L15844' name='L15844'></a> 15844       XtSetArg (av[ac], XtNbackground, pixel);
<a id='L15845' name='L15845'></a> 15845       ++ac;
<a id='L15846' name='L15846'></a> 15846     <em class='brace'>}</em>
<a id='L15847' name='L15847'></a> 15847 
<a id='L15848' name='L15848'></a> 15848   <em class='comment'>/* Top/bottom shadow colors.  */</em>
<a id='L15849' name='L15849'></a> 15849 
<a id='L15850' name='L15850'></a> 15850   <em class='comment'>/* Allocate them, if necessary.  */</em>
<a id='L15851' name='L15851'></a> 15851   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_top_shadow_pixel == -1)
<a id='L15852' name='L15852'></a> 15852     <em class='brace'>{</em>
<a id='L15853' name='L15853'></a> 15853       pixel = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_background_pixel;
<a id='L15854' name='L15854'></a> 15854       <strong class='reserved'>if</strong> (pixel != -1)
<a id='L15855' name='L15855'></a> 15855         <em class='brace'>{</em>
<a id='L15856' name='L15856'></a> 15856           <strong class='reserved'>if</strong> (!<a href='../S/2289.html#L9430' title='Defined at 9430 in src/xterm.c.'>x_alloc_lighter_color</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L15857' name='L15857'></a> 15857                                       <a href='../S/2212.html#L1468' title='Defined at 1468 in src/xterm.h.'>FRAME_X_COLORMAP</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L15858' name='L15858'></a> 15858                                       &amp;pixel, 1.2, 0x8000))
<a id='L15859' name='L15859'></a> 15859             pixel = -1;
<a id='L15860' name='L15860'></a> 15860           <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_top_shadow_pixel = pixel;
<a id='L15861' name='L15861'></a> 15861         <em class='brace'>}</em>
<a id='L15862' name='L15862'></a> 15862     <em class='brace'>}</em>
<a id='L15863' name='L15863'></a> 15863   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_bottom_shadow_pixel == -1)
<a id='L15864' name='L15864'></a> 15864     <em class='brace'>{</em>
<a id='L15865' name='L15865'></a> 15865       pixel = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_background_pixel;
<a id='L15866' name='L15866'></a> 15866       <strong class='reserved'>if</strong> (pixel != -1)
<a id='L15867' name='L15867'></a> 15867         <em class='brace'>{</em>
<a id='L15868' name='L15868'></a> 15868           <strong class='reserved'>if</strong> (!<a href='../S/2289.html#L9430' title='Defined at 9430 in src/xterm.c.'>x_alloc_lighter_color</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L15869' name='L15869'></a> 15869                                       <a href='../S/2212.html#L1468' title='Defined at 1468 in src/xterm.h.'>FRAME_X_COLORMAP</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L15870' name='L15870'></a> 15870                                       &amp;pixel, 0.6, 0x4000))
<a id='L15871' name='L15871'></a> 15871             pixel = -1;
<a id='L15872' name='L15872'></a> 15872           <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_bottom_shadow_pixel = pixel;
<a id='L15873' name='L15873'></a> 15873         <em class='brace'>}</em>
<a id='L15874' name='L15874'></a> 15874     <em class='brace'>}</em>
<a id='L15875' name='L15875'></a> 15875 
<a id='L15876' name='L15876'></a> 15876 <em class='sharp'>#ifdef</em> XtNbeNiceToColormap
<a id='L15877' name='L15877'></a> 15877   <em class='comment'>/* Tell the toolkit about them.  */</em>
<a id='L15878' name='L15878'></a> 15878   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_top_shadow_pixel == -1
<a id='L15879' name='L15879'></a> 15879       || <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_bottom_shadow_pixel == -1)
<a id='L15880' name='L15880'></a> 15880     <em class='comment'>/* We tried to allocate a color for the top/bottom shadow, and</em>
<a id='L15881' name='L15881'></a> 15881 <em class='comment'>       failed, so tell Xaw3d to use dithering instead.   */</em>
<a id='L15882' name='L15882'></a> 15882     <em class='comment'>/* But only if we have a small colormap.  Xaw3d can allocate nice</em>
<a id='L15883' name='L15883'></a> 15883 <em class='comment'>       colors itself.  */</em>
<a id='L15884' name='L15884'></a> 15884     <em class='brace'>{</em>
<a id='L15885' name='L15885'></a> 15885       XtSetArg (av[ac], (String) XtNbeNiceToColormap,
<a id='L15886' name='L15886'></a> 15886                 DefaultDepthOfScreen (<a href='../S/2212.html#L1428' title='Defined at 1428 in src/xterm.h.'>FRAME_X_SCREEN</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)) &lt; 16);
<a id='L15887' name='L15887'></a> 15887       ++ac;
<a id='L15888' name='L15888'></a> 15888     <em class='brace'>}</em>
<a id='L15889' name='L15889'></a> 15889   <strong class='reserved'>else</strong>
<a id='L15890' name='L15890'></a> 15890     <em class='comment'>/* Tell what colors Xaw3d should use for the top/bottom shadow, to</em>
<a id='L15891' name='L15891'></a> 15891 <em class='comment'>       be more consistent with other emacs 3d colors, and since Xaw3d is</em>
<a id='L15892' name='L15892'></a> 15892 <em class='comment'>       not good at dealing with allocation failure.  */</em>
<a id='L15893' name='L15893'></a> 15893     <em class='brace'>{</em>
<a id='L15894' name='L15894'></a> 15894       <em class='comment'>/* This tells Xaw3d to use real colors instead of dithering for</em>
<a id='L15895' name='L15895'></a> 15895 <em class='comment'>         the shadows.  */</em>
<a id='L15896' name='L15896'></a> 15896       XtSetArg (av[ac], (String) XtNbeNiceToColormap, False);
<a id='L15897' name='L15897'></a> 15897       ++ac;
<a id='L15898' name='L15898'></a> 15898 
<a id='L15899' name='L15899'></a> 15899       <em class='comment'>/* Specify the colors.  */</em>
<a id='L15900' name='L15900'></a> 15900       pixel = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_top_shadow_pixel;
<a id='L15901' name='L15901'></a> 15901       <strong class='reserved'>if</strong> (pixel != -1)
<a id='L15902' name='L15902'></a> 15902         <em class='brace'>{</em>
<a id='L15903' name='L15903'></a> 15903           XtSetArg (av[ac], (String) XtNtopShadowPixel, pixel);
<a id='L15904' name='L15904'></a> 15904           ++ac;
<a id='L15905' name='L15905'></a> 15905         <em class='brace'>}</em>
<a id='L15906' name='L15906'></a> 15906       pixel = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_bottom_shadow_pixel;
<a id='L15907' name='L15907'></a> 15907       <strong class='reserved'>if</strong> (pixel != -1)
<a id='L15908' name='L15908'></a> 15908         <em class='brace'>{</em>
<a id='L15909' name='L15909'></a> 15909           XtSetArg (av[ac], (String) XtNbottomShadowPixel, pixel);
<a id='L15910' name='L15910'></a> 15910           ++ac;
<a id='L15911' name='L15911'></a> 15911         <em class='brace'>}</em>
<a id='L15912' name='L15912'></a> 15912     <em class='brace'>}</em>
<a id='L15913' name='L15913'></a> 15913 <em class='sharp'>#endif</em>
<a id='L15914' name='L15914'></a> 15914 
<a id='L15915' name='L15915'></a> 15915   widget = XtCreateWidget (scroll_bar_name, scrollbarWidgetClass,
<a id='L15916' name='L15916'></a> 15916                            <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;edit_widget, av, ac);
<a id='L15917' name='L15917'></a> 15917 
<a id='L15918' name='L15918'></a> 15918   <em class='brace'>{</em>
<a id='L15919' name='L15919'></a> 15919     <strong class='reserved'>char</strong> <strong class='reserved'>const</strong> *initial = "";
<a id='L15920' name='L15920'></a> 15920     <strong class='reserved'>char</strong> <strong class='reserved'>const</strong> *val = initial;
<a id='L15921' name='L15921'></a> 15921     XtVaGetValues (widget, XtNscrollVCursor, (XtPointer) &amp;val,
<a id='L15922' name='L15922'></a> 15922 <em class='sharp'>#ifdef</em> XtNarrowScrollbars
<a id='L15923' name='L15923'></a> 15923                    XtNarrowScrollbars, (XtPointer) &amp;xaw3d_arrow_scroll,
<a id='L15924' name='L15924'></a> 15924 <em class='sharp'>#endif</em>
<a id='L15925' name='L15925'></a> 15925                    <a href='../S/2289.html#L767' title='Defined at 767 in src/xterm.c.'>XtNpickTop</a>, (XtPointer) &amp;xaw3d_pick_top, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L15926' name='L15926'></a> 15926     <strong class='reserved'>if</strong> (xaw3d_arrow_scroll || val == initial)
<a id='L15927' name='L15927'></a> 15927       <em class='brace'>{</em> <em class='comment'>/* ARROW_SCROLL */</em>
<a id='L15928' name='L15928'></a> 15928         xaw3d_arrow_scroll = True;
<a id='L15929' name='L15929'></a> 15929         <em class='comment'>/* Isn't that just a personal preference ?   --Stef */</em>
<a id='L15930' name='L15930'></a> 15930         XtVaSetValues (widget, XtNcursorName, "top_left_arrow", <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L15931' name='L15931'></a> 15931       <em class='brace'>}</em>
<a id='L15932' name='L15932'></a> 15932   <em class='brace'>}</em>
<a id='L15933' name='L15933'></a> 15933 
<a id='L15934' name='L15934'></a> 15934   <em class='comment'>/* Define callbacks.  */</em>
<a id='L15935' name='L15935'></a> 15935   XtAddCallback (widget, XtNjumpProc, xaw_jump_callback, (XtPointer) <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L15936' name='L15936'></a> 15936   XtAddCallback (widget, XtNscrollProc, xaw_scroll_callback,
<a id='L15937' name='L15937'></a> 15937                  (XtPointer) <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L15938' name='L15938'></a> 15938 
<a id='L15939' name='L15939'></a> 15939   <em class='comment'>/* Realize the widget.  Only after that is the X window created.  */</em>
<a id='L15940' name='L15940'></a> 15940   XtRealizeWidget (widget);
<a id='L15941' name='L15941'></a> 15941 
<a id='L15942' name='L15942'></a> 15942 <em class='sharp'>#endif</em> <em class='comment'>/* !USE_MOTIF */</em>
<a id='L15943' name='L15943'></a> 15943 
<a id='L15944' name='L15944'></a> 15944   <em class='comment'>/* Install an action hook that lets us detect when the user</em>
<a id='L15945' name='L15945'></a> 15945 <em class='comment'>     finishes interacting with a scroll bar.  */</em>
<a id='L15946' name='L15946'></a> 15946   <strong class='reserved'>if</strong> (action_hook_id == 0)
<a id='L15947' name='L15947'></a> 15947     action_hook_id = XtAppAddActionHook (Xt_app_con, xt_action_hook, 0);
<a id='L15948' name='L15948'></a> 15948 
<a id='L15949' name='L15949'></a> 15949   <em class='comment'>/* Remember X window and widget in the scroll bar vector.  */</em>
<a id='L15950' name='L15950'></a> 15950   <a href='../S/2212.html#L1559' title='Defined at 1559 in src/xterm.h.'>SET_SCROLL_BAR_X_WIDGET</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>, widget);
<a id='L15951' name='L15951'></a> 15951   xwindow = XtWindow (widget);
<a id='L15952' name='L15952'></a> 15952   <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../D/19737.html' title='Multiple defined in 3 places.'>x_window</a> = xwindow;
<a id='L15953' name='L15953'></a> 15953   <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;whole = 1;
<a id='L15954' name='L15954'></a> 15954   <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;horizontal = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L15955' name='L15955'></a> 15955 
<a id='L15956' name='L15956'></a> 15956   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L15957' name='L15957'></a> 15957 <em class='brace'>}</em>
<a id='L15958' name='L15958'></a> 15958 
<a id='L15959' name='L15959'></a> 15959 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L15960' name='L15960'></a> 15960 x_create_horizontal_toolkit_scroll_bar (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>)
<a id='L15961' name='L15961'></a> 15961 <em class='brace'>{</em>
<a id='L15962' name='L15962'></a> 15962   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> xwindow;
<a id='L15963' name='L15963'></a> 15963   Widget widget;
<a id='L15964' name='L15964'></a> 15964   Arg av[20];
<a id='L15965' name='L15965'></a> 15965   <strong class='reserved'>int</strong> ac = 0;
<a id='L15966' name='L15966'></a> 15966   <strong class='reserved'>const</strong> <strong class='reserved'>char</strong> *scroll_bar_name = <a href='../D/5523.html' title='Multiple defined in 2 places.'>SCROLL_BAR_HORIZONTAL_NAME</a>;
<a id='L15967' name='L15967'></a> 15967   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> pixel;
<a id='L15968' name='L15968'></a> 15968 
<a id='L15969' name='L15969'></a> 15969   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L15970' name='L15970'></a> 15970 
<a id='L15971' name='L15971'></a> 15971 <em class='sharp'>#ifdef</em> USE_MOTIF
<a id='L15972' name='L15972'></a> 15972   <em class='comment'>/* Set resources.  Create the widget.  */</em>
<a id='L15973' name='L15973'></a> 15973   XtSetArg (av[ac], XtNmappedWhenManaged, False); ++ac;
<a id='L15974' name='L15974'></a> 15974   XtSetArg (av[ac], XmNminimum, 0); ++ac;
<a id='L15975' name='L15975'></a> 15975   XtSetArg (av[ac], XmNmaximum, <a href='../S/2289.html#L15385' title='Defined at 15385 in src/xterm.c.'>XM_SB_MAX</a>); ++ac;
<a id='L15976' name='L15976'></a> 15976   XtSetArg (av[ac], XmNorientation, XmHORIZONTAL); ++ac;
<a id='L15977' name='L15977'></a> 15977   XtSetArg (av[ac], XmNprocessingDirection, XmMAX_ON_RIGHT), ++ac;
<a id='L15978' name='L15978'></a> 15978   XtSetArg (av[ac], XmNincrement, 1); ++ac;
<a id='L15979' name='L15979'></a> 15979   XtSetArg (av[ac], XmNpageIncrement, 1); ++ac;
<a id='L15980' name='L15980'></a> 15980 
<a id='L15981' name='L15981'></a> 15981   <em class='comment'>/* Note: "background" is the thumb color, and "trough" is the color behind</em>
<a id='L15982' name='L15982'></a> 15982 <em class='comment'>     everything. */</em>
<a id='L15983' name='L15983'></a> 15983   pixel = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_foreground_pixel;
<a id='L15984' name='L15984'></a> 15984   <strong class='reserved'>if</strong> (pixel != -1)
<a id='L15985' name='L15985'></a> 15985     <em class='brace'>{</em>
<a id='L15986' name='L15986'></a> 15986       XtSetArg (av[ac], XmNbackground, pixel);
<a id='L15987' name='L15987'></a> 15987       ++ac;
<a id='L15988' name='L15988'></a> 15988     <em class='brace'>}</em>
<a id='L15989' name='L15989'></a> 15989 
<a id='L15990' name='L15990'></a> 15990   pixel = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_background_pixel;
<a id='L15991' name='L15991'></a> 15991   <strong class='reserved'>if</strong> (pixel != -1)
<a id='L15992' name='L15992'></a> 15992     <em class='brace'>{</em>
<a id='L15993' name='L15993'></a> 15993       XtSetArg (av[ac], XmNtroughColor, pixel);
<a id='L15994' name='L15994'></a> 15994       ++ac;
<a id='L15995' name='L15995'></a> 15995     <em class='brace'>}</em>
<a id='L15996' name='L15996'></a> 15996 
<a id='L15997' name='L15997'></a> 15997   widget = XmCreateScrollBar (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;edit_widget,
<a id='L15998' name='L15998'></a> 15998                               (<strong class='reserved'>char</strong> *) scroll_bar_name, av, ac);
<a id='L15999' name='L15999'></a> 15999 
<a id='L16000' name='L16000'></a> 16000   <em class='comment'>/* Add one callback for everything that can happen.  */</em>
<a id='L16001' name='L16001'></a> 16001   XtAddCallback (widget, XmNdecrementCallback, xm_scroll_callback,
<a id='L16002' name='L16002'></a> 16002                  (XtPointer) <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L16003' name='L16003'></a> 16003   XtAddCallback (widget, XmNdragCallback, xm_scroll_callback,
<a id='L16004' name='L16004'></a> 16004                  (XtPointer) <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L16005' name='L16005'></a> 16005   XtAddCallback (widget, XmNincrementCallback, xm_scroll_callback,
<a id='L16006' name='L16006'></a> 16006                  (XtPointer) <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L16007' name='L16007'></a> 16007   XtAddCallback (widget, XmNpageDecrementCallback, xm_scroll_callback,
<a id='L16008' name='L16008'></a> 16008                  (XtPointer) <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L16009' name='L16009'></a> 16009   XtAddCallback (widget, XmNpageIncrementCallback, xm_scroll_callback,
<a id='L16010' name='L16010'></a> 16010                  (XtPointer) <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L16011' name='L16011'></a> 16011   XtAddCallback (widget, XmNtoBottomCallback, xm_scroll_callback,
<a id='L16012' name='L16012'></a> 16012                  (XtPointer) <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L16013' name='L16013'></a> 16013   XtAddCallback (widget, XmNtoTopCallback, xm_scroll_callback,
<a id='L16014' name='L16014'></a> 16014                  (XtPointer) <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L16015' name='L16015'></a> 16015 
<a id='L16016' name='L16016'></a> 16016   <em class='comment'>/* Realize the widget.  Only after that is the X window created.  */</em>
<a id='L16017' name='L16017'></a> 16017   XtRealizeWidget (widget);
<a id='L16018' name='L16018'></a> 16018 
<a id='L16019' name='L16019'></a> 16019   <em class='comment'>/* Set the cursor to an arrow.  I didn't find a resource to do that.</em>
<a id='L16020' name='L16020'></a> 16020 <em class='comment'>     And I'm wondering why it hasn't an arrow cursor by default.  */</em>
<a id='L16021' name='L16021'></a> 16021   XDefineCursor (XtDisplay (widget), XtWindow (widget),
<a id='L16022' name='L16022'></a> 16022                  <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;nontext_cursor);
<a id='L16023' name='L16023'></a> 16023 
<a id='L16024' name='L16024'></a> 16024 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L16025' name='L16025'></a> 16025   <em class='comment'>/* Ask for input extension button and motion events.  This lets us</em>
<a id='L16026' name='L16026'></a> 16026 <em class='comment'>     send the proper `wheel-up' or `wheel-down' events to Emacs.  */</em>
<a id='L16027' name='L16027'></a> 16027   <strong class='reserved'>if</strong> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;supports_xi2)
<a id='L16028' name='L16028'></a> 16028     xi_select_scroll_bar_events (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L16029' name='L16029'></a> 16029                                  XtWindow (widget));
<a id='L16030' name='L16030'></a> 16030 <em class='sharp'>#endif</em>
<a id='L16031' name='L16031'></a> 16031 <em class='sharp'>#else</em> <em class='comment'>/* !USE_MOTIF i.e. use Xaw */</em>
<a id='L16032' name='L16032'></a> 16032 
<a id='L16033' name='L16033'></a> 16033   <em class='comment'>/* Set resources.  Create the widget.  The background of the</em>
<a id='L16034' name='L16034'></a> 16034 <em class='comment'>     Xaw3d scroll bar widget is a little bit light for my taste.</em>
<a id='L16035' name='L16035'></a> 16035 <em class='comment'>     We don't alter it here to let users change it according</em>
<a id='L16036' name='L16036'></a> 16036 <em class='comment'>     to their taste with `emacs*verticalScrollBar.background: xxx'.  */</em>
<a id='L16037' name='L16037'></a> 16037   XtSetArg (av[ac], XtNmappedWhenManaged, False); ++ac;
<a id='L16038' name='L16038'></a> 16038   XtSetArg (av[ac], XtNorientation, XtorientHorizontal); ++ac;
<a id='L16039' name='L16039'></a> 16039   <em class='comment'>/* For smoother scrolling with Xaw3d   -sm */</em>
<a id='L16040' name='L16040'></a> 16040   <em class='comment'>/* XtSetArg (av[ac], XtNpickTop, True); ++ac; */</em>
<a id='L16041' name='L16041'></a> 16041 
<a id='L16042' name='L16042'></a> 16042   pixel = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_foreground_pixel;
<a id='L16043' name='L16043'></a> 16043   <strong class='reserved'>if</strong> (pixel != -1)
<a id='L16044' name='L16044'></a> 16044     <em class='brace'>{</em>
<a id='L16045' name='L16045'></a> 16045       XtSetArg (av[ac], <a href='../S/2111.html#L42' title='Defined at 42 in src/widget.h.'>XtNforeground</a>, pixel);
<a id='L16046' name='L16046'></a> 16046       ++ac;
<a id='L16047' name='L16047'></a> 16047     <em class='brace'>}</em>
<a id='L16048' name='L16048'></a> 16048 
<a id='L16049' name='L16049'></a> 16049   pixel = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_background_pixel;
<a id='L16050' name='L16050'></a> 16050   <strong class='reserved'>if</strong> (pixel != -1)
<a id='L16051' name='L16051'></a> 16051     <em class='brace'>{</em>
<a id='L16052' name='L16052'></a> 16052       XtSetArg (av[ac], XtNbackground, pixel);
<a id='L16053' name='L16053'></a> 16053       ++ac;
<a id='L16054' name='L16054'></a> 16054     <em class='brace'>}</em>
<a id='L16055' name='L16055'></a> 16055 
<a id='L16056' name='L16056'></a> 16056   <em class='comment'>/* Top/bottom shadow colors.  */</em>
<a id='L16057' name='L16057'></a> 16057 
<a id='L16058' name='L16058'></a> 16058   <em class='comment'>/* Allocate them, if necessary.  */</em>
<a id='L16059' name='L16059'></a> 16059   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_top_shadow_pixel == -1)
<a id='L16060' name='L16060'></a> 16060     <em class='brace'>{</em>
<a id='L16061' name='L16061'></a> 16061       pixel = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_background_pixel;
<a id='L16062' name='L16062'></a> 16062       <strong class='reserved'>if</strong> (pixel != -1)
<a id='L16063' name='L16063'></a> 16063         <em class='brace'>{</em>
<a id='L16064' name='L16064'></a> 16064           <strong class='reserved'>if</strong> (!<a href='../S/2289.html#L9430' title='Defined at 9430 in src/xterm.c.'>x_alloc_lighter_color</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L16065' name='L16065'></a> 16065                                       <a href='../S/2212.html#L1468' title='Defined at 1468 in src/xterm.h.'>FRAME_X_COLORMAP</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L16066' name='L16066'></a> 16066                                       &amp;pixel, 1.2, 0x8000))
<a id='L16067' name='L16067'></a> 16067             pixel = -1;
<a id='L16068' name='L16068'></a> 16068           <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_top_shadow_pixel = pixel;
<a id='L16069' name='L16069'></a> 16069         <em class='brace'>}</em>
<a id='L16070' name='L16070'></a> 16070     <em class='brace'>}</em>
<a id='L16071' name='L16071'></a> 16071   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_bottom_shadow_pixel == -1)
<a id='L16072' name='L16072'></a> 16072     <em class='brace'>{</em>
<a id='L16073' name='L16073'></a> 16073       pixel = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_background_pixel;
<a id='L16074' name='L16074'></a> 16074       <strong class='reserved'>if</strong> (pixel != -1)
<a id='L16075' name='L16075'></a> 16075         <em class='brace'>{</em>
<a id='L16076' name='L16076'></a> 16076           <strong class='reserved'>if</strong> (!<a href='../S/2289.html#L9430' title='Defined at 9430 in src/xterm.c.'>x_alloc_lighter_color</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L16077' name='L16077'></a> 16077                                       <a href='../S/2212.html#L1468' title='Defined at 1468 in src/xterm.h.'>FRAME_X_COLORMAP</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L16078' name='L16078'></a> 16078                                       &amp;pixel, 0.6, 0x4000))
<a id='L16079' name='L16079'></a> 16079             pixel = -1;
<a id='L16080' name='L16080'></a> 16080           <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_bottom_shadow_pixel = pixel;
<a id='L16081' name='L16081'></a> 16081         <em class='brace'>}</em>
<a id='L16082' name='L16082'></a> 16082     <em class='brace'>}</em>
<a id='L16083' name='L16083'></a> 16083 
<a id='L16084' name='L16084'></a> 16084 <em class='sharp'>#ifdef</em> XtNbeNiceToColormap
<a id='L16085' name='L16085'></a> 16085   <em class='comment'>/* Tell the toolkit about them.  */</em>
<a id='L16086' name='L16086'></a> 16086   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_top_shadow_pixel == -1
<a id='L16087' name='L16087'></a> 16087       || <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_bottom_shadow_pixel == -1)
<a id='L16088' name='L16088'></a> 16088     <em class='comment'>/* We tried to allocate a color for the top/bottom shadow, and</em>
<a id='L16089' name='L16089'></a> 16089 <em class='comment'>       failed, so tell Xaw3d to use dithering instead.   */</em>
<a id='L16090' name='L16090'></a> 16090     <em class='comment'>/* But only if we have a small colormap.  Xaw3d can allocate nice</em>
<a id='L16091' name='L16091'></a> 16091 <em class='comment'>       colors itself.  */</em>
<a id='L16092' name='L16092'></a> 16092     <em class='brace'>{</em>
<a id='L16093' name='L16093'></a> 16093       XtSetArg (av[ac], (String) XtNbeNiceToColormap,
<a id='L16094' name='L16094'></a> 16094                 DefaultDepthOfScreen (<a href='../S/2212.html#L1428' title='Defined at 1428 in src/xterm.h.'>FRAME_X_SCREEN</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)) &lt; 16);
<a id='L16095' name='L16095'></a> 16095       ++ac;
<a id='L16096' name='L16096'></a> 16096     <em class='brace'>}</em>
<a id='L16097' name='L16097'></a> 16097   <strong class='reserved'>else</strong>
<a id='L16098' name='L16098'></a> 16098     <em class='comment'>/* Tell what colors Xaw3d should use for the top/bottom shadow, to</em>
<a id='L16099' name='L16099'></a> 16099 <em class='comment'>       be more consistent with other emacs 3d colors, and since Xaw3d is</em>
<a id='L16100' name='L16100'></a> 16100 <em class='comment'>       not good at dealing with allocation failure.  */</em>
<a id='L16101' name='L16101'></a> 16101     <em class='brace'>{</em>
<a id='L16102' name='L16102'></a> 16102       <em class='comment'>/* This tells Xaw3d to use real colors instead of dithering for</em>
<a id='L16103' name='L16103'></a> 16103 <em class='comment'>         the shadows.  */</em>
<a id='L16104' name='L16104'></a> 16104       XtSetArg (av[ac], (String) XtNbeNiceToColormap, False);
<a id='L16105' name='L16105'></a> 16105       ++ac;
<a id='L16106' name='L16106'></a> 16106 
<a id='L16107' name='L16107'></a> 16107       <em class='comment'>/* Specify the colors.  */</em>
<a id='L16108' name='L16108'></a> 16108       pixel = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_top_shadow_pixel;
<a id='L16109' name='L16109'></a> 16109       <strong class='reserved'>if</strong> (pixel != -1)
<a id='L16110' name='L16110'></a> 16110         <em class='brace'>{</em>
<a id='L16111' name='L16111'></a> 16111           XtSetArg (av[ac], (String) XtNtopShadowPixel, pixel);
<a id='L16112' name='L16112'></a> 16112           ++ac;
<a id='L16113' name='L16113'></a> 16113         <em class='brace'>}</em>
<a id='L16114' name='L16114'></a> 16114       pixel = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_bottom_shadow_pixel;
<a id='L16115' name='L16115'></a> 16115       <strong class='reserved'>if</strong> (pixel != -1)
<a id='L16116' name='L16116'></a> 16116         <em class='brace'>{</em>
<a id='L16117' name='L16117'></a> 16117           XtSetArg (av[ac], (String) XtNbottomShadowPixel, pixel);
<a id='L16118' name='L16118'></a> 16118           ++ac;
<a id='L16119' name='L16119'></a> 16119         <em class='brace'>}</em>
<a id='L16120' name='L16120'></a> 16120     <em class='brace'>}</em>
<a id='L16121' name='L16121'></a> 16121 <em class='sharp'>#endif</em>
<a id='L16122' name='L16122'></a> 16122 
<a id='L16123' name='L16123'></a> 16123   widget = XtCreateWidget (scroll_bar_name, scrollbarWidgetClass,
<a id='L16124' name='L16124'></a> 16124                            <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;edit_widget, av, ac);
<a id='L16125' name='L16125'></a> 16125 
<a id='L16126' name='L16126'></a> 16126   <em class='brace'>{</em>
<a id='L16127' name='L16127'></a> 16127     <strong class='reserved'>char</strong> <strong class='reserved'>const</strong> *initial = "";
<a id='L16128' name='L16128'></a> 16128     <strong class='reserved'>char</strong> <strong class='reserved'>const</strong> *val = initial;
<a id='L16129' name='L16129'></a> 16129     XtVaGetValues (widget, XtNscrollVCursor, (XtPointer) &amp;val,
<a id='L16130' name='L16130'></a> 16130 <em class='sharp'>#ifdef</em> XtNarrowScrollbars
<a id='L16131' name='L16131'></a> 16131                    XtNarrowScrollbars, (XtPointer) &amp;xaw3d_arrow_scroll,
<a id='L16132' name='L16132'></a> 16132 <em class='sharp'>#endif</em>
<a id='L16133' name='L16133'></a> 16133                    <a href='../S/2289.html#L767' title='Defined at 767 in src/xterm.c.'>XtNpickTop</a>, (XtPointer) &amp;xaw3d_pick_top, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L16134' name='L16134'></a> 16134     <strong class='reserved'>if</strong> (xaw3d_arrow_scroll || val == initial)
<a id='L16135' name='L16135'></a> 16135       <em class='brace'>{</em> <em class='comment'>/* ARROW_SCROLL */</em>
<a id='L16136' name='L16136'></a> 16136         xaw3d_arrow_scroll = True;
<a id='L16137' name='L16137'></a> 16137         <em class='comment'>/* Isn't that just a personal preference ?   --Stef */</em>
<a id='L16138' name='L16138'></a> 16138         XtVaSetValues (widget, XtNcursorName, "top_left_arrow", <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L16139' name='L16139'></a> 16139       <em class='brace'>}</em>
<a id='L16140' name='L16140'></a> 16140   <em class='brace'>}</em>
<a id='L16141' name='L16141'></a> 16141 
<a id='L16142' name='L16142'></a> 16142   <em class='comment'>/* Define callbacks.  */</em>
<a id='L16143' name='L16143'></a> 16143   XtAddCallback (widget, XtNjumpProc, xaw_jump_callback, (XtPointer) <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L16144' name='L16144'></a> 16144   XtAddCallback (widget, XtNscrollProc, xaw_scroll_callback,
<a id='L16145' name='L16145'></a> 16145                  (XtPointer) <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L16146' name='L16146'></a> 16146 
<a id='L16147' name='L16147'></a> 16147   <em class='comment'>/* Realize the widget.  Only after that is the X window created.  */</em>
<a id='L16148' name='L16148'></a> 16148   XtRealizeWidget (widget);
<a id='L16149' name='L16149'></a> 16149 
<a id='L16150' name='L16150'></a> 16150 <em class='sharp'>#endif</em> <em class='comment'>/* !USE_MOTIF */</em>
<a id='L16151' name='L16151'></a> 16151 
<a id='L16152' name='L16152'></a> 16152   <em class='comment'>/* Install an action hook that lets us detect when the user</em>
<a id='L16153' name='L16153'></a> 16153 <em class='comment'>     finishes interacting with a scroll bar.  */</em>
<a id='L16154' name='L16154'></a> 16154   <strong class='reserved'>if</strong> (horizontal_action_hook_id == 0)
<a id='L16155' name='L16155'></a> 16155    horizontal_action_hook_id
<a id='L16156' name='L16156'></a> 16156      = XtAppAddActionHook (Xt_app_con, xt_horizontal_action_hook, 0);
<a id='L16157' name='L16157'></a> 16157 
<a id='L16158' name='L16158'></a> 16158   <em class='comment'>/* Remember X window and widget in the scroll bar vector.  */</em>
<a id='L16159' name='L16159'></a> 16159   <a href='../S/2212.html#L1559' title='Defined at 1559 in src/xterm.h.'>SET_SCROLL_BAR_X_WIDGET</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>, widget);
<a id='L16160' name='L16160'></a> 16160   xwindow = XtWindow (widget);
<a id='L16161' name='L16161'></a> 16161   <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../D/19737.html' title='Multiple defined in 3 places.'>x_window</a> = xwindow;
<a id='L16162' name='L16162'></a> 16162   <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;whole = 1;
<a id='L16163' name='L16163'></a> 16163   <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;horizontal = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L16164' name='L16164'></a> 16164 
<a id='L16165' name='L16165'></a> 16165   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L16166' name='L16166'></a> 16166 <em class='brace'>}</em>
<a id='L16167' name='L16167'></a> 16167 <em class='sharp'>#endif</em> <em class='comment'>/* not USE_GTK */</em>
<a id='L16168' name='L16168'></a> 16168 
<a id='L16169' name='L16169'></a> 16169 
<a id='L16170' name='L16170'></a> 16170 <em class='comment'>/* Set the thumb size and position of scroll bar BAR.  We are currently</em>
<a id='L16171' name='L16171'></a> 16171 <em class='comment'>   displaying PORTION out of a whole WHOLE, and our position POSITION.  */</em>
<a id='L16172' name='L16172'></a> 16172 
<a id='L16173' name='L16173'></a> 16173 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L16174' name='L16174'></a> 16174 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L16175' name='L16175'></a> 16175 x_set_toolkit_scroll_bar_thumb (<strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>, <strong class='reserved'>int</strong> portion, <strong class='reserved'>int</strong> <a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a>, <strong class='reserved'>int</strong> whole)
<a id='L16176' name='L16176'></a> 16176 <em class='brace'>{</em>
<a id='L16177' name='L16177'></a> 16177   <a href='../S/2362.html#L4920' title='Defined at 4920 in src/gtkutil.c.'>xg_set_toolkit_scroll_bar_thumb</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>, portion, <a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a>, whole);
<a id='L16178' name='L16178'></a> 16178 <em class='brace'>}</em>
<a id='L16179' name='L16179'></a> 16179 
<a id='L16180' name='L16180'></a> 16180 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L16181' name='L16181'></a> 16181 x_set_toolkit_horizontal_scroll_bar_thumb (<strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>, <strong class='reserved'>int</strong> portion, <strong class='reserved'>int</strong> <a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a>, <strong class='reserved'>int</strong> whole)
<a id='L16182' name='L16182'></a> 16182 <em class='brace'>{</em>
<a id='L16183' name='L16183'></a> 16183   <a href='../S/2362.html#L5008' title='Defined at 5008 in src/gtkutil.c.'>xg_set_toolkit_horizontal_scroll_bar_thumb</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>, portion, <a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a>, whole);
<a id='L16184' name='L16184'></a> 16184 <em class='brace'>}</em>
<a id='L16185' name='L16185'></a> 16185 
<a id='L16186' name='L16186'></a> 16186 <em class='sharp'>#else</em> <em class='comment'>/* not USE_GTK */</em>
<a id='L16187' name='L16187'></a> 16187 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L16188' name='L16188'></a> 16188 x_set_toolkit_scroll_bar_thumb (<strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>, <strong class='reserved'>int</strong> portion, <strong class='reserved'>int</strong> <a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a>,
<a id='L16189' name='L16189'></a> 16189                                 <strong class='reserved'>int</strong> whole)
<a id='L16190' name='L16190'></a> 16190 <em class='brace'>{</em>
<a id='L16191' name='L16191'></a> 16191   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../S/2183.html#L914' title='Defined at 914 in src/frame.h.'>WINDOW_FRAME</a> (<a href='../D/7409.html' title='Multiple defined in 2 places.'>XWINDOW</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>)));
<a id='L16192' name='L16192'></a> 16192   Widget widget = <a href='../S/2212.html#L1554' title='Defined at 1554 in src/xterm.h.'>SCROLL_BAR_X_WIDGET</a> (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L16193' name='L16193'></a> 16193   <strong class='reserved'>float</strong> top, shown;
<a id='L16194' name='L16194'></a> 16194 
<a id='L16195' name='L16195'></a> 16195   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L16196' name='L16196'></a> 16196 
<a id='L16197' name='L16197'></a> 16197 <em class='sharp'>#ifdef</em> USE_MOTIF
<a id='L16198' name='L16198'></a> 16198 
<a id='L16199' name='L16199'></a> 16199   <strong class='reserved'>if</strong> (scroll_bar_adjust_thumb_portion_p)
<a id='L16200' name='L16200'></a> 16200     <em class='brace'>{</em>
<a id='L16201' name='L16201'></a> 16201       <em class='comment'>/* We use an estimate of 30 chars per line rather than the real</em>
<a id='L16202' name='L16202'></a> 16202 <em class='comment'>         `portion' value.  This has the disadvantage that the thumb size</em>
<a id='L16203' name='L16203'></a> 16203 <em class='comment'>         is not very representative, but it makes our life a lot easier.</em>
<a id='L16204' name='L16204'></a> 16204 <em class='comment'>         Otherwise, we have to constantly adjust the thumb size, which</em>
<a id='L16205' name='L16205'></a> 16205 <em class='comment'>         we can't always do quickly enough: while dragging, the size of</em>
<a id='L16206' name='L16206'></a> 16206 <em class='comment'>         the thumb might prevent the user from dragging the thumb all the</em>
<a id='L16207' name='L16207'></a> 16207 <em class='comment'>         way to the end.  but Motif and some versions of Xaw3d don't allow</em>
<a id='L16208' name='L16208'></a> 16208 <em class='comment'>         updating the thumb size while dragging.  Also, even if we can update</em>
<a id='L16209' name='L16209'></a> 16209 <em class='comment'>         its size, the update will often happen too late.</em>
<a id='L16210' name='L16210'></a> 16210 <em class='comment'>         If you don't believe it, check out revision 1.650 of xterm.c to see</em>
<a id='L16211' name='L16211'></a> 16211 <em class='comment'>         what hoops we were going through and the still poor behavior we got.  */</em>
<a id='L16212' name='L16212'></a> 16212       portion = <a href='../S/2317.html#L657' title='Defined at 657 in src/window.h.'>WINDOW_TOTAL_LINES</a> (<a href='../D/7409.html' title='Multiple defined in 2 places.'>XWINDOW</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>)) * 30;
<a id='L16213' name='L16213'></a> 16213       <em class='comment'>/* When the thumb is at the bottom, position == whole.</em>
<a id='L16214' name='L16214'></a> 16214 <em class='comment'>         So we need to increase `whole' to make space for the thumb.  */</em>
<a id='L16215' name='L16215'></a> 16215       whole += portion;
<a id='L16216' name='L16216'></a> 16216     <em class='brace'>}</em>
<a id='L16217' name='L16217'></a> 16217 
<a id='L16218' name='L16218'></a> 16218   <strong class='reserved'>if</strong> (whole &lt;= 0)
<a id='L16219' name='L16219'></a> 16219     top = 0, shown = 1;
<a id='L16220' name='L16220'></a> 16220   <strong class='reserved'>else</strong>
<a id='L16221' name='L16221'></a> 16221     <em class='brace'>{</em>
<a id='L16222' name='L16222'></a> 16222       top = (<strong class='reserved'>float</strong>) <a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a> / whole;
<a id='L16223' name='L16223'></a> 16223       shown = (<strong class='reserved'>float</strong>) portion / whole;
<a id='L16224' name='L16224'></a> 16224     <em class='brace'>}</em>
<a id='L16225' name='L16225'></a> 16225 
<a id='L16226' name='L16226'></a> 16226   <strong class='reserved'>if</strong> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging == -1)
<a id='L16227' name='L16227'></a> 16227     <em class='brace'>{</em>
<a id='L16228' name='L16228'></a> 16228       <strong class='reserved'>int</strong> <a href='../D/17482.html' title='Multiple defined in 5 places.'>size</a>, <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>;
<a id='L16229' name='L16229'></a> 16229 
<a id='L16230' name='L16230'></a> 16230       <em class='comment'>/* Slider size.  Must be in the range [1 .. MAX - MIN] where MAX</em>
<a id='L16231' name='L16231'></a> 16231 <em class='comment'>         is the scroll bar's maximum and MIN is the scroll bar's minimum</em>
<a id='L16232' name='L16232'></a> 16232 <em class='comment'>         value.  */</em>
<a id='L16233' name='L16233'></a> 16233       <a href='../D/17482.html' title='Multiple defined in 5 places.'>size</a> = <a href='../D/9788.html' title='Multiple defined in 2 places.'>clip_to_bounds</a> (1, shown * <a href='../S/2289.html#L15385' title='Defined at 15385 in src/xterm.c.'>XM_SB_MAX</a>, <a href='../S/2289.html#L15385' title='Defined at 15385 in src/xterm.c.'>XM_SB_MAX</a>);
<a id='L16234' name='L16234'></a> 16234 
<a id='L16235' name='L16235'></a> 16235       <em class='comment'>/* Position.  Must be in the range [MIN .. MAX - SLIDER_SIZE].  */</em>
<a id='L16236' name='L16236'></a> 16236       <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a> = top * <a href='../S/2289.html#L15385' title='Defined at 15385 in src/xterm.c.'>XM_SB_MAX</a>;
<a id='L16237' name='L16237'></a> 16237       <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a> = <a href='../D/14475.html' title='Multiple defined in 11 places.'>min</a> (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>, <a href='../S/2289.html#L15385' title='Defined at 15385 in src/xterm.c.'>XM_SB_MAX</a> - <a href='../D/17482.html' title='Multiple defined in 5 places.'>size</a>);
<a id='L16238' name='L16238'></a> 16238 
<a id='L16239' name='L16239'></a> 16239       XmScrollBarSetValues (widget, <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>, <a href='../D/17482.html' title='Multiple defined in 5 places.'>size</a>, 0, 0, False);
<a id='L16240' name='L16240'></a> 16240     <em class='brace'>}</em>
<a id='L16241' name='L16241'></a> 16241 <em class='sharp'>#else</em> <em class='comment'>/* !USE_MOTIF i.e. use Xaw */</em>
<a id='L16242' name='L16242'></a> 16242 
<a id='L16243' name='L16243'></a> 16243   <strong class='reserved'>if</strong> (whole == 0)
<a id='L16244' name='L16244'></a> 16244     top = 0, shown = 1;
<a id='L16245' name='L16245'></a> 16245   <strong class='reserved'>else</strong>
<a id='L16246' name='L16246'></a> 16246     <em class='brace'>{</em>
<a id='L16247' name='L16247'></a> 16247       top = (<strong class='reserved'>float</strong>) <a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a> / whole;
<a id='L16248' name='L16248'></a> 16248       shown = (<strong class='reserved'>float</strong>) portion / whole;
<a id='L16249' name='L16249'></a> 16249     <em class='brace'>}</em>
<a id='L16250' name='L16250'></a> 16250 
<a id='L16251' name='L16251'></a> 16251   <em class='brace'>{</em>
<a id='L16252' name='L16252'></a> 16252     <strong class='reserved'>float</strong> old_top, old_shown;
<a id='L16253' name='L16253'></a> 16253     Dimension height;
<a id='L16254' name='L16254'></a> 16254     XtVaGetValues (widget,
<a id='L16255' name='L16255'></a> 16255                    XtNtopOfThumb, &amp;old_top,
<a id='L16256' name='L16256'></a> 16256                    XtNshown, &amp;old_shown,
<a id='L16257' name='L16257'></a> 16257                    XtNheight, &amp;height,
<a id='L16258' name='L16258'></a> 16258                    <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L16259' name='L16259'></a> 16259 
<a id='L16260' name='L16260'></a> 16260     <em class='comment'>/* Massage the top+shown values.  */</em>
<a id='L16261' name='L16261'></a> 16261     <strong class='reserved'>if</strong> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging == -1 || <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;last_seen_part == <a href='../S/2231.html#L41' title='Defined at 41 in src/termhooks.h.'>scroll_bar_down_arrow</a>)
<a id='L16262' name='L16262'></a> 16262       top = <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> (0, <a href='../D/14475.html' title='Multiple defined in 11 places.'>min</a> (1, top));
<a id='L16263' name='L16263'></a> 16263     <strong class='reserved'>else</strong>
<a id='L16264' name='L16264'></a> 16264       top = old_top;
<a id='L16265' name='L16265'></a> 16265 <em class='sharp'>#if</em> ! <strong class='reserved'>defined</strong> (HAVE_XAW3D)
<a id='L16266' name='L16266'></a> 16266     <em class='comment'>/* With Xaw, 'top' values too closer to 1.0 may</em>
<a id='L16267' name='L16267'></a> 16267 <em class='comment'>       cause the thumb to disappear.  Fix that.  */</em>
<a id='L16268' name='L16268'></a> 16268     top = <a href='../D/14475.html' title='Multiple defined in 11 places.'>min</a> (top, 0.99f);
<a id='L16269' name='L16269'></a> 16269 <em class='sharp'>#endif</em>
<a id='L16270' name='L16270'></a> 16270     <em class='comment'>/* Keep two pixels available for moving the thumb down.  */</em>
<a id='L16271' name='L16271'></a> 16271     shown = <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> (0, <a href='../D/14475.html' title='Multiple defined in 11 places.'>min</a> (1 - top - (2.0f / height), shown));
<a id='L16272' name='L16272'></a> 16272 <em class='sharp'>#if</em> ! <strong class='reserved'>defined</strong> (HAVE_XAW3D)
<a id='L16273' name='L16273'></a> 16273     <em class='comment'>/* Likewise with too small 'shown'.  */</em>
<a id='L16274' name='L16274'></a> 16274     shown = <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> (shown, 0.01f);
<a id='L16275' name='L16275'></a> 16275 <em class='sharp'>#endif</em>
<a id='L16276' name='L16276'></a> 16276 
<a id='L16277' name='L16277'></a> 16277     <em class='comment'>/* If the call to XawScrollbarSetThumb below doesn't seem to</em>
<a id='L16278' name='L16278'></a> 16278 <em class='comment'>       work, check that 'NARROWPROTO' is defined in src/config.h.</em>
<a id='L16279' name='L16279'></a> 16279 <em class='comment'>       If this is not so, most likely you need to fix configure.  */</em>
<a id='L16280' name='L16280'></a> 16280     <strong class='reserved'>if</strong> (top != old_top || shown != old_shown)
<a id='L16281' name='L16281'></a> 16281       <em class='brace'>{</em>
<a id='L16282' name='L16282'></a> 16282         <strong class='reserved'>if</strong> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging == -1)
<a id='L16283' name='L16283'></a> 16283           XawScrollbarSetThumb (widget, top, shown);
<a id='L16284' name='L16284'></a> 16284         <strong class='reserved'>else</strong>
<a id='L16285' name='L16285'></a> 16285           <em class='brace'>{</em>
<a id='L16286' name='L16286'></a> 16286             <em class='comment'>/* Try to make the scrolling a tad smoother.  */</em>
<a id='L16287' name='L16287'></a> 16287             <strong class='reserved'>if</strong> (!xaw3d_pick_top)
<a id='L16288' name='L16288'></a> 16288               shown = <a href='../D/14475.html' title='Multiple defined in 11 places.'>min</a> (shown, old_shown);
<a id='L16289' name='L16289'></a> 16289 
<a id='L16290' name='L16290'></a> 16290             XawScrollbarSetThumb (widget, top, shown);
<a id='L16291' name='L16291'></a> 16291           <em class='brace'>}</em>
<a id='L16292' name='L16292'></a> 16292       <em class='brace'>}</em>
<a id='L16293' name='L16293'></a> 16293   <em class='brace'>}</em>
<a id='L16294' name='L16294'></a> 16294 <em class='sharp'>#endif</em> <em class='comment'>/* !USE_MOTIF */</em>
<a id='L16295' name='L16295'></a> 16295 
<a id='L16296' name='L16296'></a> 16296   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L16297' name='L16297'></a> 16297 <em class='brace'>}</em>
<a id='L16298' name='L16298'></a> 16298 
<a id='L16299' name='L16299'></a> 16299 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L16300' name='L16300'></a> 16300 x_set_toolkit_horizontal_scroll_bar_thumb (<strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>, <strong class='reserved'>int</strong> portion, <strong class='reserved'>int</strong> <a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a>,
<a id='L16301' name='L16301'></a> 16301                                 <strong class='reserved'>int</strong> whole)
<a id='L16302' name='L16302'></a> 16302 <em class='brace'>{</em>
<a id='L16303' name='L16303'></a> 16303   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../S/2183.html#L914' title='Defined at 914 in src/frame.h.'>WINDOW_FRAME</a> (<a href='../D/7409.html' title='Multiple defined in 2 places.'>XWINDOW</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>)));
<a id='L16304' name='L16304'></a> 16304   Widget widget = <a href='../S/2212.html#L1554' title='Defined at 1554 in src/xterm.h.'>SCROLL_BAR_X_WIDGET</a> (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L16305' name='L16305'></a> 16305   <strong class='reserved'>float</strong> top, shown;
<a id='L16306' name='L16306'></a> 16306 
<a id='L16307' name='L16307'></a> 16307   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L16308' name='L16308'></a> 16308 
<a id='L16309' name='L16309'></a> 16309 <em class='sharp'>#ifdef</em> USE_MOTIF
<a id='L16310' name='L16310'></a> 16310   <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;whole = whole;
<a id='L16311' name='L16311'></a> 16311   shown = (<strong class='reserved'>float</strong>) portion / whole;
<a id='L16312' name='L16312'></a> 16312   top = (<strong class='reserved'>float</strong>) <a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a> / (whole - portion);
<a id='L16313' name='L16313'></a> 16313   <em class='brace'>{</em>
<a id='L16314' name='L16314'></a> 16314     <strong class='reserved'>int</strong> <a href='../D/17482.html' title='Multiple defined in 5 places.'>size</a> = <a href='../D/9788.html' title='Multiple defined in 2 places.'>clip_to_bounds</a> (1, shown * <a href='../S/2289.html#L15385' title='Defined at 15385 in src/xterm.c.'>XM_SB_MAX</a>, <a href='../S/2289.html#L15385' title='Defined at 15385 in src/xterm.c.'>XM_SB_MAX</a>);
<a id='L16315' name='L16315'></a> 16315     <strong class='reserved'>int</strong> <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a> = <a href='../D/9788.html' title='Multiple defined in 2 places.'>clip_to_bounds</a> (0, top * (<a href='../S/2289.html#L15385' title='Defined at 15385 in src/xterm.c.'>XM_SB_MAX</a> - <a href='../D/17482.html' title='Multiple defined in 5 places.'>size</a>), <a href='../S/2289.html#L15385' title='Defined at 15385 in src/xterm.c.'>XM_SB_MAX</a> - <a href='../D/17482.html' title='Multiple defined in 5 places.'>size</a>);
<a id='L16316' name='L16316'></a> 16316 
<a id='L16317' name='L16317'></a> 16317     XmScrollBarSetValues (widget, <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>, <a href='../D/17482.html' title='Multiple defined in 5 places.'>size</a>, 0, 0, False);
<a id='L16318' name='L16318'></a> 16318   <em class='brace'>}</em>
<a id='L16319' name='L16319'></a> 16319 <em class='sharp'>#else</em> <em class='comment'>/* !USE_MOTIF i.e. use Xaw */</em>
<a id='L16320' name='L16320'></a> 16320   <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;whole = whole;
<a id='L16321' name='L16321'></a> 16321   <strong class='reserved'>if</strong> (whole == 0)
<a id='L16322' name='L16322'></a> 16322     top = 0, shown = 1;
<a id='L16323' name='L16323'></a> 16323   <strong class='reserved'>else</strong>
<a id='L16324' name='L16324'></a> 16324     <em class='brace'>{</em>
<a id='L16325' name='L16325'></a> 16325       top = (<strong class='reserved'>float</strong>) <a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a> / whole;
<a id='L16326' name='L16326'></a> 16326       shown = (<strong class='reserved'>float</strong>) portion / whole;
<a id='L16327' name='L16327'></a> 16327     <em class='brace'>}</em>
<a id='L16328' name='L16328'></a> 16328 
<a id='L16329' name='L16329'></a> 16329   <em class='brace'>{</em>
<a id='L16330' name='L16330'></a> 16330     <strong class='reserved'>float</strong> old_top, old_shown;
<a id='L16331' name='L16331'></a> 16331     Dimension height;
<a id='L16332' name='L16332'></a> 16332     XtVaGetValues (widget,
<a id='L16333' name='L16333'></a> 16333                    XtNtopOfThumb, &amp;old_top,
<a id='L16334' name='L16334'></a> 16334                    XtNshown, &amp;old_shown,
<a id='L16335' name='L16335'></a> 16335                    XtNheight, &amp;height,
<a id='L16336' name='L16336'></a> 16336                    <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L16337' name='L16337'></a> 16337 
<a id='L16338' name='L16338'></a> 16338 <em class='sharp'>#if</em> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>
<a id='L16339' name='L16339'></a> 16339     <em class='comment'>/* Massage the top+shown values.  */</em>
<a id='L16340' name='L16340'></a> 16340     <strong class='reserved'>if</strong> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging == -1 || <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;last_seen_part == <a href='../S/2231.html#L41' title='Defined at 41 in src/termhooks.h.'>scroll_bar_down_arrow</a>)
<a id='L16341' name='L16341'></a> 16341       top = <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> (0, <a href='../D/14475.html' title='Multiple defined in 11 places.'>min</a> (1, top));
<a id='L16342' name='L16342'></a> 16342     <strong class='reserved'>else</strong>
<a id='L16343' name='L16343'></a> 16343       top = old_top;
<a id='L16344' name='L16344'></a> 16344 <em class='sharp'>#if</em> ! <strong class='reserved'>defined</strong> (HAVE_XAW3D)
<a id='L16345' name='L16345'></a> 16345     <em class='comment'>/* With Xaw, 'top' values too closer to 1.0 may</em>
<a id='L16346' name='L16346'></a> 16346 <em class='comment'>       cause the thumb to disappear.  Fix that.  */</em>
<a id='L16347' name='L16347'></a> 16347     top = <a href='../D/14475.html' title='Multiple defined in 11 places.'>min</a> (top, 0.99f);
<a id='L16348' name='L16348'></a> 16348 <em class='sharp'>#endif</em>
<a id='L16349' name='L16349'></a> 16349     <em class='comment'>/* Keep two pixels available for moving the thumb down.  */</em>
<a id='L16350' name='L16350'></a> 16350     shown = <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> (0, <a href='../D/14475.html' title='Multiple defined in 11 places.'>min</a> (1 - top - (2.0f / height), shown));
<a id='L16351' name='L16351'></a> 16351 <em class='sharp'>#if</em> ! <strong class='reserved'>defined</strong> (HAVE_XAW3D)
<a id='L16352' name='L16352'></a> 16352     <em class='comment'>/* Likewise with too small 'shown'.  */</em>
<a id='L16353' name='L16353'></a> 16353     shown = <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> (shown, 0.01f);
<a id='L16354' name='L16354'></a> 16354 <em class='sharp'>#endif</em>
<a id='L16355' name='L16355'></a> 16355 <em class='sharp'>#endif</em>
<a id='L16356' name='L16356'></a> 16356 
<a id='L16357' name='L16357'></a> 16357     <em class='comment'>/* If the call to XawScrollbarSetThumb below doesn't seem to</em>
<a id='L16358' name='L16358'></a> 16358 <em class='comment'>       work, check that 'NARROWPROTO' is defined in src/config.h.</em>
<a id='L16359' name='L16359'></a> 16359 <em class='comment'>       If this is not so, most likely you need to fix configure.  */</em>
<a id='L16360' name='L16360'></a> 16360     XawScrollbarSetThumb (widget, top, shown);
<a id='L16361' name='L16361'></a> 16361 <em class='sharp'>#if</em> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>
<a id='L16362' name='L16362'></a> 16362     <strong class='reserved'>if</strong> (top != old_top || shown != old_shown)
<a id='L16363' name='L16363'></a> 16363       <em class='brace'>{</em>
<a id='L16364' name='L16364'></a> 16364         <strong class='reserved'>if</strong> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging == -1)
<a id='L16365' name='L16365'></a> 16365           XawScrollbarSetThumb (widget, top, shown);
<a id='L16366' name='L16366'></a> 16366         <strong class='reserved'>else</strong>
<a id='L16367' name='L16367'></a> 16367           <em class='brace'>{</em>
<a id='L16368' name='L16368'></a> 16368             <em class='comment'>/* Try to make the scrolling a tad smoother.  */</em>
<a id='L16369' name='L16369'></a> 16369             <strong class='reserved'>if</strong> (!xaw3d_pick_top)
<a id='L16370' name='L16370'></a> 16370               shown = <a href='../D/14475.html' title='Multiple defined in 11 places.'>min</a> (shown, old_shown);
<a id='L16371' name='L16371'></a> 16371 
<a id='L16372' name='L16372'></a> 16372             XawScrollbarSetThumb (widget, top, shown);
<a id='L16373' name='L16373'></a> 16373           <em class='brace'>}</em>
<a id='L16374' name='L16374'></a> 16374       <em class='brace'>}</em>
<a id='L16375' name='L16375'></a> 16375 <em class='sharp'>#endif</em>
<a id='L16376' name='L16376'></a> 16376   <em class='brace'>}</em>
<a id='L16377' name='L16377'></a> 16377 <em class='sharp'>#endif</em> <em class='comment'>/* !USE_MOTIF */</em>
<a id='L16378' name='L16378'></a> 16378 
<a id='L16379' name='L16379'></a> 16379   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L16380' name='L16380'></a> 16380 <em class='brace'>}</em>
<a id='L16381' name='L16381'></a> 16381 <em class='sharp'>#endif</em> <em class='comment'>/* not USE_GTK */</em>
<a id='L16382' name='L16382'></a> 16382 
<a id='L16383' name='L16383'></a> 16383 <em class='sharp'>#endif</em> <em class='comment'>/* USE_TOOLKIT_SCROLL_BARS */</em>
<a id='L16384' name='L16384'></a> 16384 
<a id='L16385' name='L16385'></a> 16385 
<a id='L16386' name='L16386'></a> 16386 
<a id='L16387' name='L16387'></a> 16387 <em class='comment'>/************************************************************************</em>
<a id='L16388' name='L16388'></a> 16388 <em class='comment'>                         Scroll bars, general</em>
<a id='L16389' name='L16389'></a> 16389 <em class='comment'> ************************************************************************/</em>
<a id='L16390' name='L16390'></a> 16390 
<a id='L16391' name='L16391'></a> 16391 <em class='comment'>/* Create a scroll bar and return the scroll bar vector for it.  W is</em>
<a id='L16392' name='L16392'></a> 16392 <em class='comment'>   the Emacs window on which to create the scroll bar. TOP, LEFT,</em>
<a id='L16393' name='L16393'></a> 16393 <em class='comment'>   WIDTH and HEIGHT are the pixel coordinates and dimensions of the</em>
<a id='L16394' name='L16394'></a> 16394 <em class='comment'>   scroll bar. */</em>
<a id='L16395' name='L16395'></a> 16395 
<a id='L16396' name='L16396'></a> 16396 <strong class='reserved'>static</strong> <strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *
<a id='L16397' name='L16397'></a> 16397 x_scroll_bar_create (<strong class='reserved'>struct</strong> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> *w, <strong class='reserved'>int</strong> top, <strong class='reserved'>int</strong> left,
<a id='L16398' name='L16398'></a> 16398                      <strong class='reserved'>int</strong> width, <strong class='reserved'>int</strong> height, <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> horizontal)
<a id='L16399' name='L16399'></a> 16399 <em class='brace'>{</em>
<a id='L16400' name='L16400'></a> 16400   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (w-&gt;<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>);
<a id='L16401' name='L16401'></a> 16401   <strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> = <a href='../D/63.html' title='Multiple defined in 2 places.'>ALLOCATE_PSEUDOVECTOR</a> (<strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a>, prev,
<a id='L16402' name='L16402'></a> 16402                                                   PVEC_OTHER);
<a id='L16403' name='L16403'></a> 16403   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> barobj;
<a id='L16404' name='L16404'></a> 16404 
<a id='L16405' name='L16405'></a> 16405   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L16406' name='L16406'></a> 16406 
<a id='L16407' name='L16407'></a> 16407 <em class='sharp'>#ifdef</em> USE_TOOLKIT_SCROLL_BARS
<a id='L16408' name='L16408'></a> 16408   <strong class='reserved'>if</strong> (horizontal)
<a id='L16409' name='L16409'></a> 16409     x_create_horizontal_toolkit_scroll_bar (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L16410' name='L16410'></a> 16410   <strong class='reserved'>else</strong>
<a id='L16411' name='L16411'></a> 16411     x_create_toolkit_scroll_bar (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L16412' name='L16412'></a> 16412 <em class='sharp'>#else</em> <em class='comment'>/* not USE_TOOLKIT_SCROLL_BARS */</em>
<a id='L16413' name='L16413'></a> 16413   <em class='brace'>{</em>
<a id='L16414' name='L16414'></a> 16414     XSetWindowAttributes <a href='../D/8258.html' title='Multiple defined in 6 places.'>a</a>;
<a id='L16415' name='L16415'></a> 16415     <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> mask;
<a id='L16416' name='L16416'></a> 16416     <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>;
<a id='L16417' name='L16417'></a> 16417 
<a id='L16418' name='L16418'></a> 16418     <a href='../D/8258.html' title='Multiple defined in 6 places.'>a</a>.event_mask = (ButtonPressMask | <a href='../S/2321.html#L132' title='Defined at 132 in src/msdos.h.'>ButtonReleaseMask</a>
<a id='L16419' name='L16419'></a> 16419                     | ButtonMotionMask | PointerMotionHintMask);
<a id='L16420' name='L16420'></a> 16420     <a href='../D/8258.html' title='Multiple defined in 6 places.'>a</a>.cursor = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;vertical_scroll_bar_cursor;
<a id='L16421' name='L16421'></a> 16421 
<a id='L16422' name='L16422'></a> 16422     mask = (CWEventMask | CWCursor);
<a id='L16423' name='L16423'></a> 16423 
<a id='L16424' name='L16424'></a> 16424     <em class='comment'>/* Clear the area of W that will serve as a scroll bar.  This is</em>
<a id='L16425' name='L16425'></a> 16425 <em class='comment'>       for the case that a window has been split horizontally.  In</em>
<a id='L16426' name='L16426'></a> 16426 <em class='comment'>       this case, no clear_frame is generated to reduce flickering.  */</em>
<a id='L16427' name='L16427'></a> 16427     <strong class='reserved'>if</strong> (width &gt; 0 &amp;&amp; <a href='../S/2224.html#L1262' title='Defined at 1262 in src/xdisp.c.'>window_box_height</a> (w) &gt; 0)
<a id='L16428' name='L16428'></a> 16428       <a href='../S/2289.html#L11076' title='Defined at 11076 in src/xterm.c.'>x_clear_area</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, left, top, width, <a href='../S/2224.html#L1262' title='Defined at 1262 in src/xdisp.c.'>window_box_height</a> (w));
<a id='L16429' name='L16429'></a> 16429 
<a id='L16430' name='L16430'></a> 16430     <em class='comment'>/* Create an input only window.  Scroll bar contents are drawn to</em>
<a id='L16431' name='L16431'></a> 16431 <em class='comment'>       the frame window itself, so they can be double buffered and</em>
<a id='L16432' name='L16432'></a> 16432 <em class='comment'>       synchronized using the same mechanism as the frame.  */</em>
<a id='L16433' name='L16433'></a> 16433     <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = XCreateWindow (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L16434' name='L16434'></a> 16434                             <em class='comment'>/* Position and size of scroll bar.  */</em>
<a id='L16435' name='L16435'></a> 16435                             left, top, width, height,
<a id='L16436' name='L16436'></a> 16436                             <em class='comment'>/* Border width.  */</em>
<a id='L16437' name='L16437'></a> 16437                             0,
<a id='L16438' name='L16438'></a> 16438                             <em class='comment'>/* Depth.  */</em>
<a id='L16439' name='L16439'></a> 16439                             CopyFromParent,
<a id='L16440' name='L16440'></a> 16440                             <em class='comment'>/* Class.  */</em>
<a id='L16441' name='L16441'></a> 16441                             InputOnly,
<a id='L16442' name='L16442'></a> 16442                             <em class='comment'>/* Visual class.  */</em>
<a id='L16443' name='L16443'></a> 16443                             CopyFromParent,
<a id='L16444' name='L16444'></a> 16444                              <em class='comment'>/* Attributes.  */</em>
<a id='L16445' name='L16445'></a> 16445                             mask, &amp;<a href='../D/8258.html' title='Multiple defined in 6 places.'>a</a>);
<a id='L16446' name='L16446'></a> 16446 
<a id='L16447' name='L16447'></a> 16447 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L16448' name='L16448'></a> 16448   <em class='comment'>/* Ask for input extension button and motion events.  This lets us</em>
<a id='L16449' name='L16449'></a> 16449 <em class='comment'>     send the proper `wheel-up' or `wheel-down' events to Emacs.  */</em>
<a id='L16450' name='L16450'></a> 16450   <strong class='reserved'>if</strong> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;supports_xi2)
<a id='L16451' name='L16451'></a> 16451     xi_select_scroll_bar_events (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L16452' name='L16452'></a> 16452                                  <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L16453' name='L16453'></a> 16453 <em class='sharp'>#endif</em>
<a id='L16454' name='L16454'></a> 16454 
<a id='L16455' name='L16455'></a> 16455     <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../D/19737.html' title='Multiple defined in 3 places.'>x_window</a> = <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>;
<a id='L16456' name='L16456'></a> 16456   <em class='brace'>}</em>
<a id='L16457' name='L16457'></a> 16457 <em class='sharp'>#endif</em> <em class='comment'>/* not USE_TOOLKIT_SCROLL_BARS */</em>
<a id='L16458' name='L16458'></a> 16458 
<a id='L16459' name='L16459'></a> 16459   <a href='../D/7361.html' title='Multiple defined in 2 places.'>XSETWINDOW</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, w);
<a id='L16460' name='L16460'></a> 16460   <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;top = top;
<a id='L16461' name='L16461'></a> 16461   <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;left = left;
<a id='L16462' name='L16462'></a> 16462   <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;width = width;
<a id='L16463' name='L16463'></a> 16463   <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;height = height;
<a id='L16464' name='L16464'></a> 16464   <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a> = 0;
<a id='L16465' name='L16465'></a> 16465   <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;end = 0;
<a id='L16466' name='L16466'></a> 16466   <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging = -1;
<a id='L16467' name='L16467'></a> 16467   <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;horizontal = horizontal;
<a id='L16468' name='L16468'></a> 16468 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> (USE_TOOLKIT_SCROLL_BARS) &amp;&amp; <strong class='reserved'>defined</strong> (USE_LUCID)
<a id='L16469' name='L16469'></a> 16469   <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;last_seen_part = <a href='../S/2231.html#L36' title='Defined at 36 in src/termhooks.h.'>scroll_bar_nowhere</a>;
<a id='L16470' name='L16470'></a> 16470 <em class='sharp'>#endif</em>
<a id='L16471' name='L16471'></a> 16471 
<a id='L16472' name='L16472'></a> 16472   <em class='comment'>/* Add bar to its frame's list of scroll bars.  */</em>
<a id='L16473' name='L16473'></a> 16473   <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;next = <a href='../S/2183.html#L1365' title='Defined at 1365 in src/frame.h.'>FRAME_SCROLL_BARS</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L16474' name='L16474'></a> 16474   <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;prev = Qnil;
<a id='L16475' name='L16475'></a> 16475   <a href='../D/7360.html' title='Multiple defined in 2 places.'>XSETVECTOR</a> (barobj, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L16476' name='L16476'></a> 16476   <a href='../S/2183.html#L807' title='Defined at 807 in src/frame.h.'>fset_scroll_bars</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, barobj);
<a id='L16477' name='L16477'></a> 16477   <strong class='reserved'>if</strong> (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;next))
<a id='L16478' name='L16478'></a> 16478     <a href='../D/7360.html' title='Multiple defined in 2 places.'>XSETVECTOR</a> (<a href='../D/7329.html' title='Multiple defined in 5 places.'>XSCROLL_BAR</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;next)-&gt;prev, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L16479' name='L16479'></a> 16479 
<a id='L16480' name='L16480'></a> 16480   <em class='comment'>/* Map the window/widget.  */</em>
<a id='L16481' name='L16481'></a> 16481 <em class='sharp'>#ifdef</em> USE_TOOLKIT_SCROLL_BARS
<a id='L16482' name='L16482'></a> 16482   <em class='brace'>{</em>
<a id='L16483' name='L16483'></a> 16483 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L16484' name='L16484'></a> 16484     <strong class='reserved'>if</strong> (horizontal)
<a id='L16485' name='L16485'></a> 16485       <a href='../S/2362.html#L4812' title='Defined at 4812 in src/gtkutil.c.'>xg_update_horizontal_scrollbar_pos</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../D/19737.html' title='Multiple defined in 3 places.'>x_window</a>, top,
<a id='L16486' name='L16486'></a> 16486                                           left, width, <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> (height, 1));
<a id='L16487' name='L16487'></a> 16487     <strong class='reserved'>else</strong>
<a id='L16488' name='L16488'></a> 16488       <a href='../S/2362.html#L4705' title='Defined at 4705 in src/gtkutil.c.'>xg_update_scrollbar_pos</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../D/19737.html' title='Multiple defined in 3 places.'>x_window</a>, top,
<a id='L16489' name='L16489'></a> 16489                                left, width, <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> (height, 1));
<a id='L16490' name='L16490'></a> 16490 <em class='sharp'>#else</em> <em class='comment'>/* not USE_GTK */</em>
<a id='L16491' name='L16491'></a> 16491     Widget <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> = <a href='../S/2212.html#L1554' title='Defined at 1554 in src/xterm.h.'>SCROLL_BAR_X_WIDGET</a> (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L16492' name='L16492'></a> 16492     XtConfigureWidget (<a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a>, left, top, width, <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> (height, 1), 0);
<a id='L16493' name='L16493'></a> 16493     XtMapWidget (<a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a>);
<a id='L16494' name='L16494'></a> 16494     <em class='comment'>/* Don't obscure any child frames.  */</em>
<a id='L16495' name='L16495'></a> 16495     XLowerWindow (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../D/19737.html' title='Multiple defined in 3 places.'>x_window</a>);
<a id='L16496' name='L16496'></a> 16496 <em class='sharp'>#endif</em> <em class='comment'>/* not USE_GTK */</em>
<a id='L16497' name='L16497'></a> 16497     <em class='brace'>}</em>
<a id='L16498' name='L16498'></a> 16498 <em class='sharp'>#else</em> <em class='comment'>/* not USE_TOOLKIT_SCROLL_BARS */</em>
<a id='L16499' name='L16499'></a> 16499   XMapWindow (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../D/19737.html' title='Multiple defined in 3 places.'>x_window</a>);
<a id='L16500' name='L16500'></a> 16500   <em class='comment'>/* Don't obscure any child frames.  */</em>
<a id='L16501' name='L16501'></a> 16501   XLowerWindow (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../D/19737.html' title='Multiple defined in 3 places.'>x_window</a>);
<a id='L16502' name='L16502'></a> 16502 <em class='sharp'>#endif</em> <em class='comment'>/* not USE_TOOLKIT_SCROLL_BARS */</em>
<a id='L16503' name='L16503'></a> 16503 
<a id='L16504' name='L16504'></a> 16504   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L16505' name='L16505'></a> 16505   <strong class='reserved'>return</strong> <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>;
<a id='L16506' name='L16506'></a> 16506 <em class='brace'>}</em>
<a id='L16507' name='L16507'></a> 16507 
<a id='L16508' name='L16508'></a> 16508 
<a id='L16509' name='L16509'></a> 16509 <em class='sharp'>#ifndef</em> USE_TOOLKIT_SCROLL_BARS
<a id='L16510' name='L16510'></a> 16510 
<a id='L16511' name='L16511'></a> 16511 <em class='comment'>/* Draw BAR's handle in the proper position.</em>
<a id='L16512' name='L16512'></a> 16512 <em class='comment'></em>
<a id='L16513' name='L16513'></a> 16513 <em class='comment'>   If the handle is already drawn from START to END, don't bother</em>
<a id='L16514' name='L16514'></a> 16514 <em class='comment'>   redrawing it, unless REBUILD; in that case, always</em>
<a id='L16515' name='L16515'></a> 16515 <em class='comment'>   redraw it.  (REBUILD is handy for drawing the handle after expose</em>
<a id='L16516' name='L16516'></a> 16516 <em class='comment'>   events.)</em>
<a id='L16517' name='L16517'></a> 16517 <em class='comment'></em>
<a id='L16518' name='L16518'></a> 16518 <em class='comment'>   Normally, we want to constrain the start and end of the handle to</em>
<a id='L16519' name='L16519'></a> 16519 <em class='comment'>   fit inside its rectangle, but if the user is dragging the scroll</em>
<a id='L16520' name='L16520'></a> 16520 <em class='comment'>   bar handle, we want to let them drag it down all the way, so that</em>
<a id='L16521' name='L16521'></a> 16521 <em class='comment'>   the bar's top is as far down as it goes; otherwise, there's no way</em>
<a id='L16522' name='L16522'></a> 16522 <em class='comment'>   to move to the very end of the buffer.  */</em>
<a id='L16523' name='L16523'></a> 16523 
<a id='L16524' name='L16524'></a> 16524 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L16525' name='L16525'></a> 16525 x_scroll_bar_set_handle (<strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>, <strong class='reserved'>int</strong> <a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a>, <strong class='reserved'>int</strong> end,
<a id='L16526' name='L16526'></a> 16526                          <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> rebuild)
<a id='L16527' name='L16527'></a> 16527 <em class='brace'>{</em>
<a id='L16528' name='L16528'></a> 16528   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> dragging;
<a id='L16529' name='L16529'></a> 16529   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L16530' name='L16530'></a> 16530   <a href='../D/1653.html' title='Multiple defined in 2 places.'>Drawable</a> w;
<a id='L16531' name='L16531'></a> 16531   <a href='../D/2619.html' title='Multiple defined in 2 places.'>GC</a> gc;
<a id='L16532' name='L16532'></a> 16532   <strong class='reserved'>int</strong> inside_width, inside_height, top_range, length;
<a id='L16533' name='L16533'></a> 16533 
<a id='L16534' name='L16534'></a> 16534   <em class='comment'>/* If the display is already accurate, do nothing.  */</em>
<a id='L16535' name='L16535'></a> 16535   <strong class='reserved'>if</strong> (! rebuild
<a id='L16536' name='L16536'></a> 16536       &amp;&amp; <a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a> == <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a>
<a id='L16537' name='L16537'></a> 16537       &amp;&amp; end == <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;end)
<a id='L16538' name='L16538'></a> 16538     <strong class='reserved'>return</strong>;
<a id='L16539' name='L16539'></a> 16539 
<a id='L16540' name='L16540'></a> 16540   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../S/2183.html#L914' title='Defined at 914 in src/frame.h.'>WINDOW_FRAME</a> (<a href='../D/7409.html' title='Multiple defined in 2 places.'>XWINDOW</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>)));
<a id='L16541' name='L16541'></a> 16541   dragging = <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging != -1;
<a id='L16542' name='L16542'></a> 16542   gc = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;normal_gc;
<a id='L16543' name='L16543'></a> 16543   w = <a href='../S/2212.html#L1352' title='Defined at 1352 in src/xterm.h.'>FRAME_X_DRAWABLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L16544' name='L16544'></a> 16544 
<a id='L16545' name='L16545'></a> 16545   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L16546' name='L16546'></a> 16546 
<a id='L16547' name='L16547'></a> 16547   inside_width = <a href='../D/6679.html' title='Multiple defined in 2 places.'>VERTICAL_SCROLL_BAR_INSIDE_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;width);
<a id='L16548' name='L16548'></a> 16548   inside_height = <a href='../D/6678.html' title='Multiple defined in 2 places.'>VERTICAL_SCROLL_BAR_INSIDE_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;height);
<a id='L16549' name='L16549'></a> 16549   top_range = <a href='../D/6684.html' title='Multiple defined in 2 places.'>VERTICAL_SCROLL_BAR_TOP_RANGE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;height);
<a id='L16550' name='L16550'></a> 16550 
<a id='L16551' name='L16551'></a> 16551   <em class='comment'>/* Make sure the values are reasonable, and try to preserve</em>
<a id='L16552' name='L16552'></a> 16552 <em class='comment'>     the distance between start and end.  */</em>
<a id='L16553' name='L16553'></a> 16553   length = end - <a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a>;
<a id='L16554' name='L16554'></a> 16554 
<a id='L16555' name='L16555'></a> 16555   <strong class='reserved'>if</strong> (<a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a> &lt; 0)
<a id='L16556' name='L16556'></a> 16556     <a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a> = 0;
<a id='L16557' name='L16557'></a> 16557   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (<a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a> &gt; top_range)
<a id='L16558' name='L16558'></a> 16558     <a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a> = top_range;
<a id='L16559' name='L16559'></a> 16559   end = <a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a> + length;
<a id='L16560' name='L16560'></a> 16560 
<a id='L16561' name='L16561'></a> 16561   <strong class='reserved'>if</strong> (end &lt; <a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a>)
<a id='L16562' name='L16562'></a> 16562     end = <a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a>;
<a id='L16563' name='L16563'></a> 16563   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (end &gt; top_range &amp;&amp; ! dragging)
<a id='L16564' name='L16564'></a> 16564     end = top_range;
<a id='L16565' name='L16565'></a> 16565 
<a id='L16566' name='L16566'></a> 16566   <em class='comment'>/* Store the adjusted setting in the scroll bar.  */</em>
<a id='L16567' name='L16567'></a> 16567   <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a> = <a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a>;
<a id='L16568' name='L16568'></a> 16568   <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;end = end;
<a id='L16569' name='L16569'></a> 16569 
<a id='L16570' name='L16570'></a> 16570   <em class='comment'>/* Clip the end position, just for display.  */</em>
<a id='L16571' name='L16571'></a> 16571   <strong class='reserved'>if</strong> (end &gt; top_range)
<a id='L16572' name='L16572'></a> 16572     end = top_range;
<a id='L16573' name='L16573'></a> 16573 
<a id='L16574' name='L16574'></a> 16574   <em class='comment'>/* Draw bottom positions VERTICAL_SCROLL_BAR_MIN_HANDLE pixels</em>
<a id='L16575' name='L16575'></a> 16575 <em class='comment'>     below top positions, to make sure the handle is always at least</em>
<a id='L16576' name='L16576'></a> 16576 <em class='comment'>     that many pixels tall.  */</em>
<a id='L16577' name='L16577'></a> 16577   end += <a href='../D/6681.html' title='Multiple defined in 2 places.'>VERTICAL_SCROLL_BAR_MIN_HANDLE</a>;
<a id='L16578' name='L16578'></a> 16578 
<a id='L16579' name='L16579'></a> 16579   <em class='comment'>/* Draw the empty space above the handle.  Note that we can't clear</em>
<a id='L16580' name='L16580'></a> 16580 <em class='comment'>     zero-height areas; that means "clear to end of window."  */</em>
<a id='L16581' name='L16581'></a> 16581   <strong class='reserved'>if</strong> ((inside_width &gt; 0) &amp;&amp; (<a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a> &gt; 0))
<a id='L16582' name='L16582'></a> 16582     <em class='brace'>{</em>
<a id='L16583' name='L16583'></a> 16583       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_background_pixel != -1)
<a id='L16584' name='L16584'></a> 16584         XSetForeground (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), gc,
<a id='L16585' name='L16585'></a> 16585                         <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_background_pixel);
<a id='L16586' name='L16586'></a> 16586       <strong class='reserved'>else</strong>
<a id='L16587' name='L16587'></a> 16587         XSetForeground (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), gc,
<a id='L16588' name='L16588'></a> 16588                         <a href='../S/2183.html#L1377' title='Defined at 1377 in src/frame.h.'>FRAME_BACKGROUND_PIXEL</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L16589' name='L16589'></a> 16589 
<a id='L16590' name='L16590'></a> 16590       XFillRectangle (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), w, gc,
<a id='L16591' name='L16591'></a> 16591                       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;left + <a href='../D/6680.html' title='Multiple defined in 2 places.'>VERTICAL_SCROLL_BAR_LEFT_BORDER</a>,
<a id='L16592' name='L16592'></a> 16592                       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;top + <a href='../D/6683.html' title='Multiple defined in 2 places.'>VERTICAL_SCROLL_BAR_TOP_BORDER</a>,
<a id='L16593' name='L16593'></a> 16593                       inside_width, <a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a>);
<a id='L16594' name='L16594'></a> 16594 
<a id='L16595' name='L16595'></a> 16595       XSetForeground (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), gc,
<a id='L16596' name='L16596'></a> 16596                       <a href='../S/2183.html#L1376' title='Defined at 1376 in src/frame.h.'>FRAME_FOREGROUND_PIXEL</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L16597' name='L16597'></a> 16597     <em class='brace'>}</em>
<a id='L16598' name='L16598'></a> 16598 
<a id='L16599' name='L16599'></a> 16599   <em class='comment'>/* Change to proper foreground color if one is specified.  */</em>
<a id='L16600' name='L16600'></a> 16600   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_foreground_pixel != -1)
<a id='L16601' name='L16601'></a> 16601     XSetForeground (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), gc,
<a id='L16602' name='L16602'></a> 16602                     <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_foreground_pixel);
<a id='L16603' name='L16603'></a> 16603 
<a id='L16604' name='L16604'></a> 16604   <em class='comment'>/* Draw the handle itself.  */</em>
<a id='L16605' name='L16605'></a> 16605   XFillRectangle (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), w, gc,
<a id='L16606' name='L16606'></a> 16606                   <em class='comment'>/* x, y, width, height */</em>
<a id='L16607' name='L16607'></a> 16607                   <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;left + <a href='../D/6680.html' title='Multiple defined in 2 places.'>VERTICAL_SCROLL_BAR_LEFT_BORDER</a>,
<a id='L16608' name='L16608'></a> 16608                   <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;top + <a href='../D/6683.html' title='Multiple defined in 2 places.'>VERTICAL_SCROLL_BAR_TOP_BORDER</a> + <a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a>,
<a id='L16609' name='L16609'></a> 16609                   inside_width, end - <a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a>);
<a id='L16610' name='L16610'></a> 16610 
<a id='L16611' name='L16611'></a> 16611 
<a id='L16612' name='L16612'></a> 16612   <em class='comment'>/* Draw the empty space below the handle.  Note that we can't</em>
<a id='L16613' name='L16613'></a> 16613 <em class='comment'>     clear zero-height areas; that means "clear to end of window." */</em>
<a id='L16614' name='L16614'></a> 16614   <strong class='reserved'>if</strong> ((inside_width &gt; 0) &amp;&amp; (end &lt; inside_height))
<a id='L16615' name='L16615'></a> 16615     <em class='brace'>{</em>
<a id='L16616' name='L16616'></a> 16616       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_background_pixel != -1)
<a id='L16617' name='L16617'></a> 16617         XSetForeground (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), gc,
<a id='L16618' name='L16618'></a> 16618                         <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_background_pixel);
<a id='L16619' name='L16619'></a> 16619       <strong class='reserved'>else</strong>
<a id='L16620' name='L16620'></a> 16620         XSetForeground (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), gc,
<a id='L16621' name='L16621'></a> 16621                         <a href='../S/2183.html#L1377' title='Defined at 1377 in src/frame.h.'>FRAME_BACKGROUND_PIXEL</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L16622' name='L16622'></a> 16622 
<a id='L16623' name='L16623'></a> 16623       XFillRectangle (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), w, gc,
<a id='L16624' name='L16624'></a> 16624                       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;left + <a href='../D/6680.html' title='Multiple defined in 2 places.'>VERTICAL_SCROLL_BAR_LEFT_BORDER</a>,
<a id='L16625' name='L16625'></a> 16625                       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;top + <a href='../D/6683.html' title='Multiple defined in 2 places.'>VERTICAL_SCROLL_BAR_TOP_BORDER</a> + end,
<a id='L16626' name='L16626'></a> 16626                       inside_width, inside_height - end);
<a id='L16627' name='L16627'></a> 16627 
<a id='L16628' name='L16628'></a> 16628       XSetForeground (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), gc,
<a id='L16629' name='L16629'></a> 16629                       <a href='../S/2183.html#L1376' title='Defined at 1376 in src/frame.h.'>FRAME_FOREGROUND_PIXEL</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L16630' name='L16630'></a> 16630     <em class='brace'>}</em>
<a id='L16631' name='L16631'></a> 16631 
<a id='L16632' name='L16632'></a> 16632   <em class='comment'>/* Restore the foreground color of the GC if we changed it above.  */</em>
<a id='L16633' name='L16633'></a> 16633   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_foreground_pixel != -1)
<a id='L16634' name='L16634'></a> 16634     XSetForeground (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), gc,
<a id='L16635' name='L16635'></a> 16635                     <a href='../S/2183.html#L1376' title='Defined at 1376 in src/frame.h.'>FRAME_FOREGROUND_PIXEL</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L16636' name='L16636'></a> 16636 
<a id='L16637' name='L16637'></a> 16637   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L16638' name='L16638'></a> 16638 <em class='brace'>}</em>
<a id='L16639' name='L16639'></a> 16639 
<a id='L16640' name='L16640'></a> 16640 <em class='sharp'>#endif</em> <em class='comment'>/* !USE_TOOLKIT_SCROLL_BARS */</em>
<a id='L16641' name='L16641'></a> 16641 
<a id='L16642' name='L16642'></a> 16642 <em class='comment'>/* Destroy scroll bar BAR, and set its Emacs window's scroll bar to</em>
<a id='L16643' name='L16643'></a> 16643 <em class='comment'>   nil.  */</em>
<a id='L16644' name='L16644'></a> 16644 
<a id='L16645' name='L16645'></a> 16645 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L16646' name='L16646'></a> 16646 x_scroll_bar_remove (<strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>)
<a id='L16647' name='L16647'></a> 16647 <em class='brace'>{</em>
<a id='L16648' name='L16648'></a> 16648   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../S/2183.html#L914' title='Defined at 914 in src/frame.h.'>WINDOW_FRAME</a> (<a href='../D/7409.html' title='Multiple defined in 2 places.'>XWINDOW</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>)));
<a id='L16649' name='L16649'></a> 16649   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L16650' name='L16650'></a> 16650 
<a id='L16651' name='L16651'></a> 16651 <em class='sharp'>#ifdef</em> USE_TOOLKIT_SCROLL_BARS
<a id='L16652' name='L16652'></a> 16652 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L16653' name='L16653'></a> 16653   <a href='../S/2362.html#L4686' title='Defined at 4686 in src/gtkutil.c.'>xg_remove_scroll_bar</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../D/19737.html' title='Multiple defined in 3 places.'>x_window</a>);
<a id='L16654' name='L16654'></a> 16654 <em class='sharp'>#else</em> <em class='comment'>/* not USE_GTK */</em>
<a id='L16655' name='L16655'></a> 16655   XtDestroyWidget (<a href='../S/2212.html#L1554' title='Defined at 1554 in src/xterm.h.'>SCROLL_BAR_X_WIDGET</a> (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>));
<a id='L16656' name='L16656'></a> 16656 <em class='sharp'>#endif</em> <em class='comment'>/* not USE_GTK */</em>
<a id='L16657' name='L16657'></a> 16657 <em class='sharp'>#else</em>
<a id='L16658' name='L16658'></a> 16658   XDestroyWindow (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../D/19737.html' title='Multiple defined in 3 places.'>x_window</a>);
<a id='L16659' name='L16659'></a> 16659 <em class='sharp'>#endif</em>
<a id='L16660' name='L16660'></a> 16660 
<a id='L16661' name='L16661'></a> 16661   <em class='comment'>/* Dissociate this scroll bar from its window.  */</em>
<a id='L16662' name='L16662'></a> 16662   <strong class='reserved'>if</strong> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;horizontal)
<a id='L16663' name='L16663'></a> 16663     <a href='../S/2317.html#L534' title='Defined at 534 in src/window.h.'>wset_horizontal_scroll_bar</a> (<a href='../D/7409.html' title='Multiple defined in 2 places.'>XWINDOW</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>), Qnil);
<a id='L16664' name='L16664'></a> 16664   <strong class='reserved'>else</strong>
<a id='L16665' name='L16665'></a> 16665     <a href='../S/2317.html#L528' title='Defined at 528 in src/window.h.'>wset_vertical_scroll_bar</a> (<a href='../D/7409.html' title='Multiple defined in 2 places.'>XWINDOW</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>), Qnil);
<a id='L16666' name='L16666'></a> 16666 
<a id='L16667' name='L16667'></a> 16667   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L16668' name='L16668'></a> 16668 <em class='brace'>}</em>
<a id='L16669' name='L16669'></a> 16669 
<a id='L16670' name='L16670'></a> 16670 
<a id='L16671' name='L16671'></a> 16671 <em class='comment'>/* Set the handle of the vertical scroll bar for WINDOW to indicate</em>
<a id='L16672' name='L16672'></a> 16672 <em class='comment'>   that we are displaying PORTION characters out of a total of WHOLE</em>
<a id='L16673' name='L16673'></a> 16673 <em class='comment'>   characters, starting at POSITION.  If WINDOW has no scroll bar,</em>
<a id='L16674' name='L16674'></a> 16674 <em class='comment'>   create one.  */</em>
<a id='L16675' name='L16675'></a> 16675 
<a id='L16676' name='L16676'></a> 16676 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L16677' name='L16677'></a> 16677 XTset_vertical_scroll_bar (<strong class='reserved'>struct</strong> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> *w, <strong class='reserved'>int</strong> portion, <strong class='reserved'>int</strong> whole, <strong class='reserved'>int</strong> <a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a>)
<a id='L16678' name='L16678'></a> 16678 <em class='brace'>{</em>
<a id='L16679' name='L16679'></a> 16679   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (w-&gt;<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>);
<a id='L16680' name='L16680'></a> 16680   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> barobj;
<a id='L16681' name='L16681'></a> 16681   <strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>;
<a id='L16682' name='L16682'></a> 16682   <strong class='reserved'>int</strong> top, height, left, width;
<a id='L16683' name='L16683'></a> 16683   <strong class='reserved'>int</strong> window_y, window_height;
<a id='L16684' name='L16684'></a> 16684 
<a id='L16685' name='L16685'></a> 16685   <em class='comment'>/* Get window dimensions.  */</em>
<a id='L16686' name='L16686'></a> 16686   <a href='../S/2224.html#L1418' title='Defined at 1418 in src/xdisp.c.'>window_box</a> (w, <a href='../S/2315.html#L857' title='Defined at 857 in src/dispextern.h.'>ANY_AREA</a>, 0, &amp;window_y, 0, &amp;window_height);
<a id='L16687' name='L16687'></a> 16687   top = window_y;
<a id='L16688' name='L16688'></a> 16688   height = window_height;
<a id='L16689' name='L16689'></a> 16689   left = <a href='../S/2317.html#L976' title='Defined at 976 in src/window.h.'>WINDOW_SCROLL_BAR_AREA_X</a> (w);
<a id='L16690' name='L16690'></a> 16690   width = <a href='../S/2317.html#L969' title='Defined at 969 in src/window.h.'>WINDOW_SCROLL_BAR_AREA_WIDTH</a> (w);
<a id='L16691' name='L16691'></a> 16691 
<a id='L16692' name='L16692'></a> 16692   <em class='comment'>/* Does the scroll bar exist yet?  */</em>
<a id='L16693' name='L16693'></a> 16693   <strong class='reserved'>if</strong> (<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (w-&gt;vertical_scroll_bar))
<a id='L16694' name='L16694'></a> 16694     <em class='brace'>{</em>
<a id='L16695' name='L16695'></a> 16695       <strong class='reserved'>if</strong> (width &gt; 0 &amp;&amp; height &gt; 0)
<a id='L16696' name='L16696'></a> 16696         <em class='brace'>{</em>
<a id='L16697' name='L16697'></a> 16697           <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L16698' name='L16698'></a> 16698           <a href='../S/2289.html#L11076' title='Defined at 11076 in src/xterm.c.'>x_clear_area</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, left, top, width, height);
<a id='L16699' name='L16699'></a> 16699           <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L16700' name='L16700'></a> 16700         <em class='brace'>}</em>
<a id='L16701' name='L16701'></a> 16701 
<a id='L16702' name='L16702'></a> 16702       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> = x_scroll_bar_create (w, top, left, width, <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> (height, 1), <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L16703' name='L16703'></a> 16703 <em class='sharp'>#ifndef</em> USE_TOOLKIT_SCROLL_BARS
<a id='L16704' name='L16704'></a> 16704       <em class='comment'>/* Since non-toolkit scroll bars don't display their contents to</em>
<a id='L16705' name='L16705'></a> 16705 <em class='comment'>         a dedicated window, no expose event will be generated.</em>
<a id='L16706' name='L16706'></a> 16706 <em class='comment'>         Redraw the scroll bar manually.  */</em>
<a id='L16707' name='L16707'></a> 16707       x_scroll_bar_redraw (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L16708' name='L16708'></a> 16708 <em class='sharp'>#endif</em>
<a id='L16709' name='L16709'></a> 16709     <em class='brace'>}</em>
<a id='L16710' name='L16710'></a> 16710   <strong class='reserved'>else</strong>
<a id='L16711' name='L16711'></a> 16711     <em class='brace'>{</em>
<a id='L16712' name='L16712'></a> 16712       <em class='comment'>/* It may just need to be moved and resized.  */</em>
<a id='L16713' name='L16713'></a> 16713       <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> mask = 0;
<a id='L16714' name='L16714'></a> 16714 
<a id='L16715' name='L16715'></a> 16715       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> = <a href='../D/7329.html' title='Multiple defined in 5 places.'>XSCROLL_BAR</a> (w-&gt;vertical_scroll_bar);
<a id='L16716' name='L16716'></a> 16716 
<a id='L16717' name='L16717'></a> 16717       <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L16718' name='L16718'></a> 16718 
<a id='L16719' name='L16719'></a> 16719       <strong class='reserved'>if</strong> (left != <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;left)
<a id='L16720' name='L16720'></a> 16720         mask |= CWX;
<a id='L16721' name='L16721'></a> 16721       <strong class='reserved'>if</strong> (top != <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;top)
<a id='L16722' name='L16722'></a> 16722         mask |= CWY;
<a id='L16723' name='L16723'></a> 16723       <strong class='reserved'>if</strong> (width != <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;width)
<a id='L16724' name='L16724'></a> 16724         mask |= CWWidth;
<a id='L16725' name='L16725'></a> 16725       <strong class='reserved'>if</strong> (height != <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;height)
<a id='L16726' name='L16726'></a> 16726         mask |= CWHeight;
<a id='L16727' name='L16727'></a> 16727 
<a id='L16728' name='L16728'></a> 16728 <em class='sharp'>#ifdef</em> USE_TOOLKIT_SCROLL_BARS
<a id='L16729' name='L16729'></a> 16729 
<a id='L16730' name='L16730'></a> 16730       <em class='comment'>/* Move/size the scroll bar widget.  */</em>
<a id='L16731' name='L16731'></a> 16731       <strong class='reserved'>if</strong> (mask)
<a id='L16732' name='L16732'></a> 16732         <em class='brace'>{</em>
<a id='L16733' name='L16733'></a> 16733           <em class='comment'>/* Since toolkit scroll bars are smaller than the space reserved</em>
<a id='L16734' name='L16734'></a> 16734 <em class='comment'>             for them on the frame, we have to clear "under" them.  */</em>
<a id='L16735' name='L16735'></a> 16735           <strong class='reserved'>if</strong> (width &gt; 0 &amp;&amp; height &gt; 0)
<a id='L16736' name='L16736'></a> 16736             <a href='../S/2289.html#L11076' title='Defined at 11076 in src/xterm.c.'>x_clear_area</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, left, top, width, height);
<a id='L16737' name='L16737'></a> 16737 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L16738' name='L16738'></a> 16738           <a href='../S/2362.html#L4705' title='Defined at 4705 in src/gtkutil.c.'>xg_update_scrollbar_pos</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../D/19737.html' title='Multiple defined in 3 places.'>x_window</a>, top,
<a id='L16739' name='L16739'></a> 16739                                    left, width, <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> (height, 1));
<a id='L16740' name='L16740'></a> 16740 <em class='sharp'>#else</em> <em class='comment'>/* not USE_GTK */</em>
<a id='L16741' name='L16741'></a> 16741           XtConfigureWidget (<a href='../S/2212.html#L1554' title='Defined at 1554 in src/xterm.h.'>SCROLL_BAR_X_WIDGET</a> (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>),
<a id='L16742' name='L16742'></a> 16742                              left, top, width, <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> (height, 1), 0);
<a id='L16743' name='L16743'></a> 16743 <em class='sharp'>#endif</em> <em class='comment'>/* not USE_GTK */</em>
<a id='L16744' name='L16744'></a> 16744         <em class='brace'>}</em>
<a id='L16745' name='L16745'></a> 16745 <em class='sharp'>#else</em> <em class='comment'>/* not USE_TOOLKIT_SCROLL_BARS */</em>
<a id='L16746' name='L16746'></a> 16746 
<a id='L16747' name='L16747'></a> 16747       <em class='comment'>/* Move/size the scroll bar window.  */</em>
<a id='L16748' name='L16748'></a> 16748       <strong class='reserved'>if</strong> (mask)
<a id='L16749' name='L16749'></a> 16749         <em class='brace'>{</em>
<a id='L16750' name='L16750'></a> 16750           XWindowChanges wc;
<a id='L16751' name='L16751'></a> 16751 
<a id='L16752' name='L16752'></a> 16752           wc.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = left;
<a id='L16753' name='L16753'></a> 16753           wc.y = top;
<a id='L16754' name='L16754'></a> 16754           wc.width = width;
<a id='L16755' name='L16755'></a> 16755           wc.height = height;
<a id='L16756' name='L16756'></a> 16756           XConfigureWindow (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../D/19737.html' title='Multiple defined in 3 places.'>x_window</a>,
<a id='L16757' name='L16757'></a> 16757                             mask, &amp;wc);
<a id='L16758' name='L16758'></a> 16758         <em class='brace'>}</em>
<a id='L16759' name='L16759'></a> 16759 
<a id='L16760' name='L16760'></a> 16760 <em class='sharp'>#endif</em> <em class='comment'>/* not USE_TOOLKIT_SCROLL_BARS */</em>
<a id='L16761' name='L16761'></a> 16761 
<a id='L16762' name='L16762'></a> 16762       <em class='comment'>/* Remember new settings.  */</em>
<a id='L16763' name='L16763'></a> 16763       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;left = left;
<a id='L16764' name='L16764'></a> 16764       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;top = top;
<a id='L16765' name='L16765'></a> 16765       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;width = width;
<a id='L16766' name='L16766'></a> 16766       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;height = height;
<a id='L16767' name='L16767'></a> 16767 
<a id='L16768' name='L16768'></a> 16768 <em class='sharp'>#ifndef</em> USE_TOOLKIT_SCROLL_BARS
<a id='L16769' name='L16769'></a> 16769       <em class='comment'>/* Redraw the scroll bar.  */</em>
<a id='L16770' name='L16770'></a> 16770       x_scroll_bar_redraw (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L16771' name='L16771'></a> 16771 <em class='sharp'>#endif</em>
<a id='L16772' name='L16772'></a> 16772 
<a id='L16773' name='L16773'></a> 16773       <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L16774' name='L16774'></a> 16774     <em class='brace'>}</em>
<a id='L16775' name='L16775'></a> 16775 
<a id='L16776' name='L16776'></a> 16776 <em class='sharp'>#ifdef</em> USE_TOOLKIT_SCROLL_BARS
<a id='L16777' name='L16777'></a> 16777   x_set_toolkit_scroll_bar_thumb (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>, portion, <a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a>, whole);
<a id='L16778' name='L16778'></a> 16778 <em class='sharp'>#else</em> <em class='comment'>/* not USE_TOOLKIT_SCROLL_BARS */</em>
<a id='L16779' name='L16779'></a> 16779   <em class='comment'>/* Set the scroll bar's current state, unless we're currently being</em>
<a id='L16780' name='L16780'></a> 16780 <em class='comment'>     dragged.  */</em>
<a id='L16781' name='L16781'></a> 16781   <strong class='reserved'>if</strong> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging == -1)
<a id='L16782' name='L16782'></a> 16782     <em class='brace'>{</em>
<a id='L16783' name='L16783'></a> 16783       <strong class='reserved'>int</strong> top_range = <a href='../D/6684.html' title='Multiple defined in 2 places.'>VERTICAL_SCROLL_BAR_TOP_RANGE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, height);
<a id='L16784' name='L16784'></a> 16784 
<a id='L16785' name='L16785'></a> 16785       <strong class='reserved'>if</strong> (whole == 0)
<a id='L16786' name='L16786'></a> 16786         x_scroll_bar_set_handle (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>, 0, top_range, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L16787' name='L16787'></a> 16787       <strong class='reserved'>else</strong>
<a id='L16788' name='L16788'></a> 16788         <em class='brace'>{</em>
<a id='L16789' name='L16789'></a> 16789           <strong class='reserved'>int</strong> <a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a> = ((<strong class='reserved'>double</strong>) <a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a> * top_range) / whole;
<a id='L16790' name='L16790'></a> 16790           <strong class='reserved'>int</strong> end = ((<strong class='reserved'>double</strong>) (<a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a> + portion) * top_range) / whole;
<a id='L16791' name='L16791'></a> 16791           x_scroll_bar_set_handle (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>, <a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a>, end, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L16792' name='L16792'></a> 16792         <em class='brace'>}</em>
<a id='L16793' name='L16793'></a> 16793     <em class='brace'>}</em>
<a id='L16794' name='L16794'></a> 16794 <em class='sharp'>#endif</em> <em class='comment'>/* not USE_TOOLKIT_SCROLL_BARS */</em>
<a id='L16795' name='L16795'></a> 16795 
<a id='L16796' name='L16796'></a> 16796   <a href='../D/7360.html' title='Multiple defined in 2 places.'>XSETVECTOR</a> (barobj, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L16797' name='L16797'></a> 16797   <a href='../S/2317.html#L528' title='Defined at 528 in src/window.h.'>wset_vertical_scroll_bar</a> (w, barobj);
<a id='L16798' name='L16798'></a> 16798 <em class='brace'>}</em>
<a id='L16799' name='L16799'></a> 16799 
<a id='L16800' name='L16800'></a> 16800 
<a id='L16801' name='L16801'></a> 16801 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L16802' name='L16802'></a> 16802 XTset_horizontal_scroll_bar (<strong class='reserved'>struct</strong> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> *w, <strong class='reserved'>int</strong> portion, <strong class='reserved'>int</strong> whole, <strong class='reserved'>int</strong> <a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a>)
<a id='L16803' name='L16803'></a> 16803 <em class='brace'>{</em>
<a id='L16804' name='L16804'></a> 16804   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (w-&gt;<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>);
<a id='L16805' name='L16805'></a> 16805   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> barobj;
<a id='L16806' name='L16806'></a> 16806   <strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>;
<a id='L16807' name='L16807'></a> 16807   <strong class='reserved'>int</strong> top, height, left, width;
<a id='L16808' name='L16808'></a> 16808   <strong class='reserved'>int</strong> window_x, window_width;
<a id='L16809' name='L16809'></a> 16809   <strong class='reserved'>int</strong> pixel_width = <a href='../S/2317.html#L641' title='Defined at 641 in src/window.h.'>WINDOW_PIXEL_WIDTH</a> (w);
<a id='L16810' name='L16810'></a> 16810 
<a id='L16811' name='L16811'></a> 16811   <em class='comment'>/* Get window dimensions.  */</em>
<a id='L16812' name='L16812'></a> 16812   <a href='../S/2224.html#L1418' title='Defined at 1418 in src/xdisp.c.'>window_box</a> (w, <a href='../S/2315.html#L857' title='Defined at 857 in src/dispextern.h.'>ANY_AREA</a>, &amp;window_x, 0, &amp;window_width, 0);
<a id='L16813' name='L16813'></a> 16813   left = window_x;
<a id='L16814' name='L16814'></a> 16814   width = window_width;
<a id='L16815' name='L16815'></a> 16815   top = <a href='../S/2317.html#L1061' title='Defined at 1061 in src/window.h.'>WINDOW_SCROLL_BAR_AREA_Y</a> (w);
<a id='L16816' name='L16816'></a> 16816   height = <a href='../S/2317.html#L1006' title='Defined at 1006 in src/window.h.'>WINDOW_SCROLL_BAR_AREA_HEIGHT</a> (w);
<a id='L16817' name='L16817'></a> 16817 
<a id='L16818' name='L16818'></a> 16818   <em class='comment'>/* Does the scroll bar exist yet?  */</em>
<a id='L16819' name='L16819'></a> 16819   <strong class='reserved'>if</strong> (<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (w-&gt;horizontal_scroll_bar))
<a id='L16820' name='L16820'></a> 16820     <em class='brace'>{</em>
<a id='L16821' name='L16821'></a> 16821       <strong class='reserved'>if</strong> (width &gt; 0 &amp;&amp; height &gt; 0)
<a id='L16822' name='L16822'></a> 16822         <em class='brace'>{</em>
<a id='L16823' name='L16823'></a> 16823           <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L16824' name='L16824'></a> 16824 
<a id='L16825' name='L16825'></a> 16825           <em class='comment'>/* Clear also part between window_width and</em>
<a id='L16826' name='L16826'></a> 16826 <em class='comment'>             WINDOW_PIXEL_WIDTH.  */</em>
<a id='L16827' name='L16827'></a> 16827           <a href='../S/2289.html#L11076' title='Defined at 11076 in src/xterm.c.'>x_clear_area</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, left, top, pixel_width, height);
<a id='L16828' name='L16828'></a> 16828           <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L16829' name='L16829'></a> 16829         <em class='brace'>}</em>
<a id='L16830' name='L16830'></a> 16830 
<a id='L16831' name='L16831'></a> 16831       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> = x_scroll_bar_create (w, top, left, width, height, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L16832' name='L16832'></a> 16832     <em class='brace'>}</em>
<a id='L16833' name='L16833'></a> 16833   <strong class='reserved'>else</strong>
<a id='L16834' name='L16834'></a> 16834     <em class='brace'>{</em>
<a id='L16835' name='L16835'></a> 16835       <em class='comment'>/* It may just need to be moved and resized.  */</em>
<a id='L16836' name='L16836'></a> 16836       <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> mask = 0;
<a id='L16837' name='L16837'></a> 16837 
<a id='L16838' name='L16838'></a> 16838       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> = <a href='../D/7329.html' title='Multiple defined in 5 places.'>XSCROLL_BAR</a> (w-&gt;horizontal_scroll_bar);
<a id='L16839' name='L16839'></a> 16839 
<a id='L16840' name='L16840'></a> 16840       <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L16841' name='L16841'></a> 16841 
<a id='L16842' name='L16842'></a> 16842       <strong class='reserved'>if</strong> (left != <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;left)
<a id='L16843' name='L16843'></a> 16843         mask |= CWX;
<a id='L16844' name='L16844'></a> 16844       <strong class='reserved'>if</strong> (top != <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;top)
<a id='L16845' name='L16845'></a> 16845         mask |= CWY;
<a id='L16846' name='L16846'></a> 16846       <strong class='reserved'>if</strong> (width != <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;width)
<a id='L16847' name='L16847'></a> 16847         mask |= CWWidth;
<a id='L16848' name='L16848'></a> 16848       <strong class='reserved'>if</strong> (height != <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;height)
<a id='L16849' name='L16849'></a> 16849         mask |= CWHeight;
<a id='L16850' name='L16850'></a> 16850 
<a id='L16851' name='L16851'></a> 16851 <em class='sharp'>#ifdef</em> USE_TOOLKIT_SCROLL_BARS
<a id='L16852' name='L16852'></a> 16852       <em class='comment'>/* Move/size the scroll bar widget.  */</em>
<a id='L16853' name='L16853'></a> 16853       <strong class='reserved'>if</strong> (mask)
<a id='L16854' name='L16854'></a> 16854         <em class='brace'>{</em>
<a id='L16855' name='L16855'></a> 16855           <em class='comment'>/* Since toolkit scroll bars are smaller than the space reserved</em>
<a id='L16856' name='L16856'></a> 16856 <em class='comment'>             for them on the frame, we have to clear "under" them.  */</em>
<a id='L16857' name='L16857'></a> 16857           <strong class='reserved'>if</strong> (width &gt; 0 &amp;&amp; height &gt; 0)
<a id='L16858' name='L16858'></a> 16858             <a href='../S/2289.html#L11076' title='Defined at 11076 in src/xterm.c.'>x_clear_area</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>,
<a id='L16859' name='L16859'></a> 16859                           <a href='../S/2317.html#L751' title='Defined at 751 in src/window.h.'>WINDOW_LEFT_EDGE_X</a> (w), top,
<a id='L16860' name='L16860'></a> 16860                           pixel_width - <a href='../S/2317.html#L700' title='Defined at 700 in src/window.h.'>WINDOW_RIGHT_DIVIDER_WIDTH</a> (w), height);
<a id='L16861' name='L16861'></a> 16861 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L16862' name='L16862'></a> 16862           <a href='../S/2362.html#L4812' title='Defined at 4812 in src/gtkutil.c.'>xg_update_horizontal_scrollbar_pos</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../D/19737.html' title='Multiple defined in 3 places.'>x_window</a>, top, left,
<a id='L16863' name='L16863'></a> 16863                                               width, height);
<a id='L16864' name='L16864'></a> 16864 <em class='sharp'>#else</em> <em class='comment'>/* not USE_GTK */</em>
<a id='L16865' name='L16865'></a> 16865           XtConfigureWidget (<a href='../S/2212.html#L1554' title='Defined at 1554 in src/xterm.h.'>SCROLL_BAR_X_WIDGET</a> (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>),
<a id='L16866' name='L16866'></a> 16866                              left, top, width, height, 0);
<a id='L16867' name='L16867'></a> 16867 <em class='sharp'>#endif</em> <em class='comment'>/* not USE_GTK */</em>
<a id='L16868' name='L16868'></a> 16868         <em class='brace'>}</em>
<a id='L16869' name='L16869'></a> 16869 <em class='sharp'>#else</em> <em class='comment'>/* not USE_TOOLKIT_SCROLL_BARS */</em>
<a id='L16870' name='L16870'></a> 16870 
<a id='L16871' name='L16871'></a> 16871       <em class='comment'>/* Clear areas not covered by the scroll bar because it's not as</em>
<a id='L16872' name='L16872'></a> 16872 <em class='comment'>         wide as the area reserved for it.  This makes sure a</em>
<a id='L16873' name='L16873'></a> 16873 <em class='comment'>         previous mode line display is cleared after C-x 2 C-x 1, for</em>
<a id='L16874' name='L16874'></a> 16874 <em class='comment'>         example.  */</em>
<a id='L16875' name='L16875'></a> 16875       <em class='brace'>{</em>
<a id='L16876' name='L16876'></a> 16876         <strong class='reserved'>int</strong> area_height = <a href='../S/2317.html#L984' title='Defined at 984 in src/window.h.'>WINDOW_CONFIG_SCROLL_BAR_HEIGHT</a> (w);
<a id='L16877' name='L16877'></a> 16877         <strong class='reserved'>int</strong> rest = area_height - height;
<a id='L16878' name='L16878'></a> 16878         <strong class='reserved'>if</strong> (rest &gt; 0 &amp;&amp; width &gt; 0)
<a id='L16879' name='L16879'></a> 16879           <a href='../S/2289.html#L11076' title='Defined at 11076 in src/xterm.c.'>x_clear_area</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, left, top, width, rest);
<a id='L16880' name='L16880'></a> 16880       <em class='brace'>}</em>
<a id='L16881' name='L16881'></a> 16881 
<a id='L16882' name='L16882'></a> 16882       <em class='comment'>/* Move/size the scroll bar window.  */</em>
<a id='L16883' name='L16883'></a> 16883       <strong class='reserved'>if</strong> (mask)
<a id='L16884' name='L16884'></a> 16884         <em class='brace'>{</em>
<a id='L16885' name='L16885'></a> 16885           XWindowChanges wc;
<a id='L16886' name='L16886'></a> 16886 
<a id='L16887' name='L16887'></a> 16887           wc.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = left;
<a id='L16888' name='L16888'></a> 16888           wc.y = top;
<a id='L16889' name='L16889'></a> 16889           wc.width = width;
<a id='L16890' name='L16890'></a> 16890           wc.height = height;
<a id='L16891' name='L16891'></a> 16891           XConfigureWindow (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../D/19737.html' title='Multiple defined in 3 places.'>x_window</a>,
<a id='L16892' name='L16892'></a> 16892                             mask, &amp;wc);
<a id='L16893' name='L16893'></a> 16893         <em class='brace'>}</em>
<a id='L16894' name='L16894'></a> 16894 
<a id='L16895' name='L16895'></a> 16895 <em class='sharp'>#endif</em> <em class='comment'>/* not USE_TOOLKIT_SCROLL_BARS */</em>
<a id='L16896' name='L16896'></a> 16896 
<a id='L16897' name='L16897'></a> 16897       <em class='comment'>/* Remember new settings.  */</em>
<a id='L16898' name='L16898'></a> 16898       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;left = left;
<a id='L16899' name='L16899'></a> 16899       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;top = top;
<a id='L16900' name='L16900'></a> 16900       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;width = width;
<a id='L16901' name='L16901'></a> 16901       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;height = height;
<a id='L16902' name='L16902'></a> 16902 
<a id='L16903' name='L16903'></a> 16903       <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L16904' name='L16904'></a> 16904     <em class='brace'>}</em>
<a id='L16905' name='L16905'></a> 16905 
<a id='L16906' name='L16906'></a> 16906 <em class='sharp'>#ifdef</em> USE_TOOLKIT_SCROLL_BARS
<a id='L16907' name='L16907'></a> 16907   x_set_toolkit_horizontal_scroll_bar_thumb (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>, portion, <a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a>, whole);
<a id='L16908' name='L16908'></a> 16908 <em class='sharp'>#else</em> <em class='comment'>/* not USE_TOOLKIT_SCROLL_BARS */</em>
<a id='L16909' name='L16909'></a> 16909   <em class='comment'>/* Set the scroll bar's current state, unless we're currently being</em>
<a id='L16910' name='L16910'></a> 16910 <em class='comment'>     dragged.  */</em>
<a id='L16911' name='L16911'></a> 16911   <strong class='reserved'>if</strong> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging == -1)
<a id='L16912' name='L16912'></a> 16912     <em class='brace'>{</em>
<a id='L16913' name='L16913'></a> 16913       <strong class='reserved'>int</strong> left_range = <a href='../D/3078.html' title='Multiple defined in 2 places.'>HORIZONTAL_SCROLL_BAR_LEFT_RANGE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, width);
<a id='L16914' name='L16914'></a> 16914 
<a id='L16915' name='L16915'></a> 16915       <strong class='reserved'>if</strong> (whole == 0)
<a id='L16916' name='L16916'></a> 16916         x_scroll_bar_set_handle (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>, 0, left_range, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L16917' name='L16917'></a> 16917       <strong class='reserved'>else</strong>
<a id='L16918' name='L16918'></a> 16918         <em class='brace'>{</em>
<a id='L16919' name='L16919'></a> 16919           <strong class='reserved'>int</strong> <a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a> = ((<strong class='reserved'>double</strong>) <a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a> * left_range) / whole;
<a id='L16920' name='L16920'></a> 16920           <strong class='reserved'>int</strong> end = ((<strong class='reserved'>double</strong>) (<a href='../S/2361.html#L24' title='Defined at 24 in src/indent.h.'>position</a> + portion) * left_range) / whole;
<a id='L16921' name='L16921'></a> 16921           x_scroll_bar_set_handle (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>, <a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a>, end, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L16922' name='L16922'></a> 16922         <em class='brace'>}</em>
<a id='L16923' name='L16923'></a> 16923     <em class='brace'>}</em>
<a id='L16924' name='L16924'></a> 16924 <em class='sharp'>#endif</em> <em class='comment'>/* not USE_TOOLKIT_SCROLL_BARS */</em>
<a id='L16925' name='L16925'></a> 16925 
<a id='L16926' name='L16926'></a> 16926   <a href='../D/7360.html' title='Multiple defined in 2 places.'>XSETVECTOR</a> (barobj, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L16927' name='L16927'></a> 16927   <a href='../S/2317.html#L534' title='Defined at 534 in src/window.h.'>wset_horizontal_scroll_bar</a> (w, barobj);
<a id='L16928' name='L16928'></a> 16928 <em class='brace'>}</em>
<a id='L16929' name='L16929'></a> 16929 
<a id='L16930' name='L16930'></a> 16930 
<a id='L16931' name='L16931'></a> 16931 <em class='comment'>/* The following three hooks are used when we're doing a thorough</em>
<a id='L16932' name='L16932'></a> 16932 <em class='comment'>   redisplay of the frame.  We don't explicitly know which scroll bars</em>
<a id='L16933' name='L16933'></a> 16933 <em class='comment'>   are going to be deleted, because keeping track of when windows go</em>
<a id='L16934' name='L16934'></a> 16934 <em class='comment'>   away is a real pain - "Can you say set-window-configuration, boys</em>
<a id='L16935' name='L16935'></a> 16935 <em class='comment'>   and girls?"  Instead, we just assert at the beginning of redisplay</em>
<a id='L16936' name='L16936'></a> 16936 <em class='comment'>   that *all* scroll bars are to be removed, and then save a scroll bar</em>
<a id='L16937' name='L16937'></a> 16937 <em class='comment'>   from the fiery pit when we actually redisplay its window.  */</em>
<a id='L16938' name='L16938'></a> 16938 
<a id='L16939' name='L16939'></a> 16939 <em class='comment'>/* Arrange for all scroll bars on FRAME to be removed at the next call</em>
<a id='L16940' name='L16940'></a> 16940 <em class='comment'>   to `*judge_scroll_bars_hook'.  A scroll bar may be spared if</em>
<a id='L16941' name='L16941'></a> 16941 <em class='comment'>   `*redeem_scroll_bar_hook' is applied to its window before the judgment.  */</em>
<a id='L16942' name='L16942'></a> 16942 
<a id='L16943' name='L16943'></a> 16943 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L16944' name='L16944'></a> 16944 XTcondemn_scroll_bars (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)
<a id='L16945' name='L16945'></a> 16945 <em class='brace'>{</em>
<a id='L16946' name='L16946'></a> 16946   <strong class='reserved'>if</strong> (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (<a href='../S/2183.html#L1365' title='Defined at 1365 in src/frame.h.'>FRAME_SCROLL_BARS</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)))
<a id='L16947' name='L16947'></a> 16947     <em class='brace'>{</em>
<a id='L16948' name='L16948'></a> 16948       <strong class='reserved'>if</strong> (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (<a href='../S/2183.html#L1366' title='Defined at 1366 in src/frame.h.'>FRAME_CONDEMNED_SCROLL_BARS</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)))
<a id='L16949' name='L16949'></a> 16949         <em class='brace'>{</em>
<a id='L16950' name='L16950'></a> 16950           <em class='comment'>/* Prepend scrollbars to already condemned ones.  */</em>
<a id='L16951' name='L16951'></a> 16951           <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> last = <a href='../S/2183.html#L1365' title='Defined at 1365 in src/frame.h.'>FRAME_SCROLL_BARS</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>);
<a id='L16952' name='L16952'></a> 16952 
<a id='L16953' name='L16953'></a> 16953           <strong class='reserved'>while</strong> (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (<a href='../D/7329.html' title='Multiple defined in 5 places.'>XSCROLL_BAR</a> (last)-&gt;next))
<a id='L16954' name='L16954'></a> 16954             last = <a href='../D/7329.html' title='Multiple defined in 5 places.'>XSCROLL_BAR</a> (last)-&gt;next;
<a id='L16955' name='L16955'></a> 16955 
<a id='L16956' name='L16956'></a> 16956           <a href='../D/7329.html' title='Multiple defined in 5 places.'>XSCROLL_BAR</a> (last)-&gt;next = <a href='../S/2183.html#L1366' title='Defined at 1366 in src/frame.h.'>FRAME_CONDEMNED_SCROLL_BARS</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>);
<a id='L16957' name='L16957'></a> 16957           <a href='../D/7329.html' title='Multiple defined in 5 places.'>XSCROLL_BAR</a> (<a href='../S/2183.html#L1366' title='Defined at 1366 in src/frame.h.'>FRAME_CONDEMNED_SCROLL_BARS</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>))-&gt;prev = last;
<a id='L16958' name='L16958'></a> 16958         <em class='brace'>}</em>
<a id='L16959' name='L16959'></a> 16959 
<a id='L16960' name='L16960'></a> 16960       <a href='../S/2183.html#L748' title='Defined at 748 in src/frame.h.'>fset_condemned_scroll_bars</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../S/2183.html#L1365' title='Defined at 1365 in src/frame.h.'>FRAME_SCROLL_BARS</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>));
<a id='L16961' name='L16961'></a> 16961       <a href='../S/2183.html#L807' title='Defined at 807 in src/frame.h.'>fset_scroll_bars</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, Qnil);
<a id='L16962' name='L16962'></a> 16962     <em class='brace'>}</em>
<a id='L16963' name='L16963'></a> 16963 <em class='brace'>}</em>
<a id='L16964' name='L16964'></a> 16964 
<a id='L16965' name='L16965'></a> 16965 
<a id='L16966' name='L16966'></a> 16966 <em class='comment'>/* Un-mark WINDOW's scroll bar for deletion in this judgment cycle.</em>
<a id='L16967' name='L16967'></a> 16967 <em class='comment'>   Note that WINDOW isn't necessarily condemned at all.  */</em>
<a id='L16968' name='L16968'></a> 16968 
<a id='L16969' name='L16969'></a> 16969 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L16970' name='L16970'></a> 16970 XTredeem_scroll_bar (<strong class='reserved'>struct</strong> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> *w)
<a id='L16971' name='L16971'></a> 16971 <em class='brace'>{</em>
<a id='L16972' name='L16972'></a> 16972   <strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>;
<a id='L16973' name='L16973'></a> 16973   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> barobj;
<a id='L16974' name='L16974'></a> 16974   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L16975' name='L16975'></a> 16975 
<a id='L16976' name='L16976'></a> 16976   <em class='comment'>/* We can't redeem this window's scroll bar if it doesn't have one.  */</em>
<a id='L16977' name='L16977'></a> 16977   <strong class='reserved'>if</strong> (<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (w-&gt;vertical_scroll_bar) &amp;&amp; <a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (w-&gt;horizontal_scroll_bar))
<a id='L16978' name='L16978'></a> 16978     <a href='../D/10893.html' title='Multiple defined in 6 places.'>emacs_abort</a> ();
<a id='L16979' name='L16979'></a> 16979 
<a id='L16980' name='L16980'></a> 16980   <strong class='reserved'>if</strong> (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (w-&gt;vertical_scroll_bar) &amp;&amp; <a href='../S/2317.html#L887' title='Defined at 887 in src/window.h.'>WINDOW_HAS_VERTICAL_SCROLL_BAR</a> (w))
<a id='L16981' name='L16981'></a> 16981     <em class='brace'>{</em>
<a id='L16982' name='L16982'></a> 16982       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> = <a href='../D/7329.html' title='Multiple defined in 5 places.'>XSCROLL_BAR</a> (w-&gt;vertical_scroll_bar);
<a id='L16983' name='L16983'></a> 16983       <em class='comment'>/* Unlink it from the condemned list.  */</em>
<a id='L16984' name='L16984'></a> 16984       <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../S/2183.html#L914' title='Defined at 914 in src/frame.h.'>WINDOW_FRAME</a> (w));
<a id='L16985' name='L16985'></a> 16985       <strong class='reserved'>if</strong> (<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;prev))
<a id='L16986' name='L16986'></a> 16986         <em class='brace'>{</em>
<a id='L16987' name='L16987'></a> 16987           <em class='comment'>/* If the prev pointer is nil, it must be the first in one of</em>
<a id='L16988' name='L16988'></a> 16988 <em class='comment'>             the lists.  */</em>
<a id='L16989' name='L16989'></a> 16989           <strong class='reserved'>if</strong> (<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (<a href='../S/2183.html#L1365' title='Defined at 1365 in src/frame.h.'>FRAME_SCROLL_BARS</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), w-&gt;vertical_scroll_bar))
<a id='L16990' name='L16990'></a> 16990             <em class='comment'>/* It's not condemned.  Everything's fine.  */</em>
<a id='L16991' name='L16991'></a> 16991             <strong class='reserved'>goto</strong> horizontal;
<a id='L16992' name='L16992'></a> 16992           <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (<a href='../S/2183.html#L1366' title='Defined at 1366 in src/frame.h.'>FRAME_CONDEMNED_SCROLL_BARS</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L16993' name='L16993'></a> 16993                        w-&gt;vertical_scroll_bar))
<a id='L16994' name='L16994'></a> 16994             <a href='../S/2183.html#L748' title='Defined at 748 in src/frame.h.'>fset_condemned_scroll_bars</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;next);
<a id='L16995' name='L16995'></a> 16995           <strong class='reserved'>else</strong>
<a id='L16996' name='L16996'></a> 16996             <em class='comment'>/* If its prev pointer is nil, it must be at the front of</em>
<a id='L16997' name='L16997'></a> 16997 <em class='comment'>               one or the other!  */</em>
<a id='L16998' name='L16998'></a> 16998             <a href='../D/10893.html' title='Multiple defined in 6 places.'>emacs_abort</a> ();
<a id='L16999' name='L16999'></a> 16999         <em class='brace'>}</em>
<a id='L17000' name='L17000'></a> 17000       <strong class='reserved'>else</strong>
<a id='L17001' name='L17001'></a> 17001         <a href='../D/7329.html' title='Multiple defined in 5 places.'>XSCROLL_BAR</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;prev)-&gt;next = <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;next;
<a id='L17002' name='L17002'></a> 17002 
<a id='L17003' name='L17003'></a> 17003       <strong class='reserved'>if</strong> (! <a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;next))
<a id='L17004' name='L17004'></a> 17004         <a href='../D/7329.html' title='Multiple defined in 5 places.'>XSCROLL_BAR</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;next)-&gt;prev = <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;prev;
<a id='L17005' name='L17005'></a> 17005 
<a id='L17006' name='L17006'></a> 17006       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;next = <a href='../S/2183.html#L1365' title='Defined at 1365 in src/frame.h.'>FRAME_SCROLL_BARS</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L17007' name='L17007'></a> 17007       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;prev = Qnil;
<a id='L17008' name='L17008'></a> 17008       <a href='../D/7360.html' title='Multiple defined in 2 places.'>XSETVECTOR</a> (barobj, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L17009' name='L17009'></a> 17009       <a href='../S/2183.html#L807' title='Defined at 807 in src/frame.h.'>fset_scroll_bars</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, barobj);
<a id='L17010' name='L17010'></a> 17010       <strong class='reserved'>if</strong> (! <a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;next))
<a id='L17011' name='L17011'></a> 17011         <a href='../D/7360.html' title='Multiple defined in 2 places.'>XSETVECTOR</a> (<a href='../D/7329.html' title='Multiple defined in 5 places.'>XSCROLL_BAR</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;next)-&gt;prev, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L17012' name='L17012'></a> 17012     <em class='brace'>}</em>
<a id='L17013' name='L17013'></a> 17013 
<a id='L17014' name='L17014'></a> 17014  horizontal:
<a id='L17015' name='L17015'></a> 17015   <strong class='reserved'>if</strong> (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (w-&gt;horizontal_scroll_bar) &amp;&amp; <a href='../D/6824.html' title='Multiple defined in 2 places.'>WINDOW_HAS_HORIZONTAL_SCROLL_BAR</a> (w))
<a id='L17016' name='L17016'></a> 17016     <em class='brace'>{</em>
<a id='L17017' name='L17017'></a> 17017       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> = <a href='../D/7329.html' title='Multiple defined in 5 places.'>XSCROLL_BAR</a> (w-&gt;horizontal_scroll_bar);
<a id='L17018' name='L17018'></a> 17018       <em class='comment'>/* Unlink it from the condemned list.  */</em>
<a id='L17019' name='L17019'></a> 17019       <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../S/2183.html#L914' title='Defined at 914 in src/frame.h.'>WINDOW_FRAME</a> (w));
<a id='L17020' name='L17020'></a> 17020       <strong class='reserved'>if</strong> (<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;prev))
<a id='L17021' name='L17021'></a> 17021         <em class='brace'>{</em>
<a id='L17022' name='L17022'></a> 17022           <em class='comment'>/* If the prev pointer is nil, it must be the first in one of</em>
<a id='L17023' name='L17023'></a> 17023 <em class='comment'>             the lists.  */</em>
<a id='L17024' name='L17024'></a> 17024           <strong class='reserved'>if</strong> (<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (<a href='../S/2183.html#L1365' title='Defined at 1365 in src/frame.h.'>FRAME_SCROLL_BARS</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), w-&gt;horizontal_scroll_bar))
<a id='L17025' name='L17025'></a> 17025             <em class='comment'>/* It's not condemned.  Everything's fine.  */</em>
<a id='L17026' name='L17026'></a> 17026             <strong class='reserved'>return</strong>;
<a id='L17027' name='L17027'></a> 17027           <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (<a href='../S/2183.html#L1366' title='Defined at 1366 in src/frame.h.'>FRAME_CONDEMNED_SCROLL_BARS</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L17028' name='L17028'></a> 17028                        w-&gt;horizontal_scroll_bar))
<a id='L17029' name='L17029'></a> 17029             <a href='../S/2183.html#L748' title='Defined at 748 in src/frame.h.'>fset_condemned_scroll_bars</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;next);
<a id='L17030' name='L17030'></a> 17030           <strong class='reserved'>else</strong>
<a id='L17031' name='L17031'></a> 17031             <em class='comment'>/* If its prev pointer is nil, it must be at the front of</em>
<a id='L17032' name='L17032'></a> 17032 <em class='comment'>               one or the other!  */</em>
<a id='L17033' name='L17033'></a> 17033             <a href='../D/10893.html' title='Multiple defined in 6 places.'>emacs_abort</a> ();
<a id='L17034' name='L17034'></a> 17034         <em class='brace'>}</em>
<a id='L17035' name='L17035'></a> 17035       <strong class='reserved'>else</strong>
<a id='L17036' name='L17036'></a> 17036         <a href='../D/7329.html' title='Multiple defined in 5 places.'>XSCROLL_BAR</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;prev)-&gt;next = <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;next;
<a id='L17037' name='L17037'></a> 17037 
<a id='L17038' name='L17038'></a> 17038       <strong class='reserved'>if</strong> (! <a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;next))
<a id='L17039' name='L17039'></a> 17039         <a href='../D/7329.html' title='Multiple defined in 5 places.'>XSCROLL_BAR</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;next)-&gt;prev = <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;prev;
<a id='L17040' name='L17040'></a> 17040 
<a id='L17041' name='L17041'></a> 17041       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;next = <a href='../S/2183.html#L1365' title='Defined at 1365 in src/frame.h.'>FRAME_SCROLL_BARS</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L17042' name='L17042'></a> 17042       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;prev = Qnil;
<a id='L17043' name='L17043'></a> 17043       <a href='../D/7360.html' title='Multiple defined in 2 places.'>XSETVECTOR</a> (barobj, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L17044' name='L17044'></a> 17044       <a href='../S/2183.html#L807' title='Defined at 807 in src/frame.h.'>fset_scroll_bars</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, barobj);
<a id='L17045' name='L17045'></a> 17045       <strong class='reserved'>if</strong> (! <a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;next))
<a id='L17046' name='L17046'></a> 17046         <a href='../D/7360.html' title='Multiple defined in 2 places.'>XSETVECTOR</a> (<a href='../D/7329.html' title='Multiple defined in 5 places.'>XSCROLL_BAR</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;next)-&gt;prev, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L17047' name='L17047'></a> 17047     <em class='brace'>}</em>
<a id='L17048' name='L17048'></a> 17048 <em class='brace'>}</em>
<a id='L17049' name='L17049'></a> 17049 
<a id='L17050' name='L17050'></a> 17050 <em class='comment'>/* Remove all scroll bars on FRAME that haven't been saved since the</em>
<a id='L17051' name='L17051'></a> 17051 <em class='comment'>   last call to `*condemn_scroll_bars_hook'.  */</em>
<a id='L17052' name='L17052'></a> 17052 
<a id='L17053' name='L17053'></a> 17053 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L17054' name='L17054'></a> 17054 XTjudge_scroll_bars (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L17055' name='L17055'></a> 17055 <em class='brace'>{</em>
<a id='L17056' name='L17056'></a> 17056   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>, next;
<a id='L17057' name='L17057'></a> 17057 
<a id='L17058' name='L17058'></a> 17058   <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> = <a href='../S/2183.html#L1366' title='Defined at 1366 in src/frame.h.'>FRAME_CONDEMNED_SCROLL_BARS</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L17059' name='L17059'></a> 17059 
<a id='L17060' name='L17060'></a> 17060   <em class='comment'>/* Clear out the condemned list now so we won't try to process any</em>
<a id='L17061' name='L17061'></a> 17061 <em class='comment'>     more events on the hapless scroll bars.  */</em>
<a id='L17062' name='L17062'></a> 17062   <a href='../S/2183.html#L748' title='Defined at 748 in src/frame.h.'>fset_condemned_scroll_bars</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, Qnil);
<a id='L17063' name='L17063'></a> 17063 
<a id='L17064' name='L17064'></a> 17064   <strong class='reserved'>for</strong> (; ! <a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>); <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> = next)
<a id='L17065' name='L17065'></a> 17065     <em class='brace'>{</em>
<a id='L17066' name='L17066'></a> 17066       <strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a> = <a href='../D/7329.html' title='Multiple defined in 5 places.'>XSCROLL_BAR</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L17067' name='L17067'></a> 17067 
<a id='L17068' name='L17068'></a> 17068       x_scroll_bar_remove (<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>);
<a id='L17069' name='L17069'></a> 17069 
<a id='L17070' name='L17070'></a> 17070       next = <a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>-&gt;next;
<a id='L17071' name='L17071'></a> 17071       <a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>-&gt;next = <a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>-&gt;prev = Qnil;
<a id='L17072' name='L17072'></a> 17072     <em class='brace'>}</em>
<a id='L17073' name='L17073'></a> 17073 
<a id='L17074' name='L17074'></a> 17074   <em class='comment'>/* Now there should be no references to the condemned scroll bars,</em>
<a id='L17075' name='L17075'></a> 17075 <em class='comment'>     and they should get garbage-collected.  */</em>
<a id='L17076' name='L17076'></a> 17076 <em class='brace'>}</em>
<a id='L17077' name='L17077'></a> 17077 
<a id='L17078' name='L17078'></a> 17078 
<a id='L17079' name='L17079'></a> 17079 <em class='sharp'>#ifndef</em> USE_TOOLKIT_SCROLL_BARS
<a id='L17080' name='L17080'></a> 17080 <em class='comment'>/* Handle exposure event EVENT generated for F, by redrawing all</em>
<a id='L17081' name='L17081'></a> 17081 <em class='comment'>   intersecting scroll bars.  */</em>
<a id='L17082' name='L17082'></a> 17082 
<a id='L17083' name='L17083'></a> 17083 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L17084' name='L17084'></a> 17084 x_scroll_bar_handle_exposure (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, XEvent *event)
<a id='L17085' name='L17085'></a> 17085 <em class='brace'>{</em>
<a id='L17086' name='L17086'></a> 17086   <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, width, height;
<a id='L17087' name='L17087'></a> 17087   <a href='../S/2150.html#L62' title='Defined at 62 in src/pgtkgui.h.'>XRectangle</a> rect, scroll_bar_rect, intersection;
<a id='L17088' name='L17088'></a> 17088   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>, condemned;
<a id='L17089' name='L17089'></a> 17089   <strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>;
<a id='L17090' name='L17090'></a> 17090 
<a id='L17091' name='L17091'></a> 17091   <strong class='reserved'>if</strong> (event-&gt;type == GraphicsExpose)
<a id='L17092' name='L17092'></a> 17092     <em class='brace'>{</em>
<a id='L17093' name='L17093'></a> 17093       <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = event-&gt;xgraphicsexpose.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L17094' name='L17094'></a> 17094       y = event-&gt;xgraphicsexpose.y;
<a id='L17095' name='L17095'></a> 17095       width = event-&gt;xgraphicsexpose.width;
<a id='L17096' name='L17096'></a> 17096       height = event-&gt;xgraphicsexpose.height;
<a id='L17097' name='L17097'></a> 17097     <em class='brace'>}</em>
<a id='L17098' name='L17098'></a> 17098   <strong class='reserved'>else</strong>
<a id='L17099' name='L17099'></a> 17099     <em class='brace'>{</em>
<a id='L17100' name='L17100'></a> 17100       <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = event-&gt;xexpose.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L17101' name='L17101'></a> 17101       y = event-&gt;xexpose.y;
<a id='L17102' name='L17102'></a> 17102       width = event-&gt;xexpose.width;
<a id='L17103' name='L17103'></a> 17103       height = event-&gt;xexpose.height;
<a id='L17104' name='L17104'></a> 17104     <em class='brace'>}</em>
<a id='L17105' name='L17105'></a> 17105 
<a id='L17106' name='L17106'></a> 17106   rect.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L17107' name='L17107'></a> 17107   rect.y = y;
<a id='L17108' name='L17108'></a> 17108   rect.width = width;
<a id='L17109' name='L17109'></a> 17109   rect.height = height;
<a id='L17110' name='L17110'></a> 17110 
<a id='L17111' name='L17111'></a> 17111   <em class='comment'>/* Scan this frame's scroll bar list for intersecting scroll</em>
<a id='L17112' name='L17112'></a> 17112 <em class='comment'>     bars.  */</em>
<a id='L17113' name='L17113'></a> 17113   condemned = <a href='../S/2183.html#L1366' title='Defined at 1366 in src/frame.h.'>FRAME_CONDEMNED_SCROLL_BARS</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L17114' name='L17114'></a> 17114   <strong class='reserved'>for</strong> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> = <a href='../S/2183.html#L1365' title='Defined at 1365 in src/frame.h.'>FRAME_SCROLL_BARS</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L17115' name='L17115'></a> 17115        <em class='comment'>/* This trick allows us to search both the ordinary and</em>
<a id='L17116' name='L17116'></a> 17116 <em class='comment'>          condemned scroll bar lists with one loop.  */</em>
<a id='L17117' name='L17117'></a> 17117        !<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>) || (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> = condemned,
<a id='L17118' name='L17118'></a> 17118                        condemned = Qnil,
<a id='L17119' name='L17119'></a> 17119                        !<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>));
<a id='L17120' name='L17120'></a> 17120        <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> = <a href='../D/7329.html' title='Multiple defined in 5 places.'>XSCROLL_BAR</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>)-&gt;next)
<a id='L17121' name='L17121'></a> 17121     <em class='brace'>{</em>
<a id='L17122' name='L17122'></a> 17122       <a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a> = <a href='../D/7329.html' title='Multiple defined in 5 places.'>XSCROLL_BAR</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L17123' name='L17123'></a> 17123 
<a id='L17124' name='L17124'></a> 17124       scroll_bar_rect.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = <a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>-&gt;left;
<a id='L17125' name='L17125'></a> 17125       scroll_bar_rect.y = <a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>-&gt;top;
<a id='L17126' name='L17126'></a> 17126       scroll_bar_rect.width = <a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>-&gt;width;
<a id='L17127' name='L17127'></a> 17127       scroll_bar_rect.height = <a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>-&gt;height;
<a id='L17128' name='L17128'></a> 17128 
<a id='L17129' name='L17129'></a> 17129       <strong class='reserved'>if</strong> (<a href='../S/2224.html#L36555' title='Defined at 36555 in src/xdisp.c.'>gui_intersect_rectangles</a> (&amp;rect,
<a id='L17130' name='L17130'></a> 17130                                     &amp;scroll_bar_rect,
<a id='L17131' name='L17131'></a> 17131                                     &amp;intersection))
<a id='L17132' name='L17132'></a> 17132         x_scroll_bar_redraw (<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>);
<a id='L17133' name='L17133'></a> 17133     <em class='brace'>}</em>
<a id='L17134' name='L17134'></a> 17134 <em class='brace'>}</em>
<a id='L17135' name='L17135'></a> 17135 
<a id='L17136' name='L17136'></a> 17136 <em class='comment'>/* Redraw the scroll bar BAR.  Draw its border and set its thumb.</em>
<a id='L17137' name='L17137'></a> 17137 <em class='comment'>   This is usually called from x_clear_frame, but is also used to</em>
<a id='L17138' name='L17138'></a> 17138 <em class='comment'>   handle exposure events that overlap scroll bars.  */</em>
<a id='L17139' name='L17139'></a> 17139 
<a id='L17140' name='L17140'></a> 17140 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L17141' name='L17141'></a> 17141 x_scroll_bar_redraw (<strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>)
<a id='L17142' name='L17142'></a> 17142 <em class='brace'>{</em>
<a id='L17143' name='L17143'></a> 17143   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../S/2183.html#L914' title='Defined at 914 in src/frame.h.'>WINDOW_FRAME</a> (<a href='../D/7409.html' title='Multiple defined in 2 places.'>XWINDOW</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>)));
<a id='L17144' name='L17144'></a> 17144   <a href='../D/2619.html' title='Multiple defined in 2 places.'>GC</a> gc = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;normal_gc;
<a id='L17145' name='L17145'></a> 17145 
<a id='L17146' name='L17146'></a> 17146   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_background_pixel != -1)
<a id='L17147' name='L17147'></a> 17147     XSetForeground (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), gc,
<a id='L17148' name='L17148'></a> 17148                     <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_background_pixel);
<a id='L17149' name='L17149'></a> 17149   <strong class='reserved'>else</strong>
<a id='L17150' name='L17150'></a> 17150     XSetForeground (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), gc,
<a id='L17151' name='L17151'></a> 17151                     <a href='../S/2183.html#L1377' title='Defined at 1377 in src/frame.h.'>FRAME_BACKGROUND_PIXEL</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L17152' name='L17152'></a> 17152 
<a id='L17153' name='L17153'></a> 17153   XFillRectangle (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../S/2212.html#L1352' title='Defined at 1352 in src/xterm.h.'>FRAME_X_DRAWABLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), gc,
<a id='L17154' name='L17154'></a> 17154                   <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;left, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;top, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;width, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;height);
<a id='L17155' name='L17155'></a> 17155 
<a id='L17156' name='L17156'></a> 17156   XSetForeground (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), gc,
<a id='L17157' name='L17157'></a> 17157                   <a href='../S/2183.html#L1376' title='Defined at 1376 in src/frame.h.'>FRAME_FOREGROUND_PIXEL</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L17158' name='L17158'></a> 17158 
<a id='L17159' name='L17159'></a> 17159   x_scroll_bar_set_handle (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a>, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;end, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L17160' name='L17160'></a> 17160 
<a id='L17161' name='L17161'></a> 17161   <em class='comment'>/* Switch to scroll bar foreground color.  */</em>
<a id='L17162' name='L17162'></a> 17162   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_foreground_pixel != -1)
<a id='L17163' name='L17163'></a> 17163     XSetForeground (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), gc,
<a id='L17164' name='L17164'></a> 17164                     <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_foreground_pixel);
<a id='L17165' name='L17165'></a> 17165 
<a id='L17166' name='L17166'></a> 17166   <em class='comment'>/* Draw a one-pixel border just inside the edges of the scroll bar.  */</em>
<a id='L17167' name='L17167'></a> 17167   XDrawRectangle (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../S/2212.html#L1352' title='Defined at 1352 in src/xterm.h.'>FRAME_X_DRAWABLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), gc,
<a id='L17168' name='L17168'></a> 17168                   <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;left, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;top, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;width - 1, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;height - 1);
<a id='L17169' name='L17169'></a> 17169 
<a id='L17170' name='L17170'></a> 17170   <em class='comment'>/* Restore the foreground color of the GC if we changed it above.  */</em>
<a id='L17171' name='L17171'></a> 17171   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_foreground_pixel != -1)
<a id='L17172' name='L17172'></a> 17172     XSetForeground (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), gc,
<a id='L17173' name='L17173'></a> 17173                     <a href='../S/2183.html#L1376' title='Defined at 1376 in src/frame.h.'>FRAME_FOREGROUND_PIXEL</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L17174' name='L17174'></a> 17174 <em class='brace'>}</em>
<a id='L17175' name='L17175'></a> 17175 <em class='sharp'>#endif</em> <em class='comment'>/* not USE_TOOLKIT_SCROLL_BARS */</em>
<a id='L17176' name='L17176'></a> 17176 
<a id='L17177' name='L17177'></a> 17177 <em class='comment'>/* Handle a mouse click on the scroll bar BAR.  If *EMACS_EVENT's kind</em>
<a id='L17178' name='L17178'></a> 17178 <em class='comment'>   is set to something other than NO_EVENT, it is enqueued.</em>
<a id='L17179' name='L17179'></a> 17179 <em class='comment'></em>
<a id='L17180' name='L17180'></a> 17180 <em class='comment'>   This may be called from a signal handler, so we have to ignore GC</em>
<a id='L17181' name='L17181'></a> 17181 <em class='comment'>   mark bits.  */</em>
<a id='L17182' name='L17182'></a> 17182 
<a id='L17183' name='L17183'></a> 17183 
<a id='L17184' name='L17184'></a> 17184 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L17185' name='L17185'></a> 17185 x_scroll_bar_handle_click (<strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>,
<a id='L17186' name='L17186'></a> 17186                            <strong class='reserved'>const</strong> XEvent *event,
<a id='L17187' name='L17187'></a> 17187                            <strong class='reserved'>struct</strong> <a href='../S/2231.html#L350' title='Defined at 350 in src/termhooks.h.'>input_event</a> *emacs_event,
<a id='L17188' name='L17188'></a> 17188                            <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> device)
<a id='L17189' name='L17189'></a> 17189 <em class='brace'>{</em>
<a id='L17190' name='L17190'></a> 17190   <strong class='reserved'>int</strong> left_range, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, top_range, y;
<a id='L17191' name='L17191'></a> 17191 <em class='sharp'>#ifndef</em> USE_TOOLKIT_SCROLL_BARS
<a id='L17192' name='L17192'></a> 17192   <strong class='reserved'>int</strong> new_start, new_end;
<a id='L17193' name='L17193'></a> 17193 <em class='sharp'>#endif</em>
<a id='L17194' name='L17194'></a> 17194 
<a id='L17195' name='L17195'></a> 17195   <strong class='reserved'>if</strong> (! <a href='../D/6789.html' title='Multiple defined in 2 places.'>WINDOWP</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>))
<a id='L17196' name='L17196'></a> 17196     <a href='../D/10893.html' title='Multiple defined in 6 places.'>emacs_abort</a> ();
<a id='L17197' name='L17197'></a> 17197 
<a id='L17198' name='L17198'></a> 17198   emacs_event-&gt;kind = (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;horizontal
<a id='L17199' name='L17199'></a> 17199                        ? <a href='../S/2231.html#L172' title='Defined at 172 in src/termhooks.h.'>HORIZONTAL_SCROLL_BAR_CLICK_EVENT</a>
<a id='L17200' name='L17200'></a> 17200                        : <a href='../S/2231.html#L159' title='Defined at 159 in src/termhooks.h.'>SCROLL_BAR_CLICK_EVENT</a>);
<a id='L17201' name='L17201'></a> 17201   emacs_event-&gt;code = event-&gt;xbutton.button - Button1;
<a id='L17202' name='L17202'></a> 17202   emacs_event-&gt;modifiers
<a id='L17203' name='L17203'></a> 17203     = (x_x_to_emacs_modifiers (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a>
<a id='L17204' name='L17204'></a> 17204                                (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../S/2183.html#L914' title='Defined at 914 in src/frame.h.'>WINDOW_FRAME</a> (<a href='../D/7409.html' title='Multiple defined in 2 places.'>XWINDOW</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>)))),
<a id='L17205' name='L17205'></a> 17205                                event-&gt;xbutton.state)
<a id='L17206' name='L17206'></a> 17206        | (event-&gt;type == ButtonRelease
<a id='L17207' name='L17207'></a> 17207           ? <a href='../S/2231.html#L414' title='Defined at 414 in src/termhooks.h.'>up_modifier</a>
<a id='L17208' name='L17208'></a> 17208           : <a href='../S/2231.html#L417' title='Defined at 417 in src/termhooks.h.'>down_modifier</a>));
<a id='L17209' name='L17209'></a> 17209   emacs_event-&gt;frame_or_window = <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>;
<a id='L17210' name='L17210'></a> 17210   emacs_event-&gt;arg = Qnil;
<a id='L17211' name='L17211'></a> 17211   emacs_event-&gt;timestamp = event-&gt;xbutton.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L17212' name='L17212'></a> 17212 
<a id='L17213' name='L17213'></a> 17213   <strong class='reserved'>if</strong> (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (device))
<a id='L17214' name='L17214'></a> 17214     emacs_event-&gt;device = device;
<a id='L17215' name='L17215'></a> 17215 
<a id='L17216' name='L17216'></a> 17216   <strong class='reserved'>if</strong> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;horizontal)
<a id='L17217' name='L17217'></a> 17217     <em class='brace'>{</em>
<a id='L17218' name='L17218'></a> 17218 
<a id='L17219' name='L17219'></a> 17219       left_range = <a href='../D/3078.html' title='Multiple defined in 2 places.'>HORIZONTAL_SCROLL_BAR_LEFT_RANGE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;width);
<a id='L17220' name='L17220'></a> 17220       <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = event-&gt;xbutton.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> - <a href='../D/3077.html' title='Multiple defined in 2 places.'>HORIZONTAL_SCROLL_BAR_LEFT_BORDER</a>;
<a id='L17221' name='L17221'></a> 17221 
<a id='L17222' name='L17222'></a> 17222       <strong class='reserved'>if</strong> (<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> &lt; 0) <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = 0;
<a id='L17223' name='L17223'></a> 17223       <strong class='reserved'>if</strong> (<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> &gt; left_range) <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = left_range;
<a id='L17224' name='L17224'></a> 17224 
<a id='L17225' name='L17225'></a> 17225       <strong class='reserved'>if</strong> (<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> &lt; <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a>)
<a id='L17226' name='L17226'></a> 17226         emacs_event-&gt;part = <a href='../S/2231.html#L46' title='Defined at 46 in src/termhooks.h.'>scroll_bar_before_handle</a>;
<a id='L17227' name='L17227'></a> 17227       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> &lt; <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;end + <a href='../D/3079.html' title='Multiple defined in 2 places.'>HORIZONTAL_SCROLL_BAR_MIN_HANDLE</a>)
<a id='L17228' name='L17228'></a> 17228         emacs_event-&gt;part = <a href='../S/2231.html#L47' title='Defined at 47 in src/termhooks.h.'>scroll_bar_horizontal_handle</a>;
<a id='L17229' name='L17229'></a> 17229       <strong class='reserved'>else</strong>
<a id='L17230' name='L17230'></a> 17230         emacs_event-&gt;part = <a href='../S/2231.html#L48' title='Defined at 48 in src/termhooks.h.'>scroll_bar_after_handle</a>;
<a id='L17231' name='L17231'></a> 17231 
<a id='L17232' name='L17232'></a> 17232 <em class='sharp'>#ifndef</em> USE_TOOLKIT_SCROLL_BARS
<a id='L17233' name='L17233'></a> 17233       <em class='comment'>/* If the user has released the handle, set it to its final position.  */</em>
<a id='L17234' name='L17234'></a> 17234       <strong class='reserved'>if</strong> (event-&gt;type == ButtonRelease &amp;&amp; <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging != -1)
<a id='L17235' name='L17235'></a> 17235         <em class='brace'>{</em>
<a id='L17236' name='L17236'></a> 17236           new_start = - <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging;
<a id='L17237' name='L17237'></a> 17237           new_end = new_start + <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;end - <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a>;
<a id='L17238' name='L17238'></a> 17238 
<a id='L17239' name='L17239'></a> 17239           x_scroll_bar_set_handle (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>, new_start, new_end, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L17240' name='L17240'></a> 17240           <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging = -1;
<a id='L17241' name='L17241'></a> 17241         <em class='brace'>}</em>
<a id='L17242' name='L17242'></a> 17242 <em class='sharp'>#endif</em>
<a id='L17243' name='L17243'></a> 17243 
<a id='L17244' name='L17244'></a> 17244       <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (emacs_event-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, left_range);
<a id='L17245' name='L17245'></a> 17245       <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (emacs_event-&gt;y, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>);
<a id='L17246' name='L17246'></a> 17246     <em class='brace'>}</em>
<a id='L17247' name='L17247'></a> 17247   <strong class='reserved'>else</strong>
<a id='L17248' name='L17248'></a> 17248     <em class='brace'>{</em>
<a id='L17249' name='L17249'></a> 17249       top_range
<a id='L17250' name='L17250'></a> 17250         = <a href='../D/6684.html' title='Multiple defined in 2 places.'>VERTICAL_SCROLL_BAR_TOP_RANGE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;height);
<a id='L17251' name='L17251'></a> 17251       y = event-&gt;xbutton.y - <a href='../D/6683.html' title='Multiple defined in 2 places.'>VERTICAL_SCROLL_BAR_TOP_BORDER</a>;
<a id='L17252' name='L17252'></a> 17252 
<a id='L17253' name='L17253'></a> 17253       <strong class='reserved'>if</strong> (y &lt; 0) y = 0;
<a id='L17254' name='L17254'></a> 17254       <strong class='reserved'>if</strong> (y &gt; top_range) y = top_range;
<a id='L17255' name='L17255'></a> 17255 
<a id='L17256' name='L17256'></a> 17256       <strong class='reserved'>if</strong> (y &lt; <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a>)
<a id='L17257' name='L17257'></a> 17257         emacs_event-&gt;part = <a href='../S/2231.html#L37' title='Defined at 37 in src/termhooks.h.'>scroll_bar_above_handle</a>;
<a id='L17258' name='L17258'></a> 17258       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (y &lt; <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;end + <a href='../D/6681.html' title='Multiple defined in 2 places.'>VERTICAL_SCROLL_BAR_MIN_HANDLE</a>)
<a id='L17259' name='L17259'></a> 17259         emacs_event-&gt;part = <a href='../S/2231.html#L38' title='Defined at 38 in src/termhooks.h.'>scroll_bar_handle</a>;
<a id='L17260' name='L17260'></a> 17260       <strong class='reserved'>else</strong>
<a id='L17261' name='L17261'></a> 17261         emacs_event-&gt;part = <a href='../S/2231.html#L39' title='Defined at 39 in src/termhooks.h.'>scroll_bar_below_handle</a>;
<a id='L17262' name='L17262'></a> 17262 
<a id='L17263' name='L17263'></a> 17263 <em class='sharp'>#ifndef</em> USE_TOOLKIT_SCROLL_BARS
<a id='L17264' name='L17264'></a> 17264       <em class='comment'>/* If the user has released the handle, set it to its final position.  */</em>
<a id='L17265' name='L17265'></a> 17265       <strong class='reserved'>if</strong> (event-&gt;type == ButtonRelease &amp;&amp; <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging != -1)
<a id='L17266' name='L17266'></a> 17266         <em class='brace'>{</em>
<a id='L17267' name='L17267'></a> 17267           new_start = y - <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging;
<a id='L17268' name='L17268'></a> 17268           new_end = new_start + <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;end - <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a>;
<a id='L17269' name='L17269'></a> 17269 
<a id='L17270' name='L17270'></a> 17270           x_scroll_bar_set_handle (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>, new_start, new_end, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L17271' name='L17271'></a> 17271           <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging = -1;
<a id='L17272' name='L17272'></a> 17272         <em class='brace'>}</em>
<a id='L17273' name='L17273'></a> 17273 <em class='sharp'>#endif</em>
<a id='L17274' name='L17274'></a> 17274 
<a id='L17275' name='L17275'></a> 17275       <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (emacs_event-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y);
<a id='L17276' name='L17276'></a> 17276       <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (emacs_event-&gt;y, top_range);
<a id='L17277' name='L17277'></a> 17277     <em class='brace'>}</em>
<a id='L17278' name='L17278'></a> 17278 <em class='brace'>}</em>
<a id='L17279' name='L17279'></a> 17279 
<a id='L17280' name='L17280'></a> 17280 <em class='sharp'>#ifndef</em> USE_TOOLKIT_SCROLL_BARS
<a id='L17281' name='L17281'></a> 17281 
<a id='L17282' name='L17282'></a> 17282 <em class='comment'>/* Handle some mouse motion while someone is dragging the scroll bar.</em>
<a id='L17283' name='L17283'></a> 17283 <em class='comment'></em>
<a id='L17284' name='L17284'></a> 17284 <em class='comment'>   This may be called from a signal handler, so we have to ignore GC</em>
<a id='L17285' name='L17285'></a> 17285 <em class='comment'>   mark bits.  */</em>
<a id='L17286' name='L17286'></a> 17286 
<a id='L17287' name='L17287'></a> 17287 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L17288' name='L17288'></a> 17288 x_scroll_bar_note_movement (<strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>,
<a id='L17289' name='L17289'></a> 17289                             <strong class='reserved'>const</strong> XMotionEvent *event)
<a id='L17290' name='L17290'></a> 17290 <em class='brace'>{</em>
<a id='L17291' name='L17291'></a> 17291   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/7409.html' title='Multiple defined in 2 places.'>XWINDOW</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>)-&gt;<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>);
<a id='L17292' name='L17292'></a> 17292   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L17293' name='L17293'></a> 17293 
<a id='L17294' name='L17294'></a> 17294   dpyinfo-&gt;last_mouse_movement_time = event-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L17295' name='L17295'></a> 17295   dpyinfo-&gt;last_mouse_movement_time_send_event = event-&gt;send_event;
<a id='L17296' name='L17296'></a> 17296   dpyinfo-&gt;last_mouse_scroll_bar = <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>;
<a id='L17297' name='L17297'></a> 17297   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;mouse_moved = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L17298' name='L17298'></a> 17298 
<a id='L17299' name='L17299'></a> 17299   <em class='comment'>/* If we're dragging the bar, display it.  */</em>
<a id='L17300' name='L17300'></a> 17300   <strong class='reserved'>if</strong> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging != -1)
<a id='L17301' name='L17301'></a> 17301     <em class='brace'>{</em>
<a id='L17302' name='L17302'></a> 17302       <em class='comment'>/* Where should the handle be now?  */</em>
<a id='L17303' name='L17303'></a> 17303       <strong class='reserved'>int</strong> new_start = event-&gt;y - <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging;
<a id='L17304' name='L17304'></a> 17304 
<a id='L17305' name='L17305'></a> 17305       <strong class='reserved'>if</strong> (new_start != <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a>)
<a id='L17306' name='L17306'></a> 17306         <em class='brace'>{</em>
<a id='L17307' name='L17307'></a> 17307           <strong class='reserved'>int</strong> new_end = new_start + <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;end - <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a>;
<a id='L17308' name='L17308'></a> 17308 
<a id='L17309' name='L17309'></a> 17309           x_scroll_bar_set_handle (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>, new_start, new_end, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L17310' name='L17310'></a> 17310         <em class='brace'>}</em>
<a id='L17311' name='L17311'></a> 17311     <em class='brace'>}</em>
<a id='L17312' name='L17312'></a> 17312 <em class='brace'>}</em>
<a id='L17313' name='L17313'></a> 17313 
<a id='L17314' name='L17314'></a> 17314 <em class='sharp'>#endif</em> <em class='comment'>/* !USE_TOOLKIT_SCROLL_BARS */</em>
<a id='L17315' name='L17315'></a> 17315 
<a id='L17316' name='L17316'></a> 17316 <em class='comment'>/* Return information to the user about the current position of the mouse</em>
<a id='L17317' name='L17317'></a> 17317 <em class='comment'>   on the scroll bar.  */</em>
<a id='L17318' name='L17318'></a> 17318 
<a id='L17319' name='L17319'></a> 17319 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L17320' name='L17320'></a> 17320 x_scroll_bar_report_motion (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> **fp, <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> *bar_window,
<a id='L17321' name='L17321'></a> 17321                             <strong class='reserved'>enum</strong> <a href='../S/2231.html#L34' title='Defined at 34 in src/termhooks.h.'>scroll_bar_part</a> *part, <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> *<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>,
<a id='L17322' name='L17322'></a> 17322                             <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> *y, <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a> *timestamp)
<a id='L17323' name='L17323'></a> 17323 <em class='brace'>{</em>
<a id='L17324' name='L17324'></a> 17324   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (*fp);
<a id='L17325' name='L17325'></a> 17325   <strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> = dpyinfo-&gt;last_mouse_scroll_bar;
<a id='L17326' name='L17326'></a> 17326   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> w = <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../D/19737.html' title='Multiple defined in 3 places.'>x_window</a>;
<a id='L17327' name='L17327'></a> 17327   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../S/2183.html#L914' title='Defined at 914 in src/frame.h.'>WINDOW_FRAME</a> (<a href='../D/7409.html' title='Multiple defined in 2 places.'>XWINDOW</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>)));
<a id='L17328' name='L17328'></a> 17328   <strong class='reserved'>int</strong> win_x, win_y;
<a id='L17329' name='L17329'></a> 17329   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> dummy_window;
<a id='L17330' name='L17330'></a> 17330   <strong class='reserved'>int</strong> dummy_coord;
<a id='L17331' name='L17331'></a> 17331   <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> dummy_mask;
<a id='L17332' name='L17332'></a> 17332 
<a id='L17333' name='L17333'></a> 17333   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L17334' name='L17334'></a> 17334 
<a id='L17335' name='L17335'></a> 17335   <em class='comment'>/* Get the mouse's position relative to the scroll bar window, and</em>
<a id='L17336' name='L17336'></a> 17336 <em class='comment'>     report that.  */</em>
<a id='L17337' name='L17337'></a> 17337   <strong class='reserved'>if</strong> (x_query_pointer (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), w,
<a id='L17338' name='L17338'></a> 17338 
<a id='L17339' name='L17339'></a> 17339                        <em class='comment'>/* Root, child, root x and root y.  */</em>
<a id='L17340' name='L17340'></a> 17340                        &amp;dummy_window, &amp;dummy_window,
<a id='L17341' name='L17341'></a> 17341                        &amp;dummy_coord, &amp;dummy_coord,
<a id='L17342' name='L17342'></a> 17342 
<a id='L17343' name='L17343'></a> 17343                        <em class='comment'>/* Position relative to scroll bar.  */</em>
<a id='L17344' name='L17344'></a> 17344                        &amp;win_x, &amp;win_y,
<a id='L17345' name='L17345'></a> 17345 
<a id='L17346' name='L17346'></a> 17346                        <em class='comment'>/* Mouse buttons and modifier keys.  */</em>
<a id='L17347' name='L17347'></a> 17347                        &amp;dummy_mask))
<a id='L17348' name='L17348'></a> 17348     <em class='brace'>{</em>
<a id='L17349' name='L17349'></a> 17349       <strong class='reserved'>int</strong> top_range = <a href='../D/6684.html' title='Multiple defined in 2 places.'>VERTICAL_SCROLL_BAR_TOP_RANGE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;height);
<a id='L17350' name='L17350'></a> 17350 
<a id='L17351' name='L17351'></a> 17351       win_y -= <a href='../D/6683.html' title='Multiple defined in 2 places.'>VERTICAL_SCROLL_BAR_TOP_BORDER</a>;
<a id='L17352' name='L17352'></a> 17352 
<a id='L17353' name='L17353'></a> 17353       <strong class='reserved'>if</strong> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging != -1)
<a id='L17354' name='L17354'></a> 17354         win_y -= <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging;
<a id='L17355' name='L17355'></a> 17355 
<a id='L17356' name='L17356'></a> 17356       <strong class='reserved'>if</strong> (win_y &lt; 0)
<a id='L17357' name='L17357'></a> 17357         win_y = 0;
<a id='L17358' name='L17358'></a> 17358       <strong class='reserved'>if</strong> (win_y &gt; top_range)
<a id='L17359' name='L17359'></a> 17359         win_y = top_range;
<a id='L17360' name='L17360'></a> 17360 
<a id='L17361' name='L17361'></a> 17361       *fp = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L17362' name='L17362'></a> 17362       *bar_window = <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>;
<a id='L17363' name='L17363'></a> 17363 
<a id='L17364' name='L17364'></a> 17364       <strong class='reserved'>if</strong> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging != -1)
<a id='L17365' name='L17365'></a> 17365         *part = <a href='../S/2231.html#L38' title='Defined at 38 in src/termhooks.h.'>scroll_bar_handle</a>;
<a id='L17366' name='L17366'></a> 17366       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (win_y &lt; <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a>)
<a id='L17367' name='L17367'></a> 17367         *part = <a href='../S/2231.html#L37' title='Defined at 37 in src/termhooks.h.'>scroll_bar_above_handle</a>;
<a id='L17368' name='L17368'></a> 17368       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (win_y &lt; <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;end + <a href='../D/6681.html' title='Multiple defined in 2 places.'>VERTICAL_SCROLL_BAR_MIN_HANDLE</a>)
<a id='L17369' name='L17369'></a> 17369         *part = <a href='../S/2231.html#L38' title='Defined at 38 in src/termhooks.h.'>scroll_bar_handle</a>;
<a id='L17370' name='L17370'></a> 17370       <strong class='reserved'>else</strong>
<a id='L17371' name='L17371'></a> 17371         *part = <a href='../S/2231.html#L39' title='Defined at 39 in src/termhooks.h.'>scroll_bar_below_handle</a>;
<a id='L17372' name='L17372'></a> 17372 
<a id='L17373' name='L17373'></a> 17373       <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (*<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, win_y);
<a id='L17374' name='L17374'></a> 17374       <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (*y, top_range);
<a id='L17375' name='L17375'></a> 17375 
<a id='L17376' name='L17376'></a> 17376       <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;mouse_moved = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L17377' name='L17377'></a> 17377       dpyinfo-&gt;last_mouse_scroll_bar = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L17378' name='L17378'></a> 17378       *timestamp = dpyinfo-&gt;last_mouse_movement_time;
<a id='L17379' name='L17379'></a> 17379     <em class='brace'>}</em>
<a id='L17380' name='L17380'></a> 17380 
<a id='L17381' name='L17381'></a> 17381   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L17382' name='L17382'></a> 17382 <em class='brace'>}</em>
<a id='L17383' name='L17383'></a> 17383 
<a id='L17384' name='L17384'></a> 17384 
<a id='L17385' name='L17385'></a> 17385 <em class='comment'>/* Return information to the user about the current position of the mouse</em>
<a id='L17386' name='L17386'></a> 17386 <em class='comment'>   on the scroll bar.  */</em>
<a id='L17387' name='L17387'></a> 17387 
<a id='L17388' name='L17388'></a> 17388 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L17389' name='L17389'></a> 17389 x_horizontal_scroll_bar_report_motion (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> **fp, <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> *bar_window,
<a id='L17390' name='L17390'></a> 17390                                        <strong class='reserved'>enum</strong> <a href='../S/2231.html#L34' title='Defined at 34 in src/termhooks.h.'>scroll_bar_part</a> *part, <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> *<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>,
<a id='L17391' name='L17391'></a> 17391                                        <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> *y, <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a> *timestamp)
<a id='L17392' name='L17392'></a> 17392 <em class='brace'>{</em>
<a id='L17393' name='L17393'></a> 17393   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (*fp);
<a id='L17394' name='L17394'></a> 17394   <strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> = dpyinfo-&gt;last_mouse_scroll_bar;
<a id='L17395' name='L17395'></a> 17395   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> w = <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../D/19737.html' title='Multiple defined in 3 places.'>x_window</a>;
<a id='L17396' name='L17396'></a> 17396   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../S/2183.html#L914' title='Defined at 914 in src/frame.h.'>WINDOW_FRAME</a> (<a href='../D/7409.html' title='Multiple defined in 2 places.'>XWINDOW</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>)));
<a id='L17397' name='L17397'></a> 17397   <strong class='reserved'>int</strong> win_x, win_y;
<a id='L17398' name='L17398'></a> 17398   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> dummy_window;
<a id='L17399' name='L17399'></a> 17399   <strong class='reserved'>int</strong> dummy_coord;
<a id='L17400' name='L17400'></a> 17400   <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> dummy_mask;
<a id='L17401' name='L17401'></a> 17401 
<a id='L17402' name='L17402'></a> 17402   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L17403' name='L17403'></a> 17403 
<a id='L17404' name='L17404'></a> 17404   <em class='comment'>/* Get the mouse's position relative to the scroll bar window, and</em>
<a id='L17405' name='L17405'></a> 17405 <em class='comment'>     report that.  */</em>
<a id='L17406' name='L17406'></a> 17406   <strong class='reserved'>if</strong> (x_query_pointer (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), w,
<a id='L17407' name='L17407'></a> 17407 
<a id='L17408' name='L17408'></a> 17408                        <em class='comment'>/* Root, child, root x and root y.  */</em>
<a id='L17409' name='L17409'></a> 17409                        &amp;dummy_window, &amp;dummy_window,
<a id='L17410' name='L17410'></a> 17410                        &amp;dummy_coord, &amp;dummy_coord,
<a id='L17411' name='L17411'></a> 17411 
<a id='L17412' name='L17412'></a> 17412                        <em class='comment'>/* Position relative to scroll bar.  */</em>
<a id='L17413' name='L17413'></a> 17413                        &amp;win_x, &amp;win_y,
<a id='L17414' name='L17414'></a> 17414 
<a id='L17415' name='L17415'></a> 17415                        <em class='comment'>/* Mouse buttons and modifier keys.  */</em>
<a id='L17416' name='L17416'></a> 17416                        &amp;dummy_mask))
<a id='L17417' name='L17417'></a> 17417     <em class='brace'>{</em>
<a id='L17418' name='L17418'></a> 17418       <strong class='reserved'>int</strong> left_range = <a href='../D/3078.html' title='Multiple defined in 2 places.'>HORIZONTAL_SCROLL_BAR_LEFT_RANGE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;width);
<a id='L17419' name='L17419'></a> 17419 
<a id='L17420' name='L17420'></a> 17420       win_x -= <a href='../D/3077.html' title='Multiple defined in 2 places.'>HORIZONTAL_SCROLL_BAR_LEFT_BORDER</a>;
<a id='L17421' name='L17421'></a> 17421 
<a id='L17422' name='L17422'></a> 17422       <strong class='reserved'>if</strong> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging != -1)
<a id='L17423' name='L17423'></a> 17423         win_x -= <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging;
<a id='L17424' name='L17424'></a> 17424 
<a id='L17425' name='L17425'></a> 17425       <strong class='reserved'>if</strong> (win_x &lt; 0)
<a id='L17426' name='L17426'></a> 17426         win_x = 0;
<a id='L17427' name='L17427'></a> 17427       <strong class='reserved'>if</strong> (win_x &gt; left_range)
<a id='L17428' name='L17428'></a> 17428         win_x = left_range;
<a id='L17429' name='L17429'></a> 17429 
<a id='L17430' name='L17430'></a> 17430       *fp = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L17431' name='L17431'></a> 17431       *bar_window = <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>;
<a id='L17432' name='L17432'></a> 17432 
<a id='L17433' name='L17433'></a> 17433       <strong class='reserved'>if</strong> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;dragging != -1)
<a id='L17434' name='L17434'></a> 17434         *part = <a href='../S/2231.html#L47' title='Defined at 47 in src/termhooks.h.'>scroll_bar_horizontal_handle</a>;
<a id='L17435' name='L17435'></a> 17435       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (win_x &lt; <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a>)
<a id='L17436' name='L17436'></a> 17436         *part = <a href='../S/2231.html#L46' title='Defined at 46 in src/termhooks.h.'>scroll_bar_before_handle</a>;
<a id='L17437' name='L17437'></a> 17437       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (win_x &lt; <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;end + <a href='../D/3079.html' title='Multiple defined in 2 places.'>HORIZONTAL_SCROLL_BAR_MIN_HANDLE</a>)
<a id='L17438' name='L17438'></a> 17438         *part = <a href='../S/2231.html#L38' title='Defined at 38 in src/termhooks.h.'>scroll_bar_handle</a>;
<a id='L17439' name='L17439'></a> 17439       <strong class='reserved'>else</strong>
<a id='L17440' name='L17440'></a> 17440         *part = <a href='../S/2231.html#L48' title='Defined at 48 in src/termhooks.h.'>scroll_bar_after_handle</a>;
<a id='L17441' name='L17441'></a> 17441 
<a id='L17442' name='L17442'></a> 17442       <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (*y, win_x);
<a id='L17443' name='L17443'></a> 17443       <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (*<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, left_range);
<a id='L17444' name='L17444'></a> 17444 
<a id='L17445' name='L17445'></a> 17445       <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;mouse_moved = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L17446' name='L17446'></a> 17446       dpyinfo-&gt;last_mouse_scroll_bar = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L17447' name='L17447'></a> 17447       *timestamp = dpyinfo-&gt;last_mouse_movement_time;
<a id='L17448' name='L17448'></a> 17448     <em class='brace'>}</em>
<a id='L17449' name='L17449'></a> 17449 
<a id='L17450' name='L17450'></a> 17450   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L17451' name='L17451'></a> 17451 <em class='brace'>}</em>
<a id='L17452' name='L17452'></a> 17452 
<a id='L17453' name='L17453'></a> 17453 
<a id='L17454' name='L17454'></a> 17454 <em class='comment'>/* The screen has been cleared and foreground or background colors may</em>
<a id='L17455' name='L17455'></a> 17455 <em class='comment'>   have changed, so the scroll bars need to be redrawn.  Clear the</em>
<a id='L17456' name='L17456'></a> 17456 <em class='comment'>   scroll bars and redraw them.  */</em>
<a id='L17457' name='L17457'></a> 17457 
<a id='L17458' name='L17458'></a> 17458 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L17459' name='L17459'></a> 17459 x_scroll_bar_clear (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L17460' name='L17460'></a> 17460 <em class='brace'>{</em>
<a id='L17461' name='L17461'></a> 17461 <em class='sharp'>#ifndef</em> USE_TOOLKIT_SCROLL_BARS
<a id='L17462' name='L17462'></a> 17462   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>, condemned;
<a id='L17463' name='L17463'></a> 17463   <a href='../D/2619.html' title='Multiple defined in 2 places.'>GC</a> gc = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;normal_gc;
<a id='L17464' name='L17464'></a> 17464 
<a id='L17465' name='L17465'></a> 17465   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_background_pixel != -1)
<a id='L17466' name='L17466'></a> 17466     XSetForeground (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), gc,
<a id='L17467' name='L17467'></a> 17467                     <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_background_pixel);
<a id='L17468' name='L17468'></a> 17468   <strong class='reserved'>else</strong>
<a id='L17469' name='L17469'></a> 17469     XSetForeground (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), gc,
<a id='L17470' name='L17470'></a> 17470                     <a href='../S/2183.html#L1377' title='Defined at 1377 in src/frame.h.'>FRAME_BACKGROUND_PIXEL</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L17471' name='L17471'></a> 17471 
<a id='L17472' name='L17472'></a> 17472   <em class='comment'>/* We can have scroll bars even if this is 0,</em>
<a id='L17473' name='L17473'></a> 17473 <em class='comment'>     if we just turned off scroll bar mode.</em>
<a id='L17474' name='L17474'></a> 17474 <em class='comment'>     But in that case we should not clear them.  */</em>
<a id='L17475' name='L17475'></a> 17475   <strong class='reserved'>if</strong> (<a href='../D/2318.html' title='Multiple defined in 2 places.'>FRAME_HAS_VERTICAL_SCROLL_BARS</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L17476' name='L17476'></a> 17476     <em class='brace'>{</em>
<a id='L17477' name='L17477'></a> 17477       condemned = <a href='../S/2183.html#L1366' title='Defined at 1366 in src/frame.h.'>FRAME_CONDEMNED_SCROLL_BARS</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L17478' name='L17478'></a> 17478       <strong class='reserved'>for</strong> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> = <a href='../S/2183.html#L1365' title='Defined at 1365 in src/frame.h.'>FRAME_SCROLL_BARS</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L17479' name='L17479'></a> 17479            <em class='comment'>/* This trick allows us to search both the ordinary and</em>
<a id='L17480' name='L17480'></a> 17480 <em class='comment'>              condemned scroll bar lists with one loop.  */</em>
<a id='L17481' name='L17481'></a> 17481            !<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>) || (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> = condemned,
<a id='L17482' name='L17482'></a> 17482                            condemned = Qnil,
<a id='L17483' name='L17483'></a> 17483                            !<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>));
<a id='L17484' name='L17484'></a> 17484            <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> = <a href='../D/7329.html' title='Multiple defined in 5 places.'>XSCROLL_BAR</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>)-&gt;next)
<a id='L17485' name='L17485'></a> 17485         x_scroll_bar_redraw (<a href='../D/7329.html' title='Multiple defined in 5 places.'>XSCROLL_BAR</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>));
<a id='L17486' name='L17486'></a> 17486     <em class='brace'>}</em>
<a id='L17487' name='L17487'></a> 17487 
<a id='L17488' name='L17488'></a> 17488   XSetForeground (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), gc,
<a id='L17489' name='L17489'></a> 17489                   <a href='../S/2183.html#L1376' title='Defined at 1376 in src/frame.h.'>FRAME_FOREGROUND_PIXEL</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L17490' name='L17490'></a> 17490 <em class='sharp'>#endif</em> <em class='comment'>/* not USE_TOOLKIT_SCROLL_BARS */</em>
<a id='L17491' name='L17491'></a> 17491 <em class='brace'>}</em>
<a id='L17492' name='L17492'></a> 17492 
<a id='L17493' name='L17493'></a> 17493 <em class='sharp'>#ifdef</em> ENABLE_CHECKING
<a id='L17494' name='L17494'></a> 17494 
<a id='L17495' name='L17495'></a> 17495 <em class='comment'>/* Record the last 100 characters stored</em>
<a id='L17496' name='L17496'></a> 17496 <em class='comment'>   to help debug the loss-of-chars-during-GC problem.  */</em>
<a id='L17497' name='L17497'></a> 17497 
<a id='L17498' name='L17498'></a> 17498 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong> temp_index;
<a id='L17499' name='L17499'></a> 17499 <strong class='reserved'>static</strong> <strong class='reserved'>short</strong> temp_buffer[100];
<a id='L17500' name='L17500'></a> 17500 
<a id='L17501' name='L17501'></a> 17501 <em class='sharp'>#define</em> <a href='../R/5361.html' title='Multiple referred from 4 places.'>STORE_KEYSYM_FOR_DEBUG</a>(keysym)                          \
<a id='L17502' name='L17502'></a> 17502   <strong class='reserved'>if</strong> (temp_index == <a href='../D/185.html' title='Multiple defined in 3 places.'>ARRAYELTS</a> (temp_buffer))                    \
<a id='L17503' name='L17503'></a> 17503     temp_index = 0;                                             \
<a id='L17504' name='L17504'></a> 17504   temp_buffer[temp_index++] = (keysym)
<a id='L17505' name='L17505'></a> 17505 
<a id='L17506' name='L17506'></a> 17506 <em class='sharp'>#else</em> <em class='comment'>/* not ENABLE_CHECKING */</em>
<a id='L17507' name='L17507'></a> 17507 
<a id='L17508' name='L17508'></a> 17508 <em class='sharp'>#define</em> <a href='../R/5361.html' title='Multiple referred from 4 places.'>STORE_KEYSYM_FOR_DEBUG</a>(keysym) ((<strong class='reserved'>void</strong>)0)
<a id='L17509' name='L17509'></a> 17509 
<a id='L17510' name='L17510'></a> 17510 <em class='sharp'>#endif</em> <em class='comment'>/* ENABLE_CHECKING */</em>
<a id='L17511' name='L17511'></a> 17511 
<a id='L17512' name='L17512'></a> 17512 <em class='comment'>/* Set this to nonzero to fake an "X I/O error"</em>
<a id='L17513' name='L17513'></a> 17513 <em class='comment'>   on a particular display.  */</em>
<a id='L17514' name='L17514'></a> 17514 
<a id='L17515' name='L17515'></a> 17515 <strong class='reserved'>static</strong> <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *XTread_socket_fake_io_error;
<a id='L17516' name='L17516'></a> 17516 
<a id='L17517' name='L17517'></a> 17517 <em class='comment'>/* When we find no input here, we occasionally do a no-op command</em>
<a id='L17518' name='L17518'></a> 17518 <em class='comment'>   to verify that the X server is still running and we can still talk with it.</em>
<a id='L17519' name='L17519'></a> 17519 <em class='comment'>   We try all the open displays, one by one.</em>
<a id='L17520' name='L17520'></a> 17520 <em class='comment'>   This variable is used for cycling thru the displays.  */</em>
<a id='L17521' name='L17521'></a> 17521 
<a id='L17522' name='L17522'></a> 17522 <strong class='reserved'>static</strong> <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *next_noop_dpyinfo;
<a id='L17523' name='L17523'></a> 17523 
<a id='L17524' name='L17524'></a> 17524 <em class='comment'>/* Filter events for the current X input method.</em>
<a id='L17525' name='L17525'></a> 17525 <em class='comment'>   DPYINFO is the display this event is for.</em>
<a id='L17526' name='L17526'></a> 17526 <em class='comment'>   EVENT is the X event to filter.</em>
<a id='L17527' name='L17527'></a> 17527 <em class='comment'></em>
<a id='L17528' name='L17528'></a> 17528 <em class='comment'>   Returns non-zero if the event was filtered, caller shall not process</em>
<a id='L17529' name='L17529'></a> 17529 <em class='comment'>   this event further.</em>
<a id='L17530' name='L17530'></a> 17530 <em class='comment'>   Returns zero if event is wasn't filtered.  */</em>
<a id='L17531' name='L17531'></a> 17531 
<a id='L17532' name='L17532'></a> 17532 <em class='sharp'>#ifdef</em> HAVE_X_I18N
<a id='L17533' name='L17533'></a> 17533 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L17534' name='L17534'></a> 17534 x_filter_event (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo, XEvent *event)
<a id='L17535' name='L17535'></a> 17535 <em class='brace'>{</em>
<a id='L17536' name='L17536'></a> 17536   <em class='comment'>/* XFilterEvent returns non-zero if the input method has</em>
<a id='L17537' name='L17537'></a> 17537 <em class='comment'>   consumed the event.  We pass the frame's X window to</em>
<a id='L17538' name='L17538'></a> 17538 <em class='comment'>   XFilterEvent because that's the one for which the IC</em>
<a id='L17539' name='L17539'></a> 17539 <em class='comment'>   was created.  */</em>
<a id='L17540' name='L17540'></a> 17540 
<a id='L17541' name='L17541'></a> 17541   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a>;
<a id='L17542' name='L17542'></a> 17542 
<a id='L17543' name='L17543'></a> 17543 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XINPUT2 &amp;&amp; <strong class='reserved'>defined</strong> USE_GTK
<a id='L17544' name='L17544'></a> 17544   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> xinput_event = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L17545' name='L17545'></a> 17545   <strong class='reserved'>if</strong> (dpyinfo-&gt;supports_xi2
<a id='L17546' name='L17546'></a> 17546       &amp;&amp; event-&gt;type == GenericEvent
<a id='L17547' name='L17547'></a> 17547       &amp;&amp; (event-&gt;xgeneric.extension
<a id='L17548' name='L17548'></a> 17548           == dpyinfo-&gt;xi2_opcode)
<a id='L17549' name='L17549'></a> 17549       &amp;&amp; ((event-&gt;xgeneric.evtype
<a id='L17550' name='L17550'></a> 17550            == XI_KeyPress)
<a id='L17551' name='L17551'></a> 17551           || (event-&gt;xgeneric.evtype
<a id='L17552' name='L17552'></a> 17552               == XI_KeyRelease)))
<a id='L17553' name='L17553'></a> 17553     <em class='brace'>{</em>
<a id='L17554' name='L17554'></a> 17554       <a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a> = <a href='../D/19416.html' title='Multiple defined in 2 places.'>x_any_window_to_frame</a> (dpyinfo,
<a id='L17555' name='L17555'></a> 17555                                   ((XIDeviceEvent *)
<a id='L17556' name='L17556'></a> 17556                                    event-&gt;xcookie.data)-&gt;event);
<a id='L17557' name='L17557'></a> 17557       xinput_event = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L17558' name='L17558'></a> 17558     <em class='brace'>}</em>
<a id='L17559' name='L17559'></a> 17559   <strong class='reserved'>else</strong>
<a id='L17560' name='L17560'></a> 17560 <em class='sharp'>#endif</em>
<a id='L17561' name='L17561'></a> 17561     <a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a> = <a href='../D/19416.html' title='Multiple defined in 2 places.'>x_any_window_to_frame</a> (dpyinfo,
<a id='L17562' name='L17562'></a> 17562                                 event-&gt;xclient.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L17563' name='L17563'></a> 17563 
<a id='L17564' name='L17564'></a> 17564 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L17565' name='L17565'></a> 17565   <strong class='reserved'>if</strong> (!x_gtk_use_native_input
<a id='L17566' name='L17566'></a> 17566       &amp;&amp; !dpyinfo-&gt;prefer_native_input)
<a id='L17567' name='L17567'></a> 17567     <em class='brace'>{</em>
<a id='L17568' name='L17568'></a> 17568 <em class='sharp'>#endif</em>
<a id='L17569' name='L17569'></a> 17569       <strong class='reserved'>return</strong> XFilterEvent (event, <a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a> ? <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a>) : None);
<a id='L17570' name='L17570'></a> 17570 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L17571' name='L17571'></a> 17571     <em class='brace'>}</em>
<a id='L17572' name='L17572'></a> 17572   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a> &amp;&amp; (event-&gt;type == KeyPress
<a id='L17573' name='L17573'></a> 17573                   || event-&gt;type == KeyRelease
<a id='L17574' name='L17574'></a> 17574 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L17575' name='L17575'></a> 17575                   || xinput_event
<a id='L17576' name='L17576'></a> 17576 <em class='sharp'>#endif</em>
<a id='L17577' name='L17577'></a> 17577                   ))
<a id='L17578' name='L17578'></a> 17578     <em class='brace'>{</em>
<a id='L17579' name='L17579'></a> 17579       <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> result;
<a id='L17580' name='L17580'></a> 17580 
<a id='L17581' name='L17581'></a> 17581       <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L17582' name='L17582'></a> 17582       result = <a href='../S/2362.html#L6561' title='Defined at 6561 in src/gtkutil.c.'>xg_filter_key</a> (<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a>, event);
<a id='L17583' name='L17583'></a> 17583       <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L17584' name='L17584'></a> 17584 
<a id='L17585' name='L17585'></a> 17585       <em class='comment'>/* Clear `xg_pending_quit_event' so we don't end up reacting to quit</em>
<a id='L17586' name='L17586'></a> 17586 <em class='comment'>         events sent outside the main event loop (i.e. those sent from</em>
<a id='L17587' name='L17587'></a> 17587 <em class='comment'>         inside a popup menu event loop).  */</em>
<a id='L17588' name='L17588'></a> 17588 
<a id='L17589' name='L17589'></a> 17589       <strong class='reserved'>if</strong> (<a href='../D/15672.html' title='Multiple defined in 5 places.'>popup_activated</a> ())
<a id='L17590' name='L17590'></a> 17590         xg_pending_quit_event.kind = <a href='../S/2231.html#L74' title='Defined at 74 in src/termhooks.h.'>NO_EVENT</a>;
<a id='L17591' name='L17591'></a> 17591 
<a id='L17592' name='L17592'></a> 17592       <strong class='reserved'>if</strong> (result &amp;&amp; <a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a>)
<a id='L17593' name='L17593'></a> 17593         <em class='comment'>/* There will probably be a GDK event generated soon, so</em>
<a id='L17594' name='L17594'></a> 17594 <em class='comment'>           exercise the wire to make pselect return.  */</em>
<a id='L17595' name='L17595'></a> 17595         XNoOp (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a>));
<a id='L17596' name='L17596'></a> 17596 
<a id='L17597' name='L17597'></a> 17597       <strong class='reserved'>return</strong> result;
<a id='L17598' name='L17598'></a> 17598     <em class='brace'>}</em>
<a id='L17599' name='L17599'></a> 17599 
<a id='L17600' name='L17600'></a> 17600   <strong class='reserved'>return</strong> 0;
<a id='L17601' name='L17601'></a> 17601 <em class='sharp'>#endif</em>
<a id='L17602' name='L17602'></a> 17602 <em class='brace'>}</em>
<a id='L17603' name='L17603'></a> 17603 <em class='sharp'>#endif</em>
<a id='L17604' name='L17604'></a> 17604 
<a id='L17605' name='L17605'></a> 17605 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L17606' name='L17606'></a> 17606 <em class='comment'>/* This is the filter function invoked by the GTK event loop.</em>
<a id='L17607' name='L17607'></a> 17607 <em class='comment'>   It is invoked before the XEvent is translated to a GdkEvent,</em>
<a id='L17608' name='L17608'></a> 17608 <em class='comment'>   so we have a chance to act on the event before GTK.  */</em>
<a id='L17609' name='L17609'></a> 17609 <strong class='reserved'>static</strong> GdkFilterReturn
<a id='L17610' name='L17610'></a> 17610 event_handler_gdk (GdkXEvent *gxev, GdkEvent *ev, gpointer data)
<a id='L17611' name='L17611'></a> 17611 <em class='brace'>{</em>
<a id='L17612' name='L17612'></a> 17612   XEvent *xev = (XEvent *) gxev;
<a id='L17613' name='L17613'></a> 17613 
<a id='L17614' name='L17614'></a> 17614   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L17615' name='L17615'></a> 17615   <strong class='reserved'>if</strong> (current_count &gt;= 0)
<a id='L17616' name='L17616'></a> 17616     <em class='brace'>{</em>
<a id='L17617' name='L17617'></a> 17617       <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L17618' name='L17618'></a> 17618 
<a id='L17619' name='L17619'></a> 17619       dpyinfo = <a href='../S/2289.html#L6774' title='Defined at 6774 in src/xterm.c.'>x_display_info_for_display</a> (xev-&gt;xany.<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L17620' name='L17620'></a> 17620 
<a id='L17621' name='L17621'></a> 17621 <em class='sharp'>#ifdef</em> HAVE_X_I18N
<a id='L17622' name='L17622'></a> 17622       <em class='comment'>/* Filter events for the current X input method.</em>
<a id='L17623' name='L17623'></a> 17623 <em class='comment'>         GTK calls XFilterEvent but not for key press and release,</em>
<a id='L17624' name='L17624'></a> 17624 <em class='comment'>         so we do it here.  */</em>
<a id='L17625' name='L17625'></a> 17625       <strong class='reserved'>if</strong> ((xev-&gt;type == KeyPress || xev-&gt;type == KeyRelease)
<a id='L17626' name='L17626'></a> 17626           &amp;&amp; dpyinfo
<a id='L17627' name='L17627'></a> 17627           &amp;&amp; x_filter_event (dpyinfo, xev))
<a id='L17628' name='L17628'></a> 17628         <em class='brace'>{</em>
<a id='L17629' name='L17629'></a> 17629           <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L17630' name='L17630'></a> 17630           <strong class='reserved'>return</strong> GDK_FILTER_REMOVE;
<a id='L17631' name='L17631'></a> 17631         <em class='brace'>}</em>
<a id='L17632' name='L17632'></a> 17632 <em class='sharp'>#elif</em> USE_GTK
<a id='L17633' name='L17633'></a> 17633       <strong class='reserved'>if</strong> (dpyinfo &amp;&amp; (dpyinfo-&gt;prefer_native_input
<a id='L17634' name='L17634'></a> 17634                       || x_gtk_use_native_input)
<a id='L17635' name='L17635'></a> 17635           &amp;&amp; (xev-&gt;type == KeyPress
<a id='L17636' name='L17636'></a> 17636 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L17637' name='L17637'></a> 17637               <em class='comment'>/* GTK claims cookies for us, so we don't have to claim</em>
<a id='L17638' name='L17638'></a> 17638 <em class='comment'>                 them here.  */</em>
<a id='L17639' name='L17639'></a> 17639               || (dpyinfo-&gt;supports_xi2
<a id='L17640' name='L17640'></a> 17640                   &amp;&amp; xev-&gt;type == GenericEvent
<a id='L17641' name='L17641'></a> 17641                   &amp;&amp; (xev-&gt;xgeneric.extension
<a id='L17642' name='L17642'></a> 17642                       == dpyinfo-&gt;xi2_opcode)
<a id='L17643' name='L17643'></a> 17643                   &amp;&amp; ((xev-&gt;xgeneric.evtype
<a id='L17644' name='L17644'></a> 17644                        == XI_KeyPress)
<a id='L17645' name='L17645'></a> 17645                       || (xev-&gt;xgeneric.evtype
<a id='L17646' name='L17646'></a> 17646                           == XI_KeyRelease)))
<a id='L17647' name='L17647'></a> 17647 <em class='sharp'>#endif</em>
<a id='L17648' name='L17648'></a> 17648               ))
<a id='L17649' name='L17649'></a> 17649         <em class='brace'>{</em>
<a id='L17650' name='L17650'></a> 17650           <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L17651' name='L17651'></a> 17651 
<a id='L17652' name='L17652'></a> 17652 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L17653' name='L17653'></a> 17653           <strong class='reserved'>if</strong> (xev-&gt;type == GenericEvent)
<a id='L17654' name='L17654'></a> 17654             <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../D/19416.html' title='Multiple defined in 2 places.'>x_any_window_to_frame</a> (dpyinfo,
<a id='L17655' name='L17655'></a> 17655                                        ((XIDeviceEvent *) xev-&gt;xcookie.data)-&gt;event);
<a id='L17656' name='L17656'></a> 17656           <strong class='reserved'>else</strong>
<a id='L17657' name='L17657'></a> 17657 <em class='sharp'>#endif</em>
<a id='L17658' name='L17658'></a> 17658             <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../D/19416.html' title='Multiple defined in 2 places.'>x_any_window_to_frame</a> (dpyinfo, xev-&gt;xany.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L17659' name='L17659'></a> 17659 
<a id='L17660' name='L17660'></a> 17660           <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; <a href='../S/2362.html#L6561' title='Defined at 6561 in src/gtkutil.c.'>xg_filter_key</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, xev))
<a id='L17661' name='L17661'></a> 17661             <em class='brace'>{</em>
<a id='L17662' name='L17662'></a> 17662               <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L17663' name='L17663'></a> 17663               <strong class='reserved'>return</strong> GDK_FILTER_REMOVE;
<a id='L17664' name='L17664'></a> 17664             <em class='brace'>}</em>
<a id='L17665' name='L17665'></a> 17665         <em class='brace'>}</em>
<a id='L17666' name='L17666'></a> 17666 <em class='sharp'>#endif</em>
<a id='L17667' name='L17667'></a> 17667 
<a id='L17668' name='L17668'></a> 17668       <strong class='reserved'>if</strong> (! dpyinfo)
<a id='L17669' name='L17669'></a> 17669         current_finish = <a href='../S/2289.html#L1134' title='Defined at 1134 in src/xterm.c.'>X_EVENT_NORMAL</a>;
<a id='L17670' name='L17670'></a> 17670       <strong class='reserved'>else</strong>
<a id='L17671' name='L17671'></a> 17671         current_count
<a id='L17672' name='L17672'></a> 17672           += handle_one_xevent (dpyinfo, xev, &amp;current_finish,
<a id='L17673' name='L17673'></a> 17673                                 current_hold_quit);
<a id='L17674' name='L17674'></a> 17674     <em class='brace'>}</em>
<a id='L17675' name='L17675'></a> 17675   <strong class='reserved'>else</strong>
<a id='L17676' name='L17676'></a> 17676     current_finish = x_dispatch_event (xev, xev-&gt;xany.<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L17677' name='L17677'></a> 17677 
<a id='L17678' name='L17678'></a> 17678   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L17679' name='L17679'></a> 17679 
<a id='L17680' name='L17680'></a> 17680   <strong class='reserved'>if</strong> (current_finish == <a href='../S/2289.html#L1135' title='Defined at 1135 in src/xterm.c.'>X_EVENT_GOTO_OUT</a> || current_finish == <a href='../S/2289.html#L1136' title='Defined at 1136 in src/xterm.c.'>X_EVENT_DROP</a>)
<a id='L17681' name='L17681'></a> 17681     <strong class='reserved'>return</strong> GDK_FILTER_REMOVE;
<a id='L17682' name='L17682'></a> 17682 
<a id='L17683' name='L17683'></a> 17683   <strong class='reserved'>return</strong> GDK_FILTER_CONTINUE;
<a id='L17684' name='L17684'></a> 17684 <em class='brace'>}</em>
<a id='L17685' name='L17685'></a> 17685 <em class='sharp'>#endif</em> <em class='comment'>/* USE_GTK */</em>
<a id='L17686' name='L17686'></a> 17686 
<a id='L17687' name='L17687'></a> 17687 
<a id='L17688' name='L17688'></a> 17688 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong> xembed_send_message (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a>,
<a id='L17689' name='L17689'></a> 17689                                  <strong class='reserved'>enum</strong> <a href='../S/2289.html#L1144' title='Defined at 1144 in src/xterm.c.'>xembed_message</a>,
<a id='L17690' name='L17690'></a> 17690                                  <strong class='reserved'>long</strong> detail, <strong class='reserved'>long</strong> data1, <strong class='reserved'>long</strong> data2);
<a id='L17691' name='L17691'></a> 17691 
<a id='L17692' name='L17692'></a> 17692 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L17693' name='L17693'></a> 17693 x_net_wm_state (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>)
<a id='L17694' name='L17694'></a> 17694 <em class='brace'>{</em>
<a id='L17695' name='L17695'></a> 17695   <strong class='reserved'>int</strong> <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a> = <a href='../S/2183.html#L38' title='Defined at 38 in src/frame.h.'>FULLSCREEN_NONE</a>;
<a id='L17696' name='L17696'></a> 17696   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> lval = Qnil;
<a id='L17697' name='L17697'></a> 17697   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> sticky = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>, shaded = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L17698' name='L17698'></a> 17698 
<a id='L17699' name='L17699'></a> 17699   x_get_current_wm_state (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, &amp;<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>, &amp;sticky, &amp;shaded);
<a id='L17700' name='L17700'></a> 17700 
<a id='L17701' name='L17701'></a> 17701   <strong class='reserved'>switch</strong> (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>)
<a id='L17702' name='L17702'></a> 17702     <em class='brace'>{</em>
<a id='L17703' name='L17703'></a> 17703     <strong class='reserved'>case</strong> <a href='../S/2183.html#L39' title='Defined at 39 in src/frame.h.'>FULLSCREEN_WIDTH</a>:
<a id='L17704' name='L17704'></a> 17704       lval = Qfullwidth;
<a id='L17705' name='L17705'></a> 17705       <strong class='reserved'>break</strong>;
<a id='L17706' name='L17706'></a> 17706     <strong class='reserved'>case</strong> <a href='../S/2183.html#L40' title='Defined at 40 in src/frame.h.'>FULLSCREEN_HEIGHT</a>:
<a id='L17707' name='L17707'></a> 17707       lval = Qfullheight;
<a id='L17708' name='L17708'></a> 17708       <strong class='reserved'>break</strong>;
<a id='L17709' name='L17709'></a> 17709     <strong class='reserved'>case</strong> <a href='../S/2183.html#L41' title='Defined at 41 in src/frame.h.'>FULLSCREEN_BOTH</a>:
<a id='L17710' name='L17710'></a> 17710       lval = Qfullboth;
<a id='L17711' name='L17711'></a> 17711       <strong class='reserved'>break</strong>;
<a id='L17712' name='L17712'></a> 17712     <strong class='reserved'>case</strong> <a href='../S/2183.html#L42' title='Defined at 42 in src/frame.h.'>FULLSCREEN_MAXIMIZED</a>:
<a id='L17713' name='L17713'></a> 17713       lval = Qmaximized;
<a id='L17714' name='L17714'></a> 17714       <strong class='reserved'>break</strong>;
<a id='L17715' name='L17715'></a> 17715     <em class='brace'>}</em>
<a id='L17716' name='L17716'></a> 17716 
<a id='L17717' name='L17717'></a> 17717   <a href='../S/2247.html#L3214' title='Defined at 3214 in src/frame.c.'>store_frame_param</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, Qfullscreen, lval);
<a id='L17718' name='L17718'></a> 17718   <a href='../S/2247.html#L3214' title='Defined at 3214 in src/frame.c.'>store_frame_param</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, Qsticky, sticky ? Qt : Qnil);
<a id='L17719' name='L17719'></a> 17719   <a href='../S/2247.html#L3214' title='Defined at 3214 in src/frame.c.'>store_frame_param</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, Qshaded, shaded ? Qt : Qnil);
<a id='L17720' name='L17720'></a> 17720 <em class='brace'>}</em>
<a id='L17721' name='L17721'></a> 17721 
<a id='L17722' name='L17722'></a> 17722 <em class='comment'>/* Flip back buffers on F if it has undrawn content.  */</em>
<a id='L17723' name='L17723'></a> 17723 
<a id='L17724' name='L17724'></a> 17724 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L17725' name='L17725'></a> 17725 x_flush_dirty_back_buffer_on (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L17726' name='L17726'></a> 17726 <em class='brace'>{</em>
<a id='L17727' name='L17727'></a> 17727 <em class='sharp'>#ifdef</em> HAVE_XDBE
<a id='L17728' name='L17728'></a> 17728   <strong class='reserved'>if</strong> (<a href='../S/2183.html#L1179' title='Defined at 1179 in src/frame.h.'>FRAME_GARBAGED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L17729' name='L17729'></a> 17729       || <a href='../S/2224.html#L17703' title='Defined at 17703 in src/xdisp.c.'>buffer_flipping_blocked_p</a> ()
<a id='L17730' name='L17730'></a> 17730       <em class='comment'>/* If the frame is not already up to date, do not flush buffers</em>
<a id='L17731' name='L17731'></a> 17731 <em class='comment'>         on input, as that will result in flicker.  */</em>
<a id='L17732' name='L17732'></a> 17732       || !<a href='../S/2212.html#L1364' title='Defined at 1364 in src/xterm.h.'>FRAME_X_COMPLETE_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L17733' name='L17733'></a> 17733       || !<a href='../S/2212.html#L1360' title='Defined at 1360 in src/xterm.h.'>FRAME_X_NEED_BUFFER_FLIP</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L17734' name='L17734'></a> 17734     <strong class='reserved'>return</strong>;
<a id='L17735' name='L17735'></a> 17735 
<a id='L17736' name='L17736'></a> 17736   <a href='../D/17419.html' title='Multiple defined in 2 places.'>show_back_buffer</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L17737' name='L17737'></a> 17737 <em class='sharp'>#endif</em>
<a id='L17738' name='L17738'></a> 17738 <em class='brace'>}</em>
<a id='L17739' name='L17739'></a> 17739 
<a id='L17740' name='L17740'></a> 17740 <em class='sharp'>#ifdef</em> HAVE_GTK3
<a id='L17741' name='L17741'></a> 17741 <strong class='reserved'>void</strong>
<a id='L17742' name='L17742'></a> 17742 x_scroll_bar_configure (GdkEvent *event)
<a id='L17743' name='L17743'></a> 17743 <em class='brace'>{</em>
<a id='L17744' name='L17744'></a> 17744   XEvent configure;
<a id='L17745' name='L17745'></a> 17745   GdkDisplay *gdpy;
<a id='L17746' name='L17746'></a> 17746   <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy;
<a id='L17747' name='L17747'></a> 17747 
<a id='L17748' name='L17748'></a> 17748   configure.xconfigure.type = ConfigureNotify;
<a id='L17749' name='L17749'></a> 17749   configure.xconfigure.serial = 0;
<a id='L17750' name='L17750'></a> 17750   configure.xconfigure.send_event = event-&gt;configure.send_event;
<a id='L17751' name='L17751'></a> 17751   configure.xconfigure.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = event-&gt;configure.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L17752' name='L17752'></a> 17752   configure.xconfigure.y = event-&gt;configure.y;
<a id='L17753' name='L17753'></a> 17753   configure.xconfigure.width = event-&gt;configure.width;
<a id='L17754' name='L17754'></a> 17754   configure.xconfigure.height = event-&gt;configure.height;
<a id='L17755' name='L17755'></a> 17755   configure.xconfigure.border_width = 0;
<a id='L17756' name='L17756'></a> 17756   configure.xconfigure.event = <a href='../D/2665.html' title='Multiple defined in 2 places.'>GDK_WINDOW_XID</a> (event-&gt;configure.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L17757' name='L17757'></a> 17757   configure.xconfigure.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = <a href='../D/2665.html' title='Multiple defined in 2 places.'>GDK_WINDOW_XID</a> (event-&gt;configure.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L17758' name='L17758'></a> 17758   configure.xconfigure.above = None;
<a id='L17759' name='L17759'></a> 17759   configure.xconfigure.override_redirect = False;
<a id='L17760' name='L17760'></a> 17760 
<a id='L17761' name='L17761'></a> 17761   gdpy = gdk_window_get_display (event-&gt;configure.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L17762' name='L17762'></a> 17762   dpy = gdk_x11_display_get_xdisplay (gdpy);
<a id='L17763' name='L17763'></a> 17763 
<a id='L17764' name='L17764'></a> 17764   x_dispatch_event (&amp;configure, dpy);
<a id='L17765' name='L17765'></a> 17765 <em class='brace'>}</em>
<a id='L17766' name='L17766'></a> 17766 <em class='sharp'>#endif</em>
<a id='L17767' name='L17767'></a> 17767 
<a id='L17768' name='L17768'></a> 17768 <em class='comment'>/**</em>
<a id='L17769' name='L17769'></a> 17769 <em class='comment'>  mouse_or_wdesc_frame: When not dropping and the mouse was grabbed</em>
<a id='L17770' name='L17770'></a> 17770 <em class='comment'>  for DPYINFO, return the frame where the mouse was seen last.  If</em>
<a id='L17771' name='L17771'></a> 17771 <em class='comment'>  there's no such frame, return the frame according to WDESC.  When</em>
<a id='L17772' name='L17772'></a> 17772 <em class='comment'>  dropping, return the frame according to WDESC.  If there's no such</em>
<a id='L17773' name='L17773'></a> 17773 <em class='comment'>  frame and the mouse was grabbed for DPYINFO, return the frame where</em>
<a id='L17774' name='L17774'></a> 17774 <em class='comment'>  the mouse was seen last.  In either case, never return a tooltip</em>
<a id='L17775' name='L17775'></a> 17775 <em class='comment'>  frame.  */</em>
<a id='L17776' name='L17776'></a> 17776 <strong class='reserved'>static</strong> <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *
<a id='L17777' name='L17777'></a> 17777 <a href='../D/14633.html' title='Multiple defined in 2 places.'>mouse_or_wdesc_frame</a> (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo, <strong class='reserved'>int</strong> wdesc)
<a id='L17778' name='L17778'></a> 17778 <em class='brace'>{</em>
<a id='L17779' name='L17779'></a> 17779   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *lm_f = (<a href='../S/2247.html#L5226' title='Defined at 5226 in src/frame.c.'>gui_mouse_grabbed</a> (dpyinfo)
<a id='L17780' name='L17780'></a> 17780                         ? dpyinfo-&gt;last_mouse_frame
<a id='L17781' name='L17781'></a> 17781                         : <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L17782' name='L17782'></a> 17782 
<a id='L17783' name='L17783'></a> 17783   <strong class='reserved'>if</strong> (lm_f &amp;&amp; !<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (track_mouse, Qdropping)
<a id='L17784' name='L17784'></a> 17784       &amp;&amp; !<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (track_mouse, Qdrag_source))
<a id='L17785' name='L17785'></a> 17785     <strong class='reserved'>return</strong> lm_f;
<a id='L17786' name='L17786'></a> 17786   <strong class='reserved'>else</strong>
<a id='L17787' name='L17787'></a> 17787     <em class='brace'>{</em>
<a id='L17788' name='L17788'></a> 17788       <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *w_f = <a href='../S/2289.html#L11957' title='Defined at 11957 in src/xterm.c.'>x_window_to_frame</a> (dpyinfo, wdesc);
<a id='L17789' name='L17789'></a> 17789 
<a id='L17790' name='L17790'></a> 17790       <em class='comment'>/* Do not return a tooltip frame.  */</em>
<a id='L17791' name='L17791'></a> 17791       <strong class='reserved'>if</strong> (!w_f || <a href='../D/2425.html' title='Multiple defined in 2 places.'>FRAME_TOOLTIP_P</a> (w_f))
<a id='L17792' name='L17792'></a> 17792         <strong class='reserved'>return</strong> <a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (track_mouse, Qdropping) ? lm_f : <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L17793' name='L17793'></a> 17793       <strong class='reserved'>else</strong>
<a id='L17794' name='L17794'></a> 17794         <em class='comment'>/* When dropping it would be probably nice to raise w_f</em>
<a id='L17795' name='L17795'></a> 17795 <em class='comment'>           here.  */</em>
<a id='L17796' name='L17796'></a> 17796         <strong class='reserved'>return</strong> w_f;
<a id='L17797' name='L17797'></a> 17797     <em class='brace'>}</em>
<a id='L17798' name='L17798'></a> 17798 <em class='brace'>}</em>
<a id='L17799' name='L17799'></a> 17799 
<a id='L17800' name='L17800'></a> 17800 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L17801' name='L17801'></a> 17801 x_dnd_compute_tip_xy (<strong class='reserved'>int</strong> *root_x, <strong class='reserved'>int</strong> *root_y, <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> attributes)
<a id='L17802' name='L17802'></a> 17802 <em class='brace'>{</em>
<a id='L17803' name='L17803'></a> 17803   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> monitor, geometry;
<a id='L17804' name='L17804'></a> 17804   <strong class='reserved'>int</strong> min_x, min_y, max_x, max_y;
<a id='L17805' name='L17805'></a> 17805   <strong class='reserved'>int</strong> width, height;
<a id='L17806' name='L17806'></a> 17806 
<a id='L17807' name='L17807'></a> 17807   width = <a href='../S/2183.html#L1051' title='Defined at 1051 in src/frame.h.'>FRAME_PIXEL_WIDTH</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (tip_frame));
<a id='L17808' name='L17808'></a> 17808   height = <a href='../S/2183.html#L1052' title='Defined at 1052 in src/frame.h.'>FRAME_PIXEL_HEIGHT</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (tip_frame));
<a id='L17809' name='L17809'></a> 17809 
<a id='L17810' name='L17810'></a> 17810   max_y = -1;
<a id='L17811' name='L17811'></a> 17811 
<a id='L17812' name='L17812'></a> 17812   <em class='comment'>/* Try to determine the monitor where the mouse pointer is and</em>
<a id='L17813' name='L17813'></a> 17813 <em class='comment'>     its geometry.  See bug#22549.  */</em>
<a id='L17814' name='L17814'></a> 17814   <strong class='reserved'>while</strong> (<a href='../D/1228.html' title='Multiple defined in 2 places.'>CONSP</a> (attributes))
<a id='L17815' name='L17815'></a> 17815     <em class='brace'>{</em>
<a id='L17816' name='L17816'></a> 17816       monitor = <a href='../D/7021.html' title='Multiple defined in 2 places.'>XCAR</a> (attributes);
<a id='L17817' name='L17817'></a> 17817       geometry = <a href='../S/2320.html#L1962' title='Defined at 1962 in src/fns.c.'>assq_no_quit</a> (Qgeometry, monitor);
<a id='L17818' name='L17818'></a> 17818 
<a id='L17819' name='L17819'></a> 17819       <strong class='reserved'>if</strong> (<a href='../D/1228.html' title='Multiple defined in 2 places.'>CONSP</a> (geometry))
<a id='L17820' name='L17820'></a> 17820         <em class='brace'>{</em>
<a id='L17821' name='L17821'></a> 17821           min_x = <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (Fnth (<a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (1), geometry));
<a id='L17822' name='L17822'></a> 17822           min_y = <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (Fnth (<a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (2), geometry));
<a id='L17823' name='L17823'></a> 17823           max_x = min_x + <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (Fnth (<a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (3), geometry));
<a id='L17824' name='L17824'></a> 17824           max_y = min_y + <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (Fnth (<a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (4), geometry));
<a id='L17825' name='L17825'></a> 17825 
<a id='L17826' name='L17826'></a> 17826           <strong class='reserved'>if</strong> (min_x &lt;= *root_x &amp;&amp; *root_x &lt; max_x
<a id='L17827' name='L17827'></a> 17827               &amp;&amp; min_y &lt;= *root_y &amp;&amp; *root_y &lt; max_y)
<a id='L17828' name='L17828'></a> 17828             <strong class='reserved'>break</strong>;
<a id='L17829' name='L17829'></a> 17829 
<a id='L17830' name='L17830'></a> 17830           max_y = -1;
<a id='L17831' name='L17831'></a> 17831         <em class='brace'>}</em>
<a id='L17832' name='L17832'></a> 17832 
<a id='L17833' name='L17833'></a> 17833       attributes = <a href='../D/7022.html' title='Multiple defined in 2 places.'>XCDR</a> (attributes);
<a id='L17834' name='L17834'></a> 17834     <em class='brace'>}</em>
<a id='L17835' name='L17835'></a> 17835 
<a id='L17836' name='L17836'></a> 17836   <em class='comment'>/* It was not possible to determine the monitor's geometry, so we</em>
<a id='L17837' name='L17837'></a> 17837 <em class='comment'>     assign some sane defaults here: */</em>
<a id='L17838' name='L17838'></a> 17838   <strong class='reserved'>if</strong> (max_y &lt; 0)
<a id='L17839' name='L17839'></a> 17839     <em class='brace'>{</em>
<a id='L17840' name='L17840'></a> 17840       min_x = 0;
<a id='L17841' name='L17841'></a> 17841       min_y = 0;
<a id='L17842' name='L17842'></a> 17842       max_x = x_display_pixel_width (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (x_dnd_frame));
<a id='L17843' name='L17843'></a> 17843       max_y = x_display_pixel_height (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (x_dnd_frame));
<a id='L17844' name='L17844'></a> 17844     <em class='brace'>}</em>
<a id='L17845' name='L17845'></a> 17845 
<a id='L17846' name='L17846'></a> 17846   <strong class='reserved'>if</strong> (*root_y + <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (tip_dy) &lt;= min_y)
<a id='L17847' name='L17847'></a> 17847     *root_y = min_y; <em class='comment'>/* Can happen for negative dy */</em>
<a id='L17848' name='L17848'></a> 17848   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (*root_y + <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (tip_dy) + height &lt;= max_y)
<a id='L17849' name='L17849'></a> 17849     <em class='comment'>/* It fits below the pointer */</em>
<a id='L17850' name='L17850'></a> 17850     *root_y += <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (tip_dy);
<a id='L17851' name='L17851'></a> 17851   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (height + <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (tip_dy) + min_y &lt;= *root_y)
<a id='L17852' name='L17852'></a> 17852     <em class='comment'>/* It fits above the pointer.  */</em>
<a id='L17853' name='L17853'></a> 17853     *root_y -= height + <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (tip_dy);
<a id='L17854' name='L17854'></a> 17854   <strong class='reserved'>else</strong>
<a id='L17855' name='L17855'></a> 17855     <em class='comment'>/* Put it on the top.  */</em>
<a id='L17856' name='L17856'></a> 17856     *root_y = min_y;
<a id='L17857' name='L17857'></a> 17857 
<a id='L17858' name='L17858'></a> 17858   <strong class='reserved'>if</strong> (*root_x + <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (tip_dx) &lt;= min_x)
<a id='L17859' name='L17859'></a> 17859     *root_x = 0; <em class='comment'>/* Can happen for negative dx */</em>
<a id='L17860' name='L17860'></a> 17860   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (*root_x + <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (tip_dx) + width &lt;= max_x)
<a id='L17861' name='L17861'></a> 17861     <em class='comment'>/* It fits to the right of the pointer.  */</em>
<a id='L17862' name='L17862'></a> 17862     *root_x += <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (tip_dx);
<a id='L17863' name='L17863'></a> 17863   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (width + <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (tip_dx) + min_x &lt;= *root_x)
<a id='L17864' name='L17864'></a> 17864     <em class='comment'>/* It fits to the left of the pointer.  */</em>
<a id='L17865' name='L17865'></a> 17865     *root_x -= width + <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (tip_dx);
<a id='L17866' name='L17866'></a> 17866   <strong class='reserved'>else</strong>
<a id='L17867' name='L17867'></a> 17867     <em class='comment'>/* Put it left justified on the screen -- it ought to fit that way.  */</em>
<a id='L17868' name='L17868'></a> 17868     *root_x = min_x;
<a id='L17869' name='L17869'></a> 17869 <em class='brace'>}</em>
<a id='L17870' name='L17870'></a> 17870 
<a id='L17871' name='L17871'></a> 17871 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L17872' name='L17872'></a> 17872 x_dnd_update_tooltip_position (<strong class='reserved'>int</strong> root_x, <strong class='reserved'>int</strong> root_y)
<a id='L17873' name='L17873'></a> 17873 <em class='brace'>{</em>
<a id='L17874' name='L17874'></a> 17874   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *tip_f;
<a id='L17875' name='L17875'></a> 17875 
<a id='L17876' name='L17876'></a> 17876   <strong class='reserved'>if</strong> (!x_dnd_in_progress || !x_dnd_update_tooltip)
<a id='L17877' name='L17877'></a> 17877     <strong class='reserved'>return</strong>;
<a id='L17878' name='L17878'></a> 17878 
<a id='L17879' name='L17879'></a> 17879   <strong class='reserved'>if</strong> (!<a href='../D/2249.html' title='Multiple defined in 2 places.'>FRAMEP</a> (tip_frame))
<a id='L17880' name='L17880'></a> 17880     <strong class='reserved'>return</strong>;
<a id='L17881' name='L17881'></a> 17881 
<a id='L17882' name='L17882'></a> 17882   tip_f = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (tip_frame);
<a id='L17883' name='L17883'></a> 17883 
<a id='L17884' name='L17884'></a> 17884   <strong class='reserved'>if</strong> (!<a href='../S/2183.html#L1028' title='Defined at 1028 in src/frame.h.'>FRAME_LIVE_P</a> (tip_f)
<a id='L17885' name='L17885'></a> 17885       || !<a href='../S/2183.html#L1152' title='Defined at 1152 in src/frame.h.'>FRAME_VISIBLE_P</a> (tip_f)
<a id='L17886' name='L17886'></a> 17886       || (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (tip_f)
<a id='L17887' name='L17887'></a> 17887           != <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (x_dnd_frame)))
<a id='L17888' name='L17888'></a> 17888     <strong class='reserved'>return</strong>;
<a id='L17889' name='L17889'></a> 17889 
<a id='L17890' name='L17890'></a> 17890   <strong class='reserved'>if</strong> (tip_window != None
<a id='L17891' name='L17891'></a> 17891       &amp;&amp; <a href='../S/2267.html#L469' title='Defined at 469 in src/lisp.h.'>FIXNUMP</a> (tip_dx) &amp;&amp; <a href='../S/2267.html#L469' title='Defined at 469 in src/lisp.h.'>FIXNUMP</a> (tip_dy))
<a id='L17892' name='L17892'></a> 17892     <em class='brace'>{</em>
<a id='L17893' name='L17893'></a> 17893       x_dnd_compute_tip_xy (&amp;root_x, &amp;root_y,
<a id='L17894' name='L17894'></a> 17894                             x_dnd_monitors);
<a id='L17895' name='L17895'></a> 17895 
<a id='L17896' name='L17896'></a> 17896       <strong class='reserved'>if</strong> (x_dnd_last_tooltip_valid
<a id='L17897' name='L17897'></a> 17897           &amp;&amp; root_x == x_dnd_last_tooltip_x
<a id='L17898' name='L17898'></a> 17898           &amp;&amp; root_y == x_dnd_last_tooltip_y)
<a id='L17899' name='L17899'></a> 17899         <strong class='reserved'>return</strong>;
<a id='L17900' name='L17900'></a> 17900 
<a id='L17901' name='L17901'></a> 17901       x_dnd_last_tooltip_x = root_x;
<a id='L17902' name='L17902'></a> 17902       x_dnd_last_tooltip_y = root_y;
<a id='L17903' name='L17903'></a> 17903       x_dnd_last_tooltip_valid = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L17904' name='L17904'></a> 17904 
<a id='L17905' name='L17905'></a> 17905       XMoveWindow (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (x_dnd_frame),
<a id='L17906' name='L17906'></a> 17906                    tip_window, root_x, root_y);
<a id='L17907' name='L17907'></a> 17907     <em class='brace'>}</em>
<a id='L17908' name='L17908'></a> 17908 <em class='brace'>}</em>
<a id='L17909' name='L17909'></a> 17909 
<a id='L17910' name='L17910'></a> 17910 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L17911' name='L17911'></a> 17911 x_dnd_update_tooltip_now (<strong class='reserved'>void</strong>)
<a id='L17912' name='L17912'></a> 17912 <em class='brace'>{</em>
<a id='L17913' name='L17913'></a> 17913   <strong class='reserved'>int</strong> root_x, root_y;
<a id='L17914' name='L17914'></a> 17914   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> root, child;
<a id='L17915' name='L17915'></a> 17915   <strong class='reserved'>int</strong> win_x, win_y;
<a id='L17916' name='L17916'></a> 17916   <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> mask;
<a id='L17917' name='L17917'></a> 17917   Bool rc;
<a id='L17918' name='L17918'></a> 17918   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L17919' name='L17919'></a> 17919 
<a id='L17920' name='L17920'></a> 17920   <strong class='reserved'>if</strong> (!x_dnd_in_progress || !x_dnd_update_tooltip)
<a id='L17921' name='L17921'></a> 17921     <strong class='reserved'>return</strong>;
<a id='L17922' name='L17922'></a> 17922 
<a id='L17923' name='L17923'></a> 17923   dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (x_dnd_frame);
<a id='L17924' name='L17924'></a> 17924 
<a id='L17925' name='L17925'></a> 17925 <em class='sharp'>#ifndef</em> HAVE_XINPUT2
<a id='L17926' name='L17926'></a> 17926   rc = XQueryPointer (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L17927' name='L17927'></a> 17927                       dpyinfo-&gt;root_window,
<a id='L17928' name='L17928'></a> 17928                       &amp;root, &amp;child, &amp;root_x,
<a id='L17929' name='L17929'></a> 17929                       &amp;root_y, &amp;win_x, &amp;win_y,
<a id='L17930' name='L17930'></a> 17930                       &amp;mask);
<a id='L17931' name='L17931'></a> 17931 <em class='sharp'>#else</em>
<a id='L17932' name='L17932'></a> 17932   rc = x_query_pointer_1 (dpyinfo, x_dnd_pointer_device,
<a id='L17933' name='L17933'></a> 17933                           dpyinfo-&gt;root_window,
<a id='L17934' name='L17934'></a> 17934                           &amp;root, &amp;child, &amp;root_x,
<a id='L17935' name='L17935'></a> 17935                           &amp;root_y, &amp;win_x, &amp;win_y,
<a id='L17936' name='L17936'></a> 17936                           &amp;mask);
<a id='L17937' name='L17937'></a> 17937 <em class='sharp'>#endif</em>
<a id='L17938' name='L17938'></a> 17938 
<a id='L17939' name='L17939'></a> 17939   <strong class='reserved'>if</strong> (rc)
<a id='L17940' name='L17940'></a> 17940     x_dnd_update_tooltip_position (root_x, root_y);
<a id='L17941' name='L17941'></a> 17941 <em class='brace'>}</em>
<a id='L17942' name='L17942'></a> 17942 
<a id='L17943' name='L17943'></a> 17943 <em class='comment'>/* Get the window underneath the pointer, see if it moved, and update</em>
<a id='L17944' name='L17944'></a> 17944 <em class='comment'>   the DND state accordingly.  */</em>
<a id='L17945' name='L17945'></a> 17945 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L17946' name='L17946'></a> 17946 x_dnd_update_state (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo, <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a> timestamp)
<a id='L17947' name='L17947'></a> 17947 <em class='brace'>{</em>
<a id='L17948' name='L17948'></a> 17948   <strong class='reserved'>int</strong> root_x, root_y, dummy_x, dummy_y, target_proto, motif_style;
<a id='L17949' name='L17949'></a> 17949   <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> dummy_mask;
<a id='L17950' name='L17950'></a> 17950   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> <a href='../D/10645.html' title='Multiple defined in 5 places.'>dummy</a>, dummy_child, target, toplevel;
<a id='L17951' name='L17951'></a> 17951   <a href='../D/20054.html' title='Multiple defined in 2 places.'>xm_top_level_leave_message</a> lmsg;
<a id='L17952' name='L17952'></a> 17952   <a href='../D/20053.html' title='Multiple defined in 2 places.'>xm_top_level_enter_message</a> emsg;
<a id='L17953' name='L17953'></a> 17953   <a href='../D/20008.html' title='Multiple defined in 2 places.'>xm_drag_motion_message</a> dmsg;
<a id='L17954' name='L17954'></a> 17954   <a href='../D/20018.html' title='Multiple defined in 2 places.'>xm_drop_start_message</a> dsmsg;
<a id='L17955' name='L17955'></a> 17955   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> was_frame;
<a id='L17956' name='L17956'></a> 17956 
<a id='L17957' name='L17957'></a> 17957   <strong class='reserved'>if</strong> (x_query_pointer_1 (dpyinfo,
<a id='L17958' name='L17958'></a> 17958 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L17959' name='L17959'></a> 17959                          x_dnd_pointer_device,
<a id='L17960' name='L17960'></a> 17960 <em class='sharp'>#else</em>
<a id='L17961' name='L17961'></a> 17961                          -1,
<a id='L17962' name='L17962'></a> 17962 <em class='sharp'>#endif</em>
<a id='L17963' name='L17963'></a> 17963                          dpyinfo-&gt;root_window,
<a id='L17964' name='L17964'></a> 17964                          &amp;<a href='../D/10645.html' title='Multiple defined in 5 places.'>dummy</a>, &amp;dummy_child,
<a id='L17965' name='L17965'></a> 17965                          &amp;root_x, &amp;root_y,
<a id='L17966' name='L17966'></a> 17966                          &amp;dummy_x, &amp;dummy_y,
<a id='L17967' name='L17967'></a> 17967                          &amp;dummy_mask))
<a id='L17968' name='L17968'></a> 17968     <em class='brace'>{</em>
<a id='L17969' name='L17969'></a> 17969       target = <a href='../S/2289.html#L4131' title='Defined at 4131 in src/xterm.c.'>x_dnd_get_target_window</a> (dpyinfo, root_x,
<a id='L17970' name='L17970'></a> 17970                                         root_y, &amp;target_proto,
<a id='L17971' name='L17971'></a> 17971                                         &amp;motif_style, &amp;toplevel,
<a id='L17972' name='L17972'></a> 17972                                         &amp;was_frame);
<a id='L17973' name='L17973'></a> 17973 
<a id='L17974' name='L17974'></a> 17974       <strong class='reserved'>if</strong> (toplevel != x_dnd_last_seen_toplevel)
<a id='L17975' name='L17975'></a> 17975         <em class='brace'>{</em>
<a id='L17976' name='L17976'></a> 17976           <strong class='reserved'>if</strong> (toplevel != <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (x_dnd_frame)
<a id='L17977' name='L17977'></a> 17977               &amp;&amp; x_dnd_return_frame == 1)
<a id='L17978' name='L17978'></a> 17978             x_dnd_return_frame = 2;
<a id='L17979' name='L17979'></a> 17979 
<a id='L17980' name='L17980'></a> 17980           <strong class='reserved'>if</strong> (x_dnd_return_frame == 2
<a id='L17981' name='L17981'></a> 17981               &amp;&amp; <a href='../D/19416.html' title='Multiple defined in 2 places.'>x_any_window_to_frame</a> (dpyinfo, toplevel))
<a id='L17982' name='L17982'></a> 17982             <em class='brace'>{</em>
<a id='L17983' name='L17983'></a> 17983               <strong class='reserved'>if</strong> (x_dnd_last_seen_window != None
<a id='L17984' name='L17984'></a> 17984                   &amp;&amp; x_dnd_last_protocol_version != -1
<a id='L17985' name='L17985'></a> 17985                   &amp;&amp; x_dnd_last_seen_window != <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (x_dnd_frame))
<a id='L17986' name='L17986'></a> 17986                 <a href='../S/2289.html#L4649' title='Defined at 4649 in src/xterm.c.'>x_dnd_send_leave</a> (x_dnd_frame, x_dnd_last_seen_window,
<a id='L17987' name='L17987'></a> 17987                                   x_dnd_last_seen_toplevel);
<a id='L17988' name='L17988'></a> 17988               <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (x_dnd_last_seen_window != None
<a id='L17989' name='L17989'></a> 17989                        &amp;&amp; <a href='../S/2289.html#L1750' title='Defined at 1750 in src/xterm.c.'>XM_DRAG_STYLE_IS_DYNAMIC</a> (x_dnd_last_motif_style)
<a id='L17990' name='L17990'></a> 17990                        &amp;&amp; !x_dnd_disable_motif_drag
<a id='L17991' name='L17991'></a> 17991                        &amp;&amp; x_dnd_last_seen_window != <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (x_dnd_frame))
<a id='L17992' name='L17992'></a> 17992                 <em class='brace'>{</em>
<a id='L17993' name='L17993'></a> 17993                   <strong class='reserved'>if</strong> (!x_dnd_motif_setup_p)
<a id='L17994' name='L17994'></a> 17994                     <a href='../S/2289.html#L2528' title='Defined at 2528 in src/xterm.c.'>xm_setup_drag_info</a> (dpyinfo, x_dnd_frame);
<a id='L17995' name='L17995'></a> 17995 
<a id='L17996' name='L17996'></a> 17996                   lmsg.reason = <a href='../S/2289.html#L1718' title='Defined at 1718 in src/xterm.c.'>XM_DRAG_REASON</a> (<a href='../S/2289.html#L1732' title='Defined at 1732 in src/xterm.c.'>XM_DRAG_ORIGINATOR_INITIATOR</a>,
<a id='L17997' name='L17997'></a> 17997                                                 <a href='../S/2289.html#L1726' title='Defined at 1726 in src/xterm.c.'>XM_DRAG_REASON_TOP_LEVEL_LEAVE</a>);
<a id='L17998' name='L17998'></a> 17998                   lmsg.byteorder = <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>;
<a id='L17999' name='L17999'></a> 17999                   lmsg.zero = 0;
<a id='L18000' name='L18000'></a> 18000                   lmsg.timestamp = timestamp;
<a id='L18001' name='L18001'></a> 18001                   lmsg.source_window = <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (x_dnd_frame);
<a id='L18002' name='L18002'></a> 18002 
<a id='L18003' name='L18003'></a> 18003                   <strong class='reserved'>if</strong> (x_dnd_motif_setup_p)
<a id='L18004' name='L18004'></a> 18004                     <a href='../S/2289.html#L2648' title='Defined at 2648 in src/xterm.c.'>xm_send_top_level_leave_message</a> (dpyinfo, <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (x_dnd_frame),
<a id='L18005' name='L18005'></a> 18005                                                      x_dnd_last_seen_window, &amp;lmsg);
<a id='L18006' name='L18006'></a> 18006                 <em class='brace'>}</em>
<a id='L18007' name='L18007'></a> 18007 
<a id='L18008' name='L18008'></a> 18008               x_dnd_end_window = x_dnd_last_seen_window;
<a id='L18009' name='L18009'></a> 18009               x_dnd_last_seen_window = None;
<a id='L18010' name='L18010'></a> 18010               x_dnd_last_seen_toplevel = None;
<a id='L18011' name='L18011'></a> 18011               x_dnd_in_progress = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L18012' name='L18012'></a> 18012               x_dnd_return_frame_object
<a id='L18013' name='L18013'></a> 18013                 = <a href='../D/19416.html' title='Multiple defined in 2 places.'>x_any_window_to_frame</a> (dpyinfo, toplevel);
<a id='L18014' name='L18014'></a> 18014               x_dnd_return_frame = 3;
<a id='L18015' name='L18015'></a> 18015               x_dnd_waiting_for_finish = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L18016' name='L18016'></a> 18016               target = None;
<a id='L18017' name='L18017'></a> 18017             <em class='brace'>}</em>
<a id='L18018' name='L18018'></a> 18018         <em class='brace'>}</em>
<a id='L18019' name='L18019'></a> 18019 
<a id='L18020' name='L18020'></a> 18020       <strong class='reserved'>if</strong> (target != x_dnd_last_seen_window)
<a id='L18021' name='L18021'></a> 18021         <em class='brace'>{</em>
<a id='L18022' name='L18022'></a> 18022           <strong class='reserved'>if</strong> (x_dnd_last_seen_window != None
<a id='L18023' name='L18023'></a> 18023               &amp;&amp; x_dnd_last_protocol_version != -1
<a id='L18024' name='L18024'></a> 18024               &amp;&amp; x_dnd_last_seen_window != <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (x_dnd_frame))
<a id='L18025' name='L18025'></a> 18025             <a href='../S/2289.html#L4649' title='Defined at 4649 in src/xterm.c.'>x_dnd_send_leave</a> (x_dnd_frame, x_dnd_last_seen_window,
<a id='L18026' name='L18026'></a> 18026                               x_dnd_last_seen_toplevel);
<a id='L18027' name='L18027'></a> 18027           <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (x_dnd_last_seen_window != None
<a id='L18028' name='L18028'></a> 18028                    &amp;&amp; <a href='../S/2289.html#L1750' title='Defined at 1750 in src/xterm.c.'>XM_DRAG_STYLE_IS_DYNAMIC</a> (x_dnd_last_motif_style)
<a id='L18029' name='L18029'></a> 18029                    &amp;&amp; !x_dnd_disable_motif_drag
<a id='L18030' name='L18030'></a> 18030                    &amp;&amp; x_dnd_last_seen_window != <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (x_dnd_frame))
<a id='L18031' name='L18031'></a> 18031             <em class='brace'>{</em>
<a id='L18032' name='L18032'></a> 18032               <strong class='reserved'>if</strong> (!x_dnd_motif_setup_p)
<a id='L18033' name='L18033'></a> 18033                 <a href='../S/2289.html#L2528' title='Defined at 2528 in src/xterm.c.'>xm_setup_drag_info</a> (dpyinfo, x_dnd_frame);
<a id='L18034' name='L18034'></a> 18034 
<a id='L18035' name='L18035'></a> 18035               lmsg.reason = <a href='../S/2289.html#L1718' title='Defined at 1718 in src/xterm.c.'>XM_DRAG_REASON</a> (<a href='../S/2289.html#L1732' title='Defined at 1732 in src/xterm.c.'>XM_DRAG_ORIGINATOR_INITIATOR</a>,
<a id='L18036' name='L18036'></a> 18036                                             <a href='../S/2289.html#L1726' title='Defined at 1726 in src/xterm.c.'>XM_DRAG_REASON_TOP_LEVEL_LEAVE</a>);
<a id='L18037' name='L18037'></a> 18037               lmsg.byteorder = <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>;
<a id='L18038' name='L18038'></a> 18038               lmsg.zero = 0;
<a id='L18039' name='L18039'></a> 18039               lmsg.timestamp = timestamp;
<a id='L18040' name='L18040'></a> 18040               lmsg.source_window = <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (x_dnd_frame);
<a id='L18041' name='L18041'></a> 18041 
<a id='L18042' name='L18042'></a> 18042               <strong class='reserved'>if</strong> (x_dnd_motif_setup_p)
<a id='L18043' name='L18043'></a> 18043                 <a href='../S/2289.html#L2648' title='Defined at 2648 in src/xterm.c.'>xm_send_top_level_leave_message</a> (dpyinfo, <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (x_dnd_frame),
<a id='L18044' name='L18044'></a> 18044                                                  x_dnd_last_seen_window, &amp;lmsg);
<a id='L18045' name='L18045'></a> 18045             <em class='brace'>}</em>
<a id='L18046' name='L18046'></a> 18046 
<a id='L18047' name='L18047'></a> 18047           x_dnd_action = None;
<a id='L18048' name='L18048'></a> 18048           x_dnd_last_seen_toplevel = toplevel;
<a id='L18049' name='L18049'></a> 18049           x_dnd_last_seen_window = target;
<a id='L18050' name='L18050'></a> 18050           x_dnd_last_protocol_version = target_proto;
<a id='L18051' name='L18051'></a> 18051           x_dnd_last_motif_style = motif_style;
<a id='L18052' name='L18052'></a> 18052           x_dnd_last_window_is_frame = was_frame;
<a id='L18053' name='L18053'></a> 18053 
<a id='L18054' name='L18054'></a> 18054           <strong class='reserved'>if</strong> (target != None &amp;&amp; x_dnd_last_protocol_version != -1)
<a id='L18055' name='L18055'></a> 18055             <a href='../S/2289.html#L4536' title='Defined at 4536 in src/xterm.c.'>x_dnd_send_enter</a> (x_dnd_frame, target, x_dnd_last_seen_toplevel,
<a id='L18056' name='L18056'></a> 18056                               x_dnd_last_protocol_version);
<a id='L18057' name='L18057'></a> 18057           <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (target != None &amp;&amp; <a href='../S/2289.html#L1750' title='Defined at 1750 in src/xterm.c.'>XM_DRAG_STYLE_IS_DYNAMIC</a> (x_dnd_last_motif_style)
<a id='L18058' name='L18058'></a> 18058                    &amp;&amp; !x_dnd_disable_motif_drag)
<a id='L18059' name='L18059'></a> 18059             <em class='brace'>{</em>
<a id='L18060' name='L18060'></a> 18060               <strong class='reserved'>if</strong> (!x_dnd_motif_setup_p)
<a id='L18061' name='L18061'></a> 18061                 <a href='../S/2289.html#L2528' title='Defined at 2528 in src/xterm.c.'>xm_setup_drag_info</a> (dpyinfo, x_dnd_frame);
<a id='L18062' name='L18062'></a> 18062 
<a id='L18063' name='L18063'></a> 18063               emsg.reason = <a href='../S/2289.html#L1718' title='Defined at 1718 in src/xterm.c.'>XM_DRAG_REASON</a> (<a href='../S/2289.html#L1732' title='Defined at 1732 in src/xterm.c.'>XM_DRAG_ORIGINATOR_INITIATOR</a>,
<a id='L18064' name='L18064'></a> 18064                                             <a href='../S/2289.html#L1725' title='Defined at 1725 in src/xterm.c.'>XM_DRAG_REASON_TOP_LEVEL_ENTER</a>);
<a id='L18065' name='L18065'></a> 18065               emsg.byteorder = <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>;
<a id='L18066' name='L18066'></a> 18066               emsg.zero = 0;
<a id='L18067' name='L18067'></a> 18067               emsg.timestamp = timestamp;
<a id='L18068' name='L18068'></a> 18068               emsg.source_window = <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (x_dnd_frame);
<a id='L18069' name='L18069'></a> 18069               emsg.index_atom = x_dnd_motif_atom;
<a id='L18070' name='L18070'></a> 18070 
<a id='L18071' name='L18071'></a> 18071               <strong class='reserved'>if</strong> (x_dnd_motif_setup_p)
<a id='L18072' name='L18072'></a> 18072                 <a href='../S/2289.html#L2590' title='Defined at 2590 in src/xterm.c.'>xm_send_top_level_enter_message</a> (dpyinfo, <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (x_dnd_frame),
<a id='L18073' name='L18073'></a> 18073                                                  target, &amp;emsg);
<a id='L18074' name='L18074'></a> 18074             <em class='brace'>}</em>
<a id='L18075' name='L18075'></a> 18075         <em class='brace'>}</em>
<a id='L18076' name='L18076'></a> 18076       <strong class='reserved'>else</strong>
<a id='L18077' name='L18077'></a> 18077         x_dnd_last_seen_toplevel = toplevel;
<a id='L18078' name='L18078'></a> 18078 
<a id='L18079' name='L18079'></a> 18079       <strong class='reserved'>if</strong> (x_dnd_last_window_is_frame &amp;&amp; target != None)
<a id='L18080' name='L18080'></a> 18080         <a href='../S/2289.html#L4924' title='Defined at 4924 in src/xterm.c.'>x_dnd_note_self_position</a> (dpyinfo, target, root_x, root_y);
<a id='L18081' name='L18081'></a> 18081       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (x_dnd_last_protocol_version != -1 &amp;&amp; target != None)
<a id='L18082' name='L18082'></a> 18082         <a href='../S/2289.html#L4574' title='Defined at 4574 in src/xterm.c.'>x_dnd_send_position</a> (x_dnd_frame, target,
<a id='L18083' name='L18083'></a> 18083                              x_dnd_last_seen_toplevel,
<a id='L18084' name='L18084'></a> 18084                              x_dnd_last_protocol_version,
<a id='L18085' name='L18085'></a> 18085                              root_x, root_y,
<a id='L18086' name='L18086'></a> 18086                              x_dnd_selection_timestamp,
<a id='L18087' name='L18087'></a> 18087                              x_dnd_wanted_action, 0,
<a id='L18088' name='L18088'></a> 18088 <em class='sharp'>#ifdef</em> HAVE_XKB
<a id='L18089' name='L18089'></a> 18089                              x_dnd_keyboard_state
<a id='L18090' name='L18090'></a> 18090 <em class='sharp'>#else</em>
<a id='L18091' name='L18091'></a> 18091                              0
<a id='L18092' name='L18092'></a> 18092 <em class='sharp'>#endif</em>
<a id='L18093' name='L18093'></a> 18093                              );
<a id='L18094' name='L18094'></a> 18094       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (<a href='../S/2289.html#L1750' title='Defined at 1750 in src/xterm.c.'>XM_DRAG_STYLE_IS_DYNAMIC</a> (x_dnd_last_motif_style) &amp;&amp; target != None
<a id='L18095' name='L18095'></a> 18095                &amp;&amp; !x_dnd_disable_motif_drag)
<a id='L18096' name='L18096'></a> 18096         <em class='brace'>{</em>
<a id='L18097' name='L18097'></a> 18097           <strong class='reserved'>if</strong> (!x_dnd_motif_setup_p)
<a id='L18098' name='L18098'></a> 18098             <a href='../S/2289.html#L2528' title='Defined at 2528 in src/xterm.c.'>xm_setup_drag_info</a> (dpyinfo, x_dnd_frame);
<a id='L18099' name='L18099'></a> 18099 
<a id='L18100' name='L18100'></a> 18100           dmsg.reason = <a href='../S/2289.html#L1718' title='Defined at 1718 in src/xterm.c.'>XM_DRAG_REASON</a> (<a href='../S/2289.html#L1732' title='Defined at 1732 in src/xterm.c.'>XM_DRAG_ORIGINATOR_INITIATOR</a>,
<a id='L18101' name='L18101'></a> 18101                                         <a href='../S/2289.html#L1727' title='Defined at 1727 in src/xterm.c.'>XM_DRAG_REASON_DRAG_MOTION</a>);
<a id='L18102' name='L18102'></a> 18102           dmsg.byteorder = <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>;
<a id='L18103' name='L18103'></a> 18103           dmsg.side_effects
<a id='L18104' name='L18104'></a> 18104             = <a href='../S/2289.html#L1689' title='Defined at 1689 in src/xterm.c.'>XM_DRAG_SIDE_EFFECT</a> (<a href='../S/2289.html#L1766' title='Defined at 1766 in src/xterm.c.'>xm_side_effect_from_action</a> (dpyinfo,
<a id='L18105' name='L18105'></a> 18105                                                                x_dnd_wanted_action),
<a id='L18106' name='L18106'></a> 18106                                    <a href='../S/2289.html#L1756' title='Defined at 1756 in src/xterm.c.'>XM_DROP_SITE_VALID</a>, x_dnd_motif_operations,
<a id='L18107' name='L18107'></a> 18107                                    (!x_dnd_xm_use_help
<a id='L18108' name='L18108'></a> 18108                                     ? <a href='../S/2289.html#L1713' title='Defined at 1713 in src/xterm.c.'>XM_DROP_ACTION_DROP</a>
<a id='L18109' name='L18109'></a> 18109                                     : <a href='../S/2289.html#L1714' title='Defined at 1714 in src/xterm.c.'>XM_DROP_ACTION_DROP_HELP</a>));
<a id='L18110' name='L18110'></a> 18110           dmsg.timestamp = timestamp;
<a id='L18111' name='L18111'></a> 18111           dmsg.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = root_x;
<a id='L18112' name='L18112'></a> 18112           dmsg.y = root_y;
<a id='L18113' name='L18113'></a> 18113 
<a id='L18114' name='L18114'></a> 18114           <strong class='reserved'>if</strong> (x_dnd_motif_setup_p)
<a id='L18115' name='L18115'></a> 18115             <a href='../S/2289.html#L2617' title='Defined at 2617 in src/xterm.c.'>xm_send_drag_motion_message</a> (dpyinfo, <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (x_dnd_frame),
<a id='L18116' name='L18116'></a> 18116                                          target, &amp;dmsg);
<a id='L18117' name='L18117'></a> 18117         <em class='brace'>}</em>
<a id='L18118' name='L18118'></a> 18118 
<a id='L18119' name='L18119'></a> 18119       x_dnd_update_tooltip_position (root_x, root_y);
<a id='L18120' name='L18120'></a> 18120     <em class='brace'>}</em>
<a id='L18121' name='L18121'></a> 18121   <em class='comment'>/* The pointer moved out of the screen.  */</em>
<a id='L18122' name='L18122'></a> 18122   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (x_dnd_last_protocol_version != -1)
<a id='L18123' name='L18123'></a> 18123     <em class='brace'>{</em>
<a id='L18124' name='L18124'></a> 18124       <strong class='reserved'>if</strong> (x_dnd_last_seen_window != None
<a id='L18125' name='L18125'></a> 18125           &amp;&amp; x_dnd_last_protocol_version != -1)
<a id='L18126' name='L18126'></a> 18126         <a href='../S/2289.html#L4649' title='Defined at 4649 in src/xterm.c.'>x_dnd_send_leave</a> (x_dnd_frame,
<a id='L18127' name='L18127'></a> 18127                           x_dnd_last_seen_window,
<a id='L18128' name='L18128'></a> 18128                           x_dnd_last_seen_toplevel);
<a id='L18129' name='L18129'></a> 18129       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (x_dnd_last_seen_window != None
<a id='L18130' name='L18130'></a> 18130                &amp;&amp; !<a href='../S/2289.html#L1748' title='Defined at 1748 in src/xterm.c.'>XM_DRAG_STYLE_IS_DROP_ONLY</a> (x_dnd_last_motif_style)
<a id='L18131' name='L18131'></a> 18131                &amp;&amp; x_dnd_last_motif_style != <a href='../S/2289.html#L1740' title='Defined at 1740 in src/xterm.c.'>XM_DRAG_STYLE_NONE</a>
<a id='L18132' name='L18132'></a> 18132                &amp;&amp; x_dnd_motif_setup_p)
<a id='L18133' name='L18133'></a> 18133         <em class='brace'>{</em>
<a id='L18134' name='L18134'></a> 18134           dsmsg.reason = <a href='../S/2289.html#L1718' title='Defined at 1718 in src/xterm.c.'>XM_DRAG_REASON</a> (<a href='../S/2289.html#L1732' title='Defined at 1732 in src/xterm.c.'>XM_DRAG_ORIGINATOR_INITIATOR</a>,
<a id='L18135' name='L18135'></a> 18135                                          <a href='../S/2289.html#L1724' title='Defined at 1724 in src/xterm.c.'>XM_DRAG_REASON_DROP_START</a>);
<a id='L18136' name='L18136'></a> 18136           dmsg.byteorder = <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>;
<a id='L18137' name='L18137'></a> 18137           dsmsg.timestamp = timestamp;
<a id='L18138' name='L18138'></a> 18138           dsmsg.side_effects
<a id='L18139' name='L18139'></a> 18139             = <a href='../S/2289.html#L1689' title='Defined at 1689 in src/xterm.c.'>XM_DRAG_SIDE_EFFECT</a> (<a href='../S/2289.html#L1766' title='Defined at 1766 in src/xterm.c.'>xm_side_effect_from_action</a> (dpyinfo,
<a id='L18140' name='L18140'></a> 18140                                                                x_dnd_wanted_action),
<a id='L18141' name='L18141'></a> 18141                                    <a href='../S/2289.html#L1756' title='Defined at 1756 in src/xterm.c.'>XM_DROP_SITE_VALID</a>, x_dnd_motif_operations,
<a id='L18142' name='L18142'></a> 18142                                    <a href='../S/2289.html#L1715' title='Defined at 1715 in src/xterm.c.'>XM_DROP_ACTION_DROP_CANCEL</a>);
<a id='L18143' name='L18143'></a> 18143           dsmsg.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = 0;
<a id='L18144' name='L18144'></a> 18144           dsmsg.y = 0;
<a id='L18145' name='L18145'></a> 18145           dsmsg.index_atom = x_dnd_motif_atom;
<a id='L18146' name='L18146'></a> 18146           dsmsg.source_window = <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (x_dnd_frame);
<a id='L18147' name='L18147'></a> 18147 
<a id='L18148' name='L18148'></a> 18148           <a href='../S/2289.html#L2899' title='Defined at 2899 in src/xterm.c.'>x_dnd_send_xm_leave_for_drop</a> (dpyinfo, x_dnd_frame,
<a id='L18149' name='L18149'></a> 18149                                         x_dnd_last_seen_window, timestamp);
<a id='L18150' name='L18150'></a> 18150           <a href='../S/2289.html#L2565' title='Defined at 2565 in src/xterm.c.'>xm_send_drop_message</a> (dpyinfo, <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (x_dnd_frame),
<a id='L18151' name='L18151'></a> 18151                                 x_dnd_last_seen_window, &amp;dsmsg);
<a id='L18152' name='L18152'></a> 18152         <em class='brace'>}</em>
<a id='L18153' name='L18153'></a> 18153 
<a id='L18154' name='L18154'></a> 18154       x_dnd_end_window = x_dnd_last_seen_window;
<a id='L18155' name='L18155'></a> 18155       x_dnd_last_seen_window = None;
<a id='L18156' name='L18156'></a> 18156       x_dnd_last_seen_toplevel = None;
<a id='L18157' name='L18157'></a> 18157       x_dnd_in_progress = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L18158' name='L18158'></a> 18158       x_dnd_waiting_for_finish = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L18159' name='L18159'></a> 18159       x_dnd_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L18160' name='L18160'></a> 18160     <em class='brace'>}</em>
<a id='L18161' name='L18161'></a> 18161 <em class='brace'>}</em>
<a id='L18162' name='L18162'></a> 18162 
<a id='L18163' name='L18163'></a> 18163 <strong class='reserved'>int</strong>
<a id='L18164' name='L18164'></a> 18164 x_display_pixel_height (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo)
<a id='L18165' name='L18165'></a> 18165 <em class='brace'>{</em>
<a id='L18166' name='L18166'></a> 18166   <strong class='reserved'>if</strong> (dpyinfo-&gt;screen_height)
<a id='L18167' name='L18167'></a> 18167     <strong class='reserved'>return</strong> dpyinfo-&gt;screen_height;
<a id='L18168' name='L18168'></a> 18168 
<a id='L18169' name='L18169'></a> 18169   <strong class='reserved'>return</strong> HeightOfScreen (dpyinfo-&gt;screen);
<a id='L18170' name='L18170'></a> 18170 <em class='brace'>}</em>
<a id='L18171' name='L18171'></a> 18171 
<a id='L18172' name='L18172'></a> 18172 <strong class='reserved'>int</strong>
<a id='L18173' name='L18173'></a> 18173 x_display_pixel_width (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo)
<a id='L18174' name='L18174'></a> 18174 <em class='brace'>{</em>
<a id='L18175' name='L18175'></a> 18175   <strong class='reserved'>if</strong> (dpyinfo-&gt;screen_width)
<a id='L18176' name='L18176'></a> 18176     <strong class='reserved'>return</strong> dpyinfo-&gt;screen_width;
<a id='L18177' name='L18177'></a> 18177 
<a id='L18178' name='L18178'></a> 18178   <strong class='reserved'>return</strong> WidthOfScreen (dpyinfo-&gt;screen);
<a id='L18179' name='L18179'></a> 18179 <em class='brace'>}</em>
<a id='L18180' name='L18180'></a> 18180 
<a id='L18181' name='L18181'></a> 18181 <em class='comment'>/* Handle events from each display until CELL's car becomes non-nil,</em>
<a id='L18182' name='L18182'></a> 18182 <em class='comment'>   or TIMEOUT elapses.  */</em>
<a id='L18183' name='L18183'></a> 18183 <strong class='reserved'>void</strong>
<a id='L18184' name='L18184'></a> 18184 x_wait_for_cell_change (<a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> cell, <strong class='reserved'>struct</strong> <a href='../D/18278.html' title='Multiple defined in 3 places.'>timespec</a> timeout)
<a id='L18185' name='L18185'></a> 18185 <em class='brace'>{</em>
<a id='L18186' name='L18186'></a> 18186   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L18187' name='L18187'></a> 18187   <a href='../D/11311.html' title='Multiple defined in 3 places.'>fd_set</a> fds;
<a id='L18188' name='L18188'></a> 18188   <strong class='reserved'>int</strong> fd, maxfd;
<a id='L18189' name='L18189'></a> 18189 <em class='sharp'>#ifndef</em> USE_GTK
<a id='L18190' name='L18190'></a> 18190   <strong class='reserved'>int</strong> finish, rc;
<a id='L18191' name='L18191'></a> 18191   XEvent event;
<a id='L18192' name='L18192'></a> 18192   <a href='../D/11311.html' title='Multiple defined in 3 places.'>fd_set</a> rfds;
<a id='L18193' name='L18193'></a> 18193 <em class='sharp'>#endif</em>
<a id='L18194' name='L18194'></a> 18194   <strong class='reserved'>struct</strong> <a href='../S/2231.html#L350' title='Defined at 350 in src/termhooks.h.'>input_event</a> hold_quit;
<a id='L18195' name='L18195'></a> 18195   <strong class='reserved'>struct</strong> <a href='../D/18278.html' title='Multiple defined in 3 places.'>timespec</a> current, <a href='../S/2325.html#L61' title='Defined at 61 in src/cm.c.'>at</a>;
<a id='L18196' name='L18196'></a> 18196 
<a id='L18197' name='L18197'></a> 18197   <a href='../S/2325.html#L61' title='Defined at 61 in src/cm.c.'>at</a> = <a href='../D/18279.html' title='Multiple defined in 2 places.'>timespec_add</a> (<a href='../S/2947.html#L46' title='Defined at 46 in lib/gettime.c.'>current_timespec</a> (), timeout);
<a id='L18198' name='L18198'></a> 18198 
<a id='L18199' name='L18199'></a> 18199 <em class='sharp'>#ifndef</em> USE_GTK
<a id='L18200' name='L18200'></a> 18200   <a href='../D/2046.html' title='Multiple defined in 4 places.'>FD_ZERO</a> (&amp;rfds);
<a id='L18201' name='L18201'></a> 18201   rc = -1;
<a id='L18202' name='L18202'></a> 18202 <em class='sharp'>#endif</em>
<a id='L18203' name='L18203'></a> 18203 
<a id='L18204' name='L18204'></a> 18204   <strong class='reserved'>while</strong> (<a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>)
<a id='L18205' name='L18205'></a> 18205     <em class='brace'>{</em>
<a id='L18206' name='L18206'></a> 18206       <a href='../D/2046.html' title='Multiple defined in 4 places.'>FD_ZERO</a> (&amp;fds);
<a id='L18207' name='L18207'></a> 18207       maxfd = -1;
<a id='L18208' name='L18208'></a> 18208 
<a id='L18209' name='L18209'></a> 18209       <strong class='reserved'>for</strong> (dpyinfo = x_display_list; dpyinfo;
<a id='L18210' name='L18210'></a> 18210            dpyinfo = dpyinfo-&gt;next)
<a id='L18211' name='L18211'></a> 18211         <em class='brace'>{</em>
<a id='L18212' name='L18212'></a> 18212           fd = ConnectionNumber (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L18213' name='L18213'></a> 18213 
<a id='L18214' name='L18214'></a> 18214 <em class='sharp'>#ifndef</em> USE_GTK
<a id='L18215' name='L18215'></a> 18215           <strong class='reserved'>if</strong> ((rc &lt; 0 || <a href='../D/2043.html' title='Multiple defined in 8 places.'>FD_ISSET</a> (fd, &amp;rfds))
<a id='L18216' name='L18216'></a> 18216               <em class='comment'>/* If pselect failed, the erroring display's IO error</em>
<a id='L18217' name='L18217'></a> 18217 <em class='comment'>                 handler will eventually be called.  */</em>
<a id='L18218' name='L18218'></a> 18218               &amp;&amp; XPending (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>))
<a id='L18219' name='L18219'></a> 18219             <em class='brace'>{</em>
<a id='L18220' name='L18220'></a> 18220               <strong class='reserved'>while</strong> (XPending (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>))
<a id='L18221' name='L18221'></a> 18221                 <em class='brace'>{</em>
<a id='L18222' name='L18222'></a> 18222                   <a href='../S/2231.html#L393' title='Defined at 393 in src/termhooks.h.'>EVENT_INIT</a> (hold_quit);
<a id='L18223' name='L18223'></a> 18223 
<a id='L18224' name='L18224'></a> 18224                   XNextEvent (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, &amp;event);
<a id='L18225' name='L18225'></a> 18225                   handle_one_xevent (dpyinfo, &amp;event,
<a id='L18226' name='L18226'></a> 18226                                      &amp;finish, &amp;hold_quit);
<a id='L18227' name='L18227'></a> 18227 
<a id='L18228' name='L18228'></a> 18228                   <strong class='reserved'>if</strong> (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (<a href='../D/7021.html' title='Multiple defined in 2 places.'>XCAR</a> (cell)))
<a id='L18229' name='L18229'></a> 18229                     <strong class='reserved'>return</strong>;
<a id='L18230' name='L18230'></a> 18230 
<a id='L18231' name='L18231'></a> 18231                   <strong class='reserved'>if</strong> (finish == <a href='../S/2289.html#L1135' title='Defined at 1135 in src/xterm.c.'>X_EVENT_GOTO_OUT</a>)
<a id='L18232' name='L18232'></a> 18232                     <strong class='reserved'>break</strong>;
<a id='L18233' name='L18233'></a> 18233 
<a id='L18234' name='L18234'></a> 18234                   <em class='comment'>/* Make us quit now.  */</em>
<a id='L18235' name='L18235'></a> 18235                   <strong class='reserved'>if</strong> (hold_quit.kind != <a href='../S/2231.html#L74' title='Defined at 74 in src/termhooks.h.'>NO_EVENT</a>)
<a id='L18236' name='L18236'></a> 18236                     <a href='../D/13636.html' title='Multiple defined in 2 places.'>kbd_buffer_store_event</a> (&amp;hold_quit);
<a id='L18237' name='L18237'></a> 18237                 <em class='brace'>}</em>
<a id='L18238' name='L18238'></a> 18238             <em class='brace'>}</em>
<a id='L18239' name='L18239'></a> 18239 <em class='sharp'>#endif</em>
<a id='L18240' name='L18240'></a> 18240 
<a id='L18241' name='L18241'></a> 18241           <strong class='reserved'>if</strong> (fd &gt; maxfd)
<a id='L18242' name='L18242'></a> 18242             maxfd = fd;
<a id='L18243' name='L18243'></a> 18243 
<a id='L18244' name='L18244'></a> 18244           <a href='../D/10871.html' title='Multiple defined in 5 places.'>eassert</a> (fd &lt; <a href='../D/2045.html' title='Multiple defined in 4 places.'>FD_SETSIZE</a>);
<a id='L18245' name='L18245'></a> 18245           <a href='../D/2044.html' title='Multiple defined in 6 places.'>FD_SET</a> (fd, &amp;fds);
<a id='L18246' name='L18246'></a> 18246         <em class='brace'>}</em>
<a id='L18247' name='L18247'></a> 18247 
<a id='L18248' name='L18248'></a> 18248       <em class='comment'>/* Prevent events from being lost (from GTK's point of view) by</em>
<a id='L18249' name='L18249'></a> 18249 <em class='comment'>         using GDK to run the event loop.  */</em>
<a id='L18250' name='L18250'></a> 18250 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L18251' name='L18251'></a> 18251       <strong class='reserved'>while</strong> (gtk_events_pending ())
<a id='L18252' name='L18252'></a> 18252         <em class='brace'>{</em>
<a id='L18253' name='L18253'></a> 18253           <a href='../S/2231.html#L393' title='Defined at 393 in src/termhooks.h.'>EVENT_INIT</a> (hold_quit);
<a id='L18254' name='L18254'></a> 18254           current_count = 0;
<a id='L18255' name='L18255'></a> 18255           current_hold_quit = &amp;hold_quit;
<a id='L18256' name='L18256'></a> 18256           current_finish = <a href='../S/2289.html#L1134' title='Defined at 1134 in src/xterm.c.'>X_EVENT_NORMAL</a>;
<a id='L18257' name='L18257'></a> 18257 
<a id='L18258' name='L18258'></a> 18258           gtk_main_iteration ();
<a id='L18259' name='L18259'></a> 18259 
<a id='L18260' name='L18260'></a> 18260           current_count = -1;
<a id='L18261' name='L18261'></a> 18261           current_hold_quit = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L18262' name='L18262'></a> 18262 
<a id='L18263' name='L18263'></a> 18263           <em class='comment'>/* Make us quit now.  */</em>
<a id='L18264' name='L18264'></a> 18264           <strong class='reserved'>if</strong> (hold_quit.kind != <a href='../S/2231.html#L74' title='Defined at 74 in src/termhooks.h.'>NO_EVENT</a>)
<a id='L18265' name='L18265'></a> 18265             <a href='../D/13636.html' title='Multiple defined in 2 places.'>kbd_buffer_store_event</a> (&amp;hold_quit);
<a id='L18266' name='L18266'></a> 18266 
<a id='L18267' name='L18267'></a> 18267           <strong class='reserved'>if</strong> (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (<a href='../D/7021.html' title='Multiple defined in 2 places.'>XCAR</a> (cell)))
<a id='L18268' name='L18268'></a> 18268             <strong class='reserved'>return</strong>;
<a id='L18269' name='L18269'></a> 18269 
<a id='L18270' name='L18270'></a> 18270           <strong class='reserved'>if</strong> (current_finish == <a href='../S/2289.html#L1135' title='Defined at 1135 in src/xterm.c.'>X_EVENT_GOTO_OUT</a>)
<a id='L18271' name='L18271'></a> 18271             <strong class='reserved'>break</strong>;
<a id='L18272' name='L18272'></a> 18272         <em class='brace'>}</em>
<a id='L18273' name='L18273'></a> 18273 <em class='sharp'>#endif</em>
<a id='L18274' name='L18274'></a> 18274 
<a id='L18275' name='L18275'></a> 18275       <a href='../D/10871.html' title='Multiple defined in 5 places.'>eassert</a> (maxfd &gt;= 0);
<a id='L18276' name='L18276'></a> 18276 
<a id='L18277' name='L18277'></a> 18277       current = <a href='../S/2947.html#L46' title='Defined at 46 in lib/gettime.c.'>current_timespec</a> ();
<a id='L18278' name='L18278'></a> 18278 
<a id='L18279' name='L18279'></a> 18279       <strong class='reserved'>if</strong> (<a href='../S/2788.html#L64' title='Defined at 64 in lib/timespec.h.'>timespec_cmp</a> (<a href='../S/2325.html#L61' title='Defined at 61 in src/cm.c.'>at</a>, current) &lt; 0
<a id='L18280' name='L18280'></a> 18280           || !<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (<a href='../D/7021.html' title='Multiple defined in 2 places.'>XCAR</a> (cell)))
<a id='L18281' name='L18281'></a> 18281         <strong class='reserved'>return</strong>;
<a id='L18282' name='L18282'></a> 18282 
<a id='L18283' name='L18283'></a> 18283       timeout = <a href='../S/2890.html#L31' title='Defined at 31 in lib/timespec-sub.c.'>timespec_sub</a> (<a href='../S/2325.html#L61' title='Defined at 61 in src/cm.c.'>at</a>, current);
<a id='L18284' name='L18284'></a> 18284 
<a id='L18285' name='L18285'></a> 18285 <em class='sharp'>#ifndef</em> USE_GTK
<a id='L18286' name='L18286'></a> 18286       rc = <a href='../D/15844.html' title='Multiple defined in 7 places.'>pselect</a> (maxfd + 1, &amp;fds, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, &amp;timeout, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L18287' name='L18287'></a> 18287 
<a id='L18288' name='L18288'></a> 18288       <strong class='reserved'>if</strong> (rc &gt;= 0)
<a id='L18289' name='L18289'></a> 18289         rfds = fds;
<a id='L18290' name='L18290'></a> 18290 <em class='sharp'>#else</em>
<a id='L18291' name='L18291'></a> 18291       <a href='../D/15844.html' title='Multiple defined in 7 places.'>pselect</a> (maxfd + 1, &amp;fds, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, &amp;timeout, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L18292' name='L18292'></a> 18292 <em class='sharp'>#endif</em>
<a id='L18293' name='L18293'></a> 18293     <em class='brace'>}</em>
<a id='L18294' name='L18294'></a> 18294 <em class='brace'>}</em>
<a id='L18295' name='L18295'></a> 18295 
<a id='L18296' name='L18296'></a> 18296 <em class='comment'>/* Find whether or not an undelivered MONITORS_CHANGED_EVENT is</em>
<a id='L18297' name='L18297'></a> 18297 <em class='comment'>   already on the event queue.  DPYINFO is the display any such event</em>
<a id='L18298' name='L18298'></a> 18298 <em class='comment'>   must apply to.  */</em>
<a id='L18299' name='L18299'></a> 18299 
<a id='L18300' name='L18300'></a> 18300 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L18301' name='L18301'></a> 18301 x_find_monitors_changed_event (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo)
<a id='L18302' name='L18302'></a> 18302 <em class='brace'>{</em>
<a id='L18303' name='L18303'></a> 18303   <strong class='reserved'>union</strong> <a href='../S/2185.html#L229' title='Defined at 229 in src/keyboard.h.'>buffered_input_event</a> *event;
<a id='L18304' name='L18304'></a> 18304 
<a id='L18305' name='L18305'></a> 18305   event = kbd_fetch_ptr;
<a id='L18306' name='L18306'></a> 18306 
<a id='L18307' name='L18307'></a> 18307   <strong class='reserved'>while</strong> (event != kbd_store_ptr)
<a id='L18308' name='L18308'></a> 18308     <em class='brace'>{</em>
<a id='L18309' name='L18309'></a> 18309       <strong class='reserved'>if</strong> (event-&gt;ie.kind == <a href='../S/2231.html#L335' title='Defined at 335 in src/termhooks.h.'>MONITORS_CHANGED_EVENT</a>
<a id='L18310' name='L18310'></a> 18310           &amp;&amp; <a href='../D/7379.html' title='Multiple defined in 2 places.'>XTERMINAL</a> (event-&gt;ie.arg) == dpyinfo-&gt;<a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>)
<a id='L18311' name='L18311'></a> 18311         <strong class='reserved'>return</strong> <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L18312' name='L18312'></a> 18312 
<a id='L18313' name='L18313'></a> 18313       event = <a href='../S/2289.html#L888' title='Defined at 888 in src/xterm.c.'>X_NEXT_KBD_EVENT</a> (event);
<a id='L18314' name='L18314'></a> 18314     <em class='brace'>}</em>
<a id='L18315' name='L18315'></a> 18315 
<a id='L18316' name='L18316'></a> 18316   <strong class='reserved'>return</strong> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L18317' name='L18317'></a> 18317 <em class='brace'>}</em>
<a id='L18318' name='L18318'></a> 18318 
<a id='L18319' name='L18319'></a> 18319 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L18320' name='L18320'></a> 18320 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L18321' name='L18321'></a> 18321 x_monitors_changed_cb (GdkScreen *gscr, gpointer user_data)
<a id='L18322' name='L18322'></a> 18322 <em class='brace'>{</em>
<a id='L18323' name='L18323'></a> 18323   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L18324' name='L18324'></a> 18324   <strong class='reserved'>struct</strong> <a href='../S/2231.html#L350' title='Defined at 350 in src/termhooks.h.'>input_event</a> ie;
<a id='L18325' name='L18325'></a> 18325   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> current_monitors, <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>;
<a id='L18326' name='L18326'></a> 18326   GdkDisplay *gdpy;
<a id='L18327' name='L18327'></a> 18327   <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy;
<a id='L18328' name='L18328'></a> 18328 
<a id='L18329' name='L18329'></a> 18329   gdpy = gdk_screen_get_display (gscr);
<a id='L18330' name='L18330'></a> 18330   dpy = gdk_x11_display_get_xdisplay (gdpy);
<a id='L18331' name='L18331'></a> 18331   dpyinfo = <a href='../S/2289.html#L6774' title='Defined at 6774 in src/xterm.c.'>x_display_info_for_display</a> (dpy);
<a id='L18332' name='L18332'></a> 18332 
<a id='L18333' name='L18333'></a> 18333   <strong class='reserved'>if</strong> (!dpyinfo)
<a id='L18334' name='L18334'></a> 18334     <strong class='reserved'>return</strong>;
<a id='L18335' name='L18335'></a> 18335 
<a id='L18336' name='L18336'></a> 18336   <strong class='reserved'>if</strong> (x_find_monitors_changed_event (dpyinfo))
<a id='L18337' name='L18337'></a> 18337     <strong class='reserved'>return</strong>;
<a id='L18338' name='L18338'></a> 18338 
<a id='L18339' name='L18339'></a> 18339   <a href='../D/7354.html' title='Multiple defined in 2 places.'>XSETTERMINAL</a> (<a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>, dpyinfo-&gt;<a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>);
<a id='L18340' name='L18340'></a> 18340 
<a id='L18341' name='L18341'></a> 18341   current_monitors
<a id='L18342' name='L18342'></a> 18342     = Fx_display_monitor_attributes_list (<a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>);
<a id='L18343' name='L18343'></a> 18343 
<a id='L18344' name='L18344'></a> 18344   <strong class='reserved'>if</strong> (<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (Fequal (current_monitors,
<a id='L18345' name='L18345'></a> 18345                     dpyinfo-&gt;last_monitor_attributes_list)))
<a id='L18346' name='L18346'></a> 18346     <em class='brace'>{</em>
<a id='L18347' name='L18347'></a> 18347       <a href='../S/2231.html#L393' title='Defined at 393 in src/termhooks.h.'>EVENT_INIT</a> (ie);
<a id='L18348' name='L18348'></a> 18348       ie.kind = <a href='../S/2231.html#L335' title='Defined at 335 in src/termhooks.h.'>MONITORS_CHANGED_EVENT</a>;
<a id='L18349' name='L18349'></a> 18349       ie.arg = <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>;
<a id='L18350' name='L18350'></a> 18350 
<a id='L18351' name='L18351'></a> 18351       <a href='../D/13636.html' title='Multiple defined in 2 places.'>kbd_buffer_store_event</a> (&amp;ie);
<a id='L18352' name='L18352'></a> 18352 
<a id='L18353' name='L18353'></a> 18353       <strong class='reserved'>if</strong> (x_dnd_in_progress &amp;&amp; x_dnd_update_tooltip)
<a id='L18354' name='L18354'></a> 18354         x_dnd_monitors = current_monitors;
<a id='L18355' name='L18355'></a> 18355 
<a id='L18356' name='L18356'></a> 18356       x_dnd_update_tooltip_now ();
<a id='L18357' name='L18357'></a> 18357     <em class='brace'>}</em>
<a id='L18358' name='L18358'></a> 18358 
<a id='L18359' name='L18359'></a> 18359   dpyinfo-&gt;last_monitor_attributes_list = current_monitors;
<a id='L18360' name='L18360'></a> 18360 <em class='brace'>}</em>
<a id='L18361' name='L18361'></a> 18361 <em class='sharp'>#endif</em>
<a id='L18362' name='L18362'></a> 18362 
<a id='L18363' name='L18363'></a> 18363 <em class='comment'>/* Extract the root window coordinates from the client message EVENT</em>
<a id='L18364' name='L18364'></a> 18364 <em class='comment'>   if it is a message that we already understand.  Return false if the</em>
<a id='L18365' name='L18365'></a> 18365 <em class='comment'>   event was not understood.  */</em>
<a id='L18366' name='L18366'></a> 18366 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L18367' name='L18367'></a> 18367 x_coords_from_dnd_message (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L18368' name='L18368'></a> 18368                            XEvent *event, <strong class='reserved'>int</strong> *x_out, <strong class='reserved'>int</strong> *y_out)
<a id='L18369' name='L18369'></a> 18369 <em class='brace'>{</em>
<a id='L18370' name='L18370'></a> 18370   <a href='../D/20008.html' title='Multiple defined in 2 places.'>xm_drag_motion_message</a> dmsg;
<a id='L18371' name='L18371'></a> 18371   <a href='../D/20009.html' title='Multiple defined in 2 places.'>xm_drag_motion_reply</a> dreply;
<a id='L18372' name='L18372'></a> 18372   <a href='../D/20018.html' title='Multiple defined in 2 places.'>xm_drop_start_message</a> smsg;
<a id='L18373' name='L18373'></a> 18373   <a href='../D/20019.html' title='Multiple defined in 2 places.'>xm_drop_start_reply</a> reply;
<a id='L18374' name='L18374'></a> 18374   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> kde_data;
<a id='L18375' name='L18375'></a> 18375 
<a id='L18376' name='L18376'></a> 18376   <strong class='reserved'>if</strong> (event-&gt;type != ClientMessage)
<a id='L18377' name='L18377'></a> 18377     <strong class='reserved'>return</strong> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L18378' name='L18378'></a> 18378 
<a id='L18379' name='L18379'></a> 18379   <strong class='reserved'>if</strong> (event-&gt;xclient.message_type == dpyinfo-&gt;Xatom_XdndPosition)
<a id='L18380' name='L18380'></a> 18380     <em class='brace'>{</em>
<a id='L18381' name='L18381'></a> 18381       <strong class='reserved'>if</strong> (event-&gt;xclient.format != 32)
<a id='L18382' name='L18382'></a> 18382         <strong class='reserved'>return</strong> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L18383' name='L18383'></a> 18383 
<a id='L18384' name='L18384'></a> 18384       *x_out = (((<strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong>) event-&gt;xclient.data.l[2]) &gt;&gt; 16
<a id='L18385' name='L18385'></a> 18385                 &amp; 0xffff);
<a id='L18386' name='L18386'></a> 18386       *y_out = (event-&gt;xclient.data.l[2] &amp; 0xffff);
<a id='L18387' name='L18387'></a> 18387 
<a id='L18388' name='L18388'></a> 18388       <strong class='reserved'>return</strong> <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L18389' name='L18389'></a> 18389     <em class='brace'>}</em>
<a id='L18390' name='L18390'></a> 18390 
<a id='L18391' name='L18391'></a> 18391   <strong class='reserved'>if</strong> ((event-&gt;xclient.message_type
<a id='L18392' name='L18392'></a> 18392        == dpyinfo-&gt;Xatom_MOTIF_DRAG_AND_DROP_MESSAGE)
<a id='L18393' name='L18393'></a> 18393       &amp;&amp; event-&gt;xclient.format == 8)
<a id='L18394' name='L18394'></a> 18394     <em class='brace'>{</em>
<a id='L18395' name='L18395'></a> 18395       <strong class='reserved'>if</strong> (!<a href='../S/2289.html#L2832' title='Defined at 2832 in src/xterm.c.'>xm_read_drag_motion_message</a> (event, &amp;dmsg))
<a id='L18396' name='L18396'></a> 18396         <em class='brace'>{</em>
<a id='L18397' name='L18397'></a> 18397           *x_out = dmsg.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L18398' name='L18398'></a> 18398           *y_out = dmsg.y;
<a id='L18399' name='L18399'></a> 18399 
<a id='L18400' name='L18400'></a> 18400           <strong class='reserved'>return</strong> <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L18401' name='L18401'></a> 18401         <em class='brace'>}</em>
<a id='L18402' name='L18402'></a> 18402       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (!<a href='../S/2289.html#L2866' title='Defined at 2866 in src/xterm.c.'>xm_read_drag_motion_reply</a> (event, &amp;dreply))
<a id='L18403' name='L18403'></a> 18403         <em class='brace'>{</em>
<a id='L18404' name='L18404'></a> 18404           *x_out = dreply.better_x;
<a id='L18405' name='L18405'></a> 18405           *y_out = dreply.better_y;
<a id='L18406' name='L18406'></a> 18406 
<a id='L18407' name='L18407'></a> 18407           <strong class='reserved'>return</strong> <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L18408' name='L18408'></a> 18408         <em class='brace'>}</em>
<a id='L18409' name='L18409'></a> 18409       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (!<a href='../S/2289.html#L2738' title='Defined at 2738 in src/xterm.c.'>xm_read_drop_start_message</a> (event, &amp;smsg))
<a id='L18410' name='L18410'></a> 18410         <em class='brace'>{</em>
<a id='L18411' name='L18411'></a> 18411           *x_out = smsg.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L18412' name='L18412'></a> 18412           *y_out = smsg.y;
<a id='L18413' name='L18413'></a> 18413 
<a id='L18414' name='L18414'></a> 18414           <strong class='reserved'>return</strong> <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L18415' name='L18415'></a> 18415         <em class='brace'>}</em>
<a id='L18416' name='L18416'></a> 18416       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (!<a href='../S/2289.html#L2707' title='Defined at 2707 in src/xterm.c.'>xm_read_drop_start_reply</a> (event, &amp;reply))
<a id='L18417' name='L18417'></a> 18417         <em class='brace'>{</em>
<a id='L18418' name='L18418'></a> 18418           *x_out = reply.better_x;
<a id='L18419' name='L18419'></a> 18419           *y_out = reply.better_y;
<a id='L18420' name='L18420'></a> 18420 
<a id='L18421' name='L18421'></a> 18421           <strong class='reserved'>return</strong> <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L18422' name='L18422'></a> 18422         <em class='brace'>}</em>
<a id='L18423' name='L18423'></a> 18423     <em class='brace'>}</em>
<a id='L18424' name='L18424'></a> 18424 
<a id='L18425' name='L18425'></a> 18425   <strong class='reserved'>if</strong> (((event-&gt;xclient.message_type
<a id='L18426' name='L18426'></a> 18426         == dpyinfo-&gt;Xatom_DndProtocol)
<a id='L18427' name='L18427'></a> 18427        || (event-&gt;xclient.message_type
<a id='L18428' name='L18428'></a> 18428            == dpyinfo-&gt;Xatom_DND_PROTOCOL))
<a id='L18429' name='L18429'></a> 18429       &amp;&amp; event-&gt;xclient.format == 32
<a id='L18430' name='L18430'></a> 18430       <em class='comment'>/* Check that the version of the old KDE protocol is new</em>
<a id='L18431' name='L18431'></a> 18431 <em class='comment'>         enough to include coordinates.  */</em>
<a id='L18432' name='L18432'></a> 18432       &amp;&amp; event-&gt;xclient.data.l[4])
<a id='L18433' name='L18433'></a> 18433     <em class='brace'>{</em>
<a id='L18434' name='L18434'></a> 18434       kde_data = (<strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong>) event-&gt;xclient.data.l[3];
<a id='L18435' name='L18435'></a> 18435 
<a id='L18436' name='L18436'></a> 18436       *x_out = (kde_data &amp; 0xffff);
<a id='L18437' name='L18437'></a> 18437       *y_out = (kde_data &gt;&gt; 16 &amp; 0xffff);
<a id='L18438' name='L18438'></a> 18438 
<a id='L18439' name='L18439'></a> 18439       <strong class='reserved'>return</strong> <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L18440' name='L18440'></a> 18440     <em class='brace'>}</em>
<a id='L18441' name='L18441'></a> 18441 
<a id='L18442' name='L18442'></a> 18442   <strong class='reserved'>return</strong> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L18443' name='L18443'></a> 18443 <em class='brace'>}</em>
<a id='L18444' name='L18444'></a> 18444 
<a id='L18445' name='L18445'></a> 18445 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L18446' name='L18446'></a> 18446 x_handle_wm_state (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <strong class='reserved'>struct</strong> <a href='../S/2231.html#L350' title='Defined at 350 in src/termhooks.h.'>input_event</a> *ie)
<a id='L18447' name='L18447'></a> 18447 <em class='brace'>{</em>
<a id='L18448' name='L18448'></a> 18448   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L18449' name='L18449'></a> 18449   Atom type;
<a id='L18450' name='L18450'></a> 18450   <strong class='reserved'>int</strong> format;
<a id='L18451' name='L18451'></a> 18451   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> nitems, bytes_after;
<a id='L18452' name='L18452'></a> 18452   <strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *data;
<a id='L18453' name='L18453'></a> 18453   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> *state;
<a id='L18454' name='L18454'></a> 18454 
<a id='L18455' name='L18455'></a> 18455   data = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L18456' name='L18456'></a> 18456   dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L18457' name='L18457'></a> 18457 
<a id='L18458' name='L18458'></a> 18458   <strong class='reserved'>if</strong> (XGetWindowProperty (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L18459' name='L18459'></a> 18459                           dpyinfo-&gt;Xatom_wm_state, 0, 2, False,
<a id='L18460' name='L18460'></a> 18460                           AnyPropertyType, &amp;type, &amp;format, &amp;nitems,
<a id='L18461' name='L18461'></a> 18461                           &amp;bytes_after, &amp;data) != Success)
<a id='L18462' name='L18462'></a> 18462     <strong class='reserved'>return</strong>;
<a id='L18463' name='L18463'></a> 18463 
<a id='L18464' name='L18464'></a> 18464   <strong class='reserved'>if</strong> (!data || nitems != 2 || format != 32)
<a id='L18465' name='L18465'></a> 18465     <em class='brace'>{</em>
<a id='L18466' name='L18466'></a> 18466       <strong class='reserved'>if</strong> (data)
<a id='L18467' name='L18467'></a> 18467         XFree (data);
<a id='L18468' name='L18468'></a> 18468 
<a id='L18469' name='L18469'></a> 18469       <strong class='reserved'>return</strong>;
<a id='L18470' name='L18470'></a> 18470     <em class='brace'>}</em>
<a id='L18471' name='L18471'></a> 18471 
<a id='L18472' name='L18472'></a> 18472   state = (<strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> *) data;
<a id='L18473' name='L18473'></a> 18473 
<a id='L18474' name='L18474'></a> 18474   <strong class='reserved'>if</strong> (state[0] == NormalState &amp;&amp; <a href='../S/2183.html#L1172' title='Defined at 1172 in src/frame.h.'>FRAME_ICONIFIED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L18475' name='L18475'></a> 18475     <em class='brace'>{</em>
<a id='L18476' name='L18476'></a> 18476       <em class='comment'>/* The frame has been deiconified.  It has not been withdrawn</em>
<a id='L18477' name='L18477'></a> 18477 <em class='comment'>         and is now visible.  */</em>
<a id='L18478' name='L18478'></a> 18478       <a href='../S/2183.html#L1437' title='Defined at 1437 in src/frame.h.'>SET_FRAME_VISIBLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 1);
<a id='L18479' name='L18479'></a> 18479       <a href='../S/2183.html#L1452' title='Defined at 1452 in src/frame.h.'>SET_FRAME_ICONIFIED</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L18480' name='L18480'></a> 18480       <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;has_been_visible = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L18481' name='L18481'></a> 18481 
<a id='L18482' name='L18482'></a> 18482       ie-&gt;kind = <a href='../S/2231.html#L197' title='Defined at 197 in src/termhooks.h.'>DEICONIFY_EVENT</a>;
<a id='L18483' name='L18483'></a> 18483       <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (ie-&gt;frame_or_window, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L18484' name='L18484'></a> 18484     <em class='brace'>}</em>
<a id='L18485' name='L18485'></a> 18485   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (state[0] == IconicState
<a id='L18486' name='L18486'></a> 18486            <em class='comment'>/* _NET_WM_STATE_HIDDEN should be used if the window</em>
<a id='L18487' name='L18487'></a> 18487 <em class='comment'>              manager supports that.  */</em>
<a id='L18488' name='L18488'></a> 18488            &amp;&amp; !x_wm_supports (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, dpyinfo-&gt;Xatom_net_wm_state_hidden))
<a id='L18489' name='L18489'></a> 18489     <em class='brace'>{</em>
<a id='L18490' name='L18490'></a> 18490       <em class='comment'>/* The frame is actually iconified right now.  Mark it as</em>
<a id='L18491' name='L18491'></a> 18491 <em class='comment'>         such.  */</em>
<a id='L18492' name='L18492'></a> 18492 
<a id='L18493' name='L18493'></a> 18493       <a href='../S/2183.html#L1437' title='Defined at 1437 in src/frame.h.'>SET_FRAME_VISIBLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 0);
<a id='L18494' name='L18494'></a> 18494       <a href='../S/2183.html#L1452' title='Defined at 1452 in src/frame.h.'>SET_FRAME_ICONIFIED</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L18495' name='L18495'></a> 18495 
<a id='L18496' name='L18496'></a> 18496       ie-&gt;kind = <a href='../S/2231.html#L196' title='Defined at 196 in src/termhooks.h.'>ICONIFY_EVENT</a>;
<a id='L18497' name='L18497'></a> 18497       <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (ie-&gt;frame_or_window, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L18498' name='L18498'></a> 18498     <em class='brace'>}</em>
<a id='L18499' name='L18499'></a> 18499 
<a id='L18500' name='L18500'></a> 18500   <em class='comment'>/* state[0] can also be WithdrawnState, meaning that the window has</em>
<a id='L18501' name='L18501'></a> 18501 <em class='comment'>     been withdrawn and is no longer iconified.  However, Emacs sets</em>
<a id='L18502' name='L18502'></a> 18502 <em class='comment'>     the correct flags upon withdrawing the window, so there is no</em>
<a id='L18503' name='L18503'></a> 18503 <em class='comment'>     need to do anything here.  */</em>
<a id='L18504' name='L18504'></a> 18504 
<a id='L18505' name='L18505'></a> 18505   XFree (data);
<a id='L18506' name='L18506'></a> 18506 <em class='brace'>}</em>
<a id='L18507' name='L18507'></a> 18507 
<a id='L18508' name='L18508'></a> 18508 <em class='sharp'>#ifdef</em> HAVE_XFIXES
<a id='L18509' name='L18509'></a> 18509 
<a id='L18510' name='L18510'></a> 18510 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L18511' name='L18511'></a> 18511 x_handle_selection_monitor_event (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L18512' name='L18512'></a> 18512                                   <strong class='reserved'>const</strong> XEvent *event)
<a id='L18513' name='L18513'></a> 18513 <em class='brace'>{</em>
<a id='L18514' name='L18514'></a> 18514   XFixesSelectionNotifyEvent *notify;
<a id='L18515' name='L18515'></a> 18515   <strong class='reserved'>int</strong> i;
<a id='L18516' name='L18516'></a> 18516 
<a id='L18517' name='L18517'></a> 18517   notify = (XFixesSelectionNotifyEvent *) event;
<a id='L18518' name='L18518'></a> 18518 
<a id='L18519' name='L18519'></a> 18519   <strong class='reserved'>if</strong> (notify-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> != dpyinfo-&gt;selection_tracking_window)
<a id='L18520' name='L18520'></a> 18520     <strong class='reserved'>return</strong> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L18521' name='L18521'></a> 18521 
<a id='L18522' name='L18522'></a> 18522   <strong class='reserved'>for</strong> (i = 0; i &lt; dpyinfo-&gt;n_monitored_selections; ++i)
<a id='L18523' name='L18523'></a> 18523     <em class='brace'>{</em>
<a id='L18524' name='L18524'></a> 18524       <em class='comment'>/* We don't have to keep track of timestamps here.  */</em>
<a id='L18525' name='L18525'></a> 18525       <strong class='reserved'>if</strong> (notify-&gt;<a href='../S/2073.html#L63' title='Defined at 63 in lwlib/lwlib-Xm.c.'>selection</a> == dpyinfo-&gt;monitored_selections[i].<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>)
<a id='L18526' name='L18526'></a> 18526         dpyinfo-&gt;monitored_selections[i].owner = notify-&gt;owner;
<a id='L18527' name='L18527'></a> 18527     <em class='brace'>}</em>
<a id='L18528' name='L18528'></a> 18528 
<a id='L18529' name='L18529'></a> 18529   <strong class='reserved'>return</strong> <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L18530' name='L18530'></a> 18530 <em class='brace'>}</em>
<a id='L18531' name='L18531'></a> 18531 
<a id='L18532' name='L18532'></a> 18532 <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a>
<a id='L18533' name='L18533'></a> 18533 x_find_selection_owner (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo, Atom <a href='../S/2073.html#L63' title='Defined at 63 in lwlib/lwlib-Xm.c.'>selection</a>)
<a id='L18534' name='L18534'></a> 18534 <em class='brace'>{</em>
<a id='L18535' name='L18535'></a> 18535   <strong class='reserved'>int</strong> i;
<a id='L18536' name='L18536'></a> 18536 
<a id='L18537' name='L18537'></a> 18537   <strong class='reserved'>for</strong> (i = 0; i &lt; dpyinfo-&gt;n_monitored_selections; ++i)
<a id='L18538' name='L18538'></a> 18538     <em class='brace'>{</em>
<a id='L18539' name='L18539'></a> 18539       <strong class='reserved'>if</strong> (<a href='../S/2073.html#L63' title='Defined at 63 in lwlib/lwlib-Xm.c.'>selection</a> == dpyinfo-&gt;monitored_selections[i].<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>)
<a id='L18540' name='L18540'></a> 18540         <strong class='reserved'>return</strong> dpyinfo-&gt;monitored_selections[i].owner;
<a id='L18541' name='L18541'></a> 18541     <em class='brace'>}</em>
<a id='L18542' name='L18542'></a> 18542 
<a id='L18543' name='L18543'></a> 18543   <strong class='reserved'>return</strong> <a href='../S/2212.html#L361' title='Defined at 361 in src/xterm.h.'>X_INVALID_WINDOW</a>;
<a id='L18544' name='L18544'></a> 18544 <em class='brace'>}</em>
<a id='L18545' name='L18545'></a> 18545 
<a id='L18546' name='L18546'></a> 18546 <em class='sharp'>#endif</em>
<a id='L18547' name='L18547'></a> 18547 
<a id='L18548' name='L18548'></a> 18548 <em class='comment'>/* Handles the XEvent EVENT on display DPYINFO.</em>
<a id='L18549' name='L18549'></a> 18549 <em class='comment'></em>
<a id='L18550' name='L18550'></a> 18550 <em class='comment'>   *FINISH is X_EVENT_GOTO_OUT if caller should stop reading events.</em>
<a id='L18551' name='L18551'></a> 18551 <em class='comment'>   *FINISH is zero if caller should continue reading events.</em>
<a id='L18552' name='L18552'></a> 18552 <em class='comment'>   *FINISH is X_EVENT_DROP if event should not be passed to the toolkit.</em>
<a id='L18553' name='L18553'></a> 18553 <em class='comment'>   *EVENT is unchanged unless we're processing KeyPress event.</em>
<a id='L18554' name='L18554'></a> 18554 <em class='comment'></em>
<a id='L18555' name='L18555'></a> 18555 <em class='comment'>   We return the number of characters stored into the buffer.  */</em>
<a id='L18556' name='L18556'></a> 18556 
<a id='L18557' name='L18557'></a> 18557 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L18558' name='L18558'></a> 18558 handle_one_xevent (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L18559' name='L18559'></a> 18559 <em class='sharp'>#ifndef</em> HAVE_XINPUT2
<a id='L18560' name='L18560'></a> 18560                    <strong class='reserved'>const</strong> XEvent *event,
<a id='L18561' name='L18561'></a> 18561 <em class='sharp'>#else</em>
<a id='L18562' name='L18562'></a> 18562                    XEvent *event,
<a id='L18563' name='L18563'></a> 18563 <em class='sharp'>#endif</em>
<a id='L18564' name='L18564'></a> 18564                    <strong class='reserved'>int</strong> *finish, <strong class='reserved'>struct</strong> <a href='../S/2231.html#L350' title='Defined at 350 in src/termhooks.h.'>input_event</a> *hold_quit)
<a id='L18565' name='L18565'></a> 18565 <em class='brace'>{</em>
<a id='L18566' name='L18566'></a> 18566   <strong class='reserved'>union</strong> <a href='../S/2185.html#L229' title='Defined at 229 in src/keyboard.h.'>buffered_input_event</a> inev;
<a id='L18567' name='L18567'></a> 18567   <strong class='reserved'>int</strong> count = 0;
<a id='L18568' name='L18568'></a> 18568   <strong class='reserved'>int</strong> do_help = 0;
<a id='L18569' name='L18569'></a> 18569 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L18570' name='L18570'></a> 18570   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L275' title='Defined at 275 in src/xterm.h.'>xi_device_t</a> *gen_help_device;
<a id='L18571' name='L18571'></a> 18571   <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a> gen_help_time <a href='../D/6570.html' title='Multiple defined in 2 places.'>UNINIT</a>;
<a id='L18572' name='L18572'></a> 18572 <em class='sharp'>#endif</em>
<a id='L18573' name='L18573'></a> 18573   ptrdiff_t nbytes = 0;
<a id='L18574' name='L18574'></a> 18574   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *any, *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, *mouse_frame;
<a id='L18575' name='L18575'></a> 18575   <a href='../S/2315.html#L2919' title='Defined at 2919 in src/dispextern.h.'>Mouse_HLInfo</a> *hlinfo = &amp;dpyinfo-&gt;mouse_highlight;
<a id='L18576' name='L18576'></a> 18576   <em class='comment'>/* This holds the state XLookupString needs to implement dead keys</em>
<a id='L18577' name='L18577'></a> 18577 <em class='comment'>     and other tricks known as "compose processing".  _X Window System_</em>
<a id='L18578' name='L18578'></a> 18578 <em class='comment'>     says that a portable program can't use this, but Stephen Gildea assures</em>
<a id='L18579' name='L18579'></a> 18579 <em class='comment'>     me that letting the compiler initialize it to zeros will work okay.  */</em>
<a id='L18580' name='L18580'></a> 18580   <strong class='reserved'>static</strong> XComposeStatus compose_status;
<a id='L18581' name='L18581'></a> 18581   XEvent configureEvent;
<a id='L18582' name='L18582'></a> 18582   XEvent next_event;
<a id='L18583' name='L18583'></a> 18583   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> coding;
<a id='L18584' name='L18584'></a> 18584 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> USE_X_TOOLKIT &amp;&amp; <strong class='reserved'>defined</strong> HAVE_XINPUT2
<a id='L18585' name='L18585'></a> 18585   <em class='comment'>/* Some XInput 2 events are important for Motif and Lucid menu bars</em>
<a id='L18586' name='L18586'></a> 18586 <em class='comment'>     to work correctly, so they must be translated into core events</em>
<a id='L18587' name='L18587'></a> 18587 <em class='comment'>     before being passed to XtDispatchEvent.  */</em>
<a id='L18588' name='L18588'></a> 18588   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> use_copy = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L18589' name='L18589'></a> 18589   XEvent copy;
<a id='L18590' name='L18590'></a> 18590 <em class='sharp'>#elif</em> <strong class='reserved'>defined</strong> USE_GTK &amp;&amp; !<strong class='reserved'>defined</strong> HAVE_GTK3 &amp;&amp; <strong class='reserved'>defined</strong> HAVE_XINPUT2
<a id='L18591' name='L18591'></a> 18591   GdkEvent *copy = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L18592' name='L18592'></a> 18592   GdkDisplay *gdpy = gdk_x11_lookup_xdisplay (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L18593' name='L18593'></a> 18593 <em class='sharp'>#endif</em>
<a id='L18594' name='L18594'></a> 18594   <strong class='reserved'>int</strong> dx, dy;
<a id='L18595' name='L18595'></a> 18595 
<a id='L18596' name='L18596'></a> 18596   <em class='comment'>/* Avoid warnings when SAFE_ALLOCA is not actually used.  */</em>
<a id='L18597' name='L18597'></a> 18597 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XINPUT2 || <strong class='reserved'>defined</strong> HAVE_XKB || <strong class='reserved'>defined</strong> HAVE_X_I18N
<a id='L18598' name='L18598'></a> 18598   <a href='../D/6613.html' title='Multiple defined in 2 places.'>USE_SAFE_ALLOCA</a>;
<a id='L18599' name='L18599'></a> 18599 <em class='sharp'>#endif</em>
<a id='L18600' name='L18600'></a> 18600 
<a id='L18601' name='L18601'></a> 18601   <em class='comment'>/* This function is not reentrant, so input should be blocked before</em>
<a id='L18602' name='L18602'></a> 18602 <em class='comment'>     it is called.  */</em>
<a id='L18603' name='L18603'></a> 18603 
<a id='L18604' name='L18604'></a> 18604   <strong class='reserved'>if</strong> (!<a href='../S/2089.html#L65' title='Defined at 65 in src/blockinput.h.'>input_blocked_p</a> ())
<a id='L18605' name='L18605'></a> 18605     <a href='../D/10893.html' title='Multiple defined in 6 places.'>emacs_abort</a> ();
<a id='L18606' name='L18606'></a> 18606 
<a id='L18607' name='L18607'></a> 18607   *finish = <a href='../S/2289.html#L1134' title='Defined at 1134 in src/xterm.c.'>X_EVENT_NORMAL</a>;
<a id='L18608' name='L18608'></a> 18608 
<a id='L18609' name='L18609'></a> 18609   <a href='../S/2231.html#L393' title='Defined at 393 in src/termhooks.h.'>EVENT_INIT</a> (inev.ie);
<a id='L18610' name='L18610'></a> 18610   inev.ie.kind = <a href='../S/2231.html#L74' title='Defined at 74 in src/termhooks.h.'>NO_EVENT</a>;
<a id='L18611' name='L18611'></a> 18611   inev.ie.arg = Qnil;
<a id='L18612' name='L18612'></a> 18612 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L18613' name='L18613'></a> 18613   gen_help_device = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L18614' name='L18614'></a> 18614 <em class='sharp'>#endif</em>
<a id='L18615' name='L18615'></a> 18615 
<a id='L18616' name='L18616'></a> 18616   <em class='comment'>/* Ignore events coming from various extensions, such as XFIXES and</em>
<a id='L18617' name='L18617'></a> 18617 <em class='comment'>     XKB.  */</em>
<a id='L18618' name='L18618'></a> 18618   <strong class='reserved'>if</strong> (event-&gt;type &lt; LASTEvent)
<a id='L18619' name='L18619'></a> 18619     <em class='brace'>{</em>
<a id='L18620' name='L18620'></a> 18620 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L18621' name='L18621'></a> 18621       <strong class='reserved'>if</strong> (event-&gt;type != GenericEvent)
<a id='L18622' name='L18622'></a> 18622 <em class='sharp'>#endif</em>
<a id='L18623' name='L18623'></a> 18623         any = <a href='../D/19416.html' title='Multiple defined in 2 places.'>x_any_window_to_frame</a> (dpyinfo, event-&gt;xany.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L18624' name='L18624'></a> 18624 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L18625' name='L18625'></a> 18625       <strong class='reserved'>else</strong>
<a id='L18626' name='L18626'></a> 18626         any = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L18627' name='L18627'></a> 18627 <em class='sharp'>#endif</em>
<a id='L18628' name='L18628'></a> 18628     <em class='brace'>}</em>
<a id='L18629' name='L18629'></a> 18629   <strong class='reserved'>else</strong>
<a id='L18630' name='L18630'></a> 18630     any = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L18631' name='L18631'></a> 18631 
<a id='L18632' name='L18632'></a> 18632   <strong class='reserved'>if</strong> (any &amp;&amp; any-&gt;wait_event_type == event-&gt;type)
<a id='L18633' name='L18633'></a> 18633     any-&gt;wait_event_type = 0; <em class='comment'>/* Indicates we got it.  */</em>
<a id='L18634' name='L18634'></a> 18634 
<a id='L18635' name='L18635'></a> 18635   <strong class='reserved'>switch</strong> (event-&gt;type)
<a id='L18636' name='L18636'></a> 18636     <em class='brace'>{</em>
<a id='L18637' name='L18637'></a> 18637     <strong class='reserved'>case</strong> ClientMessage:
<a id='L18638' name='L18638'></a> 18638       <em class='brace'>{</em>
<a id='L18639' name='L18639'></a> 18639         <strong class='reserved'>int</strong> rc;
<a id='L18640' name='L18640'></a> 18640 
<a id='L18641' name='L18641'></a> 18641         <strong class='reserved'>if</strong> (((x_dnd_in_progress
<a id='L18642' name='L18642'></a> 18642               &amp;&amp; <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (x_dnd_frame) == dpyinfo)
<a id='L18643' name='L18643'></a> 18643              || (x_dnd_waiting_for_finish
<a id='L18644' name='L18644'></a> 18644                  &amp;&amp; <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (x_dnd_finish_frame) == dpyinfo))
<a id='L18645' name='L18645'></a> 18645             &amp;&amp; event-&gt;xclient.message_type == dpyinfo-&gt;Xatom_XdndStatus)
<a id='L18646' name='L18646'></a> 18646           <em class='brace'>{</em>
<a id='L18647' name='L18647'></a> 18647             <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> target;
<a id='L18648' name='L18648'></a> 18648             <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> <a href='../S/4051.html#L55' title='Defined at 55 in test/manual/etags/c-src/sysdep.h.'>r1</a>, r2;
<a id='L18649' name='L18649'></a> 18649             <strong class='reserved'>int</strong> root_x, root_y;
<a id='L18650' name='L18650'></a> 18650             <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> button;
<a id='L18651' name='L18651'></a> 18651 
<a id='L18652' name='L18652'></a> 18652             target = event-&gt;xclient.data.l[0];
<a id='L18653' name='L18653'></a> 18653 
<a id='L18654' name='L18654'></a> 18654             <strong class='reserved'>if</strong> (x_dnd_last_protocol_version != -1
<a id='L18655' name='L18655'></a> 18655                 &amp;&amp; x_dnd_in_progress
<a id='L18656' name='L18656'></a> 18656                 &amp;&amp; target == x_dnd_last_seen_toplevel
<a id='L18657' name='L18657'></a> 18657                 <em class='comment'>/* The XDND documentation is not very clearly worded.</em>
<a id='L18658' name='L18658'></a> 18658 <em class='comment'>                   But this should be the correct behavior, since</em>
<a id='L18659' name='L18659'></a> 18659 <em class='comment'>                   "kDNDStatusSendHereFlag" in the reference</em>
<a id='L18660' name='L18660'></a> 18660 <em class='comment'>                   implementation is 2, and means the mouse rect</em>
<a id='L18661' name='L18661'></a> 18661 <em class='comment'>                   should be ignored.  */</em>
<a id='L18662' name='L18662'></a> 18662                 &amp;&amp; !(event-&gt;xclient.data.l[1] &amp; 2))
<a id='L18663' name='L18663'></a> 18663               <em class='brace'>{</em>
<a id='L18664' name='L18664'></a> 18664                 <a href='../S/4051.html#L55' title='Defined at 55 in test/manual/etags/c-src/sysdep.h.'>r1</a> = event-&gt;xclient.data.l[2];
<a id='L18665' name='L18665'></a> 18665                 r2 = event-&gt;xclient.data.l[3];
<a id='L18666' name='L18666'></a> 18666 
<a id='L18667' name='L18667'></a> 18667                 x_dnd_mouse_rect_target = target;
<a id='L18668' name='L18668'></a> 18668                 x_dnd_mouse_rect.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = (<a href='../S/4051.html#L55' title='Defined at 55 in test/manual/etags/c-src/sysdep.h.'>r1</a> &amp; 0xffff0000) &gt;&gt; 16;
<a id='L18669' name='L18669'></a> 18669                 x_dnd_mouse_rect.y = (<a href='../S/4051.html#L55' title='Defined at 55 in test/manual/etags/c-src/sysdep.h.'>r1</a> &amp; 0xffff);
<a id='L18670' name='L18670'></a> 18670                 x_dnd_mouse_rect.width = (r2 &amp; 0xffff0000) &gt;&gt; 16;
<a id='L18671' name='L18671'></a> 18671                 x_dnd_mouse_rect.height = (r2 &amp; 0xffff);
<a id='L18672' name='L18672'></a> 18672               <em class='brace'>}</em>
<a id='L18673' name='L18673'></a> 18673             <strong class='reserved'>else</strong>
<a id='L18674' name='L18674'></a> 18674               x_dnd_mouse_rect_target = None;
<a id='L18675' name='L18675'></a> 18675 
<a id='L18676' name='L18676'></a> 18676             <strong class='reserved'>if</strong> (x_dnd_last_protocol_version != -1
<a id='L18677' name='L18677'></a> 18677                 &amp;&amp; (x_dnd_in_progress
<a id='L18678' name='L18678'></a> 18678                     &amp;&amp; target == x_dnd_last_seen_window))
<a id='L18679' name='L18679'></a> 18679               <em class='brace'>{</em>
<a id='L18680' name='L18680'></a> 18680                 <strong class='reserved'>if</strong> (event-&gt;xclient.data.l[1] &amp; 1)
<a id='L18681' name='L18681'></a> 18681                   <em class='brace'>{</em>
<a id='L18682' name='L18682'></a> 18682                     <strong class='reserved'>if</strong> (x_dnd_last_protocol_version &gt;= 2)
<a id='L18683' name='L18683'></a> 18683                       x_dnd_action = event-&gt;xclient.data.l[4];
<a id='L18684' name='L18684'></a> 18684                     <strong class='reserved'>else</strong>
<a id='L18685' name='L18685'></a> 18685                       x_dnd_action = dpyinfo-&gt;Xatom_XdndActionCopy;
<a id='L18686' name='L18686'></a> 18686                   <em class='brace'>}</em>
<a id='L18687' name='L18687'></a> 18687                 <strong class='reserved'>else</strong>
<a id='L18688' name='L18688'></a> 18688                   x_dnd_action = None;
<a id='L18689' name='L18689'></a> 18689               <em class='brace'>}</em>
<a id='L18690' name='L18690'></a> 18690 
<a id='L18691' name='L18691'></a> 18691             <em class='comment'>/* Send any pending XdndPosition message.  */</em>
<a id='L18692' name='L18692'></a> 18692             <strong class='reserved'>if</strong> (x_dnd_waiting_for_status_window == target)
<a id='L18693' name='L18693'></a> 18693               <em class='brace'>{</em>
<a id='L18694' name='L18694'></a> 18694                 <strong class='reserved'>if</strong> (x_dnd_pending_send_position.type != 0)
<a id='L18695' name='L18695'></a> 18695                   <em class='brace'>{</em>
<a id='L18696' name='L18696'></a> 18696                     <em class='comment'>/* If the last XdndStatus specified a mouse</em>
<a id='L18697' name='L18697'></a> 18697 <em class='comment'>                       rectangle and this event falls inside, don't</em>
<a id='L18698' name='L18698'></a> 18698 <em class='comment'>                       send the event, but clear</em>
<a id='L18699' name='L18699'></a> 18699 <em class='comment'>                       x_dnd_waiting_for_status_window instead.  */</em>
<a id='L18700' name='L18700'></a> 18700 
<a id='L18701' name='L18701'></a> 18701                     root_x = x_dnd_pending_send_position_root_x;
<a id='L18702' name='L18702'></a> 18702                     root_y = x_dnd_pending_send_position_root_y;
<a id='L18703' name='L18703'></a> 18703                     button = x_dnd_pending_send_position_button;
<a id='L18704' name='L18704'></a> 18704 
<a id='L18705' name='L18705'></a> 18705                     <strong class='reserved'>if</strong> (target == x_dnd_mouse_rect_target
<a id='L18706' name='L18706'></a> 18706                         &amp;&amp; x_dnd_mouse_rect.width
<a id='L18707' name='L18707'></a> 18707                         &amp;&amp; x_dnd_mouse_rect.height
<a id='L18708' name='L18708'></a> 18708                         <em class='comment'>/* Ignore the mouse rectangle if we're</em>
<a id='L18709' name='L18709'></a> 18709 <em class='comment'>                           supposed to be sending a button press</em>
<a id='L18710' name='L18710'></a> 18710 <em class='comment'>                           instead.  */</em>
<a id='L18711' name='L18711'></a> 18711                         &amp;&amp; !button
<a id='L18712' name='L18712'></a> 18712                         &amp;&amp; (root_x &gt;= x_dnd_mouse_rect.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>
<a id='L18713' name='L18713'></a> 18713                             &amp;&amp; root_x &lt; (x_dnd_mouse_rect.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>
<a id='L18714' name='L18714'></a> 18714                                          + x_dnd_mouse_rect.width)
<a id='L18715' name='L18715'></a> 18715                             &amp;&amp; root_y &gt;= x_dnd_mouse_rect.y
<a id='L18716' name='L18716'></a> 18716                             &amp;&amp; root_y &lt; (x_dnd_mouse_rect.y
<a id='L18717' name='L18717'></a> 18717                                          + x_dnd_mouse_rect.height)))
<a id='L18718' name='L18718'></a> 18718                       x_dnd_waiting_for_status_window = None;
<a id='L18719' name='L18719'></a> 18719                     <strong class='reserved'>else</strong>
<a id='L18720' name='L18720'></a> 18720                       <em class='brace'>{</em>
<a id='L18721' name='L18721'></a> 18721                         x_ignore_errors_for_next_request (dpyinfo, 0);
<a id='L18722' name='L18722'></a> 18722                         XSendEvent (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, target,
<a id='L18723' name='L18723'></a> 18723                                     False, NoEventMask,
<a id='L18724' name='L18724'></a> 18724                                     &amp;x_dnd_pending_send_position);
<a id='L18725' name='L18725'></a> 18725                         x_stop_ignoring_errors (dpyinfo);
<a id='L18726' name='L18726'></a> 18726                         x_dnd_pending_send_position.type = 0;
<a id='L18727' name='L18727'></a> 18727 
<a id='L18728' name='L18728'></a> 18728                         <em class='comment'>/* Since we sent another XdndPosition message, we</em>
<a id='L18729' name='L18729'></a> 18729 <em class='comment'>                           have to wait for another one in reply, so don't</em>
<a id='L18730' name='L18730'></a> 18730 <em class='comment'>                           reset `x_dnd_waiting_for_status_window'</em>
<a id='L18731' name='L18731'></a> 18731 <em class='comment'>                           here.  */</em>
<a id='L18732' name='L18732'></a> 18732                       <em class='brace'>}</em>
<a id='L18733' name='L18733'></a> 18733                   <em class='brace'>}</em>
<a id='L18734' name='L18734'></a> 18734                 <strong class='reserved'>else</strong>
<a id='L18735' name='L18735'></a> 18735                   x_dnd_waiting_for_status_window = None;
<a id='L18736' name='L18736'></a> 18736 
<a id='L18737' name='L18737'></a> 18737                 <em class='comment'>/* Send any pending drop if warranted.  */</em>
<a id='L18738' name='L18738'></a> 18738                 <strong class='reserved'>if</strong> (x_dnd_waiting_for_finish &amp;&amp; x_dnd_need_send_drop
<a id='L18739' name='L18739'></a> 18739                     &amp;&amp; x_dnd_waiting_for_status_window == None)
<a id='L18740' name='L18740'></a> 18740                   <em class='brace'>{</em>
<a id='L18741' name='L18741'></a> 18741                     <strong class='reserved'>if</strong> (event-&gt;xclient.data.l[1] &amp; 1)
<a id='L18742' name='L18742'></a> 18742                       <em class='brace'>{</em>
<a id='L18743' name='L18743'></a> 18743                         <strong class='reserved'>if</strong> (x_dnd_send_drop_proto &gt;= 2)
<a id='L18744' name='L18744'></a> 18744                           x_dnd_action = event-&gt;xclient.data.l[4];
<a id='L18745' name='L18745'></a> 18745                         <strong class='reserved'>else</strong>
<a id='L18746' name='L18746'></a> 18746                           x_dnd_action = dpyinfo-&gt;Xatom_XdndActionCopy;
<a id='L18747' name='L18747'></a> 18747                       <em class='brace'>}</em>
<a id='L18748' name='L18748'></a> 18748                     <strong class='reserved'>else</strong>
<a id='L18749' name='L18749'></a> 18749                       x_dnd_action = None;
<a id='L18750' name='L18750'></a> 18750 
<a id='L18751' name='L18751'></a> 18751                     x_dnd_waiting_for_finish
<a id='L18752' name='L18752'></a> 18752                       = <a href='../S/2289.html#L4673' title='Defined at 4673 in src/xterm.c.'>x_dnd_send_drop</a> (x_dnd_finish_frame,
<a id='L18753' name='L18753'></a> 18753                                          target,
<a id='L18754' name='L18754'></a> 18754                                          x_dnd_last_seen_toplevel,
<a id='L18755' name='L18755'></a> 18755                                          x_dnd_selection_timestamp,
<a id='L18756' name='L18756'></a> 18756                                          x_dnd_send_drop_proto);
<a id='L18757' name='L18757'></a> 18757                   <em class='brace'>}</em>
<a id='L18758' name='L18758'></a> 18758               <em class='brace'>}</em>
<a id='L18759' name='L18759'></a> 18759 
<a id='L18760' name='L18760'></a> 18760             <strong class='reserved'>goto</strong> done;
<a id='L18761' name='L18761'></a> 18761           <em class='brace'>}</em>
<a id='L18762' name='L18762'></a> 18762 
<a id='L18763' name='L18763'></a> 18763         <strong class='reserved'>if</strong> (event-&gt;xclient.message_type == dpyinfo-&gt;Xatom_XdndFinished
<a id='L18764' name='L18764'></a> 18764             &amp;&amp; (x_dnd_waiting_for_finish &amp;&amp; !x_dnd_waiting_for_motif_finish)
<a id='L18765' name='L18765'></a> 18765             <em class='comment'>/* Also check that the display is correct, since</em>
<a id='L18766' name='L18766'></a> 18766 <em class='comment'>               `x_dnd_pending_finish_target' could still be valid on</em>
<a id='L18767' name='L18767'></a> 18767 <em class='comment'>               another X server.  */</em>
<a id='L18768' name='L18768'></a> 18768             &amp;&amp; dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> == x_dnd_finish_display
<a id='L18769' name='L18769'></a> 18769             &amp;&amp; event-&gt;xclient.data.l[0] == x_dnd_pending_finish_target)
<a id='L18770' name='L18770'></a> 18770           <em class='brace'>{</em>
<a id='L18771' name='L18771'></a> 18771             x_dnd_waiting_for_finish = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L18772' name='L18772'></a> 18772 
<a id='L18773' name='L18773'></a> 18773             <strong class='reserved'>if</strong> (x_dnd_waiting_for_finish_proto &gt;= 5)
<a id='L18774' name='L18774'></a> 18774               x_dnd_action = event-&gt;xclient.data.l[2];
<a id='L18775' name='L18775'></a> 18775 
<a id='L18776' name='L18776'></a> 18776             <strong class='reserved'>if</strong> (x_dnd_waiting_for_finish_proto &gt;= 5
<a id='L18777' name='L18777'></a> 18777                 &amp;&amp; !(event-&gt;xclient.data.l[1] &amp; 1))
<a id='L18778' name='L18778'></a> 18778               x_dnd_action = None;
<a id='L18779' name='L18779'></a> 18779 
<a id='L18780' name='L18780'></a> 18780             <strong class='reserved'>goto</strong> done;
<a id='L18781' name='L18781'></a> 18781           <em class='brace'>}</em>
<a id='L18782' name='L18782'></a> 18782 
<a id='L18783' name='L18783'></a> 18783         <strong class='reserved'>if</strong> ((event-&gt;xclient.message_type
<a id='L18784' name='L18784'></a> 18784              == dpyinfo-&gt;Xatom_MOTIF_DRAG_AND_DROP_MESSAGE)
<a id='L18785' name='L18785'></a> 18785             &amp;&amp; x_dnd_waiting_for_finish
<a id='L18786' name='L18786'></a> 18786             &amp;&amp; x_dnd_waiting_for_motif_finish == 1
<a id='L18787' name='L18787'></a> 18787             &amp;&amp; dpyinfo == x_dnd_waiting_for_motif_finish_display)
<a id='L18788' name='L18788'></a> 18788           <em class='brace'>{</em>
<a id='L18789' name='L18789'></a> 18789             <a href='../D/20019.html' title='Multiple defined in 2 places.'>xm_drop_start_reply</a> reply;
<a id='L18790' name='L18790'></a> 18790             <a href='../D/18591.html' title='Multiple defined in 3 places.'>uint16_t</a> operation, status, action;
<a id='L18791' name='L18791'></a> 18791 
<a id='L18792' name='L18792'></a> 18792             <strong class='reserved'>if</strong> (!<a href='../S/2289.html#L2707' title='Defined at 2707 in src/xterm.c.'>xm_read_drop_start_reply</a> (event, &amp;reply))
<a id='L18793' name='L18793'></a> 18793               <em class='brace'>{</em>
<a id='L18794' name='L18794'></a> 18794                 operation = <a href='../S/2289.html#L1694' title='Defined at 1694 in src/xterm.c.'>XM_DRAG_SIDE_EFFECT_OPERATION</a> (reply.side_effects);
<a id='L18795' name='L18795'></a> 18795                 status = <a href='../S/2289.html#L1695' title='Defined at 1695 in src/xterm.c.'>XM_DRAG_SIDE_EFFECT_SITE_STATUS</a> (reply.side_effects);
<a id='L18796' name='L18796'></a> 18796                 action = <a href='../S/2289.html#L1697' title='Defined at 1697 in src/xterm.c.'>XM_DRAG_SIDE_EFFECT_DROP_ACTION</a> (reply.side_effects);
<a id='L18797' name='L18797'></a> 18797 
<a id='L18798' name='L18798'></a> 18798                 <strong class='reserved'>if</strong> (operation != <a href='../S/2289.html#L1702' title='Defined at 1702 in src/xterm.c.'>XM_DRAG_MOVE</a>
<a id='L18799' name='L18799'></a> 18799                     &amp;&amp; operation != <a href='../S/2289.html#L1703' title='Defined at 1703 in src/xterm.c.'>XM_DRAG_COPY</a>
<a id='L18800' name='L18800'></a> 18800                     &amp;&amp; <a href='../S/2289.html#L1708' title='Defined at 1708 in src/xterm.c.'>XM_DRAG_OPERATION_IS_LINK</a> (operation))
<a id='L18801' name='L18801'></a> 18801                   <em class='brace'>{</em>
<a id='L18802' name='L18802'></a> 18802                     x_dnd_waiting_for_finish = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L18803' name='L18803'></a> 18803                     <strong class='reserved'>goto</strong> done;
<a id='L18804' name='L18804'></a> 18804                   <em class='brace'>}</em>
<a id='L18805' name='L18805'></a> 18805 
<a id='L18806' name='L18806'></a> 18806                 <strong class='reserved'>if</strong> (status != <a href='../S/2289.html#L1756' title='Defined at 1756 in src/xterm.c.'>XM_DROP_SITE_VALID</a>
<a id='L18807' name='L18807'></a> 18807                     || (action == <a href='../S/2289.html#L1715' title='Defined at 1715 in src/xterm.c.'>XM_DROP_ACTION_DROP_CANCEL</a>
<a id='L18808' name='L18808'></a> 18808                         || action == <a href='../S/2289.html#L1714' title='Defined at 1714 in src/xterm.c.'>XM_DROP_ACTION_DROP_HELP</a>))
<a id='L18809' name='L18809'></a> 18809                   <em class='brace'>{</em>
<a id='L18810' name='L18810'></a> 18810                     x_dnd_waiting_for_finish = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L18811' name='L18811'></a> 18811                     <strong class='reserved'>goto</strong> done;
<a id='L18812' name='L18812'></a> 18812                   <em class='brace'>}</em>
<a id='L18813' name='L18813'></a> 18813 
<a id='L18814' name='L18814'></a> 18814                 <strong class='reserved'>switch</strong> (operation)
<a id='L18815' name='L18815'></a> 18815                   <em class='brace'>{</em>
<a id='L18816' name='L18816'></a> 18816                   <strong class='reserved'>case</strong> <a href='../S/2289.html#L1702' title='Defined at 1702 in src/xterm.c.'>XM_DRAG_MOVE</a>:
<a id='L18817' name='L18817'></a> 18817                     x_dnd_action_symbol = QXdndActionMove;
<a id='L18818' name='L18818'></a> 18818                     <strong class='reserved'>break</strong>;
<a id='L18819' name='L18819'></a> 18819 
<a id='L18820' name='L18820'></a> 18820                   <strong class='reserved'>case</strong> <a href='../S/2289.html#L1703' title='Defined at 1703 in src/xterm.c.'>XM_DRAG_COPY</a>:
<a id='L18821' name='L18821'></a> 18821                     x_dnd_action_symbol = QXdndActionCopy;
<a id='L18822' name='L18822'></a> 18822                     <strong class='reserved'>break</strong>;
<a id='L18823' name='L18823'></a> 18823 
<a id='L18824' name='L18824'></a> 18824                     <em class='comment'>/* This means XM_DRAG_OPERATION_IS_LINK (operation).  */</em>
<a id='L18825' name='L18825'></a> 18825                   <strong class='reserved'>default</strong>:
<a id='L18826' name='L18826'></a> 18826                     x_dnd_action_symbol = QXdndActionLink;
<a id='L18827' name='L18827'></a> 18827                     <strong class='reserved'>break</strong>;
<a id='L18828' name='L18828'></a> 18828                   <em class='brace'>}</em>
<a id='L18829' name='L18829'></a> 18829 
<a id='L18830' name='L18830'></a> 18830                 x_dnd_waiting_for_motif_finish = 2;
<a id='L18831' name='L18831'></a> 18831                 <strong class='reserved'>goto</strong> done;
<a id='L18832' name='L18832'></a> 18832               <em class='brace'>}</em>
<a id='L18833' name='L18833'></a> 18833           <em class='brace'>}</em>
<a id='L18834' name='L18834'></a> 18834 
<a id='L18835' name='L18835'></a> 18835         <strong class='reserved'>if</strong> (event-&gt;xclient.message_type == dpyinfo-&gt;Xatom_EMACS_TMP
<a id='L18836' name='L18836'></a> 18836             &amp;&amp; event-&gt;xclient.format == 8)
<a id='L18837' name='L18837'></a> 18837           <em class='brace'>{</em>
<a id='L18838' name='L18838'></a> 18838             <em class='comment'>/* This is actually an hourglass message.  Set whether or</em>
<a id='L18839' name='L18839'></a> 18839 <em class='comment'>               not events from here on have the hourglass enabled.  */</em>
<a id='L18840' name='L18840'></a> 18840 
<a id='L18841' name='L18841'></a> 18841             <strong class='reserved'>if</strong> (any)
<a id='L18842' name='L18842'></a> 18842               <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (any)-&gt;hourglass_p = event-&gt;xclient.data.<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>[0];
<a id='L18843' name='L18843'></a> 18843           <em class='brace'>}</em>
<a id='L18844' name='L18844'></a> 18844 
<a id='L18845' name='L18845'></a> 18845         <strong class='reserved'>if</strong> (event-&gt;xclient.message_type == dpyinfo-&gt;Xatom_wm_protocols
<a id='L18846' name='L18846'></a> 18846             &amp;&amp; event-&gt;xclient.format == 32)
<a id='L18847' name='L18847'></a> 18847           <em class='brace'>{</em>
<a id='L18848' name='L18848'></a> 18848             <strong class='reserved'>if</strong> (event-&gt;xclient.data.l[0] == dpyinfo-&gt;Xatom_wm_take_focus)
<a id='L18849' name='L18849'></a> 18849               <em class='brace'>{</em>
<a id='L18850' name='L18850'></a> 18850                 <em class='comment'>/* Use the value returned by x_any_window_to_frame</em>
<a id='L18851' name='L18851'></a> 18851 <em class='comment'>                   because this could be the shell widget window</em>
<a id='L18852' name='L18852'></a> 18852 <em class='comment'>                   if the frame has no title bar.  */</em>
<a id='L18853' name='L18853'></a> 18853                 <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = any;
<a id='L18854' name='L18854'></a> 18854 <em class='sharp'>#ifdef</em> HAVE_X_I18N
<a id='L18855' name='L18855'></a> 18855                 <em class='comment'>/* Not quite sure this is needed -pd */</em>
<a id='L18856' name='L18856'></a> 18856                 <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; <a href='../S/2212.html#L1470' title='Defined at 1470 in src/xterm.h.'>FRAME_XIC</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L18857' name='L18857'></a> 18857                   XSetICFocus (<a href='../S/2212.html#L1470' title='Defined at 1470 in src/xterm.h.'>FRAME_XIC</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L18858' name='L18858'></a> 18858 <em class='sharp'>#endif</em>
<a id='L18859' name='L18859'></a> 18859 <em class='sharp'>#if</em> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>
<a id='L18860' name='L18860'></a> 18860       <em class='comment'>/* Emacs sets WM hints whose `input' field is `true'.  This</em>
<a id='L18861' name='L18861'></a> 18861 <em class='comment'>         instructs the WM to set the input focus automatically for</em>
<a id='L18862' name='L18862'></a> 18862 <em class='comment'>         Emacs with a call to XSetInputFocus.  Setting WM_TAKE_FOCUS</em>
<a id='L18863' name='L18863'></a> 18863 <em class='comment'>         tells the WM to send us a ClientMessage WM_TAKE_FOCUS after</em>
<a id='L18864' name='L18864'></a> 18864 <em class='comment'>         it has set the focus.  So, XSetInputFocus below is not</em>
<a id='L18865' name='L18865'></a> 18865 <em class='comment'>         needed.</em>
<a id='L18866' name='L18866'></a> 18866 <em class='comment'></em>
<a id='L18867' name='L18867'></a> 18867 <em class='comment'>         The call to XSetInputFocus below has also caused trouble.  In</em>
<a id='L18868' name='L18868'></a> 18868 <em class='comment'>         cases where the XSetInputFocus done by the WM and the one</em>
<a id='L18869' name='L18869'></a> 18869 <em class='comment'>         below are temporally close (on a fast machine), the call</em>
<a id='L18870' name='L18870'></a> 18870 <em class='comment'>         below can generate additional FocusIn events which confuse</em>
<a id='L18871' name='L18871'></a> 18871 <em class='comment'>         Emacs.  */</em>
<a id='L18872' name='L18872'></a> 18872 
<a id='L18873' name='L18873'></a> 18873                 <em class='comment'>/* Since we set WM_TAKE_FOCUS, we must call</em>
<a id='L18874' name='L18874'></a> 18874 <em class='comment'>                   XSetInputFocus explicitly.  But not if f is null,</em>
<a id='L18875' name='L18875'></a> 18875 <em class='comment'>                   since that might be an event for a deleted frame.  */</em>
<a id='L18876' name='L18876'></a> 18876                 <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L18877' name='L18877'></a> 18877                   <em class='brace'>{</em>
<a id='L18878' name='L18878'></a> 18878                     <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *<a href='../D/10238.html' title='Multiple defined in 2 places.'>d</a> = event-&gt;xclient.<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>;
<a id='L18879' name='L18879'></a> 18879                     <em class='comment'>/* Catch and ignore errors, in case window has been</em>
<a id='L18880' name='L18880'></a> 18880 <em class='comment'>                       iconified by a window manager such as GWM.  */</em>
<a id='L18881' name='L18881'></a> 18881                     x_catch_errors (<a href='../D/10238.html' title='Multiple defined in 2 places.'>d</a>);
<a id='L18882' name='L18882'></a> 18882                     XSetInputFocus (<a href='../D/10238.html' title='Multiple defined in 2 places.'>d</a>, event-&gt;xclient.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>,
<a id='L18883' name='L18883'></a> 18883                                     <em class='comment'>/* The ICCCM says this is</em>
<a id='L18884' name='L18884'></a> 18884 <em class='comment'>                                       the only valid choice.  */</em>
<a id='L18885' name='L18885'></a> 18885                                     RevertToParent,
<a id='L18886' name='L18886'></a> 18886                                     event-&gt;xclient.data.l[1]);
<a id='L18887' name='L18887'></a> 18887                     x_uncatch_errors ();
<a id='L18888' name='L18888'></a> 18888                   <em class='brace'>}</em>
<a id='L18889' name='L18889'></a> 18889                 <em class='comment'>/* Not certain about handling scroll bars here */</em>
<a id='L18890' name='L18890'></a> 18890 <em class='sharp'>#endif</em>
<a id='L18891' name='L18891'></a> 18891                 <em class='comment'>/* Set the provided time as the user time, which is</em>
<a id='L18892' name='L18892'></a> 18892 <em class='comment'>                   required for SetInputFocus to work correctly after</em>
<a id='L18893' name='L18893'></a> 18893 <em class='comment'>                   taking the input focus.  */</em>
<a id='L18894' name='L18894'></a> 18894 
<a id='L18895' name='L18895'></a> 18895                 <em class='comment'>/* Time can be sign extended if retrieved from a client message.</em>
<a id='L18896' name='L18896'></a> 18896 <em class='comment'>                   Make sure it is always 32 bits, or systems with 64-bit longs</em>
<a id='L18897' name='L18897'></a> 18897 <em class='comment'>                   will crash after 24 days of X server uptime.  (bug#59480) */</em>
<a id='L18898' name='L18898'></a> 18898                 <a href='../S/2289.html#L7929' title='Defined at 7929 in src/xterm.c.'>x_display_set_last_user_time</a> (dpyinfo, (event-&gt;xclient.data.l[1]
<a id='L18899' name='L18899'></a> 18899                                                         &amp; 0xffffffff),
<a id='L18900' name='L18900'></a> 18900                                               <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L18901' name='L18901'></a> 18901                 <strong class='reserved'>goto</strong> done;
<a id='L18902' name='L18902'></a> 18902               <em class='brace'>}</em>
<a id='L18903' name='L18903'></a> 18903 
<a id='L18904' name='L18904'></a> 18904             <strong class='reserved'>if</strong> (event-&gt;xclient.data.l[0] == dpyinfo-&gt;Xatom_wm_save_yourself)
<a id='L18905' name='L18905'></a> 18905               <em class='brace'>{</em>
<a id='L18906' name='L18906'></a> 18906                 <em class='comment'>/* Save state modify the WM_COMMAND property to</em>
<a id='L18907' name='L18907'></a> 18907 <em class='comment'>                   something which can reinstate us.  This notifies</em>
<a id='L18908' name='L18908'></a> 18908 <em class='comment'>                   the session manager, who's looking for such a</em>
<a id='L18909' name='L18909'></a> 18909 <em class='comment'>                   PropertyNotify.  Can restart processing when</em>
<a id='L18910' name='L18910'></a> 18910 <em class='comment'>                   a keyboard or mouse event arrives.  */</em>
<a id='L18911' name='L18911'></a> 18911                 <em class='comment'>/* If we have a session manager, don't set this.</em>
<a id='L18912' name='L18912'></a> 18912 <em class='comment'>                   KDE will then start two Emacsen, one for the</em>
<a id='L18913' name='L18913'></a> 18913 <em class='comment'>                   session manager and one for this. */</em>
<a id='L18914' name='L18914'></a> 18914 <em class='sharp'>#ifdef</em> HAVE_X_SM
<a id='L18915' name='L18915'></a> 18915                 <strong class='reserved'>if</strong> (! <a href='../S/2294.html#L128' title='Defined at 128 in src/xsmfns.c.'>x_session_have_connection</a> ())
<a id='L18916' name='L18916'></a> 18916 <em class='sharp'>#endif</em>
<a id='L18917' name='L18917'></a> 18917                   <em class='brace'>{</em>
<a id='L18918' name='L18918'></a> 18918                     <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../D/19730.html' title='Multiple defined in 2 places.'>x_top_window_to_frame</a> (dpyinfo,
<a id='L18919' name='L18919'></a> 18919                                                event-&gt;xclient.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L18920' name='L18920'></a> 18920                     <em class='comment'>/* This is just so we only give real data once</em>
<a id='L18921' name='L18921'></a> 18921 <em class='comment'>                       for a single Emacs process.  */</em>
<a id='L18922' name='L18922'></a> 18922                     <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> == <a href='../S/2183.html#L1529' title='Defined at 1529 in src/frame.h.'>SELECTED_FRAME</a> ())
<a id='L18923' name='L18923'></a> 18923                       XSetCommand (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L18924' name='L18924'></a> 18924                                    event-&gt;xclient.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>,
<a id='L18925' name='L18925'></a> 18925                                    initial_argv, initial_argc);
<a id='L18926' name='L18926'></a> 18926                     <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L18927' name='L18927'></a> 18927                       XSetCommand (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L18928' name='L18928'></a> 18928                                    event-&gt;xclient.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>,
<a id='L18929' name='L18929'></a> 18929                                    0, 0);
<a id='L18930' name='L18930'></a> 18930                   <em class='brace'>}</em>
<a id='L18931' name='L18931'></a> 18931                 <strong class='reserved'>goto</strong> done;
<a id='L18932' name='L18932'></a> 18932               <em class='brace'>}</em>
<a id='L18933' name='L18933'></a> 18933 
<a id='L18934' name='L18934'></a> 18934             <strong class='reserved'>if</strong> (event-&gt;xclient.data.l[0] == dpyinfo-&gt;Xatom_wm_delete_window)
<a id='L18935' name='L18935'></a> 18935               <em class='brace'>{</em>
<a id='L18936' name='L18936'></a> 18936                 <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../D/19730.html' title='Multiple defined in 2 places.'>x_top_window_to_frame</a> (dpyinfo,
<a id='L18937' name='L18937'></a> 18937                                            event-&gt;xclient.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L18938' name='L18938'></a> 18938 
<a id='L18939' name='L18939'></a> 18939                 <strong class='reserved'>if</strong> (!<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L18940' name='L18940'></a> 18940                   <strong class='reserved'>goto</strong> OTHER; <em class='comment'>/* May be a dialog that is to be removed  */</em>
<a id='L18941' name='L18941'></a> 18941 
<a id='L18942' name='L18942'></a> 18942                 inev.ie.kind = <a href='../S/2231.html#L188' title='Defined at 188 in src/termhooks.h.'>DELETE_WINDOW_EVENT</a>;
<a id='L18943' name='L18943'></a> 18943                 inev.ie.timestamp = event-&gt;xclient.data.l[1];
<a id='L18944' name='L18944'></a> 18944                 <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (inev.ie.frame_or_window, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L18945' name='L18945'></a> 18945                 <strong class='reserved'>goto</strong> done;
<a id='L18946' name='L18946'></a> 18946               <em class='brace'>}</em>
<a id='L18947' name='L18947'></a> 18947 
<a id='L18948' name='L18948'></a> 18948 
<a id='L18949' name='L18949'></a> 18949             <strong class='reserved'>if</strong> (event-&gt;xclient.data.l[0] == dpyinfo-&gt;Xatom_net_wm_ping
<a id='L18950' name='L18950'></a> 18950                 <em class='comment'>/* Handling window stacking changes during</em>
<a id='L18951' name='L18951'></a> 18951 <em class='comment'>                   drag-and-drop requires Emacs to select for</em>
<a id='L18952' name='L18952'></a> 18952 <em class='comment'>                   SubstructureNotifyMask, which in turn causes the</em>
<a id='L18953' name='L18953'></a> 18953 <em class='comment'>                   message to be sent to Emacs itself using the event</em>
<a id='L18954' name='L18954'></a> 18954 <em class='comment'>                   mask specified by the EWMH.  To avoid an infinite</em>
<a id='L18955' name='L18955'></a> 18955 <em class='comment'>                   loop, make sure the client message's window is not</em>
<a id='L18956' name='L18956'></a> 18956 <em class='comment'>                   the root window if DND is in progress.  */</em>
<a id='L18957' name='L18957'></a> 18957                 &amp;&amp; (!(x_dnd_in_progress
<a id='L18958' name='L18958'></a> 18958                       || x_dnd_waiting_for_finish)
<a id='L18959' name='L18959'></a> 18959                     || event-&gt;xclient.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> != dpyinfo-&gt;root_window)
<a id='L18960' name='L18960'></a> 18960                 &amp;&amp; event-&gt;xclient.format == 32)
<a id='L18961' name='L18961'></a> 18961               <em class='brace'>{</em>
<a id='L18962' name='L18962'></a> 18962                 XEvent send_event = *event;
<a id='L18963' name='L18963'></a> 18963 
<a id='L18964' name='L18964'></a> 18964                 send_event.xclient.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = dpyinfo-&gt;root_window;
<a id='L18965' name='L18965'></a> 18965                 XSendEvent (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, dpyinfo-&gt;root_window, False,
<a id='L18966' name='L18966'></a> 18966                             SubstructureRedirectMask | SubstructureNotifyMask,
<a id='L18967' name='L18967'></a> 18967                             &amp;send_event);
<a id='L18968' name='L18968'></a> 18968 
<a id='L18969' name='L18969'></a> 18969                 *finish = <a href='../S/2289.html#L1136' title='Defined at 1136 in src/xterm.c.'>X_EVENT_DROP</a>;
<a id='L18970' name='L18970'></a> 18970                 <strong class='reserved'>goto</strong> done;
<a id='L18971' name='L18971'></a> 18971               <em class='brace'>}</em>
<a id='L18972' name='L18972'></a> 18972 
<a id='L18973' name='L18973'></a> 18973 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XSYNC
<a id='L18974' name='L18974'></a> 18974             <strong class='reserved'>if</strong> (event-&gt;xclient.data.l[0] == dpyinfo-&gt;Xatom_net_wm_sync_request
<a id='L18975' name='L18975'></a> 18975                 &amp;&amp; event-&gt;xclient.format == 32
<a id='L18976' name='L18976'></a> 18976                 &amp;&amp; dpyinfo-&gt;xsync_supported_p)
<a id='L18977' name='L18977'></a> 18977               <em class='brace'>{</em>
<a id='L18978' name='L18978'></a> 18978                 <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>
<a id='L18979' name='L18979'></a> 18979                   = <a href='../D/19730.html' title='Multiple defined in 2 places.'>x_top_window_to_frame</a> (dpyinfo,
<a id='L18980' name='L18980'></a> 18980                                            event-&gt;xclient.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L18981' name='L18981'></a> 18981 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_GTK3
<a id='L18982' name='L18982'></a> 18982                 GtkWidget *widget;
<a id='L18983' name='L18983'></a> 18983                 GdkWindow *<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>;
<a id='L18984' name='L18984'></a> 18984                 GdkFrameClock *frame_clock;
<a id='L18985' name='L18985'></a> 18985 <em class='sharp'>#endif</em>
<a id='L18986' name='L18986'></a> 18986 
<a id='L18987' name='L18987'></a> 18987                 <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L18988' name='L18988'></a> 18988                   <em class='brace'>{</em>
<a id='L18989' name='L18989'></a> 18989 <em class='sharp'>#ifndef</em> HAVE_GTK3
<a id='L18990' name='L18990'></a> 18990                     <strong class='reserved'>if</strong> (event-&gt;xclient.data.l[4] == 0)
<a id='L18991' name='L18991'></a> 18991                       <em class='brace'>{</em>
<a id='L18992' name='L18992'></a> 18992                         XSyncIntsToValue (&amp;<a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;pending_basic_counter_value,
<a id='L18993' name='L18993'></a> 18993                                           event-&gt;xclient.data.l[2], event-&gt;xclient.data.l[3]);
<a id='L18994' name='L18994'></a> 18994                         <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;sync_end_pending_p = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L18995' name='L18995'></a> 18995                       <em class='brace'>}</em>
<a id='L18996' name='L18996'></a> 18996                     <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (event-&gt;xclient.data.l[4] == 1)
<a id='L18997' name='L18997'></a> 18997                       <em class='brace'>{</em>
<a id='L18998' name='L18998'></a> 18998                         XSyncIntsToValue (&amp;<a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;resize_counter_value,
<a id='L18999' name='L18999'></a> 18999                                           event-&gt;xclient.data.l[2],
<a id='L19000' name='L19000'></a> 19000                                           event-&gt;xclient.data.l[3]);
<a id='L19001' name='L19001'></a> 19001 
<a id='L19002' name='L19002'></a> 19002                         <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;ext_sync_end_pending_p = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L19003' name='L19003'></a> 19003                       <em class='brace'>}</em>
<a id='L19004' name='L19004'></a> 19004 
<a id='L19005' name='L19005'></a> 19005                     *finish = <a href='../S/2289.html#L1136' title='Defined at 1136 in src/xterm.c.'>X_EVENT_DROP</a>;
<a id='L19006' name='L19006'></a> 19006 <em class='sharp'>#else</em>
<a id='L19007' name='L19007'></a> 19007                     widget = <a href='../D/2309.html' title='Multiple defined in 2 places.'>FRAME_GTK_OUTER_WIDGET</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L19008' name='L19008'></a> 19008                     <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = gtk_widget_get_window (widget);
<a id='L19009' name='L19009'></a> 19009                     <a href='../D/10871.html' title='Multiple defined in 5 places.'>eassert</a> (<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L19010' name='L19010'></a> 19010 
<a id='L19011' name='L19011'></a> 19011                     <em class='comment'>/* This could be a (former) child frame for which</em>
<a id='L19012' name='L19012'></a> 19012 <em class='comment'>                       frame synchronization was disabled.  Enable it</em>
<a id='L19013' name='L19013'></a> 19013 <em class='comment'>                       now.  */</em>
<a id='L19014' name='L19014'></a> 19014                     gdk_x11_window_set_frame_sync_enabled (<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, <a href='../D/6377.html' title='Multiple defined in 3 places.'>TRUE</a>);
<a id='L19015' name='L19015'></a> 19015 
<a id='L19016' name='L19016'></a> 19016                     <strong class='reserved'>if</strong> (widget &amp;&amp; !<a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;xg_sync_end_pending_p)
<a id='L19017' name='L19017'></a> 19017                       <em class='brace'>{</em>
<a id='L19018' name='L19018'></a> 19018                         frame_clock = gdk_window_get_frame_clock (<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L19019' name='L19019'></a> 19019                         <a href='../D/10871.html' title='Multiple defined in 5 places.'>eassert</a> (frame_clock);
<a id='L19020' name='L19020'></a> 19020 
<a id='L19021' name='L19021'></a> 19021                         gdk_frame_clock_request_phase (frame_clock,
<a id='L19022' name='L19022'></a> 19022                                                        GDK_FRAME_CLOCK_PHASE_BEFORE_PAINT);
<a id='L19023' name='L19023'></a> 19023                         <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;xg_sync_end_pending_p = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L19024' name='L19024'></a> 19024                       <em class='brace'>}</em>
<a id='L19025' name='L19025'></a> 19025 <em class='sharp'>#endif</em>
<a id='L19026' name='L19026'></a> 19026                     <strong class='reserved'>goto</strong> done;
<a id='L19027' name='L19027'></a> 19027                   <em class='brace'>}</em>
<a id='L19028' name='L19028'></a> 19028               <em class='brace'>}</em>
<a id='L19029' name='L19029'></a> 19029 <em class='sharp'>#endif</em>
<a id='L19030' name='L19030'></a> 19030 
<a id='L19031' name='L19031'></a> 19031             <strong class='reserved'>goto</strong> done;
<a id='L19032' name='L19032'></a> 19032           <em class='brace'>}</em>
<a id='L19033' name='L19033'></a> 19033 
<a id='L19034' name='L19034'></a> 19034         <strong class='reserved'>if</strong> (event-&gt;xclient.message_type == dpyinfo-&gt;Xatom_wm_configure_denied)
<a id='L19035' name='L19035'></a> 19035           <strong class='reserved'>goto</strong> done;
<a id='L19036' name='L19036'></a> 19036 
<a id='L19037' name='L19037'></a> 19037         <strong class='reserved'>if</strong> (event-&gt;xclient.message_type == dpyinfo-&gt;Xatom_wm_window_moved)
<a id='L19038' name='L19038'></a> 19038           <em class='brace'>{</em>
<a id='L19039' name='L19039'></a> 19039             <strong class='reserved'>int</strong> new_x, new_y;
<a id='L19040' name='L19040'></a> 19040             <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2289.html#L11957' title='Defined at 11957 in src/xterm.c.'>x_window_to_frame</a> (dpyinfo, event-&gt;xclient.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L19041' name='L19041'></a> 19041 
<a id='L19042' name='L19042'></a> 19042             new_x = event-&gt;xclient.data.s[0];
<a id='L19043' name='L19043'></a> 19043             new_y = event-&gt;xclient.data.s[1];
<a id='L19044' name='L19044'></a> 19044 
<a id='L19045' name='L19045'></a> 19045             <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L19046' name='L19046'></a> 19046               <em class='brace'>{</em>
<a id='L19047' name='L19047'></a> 19047                 <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;left_pos = new_x;
<a id='L19048' name='L19048'></a> 19048                 <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;top_pos = new_y;
<a id='L19049' name='L19049'></a> 19049               <em class='brace'>}</em>
<a id='L19050' name='L19050'></a> 19050             <strong class='reserved'>goto</strong> done;
<a id='L19051' name='L19051'></a> 19051           <em class='brace'>}</em>
<a id='L19052' name='L19052'></a> 19052 
<a id='L19053' name='L19053'></a> 19053 <em class='sharp'>#ifdef</em> X_TOOLKIT_EDITRES
<a id='L19054' name='L19054'></a> 19054         <strong class='reserved'>if</strong> (event-&gt;xclient.message_type == dpyinfo-&gt;Xatom_editres)
<a id='L19055' name='L19055'></a> 19055           <em class='brace'>{</em>
<a id='L19056' name='L19056'></a> 19056             <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = any;
<a id='L19057' name='L19057'></a> 19057             <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L19058' name='L19058'></a> 19058               <em class='brace'>{</em>
<a id='L19059' name='L19059'></a> 19059                 _XEditResCheckMessages (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;widget,
<a id='L19060' name='L19060'></a> 19060                                         <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, (XEvent *) event, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L19061' name='L19061'></a> 19061                 <strong class='reserved'>goto</strong> done;
<a id='L19062' name='L19062'></a> 19062               <em class='brace'>}</em>
<a id='L19063' name='L19063'></a> 19063 
<a id='L19064' name='L19064'></a> 19064             <strong class='reserved'>goto</strong> OTHER;
<a id='L19065' name='L19065'></a> 19065           <em class='brace'>}</em>
<a id='L19066' name='L19066'></a> 19066 <em class='sharp'>#endif</em> <em class='comment'>/* X_TOOLKIT_EDITRES */</em>
<a id='L19067' name='L19067'></a> 19067 
<a id='L19068' name='L19068'></a> 19068         <strong class='reserved'>if</strong> (event-&gt;xclient.message_type == dpyinfo-&gt;Xatom_DONE
<a id='L19069' name='L19069'></a> 19069             || event-&gt;xclient.message_type == dpyinfo-&gt;Xatom_PAGE)
<a id='L19070' name='L19070'></a> 19070           <em class='brace'>{</em>
<a id='L19071' name='L19071'></a> 19071             <em class='comment'>/* Ghostview job completed.  Kill it.  We could</em>
<a id='L19072' name='L19072'></a> 19072 <em class='comment'>               reply with "Next" if we received "Page", but we</em>
<a id='L19073' name='L19073'></a> 19073 <em class='comment'>               currently never do because we are interested in</em>
<a id='L19074' name='L19074'></a> 19074 <em class='comment'>               images, only, which should have 1 page.  */</em>
<a id='L19075' name='L19075'></a> 19075             <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2289.html#L11957' title='Defined at 11957 in src/xterm.c.'>x_window_to_frame</a> (dpyinfo, event-&gt;xclient.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L19076' name='L19076'></a> 19076             <strong class='reserved'>if</strong> (!<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L19077' name='L19077'></a> 19077               <strong class='reserved'>goto</strong> OTHER;
<a id='L19078' name='L19078'></a> 19078 <em class='sharp'>#ifndef</em> USE_CAIRO
<a id='L19079' name='L19079'></a> 19079             <a href='../D/5058.html' title='Multiple defined in 2 places.'>Pixmap</a> pixmap = (<a href='../D/5058.html' title='Multiple defined in 2 places.'>Pixmap</a>) event-&gt;xclient.data.l[1];
<a id='L19080' name='L19080'></a> 19080             <em class='comment'>/* FIXME: why does this sometimes generate a BadMatch</em>
<a id='L19081' name='L19081'></a> 19081 <em class='comment'>               error?  */</em>
<a id='L19082' name='L19082'></a> 19082             x_catch_errors (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L19083' name='L19083'></a> 19083             <a href='../S/2204.html#L12345' title='Defined at 12345 in src/image.c.'>x_kill_gs_process</a> (pixmap, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L19084' name='L19084'></a> 19084             x_uncatch_errors ();
<a id='L19085' name='L19085'></a> 19085             <a href='../S/2224.html#L36467' title='Defined at 36467 in src/xdisp.c.'>expose_frame</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 0, 0, 0, 0);
<a id='L19086' name='L19086'></a> 19086 <em class='sharp'>#endif</em>  <em class='comment'>/* !USE_CAIRO */</em>
<a id='L19087' name='L19087'></a> 19087             <strong class='reserved'>goto</strong> done;
<a id='L19088' name='L19088'></a> 19088           <em class='brace'>}</em>
<a id='L19089' name='L19089'></a> 19089 
<a id='L19090' name='L19090'></a> 19090 <em class='sharp'>#ifdef</em> USE_TOOLKIT_SCROLL_BARS
<a id='L19091' name='L19091'></a> 19091         <em class='comment'>/* Scroll bar callbacks send a ClientMessage from which</em>
<a id='L19092' name='L19092'></a> 19092 <em class='comment'>           we construct an input_event.  */</em>
<a id='L19093' name='L19093'></a> 19093         <strong class='reserved'>if</strong> (event-&gt;xclient.message_type == dpyinfo-&gt;Xatom_Scrollbar)
<a id='L19094' name='L19094'></a> 19094           <em class='brace'>{</em>
<a id='L19095' name='L19095'></a> 19095             <em class='comment'>/* Convert the scroll bar event to an input event using</em>
<a id='L19096' name='L19096'></a> 19096 <em class='comment'>               the first window entered into the scroll bar event</em>
<a id='L19097' name='L19097'></a> 19097 <em class='comment'>               queue. */</em>
<a id='L19098' name='L19098'></a> 19098             x_scroll_bar_to_input_event (dpyinfo, event, &amp;inev.ie);
<a id='L19099' name='L19099'></a> 19099 
<a id='L19100' name='L19100'></a> 19100             *finish = <a href='../S/2289.html#L1135' title='Defined at 1135 in src/xterm.c.'>X_EVENT_GOTO_OUT</a>;
<a id='L19101' name='L19101'></a> 19101             <strong class='reserved'>goto</strong> done;
<a id='L19102' name='L19102'></a> 19102           <em class='brace'>}</em>
<a id='L19103' name='L19103'></a> 19103         <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (event-&gt;xclient.message_type == dpyinfo-&gt;Xatom_Horizontal_Scrollbar)
<a id='L19104' name='L19104'></a> 19104           <em class='brace'>{</em>
<a id='L19105' name='L19105'></a> 19105             <em class='comment'>/* Convert the horizontal scroll bar event to an input</em>
<a id='L19106' name='L19106'></a> 19106 <em class='comment'>               event using the first window entered into the scroll</em>
<a id='L19107' name='L19107'></a> 19107 <em class='comment'>               bar event queue. */</em>
<a id='L19108' name='L19108'></a> 19108             x_horizontal_scroll_bar_to_input_event (dpyinfo, event,
<a id='L19109' name='L19109'></a> 19109                                                     &amp;inev.ie);
<a id='L19110' name='L19110'></a> 19110 
<a id='L19111' name='L19111'></a> 19111             *finish = <a href='../S/2289.html#L1135' title='Defined at 1135 in src/xterm.c.'>X_EVENT_GOTO_OUT</a>;
<a id='L19112' name='L19112'></a> 19112             <strong class='reserved'>goto</strong> done;
<a id='L19113' name='L19113'></a> 19113           <em class='brace'>}</em>
<a id='L19114' name='L19114'></a> 19114 <em class='sharp'>#endif</em> <em class='comment'>/* USE_TOOLKIT_SCROLL_BARS */</em>
<a id='L19115' name='L19115'></a> 19115 
<a id='L19116' name='L19116'></a> 19116         <em class='comment'>/* XEmbed messages from the embedder (if any).  */</em>
<a id='L19117' name='L19117'></a> 19117         <strong class='reserved'>if</strong> (event-&gt;xclient.message_type == dpyinfo-&gt;Xatom_XEMBED)
<a id='L19118' name='L19118'></a> 19118           <em class='brace'>{</em>
<a id='L19119' name='L19119'></a> 19119             <strong class='reserved'>enum</strong> <a href='../S/2289.html#L1144' title='Defined at 1144 in src/xterm.c.'>xembed_message</a> msg = event-&gt;xclient.data.l[1];
<a id='L19120' name='L19120'></a> 19120             <strong class='reserved'>if</strong> (msg == <a href='../S/2289.html#L1150' title='Defined at 1150 in src/xterm.c.'>XEMBED_FOCUS_IN</a> || msg == <a href='../S/2289.html#L1151' title='Defined at 1151 in src/xterm.c.'>XEMBED_FOCUS_OUT</a>)
<a id='L19121' name='L19121'></a> 19121               x_detect_focus_change (dpyinfo, any, event, &amp;inev.ie);
<a id='L19122' name='L19122'></a> 19122 
<a id='L19123' name='L19123'></a> 19123             *finish = <a href='../S/2289.html#L1135' title='Defined at 1135 in src/xterm.c.'>X_EVENT_GOTO_OUT</a>;
<a id='L19124' name='L19124'></a> 19124             <strong class='reserved'>goto</strong> done;
<a id='L19125' name='L19125'></a> 19125           <em class='brace'>}</em>
<a id='L19126' name='L19126'></a> 19126 
<a id='L19127' name='L19127'></a> 19127 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XSYNC &amp;&amp; !<strong class='reserved'>defined</strong> USE_GTK &amp;&amp; <strong class='reserved'>defined</strong> HAVE_CLOCK_GETTIME
<a id='L19128' name='L19128'></a> 19128         <em class='comment'>/* These messages are sent by the compositing manager after a</em>
<a id='L19129' name='L19129'></a> 19129 <em class='comment'>           frame is drawn under extended synchronization.  */</em>
<a id='L19130' name='L19130'></a> 19130         <strong class='reserved'>if</strong> (event-&gt;xclient.message_type
<a id='L19131' name='L19131'></a> 19131             == dpyinfo-&gt;Xatom_net_wm_frame_drawn)
<a id='L19132' name='L19132'></a> 19132           <em class='brace'>{</em>
<a id='L19133' name='L19133'></a> 19133             <strong class='reserved'>if</strong> (any)
<a id='L19134' name='L19134'></a> 19134               <a href='../S/2289.html#L7260' title='Defined at 7260 in src/xterm.c.'>x_sync_handle_frame_drawn</a> (dpyinfo, (XEvent *) event, any);
<a id='L19135' name='L19135'></a> 19135 
<a id='L19136' name='L19136'></a> 19136             <strong class='reserved'>goto</strong> done;
<a id='L19137' name='L19137'></a> 19137           <em class='brace'>}</em>
<a id='L19138' name='L19138'></a> 19138 
<a id='L19139' name='L19139'></a> 19139         <strong class='reserved'>if</strong> (event-&gt;xclient.message_type
<a id='L19140' name='L19140'></a> 19140             == dpyinfo-&gt;Xatom_net_wm_frame_timings)
<a id='L19141' name='L19141'></a> 19141           <strong class='reserved'>goto</strong> done;
<a id='L19142' name='L19142'></a> 19142 <em class='sharp'>#endif</em>
<a id='L19143' name='L19143'></a> 19143 
<a id='L19144' name='L19144'></a> 19144         <strong class='reserved'>if</strong> (<a href='../S/2158.html#L1000' title='Defined at 1000 in src/xsettings.c.'>xft_settings_event</a> (dpyinfo, event))
<a id='L19145' name='L19145'></a> 19145           <strong class='reserved'>goto</strong> done;
<a id='L19146' name='L19146'></a> 19146 
<a id='L19147' name='L19147'></a> 19147         <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = any;
<a id='L19148' name='L19148'></a> 19148         <em class='comment'>/* We don't want to ever leak tooltip frames to Lisp code.  */</em>
<a id='L19149' name='L19149'></a> 19149         <strong class='reserved'>if</strong> (!<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> || <a href='../D/2425.html' title='Multiple defined in 2 places.'>FRAME_TOOLTIP_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L19150' name='L19150'></a> 19150           <strong class='reserved'>goto</strong> OTHER;
<a id='L19151' name='L19151'></a> 19151 
<a id='L19152' name='L19152'></a> 19152         <em class='comment'>/* These values are always used initialized, but GCC doesn't</em>
<a id='L19153' name='L19153'></a> 19153 <em class='comment'>           know that.  */</em>
<a id='L19154' name='L19154'></a> 19154         dx = 0;
<a id='L19155' name='L19155'></a> 19155         dy = 0;
<a id='L19156' name='L19156'></a> 19156 
<a id='L19157' name='L19157'></a> 19157         rc = x_coords_from_dnd_message (dpyinfo, (XEvent *) event,
<a id='L19158' name='L19158'></a> 19158                                         &amp;dx, &amp;dy);
<a id='L19159' name='L19159'></a> 19159 
<a id='L19160' name='L19160'></a> 19160         <strong class='reserved'>if</strong> (<a href='../S/2281.html#L3136' title='Defined at 3136 in src/xselect.c.'>x_handle_dnd_message</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, &amp;event-&gt;xclient, dpyinfo, &amp;inev.ie,
<a id='L19161' name='L19161'></a> 19161                                   rc, dx, dy))
<a id='L19162' name='L19162'></a> 19162           *finish = <a href='../S/2289.html#L1136' title='Defined at 1136 in src/xterm.c.'>X_EVENT_DROP</a>;
<a id='L19163' name='L19163'></a> 19163       <em class='brace'>}</em>
<a id='L19164' name='L19164'></a> 19164       <strong class='reserved'>break</strong>;
<a id='L19165' name='L19165'></a> 19165 
<a id='L19166' name='L19166'></a> 19166     <strong class='reserved'>case</strong> SelectionNotify:
<a id='L19167' name='L19167'></a> 19167 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> USE_X_TOOLKIT || <strong class='reserved'>defined</strong> USE_GTK
<a id='L19168' name='L19168'></a> 19168       <strong class='reserved'>if</strong> (!<a href='../S/2289.html#L11957' title='Defined at 11957 in src/xterm.c.'>x_window_to_frame</a> (dpyinfo, event-&gt;xselection.requestor))
<a id='L19169' name='L19169'></a> 19169         <strong class='reserved'>goto</strong> OTHER;
<a id='L19170' name='L19170'></a> 19170 <em class='sharp'>#endif</em> <em class='comment'>/* not USE_X_TOOLKIT and not USE_GTK */</em>
<a id='L19171' name='L19171'></a> 19171 <em class='sharp'>#ifdef</em> HAVE_GTK3
<a id='L19172' name='L19172'></a> 19172       <em class='comment'>/* GTK 3 apparently chokes on these events since they have no</em>
<a id='L19173' name='L19173'></a> 19173 <em class='comment'>         associated device.  (bug#56869, another bug as well that I</em>
<a id='L19174' name='L19174'></a> 19174 <em class='comment'>         can't find) */</em>
<a id='L19175' name='L19175'></a> 19175       *finish = <a href='../S/2289.html#L1136' title='Defined at 1136 in src/xterm.c.'>X_EVENT_DROP</a>;
<a id='L19176' name='L19176'></a> 19176 <em class='sharp'>#endif</em>
<a id='L19177' name='L19177'></a> 19177       <a href='../S/2281.html#L2487' title='Defined at 2487 in src/xselect.c.'>x_handle_selection_notify</a> (&amp;event-&gt;xselection);
<a id='L19178' name='L19178'></a> 19178       <strong class='reserved'>break</strong>;
<a id='L19179' name='L19179'></a> 19179 
<a id='L19180' name='L19180'></a> 19180     <strong class='reserved'>case</strong> SelectionClear:        <em class='comment'>/* Someone has grabbed ownership.  */</em>
<a id='L19181' name='L19181'></a> 19181 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> USE_X_TOOLKIT || <strong class='reserved'>defined</strong> USE_GTK
<a id='L19182' name='L19182'></a> 19182       <strong class='reserved'>if</strong> (!<a href='../S/2289.html#L11957' title='Defined at 11957 in src/xterm.c.'>x_window_to_frame</a> (dpyinfo, event-&gt;xselectionclear.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>))
<a id='L19183' name='L19183'></a> 19183         <strong class='reserved'>goto</strong> OTHER;
<a id='L19184' name='L19184'></a> 19184 <em class='sharp'>#endif</em> <em class='comment'>/* not USE_X_TOOLKIT and not USE_GTK */</em>
<a id='L19185' name='L19185'></a> 19185 <em class='sharp'>#ifdef</em> HAVE_GTK3
<a id='L19186' name='L19186'></a> 19186       *finish = <a href='../S/2289.html#L1136' title='Defined at 1136 in src/xterm.c.'>X_EVENT_DROP</a>;
<a id='L19187' name='L19187'></a> 19187 <em class='sharp'>#endif</em>
<a id='L19188' name='L19188'></a> 19188       <em class='brace'>{</em>
<a id='L19189' name='L19189'></a> 19189         <strong class='reserved'>const</strong> XSelectionClearEvent *eventp = &amp;event-&gt;xselectionclear;
<a id='L19190' name='L19190'></a> 19190 
<a id='L19191' name='L19191'></a> 19191         <strong class='reserved'>if</strong> (eventp-&gt;<a href='../S/2073.html#L63' title='Defined at 63 in lwlib/lwlib-Xm.c.'>selection</a> == dpyinfo-&gt;motif_drag_atom
<a id='L19192' name='L19192'></a> 19192             &amp;&amp; (eventp-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> == CurrentTime
<a id='L19193' name='L19193'></a> 19193                 || dpyinfo-&gt;motif_drag_atom_time &lt;= eventp-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>))
<a id='L19194' name='L19194'></a> 19194           dpyinfo-&gt;motif_drag_atom = None;
<a id='L19195' name='L19195'></a> 19195 
<a id='L19196' name='L19196'></a> 19196         inev.sie.kind = <a href='../S/2231.html#L187' title='Defined at 187 in src/termhooks.h.'>SELECTION_CLEAR_EVENT</a>;
<a id='L19197' name='L19197'></a> 19197         <a href='../D/5566.html' title='Multiple defined in 2 places.'>SELECTION_EVENT_DPYINFO</a> (&amp;inev.sie) = dpyinfo;
<a id='L19198' name='L19198'></a> 19198         <a href='../D/5569.html' title='Multiple defined in 2 places.'>SELECTION_EVENT_SELECTION</a> (&amp;inev.sie) = eventp-&gt;<a href='../S/2073.html#L63' title='Defined at 63 in lwlib/lwlib-Xm.c.'>selection</a>;
<a id='L19199' name='L19199'></a> 19199         <a href='../D/5571.html' title='Multiple defined in 2 places.'>SELECTION_EVENT_TIME</a> (&amp;inev.sie) = eventp-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L19200' name='L19200'></a> 19200 
<a id='L19201' name='L19201'></a> 19201         <strong class='reserved'>if</strong> (x_use_pending_selection_requests)
<a id='L19202' name='L19202'></a> 19202           <em class='brace'>{</em>
<a id='L19203' name='L19203'></a> 19203             <a href='../S/2289.html#L12298' title='Defined at 12298 in src/xterm.c.'>x_push_selection_request</a> (&amp;inev.sie);
<a id='L19204' name='L19204'></a> 19204             <a href='../S/2231.html#L393' title='Defined at 393 in src/termhooks.h.'>EVENT_INIT</a> (inev.ie);
<a id='L19205' name='L19205'></a> 19205           <em class='brace'>}</em>
<a id='L19206' name='L19206'></a> 19206       <em class='brace'>}</em>
<a id='L19207' name='L19207'></a> 19207       <strong class='reserved'>break</strong>;
<a id='L19208' name='L19208'></a> 19208 
<a id='L19209' name='L19209'></a> 19209     <strong class='reserved'>case</strong> SelectionRequest:      <em class='comment'>/* Someone wants our selection.  */</em>
<a id='L19210' name='L19210'></a> 19210 <em class='sharp'>#ifdef</em> USE_X_TOOLKIT
<a id='L19211' name='L19211'></a> 19211       <strong class='reserved'>if</strong> (!<a href='../S/2289.html#L11957' title='Defined at 11957 in src/xterm.c.'>x_window_to_frame</a> (dpyinfo, event-&gt;xselectionrequest.owner))
<a id='L19212' name='L19212'></a> 19212         <strong class='reserved'>goto</strong> OTHER;
<a id='L19213' name='L19213'></a> 19213 <em class='sharp'>#endif</em> <em class='comment'>/* USE_X_TOOLKIT */</em>
<a id='L19214' name='L19214'></a> 19214 <em class='sharp'>#ifdef</em> HAVE_GTK3
<a id='L19215' name='L19215'></a> 19215       *finish = <a href='../S/2289.html#L1136' title='Defined at 1136 in src/xterm.c.'>X_EVENT_DROP</a>;
<a id='L19216' name='L19216'></a> 19216 <em class='sharp'>#endif</em>
<a id='L19217' name='L19217'></a> 19217       <em class='brace'>{</em>
<a id='L19218' name='L19218'></a> 19218         <strong class='reserved'>const</strong> XSelectionRequestEvent *eventp = &amp;event-&gt;xselectionrequest;
<a id='L19219' name='L19219'></a> 19219 
<a id='L19220' name='L19220'></a> 19220         inev.sie.kind = <a href='../S/2231.html#L185' title='Defined at 185 in src/termhooks.h.'>SELECTION_REQUEST_EVENT</a>;
<a id='L19221' name='L19221'></a> 19221         <a href='../D/5566.html' title='Multiple defined in 2 places.'>SELECTION_EVENT_DPYINFO</a> (&amp;inev.sie) = dpyinfo;
<a id='L19222' name='L19222'></a> 19222         <a href='../D/5568.html' title='Multiple defined in 2 places.'>SELECTION_EVENT_REQUESTOR</a> (&amp;inev.sie) = eventp-&gt;requestor;
<a id='L19223' name='L19223'></a> 19223         <a href='../D/5569.html' title='Multiple defined in 2 places.'>SELECTION_EVENT_SELECTION</a> (&amp;inev.sie) = eventp-&gt;<a href='../S/2073.html#L63' title='Defined at 63 in lwlib/lwlib-Xm.c.'>selection</a>;
<a id='L19224' name='L19224'></a> 19224         <a href='../D/5570.html' title='Multiple defined in 2 places.'>SELECTION_EVENT_TARGET</a> (&amp;inev.sie) = eventp-&gt;target;
<a id='L19225' name='L19225'></a> 19225         <a href='../D/5567.html' title='Multiple defined in 2 places.'>SELECTION_EVENT_PROPERTY</a> (&amp;inev.sie) = eventp-&gt;property;
<a id='L19226' name='L19226'></a> 19226         <a href='../D/5571.html' title='Multiple defined in 2 places.'>SELECTION_EVENT_TIME</a> (&amp;inev.sie) = eventp-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L19227' name='L19227'></a> 19227 
<a id='L19228' name='L19228'></a> 19228         <em class='comment'>/* If drag-and-drop or another modal dialog/menu is in</em>
<a id='L19229' name='L19229'></a> 19229 <em class='comment'>           progress, handle SelectionRequest events immediately, by</em>
<a id='L19230' name='L19230'></a> 19230 <em class='comment'>           pushing it onto the selection queue.  */</em>
<a id='L19231' name='L19231'></a> 19231 
<a id='L19232' name='L19232'></a> 19232         <strong class='reserved'>if</strong> (x_use_pending_selection_requests)
<a id='L19233' name='L19233'></a> 19233           <em class='brace'>{</em>
<a id='L19234' name='L19234'></a> 19234             <a href='../S/2289.html#L12298' title='Defined at 12298 in src/xterm.c.'>x_push_selection_request</a> (&amp;inev.sie);
<a id='L19235' name='L19235'></a> 19235             <a href='../S/2231.html#L393' title='Defined at 393 in src/termhooks.h.'>EVENT_INIT</a> (inev.ie);
<a id='L19236' name='L19236'></a> 19236           <em class='brace'>}</em>
<a id='L19237' name='L19237'></a> 19237 
<a id='L19238' name='L19238'></a> 19238         <strong class='reserved'>if</strong> (x_dnd_waiting_for_finish
<a id='L19239' name='L19239'></a> 19239             &amp;&amp; x_dnd_waiting_for_motif_finish == 2
<a id='L19240' name='L19240'></a> 19240             &amp;&amp; dpyinfo == x_dnd_waiting_for_motif_finish_display
<a id='L19241' name='L19241'></a> 19241             &amp;&amp; eventp-&gt;<a href='../S/2073.html#L63' title='Defined at 63 in lwlib/lwlib-Xm.c.'>selection</a> == x_dnd_motif_atom
<a id='L19242' name='L19242'></a> 19242             &amp;&amp; (eventp-&gt;target == dpyinfo-&gt;Xatom_XmTRANSFER_SUCCESS
<a id='L19243' name='L19243'></a> 19243                 || eventp-&gt;target == dpyinfo-&gt;Xatom_XmTRANSFER_FAILURE))
<a id='L19244' name='L19244'></a> 19244           <em class='brace'>{</em>
<a id='L19245' name='L19245'></a> 19245             x_dnd_waiting_for_finish = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L19246' name='L19246'></a> 19246 
<a id='L19247' name='L19247'></a> 19247             <em class='comment'>/* If the transfer failed, then return nil from</em>
<a id='L19248' name='L19248'></a> 19248 <em class='comment'>               `x-begin-drag'.  */</em>
<a id='L19249' name='L19249'></a> 19249             <strong class='reserved'>if</strong> (eventp-&gt;target == dpyinfo-&gt;Xatom_XmTRANSFER_FAILURE)
<a id='L19250' name='L19250'></a> 19250               x_dnd_action = None;
<a id='L19251' name='L19251'></a> 19251           <em class='brace'>}</em>
<a id='L19252' name='L19252'></a> 19252       <em class='brace'>}</em>
<a id='L19253' name='L19253'></a> 19253       <strong class='reserved'>break</strong>;
<a id='L19254' name='L19254'></a> 19254 
<a id='L19255' name='L19255'></a> 19255     <strong class='reserved'>case</strong> PropertyNotify:
<a id='L19256' name='L19256'></a> 19256       <strong class='reserved'>if</strong> (x_dnd_in_progress &amp;&amp; x_dnd_use_toplevels
<a id='L19257' name='L19257'></a> 19257           &amp;&amp; dpyinfo == <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (x_dnd_frame)
<a id='L19258' name='L19258'></a> 19258           &amp;&amp; event-&gt;xproperty.atom == dpyinfo-&gt;Xatom_wm_state)
<a id='L19259' name='L19259'></a> 19259         <em class='brace'>{</em>
<a id='L19260' name='L19260'></a> 19260           <strong class='reserved'>struct</strong> <a href='../S/2289.html#L1484' title='Defined at 1484 in src/xterm.c.'>x_client_list_window</a> *tem, *last;
<a id='L19261' name='L19261'></a> 19261 
<a id='L19262' name='L19262'></a> 19262           <strong class='reserved'>for</strong> (last = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, tem = x_dnd_toplevels; tem;
<a id='L19263' name='L19263'></a> 19263                last = tem, tem = tem-&gt;next)
<a id='L19264' name='L19264'></a> 19264             <em class='brace'>{</em>
<a id='L19265' name='L19265'></a> 19265               <strong class='reserved'>if</strong> (tem-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> == event-&gt;xproperty.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>)
<a id='L19266' name='L19266'></a> 19266                 <em class='brace'>{</em>
<a id='L19267' name='L19267'></a> 19267                   Atom actual_type;
<a id='L19268' name='L19268'></a> 19268                   <strong class='reserved'>int</strong> actual_format, rc;
<a id='L19269' name='L19269'></a> 19269                   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> nitems, bytesafter;
<a id='L19270' name='L19270'></a> 19270                   <strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *data = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L19271' name='L19271'></a> 19271 
<a id='L19272' name='L19272'></a> 19272                   <strong class='reserved'>if</strong> (event-&gt;xproperty.state == PropertyDelete)
<a id='L19273' name='L19273'></a> 19273                     <em class='brace'>{</em>
<a id='L19274' name='L19274'></a> 19274                       <strong class='reserved'>if</strong> (!last)
<a id='L19275' name='L19275'></a> 19275                         x_dnd_toplevels = tem-&gt;next;
<a id='L19276' name='L19276'></a> 19276                       <strong class='reserved'>else</strong>
<a id='L19277' name='L19277'></a> 19277                         last-&gt;next = tem-&gt;next;
<a id='L19278' name='L19278'></a> 19278 
<a id='L19279' name='L19279'></a> 19279 <em class='sharp'>#ifdef</em> HAVE_XSHAPE
<a id='L19280' name='L19280'></a> 19280                       <strong class='reserved'>if</strong> (tem-&gt;n_input_rects != -1)
<a id='L19281' name='L19281'></a> 19281                         <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (tem-&gt;input_rects);
<a id='L19282' name='L19282'></a> 19282                       <strong class='reserved'>if</strong> (tem-&gt;n_bounding_rects != -1)
<a id='L19283' name='L19283'></a> 19283                         <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (tem-&gt;bounding_rects);
<a id='L19284' name='L19284'></a> 19284 <em class='sharp'>#endif</em>
<a id='L19285' name='L19285'></a> 19285                       <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (tem);
<a id='L19286' name='L19286'></a> 19286                     <em class='brace'>}</em>
<a id='L19287' name='L19287'></a> 19287                   <strong class='reserved'>else</strong>
<a id='L19288' name='L19288'></a> 19288                     <em class='brace'>{</em>
<a id='L19289' name='L19289'></a> 19289                       x_catch_errors (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L19290' name='L19290'></a> 19290                       rc = XGetWindowProperty (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L19291' name='L19291'></a> 19291                                                event-&gt;xproperty.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>,
<a id='L19292' name='L19292'></a> 19292                                                dpyinfo-&gt;Xatom_wm_state,
<a id='L19293' name='L19293'></a> 19293                                                0, 2, False, AnyPropertyType,
<a id='L19294' name='L19294'></a> 19294                                                &amp;actual_type, &amp;actual_format,
<a id='L19295' name='L19295'></a> 19295                                                &amp;nitems, &amp;bytesafter, &amp;data);
<a id='L19296' name='L19296'></a> 19296 
<a id='L19297' name='L19297'></a> 19297                       <strong class='reserved'>if</strong> (!x_had_errors_p (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>) &amp;&amp; rc == Success &amp;&amp; data
<a id='L19298' name='L19298'></a> 19298                           &amp;&amp; nitems == 2 &amp;&amp; actual_format == 32)
<a id='L19299' name='L19299'></a> 19299                         tem-&gt;wm_state = ((<strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> *) data)[0];
<a id='L19300' name='L19300'></a> 19300                       <strong class='reserved'>else</strong>
<a id='L19301' name='L19301'></a> 19301                         tem-&gt;wm_state = WithdrawnState;
<a id='L19302' name='L19302'></a> 19302 
<a id='L19303' name='L19303'></a> 19303                       <strong class='reserved'>if</strong> (data)
<a id='L19304' name='L19304'></a> 19304                         XFree (data);
<a id='L19305' name='L19305'></a> 19305                       x_uncatch_errors_after_check ();
<a id='L19306' name='L19306'></a> 19306                     <em class='brace'>}</em>
<a id='L19307' name='L19307'></a> 19307 
<a id='L19308' name='L19308'></a> 19308                   x_dnd_update_state (dpyinfo, event-&gt;xproperty.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>);
<a id='L19309' name='L19309'></a> 19309                   <strong class='reserved'>break</strong>;
<a id='L19310' name='L19310'></a> 19310                 <em class='brace'>}</em>
<a id='L19311' name='L19311'></a> 19311             <em class='brace'>}</em>
<a id='L19312' name='L19312'></a> 19312         <em class='brace'>}</em>
<a id='L19313' name='L19313'></a> 19313 
<a id='L19314' name='L19314'></a> 19314       <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../D/19730.html' title='Multiple defined in 2 places.'>x_top_window_to_frame</a> (dpyinfo, event-&gt;xproperty.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L19315' name='L19315'></a> 19315       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; event-&gt;xproperty.atom == dpyinfo-&gt;Xatom_net_wm_state
<a id='L19316' name='L19316'></a> 19316           <em class='comment'>/* This should never happen with embedded windows.  */</em>
<a id='L19317' name='L19317'></a> 19317           &amp;&amp; !<a href='../S/2212.html#L1979' title='Defined at 1979 in src/xterm.h.'>FRAME_X_EMBEDDED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L19318' name='L19318'></a> 19318         <em class='brace'>{</em>
<a id='L19319' name='L19319'></a> 19319           <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> not_hidden = x_handle_net_wm_state (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, &amp;event-&gt;xproperty);
<a id='L19320' name='L19320'></a> 19320 
<a id='L19321' name='L19321'></a> 19321           <strong class='reserved'>if</strong> (not_hidden &amp;&amp; <a href='../S/2183.html#L1172' title='Defined at 1172 in src/frame.h.'>FRAME_ICONIFIED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L19322' name='L19322'></a> 19322             <em class='brace'>{</em>
<a id='L19323' name='L19323'></a> 19323               <strong class='reserved'>if</strong> (<a href='../D/1228.html' title='Multiple defined in 2 places.'>CONSP</a> (frame_size_history))
<a id='L19324' name='L19324'></a> 19324                 <a href='../S/2247.html#L554' title='Defined at 554 in src/frame.c.'>frame_size_history_plain</a>
<a id='L19325' name='L19325'></a> 19325                   (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9420.html' title='Multiple defined in 2 places.'>build_string</a> ("PropertyNotify, not hidden &amp; iconified"));
<a id='L19326' name='L19326'></a> 19326 
<a id='L19327' name='L19327'></a> 19327               <em class='comment'>/* Gnome shell does not iconify us when C-z is pressed.</em>
<a id='L19328' name='L19328'></a> 19328 <em class='comment'>                 It hides the frame.  So if our state says we aren't</em>
<a id='L19329' name='L19329'></a> 19329 <em class='comment'>                 hidden anymore, treat it as deiconified.  */</em>
<a id='L19330' name='L19330'></a> 19330               <a href='../S/2183.html#L1437' title='Defined at 1437 in src/frame.h.'>SET_FRAME_VISIBLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 1);
<a id='L19331' name='L19331'></a> 19331               <a href='../S/2183.html#L1452' title='Defined at 1452 in src/frame.h.'>SET_FRAME_ICONIFIED</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L19332' name='L19332'></a> 19332 
<a id='L19333' name='L19333'></a> 19333               <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;has_been_visible = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L19334' name='L19334'></a> 19334               inev.ie.kind = <a href='../S/2231.html#L197' title='Defined at 197 in src/termhooks.h.'>DEICONIFY_EVENT</a>;
<a id='L19335' name='L19335'></a> 19335 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> USE_GTK &amp;&amp; <strong class='reserved'>defined</strong> HAVE_GTK3
<a id='L19336' name='L19336'></a> 19336               <em class='comment'>/* If GTK3 wants to impose some old size here (Bug#24526),</em>
<a id='L19337' name='L19337'></a> 19337 <em class='comment'>                 tell it that the current size is what we want.  */</em>
<a id='L19338' name='L19338'></a> 19338               <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;was_invisible)
<a id='L19339' name='L19339'></a> 19339                 <em class='brace'>{</em>
<a id='L19340' name='L19340'></a> 19340                   <a href='../S/2362.html#L1168' title='Defined at 1168 in src/gtkutil.c.'>xg_frame_set_char_size</a>
<a id='L19341' name='L19341'></a> 19341                     (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/2183.html#L1051' title='Defined at 1051 in src/frame.h.'>FRAME_PIXEL_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../S/2183.html#L1052' title='Defined at 1052 in src/frame.h.'>FRAME_PIXEL_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L19342' name='L19342'></a> 19342                   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;was_invisible = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L19343' name='L19343'></a> 19343                 <em class='brace'>}</em>
<a id='L19344' name='L19344'></a> 19344 <em class='sharp'>#endif</em>
<a id='L19345' name='L19345'></a> 19345               <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (inev.ie.frame_or_window, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L19346' name='L19346'></a> 19346             <em class='brace'>}</em>
<a id='L19347' name='L19347'></a> 19347           <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (!not_hidden &amp;&amp; !<a href='../S/2183.html#L1172' title='Defined at 1172 in src/frame.h.'>FRAME_ICONIFIED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L19348' name='L19348'></a> 19348             <em class='brace'>{</em>
<a id='L19349' name='L19349'></a> 19349               <strong class='reserved'>if</strong> (<a href='../D/1228.html' title='Multiple defined in 2 places.'>CONSP</a> (frame_size_history))
<a id='L19350' name='L19350'></a> 19350                 <a href='../S/2247.html#L554' title='Defined at 554 in src/frame.c.'>frame_size_history_plain</a>
<a id='L19351' name='L19351'></a> 19351                   (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9420.html' title='Multiple defined in 2 places.'>build_string</a> ("PropertyNotify, hidden &amp; not iconified"));
<a id='L19352' name='L19352'></a> 19352 
<a id='L19353' name='L19353'></a> 19353               <a href='../S/2183.html#L1437' title='Defined at 1437 in src/frame.h.'>SET_FRAME_VISIBLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 0);
<a id='L19354' name='L19354'></a> 19354               <a href='../S/2183.html#L1452' title='Defined at 1452 in src/frame.h.'>SET_FRAME_ICONIFIED</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L19355' name='L19355'></a> 19355               inev.ie.kind = <a href='../S/2231.html#L196' title='Defined at 196 in src/termhooks.h.'>ICONIFY_EVENT</a>;
<a id='L19356' name='L19356'></a> 19356               <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (inev.ie.frame_or_window, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L19357' name='L19357'></a> 19357             <em class='brace'>}</em>
<a id='L19358' name='L19358'></a> 19358         <em class='brace'>}</em>
<a id='L19359' name='L19359'></a> 19359 
<a id='L19360' name='L19360'></a> 19360       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; event-&gt;xproperty.atom == dpyinfo-&gt;Xatom_wm_state
<a id='L19361' name='L19361'></a> 19361           &amp;&amp; !<a href='../S/2212.html#L1979' title='Defined at 1979 in src/xterm.h.'>FRAME_X_EMBEDDED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) &amp;&amp; !<a href='../D/2370.html' title='Multiple defined in 2 places.'>FRAME_PARENT_FRAME</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L19362' name='L19362'></a> 19362         <em class='comment'>/* Handle WM_STATE.  We use this to clear the iconified flag</em>
<a id='L19363' name='L19363'></a> 19363 <em class='comment'>           on a frame if it is set.</em>
<a id='L19364' name='L19364'></a> 19364 <em class='comment'></em>
<a id='L19365' name='L19365'></a> 19365 <em class='comment'>           GTK builds ignore deiconifying frames on FocusIn or Expose</em>
<a id='L19366' name='L19366'></a> 19366 <em class='comment'>           by default, and cannot wait for the window manager to</em>
<a id='L19367' name='L19367'></a> 19367 <em class='comment'>           remove _NET_WM_STATE_HIDDEN, as it is ambiguous when not</em>
<a id='L19368' name='L19368'></a> 19368 <em class='comment'>           set.  Handling UnmapNotify also checks for</em>
<a id='L19369' name='L19369'></a> 19369 <em class='comment'>           _NET_WM_STATE_HIDDEN, and thus suffers from the same</em>
<a id='L19370' name='L19370'></a> 19370 <em class='comment'>           problem.  */</em>
<a id='L19371' name='L19371'></a> 19371         x_handle_wm_state (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, &amp;inev.ie);
<a id='L19372' name='L19372'></a> 19372 
<a id='L19373' name='L19373'></a> 19373       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;alpha_identical_p
<a id='L19374' name='L19374'></a> 19374           &amp;&amp; (event-&gt;xproperty.atom
<a id='L19375' name='L19375'></a> 19375               == dpyinfo-&gt;Xatom_net_wm_window_opacity))
<a id='L19376' name='L19376'></a> 19376         <em class='brace'>{</em>
<a id='L19377' name='L19377'></a> 19377 <em class='sharp'>#ifndef</em> USE_XCB
<a id='L19378' name='L19378'></a> 19378           <strong class='reserved'>int</strong> rc, actual_format;
<a id='L19379' name='L19379'></a> 19379           Atom actual;
<a id='L19380' name='L19380'></a> 19380           <strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *tmp_data;
<a id='L19381' name='L19381'></a> 19381           <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> n, left, opacity;
<a id='L19382' name='L19382'></a> 19382 
<a id='L19383' name='L19383'></a> 19383           tmp_data = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L19384' name='L19384'></a> 19384 <em class='sharp'>#else</em>
<a id='L19385' name='L19385'></a> 19385           xcb_get_property_cookie_t opacity_cookie;
<a id='L19386' name='L19386'></a> 19386           xcb_get_property_reply_t *opacity_reply;
<a id='L19387' name='L19387'></a> 19387           xcb_generic_error_t *<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>;
<a id='L19388' name='L19388'></a> 19388           <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> rc;
<a id='L19389' name='L19389'></a> 19389           <a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>;
<a id='L19390' name='L19390'></a> 19390 <em class='sharp'>#endif</em>
<a id='L19391' name='L19391'></a> 19391 
<a id='L19392' name='L19392'></a> 19392           <strong class='reserved'>if</strong> (event-&gt;xproperty.state == PropertyDelete)
<a id='L19393' name='L19393'></a> 19393             <em class='brace'>{</em>
<a id='L19394' name='L19394'></a> 19394               <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;alpha[0] = 1.0;
<a id='L19395' name='L19395'></a> 19395               <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;alpha[1] = 1.0;
<a id='L19396' name='L19396'></a> 19396 
<a id='L19397' name='L19397'></a> 19397               <a href='../S/2247.html#L3214' title='Defined at 3214 in src/frame.c.'>store_frame_param</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, Qalpha, Qnil);
<a id='L19398' name='L19398'></a> 19398             <em class='brace'>}</em>
<a id='L19399' name='L19399'></a> 19399           <strong class='reserved'>else</strong>
<a id='L19400' name='L19400'></a> 19400             <em class='brace'>{</em>
<a id='L19401' name='L19401'></a> 19401 <em class='sharp'>#ifndef</em> USE_XCB
<a id='L19402' name='L19402'></a> 19402               rc = XGetWindowProperty (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L19403' name='L19403'></a> 19403                                        dpyinfo-&gt;Xatom_net_wm_window_opacity,
<a id='L19404' name='L19404'></a> 19404                                        0, 1, False, AnyPropertyType, &amp;actual,
<a id='L19405' name='L19405'></a> 19405                                        &amp;actual_format, &amp;n, &amp;left, &amp;tmp_data);
<a id='L19406' name='L19406'></a> 19406 
<a id='L19407' name='L19407'></a> 19407               <strong class='reserved'>if</strong> (rc == Success &amp;&amp; actual_format == 32
<a id='L19408' name='L19408'></a> 19408                   &amp;&amp; (actual == XA_CARDINAL
<a id='L19409' name='L19409'></a> 19409                       <em class='comment'>/* Some broken programs set the opacity property</em>
<a id='L19410' name='L19410'></a> 19410 <em class='comment'>                         to those types, but window managers accept</em>
<a id='L19411' name='L19411'></a> 19411 <em class='comment'>                         them anyway.  */</em>
<a id='L19412' name='L19412'></a> 19412                       || actual == XA_ATOM
<a id='L19413' name='L19413'></a> 19413                       || actual == XA_WINDOW) &amp;&amp; n)
<a id='L19414' name='L19414'></a> 19414                 <em class='brace'>{</em>
<a id='L19415' name='L19415'></a> 19415                   opacity = *(<strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> *) tmp_data &amp; <a href='../S/2289.html#L6808' title='Defined at 6808 in src/xterm.c.'>OPAQUE</a>;
<a id='L19416' name='L19416'></a> 19416                   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;alpha[0] = (<strong class='reserved'>double</strong>) opacity / (<strong class='reserved'>double</strong>) <a href='../S/2289.html#L6808' title='Defined at 6808 in src/xterm.c.'>OPAQUE</a>;
<a id='L19417' name='L19417'></a> 19417                   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;alpha[1] = (<strong class='reserved'>double</strong>) opacity / (<strong class='reserved'>double</strong>) <a href='../S/2289.html#L6808' title='Defined at 6808 in src/xterm.c.'>OPAQUE</a>;
<a id='L19418' name='L19418'></a> 19418 
<a id='L19419' name='L19419'></a> 19419                   <a href='../S/2247.html#L3214' title='Defined at 3214 in src/frame.c.'>store_frame_param</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, Qalpha, <a href='../S/2350.html#L2753' title='Defined at 2753 in src/alloc.c.'>make_float</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;alpha[0]));
<a id='L19420' name='L19420'></a> 19420                 <em class='brace'>}</em>
<a id='L19421' name='L19421'></a> 19421               <strong class='reserved'>else</strong>
<a id='L19422' name='L19422'></a> 19422                 <em class='brace'>{</em>
<a id='L19423' name='L19423'></a> 19423                   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;alpha[0] = 1.0;
<a id='L19424' name='L19424'></a> 19424                   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;alpha[1] = 1.0;
<a id='L19425' name='L19425'></a> 19425 
<a id='L19426' name='L19426'></a> 19426                   <a href='../S/2247.html#L3214' title='Defined at 3214 in src/frame.c.'>store_frame_param</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, Qalpha, Qnil);
<a id='L19427' name='L19427'></a> 19427                 <em class='brace'>}</em>
<a id='L19428' name='L19428'></a> 19428 <em class='sharp'>#else</em>
<a id='L19429' name='L19429'></a> 19429               opacity_cookie
<a id='L19430' name='L19430'></a> 19430                 = xcb_get_property (dpyinfo-&gt;xcb_connection, 0,
<a id='L19431' name='L19431'></a> 19431                                     (xcb_window_t) <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L19432' name='L19432'></a> 19432                                     (xcb_atom_t) dpyinfo-&gt;Xatom_net_wm_window_opacity,
<a id='L19433' name='L19433'></a> 19433                                     XA_CARDINAL, 0, 1);
<a id='L19434' name='L19434'></a> 19434               opacity_reply
<a id='L19435' name='L19435'></a> 19435                 = xcb_get_property_reply (dpyinfo-&gt;xcb_connection,
<a id='L19436' name='L19436'></a> 19436                                           opacity_cookie, &amp;<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L19437' name='L19437'></a> 19437 
<a id='L19438' name='L19438'></a> 19438               <strong class='reserved'>if</strong> (!opacity_reply)
<a id='L19439' name='L19439'></a> 19439                 <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>), rc = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L19440' name='L19440'></a> 19440               <strong class='reserved'>else</strong>
<a id='L19441' name='L19441'></a> 19441                 rc = (opacity_reply-&gt;format == 32
<a id='L19442' name='L19442'></a> 19442                       &amp;&amp; (opacity_reply-&gt;type == XA_CARDINAL
<a id='L19443' name='L19443'></a> 19443                           || opacity_reply-&gt;type == XA_ATOM
<a id='L19444' name='L19444'></a> 19444                           || opacity_reply-&gt;type == XA_WINDOW)
<a id='L19445' name='L19445'></a> 19445                       &amp;&amp; (xcb_get_property_value_length (opacity_reply) &gt;= 4));
<a id='L19446' name='L19446'></a> 19446 
<a id='L19447' name='L19447'></a> 19447               <strong class='reserved'>if</strong> (rc)
<a id='L19448' name='L19448'></a> 19448                 <em class='brace'>{</em>
<a id='L19449' name='L19449'></a> 19449                   <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a> = *(<a href='../D/18592.html' title='Multiple defined in 4 places.'>uint32_t</a> *) xcb_get_property_value (opacity_reply);
<a id='L19450' name='L19450'></a> 19450 
<a id='L19451' name='L19451'></a> 19451                   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;alpha[0] = (<strong class='reserved'>double</strong>) <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a> / (<strong class='reserved'>double</strong>) <a href='../S/2289.html#L6808' title='Defined at 6808 in src/xterm.c.'>OPAQUE</a>;
<a id='L19452' name='L19452'></a> 19452                   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;alpha[1] = (<strong class='reserved'>double</strong>) <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a> / (<strong class='reserved'>double</strong>) <a href='../S/2289.html#L6808' title='Defined at 6808 in src/xterm.c.'>OPAQUE</a>;
<a id='L19453' name='L19453'></a> 19453                   <a href='../S/2247.html#L3214' title='Defined at 3214 in src/frame.c.'>store_frame_param</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, Qalpha, <a href='../S/2350.html#L2753' title='Defined at 2753 in src/alloc.c.'>make_float</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;alpha[0]));
<a id='L19454' name='L19454'></a> 19454                 <em class='brace'>}</em>
<a id='L19455' name='L19455'></a> 19455               <strong class='reserved'>else</strong>
<a id='L19456' name='L19456'></a> 19456                 <em class='brace'>{</em>
<a id='L19457' name='L19457'></a> 19457                   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;alpha[0] = 1.0;
<a id='L19458' name='L19458'></a> 19458                   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;alpha[1] = 1.0;
<a id='L19459' name='L19459'></a> 19459 
<a id='L19460' name='L19460'></a> 19460                   <a href='../S/2247.html#L3214' title='Defined at 3214 in src/frame.c.'>store_frame_param</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, Qalpha, Qnil);
<a id='L19461' name='L19461'></a> 19461                 <em class='brace'>}</em>
<a id='L19462' name='L19462'></a> 19462 
<a id='L19463' name='L19463'></a> 19463               <strong class='reserved'>if</strong> (opacity_reply)
<a id='L19464' name='L19464'></a> 19464                 <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (opacity_reply);
<a id='L19465' name='L19465'></a> 19465 <em class='sharp'>#endif</em>
<a id='L19466' name='L19466'></a> 19466             <em class='brace'>}</em>
<a id='L19467' name='L19467'></a> 19467 
<a id='L19468' name='L19468'></a> 19468 <em class='sharp'>#ifndef</em> USE_XCB
<a id='L19469' name='L19469'></a> 19469           <strong class='reserved'>if</strong> (tmp_data)
<a id='L19470' name='L19470'></a> 19470             XFree (tmp_data);
<a id='L19471' name='L19471'></a> 19471 <em class='sharp'>#endif</em>
<a id='L19472' name='L19472'></a> 19472         <em class='brace'>}</em>
<a id='L19473' name='L19473'></a> 19473 
<a id='L19474' name='L19474'></a> 19474       <strong class='reserved'>if</strong> (event-&gt;xproperty.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> == dpyinfo-&gt;root_window
<a id='L19475' name='L19475'></a> 19475           &amp;&amp; (event-&gt;xproperty.atom == dpyinfo-&gt;Xatom_net_client_list_stacking
<a id='L19476' name='L19476'></a> 19476               || event-&gt;xproperty.atom == dpyinfo-&gt;Xatom_net_current_desktop)
<a id='L19477' name='L19477'></a> 19477           &amp;&amp; x_dnd_in_progress
<a id='L19478' name='L19478'></a> 19478           &amp;&amp; dpyinfo == <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (x_dnd_frame))
<a id='L19479' name='L19479'></a> 19479         <em class='brace'>{</em>
<a id='L19480' name='L19480'></a> 19480           <strong class='reserved'>if</strong> (x_dnd_use_toplevels)
<a id='L19481' name='L19481'></a> 19481             <em class='brace'>{</em>
<a id='L19482' name='L19482'></a> 19482               <a href='../S/2289.html#L2918' title='Defined at 2918 in src/xterm.c.'>x_dnd_free_toplevels</a> (<a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L19483' name='L19483'></a> 19483 
<a id='L19484' name='L19484'></a> 19484               <strong class='reserved'>if</strong> (<a href='../S/2289.html#L3015' title='Defined at 3015 in src/xterm.c.'>x_dnd_compute_toplevels</a> (dpyinfo))
<a id='L19485' name='L19485'></a> 19485                 <em class='brace'>{</em>
<a id='L19486' name='L19486'></a> 19486                   <a href='../S/2289.html#L2918' title='Defined at 2918 in src/xterm.c.'>x_dnd_free_toplevels</a> (<a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L19487' name='L19487'></a> 19487                   x_dnd_use_toplevels = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L19488' name='L19488'></a> 19488                 <em class='brace'>}</em>
<a id='L19489' name='L19489'></a> 19489             <em class='brace'>}</em>
<a id='L19490' name='L19490'></a> 19490 
<a id='L19491' name='L19491'></a> 19491           x_dnd_update_state (dpyinfo, event-&gt;xproperty.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>);
<a id='L19492' name='L19492'></a> 19492         <em class='brace'>}</em>
<a id='L19493' name='L19493'></a> 19493 
<a id='L19494' name='L19494'></a> 19494       <a href='../S/2281.html#L1551' title='Defined at 1551 in src/xselect.c.'>x_handle_property_notify</a> (&amp;event-&gt;xproperty);
<a id='L19495' name='L19495'></a> 19495       <a href='../S/2158.html#L1000' title='Defined at 1000 in src/xsettings.c.'>xft_settings_event</a> (dpyinfo, event);
<a id='L19496' name='L19496'></a> 19496       <strong class='reserved'>goto</strong> OTHER;
<a id='L19497' name='L19497'></a> 19497 
<a id='L19498' name='L19498'></a> 19498     <strong class='reserved'>case</strong> ReparentNotify:
<a id='L19499' name='L19499'></a> 19499       <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../D/19730.html' title='Multiple defined in 2 places.'>x_top_window_to_frame</a> (dpyinfo, event-&gt;xreparent.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L19500' name='L19500'></a> 19500       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L19501' name='L19501'></a> 19501         <em class='brace'>{</em>
<a id='L19502' name='L19502'></a> 19502 <em class='sharp'>#ifndef</em> USE_GTK
<a id='L19503' name='L19503'></a> 19503           <strong class='reserved'>if</strong> (<a href='../D/2368.html' title='Multiple defined in 7 places.'>FRAME_OUTPUT_DATA</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;parent_desc
<a id='L19504' name='L19504'></a> 19504               &amp;&amp; <a href='../S/2212.html#L1979' title='Defined at 1979 in src/xterm.h.'>FRAME_X_EMBEDDED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L19505' name='L19505'></a> 19505             <em class='brace'>{</em>
<a id='L19506' name='L19506'></a> 19506               <em class='comment'>/* The frame's embedder was destroyed; mark the frame as</em>
<a id='L19507' name='L19507'></a> 19507 <em class='comment'>                 no longer embedded, and map the frame.  An</em>
<a id='L19508' name='L19508'></a> 19508 <em class='comment'>                 UnmapNotify event must have previously been received</em>
<a id='L19509' name='L19509'></a> 19509 <em class='comment'>                 during the start of save-set processing.  */</em>
<a id='L19510' name='L19510'></a> 19510 
<a id='L19511' name='L19511'></a> 19511               <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;explicit_parent = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L19512' name='L19512'></a> 19512 
<a id='L19513' name='L19513'></a> 19513               <em class='comment'>/* Remove the leftover XEMBED_INFO property.  */</em>
<a id='L19514' name='L19514'></a> 19514               XDeleteProperty (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L19515' name='L19515'></a> 19515                                dpyinfo-&gt;Xatom_XEMBED_INFO);
<a id='L19516' name='L19516'></a> 19516               x_make_frame_visible (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L19517' name='L19517'></a> 19517             <em class='brace'>}</em>
<a id='L19518' name='L19518'></a> 19518 <em class='sharp'>#endif</em>
<a id='L19519' name='L19519'></a> 19519 
<a id='L19520' name='L19520'></a> 19520           <em class='comment'>/* Maybe we shouldn't set this for child frames ??  */</em>
<a id='L19521' name='L19521'></a> 19521           <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;parent_desc = event-&gt;xreparent.<a href='../D/15236.html' title='Multiple defined in 2 places.'>parent</a>;
<a id='L19522' name='L19522'></a> 19522 
<a id='L19523' name='L19523'></a> 19523           <strong class='reserved'>if</strong> (!<a href='../D/2370.html' title='Multiple defined in 2 places.'>FRAME_PARENT_FRAME</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L19524' name='L19524'></a> 19524             <em class='brace'>{</em>
<a id='L19525' name='L19525'></a> 19525               <a href='../S/2296.html#L596' title='Defined at 596 in src/xfns.c.'>x_real_positions</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, &amp;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;left_pos, &amp;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;top_pos);
<a id='L19526' name='L19526'></a> 19526 
<a id='L19527' name='L19527'></a> 19527               <em class='comment'>/* Perhaps reparented due to a WM restart.  Reset this.  */</em>
<a id='L19528' name='L19528'></a> 19528               dpyinfo-&gt;wm_type = <a href='../S/2212.html#L685' title='Defined at 685 in src/xterm.h.'>X_WMTYPE_UNKNOWN</a>;
<a id='L19529' name='L19529'></a> 19529               dpyinfo-&gt;net_supported_window = 0;
<a id='L19530' name='L19530'></a> 19530 
<a id='L19531' name='L19531'></a> 19531 <em class='sharp'>#ifndef</em> USE_GTK
<a id='L19532' name='L19532'></a> 19532               <em class='comment'>/* The window manager could have restarted and the new</em>
<a id='L19533' name='L19533'></a> 19533 <em class='comment'>                 window manager might not support user time windows,</em>
<a id='L19534' name='L19534'></a> 19534 <em class='comment'>                 so update what is used accordingly.</em>
<a id='L19535' name='L19535'></a> 19535 <em class='comment'></em>
<a id='L19536' name='L19536'></a> 19536 <em class='comment'>                 Note that this doesn't handle changes between</em>
<a id='L19537' name='L19537'></a> 19537 <em class='comment'>                 non-reparenting window managers.  */</em>
<a id='L19538' name='L19538'></a> 19538               <strong class='reserved'>if</strong> (<a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;has_been_visible)
<a id='L19539' name='L19539'></a> 19539                 <a href='../S/2289.html#L8068' title='Defined at 8068 in src/xterm.c.'>x_update_frame_user_time_window</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L19540' name='L19540'></a> 19540 <em class='sharp'>#endif</em>
<a id='L19541' name='L19541'></a> 19541             <em class='brace'>}</em>
<a id='L19542' name='L19542'></a> 19542           <strong class='reserved'>else</strong>
<a id='L19543' name='L19543'></a> 19543             <em class='brace'>{</em>
<a id='L19544' name='L19544'></a> 19544               <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> root;
<a id='L19545' name='L19545'></a> 19545               <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> dummy_uint;
<a id='L19546' name='L19546'></a> 19546 
<a id='L19547' name='L19547'></a> 19547               <a href='../S/2321.html#L123' title='Defined at 123 in src/msdos.h.'>XGetGeometry</a> (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L19548' name='L19548'></a> 19548                             &amp;root, &amp;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;left_pos, &amp;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;top_pos,
<a id='L19549' name='L19549'></a> 19549                             &amp;dummy_uint, &amp;dummy_uint, &amp;dummy_uint, &amp;dummy_uint);
<a id='L19550' name='L19550'></a> 19550             <em class='brace'>}</em>
<a id='L19551' name='L19551'></a> 19551 
<a id='L19552' name='L19552'></a> 19552           <a href='../S/2289.html#L6811' title='Defined at 6811 in src/xterm.c.'>x_set_frame_alpha</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L19553' name='L19553'></a> 19553         <em class='brace'>}</em>
<a id='L19554' name='L19554'></a> 19554       <strong class='reserved'>goto</strong> OTHER;
<a id='L19555' name='L19555'></a> 19555 
<a id='L19556' name='L19556'></a> 19556     <strong class='reserved'>case</strong> Expose:
<a id='L19557' name='L19557'></a> 19557 
<a id='L19558' name='L19558'></a> 19558 <em class='sharp'>#ifdef</em> HAVE_XWIDGETS
<a id='L19559' name='L19559'></a> 19559       <em class='brace'>{</em>
<a id='L19560' name='L19560'></a> 19560         <strong class='reserved'>struct</strong> <a href='../S/2261.html#L102' title='Defined at 102 in src/xwidget.h.'>xwidget_view</a> *xv;
<a id='L19561' name='L19561'></a> 19561 
<a id='L19562' name='L19562'></a> 19562         xv = <a href='../S/2334.html#L2116' title='Defined at 2116 in src/xwidget.c.'>xwidget_view_from_window</a> (event-&gt;xexpose.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L19563' name='L19563'></a> 19563 
<a id='L19564' name='L19564'></a> 19564         <strong class='reserved'>if</strong> (xv)
<a id='L19565' name='L19565'></a> 19565           <em class='brace'>{</em>
<a id='L19566' name='L19566'></a> 19566             <a href='../S/2334.html#L2253' title='Defined at 2253 in src/xwidget.c.'>xwidget_expose</a> (xv);
<a id='L19567' name='L19567'></a> 19567             <strong class='reserved'>goto</strong> OTHER;
<a id='L19568' name='L19568'></a> 19568           <em class='brace'>}</em>
<a id='L19569' name='L19569'></a> 19569       <em class='brace'>}</em>
<a id='L19570' name='L19570'></a> 19570 <em class='sharp'>#endif</em>
<a id='L19571' name='L19571'></a> 19571 
<a id='L19572' name='L19572'></a> 19572       <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2289.html#L11957' title='Defined at 11957 in src/xterm.c.'>x_window_to_frame</a> (dpyinfo, event-&gt;xexpose.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L19573' name='L19573'></a> 19573       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L19574' name='L19574'></a> 19574         <em class='brace'>{</em>
<a id='L19575' name='L19575'></a> 19575           <strong class='reserved'>if</strong> (!<a href='../S/2183.html#L1152' title='Defined at 1152 in src/frame.h.'>FRAME_VISIBLE_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L19576' name='L19576'></a> 19576             <em class='brace'>{</em>
<a id='L19577' name='L19577'></a> 19577               <em class='comment'>/* By default, do not set the frame's visibility here, see</em>
<a id='L19578' name='L19578'></a> 19578 <em class='comment'>                 https://lists.gnu.org/archive/html/emacs-devel/2017-02/msg00133.html.</em>
<a id='L19579' name='L19579'></a> 19579 <em class='comment'>                 The default behavior can be overridden by setting</em>
<a id='L19580' name='L19580'></a> 19580 <em class='comment'>                 'x-set-frame-visibility-more-laxly' (Bug#49955,</em>
<a id='L19581' name='L19581'></a> 19581 <em class='comment'>                 Bug#53298).  */</em>
<a id='L19582' name='L19582'></a> 19582               <strong class='reserved'>if</strong> (<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (x_set_frame_visibility_more_laxly, Qexpose)
<a id='L19583' name='L19583'></a> 19583                   || <a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (x_set_frame_visibility_more_laxly, Qt))
<a id='L19584' name='L19584'></a> 19584                 <em class='brace'>{</em>
<a id='L19585' name='L19585'></a> 19585                   <a href='../S/2183.html#L1437' title='Defined at 1437 in src/frame.h.'>SET_FRAME_VISIBLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 1);
<a id='L19586' name='L19586'></a> 19586                   <a href='../S/2183.html#L1452' title='Defined at 1452 in src/frame.h.'>SET_FRAME_ICONIFIED</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L19587' name='L19587'></a> 19587                 <em class='brace'>}</em>
<a id='L19588' name='L19588'></a> 19588 
<a id='L19589' name='L19589'></a> 19589 <em class='sharp'>#ifdef</em> HAVE_XDBE
<a id='L19590' name='L19590'></a> 19590               <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1356' title='Defined at 1356 in src/xterm.h.'>FRAME_X_DOUBLE_BUFFERED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L19591' name='L19591'></a> 19591                 <a href='../S/2289.html#L5071' title='Defined at 5071 in src/xterm.c.'>x_drop_xrender_surfaces</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L19592' name='L19592'></a> 19592 <em class='sharp'>#endif</em>
<a id='L19593' name='L19593'></a> 19593               <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;has_been_visible = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L19594' name='L19594'></a> 19594               <a href='../S/2183.html#L1175' title='Defined at 1175 in src/frame.h.'>SET_FRAME_GARBAGED</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L19595' name='L19595'></a> 19595             <em class='brace'>}</em>
<a id='L19596' name='L19596'></a> 19596           <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (<a href='../S/2183.html#L1179' title='Defined at 1179 in src/frame.h.'>FRAME_GARBAGED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L19597' name='L19597'></a> 19597             <em class='brace'>{</em>
<a id='L19598' name='L19598'></a> 19598 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L19599' name='L19599'></a> 19599               <em class='comment'>/* Go around the back buffer and manually clear the</em>
<a id='L19600' name='L19600'></a> 19600 <em class='comment'>                 window the first time we show it.  This way, we avoid</em>
<a id='L19601' name='L19601'></a> 19601 <em class='comment'>                 showing users the sanity-defying horror of whatever</em>
<a id='L19602' name='L19602'></a> 19602 <em class='comment'>                 GtkWindow is rendering beneath us.  We've garbaged</em>
<a id='L19603' name='L19603'></a> 19603 <em class='comment'>                 the frame, so we'll redraw the whole thing on next</em>
<a id='L19604' name='L19604'></a> 19604 <em class='comment'>                 redisplay anyway.  Yuck.  */</em>
<a id='L19605' name='L19605'></a> 19605               <a href='../S/2289.html#L11067' title='Defined at 11067 in src/xterm.c.'>x_clear_area1</a> (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L19606' name='L19606'></a> 19606                              <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L19607' name='L19607'></a> 19607                              event-&gt;xexpose.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, event-&gt;xexpose.y,
<a id='L19608' name='L19608'></a> 19608                              event-&gt;xexpose.width, event-&gt;xexpose.height,
<a id='L19609' name='L19609'></a> 19609                              0);
<a id='L19610' name='L19610'></a> 19610               <a href='../S/2289.html#L7569' title='Defined at 7569 in src/xterm.c.'>x_clear_under_internal_border</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L19611' name='L19611'></a> 19611 <em class='sharp'>#endif</em>
<a id='L19612' name='L19612'></a> 19612             <em class='brace'>}</em>
<a id='L19613' name='L19613'></a> 19613 
<a id='L19614' name='L19614'></a> 19614           <strong class='reserved'>if</strong> (!<a href='../S/2183.html#L1179' title='Defined at 1179 in src/frame.h.'>FRAME_GARBAGED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L19615' name='L19615'></a> 19615             <em class='brace'>{</em>
<a id='L19616' name='L19616'></a> 19616 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> USE_X_TOOLKIT &amp;&amp; <strong class='reserved'>defined</strong> USE_TOOLKIT_SCROLL_BARS
<a id='L19617' name='L19617'></a> 19617               <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;edit_widget)
<a id='L19618' name='L19618'></a> 19618                 <em class='comment'>/* The widget's expose proc will be run in this</em>
<a id='L19619' name='L19619'></a> 19619 <em class='comment'>                   case.  */</em>
<a id='L19620' name='L19620'></a> 19620                 <strong class='reserved'>goto</strong> OTHER;
<a id='L19621' name='L19621'></a> 19621 <em class='sharp'>#endif</em>
<a id='L19622' name='L19622'></a> 19622 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L19623' name='L19623'></a> 19623               <em class='comment'>/* This seems to be needed for GTK 2.6 and later, see</em>
<a id='L19624' name='L19624'></a> 19624 <em class='comment'>                 https://debbugs.gnu.org/cgi/bugreport.cgi?bug=15398.  */</em>
<a id='L19625' name='L19625'></a> 19625               <a href='../S/2289.html#L11076' title='Defined at 11076 in src/xterm.c.'>x_clear_area</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>,
<a id='L19626' name='L19626'></a> 19626                             event-&gt;xexpose.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, event-&gt;xexpose.y,
<a id='L19627' name='L19627'></a> 19627                             event-&gt;xexpose.width, event-&gt;xexpose.height);
<a id='L19628' name='L19628'></a> 19628 <em class='sharp'>#endif</em>
<a id='L19629' name='L19629'></a> 19629               <a href='../S/2224.html#L36467' title='Defined at 36467 in src/xdisp.c.'>expose_frame</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, event-&gt;xexpose.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, event-&gt;xexpose.y,
<a id='L19630' name='L19630'></a> 19630                             event-&gt;xexpose.width, event-&gt;xexpose.height);
<a id='L19631' name='L19631'></a> 19631 <em class='sharp'>#ifndef</em> USE_TOOLKIT_SCROLL_BARS
<a id='L19632' name='L19632'></a> 19632               x_scroll_bar_handle_exposure (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, (XEvent *) event);
<a id='L19633' name='L19633'></a> 19633 <em class='sharp'>#endif</em>
<a id='L19634' name='L19634'></a> 19634 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L19635' name='L19635'></a> 19635               <a href='../S/2289.html#L7569' title='Defined at 7569 in src/xterm.c.'>x_clear_under_internal_border</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L19636' name='L19636'></a> 19636 <em class='sharp'>#endif</em>
<a id='L19637' name='L19637'></a> 19637             <em class='brace'>}</em>
<a id='L19638' name='L19638'></a> 19638 <em class='sharp'>#ifndef</em> USE_TOOLKIT_SCROLL_BARS
<a id='L19639' name='L19639'></a> 19639           <strong class='reserved'>else</strong>
<a id='L19640' name='L19640'></a> 19640             x_scroll_bar_handle_exposure (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, (XEvent *) event);
<a id='L19641' name='L19641'></a> 19641 <em class='sharp'>#endif</em>
<a id='L19642' name='L19642'></a> 19642 
<a id='L19643' name='L19643'></a> 19643 <em class='sharp'>#ifdef</em> HAVE_XDBE
<a id='L19644' name='L19644'></a> 19644           <strong class='reserved'>if</strong> (!<a href='../S/2183.html#L1179' title='Defined at 1179 in src/frame.h.'>FRAME_GARBAGED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L19645' name='L19645'></a> 19645             <a href='../D/17419.html' title='Multiple defined in 2 places.'>show_back_buffer</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L19646' name='L19646'></a> 19646 <em class='sharp'>#endif</em>
<a id='L19647' name='L19647'></a> 19647         <em class='brace'>}</em>
<a id='L19648' name='L19648'></a> 19648       <strong class='reserved'>else</strong>
<a id='L19649' name='L19649'></a> 19649         <em class='brace'>{</em>
<a id='L19650' name='L19650'></a> 19650 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> USE_LUCID
<a id='L19651' name='L19651'></a> 19651           <em class='comment'>/* Submenus of the Lucid menu bar aren't widgets</em>
<a id='L19652' name='L19652'></a> 19652 <em class='comment'>             themselves, so there's no way to dispatch events</em>
<a id='L19653' name='L19653'></a> 19653 <em class='comment'>             to them.  Recognize this case separately.  */</em>
<a id='L19654' name='L19654'></a> 19654           <em class='brace'>{</em>
<a id='L19655' name='L19655'></a> 19655             Widget widget = x_window_to_menu_bar (event-&gt;xexpose.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L19656' name='L19656'></a> 19656             <strong class='reserved'>if</strong> (widget)
<a id='L19657' name='L19657'></a> 19657               <a href='../S/2069.html#L2250' title='Defined at 2250 in lwlib/xlwmenu.c.'>xlwmenu_redisplay</a> (widget);
<a id='L19658' name='L19658'></a> 19658           <em class='brace'>}</em>
<a id='L19659' name='L19659'></a> 19659 <em class='sharp'>#endif</em> <em class='comment'>/* USE_LUCID */</em>
<a id='L19660' name='L19660'></a> 19660 
<a id='L19661' name='L19661'></a> 19661           <em class='comment'>/* Dispatch event to the widget.  */</em>
<a id='L19662' name='L19662'></a> 19662           <strong class='reserved'>goto</strong> OTHER;
<a id='L19663' name='L19663'></a> 19663         <em class='brace'>}</em>
<a id='L19664' name='L19664'></a> 19664       <strong class='reserved'>break</strong>;
<a id='L19665' name='L19665'></a> 19665 
<a id='L19666' name='L19666'></a> 19666     <strong class='reserved'>case</strong> GraphicsExpose:        <em class='comment'>/* This occurs when an XCopyArea's</em>
<a id='L19667' name='L19667'></a> 19667 <em class='comment'>                                   source area was obscured or not</em>
<a id='L19668' name='L19668'></a> 19668 <em class='comment'>                                   available.  */</em>
<a id='L19669' name='L19669'></a> 19669       <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2289.html#L11957' title='Defined at 11957 in src/xterm.c.'>x_window_to_frame</a> (dpyinfo, event-&gt;xgraphicsexpose.drawable);
<a id='L19670' name='L19670'></a> 19670       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L19671' name='L19671'></a> 19671         <em class='brace'>{</em>
<a id='L19672' name='L19672'></a> 19672           <a href='../S/2224.html#L36467' title='Defined at 36467 in src/xdisp.c.'>expose_frame</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, event-&gt;xgraphicsexpose.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>,
<a id='L19673' name='L19673'></a> 19673                         event-&gt;xgraphicsexpose.y,
<a id='L19674' name='L19674'></a> 19674                         event-&gt;xgraphicsexpose.width,
<a id='L19675' name='L19675'></a> 19675                         event-&gt;xgraphicsexpose.height);
<a id='L19676' name='L19676'></a> 19676 <em class='sharp'>#ifndef</em> USE_TOOLKIT_SCROLL_BARS
<a id='L19677' name='L19677'></a> 19677           x_scroll_bar_handle_exposure (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, (XEvent *) event);
<a id='L19678' name='L19678'></a> 19678 <em class='sharp'>#endif</em>
<a id='L19679' name='L19679'></a> 19679 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L19680' name='L19680'></a> 19680           <a href='../S/2289.html#L7569' title='Defined at 7569 in src/xterm.c.'>x_clear_under_internal_border</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L19681' name='L19681'></a> 19681 <em class='sharp'>#endif</em>
<a id='L19682' name='L19682'></a> 19682 <em class='sharp'>#ifdef</em> HAVE_XDBE
<a id='L19683' name='L19683'></a> 19683           <a href='../D/17419.html' title='Multiple defined in 2 places.'>show_back_buffer</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L19684' name='L19684'></a> 19684 <em class='sharp'>#endif</em>
<a id='L19685' name='L19685'></a> 19685         <em class='brace'>}</em>
<a id='L19686' name='L19686'></a> 19686 <em class='sharp'>#ifdef</em> USE_X_TOOLKIT
<a id='L19687' name='L19687'></a> 19687       <strong class='reserved'>else</strong>
<a id='L19688' name='L19688'></a> 19688         <strong class='reserved'>goto</strong> OTHER;
<a id='L19689' name='L19689'></a> 19689 <em class='sharp'>#endif</em> <em class='comment'>/* USE_X_TOOLKIT */</em>
<a id='L19690' name='L19690'></a> 19690       <strong class='reserved'>break</strong>;
<a id='L19691' name='L19691'></a> 19691 
<a id='L19692' name='L19692'></a> 19692     <strong class='reserved'>case</strong> NoExpose:              <em class='comment'>/* This occurs when an XCopyArea's</em>
<a id='L19693' name='L19693'></a> 19693 <em class='comment'>                                   source area was completely</em>
<a id='L19694' name='L19694'></a> 19694 <em class='comment'>                                   available.  */</em>
<a id='L19695' name='L19695'></a> 19695 <em class='sharp'>#ifdef</em> USE_X_TOOLKIT
<a id='L19696' name='L19696'></a> 19696       *finish = <a href='../S/2289.html#L1136' title='Defined at 1136 in src/xterm.c.'>X_EVENT_DROP</a>;
<a id='L19697' name='L19697'></a> 19697 <em class='sharp'>#endif</em>
<a id='L19698' name='L19698'></a> 19698       <strong class='reserved'>break</strong>;
<a id='L19699' name='L19699'></a> 19699 
<a id='L19700' name='L19700'></a> 19700     <strong class='reserved'>case</strong> UnmapNotify:
<a id='L19701' name='L19701'></a> 19701       <strong class='reserved'>if</strong> (x_dnd_in_progress &amp;&amp; x_dnd_use_toplevels
<a id='L19702' name='L19702'></a> 19702           &amp;&amp; dpyinfo == <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (x_dnd_frame))
<a id='L19703' name='L19703'></a> 19703         <em class='brace'>{</em>
<a id='L19704' name='L19704'></a> 19704           <strong class='reserved'>for</strong> (<strong class='reserved'>struct</strong> <a href='../S/2289.html#L1484' title='Defined at 1484 in src/xterm.c.'>x_client_list_window</a> *tem = x_dnd_toplevels; tem;
<a id='L19705' name='L19705'></a> 19705                tem = tem-&gt;next)
<a id='L19706' name='L19706'></a> 19706             <em class='brace'>{</em>
<a id='L19707' name='L19707'></a> 19707               <strong class='reserved'>if</strong> (tem-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> == event-&gt;xunmap.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>)
<a id='L19708' name='L19708'></a> 19708                 <em class='brace'>{</em>
<a id='L19709' name='L19709'></a> 19709                   tem-&gt;mapped_p = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L19710' name='L19710'></a> 19710                   <strong class='reserved'>break</strong>;
<a id='L19711' name='L19711'></a> 19711                 <em class='brace'>}</em>
<a id='L19712' name='L19712'></a> 19712             <em class='brace'>}</em>
<a id='L19713' name='L19713'></a> 19713         <em class='brace'>}</em>
<a id='L19714' name='L19714'></a> 19714 
<a id='L19715' name='L19715'></a> 19715       <em class='comment'>/* Redo the mouse-highlight after the tooltip has gone.  */</em>
<a id='L19716' name='L19716'></a> 19716       <strong class='reserved'>if</strong> (event-&gt;xunmap.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> == tip_window)
<a id='L19717' name='L19717'></a> 19717         <em class='brace'>{</em>
<a id='L19718' name='L19718'></a> 19718           tip_window = None;
<a id='L19719' name='L19719'></a> 19719           <a href='../S/2247.html#L5239' title='Defined at 5239 in src/frame.c.'>gui_redo_mouse_highlight</a> (dpyinfo);
<a id='L19720' name='L19720'></a> 19720         <em class='brace'>}</em>
<a id='L19721' name='L19721'></a> 19721 
<a id='L19722' name='L19722'></a> 19722       <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../D/19730.html' title='Multiple defined in 2 places.'>x_top_window_to_frame</a> (dpyinfo, event-&gt;xunmap.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L19723' name='L19723'></a> 19723       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)            <em class='comment'>/* F may no longer exist if</em>
<a id='L19724' name='L19724'></a> 19724 <em class='comment'>                           the frame was deleted.  */</em>
<a id='L19725' name='L19725'></a> 19725         <em class='brace'>{</em>
<a id='L19726' name='L19726'></a> 19726           <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> visible = <a href='../S/2183.html#L1152' title='Defined at 1152 in src/frame.h.'>FRAME_VISIBLE_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L19727' name='L19727'></a> 19727 
<a id='L19728' name='L19728'></a> 19728 <em class='sharp'>#ifdef</em> USE_LUCID
<a id='L19729' name='L19729'></a> 19729           <em class='comment'>/* Bloodcurdling hack alert: The Lucid menu bar widget's</em>
<a id='L19730' name='L19730'></a> 19730 <em class='comment'>             redisplay procedure is not called when a tip frame over</em>
<a id='L19731' name='L19731'></a> 19731 <em class='comment'>             menu items is unmapped.  Redisplay the menu manually...  */</em>
<a id='L19732' name='L19732'></a> 19732           <strong class='reserved'>if</strong> (<a href='../D/2425.html' title='Multiple defined in 2 places.'>FRAME_TOOLTIP_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) &amp;&amp; <a href='../D/15672.html' title='Multiple defined in 5 places.'>popup_activated</a> ())
<a id='L19733' name='L19733'></a> 19733             <em class='brace'>{</em>
<a id='L19734' name='L19734'></a> 19734               Widget w;
<a id='L19735' name='L19735'></a> 19735               <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>;
<a id='L19736' name='L19736'></a> 19736               <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a>;
<a id='L19737' name='L19737'></a> 19737 
<a id='L19738' name='L19738'></a> 19738               <a href='../S/2183.html#L1405' title='Defined at 1405 in src/frame.h.'>FOR_EACH_FRAME</a> (<a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)
<a id='L19739' name='L19739'></a> 19739                 <em class='brace'>{</em>
<a id='L19740' name='L19740'></a> 19740                   <strong class='reserved'>if</strong> (!<a href='../S/2183.html#L919' title='Defined at 919 in src/frame.h.'>FRAME_X_P</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)))
<a id='L19741' name='L19741'></a> 19741                     <strong class='reserved'>continue</strong>;
<a id='L19742' name='L19742'></a> 19742 
<a id='L19743' name='L19743'></a> 19743                   <a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>);
<a id='L19744' name='L19744'></a> 19744 
<a id='L19745' name='L19745'></a> 19745                   <strong class='reserved'>if</strong> (<a href='../S/2183.html#L1028' title='Defined at 1028 in src/frame.h.'>FRAME_LIVE_P</a> (<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a>))
<a id='L19746' name='L19746'></a> 19746                     <em class='brace'>{</em>
<a id='L19747' name='L19747'></a> 19747                       w = <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a>)-&gt;menubar_widget;
<a id='L19748' name='L19748'></a> 19748 
<a id='L19749' name='L19749'></a> 19749                       <strong class='reserved'>if</strong> (w &amp;&amp; !DoesSaveUnders (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../S/4039.html#L73' title='Defined at 73 in test/manual/etags/c-src/c.c.'>f1</a>)-&gt;screen))
<a id='L19750' name='L19750'></a> 19750                         <a href='../S/2069.html#L2250' title='Defined at 2250 in lwlib/xlwmenu.c.'>xlwmenu_redisplay</a> (w);
<a id='L19751' name='L19751'></a> 19751                     <em class='brace'>}</em>
<a id='L19752' name='L19752'></a> 19752                 <em class='brace'>}</em>
<a id='L19753' name='L19753'></a> 19753             <em class='brace'>}</em>
<a id='L19754' name='L19754'></a> 19754 <em class='sharp'>#endif</em> <em class='comment'>/* USE_LUCID */</em>
<a id='L19755' name='L19755'></a> 19755 
<a id='L19756' name='L19756'></a> 19756           <em class='comment'>/* While a frame is unmapped, display generation is</em>
<a id='L19757' name='L19757'></a> 19757 <em class='comment'>             disabled; you don't want to spend time updating a</em>
<a id='L19758' name='L19758'></a> 19758 <em class='comment'>             display that won't ever be seen.  */</em>
<a id='L19759' name='L19759'></a> 19759           <a href='../S/2183.html#L1437' title='Defined at 1437 in src/frame.h.'>SET_FRAME_VISIBLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 0);
<a id='L19760' name='L19760'></a> 19760           <em class='comment'>/* We can't distinguish, from the event, whether the window</em>
<a id='L19761' name='L19761'></a> 19761 <em class='comment'>             has become iconified or invisible.  So assume, if it</em>
<a id='L19762' name='L19762'></a> 19762 <em class='comment'>             was previously visible, than now it is iconified.</em>
<a id='L19763' name='L19763'></a> 19763 <em class='comment'>             But x_make_frame_invisible clears both</em>
<a id='L19764' name='L19764'></a> 19764 <em class='comment'>             the visible flag and the iconified flag;</em>
<a id='L19765' name='L19765'></a> 19765 <em class='comment'>             and that way, we know the window is not iconified now.  */</em>
<a id='L19766' name='L19766'></a> 19766           <strong class='reserved'>if</strong> (visible || <a href='../S/2183.html#L1172' title='Defined at 1172 in src/frame.h.'>FRAME_ICONIFIED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L19767' name='L19767'></a> 19767             <em class='brace'>{</em>
<a id='L19768' name='L19768'></a> 19768               <strong class='reserved'>if</strong> (<a href='../D/1228.html' title='Multiple defined in 2 places.'>CONSP</a> (frame_size_history))
<a id='L19769' name='L19769'></a> 19769                 <a href='../S/2247.html#L554' title='Defined at 554 in src/frame.c.'>frame_size_history_plain</a>
<a id='L19770' name='L19770'></a> 19770                   (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9420.html' title='Multiple defined in 2 places.'>build_string</a> ("UnmapNotify, visible | iconified"));
<a id='L19771' name='L19771'></a> 19771 
<a id='L19772' name='L19772'></a> 19772               <a href='../S/2183.html#L1452' title='Defined at 1452 in src/frame.h.'>SET_FRAME_ICONIFIED</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L19773' name='L19773'></a> 19773               inev.ie.kind = <a href='../S/2231.html#L196' title='Defined at 196 in src/termhooks.h.'>ICONIFY_EVENT</a>;
<a id='L19774' name='L19774'></a> 19774               <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (inev.ie.frame_or_window, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L19775' name='L19775'></a> 19775             <em class='brace'>}</em>
<a id='L19776' name='L19776'></a> 19776           <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (<a href='../D/1228.html' title='Multiple defined in 2 places.'>CONSP</a> (frame_size_history))
<a id='L19777' name='L19777'></a> 19777             <a href='../S/2247.html#L554' title='Defined at 554 in src/frame.c.'>frame_size_history_plain</a>
<a id='L19778' name='L19778'></a> 19778               (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9420.html' title='Multiple defined in 2 places.'>build_string</a> ("UnmapNotify, not visible &amp; not iconified"));
<a id='L19779' name='L19779'></a> 19779         <em class='brace'>}</em>
<a id='L19780' name='L19780'></a> 19780       <strong class='reserved'>goto</strong> OTHER;
<a id='L19781' name='L19781'></a> 19781 
<a id='L19782' name='L19782'></a> 19782     <strong class='reserved'>case</strong> MapNotify:
<a id='L19783' name='L19783'></a> 19783 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XINPUT2 &amp;&amp; <strong class='reserved'>defined</strong> HAVE_GTK3
<a id='L19784' name='L19784'></a> 19784       <strong class='reserved'>if</strong> (<a href='../S/2362.html#L1034' title='Defined at 1034 in src/gtkutil.c.'>xg_is_menu_window</a> (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, event-&gt;xmap.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>))
<a id='L19785' name='L19785'></a> 19785         popup_activated_flag = 1;
<a id='L19786' name='L19786'></a> 19786 <em class='sharp'>#endif</em>
<a id='L19787' name='L19787'></a> 19787 
<a id='L19788' name='L19788'></a> 19788       <strong class='reserved'>if</strong> (x_dnd_in_progress
<a id='L19789' name='L19789'></a> 19789           <em class='comment'>/* When _NET_WM_CLIENT_LIST stacking is being used, changes</em>
<a id='L19790' name='L19790'></a> 19790 <em class='comment'>             in that property are watched for, and it's not necessary</em>
<a id='L19791' name='L19791'></a> 19791 <em class='comment'>             to update the state in response to ordinary window</em>
<a id='L19792' name='L19792'></a> 19792 <em class='comment'>             substructure events.  */</em>
<a id='L19793' name='L19793'></a> 19793           &amp;&amp; !x_dnd_use_toplevels
<a id='L19794' name='L19794'></a> 19794           &amp;&amp; dpyinfo == <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (x_dnd_frame))
<a id='L19795' name='L19795'></a> 19795         x_dnd_update_state (dpyinfo, dpyinfo-&gt;last_user_time);
<a id='L19796' name='L19796'></a> 19796 
<a id='L19797' name='L19797'></a> 19797       <strong class='reserved'>if</strong> (x_dnd_in_progress &amp;&amp; x_dnd_use_toplevels
<a id='L19798' name='L19798'></a> 19798           &amp;&amp; dpyinfo == <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (x_dnd_frame))
<a id='L19799' name='L19799'></a> 19799         <em class='brace'>{</em>
<a id='L19800' name='L19800'></a> 19800           <strong class='reserved'>for</strong> (<strong class='reserved'>struct</strong> <a href='../S/2289.html#L1484' title='Defined at 1484 in src/xterm.c.'>x_client_list_window</a> *tem = x_dnd_toplevels; tem;
<a id='L19801' name='L19801'></a> 19801                tem = tem-&gt;next)
<a id='L19802' name='L19802'></a> 19802             <em class='brace'>{</em>
<a id='L19803' name='L19803'></a> 19803               <strong class='reserved'>if</strong> (tem-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> == event-&gt;xmap.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>)
<a id='L19804' name='L19804'></a> 19804                 <em class='brace'>{</em>
<a id='L19805' name='L19805'></a> 19805                   tem-&gt;mapped_p = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L19806' name='L19806'></a> 19806                   <strong class='reserved'>break</strong>;
<a id='L19807' name='L19807'></a> 19807                 <em class='brace'>}</em>
<a id='L19808' name='L19808'></a> 19808             <em class='brace'>}</em>
<a id='L19809' name='L19809'></a> 19809         <em class='brace'>}</em>
<a id='L19810' name='L19810'></a> 19810 
<a id='L19811' name='L19811'></a> 19811       <em class='comment'>/* We use x_top_window_to_frame because map events can</em>
<a id='L19812' name='L19812'></a> 19812 <em class='comment'>         come for sub-windows and they don't mean that the</em>
<a id='L19813' name='L19813'></a> 19813 <em class='comment'>         frame is visible.  */</em>
<a id='L19814' name='L19814'></a> 19814       <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../D/19730.html' title='Multiple defined in 2 places.'>x_top_window_to_frame</a> (dpyinfo, event-&gt;xmap.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L19815' name='L19815'></a> 19815       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L19816' name='L19816'></a> 19816         <em class='brace'>{</em>
<a id='L19817' name='L19817'></a> 19817           <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> iconified = <a href='../S/2183.html#L1172' title='Defined at 1172 in src/frame.h.'>FRAME_ICONIFIED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L19818' name='L19818'></a> 19818           <strong class='reserved'>int</strong> <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>;
<a id='L19819' name='L19819'></a> 19819           <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> sticky, shaded;
<a id='L19820' name='L19820'></a> 19820           <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> not_hidden = x_get_current_wm_state (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, event-&gt;xmap.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, &amp;<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>, &amp;sticky,
<a id='L19821' name='L19821'></a> 19821                                                     &amp;shaded);
<a id='L19822' name='L19822'></a> 19822 
<a id='L19823' name='L19823'></a> 19823           <strong class='reserved'>if</strong> (<a href='../D/1228.html' title='Multiple defined in 2 places.'>CONSP</a> (frame_size_history))
<a id='L19824' name='L19824'></a> 19824             <a href='../S/2247.html#L570' title='Defined at 570 in src/frame.c.'>frame_size_history_extra</a>
<a id='L19825' name='L19825'></a> 19825               (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>,
<a id='L19826' name='L19826'></a> 19826                iconified
<a id='L19827' name='L19827'></a> 19827                ? (not_hidden
<a id='L19828' name='L19828'></a> 19828                   ? <a href='../D/9420.html' title='Multiple defined in 2 places.'>build_string</a> ("MapNotify, not hidden &amp; iconified")
<a id='L19829' name='L19829'></a> 19829                   : <a href='../D/9420.html' title='Multiple defined in 2 places.'>build_string</a> ("MapNotify, hidden &amp; iconified"))
<a id='L19830' name='L19830'></a> 19830                : (not_hidden
<a id='L19831' name='L19831'></a> 19831                   ? <a href='../D/9420.html' title='Multiple defined in 2 places.'>build_string</a> ("MapNotify, not hidden &amp; not iconified")
<a id='L19832' name='L19832'></a> 19832                   : <a href='../D/9420.html' title='Multiple defined in 2 places.'>build_string</a> ("MapNotify, hidden &amp; not iconified")),
<a id='L19833' name='L19833'></a> 19833                <a href='../S/2183.html#L1051' title='Defined at 1051 in src/frame.h.'>FRAME_PIXEL_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../S/2183.html#L1052' title='Defined at 1052 in src/frame.h.'>FRAME_PIXEL_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L19834' name='L19834'></a> 19834                -1, -1, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;new_width, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;new_height);
<a id='L19835' name='L19835'></a> 19835 
<a id='L19836' name='L19836'></a> 19836           <em class='comment'>/* Check if fullscreen was specified before we where mapped the</em>
<a id='L19837' name='L19837'></a> 19837 <em class='comment'>             first time, i.e. from the command line.  */</em>
<a id='L19838' name='L19838'></a> 19838           <strong class='reserved'>if</strong> (!<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;has_been_visible)
<a id='L19839' name='L19839'></a> 19839             <em class='brace'>{</em>
<a id='L19840' name='L19840'></a> 19840 
<a id='L19841' name='L19841'></a> 19841               x_check_fullscreen (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L19842' name='L19842'></a> 19842 <em class='sharp'>#ifndef</em> USE_GTK
<a id='L19843' name='L19843'></a> 19843               <em class='comment'>/* For systems that cannot synthesize `skip_taskbar' for</em>
<a id='L19844' name='L19844'></a> 19844 <em class='comment'>                 unmapped windows do the following.  */</em>
<a id='L19845' name='L19845'></a> 19845               <strong class='reserved'>if</strong> (<a href='../D/2405.html' title='Multiple defined in 2 places.'>FRAME_SKIP_TASKBAR</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L19846' name='L19846'></a> 19846                 x_set_skip_taskbar (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, Qt, Qnil);
<a id='L19847' name='L19847'></a> 19847 <em class='sharp'>#endif</em> <em class='comment'>/* Not USE_GTK */</em>
<a id='L19848' name='L19848'></a> 19848             <em class='brace'>}</em>
<a id='L19849' name='L19849'></a> 19849 
<a id='L19850' name='L19850'></a> 19850           <strong class='reserved'>if</strong> (!iconified)
<a id='L19851' name='L19851'></a> 19851             <em class='brace'>{</em>
<a id='L19852' name='L19852'></a> 19852               <em class='comment'>/* The `z-group' is reset every time a frame becomes</em>
<a id='L19853' name='L19853'></a> 19853 <em class='comment'>                 invisible.  Handle this here.  */</em>
<a id='L19854' name='L19854'></a> 19854               <strong class='reserved'>if</strong> (<a href='../D/2481.html' title='Multiple defined in 2 places.'>FRAME_Z_GROUP</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) == <a href='../S/2183.html#L51' title='Defined at 51 in src/frame.h.'>z_group_above</a>)
<a id='L19855' name='L19855'></a> 19855                 x_set_z_group (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, Qabove, Qnil);
<a id='L19856' name='L19856'></a> 19856               <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (<a href='../D/2481.html' title='Multiple defined in 2 places.'>FRAME_Z_GROUP</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) == <a href='../S/2183.html#L52' title='Defined at 52 in src/frame.h.'>z_group_below</a>)
<a id='L19857' name='L19857'></a> 19857                 x_set_z_group (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, Qbelow, Qnil);
<a id='L19858' name='L19858'></a> 19858             <em class='brace'>}</em>
<a id='L19859' name='L19859'></a> 19859 
<a id='L19860' name='L19860'></a> 19860           <em class='comment'>/* Embedded frames might have NET_WM_STATE left over, but</em>
<a id='L19861' name='L19861'></a> 19861 <em class='comment'>             are always visible once mapped.  */</em>
<a id='L19862' name='L19862'></a> 19862           <strong class='reserved'>if</strong> (not_hidden || <a href='../S/2212.html#L1979' title='Defined at 1979 in src/xterm.h.'>FRAME_X_EMBEDDED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L19863' name='L19863'></a> 19863             <em class='brace'>{</em>
<a id='L19864' name='L19864'></a> 19864               <a href='../S/2183.html#L1437' title='Defined at 1437 in src/frame.h.'>SET_FRAME_VISIBLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 1);
<a id='L19865' name='L19865'></a> 19865               <a href='../S/2183.html#L1452' title='Defined at 1452 in src/frame.h.'>SET_FRAME_ICONIFIED</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L19866' name='L19866'></a> 19866 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> USE_GTK &amp;&amp; <strong class='reserved'>defined</strong> HAVE_GTK3
<a id='L19867' name='L19867'></a> 19867               <em class='comment'>/* If GTK3 wants to impose some old size here (Bug#24526),</em>
<a id='L19868' name='L19868'></a> 19868 <em class='comment'>                 tell it that the current size is what we want.  */</em>
<a id='L19869' name='L19869'></a> 19869               <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;was_invisible)
<a id='L19870' name='L19870'></a> 19870                 <em class='brace'>{</em>
<a id='L19871' name='L19871'></a> 19871                   <a href='../S/2362.html#L1168' title='Defined at 1168 in src/gtkutil.c.'>xg_frame_set_char_size</a>
<a id='L19872' name='L19872'></a> 19872                     (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/2183.html#L1051' title='Defined at 1051 in src/frame.h.'>FRAME_PIXEL_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../S/2183.html#L1052' title='Defined at 1052 in src/frame.h.'>FRAME_PIXEL_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L19873' name='L19873'></a> 19873                   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;was_invisible = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L19874' name='L19874'></a> 19874                 <em class='brace'>}</em>
<a id='L19875' name='L19875'></a> 19875 <em class='sharp'>#endif</em>
<a id='L19876' name='L19876'></a> 19876               <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;has_been_visible = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L19877' name='L19877'></a> 19877             <em class='brace'>}</em>
<a id='L19878' name='L19878'></a> 19878 
<a id='L19879' name='L19879'></a> 19879           <a href='../S/2289.html#L5198' title='Defined at 5198 in src/xterm.c.'>x_update_opaque_region</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L19880' name='L19880'></a> 19880 
<a id='L19881' name='L19881'></a> 19881           <strong class='reserved'>if</strong> ((not_hidden || <a href='../S/2212.html#L1979' title='Defined at 1979 in src/xterm.h.'>FRAME_X_EMBEDDED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)) &amp;&amp; iconified)
<a id='L19882' name='L19882'></a> 19882             <em class='brace'>{</em>
<a id='L19883' name='L19883'></a> 19883               inev.ie.kind = <a href='../S/2231.html#L197' title='Defined at 197 in src/termhooks.h.'>DEICONIFY_EVENT</a>;
<a id='L19884' name='L19884'></a> 19884               <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (inev.ie.frame_or_window, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L19885' name='L19885'></a> 19885             <em class='brace'>}</em>
<a id='L19886' name='L19886'></a> 19886         <em class='brace'>}</em>
<a id='L19887' name='L19887'></a> 19887       <strong class='reserved'>goto</strong> OTHER;
<a id='L19888' name='L19888'></a> 19888 
<a id='L19889' name='L19889'></a> 19889     <strong class='reserved'>case</strong> KeyPress:
<a id='L19890' name='L19890'></a> 19890       <a href='../S/2289.html#L7929' title='Defined at 7929 in src/xterm.c.'>x_display_set_last_user_time</a> (dpyinfo, event-&gt;xkey.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>,
<a id='L19891' name='L19891'></a> 19891                                     event-&gt;xkey.send_event,
<a id='L19892' name='L19892'></a> 19892                                     <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L19893' name='L19893'></a> 19893       ignore_next_mouse_click_timeout = 0;
<a id='L19894' name='L19894'></a> 19894 
<a id='L19895' name='L19895'></a> 19895       coding = Qlatin_1;
<a id='L19896' name='L19896'></a> 19896 
<a id='L19897' name='L19897'></a> 19897 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> (USE_X_TOOLKIT) || <strong class='reserved'>defined</strong> (USE_GTK)
<a id='L19898' name='L19898'></a> 19898       <em class='comment'>/* Dispatch KeyPress events when in menu.  */</em>
<a id='L19899' name='L19899'></a> 19899       <strong class='reserved'>if</strong> (<a href='../D/15672.html' title='Multiple defined in 5 places.'>popup_activated</a> ())
<a id='L19900' name='L19900'></a> 19900         <strong class='reserved'>goto</strong> OTHER;
<a id='L19901' name='L19901'></a> 19901 <em class='sharp'>#endif</em>
<a id='L19902' name='L19902'></a> 19902 
<a id='L19903' name='L19903'></a> 19903       <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = any;
<a id='L19904' name='L19904'></a> 19904 
<a id='L19905' name='L19905'></a> 19905 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L19906' name='L19906'></a> 19906       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L19907' name='L19907'></a> 19907         <a href='../S/2289.html#L8023' title='Defined at 8023 in src/xterm.c.'>x_set_gtk_user_time</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, event-&gt;xkey.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>);
<a id='L19908' name='L19908'></a> 19908 <em class='sharp'>#endif</em>
<a id='L19909' name='L19909'></a> 19909 
<a id='L19910' name='L19910'></a> 19910       <em class='comment'>/* If mouse-highlight is an integer, input clears out</em>
<a id='L19911' name='L19911'></a> 19911 <em class='comment'>         mouse highlighting.  */</em>
<a id='L19912' name='L19912'></a> 19912       <strong class='reserved'>if</strong> (!hlinfo-&gt;mouse_face_hidden &amp;&amp; <a href='../S/2267.html#L469' title='Defined at 469 in src/lisp.h.'>FIXNUMP</a> (Vmouse_highlight)
<a id='L19913' name='L19913'></a> 19913           &amp;&amp; (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> == 0
<a id='L19914' name='L19914'></a> 19914 <em class='sharp'>#if</em> ! <strong class='reserved'>defined</strong> (USE_GTK)
<a id='L19915' name='L19915'></a> 19915               || !<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;tool_bar_window, hlinfo-&gt;mouse_face_window)
<a id='L19916' name='L19916'></a> 19916 <em class='sharp'>#endif</em>
<a id='L19917' name='L19917'></a> 19917               || !<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;tab_bar_window, hlinfo-&gt;mouse_face_window))
<a id='L19918' name='L19918'></a> 19918           )
<a id='L19919' name='L19919'></a> 19919         <em class='brace'>{</em>
<a id='L19920' name='L19920'></a> 19920           mouse_frame = hlinfo-&gt;mouse_face_mouse_frame;
<a id='L19921' name='L19921'></a> 19921 
<a id='L19922' name='L19922'></a> 19922           <a href='../S/2224.html#L34014' title='Defined at 34014 in src/xdisp.c.'>clear_mouse_face</a> (hlinfo);
<a id='L19923' name='L19923'></a> 19923           hlinfo-&gt;mouse_face_hidden = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L19924' name='L19924'></a> 19924 
<a id='L19925' name='L19925'></a> 19925           <strong class='reserved'>if</strong> (mouse_frame)
<a id='L19926' name='L19926'></a> 19926             x_flush_dirty_back_buffer_on (mouse_frame);
<a id='L19927' name='L19927'></a> 19927         <em class='brace'>}</em>
<a id='L19928' name='L19928'></a> 19928 
<a id='L19929' name='L19929'></a> 19929 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> USE_MOTIF &amp;&amp; <strong class='reserved'>defined</strong> USE_TOOLKIT_SCROLL_BARS
<a id='L19930' name='L19930'></a> 19930       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> == 0)
<a id='L19931' name='L19931'></a> 19931         <em class='brace'>{</em>
<a id='L19932' name='L19932'></a> 19932           <em class='comment'>/* Scroll bars consume key events, but we want</em>
<a id='L19933' name='L19933'></a> 19933 <em class='comment'>             the keys to go to the scroll bar's frame.  */</em>
<a id='L19934' name='L19934'></a> 19934           Widget widget = XtWindowToWidget (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L19935' name='L19935'></a> 19935                                             event-&gt;xkey.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L19936' name='L19936'></a> 19936           <strong class='reserved'>if</strong> (widget &amp;&amp; XmIsScrollBar (widget))
<a id='L19937' name='L19937'></a> 19937             <em class='brace'>{</em>
<a id='L19938' name='L19938'></a> 19938               widget = XtParent (widget);
<a id='L19939' name='L19939'></a> 19939               <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../D/19416.html' title='Multiple defined in 2 places.'>x_any_window_to_frame</a> (dpyinfo, XtWindow (widget));
<a id='L19940' name='L19940'></a> 19940             <em class='brace'>}</em>
<a id='L19941' name='L19941'></a> 19941         <em class='brace'>}</em>
<a id='L19942' name='L19942'></a> 19942 <em class='sharp'>#endif</em> <em class='comment'>/* USE_MOTIF and USE_TOOLKIT_SCROLL_BARS */</em>
<a id='L19943' name='L19943'></a> 19943 
<a id='L19944' name='L19944'></a> 19944       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> != 0)
<a id='L19945' name='L19945'></a> 19945         <em class='brace'>{</em>
<a id='L19946' name='L19946'></a> 19946           KeySym keysym, orig_keysym;
<a id='L19947' name='L19947'></a> 19947           <em class='comment'>/* al%imercury@uunet.uu.net says that making this 81</em>
<a id='L19948' name='L19948'></a> 19948 <em class='comment'>             instead of 80 fixed a bug whereby meta chars made</em>
<a id='L19949' name='L19949'></a> 19949 <em class='comment'>             his Emacs hang.</em>
<a id='L19950' name='L19950'></a> 19950 <em class='comment'></em>
<a id='L19951' name='L19951'></a> 19951 <em class='comment'>             It seems that some version of XmbLookupString has</em>
<a id='L19952' name='L19952'></a> 19952 <em class='comment'>             a bug of not returning XBufferOverflow in</em>
<a id='L19953' name='L19953'></a> 19953 <em class='comment'>             status_return even if the input is too long to</em>
<a id='L19954' name='L19954'></a> 19954 <em class='comment'>             fit in 81 bytes.  So, we must prepare sufficient</em>
<a id='L19955' name='L19955'></a> 19955 <em class='comment'>             bytes for copy_buffer.  513 bytes (256 chars for</em>
<a id='L19956' name='L19956'></a> 19956 <em class='comment'>             two-byte character set) seems to be a fairly good</em>
<a id='L19957' name='L19957'></a> 19957 <em class='comment'>             approximation.  -- 2000.8.10 handa@gnu.org  */</em>
<a id='L19958' name='L19958'></a> 19958           <strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> <a href='../S/2097.html#L86' title='Defined at 86 in src/textconv.c.'>copy_buffer</a>[513];
<a id='L19959' name='L19959'></a> 19959           <strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *copy_bufptr = <a href='../S/2097.html#L86' title='Defined at 86 in src/textconv.c.'>copy_buffer</a>;
<a id='L19960' name='L19960'></a> 19960           <strong class='reserved'>int</strong> copy_bufsiz = <strong class='reserved'>sizeof</strong> (<a href='../S/2097.html#L86' title='Defined at 86 in src/textconv.c.'>copy_buffer</a>);
<a id='L19961' name='L19961'></a> 19961           <strong class='reserved'>int</strong> modifiers;
<a id='L19962' name='L19962'></a> 19962           <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../D/9440.html' title='Multiple defined in 2 places.'>c</a>;
<a id='L19963' name='L19963'></a> 19963           <em class='comment'>/* `xkey' will be modified, but it's not important to modify</em>
<a id='L19964' name='L19964'></a> 19964 <em class='comment'>             `event' itself.  */</em>
<a id='L19965' name='L19965'></a> 19965           XKeyEvent xkey = event-&gt;xkey;
<a id='L19966' name='L19966'></a> 19966 
<a id='L19967' name='L19967'></a> 19967           <strong class='reserved'>if</strong> (event-&gt;xkey.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> == <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L19968' name='L19968'></a> 19968             <em class='comment'>/* See the comment above x_compute_root_window_offset for</em>
<a id='L19969' name='L19969'></a> 19969 <em class='comment'>               why this optimization is performed.  */</em>
<a id='L19970' name='L19970'></a> 19970             x_compute_root_window_offset (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, event-&gt;xkey.x_root,
<a id='L19971' name='L19971'></a> 19971                                           event-&gt;xkey.y_root,
<a id='L19972' name='L19972'></a> 19972                                           event-&gt;xkey.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, event-&gt;xkey.y);
<a id='L19973' name='L19973'></a> 19973 
<a id='L19974' name='L19974'></a> 19974 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L19975' name='L19975'></a> 19975           <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a> pending_keystroke_time;
<a id='L19976' name='L19976'></a> 19976           <strong class='reserved'>struct</strong> <a href='../S/2212.html#L275' title='Defined at 275 in src/xterm.h.'>xi_device_t</a> *source;
<a id='L19977' name='L19977'></a> 19977 
<a id='L19978' name='L19978'></a> 19978           pending_keystroke_time = dpyinfo-&gt;pending_keystroke_time;
<a id='L19979' name='L19979'></a> 19979 
<a id='L19980' name='L19980'></a> 19980           <strong class='reserved'>if</strong> (event-&gt;xkey.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> &gt;= pending_keystroke_time)
<a id='L19981' name='L19981'></a> 19981             <em class='brace'>{</em>
<a id='L19982' name='L19982'></a> 19982 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> USE_GTK &amp;&amp; !<strong class='reserved'>defined</strong> HAVE_GTK3
<a id='L19983' name='L19983'></a> 19983               <strong class='reserved'>if</strong> (!dpyinfo-&gt;pending_keystroke_time_special_p)
<a id='L19984' name='L19984'></a> 19984 <em class='sharp'>#endif</em>
<a id='L19985' name='L19985'></a> 19985                 dpyinfo-&gt;pending_keystroke_time = 0;
<a id='L19986' name='L19986'></a> 19986 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> USE_GTK &amp;&amp; !<strong class='reserved'>defined</strong> HAVE_GTK3
<a id='L19987' name='L19987'></a> 19987               <strong class='reserved'>else</strong>
<a id='L19988' name='L19988'></a> 19988                 dpyinfo-&gt;pending_keystroke_time_special_p = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L19989' name='L19989'></a> 19989 <em class='sharp'>#endif</em>
<a id='L19990' name='L19990'></a> 19990             <em class='brace'>}</em>
<a id='L19991' name='L19991'></a> 19991 <em class='sharp'>#endif</em>
<a id='L19992' name='L19992'></a> 19992 
<a id='L19993' name='L19993'></a> 19993 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L19994' name='L19994'></a> 19994           <em class='comment'>/* Don't pass keys to GTK.  A Tab will shift focus to the</em>
<a id='L19995' name='L19995'></a> 19995 <em class='comment'>             tool bar in GTK 2.4.  Keys will still go to menus and</em>
<a id='L19996' name='L19996'></a> 19996 <em class='comment'>             dialogs because in that case popup_activated is nonzero</em>
<a id='L19997' name='L19997'></a> 19997 <em class='comment'>             (see above).  */</em>
<a id='L19998' name='L19998'></a> 19998           *finish = <a href='../S/2289.html#L1136' title='Defined at 1136 in src/xterm.c.'>X_EVENT_DROP</a>;
<a id='L19999' name='L19999'></a> 19999 <em class='sharp'>#endif</em>
<a id='L20000' name='L20000'></a> 20000 
<a id='L20001' name='L20001'></a> 20001           xkey.state |= x_emacs_to_x_modifiers (dpyinfo,
<a id='L20002' name='L20002'></a> 20002                                                 extra_keyboard_modifiers);
<a id='L20003' name='L20003'></a> 20003           modifiers = xkey.state;
<a id='L20004' name='L20004'></a> 20004 
<a id='L20005' name='L20005'></a> 20005           <em class='comment'>/* This will have to go some day...  */</em>
<a id='L20006' name='L20006'></a> 20006 
<a id='L20007' name='L20007'></a> 20007           <em class='comment'>/* make_lispy_event turns chars into control chars.</em>
<a id='L20008' name='L20008'></a> 20008 <em class='comment'>             Don't do it here because XLookupString is too eager.  */</em>
<a id='L20009' name='L20009'></a> 20009           xkey.state &amp;= ~ControlMask;
<a id='L20010' name='L20010'></a> 20010           xkey.state &amp;= ~(dpyinfo-&gt;meta_mod_mask
<a id='L20011' name='L20011'></a> 20011                           | dpyinfo-&gt;super_mod_mask
<a id='L20012' name='L20012'></a> 20012                           | dpyinfo-&gt;hyper_mod_mask
<a id='L20013' name='L20013'></a> 20013                           | dpyinfo-&gt;alt_mod_mask);
<a id='L20014' name='L20014'></a> 20014 
<a id='L20015' name='L20015'></a> 20015           <em class='comment'>/* In case Meta is ComposeCharacter,</em>
<a id='L20016' name='L20016'></a> 20016 <em class='comment'>             clear its status.  According to Markus Ehrnsperger</em>
<a id='L20017' name='L20017'></a> 20017 <em class='comment'>             Markus.Ehrnsperger@lehrstuhl-bross.physik.uni-muenchen.de</em>
<a id='L20018' name='L20018'></a> 20018 <em class='comment'>             this enables ComposeCharacter to work whether or</em>
<a id='L20019' name='L20019'></a> 20019 <em class='comment'>             not it is combined with Meta.  */</em>
<a id='L20020' name='L20020'></a> 20020           <strong class='reserved'>if</strong> (modifiers &amp; dpyinfo-&gt;meta_mod_mask)
<a id='L20021' name='L20021'></a> 20021             memset (&amp;compose_status, 0, <strong class='reserved'>sizeof</strong> (compose_status));
<a id='L20022' name='L20022'></a> 20022 
<a id='L20023' name='L20023'></a> 20023 <em class='sharp'>#ifdef</em> HAVE_X_I18N
<a id='L20024' name='L20024'></a> 20024           <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1470' title='Defined at 1470 in src/xterm.h.'>FRAME_XIC</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L20025' name='L20025'></a> 20025             <em class='brace'>{</em>
<a id='L20026' name='L20026'></a> 20026               Status status_return;
<a id='L20027' name='L20027'></a> 20027 
<a id='L20028' name='L20028'></a> 20028               nbytes = XmbLookupString (<a href='../S/2212.html#L1470' title='Defined at 1470 in src/xterm.h.'>FRAME_XIC</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L20029' name='L20029'></a> 20029                                         &amp;xkey, (<strong class='reserved'>char</strong> *) copy_bufptr,
<a id='L20030' name='L20030'></a> 20030                                         copy_bufsiz, &amp;keysym,
<a id='L20031' name='L20031'></a> 20031                                         &amp;status_return);
<a id='L20032' name='L20032'></a> 20032               coding = <a href='../S/2212.html#L1475' title='Defined at 1475 in src/xterm.h.'>FRAME_X_XIM_CODING</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L20033' name='L20033'></a> 20033               <strong class='reserved'>if</strong> (status_return == XBufferOverflow)
<a id='L20034' name='L20034'></a> 20034                 <em class='brace'>{</em>
<a id='L20035' name='L20035'></a> 20035                   copy_bufsiz = nbytes + 1;
<a id='L20036' name='L20036'></a> 20036                   copy_bufptr = <a href='../D/5389.html' title='Multiple defined in 2 places.'>SAFE_ALLOCA</a> (copy_bufsiz);
<a id='L20037' name='L20037'></a> 20037                   nbytes = XmbLookupString (<a href='../S/2212.html#L1470' title='Defined at 1470 in src/xterm.h.'>FRAME_XIC</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L20038' name='L20038'></a> 20038                                             &amp;xkey, (<strong class='reserved'>char</strong> *) copy_bufptr,
<a id='L20039' name='L20039'></a> 20039                                             copy_bufsiz, &amp;keysym,
<a id='L20040' name='L20040'></a> 20040                                             &amp;status_return);
<a id='L20041' name='L20041'></a> 20041                 <em class='brace'>}</em>
<a id='L20042' name='L20042'></a> 20042               <em class='comment'>/* Xutf8LookupString is a new but already deprecated interface.  -stef  */</em>
<a id='L20043' name='L20043'></a> 20043               <strong class='reserved'>if</strong> (status_return == XLookupNone)
<a id='L20044' name='L20044'></a> 20044                 <strong class='reserved'>break</strong>;
<a id='L20045' name='L20045'></a> 20045               <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (status_return == XLookupChars)
<a id='L20046' name='L20046'></a> 20046                 <em class='brace'>{</em>
<a id='L20047' name='L20047'></a> 20047                   keysym = NoSymbol;
<a id='L20048' name='L20048'></a> 20048                   modifiers = 0;
<a id='L20049' name='L20049'></a> 20049                 <em class='brace'>}</em>
<a id='L20050' name='L20050'></a> 20050               <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (status_return != XLookupKeySym
<a id='L20051' name='L20051'></a> 20051                        &amp;&amp; status_return != XLookupBoth)
<a id='L20052' name='L20052'></a> 20052                 <a href='../D/10893.html' title='Multiple defined in 6 places.'>emacs_abort</a> ();
<a id='L20053' name='L20053'></a> 20053             <em class='brace'>}</em>
<a id='L20054' name='L20054'></a> 20054           <strong class='reserved'>else</strong>
<a id='L20055' name='L20055'></a> 20055 <em class='sharp'>#endif</em>
<a id='L20056' name='L20056'></a> 20056             <em class='brace'>{</em>
<a id='L20057' name='L20057'></a> 20057 <em class='sharp'>#ifdef</em> HAVE_XKB
<a id='L20058' name='L20058'></a> 20058               <strong class='reserved'>int</strong> overflow;
<a id='L20059' name='L20059'></a> 20059               <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> consumed;
<a id='L20060' name='L20060'></a> 20060 
<a id='L20061' name='L20061'></a> 20061               <strong class='reserved'>if</strong> (dpyinfo-&gt;xkb_desc)
<a id='L20062' name='L20062'></a> 20062                 <em class='brace'>{</em>
<a id='L20063' name='L20063'></a> 20063                   <strong class='reserved'>if</strong> (!XkbTranslateKeyCode (dpyinfo-&gt;xkb_desc,
<a id='L20064' name='L20064'></a> 20064                                             xkey.keycode, xkey.state,
<a id='L20065' name='L20065'></a> 20065                                             &amp;consumed, &amp;keysym))
<a id='L20066' name='L20066'></a> 20066                     <strong class='reserved'>goto</strong> done_keysym;
<a id='L20067' name='L20067'></a> 20067 
<a id='L20068' name='L20068'></a> 20068                   overflow = 0;
<a id='L20069' name='L20069'></a> 20069 
<a id='L20070' name='L20070'></a> 20070                   nbytes = XkbTranslateKeySym (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, &amp;keysym,
<a id='L20071' name='L20071'></a> 20071                                                xkey.state &amp; ~consumed,
<a id='L20072' name='L20072'></a> 20072                                                (<strong class='reserved'>char</strong> *) copy_bufptr,
<a id='L20073' name='L20073'></a> 20073                                                copy_bufsiz, &amp;overflow);
<a id='L20074' name='L20074'></a> 20074 
<a id='L20075' name='L20075'></a> 20075                   <strong class='reserved'>if</strong> (overflow)
<a id='L20076' name='L20076'></a> 20076                     <em class='brace'>{</em>
<a id='L20077' name='L20077'></a> 20077                       copy_bufptr = <a href='../D/5389.html' title='Multiple defined in 2 places.'>SAFE_ALLOCA</a> ((copy_bufsiz += overflow)
<a id='L20078' name='L20078'></a> 20078                                                  * <strong class='reserved'>sizeof</strong> *copy_bufptr);
<a id='L20079' name='L20079'></a> 20079                       overflow = 0;
<a id='L20080' name='L20080'></a> 20080                       nbytes = XkbTranslateKeySym (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, &amp;keysym,
<a id='L20081' name='L20081'></a> 20081                                                    xkey.state &amp; ~consumed,
<a id='L20082' name='L20082'></a> 20082                                                    (<strong class='reserved'>char</strong> *) copy_bufptr,
<a id='L20083' name='L20083'></a> 20083                                                    copy_bufsiz, &amp;overflow);
<a id='L20084' name='L20084'></a> 20084 
<a id='L20085' name='L20085'></a> 20085                       <strong class='reserved'>if</strong> (overflow)
<a id='L20086' name='L20086'></a> 20086                         nbytes = 0;
<a id='L20087' name='L20087'></a> 20087                     <em class='brace'>}</em>
<a id='L20088' name='L20088'></a> 20088 
<a id='L20089' name='L20089'></a> 20089                   <strong class='reserved'>if</strong> (nbytes)
<a id='L20090' name='L20090'></a> 20090                     coding = Qnil;
<a id='L20091' name='L20091'></a> 20091                 <em class='brace'>}</em>
<a id='L20092' name='L20092'></a> 20092               <strong class='reserved'>else</strong>
<a id='L20093' name='L20093'></a> 20093 <em class='sharp'>#endif</em>
<a id='L20094' name='L20094'></a> 20094                 nbytes = XLookupString (&amp;xkey, (<strong class='reserved'>char</strong> *) copy_bufptr,
<a id='L20095' name='L20095'></a> 20095                                         copy_bufsiz, &amp;keysym,
<a id='L20096' name='L20096'></a> 20096                                         &amp;compose_status);
<a id='L20097' name='L20097'></a> 20097             <em class='brace'>}</em>
<a id='L20098' name='L20098'></a> 20098 
<a id='L20099' name='L20099'></a> 20099 <em class='sharp'>#ifdef</em> XK_F1
<a id='L20100' name='L20100'></a> 20100           <strong class='reserved'>if</strong> (x_dnd_in_progress &amp;&amp; keysym == XK_F1)
<a id='L20101' name='L20101'></a> 20101             <em class='brace'>{</em>
<a id='L20102' name='L20102'></a> 20102               x_dnd_xm_use_help = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L20103' name='L20103'></a> 20103               <strong class='reserved'>goto</strong> done_keysym;
<a id='L20104' name='L20104'></a> 20104             <em class='brace'>}</em>
<a id='L20105' name='L20105'></a> 20105 <em class='sharp'>#endif</em>
<a id='L20106' name='L20106'></a> 20106 
<a id='L20107' name='L20107'></a> 20107           <em class='comment'>/* See if keysym should make Emacs quit.  */</em>
<a id='L20108' name='L20108'></a> 20108 
<a id='L20109' name='L20109'></a> 20109           <strong class='reserved'>if</strong> (keysym == dpyinfo-&gt;quit_keysym
<a id='L20110' name='L20110'></a> 20110               &amp;&amp; (xkey.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> - dpyinfo-&gt;quit_keysym_time
<a id='L20111' name='L20111'></a> 20111                   &lt;= 350))
<a id='L20112' name='L20112'></a> 20112             <em class='brace'>{</em>
<a id='L20113' name='L20113'></a> 20113               Vquit_flag = Qt;
<a id='L20114' name='L20114'></a> 20114               <strong class='reserved'>goto</strong> done_keysym;
<a id='L20115' name='L20115'></a> 20115             <em class='brace'>}</em>
<a id='L20116' name='L20116'></a> 20116 
<a id='L20117' name='L20117'></a> 20117           <strong class='reserved'>if</strong> (keysym == dpyinfo-&gt;quit_keysym)
<a id='L20118' name='L20118'></a> 20118             <em class='brace'>{</em>
<a id='L20119' name='L20119'></a> 20119               <em class='comment'>/* Otherwise, set the last time that keysym was</em>
<a id='L20120' name='L20120'></a> 20120 <em class='comment'>                 pressed.  */</em>
<a id='L20121' name='L20121'></a> 20121               dpyinfo-&gt;quit_keysym_time = xkey.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L20122' name='L20122'></a> 20122               <strong class='reserved'>goto</strong> done_keysym;
<a id='L20123' name='L20123'></a> 20123             <em class='brace'>}</em>
<a id='L20124' name='L20124'></a> 20124 
<a id='L20125' name='L20125'></a> 20125           <em class='comment'>/* If not using XIM/XIC, and a compose sequence is in progress,</em>
<a id='L20126' name='L20126'></a> 20126 <em class='comment'>             we break here.  Otherwise, chars_matched is always 0.  */</em>
<a id='L20127' name='L20127'></a> 20127           <strong class='reserved'>if</strong> (compose_status.chars_matched &gt; 0 &amp;&amp; nbytes == 0)
<a id='L20128' name='L20128'></a> 20128             <strong class='reserved'>break</strong>;
<a id='L20129' name='L20129'></a> 20129 
<a id='L20130' name='L20130'></a> 20130           memset (&amp;compose_status, 0, <strong class='reserved'>sizeof</strong> (compose_status));
<a id='L20131' name='L20131'></a> 20131           orig_keysym = keysym;
<a id='L20132' name='L20132'></a> 20132 
<a id='L20133' name='L20133'></a> 20133           <em class='comment'>/* Common for all keysym input events.  */</em>
<a id='L20134' name='L20134'></a> 20134           <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (inev.ie.frame_or_window, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L20135' name='L20135'></a> 20135           inev.ie.modifiers
<a id='L20136' name='L20136'></a> 20136             = x_x_to_emacs_modifiers (dpyinfo, modifiers);
<a id='L20137' name='L20137'></a> 20137           inev.ie.timestamp = xkey.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L20138' name='L20138'></a> 20138 
<a id='L20139' name='L20139'></a> 20139           <em class='comment'>/* First deal with keysyms which have defined</em>
<a id='L20140' name='L20140'></a> 20140 <em class='comment'>             translations to characters.  */</em>
<a id='L20141' name='L20141'></a> 20141           <strong class='reserved'>if</strong> (keysym &gt;= 32 &amp;&amp; keysym &lt; 128)
<a id='L20142' name='L20142'></a> 20142             <em class='comment'>/* Avoid explicitly decoding each ASCII character.  */</em>
<a id='L20143' name='L20143'></a> 20143             <em class='brace'>{</em>
<a id='L20144' name='L20144'></a> 20144               inev.ie.kind = <a href='../S/2231.html#L77' title='Defined at 77 in src/termhooks.h.'>ASCII_KEYSTROKE_EVENT</a>;
<a id='L20145' name='L20145'></a> 20145               inev.ie.code = keysym;
<a id='L20146' name='L20146'></a> 20146 
<a id='L20147' name='L20147'></a> 20147 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L20148' name='L20148'></a> 20148               <strong class='reserved'>if</strong> (event-&gt;xkey.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> == pending_keystroke_time)
<a id='L20149' name='L20149'></a> 20149                 <em class='brace'>{</em>
<a id='L20150' name='L20150'></a> 20150                   source = <a href='../S/2289.html#L5732' title='Defined at 5732 in src/xterm.c.'>xi_device_from_id</a> (dpyinfo,
<a id='L20151' name='L20151'></a> 20151                                               dpyinfo-&gt;pending_keystroke_source);
<a id='L20152' name='L20152'></a> 20152 
<a id='L20153' name='L20153'></a> 20153                   <strong class='reserved'>if</strong> (source)
<a id='L20154' name='L20154'></a> 20154                     inev.ie.device = source-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>;
<a id='L20155' name='L20155'></a> 20155                 <em class='brace'>}</em>
<a id='L20156' name='L20156'></a> 20156 <em class='sharp'>#endif</em>
<a id='L20157' name='L20157'></a> 20157 
<a id='L20158' name='L20158'></a> 20158               <strong class='reserved'>goto</strong> done_keysym;
<a id='L20159' name='L20159'></a> 20159             <em class='brace'>}</em>
<a id='L20160' name='L20160'></a> 20160 
<a id='L20161' name='L20161'></a> 20161           <em class='comment'>/* Keysyms directly mapped to Unicode characters.  */</em>
<a id='L20162' name='L20162'></a> 20162           <strong class='reserved'>if</strong> (keysym &gt;= 0x01000000 &amp;&amp; keysym &lt;= 0x0110FFFF)
<a id='L20163' name='L20163'></a> 20163             <em class='brace'>{</em>
<a id='L20164' name='L20164'></a> 20164               <strong class='reserved'>if</strong> (keysym &lt; 0x01000080)
<a id='L20165' name='L20165'></a> 20165                 inev.ie.kind = <a href='../S/2231.html#L77' title='Defined at 77 in src/termhooks.h.'>ASCII_KEYSTROKE_EVENT</a>;
<a id='L20166' name='L20166'></a> 20166               <strong class='reserved'>else</strong>
<a id='L20167' name='L20167'></a> 20167                 inev.ie.kind = <a href='../S/2231.html#L85' title='Defined at 85 in src/termhooks.h.'>MULTIBYTE_CHAR_KEYSTROKE_EVENT</a>;
<a id='L20168' name='L20168'></a> 20168               inev.ie.code = keysym &amp; 0xFFFFFF;
<a id='L20169' name='L20169'></a> 20169 
<a id='L20170' name='L20170'></a> 20170 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L20171' name='L20171'></a> 20171               <strong class='reserved'>if</strong> (event-&gt;xkey.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> == pending_keystroke_time)
<a id='L20172' name='L20172'></a> 20172                 <em class='brace'>{</em>
<a id='L20173' name='L20173'></a> 20173                   source = <a href='../S/2289.html#L5732' title='Defined at 5732 in src/xterm.c.'>xi_device_from_id</a> (dpyinfo,
<a id='L20174' name='L20174'></a> 20174                                               dpyinfo-&gt;pending_keystroke_source);
<a id='L20175' name='L20175'></a> 20175 
<a id='L20176' name='L20176'></a> 20176                   <strong class='reserved'>if</strong> (source)
<a id='L20177' name='L20177'></a> 20177                     inev.ie.device = source-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>;
<a id='L20178' name='L20178'></a> 20178                 <em class='brace'>}</em>
<a id='L20179' name='L20179'></a> 20179 <em class='sharp'>#endif</em>
<a id='L20180' name='L20180'></a> 20180 
<a id='L20181' name='L20181'></a> 20181               <strong class='reserved'>goto</strong> done_keysym;
<a id='L20182' name='L20182'></a> 20182             <em class='brace'>}</em>
<a id='L20183' name='L20183'></a> 20183 
<a id='L20184' name='L20184'></a> 20184           <em class='comment'>/* Now non-ASCII.  */</em>
<a id='L20185' name='L20185'></a> 20185           <strong class='reserved'>if</strong> (<a href='../D/2996.html' title='Multiple defined in 2 places.'>HASH_TABLE_P</a> (Vx_keysym_table)
<a id='L20186' name='L20186'></a> 20186               &amp;&amp; (<a href='../D/9440.html' title='Multiple defined in 2 places.'>c</a> = Fgethash (<a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (keysym),
<a id='L20187' name='L20187'></a> 20187                                 Vx_keysym_table,
<a id='L20188' name='L20188'></a> 20188                                 Qnil),
<a id='L20189' name='L20189'></a> 20189                   <a href='../S/2267.html#L3006' title='Defined at 3006 in src/lisp.h.'>FIXNATP</a> (<a href='../D/9440.html' title='Multiple defined in 2 places.'>c</a>)))
<a id='L20190' name='L20190'></a> 20190             <em class='brace'>{</em>
<a id='L20191' name='L20191'></a> 20191               inev.ie.kind = (<a href='../S/2218.html#L98' title='Defined at 98 in src/character.h.'>SINGLE_BYTE_CHAR_P</a> (<a href='../S/2267.html#L3013' title='Defined at 3013 in src/lisp.h.'>XFIXNAT</a> (<a href='../D/9440.html' title='Multiple defined in 2 places.'>c</a>))
<a id='L20192' name='L20192'></a> 20192                               ? <a href='../S/2231.html#L77' title='Defined at 77 in src/termhooks.h.'>ASCII_KEYSTROKE_EVENT</a>
<a id='L20193' name='L20193'></a> 20193                               : <a href='../S/2231.html#L85' title='Defined at 85 in src/termhooks.h.'>MULTIBYTE_CHAR_KEYSTROKE_EVENT</a>);
<a id='L20194' name='L20194'></a> 20194               inev.ie.code = <a href='../S/2267.html#L3013' title='Defined at 3013 in src/lisp.h.'>XFIXNAT</a> (<a href='../D/9440.html' title='Multiple defined in 2 places.'>c</a>);
<a id='L20195' name='L20195'></a> 20195 
<a id='L20196' name='L20196'></a> 20196 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L20197' name='L20197'></a> 20197               <strong class='reserved'>if</strong> (event-&gt;xkey.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> == pending_keystroke_time)
<a id='L20198' name='L20198'></a> 20198                 <em class='brace'>{</em>
<a id='L20199' name='L20199'></a> 20199                   source = <a href='../S/2289.html#L5732' title='Defined at 5732 in src/xterm.c.'>xi_device_from_id</a> (dpyinfo,
<a id='L20200' name='L20200'></a> 20200                                               dpyinfo-&gt;pending_keystroke_source);
<a id='L20201' name='L20201'></a> 20201 
<a id='L20202' name='L20202'></a> 20202                   <strong class='reserved'>if</strong> (source)
<a id='L20203' name='L20203'></a> 20203                     inev.ie.device = source-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>;
<a id='L20204' name='L20204'></a> 20204                 <em class='brace'>}</em>
<a id='L20205' name='L20205'></a> 20205 <em class='sharp'>#endif</em>
<a id='L20206' name='L20206'></a> 20206 
<a id='L20207' name='L20207'></a> 20207               <strong class='reserved'>goto</strong> done_keysym;
<a id='L20208' name='L20208'></a> 20208             <em class='brace'>}</em>
<a id='L20209' name='L20209'></a> 20209 
<a id='L20210' name='L20210'></a> 20210           <em class='comment'>/* Random non-modifier sorts of keysyms.  */</em>
<a id='L20211' name='L20211'></a> 20211           <strong class='reserved'>if</strong> (((keysym &gt;= XK_BackSpace &amp;&amp; keysym &lt;= XK_Escape)
<a id='L20212' name='L20212'></a> 20212                || keysym == XK_Delete
<a id='L20213' name='L20213'></a> 20213 <em class='sharp'>#ifdef</em> XK_ISO_Left_Tab
<a id='L20214' name='L20214'></a> 20214                || (keysym &gt;= XK_ISO_Left_Tab
<a id='L20215' name='L20215'></a> 20215                    &amp;&amp; keysym &lt;= XK_ISO_Enter)
<a id='L20216' name='L20216'></a> 20216 <em class='sharp'>#endif</em>
<a id='L20217' name='L20217'></a> 20217                || <a href='../S/2355.html#L5115' title='Defined at 5115 in src/pgtkterm.c.'>IsCursorKey</a> (keysym) <em class='comment'>/* 0xff50 &lt;= x &lt; 0xff60 */</em>
<a id='L20218' name='L20218'></a> 20218                || <a href='../S/2355.html#L5116' title='Defined at 5116 in src/pgtkterm.c.'>IsMiscFunctionKey</a> (keysym) <em class='comment'>/* 0xff60 &lt;= x &lt; VARIES */</em>
<a id='L20219' name='L20219'></a> 20219 <em class='sharp'>#ifdef</em> HPUX
<a id='L20220' name='L20220'></a> 20220                <em class='comment'>/* This recognizes the "extended function</em>
<a id='L20221' name='L20221'></a> 20221 <em class='comment'>                  keys".  It seems there's no cleaner way.</em>
<a id='L20222' name='L20222'></a> 20222 <em class='comment'>                  Test IsModifierKey to avoid handling</em>
<a id='L20223' name='L20223'></a> 20223 <em class='comment'>                  mode_switch incorrectly.  */</em>
<a id='L20224' name='L20224'></a> 20224                || (XK_Select &lt;= keysym &amp;&amp; keysym &lt; XK_KP_Space)
<a id='L20225' name='L20225'></a> 20225 <em class='sharp'>#endif</em>
<a id='L20226' name='L20226'></a> 20226 <em class='sharp'>#ifdef</em> XK_dead_circumflex
<a id='L20227' name='L20227'></a> 20227                || orig_keysym == XK_dead_circumflex
<a id='L20228' name='L20228'></a> 20228 <em class='sharp'>#endif</em>
<a id='L20229' name='L20229'></a> 20229 <em class='sharp'>#ifdef</em> XK_dead_grave
<a id='L20230' name='L20230'></a> 20230                || orig_keysym == XK_dead_grave
<a id='L20231' name='L20231'></a> 20231 <em class='sharp'>#endif</em>
<a id='L20232' name='L20232'></a> 20232 <em class='sharp'>#ifdef</em> XK_dead_tilde
<a id='L20233' name='L20233'></a> 20233                || orig_keysym == XK_dead_tilde
<a id='L20234' name='L20234'></a> 20234 <em class='sharp'>#endif</em>
<a id='L20235' name='L20235'></a> 20235 <em class='sharp'>#ifdef</em> XK_dead_diaeresis
<a id='L20236' name='L20236'></a> 20236                || orig_keysym == XK_dead_diaeresis
<a id='L20237' name='L20237'></a> 20237 <em class='sharp'>#endif</em>
<a id='L20238' name='L20238'></a> 20238 <em class='sharp'>#ifdef</em> XK_dead_macron
<a id='L20239' name='L20239'></a> 20239                || orig_keysym == XK_dead_macron
<a id='L20240' name='L20240'></a> 20240 <em class='sharp'>#endif</em>
<a id='L20241' name='L20241'></a> 20241 <em class='sharp'>#ifdef</em> XK_dead_degree
<a id='L20242' name='L20242'></a> 20242                || orig_keysym == XK_dead_degree
<a id='L20243' name='L20243'></a> 20243 <em class='sharp'>#endif</em>
<a id='L20244' name='L20244'></a> 20244 <em class='sharp'>#ifdef</em> XK_dead_acute
<a id='L20245' name='L20245'></a> 20245                || orig_keysym == XK_dead_acute
<a id='L20246' name='L20246'></a> 20246 <em class='sharp'>#endif</em>
<a id='L20247' name='L20247'></a> 20247 <em class='sharp'>#ifdef</em> XK_dead_cedilla
<a id='L20248' name='L20248'></a> 20248                || orig_keysym == XK_dead_cedilla
<a id='L20249' name='L20249'></a> 20249 <em class='sharp'>#endif</em>
<a id='L20250' name='L20250'></a> 20250 <em class='sharp'>#ifdef</em> XK_dead_breve
<a id='L20251' name='L20251'></a> 20251                || orig_keysym == XK_dead_breve
<a id='L20252' name='L20252'></a> 20252 <em class='sharp'>#endif</em>
<a id='L20253' name='L20253'></a> 20253 <em class='sharp'>#ifdef</em> XK_dead_ogonek
<a id='L20254' name='L20254'></a> 20254                || orig_keysym == XK_dead_ogonek
<a id='L20255' name='L20255'></a> 20255 <em class='sharp'>#endif</em>
<a id='L20256' name='L20256'></a> 20256 <em class='sharp'>#ifdef</em> XK_dead_caron
<a id='L20257' name='L20257'></a> 20257                || orig_keysym == XK_dead_caron
<a id='L20258' name='L20258'></a> 20258 <em class='sharp'>#endif</em>
<a id='L20259' name='L20259'></a> 20259 <em class='sharp'>#ifdef</em> XK_dead_doubleacute
<a id='L20260' name='L20260'></a> 20260                || orig_keysym == XK_dead_doubleacute
<a id='L20261' name='L20261'></a> 20261 <em class='sharp'>#endif</em>
<a id='L20262' name='L20262'></a> 20262 <em class='sharp'>#ifdef</em> XK_dead_abovedot
<a id='L20263' name='L20263'></a> 20263                || orig_keysym == XK_dead_abovedot
<a id='L20264' name='L20264'></a> 20264 <em class='sharp'>#endif</em>
<a id='L20265' name='L20265'></a> 20265 <em class='sharp'>#ifdef</em> XK_dead_abovering
<a id='L20266' name='L20266'></a> 20266                || orig_keysym == XK_dead_abovering
<a id='L20267' name='L20267'></a> 20267 <em class='sharp'>#endif</em>
<a id='L20268' name='L20268'></a> 20268 <em class='sharp'>#ifdef</em> XK_dead_belowdot
<a id='L20269' name='L20269'></a> 20269                || orig_keysym == XK_dead_belowdot
<a id='L20270' name='L20270'></a> 20270 <em class='sharp'>#endif</em>
<a id='L20271' name='L20271'></a> 20271 <em class='sharp'>#ifdef</em> XK_dead_voiced_sound
<a id='L20272' name='L20272'></a> 20272                || orig_keysym == XK_dead_voiced_sound
<a id='L20273' name='L20273'></a> 20273 <em class='sharp'>#endif</em>
<a id='L20274' name='L20274'></a> 20274 <em class='sharp'>#ifdef</em> XK_dead_semivoiced_sound
<a id='L20275' name='L20275'></a> 20275                || orig_keysym == XK_dead_semivoiced_sound
<a id='L20276' name='L20276'></a> 20276 <em class='sharp'>#endif</em>
<a id='L20277' name='L20277'></a> 20277 <em class='sharp'>#ifdef</em> XK_dead_hook
<a id='L20278' name='L20278'></a> 20278                || orig_keysym == XK_dead_hook
<a id='L20279' name='L20279'></a> 20279 <em class='sharp'>#endif</em>
<a id='L20280' name='L20280'></a> 20280 <em class='sharp'>#ifdef</em> XK_dead_horn
<a id='L20281' name='L20281'></a> 20281                || orig_keysym == XK_dead_horn
<a id='L20282' name='L20282'></a> 20282 <em class='sharp'>#endif</em>
<a id='L20283' name='L20283'></a> 20283 <em class='sharp'>#ifdef</em> XK_dead_stroke
<a id='L20284' name='L20284'></a> 20284                || orig_keysym == XK_dead_stroke
<a id='L20285' name='L20285'></a> 20285 <em class='sharp'>#endif</em>
<a id='L20286' name='L20286'></a> 20286 <em class='sharp'>#ifdef</em> XK_dead_abovecomma
<a id='L20287' name='L20287'></a> 20287                || orig_keysym == XK_dead_abovecomma
<a id='L20288' name='L20288'></a> 20288 <em class='sharp'>#endif</em>
<a id='L20289' name='L20289'></a> 20289                || <a href='../S/2355.html#L5117' title='Defined at 5117 in src/pgtkterm.c.'>IsKeypadKey</a> (keysym) <em class='comment'>/* 0xff80 &lt;= x &lt; 0xffbe */</em>
<a id='L20290' name='L20290'></a> 20290                || <a href='../S/2355.html#L5118' title='Defined at 5118 in src/pgtkterm.c.'>IsFunctionKey</a> (keysym) <em class='comment'>/* 0xffbe &lt;= x &lt; 0xffe1 */</em>
<a id='L20291' name='L20291'></a> 20291                <em class='comment'>/* Any "vendor-specific" key is ok.  */</em>
<a id='L20292' name='L20292'></a> 20292                || (orig_keysym &amp; (1 &lt;&lt; 28))
<a id='L20293' name='L20293'></a> 20293                || (keysym != NoSymbol &amp;&amp; nbytes == 0))
<a id='L20294' name='L20294'></a> 20294               &amp;&amp; ! (<a href='../S/2355.html#L5119' title='Defined at 5119 in src/pgtkterm.c.'>IsModifierKey</a> (orig_keysym)
<a id='L20295' name='L20295'></a> 20295                     <em class='comment'>/* The symbols from XK_ISO_Lock</em>
<a id='L20296' name='L20296'></a> 20296 <em class='comment'>                       to XK_ISO_Last_Group_Lock</em>
<a id='L20297' name='L20297'></a> 20297 <em class='comment'>                       don't have real modifiers but</em>
<a id='L20298' name='L20298'></a> 20298 <em class='comment'>                       should be treated similarly to</em>
<a id='L20299' name='L20299'></a> 20299 <em class='comment'>                       Mode_switch by Emacs. */</em>
<a id='L20300' name='L20300'></a> 20300 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> XK_ISO_Lock &amp;&amp; <strong class='reserved'>defined</strong> XK_ISO_Last_Group_Lock
<a id='L20301' name='L20301'></a> 20301                     || (XK_ISO_Lock &lt;= orig_keysym
<a id='L20302' name='L20302'></a> 20302                         &amp;&amp; orig_keysym &lt;= XK_ISO_Last_Group_Lock)
<a id='L20303' name='L20303'></a> 20303 <em class='sharp'>#endif</em>
<a id='L20304' name='L20304'></a> 20304                     ))
<a id='L20305' name='L20305'></a> 20305             <em class='brace'>{</em>
<a id='L20306' name='L20306'></a> 20306               <a href='../D/5961.html' title='Multiple defined in 2 places.'>STORE_KEYSYM_FOR_DEBUG</a> (keysym);
<a id='L20307' name='L20307'></a> 20307               <em class='comment'>/* make_lispy_event will convert this to a symbolic</em>
<a id='L20308' name='L20308'></a> 20308 <em class='comment'>                 key.  */</em>
<a id='L20309' name='L20309'></a> 20309               inev.ie.kind = <a href='../S/2231.html#L108' title='Defined at 108 in src/termhooks.h.'>NON_ASCII_KEYSTROKE_EVENT</a>;
<a id='L20310' name='L20310'></a> 20310               inev.ie.code = keysym;
<a id='L20311' name='L20311'></a> 20311 
<a id='L20312' name='L20312'></a> 20312 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L20313' name='L20313'></a> 20313               <strong class='reserved'>if</strong> (event-&gt;xkey.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> == pending_keystroke_time)
<a id='L20314' name='L20314'></a> 20314                 <em class='brace'>{</em>
<a id='L20315' name='L20315'></a> 20315                   source = <a href='../S/2289.html#L5732' title='Defined at 5732 in src/xterm.c.'>xi_device_from_id</a> (dpyinfo,
<a id='L20316' name='L20316'></a> 20316                                               dpyinfo-&gt;pending_keystroke_source);
<a id='L20317' name='L20317'></a> 20317 
<a id='L20318' name='L20318'></a> 20318                   <strong class='reserved'>if</strong> (source)
<a id='L20319' name='L20319'></a> 20319                     inev.ie.device = source-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>;
<a id='L20320' name='L20320'></a> 20320                 <em class='brace'>}</em>
<a id='L20321' name='L20321'></a> 20321 <em class='sharp'>#endif</em>
<a id='L20322' name='L20322'></a> 20322 
<a id='L20323' name='L20323'></a> 20323               <strong class='reserved'>goto</strong> done_keysym;
<a id='L20324' name='L20324'></a> 20324             <em class='brace'>}</em>
<a id='L20325' name='L20325'></a> 20325 
<a id='L20326' name='L20326'></a> 20326           <em class='brace'>{</em>     <em class='comment'>/* Raw bytes, not keysym.  */</em>
<a id='L20327' name='L20327'></a> 20327             ptrdiff_t i;
<a id='L20328' name='L20328'></a> 20328 
<a id='L20329' name='L20329'></a> 20329             <strong class='reserved'>for</strong> (i = 0; i &lt; nbytes; i++)
<a id='L20330' name='L20330'></a> 20330               <em class='brace'>{</em>
<a id='L20331' name='L20331'></a> 20331                 <a href='../D/5961.html' title='Multiple defined in 2 places.'>STORE_KEYSYM_FOR_DEBUG</a> (copy_bufptr[i]);
<a id='L20332' name='L20332'></a> 20332               <em class='brace'>}</em>
<a id='L20333' name='L20333'></a> 20333 
<a id='L20334' name='L20334'></a> 20334             <strong class='reserved'>if</strong> (nbytes)
<a id='L20335' name='L20335'></a> 20335               <em class='brace'>{</em>
<a id='L20336' name='L20336'></a> 20336                 inev.ie.kind = <a href='../S/2231.html#L85' title='Defined at 85 in src/termhooks.h.'>MULTIBYTE_CHAR_KEYSTROKE_EVENT</a>;
<a id='L20337' name='L20337'></a> 20337                 inev.ie.arg = <a href='../S/2350.html#L2504' title='Defined at 2504 in src/alloc.c.'>make_unibyte_string</a> ((<strong class='reserved'>char</strong> *) copy_bufptr, nbytes);
<a id='L20338' name='L20338'></a> 20338 
<a id='L20339' name='L20339'></a> 20339                 Fput_text_property (<a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (0), <a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (nbytes),
<a id='L20340' name='L20340'></a> 20340                                     Qcoding, coding, inev.ie.arg);
<a id='L20341' name='L20341'></a> 20341 
<a id='L20342' name='L20342'></a> 20342 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L20343' name='L20343'></a> 20343                 <strong class='reserved'>if</strong> (event-&gt;xkey.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> == pending_keystroke_time
<a id='L20344' name='L20344'></a> 20344                     <em class='comment'>/* I-Bus sometimes sends events generated from</em>
<a id='L20345' name='L20345'></a> 20345 <em class='comment'>                       multiple filtered keystrokes with a time of 0,</em>
<a id='L20346' name='L20346'></a> 20346 <em class='comment'>                       so just use the recorded source device if it</em>
<a id='L20347' name='L20347'></a> 20347 <em class='comment'>                       exists.  */</em>
<a id='L20348' name='L20348'></a> 20348                     || (pending_keystroke_time &amp;&amp; !event-&gt;xkey.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>))
<a id='L20349' name='L20349'></a> 20349                   <em class='brace'>{</em>
<a id='L20350' name='L20350'></a> 20350                     source = <a href='../S/2289.html#L5732' title='Defined at 5732 in src/xterm.c.'>xi_device_from_id</a> (dpyinfo,
<a id='L20351' name='L20351'></a> 20351                                                 dpyinfo-&gt;pending_keystroke_source);
<a id='L20352' name='L20352'></a> 20352 
<a id='L20353' name='L20353'></a> 20353                     <strong class='reserved'>if</strong> (source)
<a id='L20354' name='L20354'></a> 20354                       inev.ie.device = source-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>;
<a id='L20355' name='L20355'></a> 20355                   <em class='brace'>}</em>
<a id='L20356' name='L20356'></a> 20356 <em class='sharp'>#endif</em>
<a id='L20357' name='L20357'></a> 20357               <em class='brace'>}</em>
<a id='L20358' name='L20358'></a> 20358 
<a id='L20359' name='L20359'></a> 20359             <strong class='reserved'>if</strong> (keysym == NoSymbol)
<a id='L20360' name='L20360'></a> 20360               <strong class='reserved'>break</strong>;
<a id='L20361' name='L20361'></a> 20361           <em class='brace'>}</em>
<a id='L20362' name='L20362'></a> 20362         <em class='brace'>}</em>
<a id='L20363' name='L20363'></a> 20363     done_keysym:
<a id='L20364' name='L20364'></a> 20364 <em class='sharp'>#ifdef</em> HAVE_X_I18N
<a id='L20365' name='L20365'></a> 20365       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L20366' name='L20366'></a> 20366         <em class='brace'>{</em>
<a id='L20367' name='L20367'></a> 20367           <strong class='reserved'>struct</strong> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> *w = <a href='../D/7409.html' title='Multiple defined in 2 places.'>XWINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;selected_window);
<a id='L20368' name='L20368'></a> 20368           <a href='../S/2296.html#L3218' title='Defined at 3218 in src/xfns.c.'>xic_set_preeditarea</a> (w, w-&gt;cursor.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, w-&gt;cursor.y);
<a id='L20369' name='L20369'></a> 20369 
<a id='L20370' name='L20370'></a> 20370           <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1470' title='Defined at 1470 in src/xterm.h.'>FRAME_XIC</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) &amp;&amp; (<a href='../S/2212.html#L1473' title='Defined at 1473 in src/xterm.h.'>FRAME_XIC_STYLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) &amp; XIMStatusArea))
<a id='L20371' name='L20371'></a> 20371             <a href='../S/2296.html#L3269' title='Defined at 3269 in src/xfns.c.'>xic_set_statusarea</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L20372' name='L20372'></a> 20372         <em class='brace'>}</em>
<a id='L20373' name='L20373'></a> 20373 
<a id='L20374' name='L20374'></a> 20374       <em class='comment'>/* Don't dispatch this event since XtDispatchEvent calls</em>
<a id='L20375' name='L20375'></a> 20375 <em class='comment'>         XFilterEvent, and two calls in a row may freeze the</em>
<a id='L20376' name='L20376'></a> 20376 <em class='comment'>         client.  */</em>
<a id='L20377' name='L20377'></a> 20377       <strong class='reserved'>break</strong>;
<a id='L20378' name='L20378'></a> 20378 <em class='sharp'>#else</em>
<a id='L20379' name='L20379'></a> 20379       <strong class='reserved'>goto</strong> OTHER;
<a id='L20380' name='L20380'></a> 20380 <em class='sharp'>#endif</em>
<a id='L20381' name='L20381'></a> 20381 
<a id='L20382' name='L20382'></a> 20382     <strong class='reserved'>case</strong> KeyRelease:
<a id='L20383' name='L20383'></a> 20383 <em class='sharp'>#ifdef</em> HAVE_X_I18N
<a id='L20384' name='L20384'></a> 20384       <em class='comment'>/* Don't dispatch this event since XtDispatchEvent calls</em>
<a id='L20385' name='L20385'></a> 20385 <em class='comment'>         XFilterEvent, and two calls in a row may freeze the</em>
<a id='L20386' name='L20386'></a> 20386 <em class='comment'>         client.  */</em>
<a id='L20387' name='L20387'></a> 20387       <strong class='reserved'>break</strong>;
<a id='L20388' name='L20388'></a> 20388 <em class='sharp'>#else</em>
<a id='L20389' name='L20389'></a> 20389       <strong class='reserved'>goto</strong> OTHER;
<a id='L20390' name='L20390'></a> 20390 <em class='sharp'>#endif</em>
<a id='L20391' name='L20391'></a> 20391 
<a id='L20392' name='L20392'></a> 20392     <strong class='reserved'>case</strong> EnterNotify:
<a id='L20393' name='L20393'></a> 20393       <a href='../S/2289.html#L7929' title='Defined at 7929 in src/xterm.c.'>x_display_set_last_user_time</a> (dpyinfo, event-&gt;xcrossing.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>,
<a id='L20394' name='L20394'></a> 20394                                     event-&gt;xcrossing.send_event,
<a id='L20395' name='L20395'></a> 20395                                     <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L20396' name='L20396'></a> 20396 
<a id='L20397' name='L20397'></a> 20397 <em class='sharp'>#ifdef</em> HAVE_XWIDGETS
<a id='L20398' name='L20398'></a> 20398       <em class='brace'>{</em>
<a id='L20399' name='L20399'></a> 20399         <strong class='reserved'>struct</strong> <a href='../S/2261.html#L102' title='Defined at 102 in src/xwidget.h.'>xwidget_view</a> *xvw;
<a id='L20400' name='L20400'></a> 20400         <a href='../S/2315.html#L2919' title='Defined at 2919 in src/dispextern.h.'>Mouse_HLInfo</a> *hlinfo;
<a id='L20401' name='L20401'></a> 20401 
<a id='L20402' name='L20402'></a> 20402         xvw = <a href='../S/2334.html#L2116' title='Defined at 2116 in src/xwidget.c.'>xwidget_view_from_window</a> (event-&gt;xcrossing.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L20403' name='L20403'></a> 20403 
<a id='L20404' name='L20404'></a> 20404         <strong class='reserved'>if</strong> (xvw)
<a id='L20405' name='L20405'></a> 20405           <em class='brace'>{</em>
<a id='L20406' name='L20406'></a> 20406             <a href='../S/2334.html#L1924' title='Defined at 1924 in src/xwidget.c.'>xwidget_motion_or_crossing</a> (xvw, event);
<a id='L20407' name='L20407'></a> 20407             hlinfo = <a href='../D/4164.html' title='Multiple defined in 3 places.'>MOUSE_HL_INFO</a> (xvw-&gt;<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>);
<a id='L20408' name='L20408'></a> 20408 
<a id='L20409' name='L20409'></a> 20409             <strong class='reserved'>if</strong> (xvw-&gt;<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> == hlinfo-&gt;mouse_face_mouse_frame)
<a id='L20410' name='L20410'></a> 20410               <em class='brace'>{</em>
<a id='L20411' name='L20411'></a> 20411                 <a href='../S/2224.html#L34014' title='Defined at 34014 in src/xdisp.c.'>clear_mouse_face</a> (hlinfo);
<a id='L20412' name='L20412'></a> 20412                 hlinfo-&gt;mouse_face_mouse_frame = 0;
<a id='L20413' name='L20413'></a> 20413                 x_flush_dirty_back_buffer_on (xvw-&gt;<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>);
<a id='L20414' name='L20414'></a> 20414               <em class='brace'>}</em>
<a id='L20415' name='L20415'></a> 20415 
<a id='L20416' name='L20416'></a> 20416             <strong class='reserved'>if</strong> (any_help_event_p)
<a id='L20417' name='L20417'></a> 20417               do_help = -1;
<a id='L20418' name='L20418'></a> 20418 
<a id='L20419' name='L20419'></a> 20419             <strong class='reserved'>goto</strong> OTHER;
<a id='L20420' name='L20420'></a> 20420           <em class='brace'>}</em>
<a id='L20421' name='L20421'></a> 20421       <em class='brace'>}</em>
<a id='L20422' name='L20422'></a> 20422 <em class='sharp'>#endif</em>
<a id='L20423' name='L20423'></a> 20423 
<a id='L20424' name='L20424'></a> 20424 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L20425' name='L20425'></a> 20425       <em class='comment'>/* For whatever reason, the X server continues to deliver</em>
<a id='L20426' name='L20426'></a> 20426 <em class='comment'>         EnterNotify and LeaveNotify events despite us selecting for</em>
<a id='L20427' name='L20427'></a> 20427 <em class='comment'>         related XI_Enter and XI_Leave events.  It's not just our</em>
<a id='L20428' name='L20428'></a> 20428 <em class='comment'>         problem, since windows created by "xinput test-xi2" suffer</em>
<a id='L20429' name='L20429'></a> 20429 <em class='comment'>         from the same defect.  Simply ignore all such events while</em>
<a id='L20430' name='L20430'></a> 20430 <em class='comment'>         the input extension is enabled.  (bug#57468) */</em>
<a id='L20431' name='L20431'></a> 20431 
<a id='L20432' name='L20432'></a> 20432       <strong class='reserved'>if</strong> (dpyinfo-&gt;supports_xi2)
<a id='L20433' name='L20433'></a> 20433         <strong class='reserved'>goto</strong> OTHER;
<a id='L20434' name='L20434'></a> 20434 <em class='sharp'>#endif</em>
<a id='L20435' name='L20435'></a> 20435 
<a id='L20436' name='L20436'></a> 20436       <strong class='reserved'>if</strong> (<a href='../D/19730.html' title='Multiple defined in 2 places.'>x_top_window_to_frame</a> (dpyinfo, event-&gt;xcrossing.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>))
<a id='L20437' name='L20437'></a> 20437         x_detect_focus_change (dpyinfo, any, event, &amp;inev.ie);
<a id='L20438' name='L20438'></a> 20438 
<a id='L20439' name='L20439'></a> 20439       <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = any;
<a id='L20440' name='L20440'></a> 20440 
<a id='L20441' name='L20441'></a> 20441       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; event-&gt;xcrossing.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> == <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L20442' name='L20442'></a> 20442         x_compute_root_window_offset (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, event-&gt;xcrossing.x_root,
<a id='L20443' name='L20443'></a> 20443                                       event-&gt;xcrossing.y_root,
<a id='L20444' name='L20444'></a> 20444                                       event-&gt;xcrossing.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>,
<a id='L20445' name='L20445'></a> 20445                                       event-&gt;xcrossing.y);
<a id='L20446' name='L20446'></a> 20446 
<a id='L20447' name='L20447'></a> 20447       <em class='comment'>/* The code below relies on the first several fields of</em>
<a id='L20448' name='L20448'></a> 20448 <em class='comment'>         XCrossingEvent being laid out the same way as</em>
<a id='L20449' name='L20449'></a> 20449 <em class='comment'>         XMotionEvent.  */</em>
<a id='L20450' name='L20450'></a> 20450 
<a id='L20451' name='L20451'></a> 20451       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; x_mouse_click_focus_ignore_position)
<a id='L20452' name='L20452'></a> 20452         <em class='brace'>{</em>
<a id='L20453' name='L20453'></a> 20453           ignore_next_mouse_click_timeout = (event-&gt;xmotion.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>
<a id='L20454' name='L20454'></a> 20454                                              + x_mouse_click_focus_ignore_time);
<a id='L20455' name='L20455'></a> 20455           mouse_click_timeout_display = dpyinfo;
<a id='L20456' name='L20456'></a> 20456         <em class='brace'>}</em>
<a id='L20457' name='L20457'></a> 20457 
<a id='L20458' name='L20458'></a> 20458       <em class='comment'>/* EnterNotify counts as mouse movement,</em>
<a id='L20459' name='L20459'></a> 20459 <em class='comment'>         so update things that depend on mouse position.  */</em>
<a id='L20460' name='L20460'></a> 20460       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; !<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;hourglass_p)
<a id='L20461' name='L20461'></a> 20461         x_note_mouse_movement (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, &amp;event-&gt;xmotion, Qnil);
<a id='L20462' name='L20462'></a> 20462 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L20463' name='L20463'></a> 20463       <em class='comment'>/* We may get an EnterNotify on the buttons in the toolbar.  In that</em>
<a id='L20464' name='L20464'></a> 20464 <em class='comment'>         case we moved out of any highlighted area and need to note this.  */</em>
<a id='L20465' name='L20465'></a> 20465       <strong class='reserved'>if</strong> (!<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; dpyinfo-&gt;last_mouse_glyph_frame)
<a id='L20466' name='L20466'></a> 20466         x_note_mouse_movement (dpyinfo-&gt;last_mouse_glyph_frame, &amp;event-&gt;xmotion,
<a id='L20467' name='L20467'></a> 20467                                Qnil);
<a id='L20468' name='L20468'></a> 20468 <em class='sharp'>#endif</em>
<a id='L20469' name='L20469'></a> 20469       <strong class='reserved'>goto</strong> OTHER;
<a id='L20470' name='L20470'></a> 20470 
<a id='L20471' name='L20471'></a> 20471     <strong class='reserved'>case</strong> FocusIn:
<a id='L20472' name='L20472'></a> 20472 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XINPUT2                                                \
<a id='L20473' name='L20473'></a> 20473   &amp;&amp; (<strong class='reserved'>defined</strong> HAVE_GTK3 || (!<strong class='reserved'>defined</strong> USE_GTK &amp;&amp; !<strong class='reserved'>defined</strong> USE_X_TOOLKIT))
<a id='L20474' name='L20474'></a> 20474       <em class='comment'>/* If a FocusIn event is received (because the window manager</em>
<a id='L20475' name='L20475'></a> 20475 <em class='comment'>         sent us one), don't set the core focus if XInput 2 is</em>
<a id='L20476' name='L20476'></a> 20476 <em class='comment'>         enabled, since that would mess up the device-specific focus</em>
<a id='L20477' name='L20477'></a> 20477 <em class='comment'>         tracking.</em>
<a id='L20478' name='L20478'></a> 20478 <em class='comment'></em>
<a id='L20479' name='L20479'></a> 20479 <em class='comment'>         The long looking preprocessor conditional only enables this</em>
<a id='L20480' name='L20480'></a> 20480 <em class='comment'>         code on GTK 3 and no toolkit builds, since those are the only</em>
<a id='L20481' name='L20481'></a> 20481 <em class='comment'>         builds where focus is tracked specific to each master device.</em>
<a id='L20482' name='L20482'></a> 20482 <em class='comment'>         Other builds use core events and the client pointer to handle</em>
<a id='L20483' name='L20483'></a> 20483 <em class='comment'>         focus, much like on a build without XInput 2.  */</em>
<a id='L20484' name='L20484'></a> 20484       <strong class='reserved'>if</strong> (dpyinfo-&gt;supports_xi2)
<a id='L20485' name='L20485'></a> 20485         <strong class='reserved'>goto</strong> OTHER;
<a id='L20486' name='L20486'></a> 20486 <em class='sharp'>#endif</em>
<a id='L20487' name='L20487'></a> 20487 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L20488' name='L20488'></a> 20488       <em class='comment'>/* Some WMs (e.g. Mutter in Gnome Shell), don't unmap</em>
<a id='L20489' name='L20489'></a> 20489 <em class='comment'>         minimized/iconified windows; thus, for those WMs we won't get</em>
<a id='L20490' name='L20490'></a> 20490 <em class='comment'>         a MapNotify when unminimizing/deiconifying.  Check here if we</em>
<a id='L20491' name='L20491'></a> 20491 <em class='comment'>         are deiconizing a window (Bug42655).</em>
<a id='L20492' name='L20492'></a> 20492 <em class='comment'></em>
<a id='L20493' name='L20493'></a> 20493 <em class='comment'>         But don't do that by default on GTK since it may cause a plain</em>
<a id='L20494' name='L20494'></a> 20494 <em class='comment'>         invisible frame get reported as iconified, compare</em>
<a id='L20495' name='L20495'></a> 20495 <em class='comment'>         https://lists.gnu.org/archive/html/emacs-devel/2017-02/msg00133.html.</em>
<a id='L20496' name='L20496'></a> 20496 <em class='comment'>         That is fixed above but bites us here again.</em>
<a id='L20497' name='L20497'></a> 20497 <em class='comment'></em>
<a id='L20498' name='L20498'></a> 20498 <em class='comment'>         The option x_set_frame_visibility_more_laxly allows to override</em>
<a id='L20499' name='L20499'></a> 20499 <em class='comment'>         the default behavior (Bug#49955, Bug#53298).  */</em>
<a id='L20500' name='L20500'></a> 20500       <strong class='reserved'>if</strong> (<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (x_set_frame_visibility_more_laxly, Qfocus_in)
<a id='L20501' name='L20501'></a> 20501           || <a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (x_set_frame_visibility_more_laxly, Qt))
<a id='L20502' name='L20502'></a> 20502 <em class='sharp'>#endif</em> <em class='comment'>/* USE_GTK */</em>
<a id='L20503' name='L20503'></a> 20503         <em class='brace'>{</em>
<a id='L20504' name='L20504'></a> 20504           <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = any;
<a id='L20505' name='L20505'></a> 20505           <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; <a href='../S/2183.html#L1172' title='Defined at 1172 in src/frame.h.'>FRAME_ICONIFIED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L20506' name='L20506'></a> 20506             <em class='brace'>{</em>
<a id='L20507' name='L20507'></a> 20507               <a href='../S/2183.html#L1437' title='Defined at 1437 in src/frame.h.'>SET_FRAME_VISIBLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 1);
<a id='L20508' name='L20508'></a> 20508               <a href='../S/2183.html#L1452' title='Defined at 1452 in src/frame.h.'>SET_FRAME_ICONIFIED</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L20509' name='L20509'></a> 20509               <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;has_been_visible = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L20510' name='L20510'></a> 20510               inev.ie.kind = <a href='../S/2231.html#L197' title='Defined at 197 in src/termhooks.h.'>DEICONIFY_EVENT</a>;
<a id='L20511' name='L20511'></a> 20511               <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (inev.ie.frame_or_window, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L20512' name='L20512'></a> 20512             <em class='brace'>}</em>
<a id='L20513' name='L20513'></a> 20513         <em class='brace'>}</em>
<a id='L20514' name='L20514'></a> 20514 
<a id='L20515' name='L20515'></a> 20515       x_detect_focus_change (dpyinfo, any, event, &amp;inev.ie);
<a id='L20516' name='L20516'></a> 20516       <strong class='reserved'>goto</strong> OTHER;
<a id='L20517' name='L20517'></a> 20517 
<a id='L20518' name='L20518'></a> 20518     <strong class='reserved'>case</strong> LeaveNotify:
<a id='L20519' name='L20519'></a> 20519       <a href='../S/2289.html#L7929' title='Defined at 7929 in src/xterm.c.'>x_display_set_last_user_time</a> (dpyinfo, event-&gt;xcrossing.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>,
<a id='L20520' name='L20520'></a> 20520                                     event-&gt;xcrossing.send_event, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L20521' name='L20521'></a> 20521 
<a id='L20522' name='L20522'></a> 20522 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L20523' name='L20523'></a> 20523       <em class='comment'>/* For whatever reason, the X server continues to deliver</em>
<a id='L20524' name='L20524'></a> 20524 <em class='comment'>         EnterNotify and LeaveNotify events despite us selecting for</em>
<a id='L20525' name='L20525'></a> 20525 <em class='comment'>         related XI_Enter and XI_Leave events.  It's not just our</em>
<a id='L20526' name='L20526'></a> 20526 <em class='comment'>         problem, since windows created by "xinput test-xi2" suffer</em>
<a id='L20527' name='L20527'></a> 20527 <em class='comment'>         from the same defect.  Simply ignore all such events while</em>
<a id='L20528' name='L20528'></a> 20528 <em class='comment'>         the input extension is enabled.  (bug#57468) */</em>
<a id='L20529' name='L20529'></a> 20529 
<a id='L20530' name='L20530'></a> 20530       <strong class='reserved'>if</strong> (dpyinfo-&gt;supports_xi2)
<a id='L20531' name='L20531'></a> 20531         <em class='brace'>{</em>
<a id='L20532' name='L20532'></a> 20532 <em class='sharp'>#if</em> !<strong class='reserved'>defined</strong> USE_X_TOOLKIT &amp;&amp; (!<strong class='reserved'>defined</strong> USE_GTK || <strong class='reserved'>defined</strong> HAVE_GTK3)
<a id='L20533' name='L20533'></a> 20533           <strong class='reserved'>goto</strong> OTHER;
<a id='L20534' name='L20534'></a> 20534 <em class='sharp'>#else</em>
<a id='L20535' name='L20535'></a> 20535           <em class='comment'>/* Unfortunately, X toolkit popups generate LeaveNotify</em>
<a id='L20536' name='L20536'></a> 20536 <em class='comment'>             events due to the core grabs they acquire (and our</em>
<a id='L20537' name='L20537'></a> 20537 <em class='comment'>             releasing of the device grab).  This leads to the mouse</em>
<a id='L20538' name='L20538'></a> 20538 <em class='comment'>             face persisting if a popup is activated by clicking on a</em>
<a id='L20539' name='L20539'></a> 20539 <em class='comment'>             button, and then dismissed by releasing the mouse button</em>
<a id='L20540' name='L20540'></a> 20540 <em class='comment'>             outside the frame, in which case no XI_Enter event is</em>
<a id='L20541' name='L20541'></a> 20541 <em class='comment'>             generated for the grab.  */</em>
<a id='L20542' name='L20542'></a> 20542           <strong class='reserved'>goto</strong> just_clear_mouse_face;
<a id='L20543' name='L20543'></a> 20543 <em class='sharp'>#endif</em>
<a id='L20544' name='L20544'></a> 20544         <em class='brace'>}</em>
<a id='L20545' name='L20545'></a> 20545 <em class='sharp'>#endif</em>
<a id='L20546' name='L20546'></a> 20546 
<a id='L20547' name='L20547'></a> 20547 <em class='sharp'>#ifdef</em> HAVE_XWIDGETS
<a id='L20548' name='L20548'></a> 20548       <em class='brace'>{</em>
<a id='L20549' name='L20549'></a> 20549         <strong class='reserved'>struct</strong> <a href='../S/2261.html#L102' title='Defined at 102 in src/xwidget.h.'>xwidget_view</a> *xvw;
<a id='L20550' name='L20550'></a> 20550 
<a id='L20551' name='L20551'></a> 20551         xvw = <a href='../S/2334.html#L2116' title='Defined at 2116 in src/xwidget.c.'>xwidget_view_from_window</a> (event-&gt;xcrossing.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L20552' name='L20552'></a> 20552 
<a id='L20553' name='L20553'></a> 20553         <strong class='reserved'>if</strong> (xvw)
<a id='L20554' name='L20554'></a> 20554           <em class='brace'>{</em>
<a id='L20555' name='L20555'></a> 20555             <a href='../S/2334.html#L1924' title='Defined at 1924 in src/xwidget.c.'>xwidget_motion_or_crossing</a> (xvw, event);
<a id='L20556' name='L20556'></a> 20556             <strong class='reserved'>goto</strong> OTHER;
<a id='L20557' name='L20557'></a> 20557           <em class='brace'>}</em>
<a id='L20558' name='L20558'></a> 20558       <em class='brace'>}</em>
<a id='L20559' name='L20559'></a> 20559 <em class='sharp'>#endif</em>
<a id='L20560' name='L20560'></a> 20560 
<a id='L20561' name='L20561'></a> 20561       <strong class='reserved'>if</strong> (<a href='../D/19730.html' title='Multiple defined in 2 places.'>x_top_window_to_frame</a> (dpyinfo, event-&gt;xcrossing.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>))
<a id='L20562' name='L20562'></a> 20562         x_detect_focus_change (dpyinfo, any, event, &amp;inev.ie);
<a id='L20563' name='L20563'></a> 20563 
<a id='L20564' name='L20564'></a> 20564 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XINPUT2                                                \
<a id='L20565' name='L20565'></a> 20565   &amp;&amp; (<strong class='reserved'>defined</strong> USE_X_TOOLKIT || (<strong class='reserved'>defined</strong> USE_GTK &amp;&amp; !<strong class='reserved'>defined</strong> HAVE_GTK3))
<a id='L20566' name='L20566'></a> 20566     just_clear_mouse_face:
<a id='L20567' name='L20567'></a> 20567 <em class='sharp'>#endif</em>
<a id='L20568' name='L20568'></a> 20568 
<a id='L20569' name='L20569'></a> 20569 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> USE_X_TOOLKIT
<a id='L20570' name='L20570'></a> 20570       <em class='comment'>/* If the mouse leaves the edit widget, then any mouse highlight</em>
<a id='L20571' name='L20571'></a> 20571 <em class='comment'>         should be cleared.  */</em>
<a id='L20572' name='L20572'></a> 20572       <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2289.html#L11957' title='Defined at 11957 in src/xterm.c.'>x_window_to_frame</a> (dpyinfo, event-&gt;xcrossing.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L20573' name='L20573'></a> 20573 
<a id='L20574' name='L20574'></a> 20574       <strong class='reserved'>if</strong> (!<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L20575' name='L20575'></a> 20575         <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../D/19730.html' title='Multiple defined in 2 places.'>x_top_window_to_frame</a> (dpyinfo, event-&gt;xcrossing.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L20576' name='L20576'></a> 20576 <em class='sharp'>#else</em>
<a id='L20577' name='L20577'></a> 20577       <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../D/19730.html' title='Multiple defined in 2 places.'>x_top_window_to_frame</a> (dpyinfo, event-&gt;xcrossing.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L20578' name='L20578'></a> 20578 <em class='sharp'>#endif</em>
<a id='L20579' name='L20579'></a> 20579 
<a id='L20580' name='L20580'></a> 20580       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L20581' name='L20581'></a> 20581         <em class='brace'>{</em>
<a id='L20582' name='L20582'></a> 20582           <em class='comment'>/* Now clear dpyinfo-&gt;last_mouse_motion_frame, or</em>
<a id='L20583' name='L20583'></a> 20583 <em class='comment'>             gui_redo_mouse_highlight will end up highlighting the</em>
<a id='L20584' name='L20584'></a> 20584 <em class='comment'>             last known position of the mouse if a tooltip frame is</em>
<a id='L20585' name='L20585'></a> 20585 <em class='comment'>             later unmapped.  */</em>
<a id='L20586' name='L20586'></a> 20586 
<a id='L20587' name='L20587'></a> 20587           <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> == dpyinfo-&gt;last_mouse_motion_frame)
<a id='L20588' name='L20588'></a> 20588             dpyinfo-&gt;last_mouse_motion_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L20589' name='L20589'></a> 20589 
<a id='L20590' name='L20590'></a> 20590           <em class='comment'>/* Something similar applies to</em>
<a id='L20591' name='L20591'></a> 20591 <em class='comment'>             dpyinfo-&gt;last_mouse_glyph_frame.  */</em>
<a id='L20592' name='L20592'></a> 20592           <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> == dpyinfo-&gt;last_mouse_glyph_frame)
<a id='L20593' name='L20593'></a> 20593             dpyinfo-&gt;last_mouse_glyph_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L20594' name='L20594'></a> 20594 
<a id='L20595' name='L20595'></a> 20595           <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> == hlinfo-&gt;mouse_face_mouse_frame)
<a id='L20596' name='L20596'></a> 20596             <em class='brace'>{</em>
<a id='L20597' name='L20597'></a> 20597               <em class='comment'>/* If we move outside the frame, then we're</em>
<a id='L20598' name='L20598'></a> 20598 <em class='comment'>                 certainly no longer on any text in the frame.  */</em>
<a id='L20599' name='L20599'></a> 20599               <a href='../S/2224.html#L34014' title='Defined at 34014 in src/xdisp.c.'>clear_mouse_face</a> (hlinfo);
<a id='L20600' name='L20600'></a> 20600               hlinfo-&gt;mouse_face_mouse_frame = 0;
<a id='L20601' name='L20601'></a> 20601               x_flush_dirty_back_buffer_on (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L20602' name='L20602'></a> 20602             <em class='brace'>}</em>
<a id='L20603' name='L20603'></a> 20603 
<a id='L20604' name='L20604'></a> 20604           <em class='comment'>/* Generate a nil HELP_EVENT to cancel a help-echo.</em>
<a id='L20605' name='L20605'></a> 20605 <em class='comment'>             Do it only if there's something to cancel.</em>
<a id='L20606' name='L20606'></a> 20606 <em class='comment'>             Otherwise, the startup message is cleared when</em>
<a id='L20607' name='L20607'></a> 20607 <em class='comment'>             the mouse leaves the frame.  */</em>
<a id='L20608' name='L20608'></a> 20608           <strong class='reserved'>if</strong> (any_help_event_p
<a id='L20609' name='L20609'></a> 20609               <em class='comment'>/* But never if `mouse-drag-and-drop-region' is in</em>
<a id='L20610' name='L20610'></a> 20610 <em class='comment'>                 progress, since that results in the tooltip being</em>
<a id='L20611' name='L20611'></a> 20611 <em class='comment'>                 dismissed when the mouse moves on top.  */</em>
<a id='L20612' name='L20612'></a> 20612               &amp;&amp; !((<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (track_mouse, Qdrag_source)
<a id='L20613' name='L20613'></a> 20613                     || <a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (track_mouse, Qdropping))
<a id='L20614' name='L20614'></a> 20614                    &amp;&amp; <a href='../S/2247.html#L5226' title='Defined at 5226 in src/frame.c.'>gui_mouse_grabbed</a> (dpyinfo)))
<a id='L20615' name='L20615'></a> 20615             do_help = -1;
<a id='L20616' name='L20616'></a> 20616 
<a id='L20617' name='L20617'></a> 20617           <strong class='reserved'>if</strong> (event-&gt;xcrossing.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> == <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L20618' name='L20618'></a> 20618             x_compute_root_window_offset (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, event-&gt;xcrossing.x_root,
<a id='L20619' name='L20619'></a> 20619                                           event-&gt;xcrossing.y_root,
<a id='L20620' name='L20620'></a> 20620                                           event-&gt;xcrossing.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>,
<a id='L20621' name='L20621'></a> 20621                                           event-&gt;xcrossing.y);
<a id='L20622' name='L20622'></a> 20622 
<a id='L20623' name='L20623'></a> 20623         <em class='brace'>}</em>
<a id='L20624' name='L20624'></a> 20624 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L20625' name='L20625'></a> 20625       <em class='comment'>/* See comment in EnterNotify above */</em>
<a id='L20626' name='L20626'></a> 20626       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (dpyinfo-&gt;last_mouse_glyph_frame)
<a id='L20627' name='L20627'></a> 20627         x_note_mouse_movement (dpyinfo-&gt;last_mouse_glyph_frame,
<a id='L20628' name='L20628'></a> 20628                                &amp;event-&gt;xmotion, Qnil);
<a id='L20629' name='L20629'></a> 20629 <em class='sharp'>#endif</em>
<a id='L20630' name='L20630'></a> 20630       <strong class='reserved'>goto</strong> OTHER;
<a id='L20631' name='L20631'></a> 20631 
<a id='L20632' name='L20632'></a> 20632     <strong class='reserved'>case</strong> FocusOut:
<a id='L20633' name='L20633'></a> 20633 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XINPUT2                                                \
<a id='L20634' name='L20634'></a> 20634   &amp;&amp; (<strong class='reserved'>defined</strong> HAVE_GTK3 || (!<strong class='reserved'>defined</strong> USE_GTK &amp;&amp; !<strong class='reserved'>defined</strong> USE_X_TOOLKIT))
<a id='L20635' name='L20635'></a> 20635       <em class='comment'>/* If a FocusIn event is received (because the window manager</em>
<a id='L20636' name='L20636'></a> 20636 <em class='comment'>         sent us one), don't set the core focus if XInput 2 is</em>
<a id='L20637' name='L20637'></a> 20637 <em class='comment'>         enabled, since that would mess up the device-specific focus</em>
<a id='L20638' name='L20638'></a> 20638 <em class='comment'>         tracking.</em>
<a id='L20639' name='L20639'></a> 20639 <em class='comment'></em>
<a id='L20640' name='L20640'></a> 20640 <em class='comment'>         The long looking preprocessor conditional only enables this</em>
<a id='L20641' name='L20641'></a> 20641 <em class='comment'>         code on GTK 3 and no toolkit builds, since those are the only</em>
<a id='L20642' name='L20642'></a> 20642 <em class='comment'>         builds where focus is tracked specific to each master device.</em>
<a id='L20643' name='L20643'></a> 20643 <em class='comment'>         Other builds use core events and the client pointer to handle</em>
<a id='L20644' name='L20644'></a> 20644 <em class='comment'>         focus, much like on a build without XInput 2.  */</em>
<a id='L20645' name='L20645'></a> 20645       <strong class='reserved'>if</strong> (dpyinfo-&gt;supports_xi2)
<a id='L20646' name='L20646'></a> 20646         <strong class='reserved'>goto</strong> OTHER;
<a id='L20647' name='L20647'></a> 20647 <em class='sharp'>#endif</em>
<a id='L20648' name='L20648'></a> 20648       x_detect_focus_change (dpyinfo, any, event, &amp;inev.ie);
<a id='L20649' name='L20649'></a> 20649       <strong class='reserved'>goto</strong> OTHER;
<a id='L20650' name='L20650'></a> 20650 
<a id='L20651' name='L20651'></a> 20651     <strong class='reserved'>case</strong> MotionNotify:
<a id='L20652' name='L20652'></a> 20652       <em class='brace'>{</em>
<a id='L20653' name='L20653'></a> 20653         XMotionEvent xmotion = event-&gt;xmotion;
<a id='L20654' name='L20654'></a> 20654 
<a id='L20655' name='L20655'></a> 20655         previous_help_echo_string = help_echo_string;
<a id='L20656' name='L20656'></a> 20656         help_echo_string = Qnil;
<a id='L20657' name='L20657'></a> 20657 
<a id='L20658' name='L20658'></a> 20658         <strong class='reserved'>if</strong> (hlinfo-&gt;mouse_face_hidden)
<a id='L20659' name='L20659'></a> 20659           <em class='brace'>{</em>
<a id='L20660' name='L20660'></a> 20660             hlinfo-&gt;mouse_face_hidden = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L20661' name='L20661'></a> 20661             <a href='../S/2224.html#L34014' title='Defined at 34014 in src/xdisp.c.'>clear_mouse_face</a> (hlinfo);
<a id='L20662' name='L20662'></a> 20662           <em class='brace'>}</em>
<a id='L20663' name='L20663'></a> 20663 
<a id='L20664' name='L20664'></a> 20664         <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../D/14633.html' title='Multiple defined in 2 places.'>mouse_or_wdesc_frame</a> (dpyinfo, event-&gt;xmotion.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L20665' name='L20665'></a> 20665 
<a id='L20666' name='L20666'></a> 20666         <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; event-&gt;xmotion.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> == <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L20667' name='L20667'></a> 20667           <em class='comment'>/* See the comment above x_compute_root_window_offset for</em>
<a id='L20668' name='L20668'></a> 20668 <em class='comment'>             why this optimization is performed.  */</em>
<a id='L20669' name='L20669'></a> 20669           x_compute_root_window_offset (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, event-&gt;xmotion.x_root,
<a id='L20670' name='L20670'></a> 20670                                         event-&gt;xmotion.y_root,
<a id='L20671' name='L20671'></a> 20671                                         event-&gt;xmotion.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>,
<a id='L20672' name='L20672'></a> 20672                                         event-&gt;xmotion.y);
<a id='L20673' name='L20673'></a> 20673 
<a id='L20674' name='L20674'></a> 20674         <strong class='reserved'>if</strong> (x_dnd_in_progress
<a id='L20675' name='L20675'></a> 20675             <em class='comment'>/* Handle these events normally if the recursion</em>
<a id='L20676' name='L20676'></a> 20676 <em class='comment'>               level is higher than when the drag-and-drop</em>
<a id='L20677' name='L20677'></a> 20677 <em class='comment'>               operation was initiated.  This is so that mouse</em>
<a id='L20678' name='L20678'></a> 20678 <em class='comment'>               input works while we're in the debugger for, say,</em>
<a id='L20679' name='L20679'></a> 20679 <em class='comment'>               `x-dnd-movement-function`.  */</em>
<a id='L20680' name='L20680'></a> 20680             &amp;&amp; (command_loop_level + minibuf_level
<a id='L20681' name='L20681'></a> 20681                 &lt;= x_dnd_recursion_depth)
<a id='L20682' name='L20682'></a> 20682             &amp;&amp; dpyinfo == <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (x_dnd_frame))
<a id='L20683' name='L20683'></a> 20683           <em class='brace'>{</em>
<a id='L20684' name='L20684'></a> 20684             <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> target, toplevel;
<a id='L20685' name='L20685'></a> 20685             <strong class='reserved'>int</strong> target_proto, motif_style;
<a id='L20686' name='L20686'></a> 20686             <a href='../D/20054.html' title='Multiple defined in 2 places.'>xm_top_level_leave_message</a> lmsg;
<a id='L20687' name='L20687'></a> 20687             <a href='../D/20053.html' title='Multiple defined in 2 places.'>xm_top_level_enter_message</a> emsg;
<a id='L20688' name='L20688'></a> 20688             <a href='../D/20008.html' title='Multiple defined in 2 places.'>xm_drag_motion_message</a> dmsg;
<a id='L20689' name='L20689'></a> 20689             <a href='../S/2150.html#L62' title='Defined at 62 in src/pgtkgui.h.'>XRectangle</a> *r;
<a id='L20690' name='L20690'></a> 20690             <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> was_frame;
<a id='L20691' name='L20691'></a> 20691 
<a id='L20692' name='L20692'></a> 20692             <em class='comment'>/* Always clear mouse face.  */</em>
<a id='L20693' name='L20693'></a> 20693             <a href='../S/2224.html#L34014' title='Defined at 34014 in src/xdisp.c.'>clear_mouse_face</a> (hlinfo);
<a id='L20694' name='L20694'></a> 20694             hlinfo-&gt;mouse_face_hidden = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L20695' name='L20695'></a> 20695 
<a id='L20696' name='L20696'></a> 20696             <em class='comment'>/* Sometimes the drag-and-drop operation starts with the</em>
<a id='L20697' name='L20697'></a> 20697 <em class='comment'>               pointer of a frame invisible due to input.  Since</em>
<a id='L20698' name='L20698'></a> 20698 <em class='comment'>               motion events are ignored during that, make the pointer</em>
<a id='L20699' name='L20699'></a> 20699 <em class='comment'>               visible manually.  */</em>
<a id='L20700' name='L20700'></a> 20700 
<a id='L20701' name='L20701'></a> 20701             <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L20702' name='L20702'></a> 20702               <em class='brace'>{</em>
<a id='L20703' name='L20703'></a> 20703                 <a href='../S/2289.html#L11867' title='Defined at 11867 in src/xterm.c.'>XTtoggle_invisible_pointer</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L20704' name='L20704'></a> 20704 
<a id='L20705' name='L20705'></a> 20705                 r = &amp;dpyinfo-&gt;last_mouse_glyph;
<a id='L20706' name='L20706'></a> 20706 
<a id='L20707' name='L20707'></a> 20707                 <em class='comment'>/* Also remember the mouse glyph and set</em>
<a id='L20708' name='L20708'></a> 20708 <em class='comment'>                   mouse_moved.  */</em>
<a id='L20709' name='L20709'></a> 20709                 <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> != dpyinfo-&gt;last_mouse_glyph_frame
<a id='L20710' name='L20710'></a> 20710                     || event-&gt;xmotion.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> &lt; r-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>
<a id='L20711' name='L20711'></a> 20711                     || event-&gt;xmotion.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> &gt;= r-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + r-&gt;width
<a id='L20712' name='L20712'></a> 20712                     || event-&gt;xmotion.y &lt; r-&gt;y
<a id='L20713' name='L20713'></a> 20713                     || event-&gt;xmotion.y &gt;= r-&gt;y + r-&gt;height)
<a id='L20714' name='L20714'></a> 20714                   <em class='brace'>{</em>
<a id='L20715' name='L20715'></a> 20715                     <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;mouse_moved = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L20716' name='L20716'></a> 20716                     <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;last_mouse_device = Qnil;
<a id='L20717' name='L20717'></a> 20717                     dpyinfo-&gt;last_mouse_scroll_bar = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L20718' name='L20718'></a> 20718 
<a id='L20719' name='L20719'></a> 20719                     <a href='../S/2224.html#L2719' title='Defined at 2719 in src/xdisp.c.'>remember_mouse_glyph</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, event-&gt;xmotion.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>,
<a id='L20720' name='L20720'></a> 20720                                           event-&gt;xmotion.y, r);
<a id='L20721' name='L20721'></a> 20721                     dpyinfo-&gt;last_mouse_glyph_frame = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L20722' name='L20722'></a> 20722                   <em class='brace'>}</em>
<a id='L20723' name='L20723'></a> 20723               <em class='brace'>}</em>
<a id='L20724' name='L20724'></a> 20724 
<a id='L20725' name='L20725'></a> 20725             <strong class='reserved'>if</strong> (event-&gt;xmotion.same_screen)
<a id='L20726' name='L20726'></a> 20726               target = <a href='../S/2289.html#L4131' title='Defined at 4131 in src/xterm.c.'>x_dnd_get_target_window</a> (dpyinfo,
<a id='L20727' name='L20727'></a> 20727                                                 event-&gt;xmotion.x_root,
<a id='L20728' name='L20728'></a> 20728                                                 event-&gt;xmotion.y_root,
<a id='L20729' name='L20729'></a> 20729                                                 &amp;target_proto,
<a id='L20730' name='L20730'></a> 20730                                                 &amp;motif_style, &amp;toplevel,
<a id='L20731' name='L20731'></a> 20731                                                 &amp;was_frame);
<a id='L20732' name='L20732'></a> 20732             <strong class='reserved'>else</strong>
<a id='L20733' name='L20733'></a> 20733               target = <a href='../S/2289.html#L4119' title='Defined at 4119 in src/xterm.c.'>x_dnd_fill_empty_target</a> (&amp;target_proto, &amp;motif_style,
<a id='L20734' name='L20734'></a> 20734                                                 &amp;toplevel, &amp;was_frame);
<a id='L20735' name='L20735'></a> 20735 
<a id='L20736' name='L20736'></a> 20736             <strong class='reserved'>if</strong> (toplevel != x_dnd_last_seen_toplevel)
<a id='L20737' name='L20737'></a> 20737               <em class='brace'>{</em>
<a id='L20738' name='L20738'></a> 20738                 <strong class='reserved'>if</strong> (toplevel != <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (x_dnd_frame)
<a id='L20739' name='L20739'></a> 20739                     &amp;&amp; x_dnd_return_frame == 1)
<a id='L20740' name='L20740'></a> 20740                   x_dnd_return_frame = 2;
<a id='L20741' name='L20741'></a> 20741 
<a id='L20742' name='L20742'></a> 20742                 <strong class='reserved'>if</strong> (x_dnd_return_frame == 2
<a id='L20743' name='L20743'></a> 20743                     &amp;&amp; <a href='../D/19416.html' title='Multiple defined in 2 places.'>x_any_window_to_frame</a> (dpyinfo, toplevel))
<a id='L20744' name='L20744'></a> 20744                   <em class='brace'>{</em>
<a id='L20745' name='L20745'></a> 20745                     <strong class='reserved'>if</strong> (x_dnd_last_seen_window != None
<a id='L20746' name='L20746'></a> 20746                         &amp;&amp; x_dnd_last_protocol_version != -1
<a id='L20747' name='L20747'></a> 20747                         &amp;&amp; x_dnd_last_seen_window != <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (x_dnd_frame))
<a id='L20748' name='L20748'></a> 20748                       <a href='../S/2289.html#L4649' title='Defined at 4649 in src/xterm.c.'>x_dnd_send_leave</a> (x_dnd_frame, x_dnd_last_seen_window,
<a id='L20749' name='L20749'></a> 20749                                         x_dnd_last_seen_toplevel);
<a id='L20750' name='L20750'></a> 20750                     <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (x_dnd_last_seen_window != None
<a id='L20751' name='L20751'></a> 20751                              &amp;&amp; <a href='../S/2289.html#L1750' title='Defined at 1750 in src/xterm.c.'>XM_DRAG_STYLE_IS_DYNAMIC</a> (x_dnd_last_motif_style)
<a id='L20752' name='L20752'></a> 20752                              &amp;&amp; !x_dnd_disable_motif_drag
<a id='L20753' name='L20753'></a> 20753                              &amp;&amp; x_dnd_last_seen_window != <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (x_dnd_frame))
<a id='L20754' name='L20754'></a> 20754                       <em class='brace'>{</em>
<a id='L20755' name='L20755'></a> 20755                         <strong class='reserved'>if</strong> (!x_dnd_motif_setup_p)
<a id='L20756' name='L20756'></a> 20756                           <a href='../S/2289.html#L2528' title='Defined at 2528 in src/xterm.c.'>xm_setup_drag_info</a> (dpyinfo, x_dnd_frame);
<a id='L20757' name='L20757'></a> 20757 
<a id='L20758' name='L20758'></a> 20758                         lmsg.reason = <a href='../S/2289.html#L1718' title='Defined at 1718 in src/xterm.c.'>XM_DRAG_REASON</a> (<a href='../S/2289.html#L1732' title='Defined at 1732 in src/xterm.c.'>XM_DRAG_ORIGINATOR_INITIATOR</a>,
<a id='L20759' name='L20759'></a> 20759                                                       <a href='../S/2289.html#L1726' title='Defined at 1726 in src/xterm.c.'>XM_DRAG_REASON_TOP_LEVEL_LEAVE</a>);
<a id='L20760' name='L20760'></a> 20760                         lmsg.byteorder = <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>;
<a id='L20761' name='L20761'></a> 20761                         lmsg.zero = 0;
<a id='L20762' name='L20762'></a> 20762                         lmsg.timestamp = event-&gt;xmotion.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L20763' name='L20763'></a> 20763                         lmsg.source_window = <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (x_dnd_frame);
<a id='L20764' name='L20764'></a> 20764 
<a id='L20765' name='L20765'></a> 20765                         <strong class='reserved'>if</strong> (x_dnd_motif_setup_p)
<a id='L20766' name='L20766'></a> 20766                           <a href='../S/2289.html#L2648' title='Defined at 2648 in src/xterm.c.'>xm_send_top_level_leave_message</a> (dpyinfo, <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (x_dnd_frame),
<a id='L20767' name='L20767'></a> 20767                                                            x_dnd_last_seen_window, &amp;lmsg);
<a id='L20768' name='L20768'></a> 20768                       <em class='brace'>}</em>
<a id='L20769' name='L20769'></a> 20769 
<a id='L20770' name='L20770'></a> 20770                     x_dnd_end_window = x_dnd_last_seen_window;
<a id='L20771' name='L20771'></a> 20771                     x_dnd_last_seen_window = None;
<a id='L20772' name='L20772'></a> 20772                     x_dnd_last_seen_toplevel = None;
<a id='L20773' name='L20773'></a> 20773                     x_dnd_in_progress = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L20774' name='L20774'></a> 20774                     x_dnd_return_frame_object
<a id='L20775' name='L20775'></a> 20775                       = <a href='../D/19416.html' title='Multiple defined in 2 places.'>x_any_window_to_frame</a> (dpyinfo, toplevel);
<a id='L20776' name='L20776'></a> 20776                     x_dnd_return_frame = 3;
<a id='L20777' name='L20777'></a> 20777                     x_dnd_waiting_for_finish = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L20778' name='L20778'></a> 20778                     target = None;
<a id='L20779' name='L20779'></a> 20779                   <em class='brace'>}</em>
<a id='L20780' name='L20780'></a> 20780               <em class='brace'>}</em>
<a id='L20781' name='L20781'></a> 20781 
<a id='L20782' name='L20782'></a> 20782             <strong class='reserved'>if</strong> (target != x_dnd_last_seen_window)
<a id='L20783' name='L20783'></a> 20783               <em class='brace'>{</em>
<a id='L20784' name='L20784'></a> 20784                 <strong class='reserved'>if</strong> (x_dnd_last_seen_window != None
<a id='L20785' name='L20785'></a> 20785                     &amp;&amp; x_dnd_last_protocol_version != -1
<a id='L20786' name='L20786'></a> 20786                     &amp;&amp; x_dnd_last_seen_window != <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (x_dnd_frame))
<a id='L20787' name='L20787'></a> 20787                   <a href='../S/2289.html#L4649' title='Defined at 4649 in src/xterm.c.'>x_dnd_send_leave</a> (x_dnd_frame, x_dnd_last_seen_window,
<a id='L20788' name='L20788'></a> 20788                                     x_dnd_last_seen_toplevel);
<a id='L20789' name='L20789'></a> 20789                 <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (x_dnd_last_seen_window != None
<a id='L20790' name='L20790'></a> 20790                          &amp;&amp; <a href='../S/2289.html#L1750' title='Defined at 1750 in src/xterm.c.'>XM_DRAG_STYLE_IS_DYNAMIC</a> (x_dnd_last_motif_style)
<a id='L20791' name='L20791'></a> 20791                          &amp;&amp; x_dnd_disable_motif_drag
<a id='L20792' name='L20792'></a> 20792                          &amp;&amp; x_dnd_last_seen_window != <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (x_dnd_frame))
<a id='L20793' name='L20793'></a> 20793                   <em class='brace'>{</em>
<a id='L20794' name='L20794'></a> 20794                     <strong class='reserved'>if</strong> (!x_dnd_motif_setup_p)
<a id='L20795' name='L20795'></a> 20795                       <a href='../S/2289.html#L2528' title='Defined at 2528 in src/xterm.c.'>xm_setup_drag_info</a> (dpyinfo, x_dnd_frame);
<a id='L20796' name='L20796'></a> 20796 
<a id='L20797' name='L20797'></a> 20797                     <em class='comment'>/* This is apparently required.  If we don't send</em>
<a id='L20798' name='L20798'></a> 20798 <em class='comment'>                       a motion event with the current root window</em>
<a id='L20799' name='L20799'></a> 20799 <em class='comment'>                       coordinates of the pointer before the top level</em>
<a id='L20800' name='L20800'></a> 20800 <em class='comment'>                       leave, then Motif displays an ugly black border</em>
<a id='L20801' name='L20801'></a> 20801 <em class='comment'>                       around the previous drop site.  */</em>
<a id='L20802' name='L20802'></a> 20802 
<a id='L20803' name='L20803'></a> 20803                     dmsg.reason = <a href='../S/2289.html#L1718' title='Defined at 1718 in src/xterm.c.'>XM_DRAG_REASON</a> (<a href='../S/2289.html#L1732' title='Defined at 1732 in src/xterm.c.'>XM_DRAG_ORIGINATOR_INITIATOR</a>,
<a id='L20804' name='L20804'></a> 20804                                                   <a href='../S/2289.html#L1727' title='Defined at 1727 in src/xterm.c.'>XM_DRAG_REASON_DRAG_MOTION</a>);
<a id='L20805' name='L20805'></a> 20805                     dmsg.byteorder = <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>;
<a id='L20806' name='L20806'></a> 20806                     dmsg.side_effects = <a href='../S/2289.html#L1689' title='Defined at 1689 in src/xterm.c.'>XM_DRAG_SIDE_EFFECT</a> (<a href='../S/2289.html#L1766' title='Defined at 1766 in src/xterm.c.'>xm_side_effect_from_action</a> (dpyinfo,
<a id='L20807' name='L20807'></a> 20807                                                                                          x_dnd_wanted_action),
<a id='L20808' name='L20808'></a> 20808                                                              <a href='../S/2289.html#L1758' title='Defined at 1758 in src/xterm.c.'>XM_DROP_SITE_NONE</a>, x_dnd_motif_operations,
<a id='L20809' name='L20809'></a> 20809                                                              <a href='../S/2289.html#L1715' title='Defined at 1715 in src/xterm.c.'>XM_DROP_ACTION_DROP_CANCEL</a>);
<a id='L20810' name='L20810'></a> 20810                     dmsg.timestamp = event-&gt;xmotion.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L20811' name='L20811'></a> 20811                     dmsg.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = event-&gt;xmotion.x_root;
<a id='L20812' name='L20812'></a> 20812                     dmsg.y = event-&gt;xmotion.y_root;
<a id='L20813' name='L20813'></a> 20813 
<a id='L20814' name='L20814'></a> 20814                     lmsg.reason = <a href='../S/2289.html#L1718' title='Defined at 1718 in src/xterm.c.'>XM_DRAG_REASON</a> (<a href='../S/2289.html#L1732' title='Defined at 1732 in src/xterm.c.'>XM_DRAG_ORIGINATOR_INITIATOR</a>,
<a id='L20815' name='L20815'></a> 20815                                                   <a href='../S/2289.html#L1726' title='Defined at 1726 in src/xterm.c.'>XM_DRAG_REASON_TOP_LEVEL_LEAVE</a>);
<a id='L20816' name='L20816'></a> 20816                     lmsg.byteorder = <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>;
<a id='L20817' name='L20817'></a> 20817                     lmsg.zero = 0;
<a id='L20818' name='L20818'></a> 20818                     lmsg.timestamp = event-&gt;xbutton.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L20819' name='L20819'></a> 20819                     lmsg.source_window = <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (x_dnd_frame);
<a id='L20820' name='L20820'></a> 20820 
<a id='L20821' name='L20821'></a> 20821                     <strong class='reserved'>if</strong> (x_dnd_motif_setup_p)
<a id='L20822' name='L20822'></a> 20822                       <em class='brace'>{</em>
<a id='L20823' name='L20823'></a> 20823                         <a href='../S/2289.html#L2617' title='Defined at 2617 in src/xterm.c.'>xm_send_drag_motion_message</a> (dpyinfo, <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (x_dnd_frame),
<a id='L20824' name='L20824'></a> 20824                                                      x_dnd_last_seen_window, &amp;dmsg);
<a id='L20825' name='L20825'></a> 20825                         <a href='../S/2289.html#L2648' title='Defined at 2648 in src/xterm.c.'>xm_send_top_level_leave_message</a> (dpyinfo, <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (x_dnd_frame),
<a id='L20826' name='L20826'></a> 20826                                                          x_dnd_last_seen_window, &amp;lmsg);
<a id='L20827' name='L20827'></a> 20827                       <em class='brace'>}</em>
<a id='L20828' name='L20828'></a> 20828                   <em class='brace'>}</em>
<a id='L20829' name='L20829'></a> 20829 
<a id='L20830' name='L20830'></a> 20830                 x_dnd_action = None;
<a id='L20831' name='L20831'></a> 20831                 x_dnd_last_seen_toplevel = toplevel;
<a id='L20832' name='L20832'></a> 20832                 x_dnd_last_seen_window = target;
<a id='L20833' name='L20833'></a> 20833                 x_dnd_last_protocol_version = target_proto;
<a id='L20834' name='L20834'></a> 20834                 x_dnd_last_motif_style = motif_style;
<a id='L20835' name='L20835'></a> 20835                 x_dnd_last_window_is_frame = was_frame;
<a id='L20836' name='L20836'></a> 20836 
<a id='L20837' name='L20837'></a> 20837                 <strong class='reserved'>if</strong> (target != None &amp;&amp; x_dnd_last_protocol_version != -1)
<a id='L20838' name='L20838'></a> 20838                   <a href='../S/2289.html#L4536' title='Defined at 4536 in src/xterm.c.'>x_dnd_send_enter</a> (x_dnd_frame, target,
<a id='L20839' name='L20839'></a> 20839                                     x_dnd_last_seen_toplevel,
<a id='L20840' name='L20840'></a> 20840                                     x_dnd_last_protocol_version);
<a id='L20841' name='L20841'></a> 20841                 <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (target != None &amp;&amp; <a href='../S/2289.html#L1750' title='Defined at 1750 in src/xterm.c.'>XM_DRAG_STYLE_IS_DYNAMIC</a> (x_dnd_last_motif_style)
<a id='L20842' name='L20842'></a> 20842                          &amp;&amp; !x_dnd_disable_motif_drag)
<a id='L20843' name='L20843'></a> 20843                   <em class='brace'>{</em>
<a id='L20844' name='L20844'></a> 20844                     <strong class='reserved'>if</strong> (!x_dnd_motif_setup_p)
<a id='L20845' name='L20845'></a> 20845                       <a href='../S/2289.html#L2528' title='Defined at 2528 in src/xterm.c.'>xm_setup_drag_info</a> (dpyinfo, x_dnd_frame);
<a id='L20846' name='L20846'></a> 20846 
<a id='L20847' name='L20847'></a> 20847                     emsg.reason = <a href='../S/2289.html#L1718' title='Defined at 1718 in src/xterm.c.'>XM_DRAG_REASON</a> (<a href='../S/2289.html#L1732' title='Defined at 1732 in src/xterm.c.'>XM_DRAG_ORIGINATOR_INITIATOR</a>,
<a id='L20848' name='L20848'></a> 20848                                                   <a href='../S/2289.html#L1725' title='Defined at 1725 in src/xterm.c.'>XM_DRAG_REASON_TOP_LEVEL_ENTER</a>);
<a id='L20849' name='L20849'></a> 20849                     emsg.byteorder = <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>;
<a id='L20850' name='L20850'></a> 20850                     emsg.zero = 0;
<a id='L20851' name='L20851'></a> 20851                     emsg.timestamp = event-&gt;xbutton.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L20852' name='L20852'></a> 20852                     emsg.source_window = <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (x_dnd_frame);
<a id='L20853' name='L20853'></a> 20853                     emsg.index_atom = x_dnd_motif_atom;
<a id='L20854' name='L20854'></a> 20854 
<a id='L20855' name='L20855'></a> 20855                     <strong class='reserved'>if</strong> (x_dnd_motif_setup_p)
<a id='L20856' name='L20856'></a> 20856                       <a href='../S/2289.html#L2590' title='Defined at 2590 in src/xterm.c.'>xm_send_top_level_enter_message</a> (dpyinfo, <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (x_dnd_frame),
<a id='L20857' name='L20857'></a> 20857                                                        target, &amp;emsg);
<a id='L20858' name='L20858'></a> 20858                   <em class='brace'>}</em>
<a id='L20859' name='L20859'></a> 20859               <em class='brace'>}</em>
<a id='L20860' name='L20860'></a> 20860             <strong class='reserved'>else</strong>
<a id='L20861' name='L20861'></a> 20861               x_dnd_last_seen_toplevel = toplevel;
<a id='L20862' name='L20862'></a> 20862 
<a id='L20863' name='L20863'></a> 20863             <strong class='reserved'>if</strong> (x_dnd_last_window_is_frame &amp;&amp; target != None)
<a id='L20864' name='L20864'></a> 20864               <a href='../S/2289.html#L4924' title='Defined at 4924 in src/xterm.c.'>x_dnd_note_self_position</a> (dpyinfo, target,
<a id='L20865' name='L20865'></a> 20865                                         event-&gt;xbutton.x_root,
<a id='L20866' name='L20866'></a> 20866                                         event-&gt;xbutton.y_root);
<a id='L20867' name='L20867'></a> 20867             <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (x_dnd_last_protocol_version != -1 &amp;&amp; target != None)
<a id='L20868' name='L20868'></a> 20868               <a href='../S/2289.html#L4574' title='Defined at 4574 in src/xterm.c.'>x_dnd_send_position</a> (x_dnd_frame, target,
<a id='L20869' name='L20869'></a> 20869                                    x_dnd_last_seen_toplevel,
<a id='L20870' name='L20870'></a> 20870                                    x_dnd_last_protocol_version,
<a id='L20871' name='L20871'></a> 20871                                    event-&gt;xmotion.x_root,
<a id='L20872' name='L20872'></a> 20872                                    event-&gt;xmotion.y_root,
<a id='L20873' name='L20873'></a> 20873                                    x_dnd_selection_timestamp,
<a id='L20874' name='L20874'></a> 20874                                    x_dnd_wanted_action, 0,
<a id='L20875' name='L20875'></a> 20875                                    event-&gt;xmotion.state);
<a id='L20876' name='L20876'></a> 20876             <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (<a href='../S/2289.html#L1750' title='Defined at 1750 in src/xterm.c.'>XM_DRAG_STYLE_IS_DYNAMIC</a> (x_dnd_last_motif_style) &amp;&amp; target != None
<a id='L20877' name='L20877'></a> 20877                      &amp;&amp; !x_dnd_disable_motif_drag)
<a id='L20878' name='L20878'></a> 20878               <em class='brace'>{</em>
<a id='L20879' name='L20879'></a> 20879                 <strong class='reserved'>if</strong> (!x_dnd_motif_setup_p)
<a id='L20880' name='L20880'></a> 20880                   <a href='../S/2289.html#L2528' title='Defined at 2528 in src/xterm.c.'>xm_setup_drag_info</a> (dpyinfo, x_dnd_frame);
<a id='L20881' name='L20881'></a> 20881 
<a id='L20882' name='L20882'></a> 20882                 dmsg.reason = <a href='../S/2289.html#L1718' title='Defined at 1718 in src/xterm.c.'>XM_DRAG_REASON</a> (<a href='../S/2289.html#L1732' title='Defined at 1732 in src/xterm.c.'>XM_DRAG_ORIGINATOR_INITIATOR</a>,
<a id='L20883' name='L20883'></a> 20883                                               <a href='../S/2289.html#L1727' title='Defined at 1727 in src/xterm.c.'>XM_DRAG_REASON_DRAG_MOTION</a>);
<a id='L20884' name='L20884'></a> 20884                 dmsg.byteorder = <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>;
<a id='L20885' name='L20885'></a> 20885                 dmsg.side_effects = <a href='../S/2289.html#L1689' title='Defined at 1689 in src/xterm.c.'>XM_DRAG_SIDE_EFFECT</a> (<a href='../S/2289.html#L1766' title='Defined at 1766 in src/xterm.c.'>xm_side_effect_from_action</a> (dpyinfo,
<a id='L20886' name='L20886'></a> 20886                                                                                      x_dnd_wanted_action),
<a id='L20887' name='L20887'></a> 20887                                                          <a href='../S/2289.html#L1756' title='Defined at 1756 in src/xterm.c.'>XM_DROP_SITE_VALID</a>, x_dnd_motif_operations,
<a id='L20888' name='L20888'></a> 20888                                                          (!x_dnd_xm_use_help
<a id='L20889' name='L20889'></a> 20889                                                           ? <a href='../S/2289.html#L1713' title='Defined at 1713 in src/xterm.c.'>XM_DROP_ACTION_DROP</a>
<a id='L20890' name='L20890'></a> 20890                                                           : <a href='../S/2289.html#L1714' title='Defined at 1714 in src/xterm.c.'>XM_DROP_ACTION_DROP_HELP</a>));
<a id='L20891' name='L20891'></a> 20891                 dmsg.timestamp = event-&gt;xbutton.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L20892' name='L20892'></a> 20892                 dmsg.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = event-&gt;xmotion.x_root;
<a id='L20893' name='L20893'></a> 20893                 dmsg.y = event-&gt;xmotion.y_root;
<a id='L20894' name='L20894'></a> 20894 
<a id='L20895' name='L20895'></a> 20895                 <strong class='reserved'>if</strong> (x_dnd_motif_setup_p)
<a id='L20896' name='L20896'></a> 20896                   <a href='../S/2289.html#L2617' title='Defined at 2617 in src/xterm.c.'>xm_send_drag_motion_message</a> (dpyinfo, <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (x_dnd_frame),
<a id='L20897' name='L20897'></a> 20897                                                target, &amp;dmsg);
<a id='L20898' name='L20898'></a> 20898               <em class='brace'>}</em>
<a id='L20899' name='L20899'></a> 20899 
<a id='L20900' name='L20900'></a> 20900             x_dnd_update_tooltip_position (event-&gt;xmotion.x_root,
<a id='L20901' name='L20901'></a> 20901                                            event-&gt;xmotion.y_root);
<a id='L20902' name='L20902'></a> 20902 
<a id='L20903' name='L20903'></a> 20903             <strong class='reserved'>goto</strong> OTHER;
<a id='L20904' name='L20904'></a> 20904           <em class='brace'>}</em>
<a id='L20905' name='L20905'></a> 20905 
<a id='L20906' name='L20906'></a> 20906 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L20907' name='L20907'></a> 20907         <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; <a href='../S/2362.html#L5047' title='Defined at 5047 in src/gtkutil.c.'>xg_event_is_for_scrollbar</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, event, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>))
<a id='L20908' name='L20908'></a> 20908           <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = 0;
<a id='L20909' name='L20909'></a> 20909 <em class='sharp'>#endif</em>
<a id='L20910' name='L20910'></a> 20910 <em class='sharp'>#ifdef</em> HAVE_XWIDGETS
<a id='L20911' name='L20911'></a> 20911         <strong class='reserved'>struct</strong> <a href='../S/2261.html#L102' title='Defined at 102 in src/xwidget.h.'>xwidget_view</a> *xvw;
<a id='L20912' name='L20912'></a> 20912 
<a id='L20913' name='L20913'></a> 20913         xvw = <a href='../S/2334.html#L2116' title='Defined at 2116 in src/xwidget.c.'>xwidget_view_from_window</a> (event-&gt;xmotion.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L20914' name='L20914'></a> 20914 
<a id='L20915' name='L20915'></a> 20915         <strong class='reserved'>if</strong> (xvw)
<a id='L20916' name='L20916'></a> 20916           <a href='../S/2334.html#L1924' title='Defined at 1924 in src/xwidget.c.'>xwidget_motion_or_crossing</a> (xvw, event);
<a id='L20917' name='L20917'></a> 20917 <em class='sharp'>#endif</em>
<a id='L20918' name='L20918'></a> 20918         <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L20919' name='L20919'></a> 20919           <em class='brace'>{</em>
<a id='L20920' name='L20920'></a> 20920             <em class='comment'>/* Maybe generate a SELECT_WINDOW_EVENT for</em>
<a id='L20921' name='L20921'></a> 20921 <em class='comment'>               `mouse-autoselect-window' but don't let popup menus</em>
<a id='L20922' name='L20922'></a> 20922 <em class='comment'>               interfere with this (Bug#1261).  */</em>
<a id='L20923' name='L20923'></a> 20923             <strong class='reserved'>if</strong> (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (Vmouse_autoselect_window)
<a id='L20924' name='L20924'></a> 20924                 &amp;&amp; !<a href='../D/15672.html' title='Multiple defined in 5 places.'>popup_activated</a> ()
<a id='L20925' name='L20925'></a> 20925                 <em class='comment'>/* Don't switch if we're currently in the minibuffer.</em>
<a id='L20926' name='L20926'></a> 20926 <em class='comment'>                   This tries to work around problems where the</em>
<a id='L20927' name='L20927'></a> 20927 <em class='comment'>                   minibuffer gets unselected unexpectedly, and where</em>
<a id='L20928' name='L20928'></a> 20928 <em class='comment'>                   you then have to move your mouse all the way down to</em>
<a id='L20929' name='L20929'></a> 20929 <em class='comment'>                   the minibuffer to select it.  */</em>
<a id='L20930' name='L20930'></a> 20930                 &amp;&amp; !<a href='../S/2317.html#L558' title='Defined at 558 in src/window.h.'>MINI_WINDOW_P</a> (<a href='../D/7409.html' title='Multiple defined in 2 places.'>XWINDOW</a> (selected_window))
<a id='L20931' name='L20931'></a> 20931                 <em class='comment'>/* With `focus-follows-mouse' non-nil create an event</em>
<a id='L20932' name='L20932'></a> 20932 <em class='comment'>                   also when the target window is on another frame.  */</em>
<a id='L20933' name='L20933'></a> 20933                 &amp;&amp; (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> == <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (selected_frame)
<a id='L20934' name='L20934'></a> 20934                     || !<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (focus_follows_mouse)))
<a id='L20935' name='L20935'></a> 20935               <em class='brace'>{</em>
<a id='L20936' name='L20936'></a> 20936                 <strong class='reserved'>static</strong> <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> last_mouse_window;
<a id='L20937' name='L20937'></a> 20937 
<a id='L20938' name='L20938'></a> 20938                 <strong class='reserved'>if</strong> (xmotion.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> != <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L20939' name='L20939'></a> 20939                   <em class='brace'>{</em>
<a id='L20940' name='L20940'></a> 20940                     x_translate_coordinates (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, xmotion.x_root, xmotion.y_root,
<a id='L20941' name='L20941'></a> 20941                                              &amp;xmotion.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, &amp;xmotion.y);
<a id='L20942' name='L20942'></a> 20942                     xmotion.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L20943' name='L20943'></a> 20943                   <em class='brace'>}</em>
<a id='L20944' name='L20944'></a> 20944 
<a id='L20945' name='L20945'></a> 20945                 <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = <a href='../S/2108.html#L1682' title='Defined at 1682 in src/window.c.'>window_from_coordinates</a>
<a id='L20946' name='L20946'></a> 20946                   (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, xmotion.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, xmotion.y, 0, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L20947' name='L20947'></a> 20947 
<a id='L20948' name='L20948'></a> 20948                 <em class='comment'>/* A window will be autoselected only when it is not</em>
<a id='L20949' name='L20949'></a> 20949 <em class='comment'>                   selected now and the last mouse movement event was</em>
<a id='L20950' name='L20950'></a> 20950 <em class='comment'>                   not in it.  The remainder of the code is a bit vague</em>
<a id='L20951' name='L20951'></a> 20951 <em class='comment'>                   wrt what a "window" is.  For immediate autoselection,</em>
<a id='L20952' name='L20952'></a> 20952 <em class='comment'>                   the window is usually the entire window but for GTK</em>
<a id='L20953' name='L20953'></a> 20953 <em class='comment'>                   where the scroll bars don't count.  For delayed</em>
<a id='L20954' name='L20954'></a> 20954 <em class='comment'>                   autoselection the window is usually the window's text</em>
<a id='L20955' name='L20955'></a> 20955 <em class='comment'>                   area including the margins.  */</em>
<a id='L20956' name='L20956'></a> 20956                 <strong class='reserved'>if</strong> (<a href='../D/6789.html' title='Multiple defined in 2 places.'>WINDOWP</a> (<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>)
<a id='L20957' name='L20957'></a> 20957                     &amp;&amp; !<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, last_mouse_window)
<a id='L20958' name='L20958'></a> 20958                     &amp;&amp; !<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, selected_window))
<a id='L20959' name='L20959'></a> 20959                   <em class='brace'>{</em>
<a id='L20960' name='L20960'></a> 20960                     inev.ie.kind = <a href='../S/2231.html#L242' title='Defined at 242 in src/termhooks.h.'>SELECT_WINDOW_EVENT</a>;
<a id='L20961' name='L20961'></a> 20961                     inev.ie.frame_or_window = <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>;
<a id='L20962' name='L20962'></a> 20962                   <em class='brace'>}</em>
<a id='L20963' name='L20963'></a> 20963 
<a id='L20964' name='L20964'></a> 20964                 <em class='comment'>/* Remember the last window where we saw the mouse.  */</em>
<a id='L20965' name='L20965'></a> 20965                 last_mouse_window = <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>;
<a id='L20966' name='L20966'></a> 20966               <em class='brace'>}</em>
<a id='L20967' name='L20967'></a> 20967 
<a id='L20968' name='L20968'></a> 20968             <strong class='reserved'>if</strong> (!x_note_mouse_movement (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, &amp;xmotion, Qnil))
<a id='L20969' name='L20969'></a> 20969               help_echo_string = previous_help_echo_string;
<a id='L20970' name='L20970'></a> 20970           <em class='brace'>}</em>
<a id='L20971' name='L20971'></a> 20971         <strong class='reserved'>else</strong>
<a id='L20972' name='L20972'></a> 20972           <em class='brace'>{</em>
<a id='L20973' name='L20973'></a> 20973 <em class='sharp'>#ifndef</em> USE_TOOLKIT_SCROLL_BARS
<a id='L20974' name='L20974'></a> 20974             <strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>
<a id='L20975' name='L20975'></a> 20975               = x_window_to_scroll_bar (event-&gt;xmotion.<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L20976' name='L20976'></a> 20976                                         event-&gt;xmotion.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, 2);
<a id='L20977' name='L20977'></a> 20977 
<a id='L20978' name='L20978'></a> 20978             <strong class='reserved'>if</strong> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>)
<a id='L20979' name='L20979'></a> 20979               x_scroll_bar_note_movement (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>, &amp;event-&gt;xmotion);
<a id='L20980' name='L20980'></a> 20980 <em class='sharp'>#endif</em> <em class='comment'>/* USE_TOOLKIT_SCROLL_BARS */</em>
<a id='L20981' name='L20981'></a> 20981 
<a id='L20982' name='L20982'></a> 20982             <em class='comment'>/* If we move outside the frame, then we're</em>
<a id='L20983' name='L20983'></a> 20983 <em class='comment'>               certainly no longer on any text in the frame.  */</em>
<a id='L20984' name='L20984'></a> 20984             <a href='../S/2224.html#L34014' title='Defined at 34014 in src/xdisp.c.'>clear_mouse_face</a> (hlinfo);
<a id='L20985' name='L20985'></a> 20985           <em class='brace'>}</em>
<a id='L20986' name='L20986'></a> 20986 
<a id='L20987' name='L20987'></a> 20987         <em class='comment'>/* If the contents of the global variable help_echo_string</em>
<a id='L20988' name='L20988'></a> 20988 <em class='comment'>           has changed, generate a HELP_EVENT.  */</em>
<a id='L20989' name='L20989'></a> 20989         <strong class='reserved'>if</strong> (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (help_echo_string)
<a id='L20990' name='L20990'></a> 20990             || !<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (previous_help_echo_string))
<a id='L20991' name='L20991'></a> 20991           do_help = 1;
<a id='L20992' name='L20992'></a> 20992 
<a id='L20993' name='L20993'></a> 20993         <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L20994' name='L20994'></a> 20994           x_flush_dirty_back_buffer_on (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L20995' name='L20995'></a> 20995         <strong class='reserved'>goto</strong> OTHER;
<a id='L20996' name='L20996'></a> 20996       <em class='brace'>}</em>
<a id='L20997' name='L20997'></a> 20997 
<a id='L20998' name='L20998'></a> 20998     <strong class='reserved'>case</strong> ConfigureNotify:
<a id='L20999' name='L20999'></a> 20999       <em class='comment'>/* An opaque move can generate a stream of events as the window</em>
<a id='L21000' name='L21000'></a> 21000 <em class='comment'>         is dragged around.  If the connection round trip time isn't</em>
<a id='L21001' name='L21001'></a> 21001 <em class='comment'>         really short, they may come faster than we can respond to</em>
<a id='L21002' name='L21002'></a> 21002 <em class='comment'>         them, given the multiple queries we can do to check window</em>
<a id='L21003' name='L21003'></a> 21003 <em class='comment'>         manager state, translate coordinates, etc.</em>
<a id='L21004' name='L21004'></a> 21004 <em class='comment'></em>
<a id='L21005' name='L21005'></a> 21005 <em class='comment'>         So if this ConfigureNotify is immediately followed by another</em>
<a id='L21006' name='L21006'></a> 21006 <em class='comment'>         for the same window, use the info from the latest update, and</em>
<a id='L21007' name='L21007'></a> 21007 <em class='comment'>         consider the events all handled.  */</em>
<a id='L21008' name='L21008'></a> 21008 
<a id='L21009' name='L21009'></a> 21009       <em class='comment'>/* Opaque resize may be trickier; ConfigureNotify events are</em>
<a id='L21010' name='L21010'></a> 21010 <em class='comment'>         mixed with Expose events for multiple windows.  */</em>
<a id='L21011' name='L21011'></a> 21011       configureEvent = *event;
<a id='L21012' name='L21012'></a> 21012       <strong class='reserved'>while</strong> (XPending (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>))
<a id='L21013' name='L21013'></a> 21013         <em class='brace'>{</em>
<a id='L21014' name='L21014'></a> 21014           XNextEvent (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, &amp;next_event);
<a id='L21015' name='L21015'></a> 21015           <strong class='reserved'>if</strong> (next_event.type != ConfigureNotify
<a id='L21016' name='L21016'></a> 21016               || next_event.xconfigure.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> != event-&gt;xconfigure.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>
<a id='L21017' name='L21017'></a> 21017               <em class='comment'>/* Skipping events with different sizes can lead to a</em>
<a id='L21018' name='L21018'></a> 21018 <em class='comment'>                 mispositioned mode line at initial window creation.</em>
<a id='L21019' name='L21019'></a> 21019 <em class='comment'>                 Only drop window motion events for now.  */</em>
<a id='L21020' name='L21020'></a> 21020               || next_event.xconfigure.width != event-&gt;xconfigure.width
<a id='L21021' name='L21021'></a> 21021               || next_event.xconfigure.height != event-&gt;xconfigure.height)
<a id='L21022' name='L21022'></a> 21022             <em class='brace'>{</em>
<a id='L21023' name='L21023'></a> 21023               XPutBackEvent (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, &amp;next_event);
<a id='L21024' name='L21024'></a> 21024               <strong class='reserved'>break</strong>;
<a id='L21025' name='L21025'></a> 21025             <em class='brace'>}</em>
<a id='L21026' name='L21026'></a> 21026           <strong class='reserved'>else</strong>
<a id='L21027' name='L21027'></a> 21027             configureEvent = next_event;
<a id='L21028' name='L21028'></a> 21028         <em class='brace'>}</em>
<a id='L21029' name='L21029'></a> 21029 
<a id='L21030' name='L21030'></a> 21030       <em class='comment'>/* If we get a ConfigureNotify for the root window, this means</em>
<a id='L21031' name='L21031'></a> 21031 <em class='comment'>         the dimensions of the screen it's on changed.  */</em>
<a id='L21032' name='L21032'></a> 21032 
<a id='L21033' name='L21033'></a> 21033       <strong class='reserved'>if</strong> (configureEvent.xconfigure.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> == dpyinfo-&gt;root_window)
<a id='L21034' name='L21034'></a> 21034         <em class='brace'>{</em>
<a id='L21035' name='L21035'></a> 21035 <em class='sharp'>#ifdef</em> HAVE_XRANDR
<a id='L21036' name='L21036'></a> 21036           <em class='comment'>/* This function is OK to call even if the X server doesn't</em>
<a id='L21037' name='L21037'></a> 21037 <em class='comment'>             support RandR.  */</em>
<a id='L21038' name='L21038'></a> 21038           XRRUpdateConfiguration (&amp;configureEvent);
<a id='L21039' name='L21039'></a> 21039 <em class='sharp'>#elif</em> !<strong class='reserved'>defined</strong> USE_GTK
<a id='L21040' name='L21040'></a> 21040           <em class='comment'>/* Catch screen size changes even if RandR is not available</em>
<a id='L21041' name='L21041'></a> 21041 <em class='comment'>             on the client.  GTK does this internally.  */</em>
<a id='L21042' name='L21042'></a> 21042 
<a id='L21043' name='L21043'></a> 21043           <strong class='reserved'>if</strong> (configureEvent.xconfigure.width != dpyinfo-&gt;screen_width
<a id='L21044' name='L21044'></a> 21044               || configureEvent.xconfigure.height != dpyinfo-&gt;screen_height)
<a id='L21045' name='L21045'></a> 21045             <em class='brace'>{</em>
<a id='L21046' name='L21046'></a> 21046               <em class='comment'>/* Also avoid storing duplicate events here, since</em>
<a id='L21047' name='L21047'></a> 21047 <em class='comment'>                 Fx_display_monitor_attributes_list will return the</em>
<a id='L21048' name='L21048'></a> 21048 <em class='comment'>                 same information for both invocations of the</em>
<a id='L21049' name='L21049'></a> 21049 <em class='comment'>                 hook.  */</em>
<a id='L21050' name='L21050'></a> 21050               <strong class='reserved'>if</strong> (!x_find_monitors_changed_event (dpyinfo))
<a id='L21051' name='L21051'></a> 21051                 <em class='brace'>{</em>
<a id='L21052' name='L21052'></a> 21052                   inev.ie.kind = <a href='../S/2231.html#L335' title='Defined at 335 in src/termhooks.h.'>MONITORS_CHANGED_EVENT</a>;
<a id='L21053' name='L21053'></a> 21053                   <a href='../D/7354.html' title='Multiple defined in 2 places.'>XSETTERMINAL</a> (inev.ie.arg, dpyinfo-&gt;<a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>);
<a id='L21054' name='L21054'></a> 21054 
<a id='L21055' name='L21055'></a> 21055                   <em class='comment'>/* Store this event now since inev.ie.type could be set to</em>
<a id='L21056' name='L21056'></a> 21056 <em class='comment'>                     MOVE_FRAME_EVENT later.  */</em>
<a id='L21057' name='L21057'></a> 21057                   <a href='../D/13636.html' title='Multiple defined in 2 places.'>kbd_buffer_store_event</a> (&amp;inev.ie);
<a id='L21058' name='L21058'></a> 21058                   inev.ie.kind = <a href='../S/2231.html#L74' title='Defined at 74 in src/termhooks.h.'>NO_EVENT</a>;
<a id='L21059' name='L21059'></a> 21059                 <em class='brace'>}</em>
<a id='L21060' name='L21060'></a> 21060 
<a id='L21061' name='L21061'></a> 21061               <em class='comment'>/* Also update the position of the drag-and-drop</em>
<a id='L21062' name='L21062'></a> 21062 <em class='comment'>                 tooltip.  */</em>
<a id='L21063' name='L21063'></a> 21063               x_dnd_update_tooltip_now ();
<a id='L21064' name='L21064'></a> 21064             <em class='brace'>}</em>
<a id='L21065' name='L21065'></a> 21065 <em class='sharp'>#endif</em>
<a id='L21066' name='L21066'></a> 21066 
<a id='L21067' name='L21067'></a> 21067           dpyinfo-&gt;screen_width = configureEvent.xconfigure.width;
<a id='L21068' name='L21068'></a> 21068           dpyinfo-&gt;screen_height = configureEvent.xconfigure.height;
<a id='L21069' name='L21069'></a> 21069         <em class='brace'>}</em>
<a id='L21070' name='L21070'></a> 21070 
<a id='L21071' name='L21071'></a> 21071       <strong class='reserved'>if</strong> (x_dnd_in_progress &amp;&amp; x_dnd_use_toplevels
<a id='L21072' name='L21072'></a> 21072           &amp;&amp; dpyinfo == <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (x_dnd_frame))
<a id='L21073' name='L21073'></a> 21073         <em class='brace'>{</em>
<a id='L21074' name='L21074'></a> 21074           <strong class='reserved'>int</strong> rc, dest_x, dest_y;
<a id='L21075' name='L21075'></a> 21075           <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> child;
<a id='L21076' name='L21076'></a> 21076           <strong class='reserved'>struct</strong> <a href='../S/2289.html#L1484' title='Defined at 1484 in src/xterm.c.'>x_client_list_window</a> *tem, *last = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L21077' name='L21077'></a> 21077 
<a id='L21078' name='L21078'></a> 21078           <strong class='reserved'>for</strong> (tem = x_dnd_toplevels; tem; last = tem, tem = tem-&gt;next)
<a id='L21079' name='L21079'></a> 21079             <em class='brace'>{</em>
<a id='L21080' name='L21080'></a> 21080               <em class='comment'>/* Not completely right, since the parent could be</em>
<a id='L21081' name='L21081'></a> 21081 <em class='comment'>                 unmapped, but good enough.  */</em>
<a id='L21082' name='L21082'></a> 21082 
<a id='L21083' name='L21083'></a> 21083               <strong class='reserved'>if</strong> (tem-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> == configureEvent.xconfigure.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>)
<a id='L21084' name='L21084'></a> 21084                 <em class='brace'>{</em>
<a id='L21085' name='L21085'></a> 21085                   x_catch_errors (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L21086' name='L21086'></a> 21086                   rc = (XTranslateCoordinates (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L21087' name='L21087'></a> 21087                                                configureEvent.xconfigure.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>,
<a id='L21088' name='L21088'></a> 21088                                                dpyinfo-&gt;root_window,
<a id='L21089' name='L21089'></a> 21089                                                -configureEvent.xconfigure.border_width,
<a id='L21090' name='L21090'></a> 21090                                                -configureEvent.xconfigure.border_width,
<a id='L21091' name='L21091'></a> 21091                                                &amp;dest_x, &amp;dest_y, &amp;child)
<a id='L21092' name='L21092'></a> 21092                         &amp;&amp; !x_had_errors_p (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>));
<a id='L21093' name='L21093'></a> 21093                   x_uncatch_errors_after_check ();
<a id='L21094' name='L21094'></a> 21094 
<a id='L21095' name='L21095'></a> 21095                   <strong class='reserved'>if</strong> (rc)
<a id='L21096' name='L21096'></a> 21096                     <em class='brace'>{</em>
<a id='L21097' name='L21097'></a> 21097                       tem-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = dest_x;
<a id='L21098' name='L21098'></a> 21098                       tem-&gt;y = dest_y;
<a id='L21099' name='L21099'></a> 21099                       tem-&gt;width = (configureEvent.xconfigure.width
<a id='L21100' name='L21100'></a> 21100                                     + configureEvent.xconfigure.border_width);
<a id='L21101' name='L21101'></a> 21101                       tem-&gt;height = (configureEvent.xconfigure.height
<a id='L21102' name='L21102'></a> 21102                                      + configureEvent.xconfigure.border_width);
<a id='L21103' name='L21103'></a> 21103                     <em class='brace'>}</em>
<a id='L21104' name='L21104'></a> 21104                   <strong class='reserved'>else</strong>
<a id='L21105' name='L21105'></a> 21105                     <em class='brace'>{</em>
<a id='L21106' name='L21106'></a> 21106                       <em class='comment'>/* The window was probably destroyed, so get rid</em>
<a id='L21107' name='L21107'></a> 21107 <em class='comment'>                         of it.  */</em>
<a id='L21108' name='L21108'></a> 21108 
<a id='L21109' name='L21109'></a> 21109                       <strong class='reserved'>if</strong> (!last)
<a id='L21110' name='L21110'></a> 21110                         x_dnd_toplevels = tem-&gt;next;
<a id='L21111' name='L21111'></a> 21111                       <strong class='reserved'>else</strong>
<a id='L21112' name='L21112'></a> 21112                         last-&gt;next = tem-&gt;next;
<a id='L21113' name='L21113'></a> 21113 
<a id='L21114' name='L21114'></a> 21114 <em class='sharp'>#ifdef</em> HAVE_XSHAPE
<a id='L21115' name='L21115'></a> 21115                       <strong class='reserved'>if</strong> (tem-&gt;n_input_rects != -1)
<a id='L21116' name='L21116'></a> 21116                         <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (tem-&gt;input_rects);
<a id='L21117' name='L21117'></a> 21117                       <strong class='reserved'>if</strong> (tem-&gt;n_bounding_rects != -1)
<a id='L21118' name='L21118'></a> 21118                         <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (tem-&gt;bounding_rects);
<a id='L21119' name='L21119'></a> 21119 <em class='sharp'>#endif</em>
<a id='L21120' name='L21120'></a> 21120                       <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (tem);
<a id='L21121' name='L21121'></a> 21121                     <em class='brace'>}</em>
<a id='L21122' name='L21122'></a> 21122 
<a id='L21123' name='L21123'></a> 21123                   <strong class='reserved'>break</strong>;
<a id='L21124' name='L21124'></a> 21124                 <em class='brace'>}</em>
<a id='L21125' name='L21125'></a> 21125             <em class='brace'>}</em>
<a id='L21126' name='L21126'></a> 21126         <em class='brace'>}</em>
<a id='L21127' name='L21127'></a> 21127 
<a id='L21128' name='L21128'></a> 21128 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_GTK3 &amp;&amp; <strong class='reserved'>defined</strong> USE_TOOLKIT_SCROLL_BARS
<a id='L21129' name='L21129'></a> 21129           <strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> = x_window_to_scroll_bar (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L21130' name='L21130'></a> 21130                                                            configureEvent.xconfigure.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, 2);
<a id='L21131' name='L21131'></a> 21131 
<a id='L21132' name='L21132'></a> 21132           <em class='comment'>/* There is really no other way to make GTK scroll bars fit</em>
<a id='L21133' name='L21133'></a> 21133 <em class='comment'>             in the dimensions we want them to.  */</em>
<a id='L21134' name='L21134'></a> 21134           <strong class='reserved'>if</strong> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>)
<a id='L21135' name='L21135'></a> 21135             <em class='brace'>{</em>
<a id='L21136' name='L21136'></a> 21136               <em class='comment'>/* Skip all the pending configure events, not just the</em>
<a id='L21137' name='L21137'></a> 21137 <em class='comment'>                 ones where window motion occurred.  */</em>
<a id='L21138' name='L21138'></a> 21138               <strong class='reserved'>while</strong> (XPending (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>))
<a id='L21139' name='L21139'></a> 21139                 <em class='brace'>{</em>
<a id='L21140' name='L21140'></a> 21140                   XNextEvent (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, &amp;next_event);
<a id='L21141' name='L21141'></a> 21141                   <strong class='reserved'>if</strong> (next_event.type != ConfigureNotify
<a id='L21142' name='L21142'></a> 21142                       || next_event.xconfigure.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> != event-&gt;xconfigure.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>)
<a id='L21143' name='L21143'></a> 21143                     <em class='brace'>{</em>
<a id='L21144' name='L21144'></a> 21144                       XPutBackEvent (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, &amp;next_event);
<a id='L21145' name='L21145'></a> 21145                       <strong class='reserved'>break</strong>;
<a id='L21146' name='L21146'></a> 21146                     <em class='brace'>}</em>
<a id='L21147' name='L21147'></a> 21147                   <strong class='reserved'>else</strong>
<a id='L21148' name='L21148'></a> 21148                     configureEvent = next_event;
<a id='L21149' name='L21149'></a> 21149                 <em class='brace'>}</em>
<a id='L21150' name='L21150'></a> 21150 
<a id='L21151' name='L21151'></a> 21151               <strong class='reserved'>if</strong> (configureEvent.xconfigure.width != <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;width, 1)
<a id='L21152' name='L21152'></a> 21152                   || configureEvent.xconfigure.height != <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;height, 1))
<a id='L21153' name='L21153'></a> 21153                 <em class='brace'>{</em>
<a id='L21154' name='L21154'></a> 21154                   XResizeWindow (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../D/19737.html' title='Multiple defined in 3 places.'>x_window</a>,
<a id='L21155' name='L21155'></a> 21155                                  <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;width, 1), <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;height, 1));
<a id='L21156' name='L21156'></a> 21156                   <a href='../S/2289.html#L5056' title='Defined at 5056 in src/xterm.c.'>x_flush</a> (<a href='../S/2317.html#L613' title='Defined at 613 in src/window.h.'>WINDOW_XFRAME</a> (<a href='../D/7409.html' title='Multiple defined in 2 places.'>XWINDOW</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>)));
<a id='L21157' name='L21157'></a> 21157                 <em class='brace'>}</em>
<a id='L21158' name='L21158'></a> 21158 
<a id='L21159' name='L21159'></a> 21159 <em class='sharp'>#ifdef</em> HAVE_XDBE
<a id='L21160' name='L21160'></a> 21160               <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; <a href='../S/2212.html#L1356' title='Defined at 1356 in src/xterm.h.'>FRAME_X_DOUBLE_BUFFERED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L21161' name='L21161'></a> 21161                 <a href='../S/2289.html#L5071' title='Defined at 5071 in src/xterm.c.'>x_drop_xrender_surfaces</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L21162' name='L21162'></a> 21162 <em class='sharp'>#endif</em>
<a id='L21163' name='L21163'></a> 21163 
<a id='L21164' name='L21164'></a> 21164               <strong class='reserved'>goto</strong> OTHER;
<a id='L21165' name='L21165'></a> 21165             <em class='brace'>}</em>
<a id='L21166' name='L21166'></a> 21166 <em class='sharp'>#endif</em>
<a id='L21167' name='L21167'></a> 21167 
<a id='L21168' name='L21168'></a> 21168       <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../D/19730.html' title='Multiple defined in 2 places.'>x_top_window_to_frame</a> (dpyinfo, configureEvent.xconfigure.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L21169' name='L21169'></a> 21169 
<a id='L21170' name='L21170'></a> 21170       <em class='comment'>/* This means we can no longer be certain of the root window</em>
<a id='L21171' name='L21171'></a> 21171 <em class='comment'>         coordinates of any's edit window.  */</em>
<a id='L21172' name='L21172'></a> 21172       <strong class='reserved'>if</strong> (any)
<a id='L21173' name='L21173'></a> 21173         <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (any)-&gt;window_offset_certain_p = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L21174' name='L21174'></a> 21174 
<a id='L21175' name='L21175'></a> 21175       <em class='comment'>/* Unfortunately, we need to call x_drop_xrender_surfaces for</em>
<a id='L21176' name='L21176'></a> 21176 <em class='comment'>         _all_ ConfigureNotify events, otherwise we miss some and</em>
<a id='L21177' name='L21177'></a> 21177 <em class='comment'>         flicker.  Don't try to optimize these calls by looking only</em>
<a id='L21178' name='L21178'></a> 21178 <em class='comment'>         for size changes: that's not sufficient.  We miss some</em>
<a id='L21179' name='L21179'></a> 21179 <em class='comment'>         surface invalidations and flicker.  */</em>
<a id='L21180' name='L21180'></a> 21180 <em class='sharp'>#ifdef</em> HAVE_XDBE
<a id='L21181' name='L21181'></a> 21181       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; <a href='../S/2212.html#L1356' title='Defined at 1356 in src/xterm.h.'>FRAME_X_DOUBLE_BUFFERED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L21182' name='L21182'></a> 21182         <a href='../S/2289.html#L5071' title='Defined at 5071 in src/xterm.c.'>x_drop_xrender_surfaces</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L21183' name='L21183'></a> 21183 <em class='sharp'>#endif</em>
<a id='L21184' name='L21184'></a> 21184 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> USE_CAIRO &amp;&amp; !<strong class='reserved'>defined</strong> USE_GTK
<a id='L21185' name='L21185'></a> 21185       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L21186' name='L21186'></a> 21186         <a href='../S/2289.html#L5877' title='Defined at 5877 in src/xterm.c.'>x_cr_update_surface_desired_size</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, configureEvent.xconfigure.width,
<a id='L21187' name='L21187'></a> 21187                                           configureEvent.xconfigure.height);
<a id='L21188' name='L21188'></a> 21188       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (any &amp;&amp; configureEvent.xconfigure.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> == <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (any))
<a id='L21189' name='L21189'></a> 21189         <a href='../S/2289.html#L5877' title='Defined at 5877 in src/xterm.c.'>x_cr_update_surface_desired_size</a> (any,
<a id='L21190' name='L21190'></a> 21190                                           configureEvent.xconfigure.width,
<a id='L21191' name='L21191'></a> 21191                                           configureEvent.xconfigure.height);
<a id='L21192' name='L21192'></a> 21192 <em class='sharp'>#endif</em>
<a id='L21193' name='L21193'></a> 21193 
<a id='L21194' name='L21194'></a> 21194 <em class='sharp'>#if</em> !<strong class='reserved'>defined</strong> USE_X_TOOLKIT &amp;&amp; !<strong class='reserved'>defined</strong> USE_GTK
<a id='L21195' name='L21195'></a> 21195 
<a id='L21196' name='L21196'></a> 21196       <em class='comment'>/* Make the new size of the frame its opaque region.  This is a</em>
<a id='L21197' name='L21197'></a> 21197 <em class='comment'>         region describing areas of the window which are always</em>
<a id='L21198' name='L21198'></a> 21198 <em class='comment'>         guaranteed to be completely opaque and can be treated as such</em>
<a id='L21199' name='L21199'></a> 21199 <em class='comment'>         by the compositor.  It is set to the width and height of the</em>
<a id='L21200' name='L21200'></a> 21200 <em class='comment'>         only window in no-toolkit builds when `alpha_background' is</em>
<a id='L21201' name='L21201'></a> 21201 <em class='comment'>         not set, and is cleared otherwise.  */</em>
<a id='L21202' name='L21202'></a> 21202 
<a id='L21203' name='L21203'></a> 21203       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> || (any &amp;&amp; configureEvent.xconfigure.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>
<a id='L21204' name='L21204'></a> 21204                 == <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (any)))
<a id='L21205' name='L21205'></a> 21205         <a href='../S/2289.html#L5198' title='Defined at 5198 in src/xterm.c.'>x_update_opaque_region</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> ? <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> : any, &amp;configureEvent);
<a id='L21206' name='L21206'></a> 21206 
<a id='L21207' name='L21207'></a> 21207 <em class='sharp'>#endif</em> <em class='comment'>/* !defined USE_X_TOOLKIT &amp;&amp; !defined USE_GTK */</em>
<a id='L21208' name='L21208'></a> 21208 
<a id='L21209' name='L21209'></a> 21209 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L21210' name='L21210'></a> 21210       <strong class='reserved'>if</strong> (!<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>
<a id='L21211' name='L21211'></a> 21211           &amp;&amp; (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = any)
<a id='L21212' name='L21212'></a> 21212           &amp;&amp; configureEvent.xconfigure.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> == <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L21213' name='L21213'></a> 21213           &amp;&amp; (<a href='../S/2183.html#L1152' title='Defined at 1152 in src/frame.h.'>FRAME_VISIBLE_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L21214' name='L21214'></a> 21214               || !(configureEvent.xconfigure.width &lt;= 1
<a id='L21215' name='L21215'></a> 21215                    &amp;&amp; configureEvent.xconfigure.height &lt;= 1)))
<a id='L21216' name='L21216'></a> 21216         <em class='brace'>{</em>
<a id='L21217' name='L21217'></a> 21217 
<a id='L21218' name='L21218'></a> 21218           <strong class='reserved'>if</strong> (<a href='../D/1228.html' title='Multiple defined in 2 places.'>CONSP</a> (frame_size_history))
<a id='L21219' name='L21219'></a> 21219             <a href='../S/2247.html#L570' title='Defined at 570 in src/frame.c.'>frame_size_history_extra</a>
<a id='L21220' name='L21220'></a> 21220               (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9420.html' title='Multiple defined in 2 places.'>build_string</a> ("ConfigureNotify"),
<a id='L21221' name='L21221'></a> 21221                <a href='../S/2183.html#L1051' title='Defined at 1051 in src/frame.h.'>FRAME_PIXEL_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../S/2183.html#L1052' title='Defined at 1052 in src/frame.h.'>FRAME_PIXEL_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L21222' name='L21222'></a> 21222                configureEvent.xconfigure.width,
<a id='L21223' name='L21223'></a> 21223                configureEvent.xconfigure.height,
<a id='L21224' name='L21224'></a> 21224                <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;new_width, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;new_height);
<a id='L21225' name='L21225'></a> 21225 
<a id='L21226' name='L21226'></a> 21226 <em class='sharp'>#ifdef</em> HAVE_XDBE
<a id='L21227' name='L21227'></a> 21227           <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1356' title='Defined at 1356 in src/xterm.h.'>FRAME_X_DOUBLE_BUFFERED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L21228' name='L21228'></a> 21228             <a href='../S/2289.html#L5071' title='Defined at 5071 in src/xterm.c.'>x_drop_xrender_surfaces</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L21229' name='L21229'></a> 21229 <em class='sharp'>#endif</em>
<a id='L21230' name='L21230'></a> 21230           <a href='../S/2362.html#L1135' title='Defined at 1135 in src/gtkutil.c.'>xg_frame_resized</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, configureEvent.xconfigure.width,
<a id='L21231' name='L21231'></a> 21231                             configureEvent.xconfigure.height);
<a id='L21232' name='L21232'></a> 21232 <em class='sharp'>#ifdef</em> USE_CAIRO
<a id='L21233' name='L21233'></a> 21233           <a href='../S/2289.html#L5877' title='Defined at 5877 in src/xterm.c.'>x_cr_update_surface_desired_size</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, configureEvent.xconfigure.width,
<a id='L21234' name='L21234'></a> 21234                                             configureEvent.xconfigure.height);
<a id='L21235' name='L21235'></a> 21235 <em class='sharp'>#endif</em>
<a id='L21236' name='L21236'></a> 21236           <a href='../S/2289.html#L5198' title='Defined at 5198 in src/xterm.c.'>x_update_opaque_region</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, &amp;configureEvent);
<a id='L21237' name='L21237'></a> 21237           <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = 0;
<a id='L21238' name='L21238'></a> 21238         <em class='brace'>}</em>
<a id='L21239' name='L21239'></a> 21239 <em class='sharp'>#endif</em>
<a id='L21240' name='L21240'></a> 21240       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; (<a href='../S/2183.html#L1152' title='Defined at 1152 in src/frame.h.'>FRAME_VISIBLE_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L21241' name='L21241'></a> 21241                 || !(configureEvent.xconfigure.width &lt;= 1
<a id='L21242' name='L21242'></a> 21242                      &amp;&amp; configureEvent.xconfigure.height &lt;= 1)))
<a id='L21243' name='L21243'></a> 21243         <em class='brace'>{</em>
<a id='L21244' name='L21244'></a> 21244 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L21245' name='L21245'></a> 21245           <em class='comment'>/* For GTK+ don't call x_net_wm_state for the scroll bar</em>
<a id='L21246' name='L21246'></a> 21246 <em class='comment'>             window.  (Bug#24963, Bug#25887) */</em>
<a id='L21247' name='L21247'></a> 21247           <strong class='reserved'>if</strong> (configureEvent.xconfigure.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> == <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L21248' name='L21248'></a> 21248 <em class='sharp'>#endif</em>
<a id='L21249' name='L21249'></a> 21249             x_net_wm_state (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, configureEvent.xconfigure.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L21250' name='L21250'></a> 21250 
<a id='L21251' name='L21251'></a> 21251 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> USE_X_TOOLKIT || <strong class='reserved'>defined</strong> USE_GTK
<a id='L21252' name='L21252'></a> 21252           <em class='comment'>/* Tip frames are pure X window, set size for them.  */</em>
<a id='L21253' name='L21253'></a> 21253           <strong class='reserved'>if</strong> (<a href='../D/2425.html' title='Multiple defined in 2 places.'>FRAME_TOOLTIP_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L21254' name='L21254'></a> 21254             <em class='brace'>{</em>
<a id='L21255' name='L21255'></a> 21255               <strong class='reserved'>if</strong> (<a href='../S/2183.html#L1052' title='Defined at 1052 in src/frame.h.'>FRAME_PIXEL_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) != configureEvent.xconfigure.height
<a id='L21256' name='L21256'></a> 21256                   || <a href='../S/2183.html#L1051' title='Defined at 1051 in src/frame.h.'>FRAME_PIXEL_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) != configureEvent.xconfigure.width)
<a id='L21257' name='L21257'></a> 21257                 <a href='../S/2183.html#L1175' title='Defined at 1175 in src/frame.h.'>SET_FRAME_GARBAGED</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L21258' name='L21258'></a> 21258 
<a id='L21259' name='L21259'></a> 21259               <a href='../S/2183.html#L1052' title='Defined at 1052 in src/frame.h.'>FRAME_PIXEL_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = configureEvent.xconfigure.height;
<a id='L21260' name='L21260'></a> 21260               <a href='../S/2183.html#L1051' title='Defined at 1051 in src/frame.h.'>FRAME_PIXEL_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = configureEvent.xconfigure.width;
<a id='L21261' name='L21261'></a> 21261             <em class='brace'>}</em>
<a id='L21262' name='L21262'></a> 21262 <em class='sharp'>#endif</em>
<a id='L21263' name='L21263'></a> 21263 
<a id='L21264' name='L21264'></a> 21264 <em class='sharp'>#ifndef</em> USE_X_TOOLKIT
<a id='L21265' name='L21265'></a> 21265 <em class='sharp'>#ifndef</em> USE_GTK
<a id='L21266' name='L21266'></a> 21266           <strong class='reserved'>int</strong> width = configureEvent.xconfigure.width;
<a id='L21267' name='L21267'></a> 21267           <strong class='reserved'>int</strong> height = configureEvent.xconfigure.height;
<a id='L21268' name='L21268'></a> 21268 
<a id='L21269' name='L21269'></a> 21269           <strong class='reserved'>if</strong> (<a href='../D/1228.html' title='Multiple defined in 2 places.'>CONSP</a> (frame_size_history))
<a id='L21270' name='L21270'></a> 21270             <a href='../S/2247.html#L570' title='Defined at 570 in src/frame.c.'>frame_size_history_extra</a>
<a id='L21271' name='L21271'></a> 21271               (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9420.html' title='Multiple defined in 2 places.'>build_string</a> ("ConfigureNotify"),
<a id='L21272' name='L21272'></a> 21272                <a href='../S/2183.html#L1051' title='Defined at 1051 in src/frame.h.'>FRAME_PIXEL_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../S/2183.html#L1052' title='Defined at 1052 in src/frame.h.'>FRAME_PIXEL_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L21273' name='L21273'></a> 21273                width, height, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;new_width, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;new_height);
<a id='L21274' name='L21274'></a> 21274 
<a id='L21275' name='L21275'></a> 21275           <em class='comment'>/* In the toolkit version, change_frame_size</em>
<a id='L21276' name='L21276'></a> 21276 <em class='comment'>             is called by the code that handles resizing</em>
<a id='L21277' name='L21277'></a> 21277 <em class='comment'>             of the EmacsFrame widget.  */</em>
<a id='L21278' name='L21278'></a> 21278 
<a id='L21279' name='L21279'></a> 21279           <em class='comment'>/* Even if the number of character rows and columns has</em>
<a id='L21280' name='L21280'></a> 21280 <em class='comment'>             not changed, the font size may have changed, so we need</em>
<a id='L21281' name='L21281'></a> 21281 <em class='comment'>             to check the pixel dimensions as well.  */</em>
<a id='L21282' name='L21282'></a> 21282 
<a id='L21283' name='L21283'></a> 21283           <strong class='reserved'>if</strong> (width != <a href='../S/2183.html#L1051' title='Defined at 1051 in src/frame.h.'>FRAME_PIXEL_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L21284' name='L21284'></a> 21284               || height != <a href='../S/2183.html#L1052' title='Defined at 1052 in src/frame.h.'>FRAME_PIXEL_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L21285' name='L21285'></a> 21285               || (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;new_size_p
<a id='L21286' name='L21286'></a> 21286                   &amp;&amp; ((<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;new_width &gt;= 0 &amp;&amp; width != <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;new_width)
<a id='L21287' name='L21287'></a> 21287                       || (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;new_height &gt;= 0 &amp;&amp; height != <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;new_height))))
<a id='L21288' name='L21288'></a> 21288             <em class='brace'>{</em>
<a id='L21289' name='L21289'></a> 21289               <a href='../S/2140.html#L6054' title='Defined at 6054 in src/dispnew.c.'>change_frame_size</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, width, height, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L21290' name='L21290'></a> 21290               <a href='../S/2289.html#L7569' title='Defined at 7569 in src/xterm.c.'>x_clear_under_internal_border</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L21291' name='L21291'></a> 21291               <a href='../S/2183.html#L1175' title='Defined at 1175 in src/frame.h.'>SET_FRAME_GARBAGED</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L21292' name='L21292'></a> 21292               <a href='../S/2224.html#L35978' title='Defined at 35978 in src/xdisp.c.'>cancel_mouse_face</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L21293' name='L21293'></a> 21293             <em class='brace'>}</em>
<a id='L21294' name='L21294'></a> 21294 <em class='sharp'>#endif</em> <em class='comment'>/* not USE_GTK */</em>
<a id='L21295' name='L21295'></a> 21295 <em class='sharp'>#endif</em>
<a id='L21296' name='L21296'></a> 21296 
<a id='L21297' name='L21297'></a> 21297 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L21298' name='L21298'></a> 21298           <em class='comment'>/* GTK creates windows but doesn't map them.</em>
<a id='L21299' name='L21299'></a> 21299 <em class='comment'>             Only get real positions when mapped.  */</em>
<a id='L21300' name='L21300'></a> 21300           <strong class='reserved'>if</strong> (<a href='../D/2309.html' title='Multiple defined in 2 places.'>FRAME_GTK_OUTER_WIDGET</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L21301' name='L21301'></a> 21301               &amp;&amp; gtk_widget_get_mapped (<a href='../D/2309.html' title='Multiple defined in 2 places.'>FRAME_GTK_OUTER_WIDGET</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)))
<a id='L21302' name='L21302'></a> 21302 <em class='sharp'>#endif</em>
<a id='L21303' name='L21303'></a> 21303             <em class='brace'>{</em>
<a id='L21304' name='L21304'></a> 21304               <strong class='reserved'>int</strong> old_left = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;left_pos;
<a id='L21305' name='L21305'></a> 21305               <strong class='reserved'>int</strong> old_top = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;top_pos;
<a id='L21306' name='L21306'></a> 21306               <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>;
<a id='L21307' name='L21307'></a> 21307 
<a id='L21308' name='L21308'></a> 21308               <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L21309' name='L21309'></a> 21309 
<a id='L21310' name='L21310'></a> 21310               <strong class='reserved'>if</strong> (!<a href='../D/2370.html' title='Multiple defined in 2 places.'>FRAME_PARENT_FRAME</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L21311' name='L21311'></a> 21311                 <a href='../S/2296.html#L596' title='Defined at 596 in src/xfns.c.'>x_real_positions</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, &amp;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;left_pos, &amp;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;top_pos);
<a id='L21312' name='L21312'></a> 21312               <strong class='reserved'>else</strong>
<a id='L21313' name='L21313'></a> 21313                 <em class='brace'>{</em>
<a id='L21314' name='L21314'></a> 21314                   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> root;
<a id='L21315' name='L21315'></a> 21315                   <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> dummy_uint;
<a id='L21316' name='L21316'></a> 21316 
<a id='L21317' name='L21317'></a> 21317                   <a href='../S/2321.html#L123' title='Defined at 123 in src/msdos.h.'>XGetGeometry</a> (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L21318' name='L21318'></a> 21318                                 &amp;root, &amp;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;left_pos, &amp;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;top_pos,
<a id='L21319' name='L21319'></a> 21319                                 &amp;dummy_uint, &amp;dummy_uint, &amp;dummy_uint, &amp;dummy_uint);
<a id='L21320' name='L21320'></a> 21320                 <em class='brace'>}</em>
<a id='L21321' name='L21321'></a> 21321 
<a id='L21322' name='L21322'></a> 21322               <strong class='reserved'>if</strong> (!<a href='../D/2425.html' title='Multiple defined in 2 places.'>FRAME_TOOLTIP_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L21323' name='L21323'></a> 21323                   &amp;&amp; (old_left != <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;left_pos || old_top != <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;top_pos))
<a id='L21324' name='L21324'></a> 21324                 <em class='brace'>{</em>
<a id='L21325' name='L21325'></a> 21325                   inev.ie.kind = <a href='../S/2231.html#L239' title='Defined at 239 in src/termhooks.h.'>MOVE_FRAME_EVENT</a>;
<a id='L21326' name='L21326'></a> 21326                   <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (inev.ie.frame_or_window, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L21327' name='L21327'></a> 21327                 <em class='brace'>}</em>
<a id='L21328' name='L21328'></a> 21328             <em class='brace'>}</em>
<a id='L21329' name='L21329'></a> 21329 
<a id='L21330' name='L21330'></a> 21330 
<a id='L21331' name='L21331'></a> 21331 <em class='sharp'>#ifdef</em> HAVE_X_I18N
<a id='L21332' name='L21332'></a> 21332           <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L21333' name='L21333'></a> 21333             <em class='brace'>{</em>
<a id='L21334' name='L21334'></a> 21334               <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1470' title='Defined at 1470 in src/xterm.h.'>FRAME_XIC</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) &amp;&amp; (<a href='../S/2212.html#L1473' title='Defined at 1473 in src/xterm.h.'>FRAME_XIC_STYLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) &amp; XIMStatusArea))
<a id='L21335' name='L21335'></a> 21335                 <a href='../S/2296.html#L3269' title='Defined at 3269 in src/xfns.c.'>xic_set_statusarea</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L21336' name='L21336'></a> 21336 
<a id='L21337' name='L21337'></a> 21337               <strong class='reserved'>struct</strong> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> *w = <a href='../D/7409.html' title='Multiple defined in 2 places.'>XWINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;selected_window);
<a id='L21338' name='L21338'></a> 21338               <a href='../S/2296.html#L3218' title='Defined at 3218 in src/xfns.c.'>xic_set_preeditarea</a> (w, w-&gt;cursor.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, w-&gt;cursor.y);
<a id='L21339' name='L21339'></a> 21339             <em class='brace'>}</em>
<a id='L21340' name='L21340'></a> 21340 <em class='sharp'>#endif</em>
<a id='L21341' name='L21341'></a> 21341 
<a id='L21342' name='L21342'></a> 21342 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L21343' name='L21343'></a> 21343           <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; dpyinfo-&gt;supports_xi2)
<a id='L21344' name='L21344'></a> 21344             <em class='brace'>{</em>
<a id='L21345' name='L21345'></a> 21345               <a href='../S/2315.html#L2919' title='Defined at 2919 in src/dispextern.h.'>Mouse_HLInfo</a> *hlinfo;
<a id='L21346' name='L21346'></a> 21346 
<a id='L21347' name='L21347'></a> 21347               <em class='comment'>/* The input extension doesn't report motion events when</em>
<a id='L21348' name='L21348'></a> 21348 <em class='comment'>                 the part of the window below the pointer changes.  To</em>
<a id='L21349' name='L21349'></a> 21349 <em class='comment'>                 avoid outdated information from keeping</em>
<a id='L21350' name='L21350'></a> 21350 <em class='comment'>                 i.e. mouse-highlight at the wrong position after the</em>
<a id='L21351' name='L21351'></a> 21351 <em class='comment'>                 frame is moved or resized, reset the mouse highlight</em>
<a id='L21352' name='L21352'></a> 21352 <em class='comment'>                 and last_mouse_motion_frame.  */</em>
<a id='L21353' name='L21353'></a> 21353 
<a id='L21354' name='L21354'></a> 21354               <strong class='reserved'>if</strong> (dpyinfo-&gt;last_mouse_motion_frame == <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L21355' name='L21355'></a> 21355                 dpyinfo-&gt;last_mouse_motion_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L21356' name='L21356'></a> 21356 
<a id='L21357' name='L21357'></a> 21357               hlinfo = <a href='../D/4164.html' title='Multiple defined in 3 places.'>MOUSE_HL_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L21358' name='L21358'></a> 21358 
<a id='L21359' name='L21359'></a> 21359               <strong class='reserved'>if</strong> (hlinfo-&gt;mouse_face_mouse_frame == <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L21360' name='L21360'></a> 21360                 <a href='../S/2315.html#L2922' title='Defined at 2922 in src/dispextern.h.'>reset_mouse_highlight</a> (hlinfo);
<a id='L21361' name='L21361'></a> 21361             <em class='brace'>}</em>
<a id='L21362' name='L21362'></a> 21362 <em class='sharp'>#endif</em>
<a id='L21363' name='L21363'></a> 21363 
<a id='L21364' name='L21364'></a> 21364         <em class='brace'>}</em>
<a id='L21365' name='L21365'></a> 21365 
<a id='L21366' name='L21366'></a> 21366       <strong class='reserved'>if</strong> (x_dnd_in_progress
<a id='L21367' name='L21367'></a> 21367           &amp;&amp; dpyinfo == <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (x_dnd_frame))
<a id='L21368' name='L21368'></a> 21368         x_dnd_update_state (dpyinfo, dpyinfo-&gt;last_user_time);
<a id='L21369' name='L21369'></a> 21369       <strong class='reserved'>goto</strong> OTHER;
<a id='L21370' name='L21370'></a> 21370 
<a id='L21371' name='L21371'></a> 21371     <strong class='reserved'>case</strong> ButtonRelease:
<a id='L21372' name='L21372'></a> 21372     <strong class='reserved'>case</strong> ButtonPress:
<a id='L21373' name='L21373'></a> 21373       <em class='brace'>{</em>
<a id='L21374' name='L21374'></a> 21374         <strong class='reserved'>if</strong> (event-&gt;xbutton.type == ButtonPress)
<a id='L21375' name='L21375'></a> 21375           <a href='../S/2289.html#L7929' title='Defined at 7929 in src/xterm.c.'>x_display_set_last_user_time</a> (dpyinfo, event-&gt;xbutton.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>,
<a id='L21376' name='L21376'></a> 21376                                         event-&gt;xbutton.send_event, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L21377' name='L21377'></a> 21377 
<a id='L21378' name='L21378'></a> 21378 <em class='sharp'>#ifdef</em> HAVE_XWIDGETS
<a id='L21379' name='L21379'></a> 21379         <strong class='reserved'>struct</strong> <a href='../S/2261.html#L102' title='Defined at 102 in src/xwidget.h.'>xwidget_view</a> *xvw;
<a id='L21380' name='L21380'></a> 21380 
<a id='L21381' name='L21381'></a> 21381         xvw = <a href='../S/2334.html#L2116' title='Defined at 2116 in src/xwidget.c.'>xwidget_view_from_window</a> (event-&gt;xbutton.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L21382' name='L21382'></a> 21382 
<a id='L21383' name='L21383'></a> 21383         <strong class='reserved'>if</strong> (xvw)
<a id='L21384' name='L21384'></a> 21384           <em class='brace'>{</em>
<a id='L21385' name='L21385'></a> 21385             <a href='../S/2334.html#L1307' title='Defined at 1307 in src/xwidget.c.'>xwidget_button</a> (xvw, event-&gt;type == ButtonPress,
<a id='L21386' name='L21386'></a> 21386                             event-&gt;xbutton.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, event-&gt;xbutton.y,
<a id='L21387' name='L21387'></a> 21387                             event-&gt;xbutton.button, event-&gt;xbutton.state,
<a id='L21388' name='L21388'></a> 21388                             event-&gt;xbutton.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>);
<a id='L21389' name='L21389'></a> 21389 
<a id='L21390' name='L21390'></a> 21390             <strong class='reserved'>if</strong> (!<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (selected_window, xvw-&gt;w) &amp;&amp; (event-&gt;xbutton.button &lt; 4))
<a id='L21391' name='L21391'></a> 21391               <em class='brace'>{</em>
<a id='L21392' name='L21392'></a> 21392                 inev.ie.kind = <a href='../S/2231.html#L242' title='Defined at 242 in src/termhooks.h.'>SELECT_WINDOW_EVENT</a>;
<a id='L21393' name='L21393'></a> 21393                 inev.ie.frame_or_window = xvw-&gt;w;
<a id='L21394' name='L21394'></a> 21394               <em class='brace'>}</em>
<a id='L21395' name='L21395'></a> 21395 
<a id='L21396' name='L21396'></a> 21396             *finish = <a href='../S/2289.html#L1136' title='Defined at 1136 in src/xterm.c.'>X_EVENT_DROP</a>;
<a id='L21397' name='L21397'></a> 21397             <strong class='reserved'>goto</strong> OTHER;
<a id='L21398' name='L21398'></a> 21398           <em class='brace'>}</em>
<a id='L21399' name='L21399'></a> 21399 <em class='sharp'>#endif</em>
<a id='L21400' name='L21400'></a> 21400         <em class='comment'>/* If we decide we want to generate an event to be seen</em>
<a id='L21401' name='L21401'></a> 21401 <em class='comment'>           by the rest of Emacs, we put it here.  */</em>
<a id='L21402' name='L21402'></a> 21402         <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> tab_bar_arg = Qnil;
<a id='L21403' name='L21403'></a> 21403         <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> tab_bar_p = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L21404' name='L21404'></a> 21404         <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> tool_bar_p = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L21405' name='L21405'></a> 21405         <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> dnd_grab = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L21406' name='L21406'></a> 21406 
<a id='L21407' name='L21407'></a> 21407         <strong class='reserved'>if</strong> (x_dnd_in_progress
<a id='L21408' name='L21408'></a> 21408             <em class='comment'>/* Handle these events normally if the recursion</em>
<a id='L21409' name='L21409'></a> 21409 <em class='comment'>               level is higher than when the drag-and-drop</em>
<a id='L21410' name='L21410'></a> 21410 <em class='comment'>               operation was initiated.  This is so that mouse</em>
<a id='L21411' name='L21411'></a> 21411 <em class='comment'>               input works while we're in the debugger for, say,</em>
<a id='L21412' name='L21412'></a> 21412 <em class='comment'>               `x-dnd-movement-function`.  */</em>
<a id='L21413' name='L21413'></a> 21413             &amp;&amp; (command_loop_level + minibuf_level
<a id='L21414' name='L21414'></a> 21414                 &lt;= x_dnd_recursion_depth)
<a id='L21415' name='L21415'></a> 21415             &amp;&amp; dpyinfo == <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (x_dnd_frame))
<a id='L21416' name='L21416'></a> 21416           <em class='brace'>{</em>
<a id='L21417' name='L21417'></a> 21417             <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../D/14633.html' title='Multiple defined in 2 places.'>mouse_or_wdesc_frame</a> (dpyinfo, event-&gt;xbutton.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L21418' name='L21418'></a> 21418 
<a id='L21419' name='L21419'></a> 21419             <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; event-&gt;xbutton.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> == <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L21420' name='L21420'></a> 21420               <em class='comment'>/* See the comment above x_compute_root_window_offset</em>
<a id='L21421' name='L21421'></a> 21421 <em class='comment'>                 for why this optimization is performed.  */</em>
<a id='L21422' name='L21422'></a> 21422               x_compute_root_window_offset (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, event-&gt;xbutton.x_root,
<a id='L21423' name='L21423'></a> 21423                                             event-&gt;xbutton.y_root,
<a id='L21424' name='L21424'></a> 21424                                             event-&gt;xbutton.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>,
<a id='L21425' name='L21425'></a> 21425                                             event-&gt;xbutton.y);
<a id='L21426' name='L21426'></a> 21426 
<a id='L21427' name='L21427'></a> 21427             <strong class='reserved'>if</strong> (event-&gt;type == ButtonPress)
<a id='L21428' name='L21428'></a> 21428               <em class='brace'>{</em>
<a id='L21429' name='L21429'></a> 21429                 <a href='../S/2289.html#L7929' title='Defined at 7929 in src/xterm.c.'>x_display_set_last_user_time</a> (dpyinfo, event-&gt;xbutton.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>,
<a id='L21430' name='L21430'></a> 21430                                               event-&gt;xbutton.send_event, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L21431' name='L21431'></a> 21431 
<a id='L21432' name='L21432'></a> 21432                 dpyinfo-&gt;grabbed |= (1 &lt;&lt; event-&gt;xbutton.button);
<a id='L21433' name='L21433'></a> 21433                 dpyinfo-&gt;last_mouse_frame = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L21434' name='L21434'></a> 21434 
<a id='L21435' name='L21435'></a> 21435                 <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L21436' name='L21436'></a> 21436                   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;last_tab_bar_item = -1;
<a id='L21437' name='L21437'></a> 21437 <em class='sharp'>#if</em> ! <strong class='reserved'>defined</strong> (USE_GTK)
<a id='L21438' name='L21438'></a> 21438                 <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L21439' name='L21439'></a> 21439                   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;last_tool_bar_item = -1;
<a id='L21440' name='L21440'></a> 21440 <em class='sharp'>#endif</em> <em class='comment'>/* not USE_GTK */</em>
<a id='L21441' name='L21441'></a> 21441               <em class='brace'>}</em>
<a id='L21442' name='L21442'></a> 21442             <strong class='reserved'>else</strong>
<a id='L21443' name='L21443'></a> 21443               dpyinfo-&gt;grabbed &amp;= ~(1 &lt;&lt; event-&gt;xbutton.button);
<a id='L21444' name='L21444'></a> 21444 
<a id='L21445' name='L21445'></a> 21445             <strong class='reserved'>if</strong> (event-&gt;xbutton.type == ButtonPress
<a id='L21446' name='L21446'></a> 21446                 &amp;&amp; x_dnd_last_seen_window != None)
<a id='L21447' name='L21447'></a> 21447               <em class='brace'>{</em>
<a id='L21448' name='L21448'></a> 21448                 <strong class='reserved'>if</strong> (x_dnd_last_window_is_frame)
<a id='L21449' name='L21449'></a> 21449                   <a href='../S/2289.html#L4945' title='Defined at 4945 in src/xterm.c.'>x_dnd_note_self_wheel</a> (dpyinfo,
<a id='L21450' name='L21450'></a> 21450                                          x_dnd_last_seen_window,
<a id='L21451' name='L21451'></a> 21451                                          event-&gt;xbutton.x_root,
<a id='L21452' name='L21452'></a> 21452                                          event-&gt;xbutton.y_root,
<a id='L21453' name='L21453'></a> 21453                                          event-&gt;xbutton.button,
<a id='L21454' name='L21454'></a> 21454                                          event-&gt;xbutton.state,
<a id='L21455' name='L21455'></a> 21455                                          event-&gt;xbutton.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>);
<a id='L21456' name='L21456'></a> 21456                 <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (x_dnd_last_protocol_version != -1)
<a id='L21457' name='L21457'></a> 21457                   <a href='../S/2289.html#L4574' title='Defined at 4574 in src/xterm.c.'>x_dnd_send_position</a> (x_dnd_frame,
<a id='L21458' name='L21458'></a> 21458                                        x_dnd_last_seen_window,
<a id='L21459' name='L21459'></a> 21459                                        x_dnd_last_seen_toplevel,
<a id='L21460' name='L21460'></a> 21460                                        x_dnd_last_protocol_version,
<a id='L21461' name='L21461'></a> 21461                                        event-&gt;xbutton.x_root,
<a id='L21462' name='L21462'></a> 21462                                        event-&gt;xbutton.y_root,
<a id='L21463' name='L21463'></a> 21463                                        event-&gt;xbutton.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>,
<a id='L21464' name='L21464'></a> 21464                                        x_dnd_wanted_action,
<a id='L21465' name='L21465'></a> 21465                                        event-&gt;xbutton.button,
<a id='L21466' name='L21466'></a> 21466                                        event-&gt;xbutton.state);
<a id='L21467' name='L21467'></a> 21467 
<a id='L21468' name='L21468'></a> 21468                 <strong class='reserved'>goto</strong> OTHER;
<a id='L21469' name='L21469'></a> 21469               <em class='brace'>}</em>
<a id='L21470' name='L21470'></a> 21470 
<a id='L21471' name='L21471'></a> 21471             <strong class='reserved'>if</strong> (event-&gt;xbutton.type == ButtonRelease)
<a id='L21472' name='L21472'></a> 21472               <em class='brace'>{</em>
<a id='L21473' name='L21473'></a> 21473                 <strong class='reserved'>for</strong> (<strong class='reserved'>int</strong> i = 1; i &lt; 8; ++i)
<a id='L21474' name='L21474'></a> 21474                   <em class='brace'>{</em>
<a id='L21475' name='L21475'></a> 21475                     <strong class='reserved'>if</strong> (i != event-&gt;xbutton.button
<a id='L21476' name='L21476'></a> 21476                         &amp;&amp; event-&gt;xbutton.state &amp; (Button1Mask &lt;&lt; (i - 1)))
<a id='L21477' name='L21477'></a> 21477                       dnd_grab = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L21478' name='L21478'></a> 21478                   <em class='brace'>}</em>
<a id='L21479' name='L21479'></a> 21479 
<a id='L21480' name='L21480'></a> 21480                 <strong class='reserved'>if</strong> (!dnd_grab)
<a id='L21481' name='L21481'></a> 21481                   <em class='brace'>{</em>
<a id='L21482' name='L21482'></a> 21482                     x_dnd_end_window = x_dnd_last_seen_window;
<a id='L21483' name='L21483'></a> 21483                     x_dnd_in_progress = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L21484' name='L21484'></a> 21484 
<a id='L21485' name='L21485'></a> 21485                     <strong class='reserved'>if</strong> (x_dnd_update_tooltip
<a id='L21486' name='L21486'></a> 21486                         &amp;&amp; <a href='../D/2249.html' title='Multiple defined in 2 places.'>FRAMEP</a> (tip_frame)
<a id='L21487' name='L21487'></a> 21487                         &amp;&amp; <a href='../S/2183.html#L1028' title='Defined at 1028 in src/frame.h.'>FRAME_LIVE_P</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (tip_frame))
<a id='L21488' name='L21488'></a> 21488                         &amp;&amp; (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (tip_frame))
<a id='L21489' name='L21489'></a> 21489                             == <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (x_dnd_frame)))
<a id='L21490' name='L21490'></a> 21490                       Fx_hide_tip ();
<a id='L21491' name='L21491'></a> 21491 
<a id='L21492' name='L21492'></a> 21492                     x_dnd_finish_frame = x_dnd_frame;
<a id='L21493' name='L21493'></a> 21493 
<a id='L21494' name='L21494'></a> 21494                     <strong class='reserved'>if</strong> (x_dnd_last_seen_window != None
<a id='L21495' name='L21495'></a> 21495                         &amp;&amp; x_dnd_last_window_is_frame)
<a id='L21496' name='L21496'></a> 21496                       <em class='brace'>{</em>
<a id='L21497' name='L21497'></a> 21497                         x_dnd_waiting_for_finish = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L21498' name='L21498'></a> 21498                         <a href='../S/2289.html#L4973' title='Defined at 4973 in src/xterm.c.'>x_dnd_note_self_drop</a> (dpyinfo,
<a id='L21499' name='L21499'></a> 21499                                               x_dnd_last_seen_window,
<a id='L21500' name='L21500'></a> 21500                                               event-&gt;xbutton.x_root,
<a id='L21501' name='L21501'></a> 21501                                               event-&gt;xbutton.y_root,
<a id='L21502' name='L21502'></a> 21502                                               event-&gt;xbutton.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>);
<a id='L21503' name='L21503'></a> 21503                       <em class='brace'>}</em>
<a id='L21504' name='L21504'></a> 21504                     <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (x_dnd_last_seen_window != None
<a id='L21505' name='L21505'></a> 21505                              &amp;&amp; x_dnd_last_protocol_version != -1)
<a id='L21506' name='L21506'></a> 21506                       <em class='brace'>{</em>
<a id='L21507' name='L21507'></a> 21507                         x_dnd_pending_finish_target = x_dnd_last_seen_toplevel;
<a id='L21508' name='L21508'></a> 21508                         x_dnd_waiting_for_finish_proto = x_dnd_last_protocol_version;
<a id='L21509' name='L21509'></a> 21509 
<a id='L21510' name='L21510'></a> 21510                         x_dnd_waiting_for_finish
<a id='L21511' name='L21511'></a> 21511                           = <a href='../S/2289.html#L4707' title='Defined at 4707 in src/xterm.c.'>x_dnd_do_drop</a> (x_dnd_last_seen_window,
<a id='L21512' name='L21512'></a> 21512                                            x_dnd_last_seen_toplevel,
<a id='L21513' name='L21513'></a> 21513                                            x_dnd_last_protocol_version);
<a id='L21514' name='L21514'></a> 21514                         x_dnd_finish_display = dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>;
<a id='L21515' name='L21515'></a> 21515                       <em class='brace'>}</em>
<a id='L21516' name='L21516'></a> 21516                     <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (x_dnd_last_seen_window != None)
<a id='L21517' name='L21517'></a> 21517                       <em class='brace'>{</em>
<a id='L21518' name='L21518'></a> 21518                         <a href='../D/20018.html' title='Multiple defined in 2 places.'>xm_drop_start_message</a> dmsg;
<a id='L21519' name='L21519'></a> 21519                         <a href='../D/20013.html' title='Multiple defined in 2 places.'>xm_drag_receiver_info</a> drag_receiver_info;
<a id='L21520' name='L21520'></a> 21520 
<a id='L21521' name='L21521'></a> 21521                         <strong class='reserved'>if</strong> (!<a href='../S/2289.html#L2776' title='Defined at 2776 in src/xterm.c.'>xm_read_drag_receiver_info</a> (dpyinfo, x_dnd_last_seen_window,
<a id='L21522' name='L21522'></a> 21522                                                          &amp;drag_receiver_info)
<a id='L21523' name='L21523'></a> 21523                             &amp;&amp; !x_dnd_disable_motif_protocol
<a id='L21524' name='L21524'></a> 21524                             &amp;&amp; drag_receiver_info.protocol_style != <a href='../S/2289.html#L1740' title='Defined at 1740 in src/xterm.c.'>XM_DRAG_STYLE_NONE</a>
<a id='L21525' name='L21525'></a> 21525                             &amp;&amp; (x_dnd_allow_current_frame
<a id='L21526' name='L21526'></a> 21526                                 || x_dnd_last_seen_window != <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (x_dnd_frame)))
<a id='L21527' name='L21527'></a> 21527                           <em class='brace'>{</em>
<a id='L21528' name='L21528'></a> 21528                             <strong class='reserved'>if</strong> (!x_dnd_motif_setup_p)
<a id='L21529' name='L21529'></a> 21529                               <a href='../S/2289.html#L2528' title='Defined at 2528 in src/xterm.c.'>xm_setup_drag_info</a> (dpyinfo, x_dnd_frame);
<a id='L21530' name='L21530'></a> 21530 
<a id='L21531' name='L21531'></a> 21531                             <strong class='reserved'>if</strong> (x_dnd_motif_setup_p)
<a id='L21532' name='L21532'></a> 21532                               <em class='brace'>{</em>
<a id='L21533' name='L21533'></a> 21533                                 memset (&amp;dmsg, 0, <strong class='reserved'>sizeof</strong> dmsg);
<a id='L21534' name='L21534'></a> 21534 
<a id='L21535' name='L21535'></a> 21535                                 dmsg.reason = <a href='../S/2289.html#L1718' title='Defined at 1718 in src/xterm.c.'>XM_DRAG_REASON</a> (<a href='../S/2289.html#L1732' title='Defined at 1732 in src/xterm.c.'>XM_DRAG_ORIGINATOR_INITIATOR</a>,
<a id='L21536' name='L21536'></a> 21536                                                               <a href='../S/2289.html#L1724' title='Defined at 1724 in src/xterm.c.'>XM_DRAG_REASON_DROP_START</a>);
<a id='L21537' name='L21537'></a> 21537                                 dmsg.byte_order = <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>;
<a id='L21538' name='L21538'></a> 21538                                 dmsg.side_effects
<a id='L21539' name='L21539'></a> 21539                                   = <a href='../S/2289.html#L1689' title='Defined at 1689 in src/xterm.c.'>XM_DRAG_SIDE_EFFECT</a> (<a href='../S/2289.html#L1766' title='Defined at 1766 in src/xterm.c.'>xm_side_effect_from_action</a> (dpyinfo,
<a id='L21540' name='L21540'></a> 21540                                                                                      x_dnd_wanted_action),
<a id='L21541' name='L21541'></a> 21541                                                          <a href='../S/2289.html#L1756' title='Defined at 1756 in src/xterm.c.'>XM_DROP_SITE_VALID</a>, x_dnd_motif_operations,
<a id='L21542' name='L21542'></a> 21542                                                          (!x_dnd_xm_use_help
<a id='L21543' name='L21543'></a> 21543                                                           ? <a href='../S/2289.html#L1713' title='Defined at 1713 in src/xterm.c.'>XM_DROP_ACTION_DROP</a>
<a id='L21544' name='L21544'></a> 21544                                                           : <a href='../S/2289.html#L1714' title='Defined at 1714 in src/xterm.c.'>XM_DROP_ACTION_DROP_HELP</a>));
<a id='L21545' name='L21545'></a> 21545                                 dmsg.timestamp = event-&gt;xbutton.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L21546' name='L21546'></a> 21546                                 dmsg.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = event-&gt;xbutton.x_root;
<a id='L21547' name='L21547'></a> 21547                                 dmsg.y = event-&gt;xbutton.y_root;
<a id='L21548' name='L21548'></a> 21548                                 dmsg.index_atom = x_dnd_motif_atom;
<a id='L21549' name='L21549'></a> 21549                                 dmsg.source_window = <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (x_dnd_frame);
<a id='L21550' name='L21550'></a> 21550 
<a id='L21551' name='L21551'></a> 21551                                 <strong class='reserved'>if</strong> (!<a href='../S/2289.html#L1748' title='Defined at 1748 in src/xterm.c.'>XM_DRAG_STYLE_IS_DROP_ONLY</a> (drag_receiver_info.protocol_style))
<a id='L21552' name='L21552'></a> 21552                                   <a href='../S/2289.html#L2899' title='Defined at 2899 in src/xterm.c.'>x_dnd_send_xm_leave_for_drop</a> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (x_dnd_frame),
<a id='L21553' name='L21553'></a> 21553                                                                 x_dnd_frame, x_dnd_last_seen_window,
<a id='L21554' name='L21554'></a> 21554                                                                 event-&gt;xbutton.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>);
<a id='L21555' name='L21555'></a> 21555 
<a id='L21556' name='L21556'></a> 21556                                 <a href='../S/2289.html#L2565' title='Defined at 2565 in src/xterm.c.'>xm_send_drop_message</a> (dpyinfo, <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (x_dnd_frame),
<a id='L21557' name='L21557'></a> 21557                                                       x_dnd_last_seen_window, &amp;dmsg);
<a id='L21558' name='L21558'></a> 21558 
<a id='L21559' name='L21559'></a> 21559                                 x_dnd_waiting_for_finish = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L21560' name='L21560'></a> 21560                                 x_dnd_waiting_for_motif_finish_display = dpyinfo;
<a id='L21561' name='L21561'></a> 21561                                 x_dnd_waiting_for_motif_finish = 1;
<a id='L21562' name='L21562'></a> 21562                                 x_dnd_finish_display = dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>;
<a id='L21563' name='L21563'></a> 21563                               <em class='brace'>}</em>
<a id='L21564' name='L21564'></a> 21564                           <em class='brace'>}</em>
<a id='L21565' name='L21565'></a> 21565                         <strong class='reserved'>else</strong>
<a id='L21566' name='L21566'></a> 21566                           <a href='../S/2289.html#L4073' title='Defined at 4073 in src/xterm.c.'>x_dnd_send_unsupported_drop</a> (dpyinfo, (x_dnd_last_seen_toplevel != None
<a id='L21567' name='L21567'></a> 21567                                                                  ? x_dnd_last_seen_toplevel
<a id='L21568' name='L21568'></a> 21568                                                                  : x_dnd_last_seen_window),
<a id='L21569' name='L21569'></a> 21569                                                        event-&gt;xbutton.x_root, event-&gt;xbutton.y_root,
<a id='L21570' name='L21570'></a> 21570                                                        event-&gt;xbutton.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>);
<a id='L21571' name='L21571'></a> 21571                       <em class='brace'>}</em>
<a id='L21572' name='L21572'></a> 21572                     <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (x_dnd_last_seen_toplevel != None)
<a id='L21573' name='L21573'></a> 21573                       <a href='../S/2289.html#L4073' title='Defined at 4073 in src/xterm.c.'>x_dnd_send_unsupported_drop</a> (dpyinfo, x_dnd_last_seen_toplevel,
<a id='L21574' name='L21574'></a> 21574                                                    event-&gt;xbutton.x_root,
<a id='L21575' name='L21575'></a> 21575                                                    event-&gt;xbutton.y_root,
<a id='L21576' name='L21576'></a> 21576                                                    event-&gt;xbutton.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>);
<a id='L21577' name='L21577'></a> 21577 
<a id='L21578' name='L21578'></a> 21578 
<a id='L21579' name='L21579'></a> 21579                     x_dnd_last_protocol_version = -1;
<a id='L21580' name='L21580'></a> 21580                     x_dnd_last_motif_style = <a href='../S/2289.html#L1740' title='Defined at 1740 in src/xterm.c.'>XM_DRAG_STYLE_NONE</a>;
<a id='L21581' name='L21581'></a> 21581                     x_dnd_last_seen_window = None;
<a id='L21582' name='L21582'></a> 21582                     x_dnd_last_seen_toplevel = None;
<a id='L21583' name='L21583'></a> 21583                     x_dnd_last_window_is_frame = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L21584' name='L21584'></a> 21584                     x_dnd_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L21585' name='L21585'></a> 21585                   <em class='brace'>}</em>
<a id='L21586' name='L21586'></a> 21586               <em class='brace'>}</em>
<a id='L21587' name='L21587'></a> 21587 
<a id='L21588' name='L21588'></a> 21588             <strong class='reserved'>goto</strong> OTHER;
<a id='L21589' name='L21589'></a> 21589           <em class='brace'>}</em>
<a id='L21590' name='L21590'></a> 21590 
<a id='L21591' name='L21591'></a> 21591         <strong class='reserved'>if</strong> (x_dnd_in_progress
<a id='L21592' name='L21592'></a> 21592             &amp;&amp; (command_loop_level + minibuf_level
<a id='L21593' name='L21593'></a> 21593                 &lt;= x_dnd_recursion_depth))
<a id='L21594' name='L21594'></a> 21594           <strong class='reserved'>goto</strong> OTHER;
<a id='L21595' name='L21595'></a> 21595 
<a id='L21596' name='L21596'></a> 21596         memset (&amp;compose_status, 0, <strong class='reserved'>sizeof</strong> (compose_status));
<a id='L21597' name='L21597'></a> 21597         dpyinfo-&gt;last_mouse_glyph_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L21598' name='L21598'></a> 21598 
<a id='L21599' name='L21599'></a> 21599         <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../D/14633.html' title='Multiple defined in 2 places.'>mouse_or_wdesc_frame</a> (dpyinfo, event-&gt;xbutton.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L21600' name='L21600'></a> 21600 
<a id='L21601' name='L21601'></a> 21601         <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; event-&gt;xbutton.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> == <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L21602' name='L21602'></a> 21602           <em class='comment'>/* See the comment above x_compute_root_window_offset</em>
<a id='L21603' name='L21603'></a> 21603 <em class='comment'>             for why this optimization is performed.  */</em>
<a id='L21604' name='L21604'></a> 21604           x_compute_root_window_offset (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, event-&gt;xbutton.x_root,
<a id='L21605' name='L21605'></a> 21605                                         event-&gt;xbutton.y_root,
<a id='L21606' name='L21606'></a> 21606                                         event-&gt;xbutton.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>,
<a id='L21607' name='L21607'></a> 21607                                         event-&gt;xbutton.y);
<a id='L21608' name='L21608'></a> 21608 
<a id='L21609' name='L21609'></a> 21609         <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; event-&gt;xbutton.type == ButtonPress
<a id='L21610' name='L21610'></a> 21610             &amp;&amp; !<a href='../D/15672.html' title='Multiple defined in 5 places.'>popup_activated</a> ()
<a id='L21611' name='L21611'></a> 21611             &amp;&amp; !x_window_to_scroll_bar (event-&gt;xbutton.<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L21612' name='L21612'></a> 21612                                         event-&gt;xbutton.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, 2)
<a id='L21613' name='L21613'></a> 21613             &amp;&amp; !<a href='../D/2354.html' title='Multiple defined in 2 places.'>FRAME_NO_ACCEPT_FOCUS</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L21614' name='L21614'></a> 21614           <em class='brace'>{</em>
<a id='L21615' name='L21615'></a> 21615             <em class='comment'>/* When clicking into a child frame or when clicking</em>
<a id='L21616' name='L21616'></a> 21616 <em class='comment'>               into a parent frame with the child frame selected and</em>
<a id='L21617' name='L21617'></a> 21617 <em class='comment'>               `no-accept-focus' is not set, select the clicked</em>
<a id='L21618' name='L21618'></a> 21618 <em class='comment'>               frame.  */</em>
<a id='L21619' name='L21619'></a> 21619             <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *hf = dpyinfo-&gt;highlight_frame;
<a id='L21620' name='L21620'></a> 21620 
<a id='L21621' name='L21621'></a> 21621             <strong class='reserved'>if</strong> (<a href='../D/2370.html' title='Multiple defined in 2 places.'>FRAME_PARENT_FRAME</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) || (hf &amp;&amp; <a href='../S/2247.html#L1728' title='Defined at 1728 in src/frame.c.'>frame_ancestor_p</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, hf)))
<a id='L21622' name='L21622'></a> 21622               <em class='brace'>{</em>
<a id='L21623' name='L21623'></a> 21623                 x_ignore_errors_for_next_request (dpyinfo, 0);
<a id='L21624' name='L21624'></a> 21624                 XSetInputFocus (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L21625' name='L21625'></a> 21625                                 RevertToParent, event-&gt;xbutton.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>);
<a id='L21626' name='L21626'></a> 21626                 x_stop_ignoring_errors (dpyinfo);
<a id='L21627' name='L21627'></a> 21627 
<a id='L21628' name='L21628'></a> 21628                 <strong class='reserved'>if</strong> (<a href='../D/2370.html' title='Multiple defined in 2 places.'>FRAME_PARENT_FRAME</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L21629' name='L21629'></a> 21629                   XRaiseWindow (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L21630' name='L21630'></a> 21630               <em class='brace'>}</em>
<a id='L21631' name='L21631'></a> 21631           <em class='brace'>}</em>
<a id='L21632' name='L21632'></a> 21632 
<a id='L21633' name='L21633'></a> 21633 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L21634' name='L21634'></a> 21634         <strong class='reserved'>if</strong> (!<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L21635' name='L21635'></a> 21635           <em class='brace'>{</em>
<a id='L21636' name='L21636'></a> 21636             <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../D/19416.html' title='Multiple defined in 2 places.'>x_any_window_to_frame</a> (dpyinfo, event-&gt;xbutton.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L21637' name='L21637'></a> 21637 
<a id='L21638' name='L21638'></a> 21638             <strong class='reserved'>if</strong> (event-&gt;xbutton.button &gt; 3
<a id='L21639' name='L21639'></a> 21639                 &amp;&amp; event-&gt;xbutton.button &lt; 8
<a id='L21640' name='L21640'></a> 21640                 &amp;&amp; <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L21641' name='L21641'></a> 21641               <em class='brace'>{</em>
<a id='L21642' name='L21642'></a> 21642                 <strong class='reserved'>if</strong> (ignore_next_mouse_click_timeout
<a id='L21643' name='L21643'></a> 21643                     &amp;&amp; dpyinfo == mouse_click_timeout_display)
<a id='L21644' name='L21644'></a> 21644                   <em class='brace'>{</em>
<a id='L21645' name='L21645'></a> 21645                     <strong class='reserved'>if</strong> (event-&gt;type == ButtonPress
<a id='L21646' name='L21646'></a> 21646                         &amp;&amp; event-&gt;xbutton.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> &gt; ignore_next_mouse_click_timeout)
<a id='L21647' name='L21647'></a> 21647                       <em class='brace'>{</em>
<a id='L21648' name='L21648'></a> 21648                         ignore_next_mouse_click_timeout = 0;
<a id='L21649' name='L21649'></a> 21649                         x_construct_mouse_click (&amp;inev.ie, &amp;event-&gt;xbutton, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L21650' name='L21650'></a> 21650                       <em class='brace'>}</em>
<a id='L21651' name='L21651'></a> 21651                     <strong class='reserved'>if</strong> (event-&gt;type == ButtonRelease)
<a id='L21652' name='L21652'></a> 21652                       ignore_next_mouse_click_timeout = 0;
<a id='L21653' name='L21653'></a> 21653                   <em class='brace'>}</em>
<a id='L21654' name='L21654'></a> 21654                 <strong class='reserved'>else</strong>
<a id='L21655' name='L21655'></a> 21655                   x_construct_mouse_click (&amp;inev.ie, &amp;event-&gt;xbutton, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L21656' name='L21656'></a> 21656 
<a id='L21657' name='L21657'></a> 21657                 *finish = <a href='../S/2289.html#L1136' title='Defined at 1136 in src/xterm.c.'>X_EVENT_DROP</a>;
<a id='L21658' name='L21658'></a> 21658                 <strong class='reserved'>goto</strong> OTHER;
<a id='L21659' name='L21659'></a> 21659               <em class='brace'>}</em>
<a id='L21660' name='L21660'></a> 21660             <strong class='reserved'>else</strong>
<a id='L21661' name='L21661'></a> 21661               <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L21662' name='L21662'></a> 21662           <em class='brace'>}</em>
<a id='L21663' name='L21663'></a> 21663 
<a id='L21664' name='L21664'></a> 21664         <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; <a href='../S/2362.html#L5047' title='Defined at 5047 in src/gtkutil.c.'>xg_event_is_for_scrollbar</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, event, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>))
<a id='L21665' name='L21665'></a> 21665           <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = 0;
<a id='L21666' name='L21666'></a> 21666 <em class='sharp'>#endif</em>
<a id='L21667' name='L21667'></a> 21667         <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L21668' name='L21668'></a> 21668           <em class='brace'>{</em>
<a id='L21669' name='L21669'></a> 21669             <em class='comment'>/* Is this in the tab-bar?  */</em>
<a id='L21670' name='L21670'></a> 21670             <strong class='reserved'>if</strong> (<a href='../D/6789.html' title='Multiple defined in 2 places.'>WINDOWP</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;tab_bar_window)
<a id='L21671' name='L21671'></a> 21671                 &amp;&amp; <a href='../S/2317.html#L657' title='Defined at 657 in src/window.h.'>WINDOW_TOTAL_LINES</a> (<a href='../D/7409.html' title='Multiple defined in 2 places.'>XWINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;tab_bar_window)))
<a id='L21672' name='L21672'></a> 21672               <em class='brace'>{</em>
<a id='L21673' name='L21673'></a> 21673                 <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>;
<a id='L21674' name='L21674'></a> 21674                 <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = event-&gt;xbutton.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L21675' name='L21675'></a> 21675                 <strong class='reserved'>int</strong> y = event-&gt;xbutton.y;
<a id='L21676' name='L21676'></a> 21676 
<a id='L21677' name='L21677'></a> 21677                 <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = <a href='../S/2108.html#L1682' title='Defined at 1682 in src/window.c.'>window_from_coordinates</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, 0, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L21678' name='L21678'></a> 21678                 tab_bar_p = <a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;tab_bar_window);
<a id='L21679' name='L21679'></a> 21679 
<a id='L21680' name='L21680'></a> 21680                 <strong class='reserved'>if</strong> (tab_bar_p)
<a id='L21681' name='L21681'></a> 21681                   <em class='brace'>{</em>
<a id='L21682' name='L21682'></a> 21682                     tab_bar_arg = <a href='../S/2224.html#L14679' title='Defined at 14679 in src/xdisp.c.'>handle_tab_bar_click</a>
<a id='L21683' name='L21683'></a> 21683                       (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, event-&gt;xbutton.type == ButtonPress,
<a id='L21684' name='L21684'></a> 21684                        x_x_to_emacs_modifiers (dpyinfo, event-&gt;xbutton.state));
<a id='L21685' name='L21685'></a> 21685                     x_flush_dirty_back_buffer_on (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L21686' name='L21686'></a> 21686                   <em class='brace'>}</em>
<a id='L21687' name='L21687'></a> 21687               <em class='brace'>}</em>
<a id='L21688' name='L21688'></a> 21688 
<a id='L21689' name='L21689'></a> 21689 <em class='sharp'>#if</em> ! <strong class='reserved'>defined</strong> (USE_GTK)
<a id='L21690' name='L21690'></a> 21690             <em class='comment'>/* Is this in the tool-bar?  */</em>
<a id='L21691' name='L21691'></a> 21691             <strong class='reserved'>if</strong> (<a href='../D/6789.html' title='Multiple defined in 2 places.'>WINDOWP</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;tool_bar_window)
<a id='L21692' name='L21692'></a> 21692                 &amp;&amp; <a href='../S/2317.html#L657' title='Defined at 657 in src/window.h.'>WINDOW_TOTAL_LINES</a> (<a href='../D/7409.html' title='Multiple defined in 2 places.'>XWINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;tool_bar_window)))
<a id='L21693' name='L21693'></a> 21693               <em class='brace'>{</em>
<a id='L21694' name='L21694'></a> 21694                 <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>;
<a id='L21695' name='L21695'></a> 21695                 <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = event-&gt;xbutton.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L21696' name='L21696'></a> 21696                 <strong class='reserved'>int</strong> y = event-&gt;xbutton.y;
<a id='L21697' name='L21697'></a> 21697 
<a id='L21698' name='L21698'></a> 21698                 <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = <a href='../S/2108.html#L1682' title='Defined at 1682 in src/window.c.'>window_from_coordinates</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, 0, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L21699' name='L21699'></a> 21699                 tool_bar_p = (<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;tool_bar_window)
<a id='L21700' name='L21700'></a> 21700                               &amp;&amp; (event-&gt;xbutton.type != ButtonRelease
<a id='L21701' name='L21701'></a> 21701                                   || <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;last_tool_bar_item != -1));
<a id='L21702' name='L21702'></a> 21702 
<a id='L21703' name='L21703'></a> 21703                 <strong class='reserved'>if</strong> (tool_bar_p &amp;&amp; event-&gt;xbutton.button &lt; 4)
<a id='L21704' name='L21704'></a> 21704                   <em class='brace'>{</em>
<a id='L21705' name='L21705'></a> 21705                     <a href='../S/2224.html#L15755' title='Defined at 15755 in src/xdisp.c.'>handle_tool_bar_click</a>
<a id='L21706' name='L21706'></a> 21706                       (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, event-&gt;xbutton.type == ButtonPress,
<a id='L21707' name='L21707'></a> 21707                        x_x_to_emacs_modifiers (dpyinfo, event-&gt;xbutton.state));
<a id='L21708' name='L21708'></a> 21708                     x_flush_dirty_back_buffer_on (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L21709' name='L21709'></a> 21709                   <em class='brace'>}</em>
<a id='L21710' name='L21710'></a> 21710               <em class='brace'>}</em>
<a id='L21711' name='L21711'></a> 21711 <em class='sharp'>#endif</em> <em class='comment'>/* !USE_GTK */</em>
<a id='L21712' name='L21712'></a> 21712 
<a id='L21713' name='L21713'></a> 21713             <strong class='reserved'>if</strong> (!(tab_bar_p &amp;&amp; <a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (tab_bar_arg)) &amp;&amp; !tool_bar_p)
<a id='L21714' name='L21714'></a> 21714 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> (USE_X_TOOLKIT) || <strong class='reserved'>defined</strong> (USE_GTK)
<a id='L21715' name='L21715'></a> 21715               <strong class='reserved'>if</strong> (! <a href='../D/15672.html' title='Multiple defined in 5 places.'>popup_activated</a> ())
<a id='L21716' name='L21716'></a> 21716 <em class='sharp'>#endif</em>
<a id='L21717' name='L21717'></a> 21717                 <em class='brace'>{</em>
<a id='L21718' name='L21718'></a> 21718                   <strong class='reserved'>if</strong> (ignore_next_mouse_click_timeout
<a id='L21719' name='L21719'></a> 21719                       &amp;&amp; dpyinfo == mouse_click_timeout_display)
<a id='L21720' name='L21720'></a> 21720                     <em class='brace'>{</em>
<a id='L21721' name='L21721'></a> 21721                       <strong class='reserved'>if</strong> (event-&gt;type == ButtonPress
<a id='L21722' name='L21722'></a> 21722                           &amp;&amp; event-&gt;xbutton.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> &gt; ignore_next_mouse_click_timeout)
<a id='L21723' name='L21723'></a> 21723                         <em class='brace'>{</em>
<a id='L21724' name='L21724'></a> 21724                           ignore_next_mouse_click_timeout = 0;
<a id='L21725' name='L21725'></a> 21725                           x_construct_mouse_click (&amp;inev.ie, &amp;event-&gt;xbutton, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L21726' name='L21726'></a> 21726                         <em class='brace'>}</em>
<a id='L21727' name='L21727'></a> 21727                       <strong class='reserved'>if</strong> (event-&gt;type == ButtonRelease)
<a id='L21728' name='L21728'></a> 21728                         ignore_next_mouse_click_timeout = 0;
<a id='L21729' name='L21729'></a> 21729                     <em class='brace'>}</em>
<a id='L21730' name='L21730'></a> 21730                   <strong class='reserved'>else</strong>
<a id='L21731' name='L21731'></a> 21731                     x_construct_mouse_click (&amp;inev.ie, &amp;event-&gt;xbutton, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L21732' name='L21732'></a> 21732 
<a id='L21733' name='L21733'></a> 21733                   <strong class='reserved'>if</strong> (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (tab_bar_arg))
<a id='L21734' name='L21734'></a> 21734                     inev.ie.arg = tab_bar_arg;
<a id='L21735' name='L21735'></a> 21735                 <em class='brace'>}</em>
<a id='L21736' name='L21736'></a> 21736 
<a id='L21737' name='L21737'></a> 21737             <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1979' title='Defined at 1979 in src/xterm.h.'>FRAME_X_EMBEDDED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L21738' name='L21738'></a> 21738                 &amp;&amp; !<a href='../D/2354.html' title='Multiple defined in 2 places.'>FRAME_NO_ACCEPT_FOCUS</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L21739' name='L21739'></a> 21739               xembed_send_message (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, event-&gt;xbutton.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>,
<a id='L21740' name='L21740'></a> 21740                                    <a href='../S/2289.html#L1149' title='Defined at 1149 in src/xterm.c.'>XEMBED_REQUEST_FOCUS</a>, 0, 0, 0);
<a id='L21741' name='L21741'></a> 21741           <em class='brace'>}</em>
<a id='L21742' name='L21742'></a> 21742         <strong class='reserved'>else</strong>
<a id='L21743' name='L21743'></a> 21743           <em class='brace'>{</em>
<a id='L21744' name='L21744'></a> 21744             <strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>
<a id='L21745' name='L21745'></a> 21745               = x_window_to_scroll_bar (event-&gt;xbutton.<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L21746' name='L21746'></a> 21746                                         event-&gt;xbutton.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, 2);
<a id='L21747' name='L21747'></a> 21747 
<a id='L21748' name='L21748'></a> 21748 <em class='sharp'>#ifdef</em> USE_TOOLKIT_SCROLL_BARS
<a id='L21749' name='L21749'></a> 21749             <em class='comment'>/* Make the "Ctrl-Mouse-2 splits window" work for toolkit</em>
<a id='L21750' name='L21750'></a> 21750 <em class='comment'>               scroll bars.  */</em>
<a id='L21751' name='L21751'></a> 21751             <strong class='reserved'>if</strong> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> &amp;&amp; event-&gt;xbutton.state &amp; ControlMask)
<a id='L21752' name='L21752'></a> 21752               <em class='brace'>{</em>
<a id='L21753' name='L21753'></a> 21753                 x_scroll_bar_handle_click (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>, event, &amp;inev.ie, Qnil);
<a id='L21754' name='L21754'></a> 21754                 *finish = <a href='../S/2289.html#L1136' title='Defined at 1136 in src/xterm.c.'>X_EVENT_DROP</a>;
<a id='L21755' name='L21755'></a> 21755               <em class='brace'>}</em>
<a id='L21756' name='L21756'></a> 21756 <em class='sharp'>#else</em> <em class='comment'>/* not USE_TOOLKIT_SCROLL_BARS */</em>
<a id='L21757' name='L21757'></a> 21757             <strong class='reserved'>if</strong> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>)
<a id='L21758' name='L21758'></a> 21758               x_scroll_bar_handle_click (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>, event, &amp;inev.ie, Qnil);
<a id='L21759' name='L21759'></a> 21759 <em class='sharp'>#endif</em> <em class='comment'>/* not USE_TOOLKIT_SCROLL_BARS */</em>
<a id='L21760' name='L21760'></a> 21760           <em class='brace'>}</em>
<a id='L21761' name='L21761'></a> 21761 
<a id='L21762' name='L21762'></a> 21762         <strong class='reserved'>if</strong> (event-&gt;type == ButtonPress)
<a id='L21763' name='L21763'></a> 21763           <em class='brace'>{</em>
<a id='L21764' name='L21764'></a> 21764             dpyinfo-&gt;grabbed |= (1 &lt;&lt; event-&gt;xbutton.button);
<a id='L21765' name='L21765'></a> 21765             dpyinfo-&gt;last_mouse_frame = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L21766' name='L21766'></a> 21766             <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; !tab_bar_p)
<a id='L21767' name='L21767'></a> 21767               <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;last_tab_bar_item = -1;
<a id='L21768' name='L21768'></a> 21768 <em class='sharp'>#if</em> ! <strong class='reserved'>defined</strong> (USE_GTK)
<a id='L21769' name='L21769'></a> 21769             <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; !tool_bar_p)
<a id='L21770' name='L21770'></a> 21770               <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;last_tool_bar_item = -1;
<a id='L21771' name='L21771'></a> 21771 <em class='sharp'>#endif</em> <em class='comment'>/* not USE_GTK */</em>
<a id='L21772' name='L21772'></a> 21772           <em class='brace'>}</em>
<a id='L21773' name='L21773'></a> 21773         <strong class='reserved'>else</strong>
<a id='L21774' name='L21774'></a> 21774           dpyinfo-&gt;grabbed &amp;= ~(1 &lt;&lt; event-&gt;xbutton.button);
<a id='L21775' name='L21775'></a> 21775 
<a id='L21776' name='L21776'></a> 21776         <em class='comment'>/* Ignore any mouse motion that happened before this event;</em>
<a id='L21777' name='L21777'></a> 21777 <em class='comment'>           any subsequent mouse-movement Emacs events should reflect</em>
<a id='L21778' name='L21778'></a> 21778 <em class='comment'>           only motion after the ButtonPress/Release.  */</em>
<a id='L21779' name='L21779'></a> 21779         <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> != 0)
<a id='L21780' name='L21780'></a> 21780           <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;mouse_moved = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L21781' name='L21781'></a> 21781 
<a id='L21782' name='L21782'></a> 21782 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> (USE_X_TOOLKIT) || <strong class='reserved'>defined</strong> (USE_GTK)
<a id='L21783' name='L21783'></a> 21783         <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2289.html#L12131' title='Defined at 12131 in src/xterm.c.'>x_menubar_window_to_frame</a> (dpyinfo, event);
<a id='L21784' name='L21784'></a> 21784         <em class='comment'>/* For a down-event in the menu bar, don't pass it to Xt or</em>
<a id='L21785' name='L21785'></a> 21785 <em class='comment'>           GTK right away.  Instead, save it and pass it to Xt or GTK</em>
<a id='L21786' name='L21786'></a> 21786 <em class='comment'>           from kbd_buffer_get_event.  That way, we can run some Lisp</em>
<a id='L21787' name='L21787'></a> 21787 <em class='comment'>           code first.  */</em>
<a id='L21788' name='L21788'></a> 21788         <strong class='reserved'>if</strong> (! <a href='../D/15672.html' title='Multiple defined in 5 places.'>popup_activated</a> ()
<a id='L21789' name='L21789'></a> 21789 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L21790' name='L21790'></a> 21790             <em class='comment'>/* Gtk+ menus only react to the first three buttons. */</em>
<a id='L21791' name='L21791'></a> 21791             &amp;&amp; event-&gt;xbutton.button &lt; 3
<a id='L21792' name='L21792'></a> 21792 <em class='sharp'>#endif</em>
<a id='L21793' name='L21793'></a> 21793             &amp;&amp; <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; event-&gt;type == ButtonPress
<a id='L21794' name='L21794'></a> 21794             <em class='comment'>/* Verify the event is really within the menu bar</em>
<a id='L21795' name='L21795'></a> 21795 <em class='comment'>               and not just sent to it due to grabbing.  */</em>
<a id='L21796' name='L21796'></a> 21796             &amp;&amp; event-&gt;xbutton.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> &gt;= 0
<a id='L21797' name='L21797'></a> 21797             &amp;&amp; event-&gt;xbutton.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> &lt; <a href='../S/2183.html#L1051' title='Defined at 1051 in src/frame.h.'>FRAME_PIXEL_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L21798' name='L21798'></a> 21798             &amp;&amp; event-&gt;xbutton.y &gt;= 0
<a id='L21799' name='L21799'></a> 21799             &amp;&amp; event-&gt;xbutton.y &lt; <a href='../D/2342.html' title='Multiple defined in 3 places.'>FRAME_MENUBAR_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L21800' name='L21800'></a> 21800             &amp;&amp; event-&gt;xbutton.same_screen)
<a id='L21801' name='L21801'></a> 21801           <em class='brace'>{</em>
<a id='L21802' name='L21802'></a> 21802 <em class='sharp'>#ifdef</em> USE_MOTIF
<a id='L21803' name='L21803'></a> 21803             Widget widget;
<a id='L21804' name='L21804'></a> 21804 
<a id='L21805' name='L21805'></a> 21805             widget = XtWindowToWidget (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L21806' name='L21806'></a> 21806                                        event-&gt;xbutton.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L21807' name='L21807'></a> 21807 
<a id='L21808' name='L21808'></a> 21808             <strong class='reserved'>if</strong> (widget &amp;&amp; XmIsCascadeButton (widget)
<a id='L21809' name='L21809'></a> 21809                 &amp;&amp; XtIsSensitive (widget))
<a id='L21810' name='L21810'></a> 21810               <em class='brace'>{</em>
<a id='L21811' name='L21811'></a> 21811 <em class='sharp'>#endif</em>
<a id='L21812' name='L21812'></a> 21812                 <strong class='reserved'>if</strong> (!<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;saved_menu_event)
<a id='L21813' name='L21813'></a> 21813                   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;saved_menu_event = <a href='../D/20068.html' title='Multiple defined in 10 places.'>xmalloc</a> (<strong class='reserved'>sizeof</strong> *event);
<a id='L21814' name='L21814'></a> 21814                 *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;saved_menu_event = *event;
<a id='L21815' name='L21815'></a> 21815                 inev.ie.kind = <a href='../S/2231.html#L198' title='Defined at 198 in src/termhooks.h.'>MENU_BAR_ACTIVATE_EVENT</a>;
<a id='L21816' name='L21816'></a> 21816                 <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (inev.ie.frame_or_window, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L21817' name='L21817'></a> 21817                 *finish = <a href='../S/2289.html#L1136' title='Defined at 1136 in src/xterm.c.'>X_EVENT_DROP</a>;
<a id='L21818' name='L21818'></a> 21818 <em class='sharp'>#ifdef</em> USE_MOTIF
<a id='L21819' name='L21819'></a> 21819               <em class='brace'>}</em>
<a id='L21820' name='L21820'></a> 21820 <em class='sharp'>#endif</em>
<a id='L21821' name='L21821'></a> 21821           <em class='brace'>}</em>
<a id='L21822' name='L21822'></a> 21822         <strong class='reserved'>else</strong>
<a id='L21823' name='L21823'></a> 21823           <strong class='reserved'>goto</strong> OTHER;
<a id='L21824' name='L21824'></a> 21824 <em class='sharp'>#endif</em> <em class='comment'>/* USE_X_TOOLKIT || USE_GTK */</em>
<a id='L21825' name='L21825'></a> 21825       <em class='brace'>}</em>
<a id='L21826' name='L21826'></a> 21826       <strong class='reserved'>break</strong>;
<a id='L21827' name='L21827'></a> 21827 
<a id='L21828' name='L21828'></a> 21828     <strong class='reserved'>case</strong> CirculateNotify:
<a id='L21829' name='L21829'></a> 21829       <strong class='reserved'>if</strong> (x_dnd_in_progress
<a id='L21830' name='L21830'></a> 21830           <em class='comment'>/* When _NET_WM_CLIENT_LIST stacking is being used, changes</em>
<a id='L21831' name='L21831'></a> 21831 <em class='comment'>             in that property are watched for, and it's not necessary</em>
<a id='L21832' name='L21832'></a> 21832 <em class='comment'>             to update the state in response to ordinary window</em>
<a id='L21833' name='L21833'></a> 21833 <em class='comment'>             substructure events.  */</em>
<a id='L21834' name='L21834'></a> 21834           &amp;&amp; !x_dnd_use_toplevels
<a id='L21835' name='L21835'></a> 21835           &amp;&amp; dpyinfo == <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (x_dnd_frame))
<a id='L21836' name='L21836'></a> 21836         x_dnd_update_state (dpyinfo, dpyinfo-&gt;last_user_time);
<a id='L21837' name='L21837'></a> 21837       <strong class='reserved'>goto</strong> OTHER;
<a id='L21838' name='L21838'></a> 21838 
<a id='L21839' name='L21839'></a> 21839     <strong class='reserved'>case</strong> CirculateRequest:
<a id='L21840' name='L21840'></a> 21840       <strong class='reserved'>goto</strong> OTHER;
<a id='L21841' name='L21841'></a> 21841 
<a id='L21842' name='L21842'></a> 21842     <strong class='reserved'>case</strong> VisibilityNotify:
<a id='L21843' name='L21843'></a> 21843       <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../D/19730.html' title='Multiple defined in 2 places.'>x_top_window_to_frame</a> (dpyinfo, event-&gt;xvisibility.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L21844' name='L21844'></a> 21844 
<a id='L21845' name='L21845'></a> 21845       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L21846' name='L21846'></a> 21846         <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;visibility_state = event-&gt;xvisibility.state;
<a id='L21847' name='L21847'></a> 21847 
<a id='L21848' name='L21848'></a> 21848       <strong class='reserved'>goto</strong> OTHER;
<a id='L21849' name='L21849'></a> 21849 
<a id='L21850' name='L21850'></a> 21850     <strong class='reserved'>case</strong> MappingNotify:
<a id='L21851' name='L21851'></a> 21851       <em class='comment'>/* Someone has changed the keyboard mapping - update the</em>
<a id='L21852' name='L21852'></a> 21852 <em class='comment'>         local cache.  */</em>
<a id='L21853' name='L21853'></a> 21853       <strong class='reserved'>switch</strong> (event-&gt;xmapping.<a href='../S/4039.html#L133' title='Defined at 133 in test/manual/etags/c-src/c.c.'>request</a>)
<a id='L21854' name='L21854'></a> 21854         <em class='brace'>{</em>
<a id='L21855' name='L21855'></a> 21855         <strong class='reserved'>case</strong> MappingModifier:
<a id='L21856' name='L21856'></a> 21856           x_find_modifier_meanings (dpyinfo);
<a id='L21857' name='L21857'></a> 21857           <a href='../D/2028.html' title='Multiple defined in 3 places.'>FALLTHROUGH</a>;
<a id='L21858' name='L21858'></a> 21858         <strong class='reserved'>case</strong> MappingKeyboard:
<a id='L21859' name='L21859'></a> 21859           XRefreshKeyboardMapping ((XMappingEvent *) &amp;event-&gt;xmapping);
<a id='L21860' name='L21860'></a> 21860         <em class='brace'>}</em>
<a id='L21861' name='L21861'></a> 21861       <strong class='reserved'>goto</strong> OTHER;
<a id='L21862' name='L21862'></a> 21862 
<a id='L21863' name='L21863'></a> 21863     <strong class='reserved'>case</strong> DestroyNotify:
<a id='L21864' name='L21864'></a> 21864       <strong class='reserved'>if</strong> (event-&gt;xdestroywindow.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>
<a id='L21865' name='L21865'></a> 21865           == dpyinfo-&gt;net_supported_window)
<a id='L21866' name='L21866'></a> 21866         dpyinfo-&gt;net_supported_window = None;
<a id='L21867' name='L21867'></a> 21867 
<a id='L21868' name='L21868'></a> 21868       <strong class='reserved'>if</strong> (event-&gt;xdestroywindow.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>
<a id='L21869' name='L21869'></a> 21869           == dpyinfo-&gt;motif_drag_window)
<a id='L21870' name='L21870'></a> 21870         <em class='comment'>/* We get DestroyNotify events for the drag window because</em>
<a id='L21871' name='L21871'></a> 21871 <em class='comment'>           x_special_window_exists_p selects for structure</em>
<a id='L21872' name='L21872'></a> 21872 <em class='comment'>           notification.  The drag window is not supposed to go away</em>
<a id='L21873' name='L21873'></a> 21873 <em class='comment'>           but not all clients obey that requirement when setting the</em>
<a id='L21874' name='L21874'></a> 21874 <em class='comment'>           drag window property.  */</em>
<a id='L21875' name='L21875'></a> 21875         dpyinfo-&gt;motif_drag_window = None;
<a id='L21876' name='L21876'></a> 21876 
<a id='L21877' name='L21877'></a> 21877       <a href='../S/2158.html#L1000' title='Defined at 1000 in src/xsettings.c.'>xft_settings_event</a> (dpyinfo, event);
<a id='L21878' name='L21878'></a> 21878       <strong class='reserved'>break</strong>;
<a id='L21879' name='L21879'></a> 21879 
<a id='L21880' name='L21880'></a> 21880 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L21881' name='L21881'></a> 21881     <strong class='reserved'>case</strong> GenericEvent:
<a id='L21882' name='L21882'></a> 21882       <em class='brace'>{</em>
<a id='L21883' name='L21883'></a> 21883         <strong class='reserved'>if</strong> (!dpyinfo-&gt;supports_xi2)
<a id='L21884' name='L21884'></a> 21884           <strong class='reserved'>goto</strong> OTHER;
<a id='L21885' name='L21885'></a> 21885 
<a id='L21886' name='L21886'></a> 21886         <strong class='reserved'>if</strong> (event-&gt;xgeneric.extension != dpyinfo-&gt;xi2_opcode)
<a id='L21887' name='L21887'></a> 21887           <em class='comment'>/* Not an XI2 event. */</em>
<a id='L21888' name='L21888'></a> 21888           <strong class='reserved'>goto</strong> OTHER;
<a id='L21889' name='L21889'></a> 21889 
<a id='L21890' name='L21890'></a> 21890         <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> must_free_data = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L21891' name='L21891'></a> 21891         XIEvent *xi_event = (XIEvent *) event-&gt;xcookie.data;
<a id='L21892' name='L21892'></a> 21892 
<a id='L21893' name='L21893'></a> 21893         <em class='comment'>/* Sometimes the event is already claimed by GTK, which</em>
<a id='L21894' name='L21894'></a> 21894 <em class='comment'>           will free its data in due course. */</em>
<a id='L21895' name='L21895'></a> 21895         <strong class='reserved'>if</strong> (!xi_event)
<a id='L21896' name='L21896'></a> 21896           <em class='brace'>{</em>
<a id='L21897' name='L21897'></a> 21897             <strong class='reserved'>if</strong> (XGetEventData (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, &amp;event-&gt;xcookie))
<a id='L21898' name='L21898'></a> 21898               must_free_data = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L21899' name='L21899'></a> 21899 
<a id='L21900' name='L21900'></a> 21900             xi_event = (XIEvent *) event-&gt;xcookie.data;
<a id='L21901' name='L21901'></a> 21901           <em class='brace'>}</em>
<a id='L21902' name='L21902'></a> 21902 
<a id='L21903' name='L21903'></a> 21903         XIDeviceEvent *xev = (XIDeviceEvent *) xi_event;
<a id='L21904' name='L21904'></a> 21904 
<a id='L21905' name='L21905'></a> 21905         <strong class='reserved'>if</strong> (!xi_event)
<a id='L21906' name='L21906'></a> 21906           <em class='brace'>{</em>
<a id='L21907' name='L21907'></a> 21907             <em class='comment'>/* It may turn out that the event data has already been</em>
<a id='L21908' name='L21908'></a> 21908 <em class='comment'>               implicitly freed for various reasons up to and</em>
<a id='L21909' name='L21909'></a> 21909 <em class='comment'>               including XMenuActivate pushing some other event onto</em>
<a id='L21910' name='L21910'></a> 21910 <em class='comment'>               the foreign-event queue, or x_menu_wait_for_events</em>
<a id='L21911' name='L21911'></a> 21911 <em class='comment'>               calling XNextEvent through a timer that tries to wait</em>
<a id='L21912' name='L21912'></a> 21912 <em class='comment'>               for input.</em>
<a id='L21913' name='L21913'></a> 21913 <em class='comment'></em>
<a id='L21914' name='L21914'></a> 21914 <em class='comment'>               In that case, XGetEventData will return True, but</em>
<a id='L21915' name='L21915'></a> 21915 <em class='comment'>               cookie-&gt;data will be NULL.  Since handling such input</em>
<a id='L21916' name='L21916'></a> 21916 <em class='comment'>               events is not really important, we can afford to</em>
<a id='L21917' name='L21917'></a> 21917 <em class='comment'>               discard them.</em>
<a id='L21918' name='L21918'></a> 21918 <em class='comment'></em>
<a id='L21919' name='L21919'></a> 21919 <em class='comment'>               The way Xlib is currently implemented makes calling</em>
<a id='L21920' name='L21920'></a> 21920 <em class='comment'>               XFreeEventData unnecessary in this case, but call it</em>
<a id='L21921' name='L21921'></a> 21921 <em class='comment'>               anyway, since not doing so may lead to a memory leak in</em>
<a id='L21922' name='L21922'></a> 21922 <em class='comment'>               the future.  */</em>
<a id='L21923' name='L21923'></a> 21923 
<a id='L21924' name='L21924'></a> 21924             <strong class='reserved'>if</strong> (must_free_data)
<a id='L21925' name='L21925'></a> 21925               XFreeEventData (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, &amp;event-&gt;xcookie);
<a id='L21926' name='L21926'></a> 21926             <strong class='reserved'>goto</strong> OTHER;
<a id='L21927' name='L21927'></a> 21927           <em class='brace'>}</em>
<a id='L21928' name='L21928'></a> 21928 
<a id='L21929' name='L21929'></a> 21929         <strong class='reserved'>switch</strong> (event-&gt;xcookie.evtype)
<a id='L21930' name='L21930'></a> 21930           <em class='brace'>{</em>
<a id='L21931' name='L21931'></a> 21931           <strong class='reserved'>case</strong> XI_FocusIn:
<a id='L21932' name='L21932'></a> 21932             <em class='brace'>{</em>
<a id='L21933' name='L21933'></a> 21933               XIFocusInEvent *focusin;
<a id='L21934' name='L21934'></a> 21934 
<a id='L21935' name='L21935'></a> 21935               focusin = (XIFocusInEvent *) xi_event;
<a id='L21936' name='L21936'></a> 21936               any = <a href='../D/19416.html' title='Multiple defined in 2 places.'>x_any_window_to_frame</a> (dpyinfo, focusin-&gt;event);
<a id='L21937' name='L21937'></a> 21937 
<a id='L21938' name='L21938'></a> 21938 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L21939' name='L21939'></a> 21939               <em class='comment'>/* Some WMs (e.g. Mutter in Gnome Shell), don't unmap</em>
<a id='L21940' name='L21940'></a> 21940 <em class='comment'>                 minimized/iconified windows; thus, for those WMs we won't get</em>
<a id='L21941' name='L21941'></a> 21941 <em class='comment'>                 a MapNotify when unminimizing/deiconifying.  Check here if we</em>
<a id='L21942' name='L21942'></a> 21942 <em class='comment'>                 are deiconizing a window (Bug42655).</em>
<a id='L21943' name='L21943'></a> 21943 <em class='comment'></em>
<a id='L21944' name='L21944'></a> 21944 <em class='comment'>                 But don't do that by default on GTK since it may cause a plain</em>
<a id='L21945' name='L21945'></a> 21945 <em class='comment'>                 invisible frame get reported as iconified, compare</em>
<a id='L21946' name='L21946'></a> 21946 <em class='comment'>                 https://lists.gnu.org/archive/html/emacs-devel/2017-02/msg00133.html.</em>
<a id='L21947' name='L21947'></a> 21947 <em class='comment'>                 That is fixed above but bites us here again.</em>
<a id='L21948' name='L21948'></a> 21948 <em class='comment'></em>
<a id='L21949' name='L21949'></a> 21949 <em class='comment'>                 The option x_set_frame_visibility_more_laxly allows to override</em>
<a id='L21950' name='L21950'></a> 21950 <em class='comment'>                 the default behavior (Bug#49955, Bug#53298).  */</em>
<a id='L21951' name='L21951'></a> 21951               <strong class='reserved'>if</strong> (<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (x_set_frame_visibility_more_laxly, Qfocus_in)
<a id='L21952' name='L21952'></a> 21952                   || <a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (x_set_frame_visibility_more_laxly, Qt))
<a id='L21953' name='L21953'></a> 21953 <em class='sharp'>#endif</em> <em class='comment'>/* USE_GTK */</em>
<a id='L21954' name='L21954'></a> 21954                 <em class='brace'>{</em>
<a id='L21955' name='L21955'></a> 21955                   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = any;
<a id='L21956' name='L21956'></a> 21956                   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; <a href='../S/2183.html#L1172' title='Defined at 1172 in src/frame.h.'>FRAME_ICONIFIED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L21957' name='L21957'></a> 21957                     <em class='brace'>{</em>
<a id='L21958' name='L21958'></a> 21958                       <a href='../S/2183.html#L1437' title='Defined at 1437 in src/frame.h.'>SET_FRAME_VISIBLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 1);
<a id='L21959' name='L21959'></a> 21959                       <a href='../S/2183.html#L1452' title='Defined at 1452 in src/frame.h.'>SET_FRAME_ICONIFIED</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L21960' name='L21960'></a> 21960                       <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;has_been_visible = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L21961' name='L21961'></a> 21961                       inev.ie.kind = <a href='../S/2231.html#L197' title='Defined at 197 in src/termhooks.h.'>DEICONIFY_EVENT</a>;
<a id='L21962' name='L21962'></a> 21962                       <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (inev.ie.frame_or_window, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L21963' name='L21963'></a> 21963                     <em class='brace'>}</em>
<a id='L21964' name='L21964'></a> 21964                 <em class='brace'>}</em>
<a id='L21965' name='L21965'></a> 21965 
<a id='L21966' name='L21966'></a> 21966               xi_focus_handle_for_device (dpyinfo, any, xi_event);
<a id='L21967' name='L21967'></a> 21967 
<a id='L21968' name='L21968'></a> 21968               <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L21969' name='L21969'></a> 21969             <em class='brace'>}</em>
<a id='L21970' name='L21970'></a> 21970 
<a id='L21971' name='L21971'></a> 21971           <strong class='reserved'>case</strong> XI_FocusOut:
<a id='L21972' name='L21972'></a> 21972             <em class='brace'>{</em>
<a id='L21973' name='L21973'></a> 21973               XIFocusOutEvent *focusout;
<a id='L21974' name='L21974'></a> 21974 
<a id='L21975' name='L21975'></a> 21975               focusout = (XIFocusOutEvent *) xi_event;
<a id='L21976' name='L21976'></a> 21976               any = <a href='../D/19416.html' title='Multiple defined in 2 places.'>x_any_window_to_frame</a> (dpyinfo, focusout-&gt;event);
<a id='L21977' name='L21977'></a> 21977               xi_focus_handle_for_device (dpyinfo, any, xi_event);
<a id='L21978' name='L21978'></a> 21978 
<a id='L21979' name='L21979'></a> 21979               <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L21980' name='L21980'></a> 21980             <em class='brace'>}</em>
<a id='L21981' name='L21981'></a> 21981 
<a id='L21982' name='L21982'></a> 21982           <strong class='reserved'>case</strong> XI_Enter:
<a id='L21983' name='L21983'></a> 21983             <em class='brace'>{</em>
<a id='L21984' name='L21984'></a> 21984               XIEnterEvent *enter = (XIEnterEvent *) xi_event;
<a id='L21985' name='L21985'></a> 21985               XMotionEvent ev;
<a id='L21986' name='L21986'></a> 21986               <strong class='reserved'>struct</strong> <a href='../S/2212.html#L275' title='Defined at 275 in src/xterm.h.'>xi_device_t</a> *source;
<a id='L21987' name='L21987'></a> 21987 
<a id='L21988' name='L21988'></a> 21988               any = <a href='../D/19730.html' title='Multiple defined in 2 places.'>x_top_window_to_frame</a> (dpyinfo, enter-&gt;event);
<a id='L21989' name='L21989'></a> 21989               source = <a href='../S/2289.html#L5732' title='Defined at 5732 in src/xterm.c.'>xi_device_from_id</a> (dpyinfo, enter-&gt;sourceid);
<a id='L21990' name='L21990'></a> 21990 
<a id='L21991' name='L21991'></a> 21991               ev.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = lrint (enter-&gt;event_x);
<a id='L21992' name='L21992'></a> 21992               ev.y = lrint (enter-&gt;event_y);
<a id='L21993' name='L21993'></a> 21993               ev.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = enter-&gt;event;
<a id='L21994' name='L21994'></a> 21994               ev.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> = enter-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L21995' name='L21995'></a> 21995               ev.send_event = enter-&gt;send_event;
<a id='L21996' name='L21996'></a> 21996 
<a id='L21997' name='L21997'></a> 21997               <a href='../S/2289.html#L7929' title='Defined at 7929 in src/xterm.c.'>x_display_set_last_user_time</a> (dpyinfo, enter-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>,
<a id='L21998' name='L21998'></a> 21998                                             enter-&gt;send_event, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L21999' name='L21999'></a> 21999 
<a id='L22000' name='L22000'></a> 22000 <em class='sharp'>#ifdef</em> USE_MOTIF
<a id='L22001' name='L22001'></a> 22001               use_copy = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L22002' name='L22002'></a> 22002 
<a id='L22003' name='L22003'></a> 22003               copy.xcrossing.type = EnterNotify;
<a id='L22004' name='L22004'></a> 22004               copy.xcrossing.serial = enter-&gt;serial;
<a id='L22005' name='L22005'></a> 22005               copy.xcrossing.send_event = enter-&gt;send_event;
<a id='L22006' name='L22006'></a> 22006               copy.xcrossing.<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> = dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>;
<a id='L22007' name='L22007'></a> 22007               copy.xcrossing.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = enter-&gt;event;
<a id='L22008' name='L22008'></a> 22008               copy.xcrossing.root = enter-&gt;root;
<a id='L22009' name='L22009'></a> 22009               copy.xcrossing.subwindow = enter-&gt;child;
<a id='L22010' name='L22010'></a> 22010               copy.xcrossing.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> = enter-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L22011' name='L22011'></a> 22011               copy.xcrossing.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = lrint (enter-&gt;event_x);
<a id='L22012' name='L22012'></a> 22012               copy.xcrossing.y = lrint (enter-&gt;event_y);
<a id='L22013' name='L22013'></a> 22013               copy.xcrossing.x_root = lrint (enter-&gt;root_x);
<a id='L22014' name='L22014'></a> 22014               copy.xcrossing.y_root = lrint (enter-&gt;root_y);
<a id='L22015' name='L22015'></a> 22015               copy.xcrossing.mode = enter-&gt;mode;
<a id='L22016' name='L22016'></a> 22016               copy.xcrossing.detail = enter-&gt;detail;
<a id='L22017' name='L22017'></a> 22017               copy.xcrossing.focus = enter-&gt;focus;
<a id='L22018' name='L22018'></a> 22018               copy.xcrossing.state = 0;
<a id='L22019' name='L22019'></a> 22019               copy.xcrossing.same_screen = True;
<a id='L22020' name='L22020'></a> 22020 <em class='sharp'>#endif</em>
<a id='L22021' name='L22021'></a> 22021 
<a id='L22022' name='L22022'></a> 22022               <em class='comment'>/* There is no need to handle entry/exit events for</em>
<a id='L22023' name='L22023'></a> 22023 <em class='comment'>                 passive focus from non-top windows at all, since they</em>
<a id='L22024' name='L22024'></a> 22024 <em class='comment'>                 are an inferiors of the frame's top window, which will</em>
<a id='L22025' name='L22025'></a> 22025 <em class='comment'>                 get virtual events.  */</em>
<a id='L22026' name='L22026'></a> 22026               <strong class='reserved'>if</strong> (any)
<a id='L22027' name='L22027'></a> 22027                 xi_focus_handle_for_device (dpyinfo, any, xi_event);
<a id='L22028' name='L22028'></a> 22028 
<a id='L22029' name='L22029'></a> 22029               <strong class='reserved'>if</strong> (!any)
<a id='L22030' name='L22030'></a> 22030                 any = <a href='../D/19416.html' title='Multiple defined in 2 places.'>x_any_window_to_frame</a> (dpyinfo, enter-&gt;event);
<a id='L22031' name='L22031'></a> 22031 
<a id='L22032' name='L22032'></a> 22032 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L168' title='Defined at 168 in src/xterm.h.'>HAVE_XINPUT2_1</a>
<a id='L22033' name='L22033'></a> 22033               <em class='comment'>/* xfwm4 selects for button events on the frame window,</em>
<a id='L22034' name='L22034'></a> 22034 <em class='comment'>                 resulting in passive grabs being generated along with</em>
<a id='L22035' name='L22035'></a> 22035 <em class='comment'>                 the delivery of emulated button events; this then</em>
<a id='L22036' name='L22036'></a> 22036 <em class='comment'>                 interferes with scrolling, since device valuators</em>
<a id='L22037' name='L22037'></a> 22037 <em class='comment'>                 will constantly be reset as the crossing events</em>
<a id='L22038' name='L22038'></a> 22038 <em class='comment'>                 related to those grabs arrive.  The only way to</em>
<a id='L22039' name='L22039'></a> 22039 <em class='comment'>                 remedy this is to never reset scroll valuators on a</em>
<a id='L22040' name='L22040'></a> 22040 <em class='comment'>                 grab-related crossing event.  (bug#57476) */</em>
<a id='L22041' name='L22041'></a> 22041 
<a id='L22042' name='L22042'></a> 22042               <strong class='reserved'>if</strong> (enter-&gt;mode != XINotifyUngrab
<a id='L22043' name='L22043'></a> 22043                   &amp;&amp; enter-&gt;mode != XINotifyGrab
<a id='L22044' name='L22044'></a> 22044                   &amp;&amp; enter-&gt;mode != XINotifyPassiveGrab
<a id='L22045' name='L22045'></a> 22045                   &amp;&amp; enter-&gt;mode != XINotifyPassiveUngrab)
<a id='L22046' name='L22046'></a> 22046                 <a href='../S/2289.html#L5835' title='Defined at 5835 in src/xterm.c.'>xi_reset_scroll_valuators_for_device_id</a> (dpyinfo,
<a id='L22047' name='L22047'></a> 22047                                                          enter-&gt;deviceid);
<a id='L22048' name='L22048'></a> 22048 <em class='sharp'>#endif</em>
<a id='L22049' name='L22049'></a> 22049 
<a id='L22050' name='L22050'></a> 22050               <em class='brace'>{</em>
<a id='L22051' name='L22051'></a> 22051 <em class='sharp'>#ifdef</em> HAVE_XWIDGETS
<a id='L22052' name='L22052'></a> 22052                 <strong class='reserved'>struct</strong> <a href='../S/2261.html#L102' title='Defined at 102 in src/xwidget.h.'>xwidget_view</a> *<a href='../S/2261.html#L102' title='Defined at 102 in src/xwidget.h.'>xwidget_view</a>;
<a id='L22053' name='L22053'></a> 22053 
<a id='L22054' name='L22054'></a> 22054                 <a href='../S/2261.html#L102' title='Defined at 102 in src/xwidget.h.'>xwidget_view</a> = <a href='../S/2334.html#L2116' title='Defined at 2116 in src/xwidget.c.'>xwidget_view_from_window</a> (enter-&gt;event);
<a id='L22055' name='L22055'></a> 22055 
<a id='L22056' name='L22056'></a> 22056                 <strong class='reserved'>if</strong> (<a href='../S/2261.html#L102' title='Defined at 102 in src/xwidget.h.'>xwidget_view</a>)
<a id='L22057' name='L22057'></a> 22057                   <em class='brace'>{</em>
<a id='L22058' name='L22058'></a> 22058                     <a href='../S/2334.html#L1924' title='Defined at 1924 in src/xwidget.c.'>xwidget_motion_or_crossing</a> (<a href='../S/2261.html#L102' title='Defined at 102 in src/xwidget.h.'>xwidget_view</a>, event);
<a id='L22059' name='L22059'></a> 22059 
<a id='L22060' name='L22060'></a> 22060                     <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L22061' name='L22061'></a> 22061                   <em class='brace'>}</em>
<a id='L22062' name='L22062'></a> 22062 <em class='sharp'>#endif</em>
<a id='L22063' name='L22063'></a> 22063               <em class='brace'>}</em>
<a id='L22064' name='L22064'></a> 22064 
<a id='L22065' name='L22065'></a> 22065               <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = any;
<a id='L22066' name='L22066'></a> 22066 
<a id='L22067' name='L22067'></a> 22067               <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; enter-&gt;event == <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L22068' name='L22068'></a> 22068                 xi_compute_root_window_offset_enter (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, enter);
<a id='L22069' name='L22069'></a> 22069 
<a id='L22070' name='L22070'></a> 22070               <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; x_mouse_click_focus_ignore_position)
<a id='L22071' name='L22071'></a> 22071                 <em class='brace'>{</em>
<a id='L22072' name='L22072'></a> 22072                   ignore_next_mouse_click_timeout = (enter-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>
<a id='L22073' name='L22073'></a> 22073                                                      + x_mouse_click_focus_ignore_time);
<a id='L22074' name='L22074'></a> 22074                   mouse_click_timeout_display = dpyinfo;
<a id='L22075' name='L22075'></a> 22075                 <em class='brace'>}</em>
<a id='L22076' name='L22076'></a> 22076 
<a id='L22077' name='L22077'></a> 22077               <em class='comment'>/* EnterNotify counts as mouse movement,</em>
<a id='L22078' name='L22078'></a> 22078 <em class='comment'>                 so update things that depend on mouse position.  */</em>
<a id='L22079' name='L22079'></a> 22079               <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; !<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;hourglass_p)
<a id='L22080' name='L22080'></a> 22080                 x_note_mouse_movement (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, &amp;ev, source ? source-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a> : Qnil);
<a id='L22081' name='L22081'></a> 22081 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L22082' name='L22082'></a> 22082               <em class='comment'>/* We may get an EnterNotify on the buttons in the toolbar.  In that</em>
<a id='L22083' name='L22083'></a> 22083 <em class='comment'>                 case we moved out of any highlighted area and need to note this.  */</em>
<a id='L22084' name='L22084'></a> 22084               <strong class='reserved'>if</strong> (!<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; dpyinfo-&gt;last_mouse_glyph_frame)
<a id='L22085' name='L22085'></a> 22085                 x_note_mouse_movement (dpyinfo-&gt;last_mouse_glyph_frame, &amp;ev,
<a id='L22086' name='L22086'></a> 22086                                        source ? source-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a> : Qnil);
<a id='L22087' name='L22087'></a> 22087 <em class='sharp'>#endif</em>
<a id='L22088' name='L22088'></a> 22088               <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L22089' name='L22089'></a> 22089             <em class='brace'>}</em>
<a id='L22090' name='L22090'></a> 22090 
<a id='L22091' name='L22091'></a> 22091           <strong class='reserved'>case</strong> XI_Leave:
<a id='L22092' name='L22092'></a> 22092             <em class='brace'>{</em>
<a id='L22093' name='L22093'></a> 22093               XILeaveEvent *leave;
<a id='L22094' name='L22094'></a> 22094               <strong class='reserved'>struct</strong> <a href='../S/2212.html#L275' title='Defined at 275 in src/xterm.h.'>xi_device_t</a> *device;
<a id='L22095' name='L22095'></a> 22095 
<a id='L22096' name='L22096'></a> 22096               leave = (XILeaveEvent *) xi_event;
<a id='L22097' name='L22097'></a> 22097 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L22098' name='L22098'></a> 22098               <strong class='reserved'>struct</strong> <a href='../S/2212.html#L275' title='Defined at 275 in src/xterm.h.'>xi_device_t</a> *source;
<a id='L22099' name='L22099'></a> 22099               XMotionEvent ev;
<a id='L22100' name='L22100'></a> 22100 
<a id='L22101' name='L22101'></a> 22101               ev.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = lrint (leave-&gt;event_x);
<a id='L22102' name='L22102'></a> 22102               ev.y = lrint (leave-&gt;event_y);
<a id='L22103' name='L22103'></a> 22103               ev.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = leave-&gt;event;
<a id='L22104' name='L22104'></a> 22104               ev.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> = leave-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L22105' name='L22105'></a> 22105               ev.send_event = leave-&gt;send_event;
<a id='L22106' name='L22106'></a> 22106 <em class='sharp'>#endif</em>
<a id='L22107' name='L22107'></a> 22107 
<a id='L22108' name='L22108'></a> 22108               any = <a href='../D/19730.html' title='Multiple defined in 2 places.'>x_top_window_to_frame</a> (dpyinfo, leave-&gt;event);
<a id='L22109' name='L22109'></a> 22109 
<a id='L22110' name='L22110'></a> 22110 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L22111' name='L22111'></a> 22111               source = <a href='../S/2289.html#L5732' title='Defined at 5732 in src/xterm.c.'>xi_device_from_id</a> (dpyinfo, leave-&gt;sourceid);
<a id='L22112' name='L22112'></a> 22112 <em class='sharp'>#endif</em>
<a id='L22113' name='L22113'></a> 22113               device = <a href='../S/2289.html#L5732' title='Defined at 5732 in src/xterm.c.'>xi_device_from_id</a> (dpyinfo, leave-&gt;deviceid);
<a id='L22114' name='L22114'></a> 22114 
<a id='L22115' name='L22115'></a> 22115               <strong class='reserved'>if</strong> (device)
<a id='L22116' name='L22116'></a> 22116                 xi_report_motion_window_clear (device);
<a id='L22117' name='L22117'></a> 22117 
<a id='L22118' name='L22118'></a> 22118               <em class='comment'>/* This allows us to catch LeaveNotify events generated by</em>
<a id='L22119' name='L22119'></a> 22119 <em class='comment'>                 popup menu grabs.  FIXME: this is right when there is a</em>
<a id='L22120' name='L22120'></a> 22120 <em class='comment'>                 focus menu, but implicit focus tracking can get screwed</em>
<a id='L22121' name='L22121'></a> 22121 <em class='comment'>                 up if we get this and no XI_Enter event later.   */</em>
<a id='L22122' name='L22122'></a> 22122 
<a id='L22123' name='L22123'></a> 22123 <em class='sharp'>#ifdef</em> USE_X_TOOLKIT
<a id='L22124' name='L22124'></a> 22124               <strong class='reserved'>if</strong> (<a href='../D/15672.html' title='Multiple defined in 5 places.'>popup_activated</a> ()
<a id='L22125' name='L22125'></a> 22125                   &amp;&amp; (leave-&gt;mode == XINotifyPassiveUngrab
<a id='L22126' name='L22126'></a> 22126                       || leave-&gt;mode == XINotifyUngrab))
<a id='L22127' name='L22127'></a> 22127                 any = <a href='../D/19416.html' title='Multiple defined in 2 places.'>x_any_window_to_frame</a> (dpyinfo, leave-&gt;event);
<a id='L22128' name='L22128'></a> 22128 <em class='sharp'>#endif</em>
<a id='L22129' name='L22129'></a> 22129 
<a id='L22130' name='L22130'></a> 22130 <em class='sharp'>#ifdef</em> USE_MOTIF
<a id='L22131' name='L22131'></a> 22131               use_copy = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L22132' name='L22132'></a> 22132 
<a id='L22133' name='L22133'></a> 22133               copy.xcrossing.type = LeaveNotify;
<a id='L22134' name='L22134'></a> 22134               copy.xcrossing.serial = leave-&gt;serial;
<a id='L22135' name='L22135'></a> 22135               copy.xcrossing.send_event = leave-&gt;send_event;
<a id='L22136' name='L22136'></a> 22136               copy.xcrossing.<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> = dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>;
<a id='L22137' name='L22137'></a> 22137               copy.xcrossing.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = leave-&gt;event;
<a id='L22138' name='L22138'></a> 22138               copy.xcrossing.root = leave-&gt;root;
<a id='L22139' name='L22139'></a> 22139               copy.xcrossing.subwindow = leave-&gt;child;
<a id='L22140' name='L22140'></a> 22140               copy.xcrossing.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> = leave-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L22141' name='L22141'></a> 22141               copy.xcrossing.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = lrint (leave-&gt;event_x);
<a id='L22142' name='L22142'></a> 22142               copy.xcrossing.y = lrint (leave-&gt;event_y);
<a id='L22143' name='L22143'></a> 22143               copy.xcrossing.x_root = lrint (leave-&gt;root_x);
<a id='L22144' name='L22144'></a> 22144               copy.xcrossing.y_root = lrint (leave-&gt;root_y);
<a id='L22145' name='L22145'></a> 22145               copy.xcrossing.mode = leave-&gt;mode;
<a id='L22146' name='L22146'></a> 22146               copy.xcrossing.detail = leave-&gt;detail;
<a id='L22147' name='L22147'></a> 22147               copy.xcrossing.focus = leave-&gt;focus;
<a id='L22148' name='L22148'></a> 22148               copy.xcrossing.state = 0;
<a id='L22149' name='L22149'></a> 22149               copy.xcrossing.same_screen = True;
<a id='L22150' name='L22150'></a> 22150 <em class='sharp'>#endif</em>
<a id='L22151' name='L22151'></a> 22151 
<a id='L22152' name='L22152'></a> 22152               <em class='comment'>/* One problem behind the design of XInput 2 scrolling is</em>
<a id='L22153' name='L22153'></a> 22153 <em class='comment'>                 that valuators are not unique to each window, but only</em>
<a id='L22154' name='L22154'></a> 22154 <em class='comment'>                 the window that has grabbed the valuator's device or</em>
<a id='L22155' name='L22155'></a> 22155 <em class='comment'>                 the window that the device's pointer is on top of can</em>
<a id='L22156' name='L22156'></a> 22156 <em class='comment'>                 receive motion events.  There is also no way to</em>
<a id='L22157' name='L22157'></a> 22157 <em class='comment'>                 retrieve the value of a valuator outside of each motion</em>
<a id='L22158' name='L22158'></a> 22158 <em class='comment'>                 event.</em>
<a id='L22159' name='L22159'></a> 22159 <em class='comment'></em>
<a id='L22160' name='L22160'></a> 22160 <em class='comment'>                 As such, to prevent wildly inaccurate results when</em>
<a id='L22161' name='L22161'></a> 22161 <em class='comment'>                 the valuators have changed outside Emacs, we reset</em>
<a id='L22162' name='L22162'></a> 22162 <em class='comment'>                 our records of each valuator's value whenever the</em>
<a id='L22163' name='L22163'></a> 22163 <em class='comment'>                 pointer moves out of a frame.  Ideally, this would</em>
<a id='L22164' name='L22164'></a> 22164 <em class='comment'>                 ignore events with a detail of XINotifyInferior, as</em>
<a id='L22165' name='L22165'></a> 22165 <em class='comment'>                 the window the pointer moved to would be one known to</em>
<a id='L22166' name='L22166'></a> 22166 <em class='comment'>                 Emacs, but the code to keep track of which valuators</em>
<a id='L22167' name='L22167'></a> 22167 <em class='comment'>                 had to be reset upon the corresponding XI_Enter event</em>
<a id='L22168' name='L22168'></a> 22168 <em class='comment'>                 was very complicated and kept running into server</em>
<a id='L22169' name='L22169'></a> 22169 <em class='comment'>                 bugs.  */</em>
<a id='L22170' name='L22170'></a> 22170 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L168' title='Defined at 168 in src/xterm.h.'>HAVE_XINPUT2_1</a>
<a id='L22171' name='L22171'></a> 22171               <em class='comment'>/* xfwm4 selects for button events on the frame window,</em>
<a id='L22172' name='L22172'></a> 22172 <em class='comment'>                 resulting in passive grabs being generated along with</em>
<a id='L22173' name='L22173'></a> 22173 <em class='comment'>                 the delivery of emulated button events; this then</em>
<a id='L22174' name='L22174'></a> 22174 <em class='comment'>                 interferes with scrolling, since device valuators</em>
<a id='L22175' name='L22175'></a> 22175 <em class='comment'>                 will constantly be reset as the crossing events</em>
<a id='L22176' name='L22176'></a> 22176 <em class='comment'>                 related to those grabs arrive.  The only way to</em>
<a id='L22177' name='L22177'></a> 22177 <em class='comment'>                 remedy this is to never reset scroll valuators on a</em>
<a id='L22178' name='L22178'></a> 22178 <em class='comment'>                 grab-related crossing event.  (bug#57476) */</em>
<a id='L22179' name='L22179'></a> 22179 
<a id='L22180' name='L22180'></a> 22180               <strong class='reserved'>if</strong> (leave-&gt;mode != XINotifyUngrab
<a id='L22181' name='L22181'></a> 22181                   &amp;&amp; leave-&gt;mode != XINotifyGrab
<a id='L22182' name='L22182'></a> 22182                   &amp;&amp; leave-&gt;mode != XINotifyPassiveUngrab
<a id='L22183' name='L22183'></a> 22183                   &amp;&amp; leave-&gt;mode != XINotifyPassiveGrab)
<a id='L22184' name='L22184'></a> 22184                 <a href='../S/2289.html#L5835' title='Defined at 5835 in src/xterm.c.'>xi_reset_scroll_valuators_for_device_id</a> (dpyinfo,
<a id='L22185' name='L22185'></a> 22185                                                          leave-&gt;deviceid);
<a id='L22186' name='L22186'></a> 22186 <em class='sharp'>#endif</em>
<a id='L22187' name='L22187'></a> 22187 
<a id='L22188' name='L22188'></a> 22188               <a href='../S/2289.html#L7929' title='Defined at 7929 in src/xterm.c.'>x_display_set_last_user_time</a> (dpyinfo, leave-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>,
<a id='L22189' name='L22189'></a> 22189                                             leave-&gt;send_event, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L22190' name='L22190'></a> 22190 
<a id='L22191' name='L22191'></a> 22191 <em class='sharp'>#ifdef</em> HAVE_XWIDGETS
<a id='L22192' name='L22192'></a> 22192               <em class='brace'>{</em>
<a id='L22193' name='L22193'></a> 22193                 <strong class='reserved'>struct</strong> <a href='../S/2261.html#L102' title='Defined at 102 in src/xwidget.h.'>xwidget_view</a> *xvw;
<a id='L22194' name='L22194'></a> 22194 
<a id='L22195' name='L22195'></a> 22195                 xvw = <a href='../S/2334.html#L2116' title='Defined at 2116 in src/xwidget.c.'>xwidget_view_from_window</a> (leave-&gt;event);
<a id='L22196' name='L22196'></a> 22196 
<a id='L22197' name='L22197'></a> 22197                 <strong class='reserved'>if</strong> (xvw)
<a id='L22198' name='L22198'></a> 22198                   <em class='brace'>{</em>
<a id='L22199' name='L22199'></a> 22199                     *finish = <a href='../S/2289.html#L1136' title='Defined at 1136 in src/xterm.c.'>X_EVENT_DROP</a>;
<a id='L22200' name='L22200'></a> 22200                     <a href='../S/2334.html#L1924' title='Defined at 1924 in src/xwidget.c.'>xwidget_motion_or_crossing</a> (xvw, event);
<a id='L22201' name='L22201'></a> 22201 
<a id='L22202' name='L22202'></a> 22202                     <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L22203' name='L22203'></a> 22203                   <em class='brace'>}</em>
<a id='L22204' name='L22204'></a> 22204               <em class='brace'>}</em>
<a id='L22205' name='L22205'></a> 22205 <em class='sharp'>#endif</em>
<a id='L22206' name='L22206'></a> 22206 
<a id='L22207' name='L22207'></a> 22207               <strong class='reserved'>if</strong> (any)
<a id='L22208' name='L22208'></a> 22208                 xi_focus_handle_for_device (dpyinfo, any, xi_event);
<a id='L22209' name='L22209'></a> 22209 
<a id='L22210' name='L22210'></a> 22210 <em class='sharp'>#ifndef</em> USE_X_TOOLKIT
<a id='L22211' name='L22211'></a> 22211               <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../D/19730.html' title='Multiple defined in 2 places.'>x_top_window_to_frame</a> (dpyinfo, leave-&gt;event);
<a id='L22212' name='L22212'></a> 22212 <em class='sharp'>#else</em>
<a id='L22213' name='L22213'></a> 22213               <em class='comment'>/* On Xt builds that have XI2, the enter and leave event</em>
<a id='L22214' name='L22214'></a> 22214 <em class='comment'>                 masks are set on the frame widget's window.  */</em>
<a id='L22215' name='L22215'></a> 22215               <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2289.html#L11957' title='Defined at 11957 in src/xterm.c.'>x_window_to_frame</a> (dpyinfo, leave-&gt;event);
<a id='L22216' name='L22216'></a> 22216 
<a id='L22217' name='L22217'></a> 22217               <strong class='reserved'>if</strong> (!<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L22218' name='L22218'></a> 22218                 <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../D/19730.html' title='Multiple defined in 2 places.'>x_top_window_to_frame</a> (dpyinfo, leave-&gt;event);
<a id='L22219' name='L22219'></a> 22219 <em class='sharp'>#endif</em>
<a id='L22220' name='L22220'></a> 22220 
<a id='L22221' name='L22221'></a> 22221               <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L22222' name='L22222'></a> 22222                 <em class='brace'>{</em>
<a id='L22223' name='L22223'></a> 22223                   <em class='comment'>/* Now clear dpyinfo-&gt;last_mouse_motion_frame, or</em>
<a id='L22224' name='L22224'></a> 22224 <em class='comment'>                     gui_redo_mouse_highlight will end up highlighting</em>
<a id='L22225' name='L22225'></a> 22225 <em class='comment'>                     the last known position of the mouse if a</em>
<a id='L22226' name='L22226'></a> 22226 <em class='comment'>                     tooltip frame is later unmapped.  */</em>
<a id='L22227' name='L22227'></a> 22227 
<a id='L22228' name='L22228'></a> 22228                   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> == dpyinfo-&gt;last_mouse_motion_frame)
<a id='L22229' name='L22229'></a> 22229                     dpyinfo-&gt;last_mouse_motion_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L22230' name='L22230'></a> 22230 
<a id='L22231' name='L22231'></a> 22231                   <em class='comment'>/* Something similar applies to</em>
<a id='L22232' name='L22232'></a> 22232 <em class='comment'>                     dpyinfo-&gt;last_mouse_glyph_frame.  */</em>
<a id='L22233' name='L22233'></a> 22233                   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> == dpyinfo-&gt;last_mouse_glyph_frame)
<a id='L22234' name='L22234'></a> 22234                     dpyinfo-&gt;last_mouse_glyph_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L22235' name='L22235'></a> 22235 
<a id='L22236' name='L22236'></a> 22236                   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> == hlinfo-&gt;mouse_face_mouse_frame)
<a id='L22237' name='L22237'></a> 22237                     <em class='brace'>{</em>
<a id='L22238' name='L22238'></a> 22238                       <em class='comment'>/* If we move outside the frame, then we're</em>
<a id='L22239' name='L22239'></a> 22239 <em class='comment'>                         certainly no longer on any text in the frame.  */</em>
<a id='L22240' name='L22240'></a> 22240                       <a href='../S/2224.html#L34014' title='Defined at 34014 in src/xdisp.c.'>clear_mouse_face</a> (hlinfo);
<a id='L22241' name='L22241'></a> 22241                       hlinfo-&gt;mouse_face_mouse_frame = 0;
<a id='L22242' name='L22242'></a> 22242                       x_flush_dirty_back_buffer_on (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L22243' name='L22243'></a> 22243                     <em class='brace'>}</em>
<a id='L22244' name='L22244'></a> 22244 
<a id='L22245' name='L22245'></a> 22245                   <em class='comment'>/* Generate a nil HELP_EVENT to cancel a help-echo.</em>
<a id='L22246' name='L22246'></a> 22246 <em class='comment'>                     Do it only if there's something to cancel.</em>
<a id='L22247' name='L22247'></a> 22247 <em class='comment'>                     Otherwise, the startup message is cleared when</em>
<a id='L22248' name='L22248'></a> 22248 <em class='comment'>                     the mouse leaves the frame.  */</em>
<a id='L22249' name='L22249'></a> 22249                   <strong class='reserved'>if</strong> (any_help_event_p
<a id='L22250' name='L22250'></a> 22250                       <em class='comment'>/* But never if `mouse-drag-and-drop-region' is</em>
<a id='L22251' name='L22251'></a> 22251 <em class='comment'>                         in progress, since that results in the</em>
<a id='L22252' name='L22252'></a> 22252 <em class='comment'>                         tooltip being dismissed when the mouse moves</em>
<a id='L22253' name='L22253'></a> 22253 <em class='comment'>                         on top.  */</em>
<a id='L22254' name='L22254'></a> 22254                       &amp;&amp; !((<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (track_mouse, Qdrag_source)
<a id='L22255' name='L22255'></a> 22255                             || <a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (track_mouse, Qdropping))
<a id='L22256' name='L22256'></a> 22256                            &amp;&amp; <a href='../S/2247.html#L5226' title='Defined at 5226 in src/frame.c.'>gui_mouse_grabbed</a> (dpyinfo)))
<a id='L22257' name='L22257'></a> 22257                     do_help = -1;
<a id='L22258' name='L22258'></a> 22258 
<a id='L22259' name='L22259'></a> 22259                   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; leave-&gt;event == <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L22260' name='L22260'></a> 22260                     xi_compute_root_window_offset_enter (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, leave);
<a id='L22261' name='L22261'></a> 22261                 <em class='brace'>}</em>
<a id='L22262' name='L22262'></a> 22262 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L22263' name='L22263'></a> 22263               <em class='comment'>/* See comment in EnterNotify above */</em>
<a id='L22264' name='L22264'></a> 22264               <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (dpyinfo-&gt;last_mouse_glyph_frame)
<a id='L22265' name='L22265'></a> 22265                 x_note_mouse_movement (dpyinfo-&gt;last_mouse_glyph_frame, &amp;ev,
<a id='L22266' name='L22266'></a> 22266                                        source ? source-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a> : Qnil);
<a id='L22267' name='L22267'></a> 22267 <em class='sharp'>#endif</em>
<a id='L22268' name='L22268'></a> 22268               <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L22269' name='L22269'></a> 22269             <em class='brace'>}</em>
<a id='L22270' name='L22270'></a> 22270 
<a id='L22271' name='L22271'></a> 22271           <strong class='reserved'>case</strong> XI_Motion:
<a id='L22272' name='L22272'></a> 22272             <em class='brace'>{</em>
<a id='L22273' name='L22273'></a> 22273               <strong class='reserved'>struct</strong> <a href='../S/2212.html#L275' title='Defined at 275 in src/xterm.h.'>xi_device_t</a> *device, *source;
<a id='L22274' name='L22274'></a> 22274 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L168' title='Defined at 168 in src/xterm.h.'>HAVE_XINPUT2_1</a>
<a id='L22275' name='L22275'></a> 22275               XIValuatorState *states;
<a id='L22276' name='L22276'></a> 22276               <strong class='reserved'>double</strong> *values;
<a id='L22277' name='L22277'></a> 22277               <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> found_valuator = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L22278' name='L22278'></a> 22278               <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> other_valuators_found = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L22279' name='L22279'></a> 22279 <em class='sharp'>#endif</em>
<a id='L22280' name='L22280'></a> 22280               <em class='comment'>/* A fake XMotionEvent for x_note_mouse_movement. */</em>
<a id='L22281' name='L22281'></a> 22281               XMotionEvent ev;
<a id='L22282' name='L22282'></a> 22282               <a href='../D/20054.html' title='Multiple defined in 2 places.'>xm_top_level_leave_message</a> lmsg;
<a id='L22283' name='L22283'></a> 22283               <a href='../D/20053.html' title='Multiple defined in 2 places.'>xm_top_level_enter_message</a> emsg;
<a id='L22284' name='L22284'></a> 22284               <a href='../D/20008.html' title='Multiple defined in 2 places.'>xm_drag_motion_message</a> dmsg;
<a id='L22285' name='L22285'></a> 22285               <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> dnd_state;
<a id='L22286' name='L22286'></a> 22286 
<a id='L22287' name='L22287'></a> 22287               source = <a href='../S/2289.html#L5732' title='Defined at 5732 in src/xterm.c.'>xi_device_from_id</a> (dpyinfo, xev-&gt;sourceid);
<a id='L22288' name='L22288'></a> 22288 
<a id='L22289' name='L22289'></a> 22289 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L168' title='Defined at 168 in src/xterm.h.'>HAVE_XINPUT2_1</a>
<a id='L22290' name='L22290'></a> 22290               states = &amp;xev-&gt;valuators;
<a id='L22291' name='L22291'></a> 22291               values = states-&gt;values;
<a id='L22292' name='L22292'></a> 22292 <em class='sharp'>#endif</em>
<a id='L22293' name='L22293'></a> 22293 
<a id='L22294' name='L22294'></a> 22294               device = <a href='../S/2289.html#L5732' title='Defined at 5732 in src/xterm.c.'>xi_device_from_id</a> (dpyinfo, xev-&gt;deviceid);
<a id='L22295' name='L22295'></a> 22295 
<a id='L22296' name='L22296'></a> 22296               <strong class='reserved'>if</strong> (!device)
<a id='L22297' name='L22297'></a> 22297                 <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L22298' name='L22298'></a> 22298 
<a id='L22299' name='L22299'></a> 22299 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L171' title='Defined at 171 in src/xterm.h.'>HAVE_XINPUT2_2</a>
<a id='L22300' name='L22300'></a> 22300               <strong class='reserved'>if</strong> (xev-&gt;flags &amp; XIPointerEmulated)
<a id='L22301' name='L22301'></a> 22301                 <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L22302' name='L22302'></a> 22302 <em class='sharp'>#endif</em>
<a id='L22303' name='L22303'></a> 22303 
<a id='L22304' name='L22304'></a> 22304 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L168' title='Defined at 168 in src/xterm.h.'>HAVE_XINPUT2_1</a>
<a id='L22305' name='L22305'></a> 22305 <em class='sharp'>#ifdef</em> HAVE_XWIDGETS
<a id='L22306' name='L22306'></a> 22306               <strong class='reserved'>struct</strong> <a href='../S/2261.html#L102' title='Defined at 102 in src/xwidget.h.'>xwidget_view</a> *xv = <a href='../S/2334.html#L2116' title='Defined at 2116 in src/xwidget.c.'>xwidget_view_from_window</a> (xev-&gt;event);
<a id='L22307' name='L22307'></a> 22307               <strong class='reserved'>double</strong> xv_total_x = 0.0;
<a id='L22308' name='L22308'></a> 22308               <strong class='reserved'>double</strong> xv_total_y = 0.0;
<a id='L22309' name='L22309'></a> 22309 <em class='sharp'>#endif</em>
<a id='L22310' name='L22310'></a> 22310               <strong class='reserved'>double</strong> total_x = 0.0;
<a id='L22311' name='L22311'></a> 22311               <strong class='reserved'>double</strong> total_y = 0.0;
<a id='L22312' name='L22312'></a> 22312 
<a id='L22313' name='L22313'></a> 22313               <strong class='reserved'>int</strong> real_x, real_y;
<a id='L22314' name='L22314'></a> 22314 
<a id='L22315' name='L22315'></a> 22315               <strong class='reserved'>for</strong> (<strong class='reserved'>int</strong> i = 0; i &lt; states-&gt;mask_len * 8; i++)
<a id='L22316' name='L22316'></a> 22316                 <em class='brace'>{</em>
<a id='L22317' name='L22317'></a> 22317                   <strong class='reserved'>if</strong> (XIMaskIsSet (states-&gt;mask, i))
<a id='L22318' name='L22318'></a> 22318                     <em class='brace'>{</em>
<a id='L22319' name='L22319'></a> 22319                       <strong class='reserved'>struct</strong> <a href='../S/2212.html#L233' title='Defined at 233 in src/xterm.h.'>xi_scroll_valuator_t</a> *val;
<a id='L22320' name='L22320'></a> 22320                       <strong class='reserved'>double</strong> delta, scroll_unit;
<a id='L22321' name='L22321'></a> 22321                       <strong class='reserved'>int</strong> scroll_height;
<a id='L22322' name='L22322'></a> 22322                       <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>;
<a id='L22323' name='L22323'></a> 22323                       <strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>;
<a id='L22324' name='L22324'></a> 22324 
<a id='L22325' name='L22325'></a> 22325                       <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L22326' name='L22326'></a> 22326 
<a id='L22327' name='L22327'></a> 22327                       <em class='comment'>/* See the comment on top of x_cache_xi_devices</em>
<a id='L22328' name='L22328'></a> 22328 <em class='comment'>                         for more details on how scroll wheel movement</em>
<a id='L22329' name='L22329'></a> 22329 <em class='comment'>                         is reported on XInput 2.  */</em>
<a id='L22330' name='L22330'></a> 22330                       delta = <a href='../S/2289.html#L5688' title='Defined at 5688 in src/xterm.c.'>x_get_scroll_valuator_delta</a> (dpyinfo, device,
<a id='L22331' name='L22331'></a> 22331                                                            i, *values, &amp;val);
<a id='L22332' name='L22332'></a> 22332                       values++;
<a id='L22333' name='L22333'></a> 22333 
<a id='L22334' name='L22334'></a> 22334                       <strong class='reserved'>if</strong> (!val)
<a id='L22335' name='L22335'></a> 22335                         <em class='brace'>{</em>
<a id='L22336' name='L22336'></a> 22336                           other_valuators_found = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L22337' name='L22337'></a> 22337                           <strong class='reserved'>continue</strong>;
<a id='L22338' name='L22338'></a> 22338                         <em class='brace'>}</em>
<a id='L22339' name='L22339'></a> 22339 
<a id='L22340' name='L22340'></a> 22340                       <strong class='reserved'>if</strong> (delta != DBL_MAX)
<a id='L22341' name='L22341'></a> 22341                         <em class='brace'>{</em>
<a id='L22342' name='L22342'></a> 22342                           <strong class='reserved'>if</strong> (!<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L22343' name='L22343'></a> 22343                             <em class='brace'>{</em>
<a id='L22344' name='L22344'></a> 22344                               <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../D/19416.html' title='Multiple defined in 2 places.'>x_any_window_to_frame</a> (dpyinfo, xev-&gt;event);
<a id='L22345' name='L22345'></a> 22345 
<a id='L22346' name='L22346'></a> 22346                               <strong class='reserved'>if</strong> (!<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L22347' name='L22347'></a> 22347                                 <em class='brace'>{</em>
<a id='L22348' name='L22348'></a> 22348 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> USE_MOTIF || !<strong class='reserved'>defined</strong> USE_TOOLKIT_SCROLL_BARS
<a id='L22349' name='L22349'></a> 22349                                   <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> = x_window_to_scroll_bar (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L22350' name='L22350'></a> 22350                                                                 xev-&gt;event, 2);
<a id='L22351' name='L22351'></a> 22351 
<a id='L22352' name='L22352'></a> 22352                                   <strong class='reserved'>if</strong> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>)
<a id='L22353' name='L22353'></a> 22353                                     <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2317.html#L613' title='Defined at 613 in src/window.h.'>WINDOW_XFRAME</a> (<a href='../D/7409.html' title='Multiple defined in 2 places.'>XWINDOW</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>));
<a id='L22354' name='L22354'></a> 22354 
<a id='L22355' name='L22355'></a> 22355                                   <strong class='reserved'>if</strong> (!<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L22356' name='L22356'></a> 22356 <em class='sharp'>#endif</em>
<a id='L22357' name='L22357'></a> 22357                                     <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L22358' name='L22358'></a> 22358                                 <em class='brace'>}</em>
<a id='L22359' name='L22359'></a> 22359                             <em class='brace'>}</em>
<a id='L22360' name='L22360'></a> 22360 
<a id='L22361' name='L22361'></a> 22361 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L22362' name='L22362'></a> 22362                           <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; <a href='../S/2362.html#L5047' title='Defined at 5047 in src/gtkutil.c.'>xg_event_is_for_scrollbar</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, event, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>))
<a id='L22363' name='L22363'></a> 22363                             *finish = <a href='../S/2289.html#L1136' title='Defined at 1136 in src/xterm.c.'>X_EVENT_DROP</a>;
<a id='L22364' name='L22364'></a> 22364 <em class='sharp'>#endif</em>
<a id='L22365' name='L22365'></a> 22365 
<a id='L22366' name='L22366'></a> 22366                           <strong class='reserved'>if</strong> (<a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) != xev-&gt;event)
<a id='L22367' name='L22367'></a> 22367                             <em class='brace'>{</em>
<a id='L22368' name='L22368'></a> 22368                               <strong class='reserved'>if</strong> (!<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>)
<a id='L22369' name='L22369'></a> 22369                                 <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> = x_window_to_scroll_bar (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, xev-&gt;event, 2);
<a id='L22370' name='L22370'></a> 22370 
<a id='L22371' name='L22371'></a> 22371                               <em class='comment'>/* If this is a scroll bar, compute the</em>
<a id='L22372' name='L22372'></a> 22372 <em class='comment'>                                 actual position directly to avoid an</em>
<a id='L22373' name='L22373'></a> 22373 <em class='comment'>                                 extra roundtrip.  */</em>
<a id='L22374' name='L22374'></a> 22374 
<a id='L22375' name='L22375'></a> 22375                               <strong class='reserved'>if</strong> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>)
<a id='L22376' name='L22376'></a> 22376                                 <em class='brace'>{</em>
<a id='L22377' name='L22377'></a> 22377                                   real_x = lrint (xev-&gt;event_x + <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;left);
<a id='L22378' name='L22378'></a> 22378                                   real_y = lrint (xev-&gt;event_y + <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>-&gt;top);
<a id='L22379' name='L22379'></a> 22379                                 <em class='brace'>}</em>
<a id='L22380' name='L22380'></a> 22380                               <strong class='reserved'>else</strong>
<a id='L22381' name='L22381'></a> 22381                                 x_translate_coordinates (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>,
<a id='L22382' name='L22382'></a> 22382                                                          lrint (xev-&gt;root_x),
<a id='L22383' name='L22383'></a> 22383                                                          lrint (xev-&gt;root_y),
<a id='L22384' name='L22384'></a> 22384                                                          &amp;real_x, &amp;real_y);
<a id='L22385' name='L22385'></a> 22385                             <em class='brace'>}</em>
<a id='L22386' name='L22386'></a> 22386                           <strong class='reserved'>else</strong>
<a id='L22387' name='L22387'></a> 22387                             <em class='brace'>{</em>
<a id='L22388' name='L22388'></a> 22388                               real_x = lrint (xev-&gt;event_x);
<a id='L22389' name='L22389'></a> 22389                               real_y = lrint (xev-&gt;event_y);
<a id='L22390' name='L22390'></a> 22390                             <em class='brace'>}</em>
<a id='L22391' name='L22391'></a> 22391 
<a id='L22392' name='L22392'></a> 22392 <em class='sharp'>#ifdef</em> HAVE_XWIDGETS
<a id='L22393' name='L22393'></a> 22393                           <strong class='reserved'>if</strong> (xv)
<a id='L22394' name='L22394'></a> 22394                             <em class='brace'>{</em>
<a id='L22395' name='L22395'></a> 22395                               <strong class='reserved'>if</strong> (val-&gt;horizontal)
<a id='L22396' name='L22396'></a> 22396                                 xv_total_x += delta;
<a id='L22397' name='L22397'></a> 22397                               <strong class='reserved'>else</strong>
<a id='L22398' name='L22398'></a> 22398                                 xv_total_y += delta;
<a id='L22399' name='L22399'></a> 22399 
<a id='L22400' name='L22400'></a> 22400                               found_valuator = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L22401' name='L22401'></a> 22401                               <strong class='reserved'>continue</strong>;
<a id='L22402' name='L22402'></a> 22402                             <em class='brace'>}</em>
<a id='L22403' name='L22403'></a> 22403 <em class='sharp'>#endif</em>
<a id='L22404' name='L22404'></a> 22404 
<a id='L22405' name='L22405'></a> 22405                           <strong class='reserved'>if</strong> (delta == 0.0)
<a id='L22406' name='L22406'></a> 22406                             found_valuator = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L22407' name='L22407'></a> 22407 
<a id='L22408' name='L22408'></a> 22408                           <strong class='reserved'>if</strong> (<a href='../D/17464.html' title='Multiple defined in 7 places.'>signbit</a> (delta) != <a href='../D/17464.html' title='Multiple defined in 7 places.'>signbit</a> (val-&gt;emacs_value))
<a id='L22409' name='L22409'></a> 22409                             val-&gt;emacs_value = 0;
<a id='L22410' name='L22410'></a> 22410 
<a id='L22411' name='L22411'></a> 22411                           val-&gt;emacs_value += delta;
<a id='L22412' name='L22412'></a> 22412 
<a id='L22413' name='L22413'></a> 22413                           <strong class='reserved'>if</strong> (mwheel_coalesce_scroll_events
<a id='L22414' name='L22414'></a> 22414                               &amp;&amp; (fabs (val-&gt;emacs_value) &lt; 1)
<a id='L22415' name='L22415'></a> 22415                               &amp;&amp; (fabs (delta) &gt; 0))
<a id='L22416' name='L22416'></a> 22416                             <strong class='reserved'>continue</strong>;
<a id='L22417' name='L22417'></a> 22417 
<a id='L22418' name='L22418'></a> 22418                           <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = <a href='../S/2108.html#L1682' title='Defined at 1682 in src/window.c.'>window_from_coordinates</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, real_x, real_y, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>,
<a id='L22419' name='L22419'></a> 22419                                                             <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L22420' name='L22420'></a> 22420 
<a id='L22421' name='L22421'></a> 22421                           <strong class='reserved'>if</strong> (<a href='../D/6789.html' title='Multiple defined in 2 places.'>WINDOWP</a> (<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>))
<a id='L22422' name='L22422'></a> 22422                             scroll_height = <a href='../D/7409.html' title='Multiple defined in 2 places.'>XWINDOW</a> (<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>)-&gt;pixel_height;
<a id='L22423' name='L22423'></a> 22423                           <strong class='reserved'>else</strong>
<a id='L22424' name='L22424'></a> 22424                             <em class='comment'>/* EVENT_X and EVENT_Y can be outside the</em>
<a id='L22425' name='L22425'></a> 22425 <em class='comment'>                               frame if F holds the input grab, so fall</em>
<a id='L22426' name='L22426'></a> 22426 <em class='comment'>                               back to the height of the frame instead.  */</em>
<a id='L22427' name='L22427'></a> 22427                             scroll_height = <a href='../S/2183.html#L1052' title='Defined at 1052 in src/frame.h.'>FRAME_PIXEL_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L22428' name='L22428'></a> 22428 
<a id='L22429' name='L22429'></a> 22429                           scroll_unit = pow (scroll_height, 2.0 / 3.0);
<a id='L22430' name='L22430'></a> 22430 
<a id='L22431' name='L22431'></a> 22431                           <strong class='reserved'>if</strong> (<a href='../S/2267.html#L3023' title='Defined at 3023 in src/lisp.h.'>NUMBERP</a> (Vx_scroll_event_delta_factor))
<a id='L22432' name='L22432'></a> 22432                             scroll_unit *= <a href='../D/7089.html' title='Multiple defined in 2 places.'>XFLOATINT</a> (Vx_scroll_event_delta_factor);
<a id='L22433' name='L22433'></a> 22433 
<a id='L22434' name='L22434'></a> 22434                           <strong class='reserved'>if</strong> (val-&gt;horizontal)
<a id='L22435' name='L22435'></a> 22435                             total_x += val-&gt;emacs_value * scroll_unit;
<a id='L22436' name='L22436'></a> 22436                           <strong class='reserved'>else</strong>
<a id='L22437' name='L22437'></a> 22437                             total_y += val-&gt;emacs_value * scroll_unit;
<a id='L22438' name='L22438'></a> 22438 
<a id='L22439' name='L22439'></a> 22439                           found_valuator = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L22440' name='L22440'></a> 22440                           val-&gt;emacs_value = 0;
<a id='L22441' name='L22441'></a> 22441                         <em class='brace'>}</em>
<a id='L22442' name='L22442'></a> 22442                     <em class='brace'>}</em>
<a id='L22443' name='L22443'></a> 22443                 <em class='brace'>}</em>
<a id='L22444' name='L22444'></a> 22444 
<a id='L22445' name='L22445'></a> 22445 <em class='sharp'>#ifdef</em> HAVE_XWIDGETS
<a id='L22446' name='L22446'></a> 22446               <strong class='reserved'>if</strong> (xv)
<a id='L22447' name='L22447'></a> 22447                 <em class='brace'>{</em>
<a id='L22448' name='L22448'></a> 22448                   <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> state;
<a id='L22449' name='L22449'></a> 22449 
<a id='L22450' name='L22450'></a> 22450                   state = <a href='../S/2289.html#L5330' title='Defined at 5330 in src/xterm.c.'>xi_convert_event_state</a> (xev);
<a id='L22451' name='L22451'></a> 22451                   <a href='../S/2289.html#L7929' title='Defined at 7929 in src/xterm.c.'>x_display_set_last_user_time</a> (dpyinfo, xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>,
<a id='L22452' name='L22452'></a> 22452                                                 xev-&gt;send_event, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L22453' name='L22453'></a> 22453 
<a id='L22454' name='L22454'></a> 22454                   <strong class='reserved'>if</strong> (found_valuator)
<a id='L22455' name='L22455'></a> 22455                     <a href='../S/2334.html#L1421' title='Defined at 1421 in src/xwidget.c.'>xwidget_scroll</a> (xv, xev-&gt;event_x, xev-&gt;event_y,
<a id='L22456' name='L22456'></a> 22456                                     -xv_total_x, -xv_total_y, state,
<a id='L22457' name='L22457'></a> 22457                                     xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>, (xv_total_x == 0.0
<a id='L22458' name='L22458'></a> 22458                                                 &amp;&amp; xv_total_y == 0.0));
<a id='L22459' name='L22459'></a> 22459                   <strong class='reserved'>else</strong>
<a id='L22460' name='L22460'></a> 22460                     <a href='../S/2334.html#L1368' title='Defined at 1368 in src/xwidget.c.'>xwidget_motion_notify</a> (xv, xev-&gt;event_x, xev-&gt;event_y,
<a id='L22461' name='L22461'></a> 22461                                            xev-&gt;root_x, xev-&gt;root_y, state,
<a id='L22462' name='L22462'></a> 22462                                            xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>);
<a id='L22463' name='L22463'></a> 22463 
<a id='L22464' name='L22464'></a> 22464                   <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L22465' name='L22465'></a> 22465                 <em class='brace'>}</em>
<a id='L22466' name='L22466'></a> 22466               <strong class='reserved'>else</strong>
<a id='L22467' name='L22467'></a> 22467                 <em class='brace'>{</em>
<a id='L22468' name='L22468'></a> 22468 <em class='sharp'>#endif</em>
<a id='L22469' name='L22469'></a> 22469                   <strong class='reserved'>if</strong> (found_valuator)
<a id='L22470' name='L22470'></a> 22470                     <em class='brace'>{</em>
<a id='L22471' name='L22471'></a> 22471                       <a href='../S/2289.html#L7929' title='Defined at 7929 in src/xterm.c.'>x_display_set_last_user_time</a> (dpyinfo, xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>,
<a id='L22472' name='L22472'></a> 22472                                                     xev-&gt;send_event, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L22473' name='L22473'></a> 22473 
<a id='L22474' name='L22474'></a> 22474 
<a id='L22475' name='L22475'></a> 22475 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> USE_GTK &amp;&amp; !<strong class='reserved'>defined</strong> HAVE_GTK3
<a id='L22476' name='L22476'></a> 22476                       <em class='comment'>/* Unlike on Motif, we can't select for XI</em>
<a id='L22477' name='L22477'></a> 22477 <em class='comment'>                         events on the scroll bar window under GTK+ 2.</em>
<a id='L22478' name='L22478'></a> 22478 <em class='comment'>                         So instead of that, just ignore XI wheel</em>
<a id='L22479' name='L22479'></a> 22479 <em class='comment'>                         events which land on a scroll bar.</em>
<a id='L22480' name='L22480'></a> 22480 <em class='comment'></em>
<a id='L22481' name='L22481'></a> 22481 <em class='comment'>                         Here we assume anything which isn't the edit</em>
<a id='L22482' name='L22482'></a> 22482 <em class='comment'>                         widget window is a scroll bar.  */</em>
<a id='L22483' name='L22483'></a> 22483 
<a id='L22484' name='L22484'></a> 22484                       <strong class='reserved'>if</strong> (xev-&gt;child != None
<a id='L22485' name='L22485'></a> 22485                           &amp;&amp; xev-&gt;child != <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L22486' name='L22486'></a> 22486                         <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L22487' name='L22487'></a> 22487 <em class='sharp'>#endif</em>
<a id='L22488' name='L22488'></a> 22488 
<a id='L22489' name='L22489'></a> 22489                       <em class='comment'>/* If this happened during a drag-and-drop</em>
<a id='L22490' name='L22490'></a> 22490 <em class='comment'>                         operation, don't send an event.  We only have</em>
<a id='L22491' name='L22491'></a> 22491 <em class='comment'>                         to set the user time.  */</em>
<a id='L22492' name='L22492'></a> 22492                       <strong class='reserved'>if</strong> (x_dnd_in_progress
<a id='L22493' name='L22493'></a> 22493                           <em class='comment'>/* If another master device moved the</em>
<a id='L22494' name='L22494'></a> 22494 <em class='comment'>                             pointer, we should put a wheel event on</em>
<a id='L22495' name='L22495'></a> 22495 <em class='comment'>                             the keyboard buffer as usual.  It will be</em>
<a id='L22496' name='L22496'></a> 22496 <em class='comment'>                             run once the drag-and-drop operation</em>
<a id='L22497' name='L22497'></a> 22497 <em class='comment'>                             completes.  */</em>
<a id='L22498' name='L22498'></a> 22498                           &amp;&amp; xev-&gt;deviceid == x_dnd_pointer_device
<a id='L22499' name='L22499'></a> 22499                           &amp;&amp; (command_loop_level + minibuf_level
<a id='L22500' name='L22500'></a> 22500                               &lt;= x_dnd_recursion_depth)
<a id='L22501' name='L22501'></a> 22501                           &amp;&amp; dpyinfo == <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (x_dnd_frame))
<a id='L22502' name='L22502'></a> 22502                         <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L22503' name='L22503'></a> 22503 
<a id='L22504' name='L22504'></a> 22504                       <strong class='reserved'>if</strong> (fabs (total_x) &gt; 0 || fabs (total_y) &gt; 0)
<a id='L22505' name='L22505'></a> 22505                         <em class='brace'>{</em>
<a id='L22506' name='L22506'></a> 22506                           inev.ie.kind = (fabs (total_y) &gt;= fabs (total_x)
<a id='L22507' name='L22507'></a> 22507                                           ? <a href='../S/2231.html#L132' title='Defined at 132 in src/termhooks.h.'>WHEEL_EVENT</a> : <a href='../S/2231.html#L149' title='Defined at 149 in src/termhooks.h.'>HORIZ_WHEEL_EVENT</a>);
<a id='L22508' name='L22508'></a> 22508                           inev.ie.timestamp = xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L22509' name='L22509'></a> 22509 
<a id='L22510' name='L22510'></a> 22510                           <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (inev.ie.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, lrint (real_x));
<a id='L22511' name='L22511'></a> 22511                           <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (inev.ie.y, lrint (real_y));
<a id='L22512' name='L22512'></a> 22512                           <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (inev.ie.frame_or_window, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L22513' name='L22513'></a> 22513 
<a id='L22514' name='L22514'></a> 22514                           inev.ie.modifiers = (<a href='../D/17464.html' title='Multiple defined in 7 places.'>signbit</a> (fabs (total_y) &gt;= fabs (total_x)
<a id='L22515' name='L22515'></a> 22515                                                         ? total_y : total_x)
<a id='L22516' name='L22516'></a> 22516                                                ? <a href='../S/2231.html#L417' title='Defined at 417 in src/termhooks.h.'>down_modifier</a> : <a href='../S/2231.html#L414' title='Defined at 414 in src/termhooks.h.'>up_modifier</a>);
<a id='L22517' name='L22517'></a> 22517                           inev.ie.modifiers
<a id='L22518' name='L22518'></a> 22518                             |= x_x_to_emacs_modifiers (dpyinfo,
<a id='L22519' name='L22519'></a> 22519                                                        xev-&gt;mods.effective);
<a id='L22520' name='L22520'></a> 22520                           inev.ie.arg = <a href='../S/2350.html#L2932' title='Defined at 2932 in src/alloc.c.'>list3</a> (Qnil,
<a id='L22521' name='L22521'></a> 22521                                                <a href='../S/2350.html#L2753' title='Defined at 2753 in src/alloc.c.'>make_float</a> (total_x),
<a id='L22522' name='L22522'></a> 22522                                                <a href='../S/2350.html#L2753' title='Defined at 2753 in src/alloc.c.'>make_float</a> (total_y));
<a id='L22523' name='L22523'></a> 22523                         <em class='brace'>}</em>
<a id='L22524' name='L22524'></a> 22524                       <strong class='reserved'>else</strong>
<a id='L22525' name='L22525'></a> 22525                         <em class='brace'>{</em>
<a id='L22526' name='L22526'></a> 22526                           inev.ie.kind = <a href='../S/2231.html#L302' title='Defined at 302 in src/termhooks.h.'>TOUCH_END_EVENT</a>;
<a id='L22527' name='L22527'></a> 22527                           inev.ie.timestamp = xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L22528' name='L22528'></a> 22528 
<a id='L22529' name='L22529'></a> 22529                           <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (inev.ie.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, lrint (real_x));
<a id='L22530' name='L22530'></a> 22530                           <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (inev.ie.y, lrint (real_y));
<a id='L22531' name='L22531'></a> 22531                           <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (inev.ie.frame_or_window, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L22532' name='L22532'></a> 22532                         <em class='brace'>}</em>
<a id='L22533' name='L22533'></a> 22533 
<a id='L22534' name='L22534'></a> 22534                       <strong class='reserved'>if</strong> (source &amp;&amp; !<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (source-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>))
<a id='L22535' name='L22535'></a> 22535                         inev.ie.device = source-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>;
<a id='L22536' name='L22536'></a> 22536 
<a id='L22537' name='L22537'></a> 22537                       <strong class='reserved'>if</strong> (!other_valuators_found)
<a id='L22538' name='L22538'></a> 22538                         <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L22539' name='L22539'></a> 22539                     <em class='brace'>}</em>
<a id='L22540' name='L22540'></a> 22540 <em class='sharp'>#ifdef</em> HAVE_XWIDGETS
<a id='L22541' name='L22541'></a> 22541                 <em class='brace'>}</em>
<a id='L22542' name='L22542'></a> 22542 <em class='sharp'>#endif</em>
<a id='L22543' name='L22543'></a> 22543 <em class='sharp'>#endif</em> <em class='comment'>/* HAVE_XINPUT2_1 */</em>
<a id='L22544' name='L22544'></a> 22544 
<a id='L22545' name='L22545'></a> 22545               <strong class='reserved'>if</strong> (!xi_position_changed (device, xev))
<a id='L22546' name='L22546'></a> 22546                 <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L22547' name='L22547'></a> 22547 
<a id='L22548' name='L22548'></a> 22548               ev.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = lrint (xev-&gt;event_x);
<a id='L22549' name='L22549'></a> 22549               ev.y = lrint (xev-&gt;event_y);
<a id='L22550' name='L22550'></a> 22550               ev.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = xev-&gt;event;
<a id='L22551' name='L22551'></a> 22551               ev.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> = xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L22552' name='L22552'></a> 22552               ev.send_event = xev-&gt;send_event;
<a id='L22553' name='L22553'></a> 22553 
<a id='L22554' name='L22554'></a> 22554 <em class='sharp'>#ifdef</em> USE_MOTIF
<a id='L22555' name='L22555'></a> 22555               use_copy = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L22556' name='L22556'></a> 22556 
<a id='L22557' name='L22557'></a> 22557               copy.xmotion.type = MotionNotify;
<a id='L22558' name='L22558'></a> 22558               copy.xmotion.serial = xev-&gt;serial;
<a id='L22559' name='L22559'></a> 22559               copy.xmotion.send_event = xev-&gt;send_event;
<a id='L22560' name='L22560'></a> 22560               copy.xmotion.<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> = dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>;
<a id='L22561' name='L22561'></a> 22561               copy.xmotion.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = xev-&gt;event;
<a id='L22562' name='L22562'></a> 22562               copy.xmotion.root = xev-&gt;root;
<a id='L22563' name='L22563'></a> 22563               copy.xmotion.subwindow = xev-&gt;child;
<a id='L22564' name='L22564'></a> 22564               copy.xmotion.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> = xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L22565' name='L22565'></a> 22565               copy.xmotion.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = lrint (xev-&gt;event_x);
<a id='L22566' name='L22566'></a> 22566               copy.xmotion.y = lrint (xev-&gt;event_y);
<a id='L22567' name='L22567'></a> 22567               copy.xmotion.x_root = lrint (xev-&gt;root_x);
<a id='L22568' name='L22568'></a> 22568               copy.xmotion.y_root = lrint (xev-&gt;root_y);
<a id='L22569' name='L22569'></a> 22569               copy.xmotion.state = <a href='../S/2289.html#L5330' title='Defined at 5330 in src/xterm.c.'>xi_convert_event_state</a> (xev);
<a id='L22570' name='L22570'></a> 22570 
<a id='L22571' name='L22571'></a> 22571               copy.xmotion.is_hint = False;
<a id='L22572' name='L22572'></a> 22572               copy.xmotion.same_screen = True;
<a id='L22573' name='L22573'></a> 22573 <em class='sharp'>#endif</em>
<a id='L22574' name='L22574'></a> 22574 
<a id='L22575' name='L22575'></a> 22575               previous_help_echo_string = help_echo_string;
<a id='L22576' name='L22576'></a> 22576               help_echo_string = Qnil;
<a id='L22577' name='L22577'></a> 22577 
<a id='L22578' name='L22578'></a> 22578               <strong class='reserved'>if</strong> (hlinfo-&gt;mouse_face_hidden)
<a id='L22579' name='L22579'></a> 22579                 <em class='brace'>{</em>
<a id='L22580' name='L22580'></a> 22580                   hlinfo-&gt;mouse_face_hidden = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L22581' name='L22581'></a> 22581                   <a href='../S/2224.html#L34014' title='Defined at 34014 in src/xdisp.c.'>clear_mouse_face</a> (hlinfo);
<a id='L22582' name='L22582'></a> 22582                 <em class='brace'>}</em>
<a id='L22583' name='L22583'></a> 22583 
<a id='L22584' name='L22584'></a> 22584               <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../D/14633.html' title='Multiple defined in 2 places.'>mouse_or_wdesc_frame</a> (dpyinfo, xev-&gt;event);
<a id='L22585' name='L22585'></a> 22585 
<a id='L22586' name='L22586'></a> 22586               <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; xev-&gt;event == <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L22587' name='L22587'></a> 22587                 <em class='comment'>/* See the comment above x_compute_root_window_offset</em>
<a id='L22588' name='L22588'></a> 22588 <em class='comment'>                   for why this optimization is performed.  */</em>
<a id='L22589' name='L22589'></a> 22589                 xi_compute_root_window_offset (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, xev);
<a id='L22590' name='L22590'></a> 22590 
<a id='L22591' name='L22591'></a> 22591               <strong class='reserved'>if</strong> (x_dnd_in_progress
<a id='L22592' name='L22592'></a> 22592                   <em class='comment'>/* Handle these events normally if the recursion</em>
<a id='L22593' name='L22593'></a> 22593 <em class='comment'>                     level is higher than when the drag-and-drop</em>
<a id='L22594' name='L22594'></a> 22594 <em class='comment'>                     operation was initiated.  This is so that mouse</em>
<a id='L22595' name='L22595'></a> 22595 <em class='comment'>                     input works while we're in the debugger for, say,</em>
<a id='L22596' name='L22596'></a> 22596 <em class='comment'>                     `x-dnd-movement-function`.  */</em>
<a id='L22597' name='L22597'></a> 22597                   &amp;&amp; (command_loop_level + minibuf_level
<a id='L22598' name='L22598'></a> 22598                       &lt;= x_dnd_recursion_depth)
<a id='L22599' name='L22599'></a> 22599                   &amp;&amp; xev-&gt;deviceid == x_dnd_pointer_device
<a id='L22600' name='L22600'></a> 22600                   &amp;&amp; dpyinfo == <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (x_dnd_frame))
<a id='L22601' name='L22601'></a> 22601                 <em class='brace'>{</em>
<a id='L22602' name='L22602'></a> 22602                   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> target, toplevel;
<a id='L22603' name='L22603'></a> 22603                   <strong class='reserved'>int</strong> target_proto, motif_style;
<a id='L22604' name='L22604'></a> 22604                   <a href='../S/2150.html#L62' title='Defined at 62 in src/pgtkgui.h.'>XRectangle</a> *r;
<a id='L22605' name='L22605'></a> 22605                   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> was_frame;
<a id='L22606' name='L22606'></a> 22606 
<a id='L22607' name='L22607'></a> 22607                   <em class='comment'>/* Always clear mouse face.  */</em>
<a id='L22608' name='L22608'></a> 22608                   <a href='../S/2224.html#L34014' title='Defined at 34014 in src/xdisp.c.'>clear_mouse_face</a> (hlinfo);
<a id='L22609' name='L22609'></a> 22609                   hlinfo-&gt;mouse_face_hidden = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L22610' name='L22610'></a> 22610 
<a id='L22611' name='L22611'></a> 22611                   <em class='comment'>/* Sometimes the drag-and-drop operation starts with the</em>
<a id='L22612' name='L22612'></a> 22612 <em class='comment'>                     pointer of a frame invisible due to input.  Since</em>
<a id='L22613' name='L22613'></a> 22613 <em class='comment'>                     motion events are ignored during that, make the pointer</em>
<a id='L22614' name='L22614'></a> 22614 <em class='comment'>                     visible manually.  */</em>
<a id='L22615' name='L22615'></a> 22615 
<a id='L22616' name='L22616'></a> 22616                   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L22617' name='L22617'></a> 22617                     <em class='brace'>{</em>
<a id='L22618' name='L22618'></a> 22618                       <a href='../S/2289.html#L11867' title='Defined at 11867 in src/xterm.c.'>XTtoggle_invisible_pointer</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L22619' name='L22619'></a> 22619 
<a id='L22620' name='L22620'></a> 22620                       r = &amp;dpyinfo-&gt;last_mouse_glyph;
<a id='L22621' name='L22621'></a> 22621 
<a id='L22622' name='L22622'></a> 22622                       <em class='comment'>/* Also remember the mouse glyph and set</em>
<a id='L22623' name='L22623'></a> 22623 <em class='comment'>                         mouse_moved.  */</em>
<a id='L22624' name='L22624'></a> 22624                       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> != dpyinfo-&gt;last_mouse_glyph_frame
<a id='L22625' name='L22625'></a> 22625                           || lrint (xev-&gt;event_x) &lt; r-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>
<a id='L22626' name='L22626'></a> 22626                           || lrint (xev-&gt;event_x) &gt;= r-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> + r-&gt;width
<a id='L22627' name='L22627'></a> 22627                           || lrint (xev-&gt;event_y) &lt; r-&gt;y
<a id='L22628' name='L22628'></a> 22628                           || lrint (xev-&gt;event_y) &gt;= r-&gt;y + r-&gt;height)
<a id='L22629' name='L22629'></a> 22629                         <em class='brace'>{</em>
<a id='L22630' name='L22630'></a> 22630                           <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;mouse_moved = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L22631' name='L22631'></a> 22631                           <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;last_mouse_device = (source ? source-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>
<a id='L22632' name='L22632'></a> 22632                                                   : Qnil);
<a id='L22633' name='L22633'></a> 22633                           dpyinfo-&gt;last_mouse_scroll_bar = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L22634' name='L22634'></a> 22634 
<a id='L22635' name='L22635'></a> 22635                           <a href='../S/2224.html#L2719' title='Defined at 2719 in src/xdisp.c.'>remember_mouse_glyph</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, lrint (xev-&gt;event_x),
<a id='L22636' name='L22636'></a> 22636                                                 lrint (xev-&gt;event_y), r);
<a id='L22637' name='L22637'></a> 22637                           dpyinfo-&gt;last_mouse_glyph_frame = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L22638' name='L22638'></a> 22638                         <em class='brace'>}</em>
<a id='L22639' name='L22639'></a> 22639                     <em class='brace'>}</em>
<a id='L22640' name='L22640'></a> 22640 
<a id='L22641' name='L22641'></a> 22641                   <strong class='reserved'>if</strong> (xev-&gt;root == dpyinfo-&gt;root_window)
<a id='L22642' name='L22642'></a> 22642                     target = <a href='../S/2289.html#L4131' title='Defined at 4131 in src/xterm.c.'>x_dnd_get_target_window</a> (dpyinfo,
<a id='L22643' name='L22643'></a> 22643                                                       lrint (xev-&gt;root_x),
<a id='L22644' name='L22644'></a> 22644                                                       lrint (xev-&gt;root_y),
<a id='L22645' name='L22645'></a> 22645                                                       &amp;target_proto,
<a id='L22646' name='L22646'></a> 22646                                                       &amp;motif_style,
<a id='L22647' name='L22647'></a> 22647                                                       &amp;toplevel,
<a id='L22648' name='L22648'></a> 22648                                                       &amp;was_frame);
<a id='L22649' name='L22649'></a> 22649                   <strong class='reserved'>else</strong>
<a id='L22650' name='L22650'></a> 22650                     target = <a href='../S/2289.html#L4119' title='Defined at 4119 in src/xterm.c.'>x_dnd_fill_empty_target</a> (&amp;target_proto,
<a id='L22651' name='L22651'></a> 22651                                                       &amp;motif_style,
<a id='L22652' name='L22652'></a> 22652                                                       &amp;toplevel,
<a id='L22653' name='L22653'></a> 22653                                                       &amp;was_frame);
<a id='L22654' name='L22654'></a> 22654 
<a id='L22655' name='L22655'></a> 22655                   <strong class='reserved'>if</strong> (toplevel != x_dnd_last_seen_toplevel)
<a id='L22656' name='L22656'></a> 22656                     <em class='brace'>{</em>
<a id='L22657' name='L22657'></a> 22657                       <strong class='reserved'>if</strong> (toplevel != <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (x_dnd_frame)
<a id='L22658' name='L22658'></a> 22658                           &amp;&amp; x_dnd_return_frame == 1)
<a id='L22659' name='L22659'></a> 22659                         x_dnd_return_frame = 2;
<a id='L22660' name='L22660'></a> 22660 
<a id='L22661' name='L22661'></a> 22661                       <strong class='reserved'>if</strong> (x_dnd_return_frame == 2
<a id='L22662' name='L22662'></a> 22662                           &amp;&amp; <a href='../D/19416.html' title='Multiple defined in 2 places.'>x_any_window_to_frame</a> (dpyinfo, toplevel))
<a id='L22663' name='L22663'></a> 22663                         <em class='brace'>{</em>
<a id='L22664' name='L22664'></a> 22664                           <strong class='reserved'>if</strong> (x_dnd_last_seen_window != None
<a id='L22665' name='L22665'></a> 22665                               &amp;&amp; x_dnd_last_protocol_version != -1
<a id='L22666' name='L22666'></a> 22666                               &amp;&amp; x_dnd_last_seen_window != <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (x_dnd_frame))
<a id='L22667' name='L22667'></a> 22667                             <a href='../S/2289.html#L4649' title='Defined at 4649 in src/xterm.c.'>x_dnd_send_leave</a> (x_dnd_frame, x_dnd_last_seen_window,
<a id='L22668' name='L22668'></a> 22668                                               x_dnd_last_seen_toplevel);
<a id='L22669' name='L22669'></a> 22669                           <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (x_dnd_last_seen_window != None
<a id='L22670' name='L22670'></a> 22670                                    &amp;&amp; <a href='../S/2289.html#L1750' title='Defined at 1750 in src/xterm.c.'>XM_DRAG_STYLE_IS_DYNAMIC</a> (x_dnd_last_motif_style)
<a id='L22671' name='L22671'></a> 22671                                    &amp;&amp; !x_dnd_disable_motif_drag
<a id='L22672' name='L22672'></a> 22672                                    &amp;&amp; x_dnd_last_seen_window != <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (x_dnd_frame))
<a id='L22673' name='L22673'></a> 22673                             <em class='brace'>{</em>
<a id='L22674' name='L22674'></a> 22674                               <strong class='reserved'>if</strong> (!x_dnd_motif_setup_p)
<a id='L22675' name='L22675'></a> 22675                                 <a href='../S/2289.html#L2528' title='Defined at 2528 in src/xterm.c.'>xm_setup_drag_info</a> (dpyinfo, x_dnd_frame);
<a id='L22676' name='L22676'></a> 22676 
<a id='L22677' name='L22677'></a> 22677                               lmsg.reason = <a href='../S/2289.html#L1718' title='Defined at 1718 in src/xterm.c.'>XM_DRAG_REASON</a> (<a href='../S/2289.html#L1732' title='Defined at 1732 in src/xterm.c.'>XM_DRAG_ORIGINATOR_INITIATOR</a>,
<a id='L22678' name='L22678'></a> 22678                                                             <a href='../S/2289.html#L1726' title='Defined at 1726 in src/xterm.c.'>XM_DRAG_REASON_TOP_LEVEL_LEAVE</a>);
<a id='L22679' name='L22679'></a> 22679                               lmsg.byteorder = <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>;
<a id='L22680' name='L22680'></a> 22680                               lmsg.zero = 0;
<a id='L22681' name='L22681'></a> 22681                               lmsg.timestamp = xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L22682' name='L22682'></a> 22682                               lmsg.source_window = <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (x_dnd_frame);
<a id='L22683' name='L22683'></a> 22683 
<a id='L22684' name='L22684'></a> 22684                               <strong class='reserved'>if</strong> (x_dnd_motif_setup_p)
<a id='L22685' name='L22685'></a> 22685                                 <a href='../S/2289.html#L2648' title='Defined at 2648 in src/xterm.c.'>xm_send_top_level_leave_message</a> (dpyinfo, <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (x_dnd_frame),
<a id='L22686' name='L22686'></a> 22686                                                                  x_dnd_last_seen_window, &amp;lmsg);
<a id='L22687' name='L22687'></a> 22687                             <em class='brace'>}</em>
<a id='L22688' name='L22688'></a> 22688 
<a id='L22689' name='L22689'></a> 22689                           x_dnd_end_window = x_dnd_last_seen_window;
<a id='L22690' name='L22690'></a> 22690                           x_dnd_last_seen_window = None;
<a id='L22691' name='L22691'></a> 22691                           x_dnd_last_seen_toplevel = None;
<a id='L22692' name='L22692'></a> 22692                           x_dnd_in_progress = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L22693' name='L22693'></a> 22693                           x_dnd_return_frame_object
<a id='L22694' name='L22694'></a> 22694                             = <a href='../D/19416.html' title='Multiple defined in 2 places.'>x_any_window_to_frame</a> (dpyinfo, toplevel);
<a id='L22695' name='L22695'></a> 22695                           x_dnd_return_frame = 3;
<a id='L22696' name='L22696'></a> 22696                           x_dnd_waiting_for_finish = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L22697' name='L22697'></a> 22697                           target = None;
<a id='L22698' name='L22698'></a> 22698                         <em class='brace'>}</em>
<a id='L22699' name='L22699'></a> 22699                     <em class='brace'>}</em>
<a id='L22700' name='L22700'></a> 22700 
<a id='L22701' name='L22701'></a> 22701                   <strong class='reserved'>if</strong> (target != x_dnd_last_seen_window)
<a id='L22702' name='L22702'></a> 22702                     <em class='brace'>{</em>
<a id='L22703' name='L22703'></a> 22703                       <strong class='reserved'>if</strong> (x_dnd_last_seen_window != None
<a id='L22704' name='L22704'></a> 22704                           &amp;&amp; x_dnd_last_protocol_version != -1
<a id='L22705' name='L22705'></a> 22705                           &amp;&amp; x_dnd_last_seen_window != <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (x_dnd_frame))
<a id='L22706' name='L22706'></a> 22706                         <a href='../S/2289.html#L4649' title='Defined at 4649 in src/xterm.c.'>x_dnd_send_leave</a> (x_dnd_frame, x_dnd_last_seen_window,
<a id='L22707' name='L22707'></a> 22707                                           x_dnd_last_seen_toplevel);
<a id='L22708' name='L22708'></a> 22708                       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (x_dnd_last_seen_window != None
<a id='L22709' name='L22709'></a> 22709                                &amp;&amp; <a href='../S/2289.html#L1750' title='Defined at 1750 in src/xterm.c.'>XM_DRAG_STYLE_IS_DYNAMIC</a> (x_dnd_last_motif_style)
<a id='L22710' name='L22710'></a> 22710                                &amp;&amp; !x_dnd_disable_motif_drag
<a id='L22711' name='L22711'></a> 22711                                &amp;&amp; x_dnd_last_seen_window != <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (x_dnd_frame))
<a id='L22712' name='L22712'></a> 22712                         <em class='brace'>{</em>
<a id='L22713' name='L22713'></a> 22713                           <strong class='reserved'>if</strong> (!x_dnd_motif_setup_p)
<a id='L22714' name='L22714'></a> 22714                             <a href='../S/2289.html#L2528' title='Defined at 2528 in src/xterm.c.'>xm_setup_drag_info</a> (dpyinfo, x_dnd_frame);
<a id='L22715' name='L22715'></a> 22715 
<a id='L22716' name='L22716'></a> 22716                           <em class='comment'>/* This is apparently required.  If we don't</em>
<a id='L22717' name='L22717'></a> 22717 <em class='comment'>                             send a motion event with the current root</em>
<a id='L22718' name='L22718'></a> 22718 <em class='comment'>                             window coordinates of the pointer before</em>
<a id='L22719' name='L22719'></a> 22719 <em class='comment'>                             the top level leave, then Motif displays</em>
<a id='L22720' name='L22720'></a> 22720 <em class='comment'>                             an ugly black border around the previous</em>
<a id='L22721' name='L22721'></a> 22721 <em class='comment'>                             drop site.  */</em>
<a id='L22722' name='L22722'></a> 22722 
<a id='L22723' name='L22723'></a> 22723                           dmsg.reason = <a href='../S/2289.html#L1718' title='Defined at 1718 in src/xterm.c.'>XM_DRAG_REASON</a> (<a href='../S/2289.html#L1732' title='Defined at 1732 in src/xterm.c.'>XM_DRAG_ORIGINATOR_INITIATOR</a>,
<a id='L22724' name='L22724'></a> 22724                                                         <a href='../S/2289.html#L1727' title='Defined at 1727 in src/xterm.c.'>XM_DRAG_REASON_DRAG_MOTION</a>);
<a id='L22725' name='L22725'></a> 22725                           dmsg.byteorder = <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>;
<a id='L22726' name='L22726'></a> 22726                           dmsg.side_effects
<a id='L22727' name='L22727'></a> 22727                             = <a href='../S/2289.html#L1689' title='Defined at 1689 in src/xterm.c.'>XM_DRAG_SIDE_EFFECT</a> (<a href='../S/2289.html#L1766' title='Defined at 1766 in src/xterm.c.'>xm_side_effect_from_action</a> (dpyinfo,
<a id='L22728' name='L22728'></a> 22728                                                                                x_dnd_wanted_action),
<a id='L22729' name='L22729'></a> 22729                                                    <a href='../S/2289.html#L1758' title='Defined at 1758 in src/xterm.c.'>XM_DROP_SITE_NONE</a>, x_dnd_motif_operations,
<a id='L22730' name='L22730'></a> 22730                                                    <a href='../S/2289.html#L1715' title='Defined at 1715 in src/xterm.c.'>XM_DROP_ACTION_DROP_CANCEL</a>);
<a id='L22731' name='L22731'></a> 22731                           dmsg.timestamp = xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L22732' name='L22732'></a> 22732                           dmsg.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = lrint (xev-&gt;root_x);
<a id='L22733' name='L22733'></a> 22733                           dmsg.y = lrint (xev-&gt;root_y);
<a id='L22734' name='L22734'></a> 22734 
<a id='L22735' name='L22735'></a> 22735                           lmsg.reason = <a href='../S/2289.html#L1718' title='Defined at 1718 in src/xterm.c.'>XM_DRAG_REASON</a> (<a href='../S/2289.html#L1732' title='Defined at 1732 in src/xterm.c.'>XM_DRAG_ORIGINATOR_INITIATOR</a>,
<a id='L22736' name='L22736'></a> 22736                                                         <a href='../S/2289.html#L1726' title='Defined at 1726 in src/xterm.c.'>XM_DRAG_REASON_TOP_LEVEL_LEAVE</a>);
<a id='L22737' name='L22737'></a> 22737                           lmsg.byteorder = <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>;
<a id='L22738' name='L22738'></a> 22738                           lmsg.zero = 0;
<a id='L22739' name='L22739'></a> 22739                           lmsg.timestamp = xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L22740' name='L22740'></a> 22740                           lmsg.source_window = <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (x_dnd_frame);
<a id='L22741' name='L22741'></a> 22741 
<a id='L22742' name='L22742'></a> 22742                           <strong class='reserved'>if</strong> (x_dnd_motif_setup_p)
<a id='L22743' name='L22743'></a> 22743                             <em class='brace'>{</em>
<a id='L22744' name='L22744'></a> 22744                               <a href='../S/2289.html#L2617' title='Defined at 2617 in src/xterm.c.'>xm_send_drag_motion_message</a> (dpyinfo, <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (x_dnd_frame),
<a id='L22745' name='L22745'></a> 22745                                                            x_dnd_last_seen_window, &amp;dmsg);
<a id='L22746' name='L22746'></a> 22746                               <a href='../S/2289.html#L2648' title='Defined at 2648 in src/xterm.c.'>xm_send_top_level_leave_message</a> (dpyinfo, <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (x_dnd_frame),
<a id='L22747' name='L22747'></a> 22747                                                                x_dnd_last_seen_window, &amp;lmsg);
<a id='L22748' name='L22748'></a> 22748                             <em class='brace'>}</em>
<a id='L22749' name='L22749'></a> 22749                         <em class='brace'>}</em>
<a id='L22750' name='L22750'></a> 22750 
<a id='L22751' name='L22751'></a> 22751                       x_dnd_action = None;
<a id='L22752' name='L22752'></a> 22752                       x_dnd_last_seen_toplevel = toplevel;
<a id='L22753' name='L22753'></a> 22753                       x_dnd_last_seen_window = target;
<a id='L22754' name='L22754'></a> 22754                       x_dnd_last_protocol_version = target_proto;
<a id='L22755' name='L22755'></a> 22755                       x_dnd_last_motif_style = motif_style;
<a id='L22756' name='L22756'></a> 22756                       x_dnd_last_window_is_frame = was_frame;
<a id='L22757' name='L22757'></a> 22757 
<a id='L22758' name='L22758'></a> 22758                       <strong class='reserved'>if</strong> (target != None &amp;&amp; x_dnd_last_protocol_version != -1)
<a id='L22759' name='L22759'></a> 22759                         <a href='../S/2289.html#L4536' title='Defined at 4536 in src/xterm.c.'>x_dnd_send_enter</a> (x_dnd_frame, target,
<a id='L22760' name='L22760'></a> 22760                                           x_dnd_last_seen_toplevel,
<a id='L22761' name='L22761'></a> 22761                                           x_dnd_last_protocol_version);
<a id='L22762' name='L22762'></a> 22762                       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (target != None &amp;&amp; <a href='../S/2289.html#L1750' title='Defined at 1750 in src/xterm.c.'>XM_DRAG_STYLE_IS_DYNAMIC</a> (x_dnd_last_motif_style)
<a id='L22763' name='L22763'></a> 22763                                &amp;&amp; !x_dnd_disable_motif_drag)
<a id='L22764' name='L22764'></a> 22764                         <em class='brace'>{</em>
<a id='L22765' name='L22765'></a> 22765                           <strong class='reserved'>if</strong> (!x_dnd_motif_setup_p)
<a id='L22766' name='L22766'></a> 22766                             <a href='../S/2289.html#L2528' title='Defined at 2528 in src/xterm.c.'>xm_setup_drag_info</a> (dpyinfo, x_dnd_frame);
<a id='L22767' name='L22767'></a> 22767 
<a id='L22768' name='L22768'></a> 22768                           emsg.reason = <a href='../S/2289.html#L1718' title='Defined at 1718 in src/xterm.c.'>XM_DRAG_REASON</a> (<a href='../S/2289.html#L1732' title='Defined at 1732 in src/xterm.c.'>XM_DRAG_ORIGINATOR_INITIATOR</a>,
<a id='L22769' name='L22769'></a> 22769                                                         <a href='../S/2289.html#L1725' title='Defined at 1725 in src/xterm.c.'>XM_DRAG_REASON_TOP_LEVEL_ENTER</a>);
<a id='L22770' name='L22770'></a> 22770                           emsg.byteorder = <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>;
<a id='L22771' name='L22771'></a> 22771                           emsg.zero = 0;
<a id='L22772' name='L22772'></a> 22772                           emsg.timestamp = xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L22773' name='L22773'></a> 22773                           emsg.source_window = <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (x_dnd_frame);
<a id='L22774' name='L22774'></a> 22774                           emsg.index_atom = x_dnd_motif_atom;
<a id='L22775' name='L22775'></a> 22775 
<a id='L22776' name='L22776'></a> 22776                           <strong class='reserved'>if</strong> (x_dnd_motif_setup_p)
<a id='L22777' name='L22777'></a> 22777                             <a href='../S/2289.html#L2590' title='Defined at 2590 in src/xterm.c.'>xm_send_top_level_enter_message</a> (dpyinfo, <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (x_dnd_frame),
<a id='L22778' name='L22778'></a> 22778                                                              target, &amp;emsg);
<a id='L22779' name='L22779'></a> 22779                         <em class='brace'>}</em>
<a id='L22780' name='L22780'></a> 22780                     <em class='brace'>}</em>
<a id='L22781' name='L22781'></a> 22781                   <strong class='reserved'>else</strong>
<a id='L22782' name='L22782'></a> 22782                     x_dnd_last_seen_toplevel = toplevel;
<a id='L22783' name='L22783'></a> 22783 
<a id='L22784' name='L22784'></a> 22784                   <strong class='reserved'>if</strong> (x_dnd_last_window_is_frame &amp;&amp; target != None)
<a id='L22785' name='L22785'></a> 22785                     <a href='../S/2289.html#L4924' title='Defined at 4924 in src/xterm.c.'>x_dnd_note_self_position</a> (dpyinfo, target,
<a id='L22786' name='L22786'></a> 22786                                               lrint (xev-&gt;root_x),
<a id='L22787' name='L22787'></a> 22787                                               lrint (xev-&gt;root_y));
<a id='L22788' name='L22788'></a> 22788                   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (x_dnd_last_protocol_version != -1 &amp;&amp; target != None)
<a id='L22789' name='L22789'></a> 22789                     <em class='brace'>{</em>
<a id='L22790' name='L22790'></a> 22790                       dnd_state = <a href='../S/2289.html#L5330' title='Defined at 5330 in src/xterm.c.'>xi_convert_event_state</a> (xev);
<a id='L22791' name='L22791'></a> 22791 
<a id='L22792' name='L22792'></a> 22792                       <a href='../S/2289.html#L4574' title='Defined at 4574 in src/xterm.c.'>x_dnd_send_position</a> (x_dnd_frame, target,
<a id='L22793' name='L22793'></a> 22793                                            x_dnd_last_seen_toplevel,
<a id='L22794' name='L22794'></a> 22794                                            x_dnd_last_protocol_version,
<a id='L22795' name='L22795'></a> 22795                                            lrint (xev-&gt;root_x),
<a id='L22796' name='L22796'></a> 22796                                            lrint (xev-&gt;root_y),
<a id='L22797' name='L22797'></a> 22797                                            x_dnd_selection_timestamp,
<a id='L22798' name='L22798'></a> 22798                                            x_dnd_wanted_action, 0,
<a id='L22799' name='L22799'></a> 22799                                            dnd_state);
<a id='L22800' name='L22800'></a> 22800                     <em class='brace'>}</em>
<a id='L22801' name='L22801'></a> 22801                   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (<a href='../S/2289.html#L1750' title='Defined at 1750 in src/xterm.c.'>XM_DRAG_STYLE_IS_DYNAMIC</a> (x_dnd_last_motif_style) &amp;&amp; target != None
<a id='L22802' name='L22802'></a> 22802                            &amp;&amp; !x_dnd_disable_motif_drag)
<a id='L22803' name='L22803'></a> 22803                     <em class='brace'>{</em>
<a id='L22804' name='L22804'></a> 22804                       <strong class='reserved'>if</strong> (!x_dnd_motif_setup_p)
<a id='L22805' name='L22805'></a> 22805                         <a href='../S/2289.html#L2528' title='Defined at 2528 in src/xterm.c.'>xm_setup_drag_info</a> (dpyinfo, x_dnd_frame);
<a id='L22806' name='L22806'></a> 22806 
<a id='L22807' name='L22807'></a> 22807                       dmsg.reason = <a href='../S/2289.html#L1718' title='Defined at 1718 in src/xterm.c.'>XM_DRAG_REASON</a> (<a href='../S/2289.html#L1732' title='Defined at 1732 in src/xterm.c.'>XM_DRAG_ORIGINATOR_INITIATOR</a>,
<a id='L22808' name='L22808'></a> 22808                                                     <a href='../S/2289.html#L1727' title='Defined at 1727 in src/xterm.c.'>XM_DRAG_REASON_DRAG_MOTION</a>);
<a id='L22809' name='L22809'></a> 22809                       dmsg.byteorder = <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>;
<a id='L22810' name='L22810'></a> 22810                       dmsg.side_effects
<a id='L22811' name='L22811'></a> 22811                         = <a href='../S/2289.html#L1689' title='Defined at 1689 in src/xterm.c.'>XM_DRAG_SIDE_EFFECT</a> (<a href='../S/2289.html#L1766' title='Defined at 1766 in src/xterm.c.'>xm_side_effect_from_action</a> (dpyinfo,
<a id='L22812' name='L22812'></a> 22812                                                                            x_dnd_wanted_action),
<a id='L22813' name='L22813'></a> 22813                                                <a href='../S/2289.html#L1756' title='Defined at 1756 in src/xterm.c.'>XM_DROP_SITE_VALID</a>, x_dnd_motif_operations,
<a id='L22814' name='L22814'></a> 22814                                                (!x_dnd_xm_use_help
<a id='L22815' name='L22815'></a> 22815                                                 ? <a href='../S/2289.html#L1713' title='Defined at 1713 in src/xterm.c.'>XM_DROP_ACTION_DROP</a>
<a id='L22816' name='L22816'></a> 22816                                                 : <a href='../S/2289.html#L1714' title='Defined at 1714 in src/xterm.c.'>XM_DROP_ACTION_DROP_HELP</a>));
<a id='L22817' name='L22817'></a> 22817                       dmsg.timestamp = xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L22818' name='L22818'></a> 22818                       dmsg.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = lrint (xev-&gt;root_x);
<a id='L22819' name='L22819'></a> 22819                       dmsg.y = lrint (xev-&gt;root_y);
<a id='L22820' name='L22820'></a> 22820 
<a id='L22821' name='L22821'></a> 22821                       <strong class='reserved'>if</strong> (x_dnd_motif_setup_p)
<a id='L22822' name='L22822'></a> 22822                         <a href='../S/2289.html#L2617' title='Defined at 2617 in src/xterm.c.'>xm_send_drag_motion_message</a> (dpyinfo, <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (x_dnd_frame),
<a id='L22823' name='L22823'></a> 22823                                                      target, &amp;dmsg);
<a id='L22824' name='L22824'></a> 22824                     <em class='brace'>}</em>
<a id='L22825' name='L22825'></a> 22825 
<a id='L22826' name='L22826'></a> 22826                   x_dnd_update_tooltip_position (xev-&gt;root_x, xev-&gt;root_y);
<a id='L22827' name='L22827'></a> 22827 
<a id='L22828' name='L22828'></a> 22828                   <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L22829' name='L22829'></a> 22829                 <em class='brace'>}</em>
<a id='L22830' name='L22830'></a> 22830 
<a id='L22831' name='L22831'></a> 22831 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L22832' name='L22832'></a> 22832               <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; <a href='../S/2362.html#L5047' title='Defined at 5047 in src/gtkutil.c.'>xg_event_is_for_scrollbar</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, event, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>))
<a id='L22833' name='L22833'></a> 22833                 <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = 0;
<a id='L22834' name='L22834'></a> 22834 <em class='sharp'>#endif</em>
<a id='L22835' name='L22835'></a> 22835               <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L22836' name='L22836'></a> 22836                 <em class='brace'>{</em>
<a id='L22837' name='L22837'></a> 22837                   <strong class='reserved'>if</strong> (xev-&gt;event != <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L22838' name='L22838'></a> 22838                     <em class='brace'>{</em>
<a id='L22839' name='L22839'></a> 22839                       x_translate_coordinates (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, lrint (xev-&gt;root_x),
<a id='L22840' name='L22840'></a> 22840                                                lrint (xev-&gt;root_y),
<a id='L22841' name='L22841'></a> 22841                                                &amp;ev.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, &amp;ev.y);
<a id='L22842' name='L22842'></a> 22842                       ev.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L22843' name='L22843'></a> 22843                     <em class='brace'>}</em>
<a id='L22844' name='L22844'></a> 22844 
<a id='L22845' name='L22845'></a> 22845                   <em class='comment'>/* Maybe generate a SELECT_WINDOW_EVENT for</em>
<a id='L22846' name='L22846'></a> 22846 <em class='comment'>                     `mouse-autoselect-window' but don't let popup menus</em>
<a id='L22847' name='L22847'></a> 22847 <em class='comment'>                     interfere with this (Bug#1261).  */</em>
<a id='L22848' name='L22848'></a> 22848                   <strong class='reserved'>if</strong> (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (Vmouse_autoselect_window)
<a id='L22849' name='L22849'></a> 22849                       &amp;&amp; !<a href='../D/15672.html' title='Multiple defined in 5 places.'>popup_activated</a> ()
<a id='L22850' name='L22850'></a> 22850                       <em class='comment'>/* Don't switch if we're currently in the minibuffer.</em>
<a id='L22851' name='L22851'></a> 22851 <em class='comment'>                         This tries to work around problems where the</em>
<a id='L22852' name='L22852'></a> 22852 <em class='comment'>                         minibuffer gets unselected unexpectedly, and where</em>
<a id='L22853' name='L22853'></a> 22853 <em class='comment'>                         you then have to move your mouse all the way down to</em>
<a id='L22854' name='L22854'></a> 22854 <em class='comment'>                         the minibuffer to select it.  */</em>
<a id='L22855' name='L22855'></a> 22855                       &amp;&amp; !<a href='../S/2317.html#L558' title='Defined at 558 in src/window.h.'>MINI_WINDOW_P</a> (<a href='../D/7409.html' title='Multiple defined in 2 places.'>XWINDOW</a> (selected_window))
<a id='L22856' name='L22856'></a> 22856                       <em class='comment'>/* With `focus-follows-mouse' non-nil create an event</em>
<a id='L22857' name='L22857'></a> 22857 <em class='comment'>                         also when the target window is on another frame.  */</em>
<a id='L22858' name='L22858'></a> 22858                       &amp;&amp; (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> == <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (selected_frame)
<a id='L22859' name='L22859'></a> 22859                           || !<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (focus_follows_mouse)))
<a id='L22860' name='L22860'></a> 22860                     <em class='brace'>{</em>
<a id='L22861' name='L22861'></a> 22861                       <strong class='reserved'>static</strong> <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> last_mouse_window;
<a id='L22862' name='L22862'></a> 22862                       <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = <a href='../S/2108.html#L1682' title='Defined at 1682 in src/window.c.'>window_from_coordinates</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, ev.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, ev.y, 0, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L22863' name='L22863'></a> 22863 
<a id='L22864' name='L22864'></a> 22864                       <em class='comment'>/* A window will be autoselected only when it is not</em>
<a id='L22865' name='L22865'></a> 22865 <em class='comment'>                         selected now and the last mouse movement event was</em>
<a id='L22866' name='L22866'></a> 22866 <em class='comment'>                         not in it.  The remainder of the code is a bit vague</em>
<a id='L22867' name='L22867'></a> 22867 <em class='comment'>                         wrt what a "window" is.  For immediate autoselection,</em>
<a id='L22868' name='L22868'></a> 22868 <em class='comment'>                         the window is usually the entire window but for GTK</em>
<a id='L22869' name='L22869'></a> 22869 <em class='comment'>                         where the scroll bars don't count.  For delayed</em>
<a id='L22870' name='L22870'></a> 22870 <em class='comment'>                         autoselection the window is usually the window's text</em>
<a id='L22871' name='L22871'></a> 22871 <em class='comment'>                         area including the margins.  */</em>
<a id='L22872' name='L22872'></a> 22872                       <strong class='reserved'>if</strong> (<a href='../D/6789.html' title='Multiple defined in 2 places.'>WINDOWP</a> (<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>)
<a id='L22873' name='L22873'></a> 22873                           &amp;&amp; !<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, last_mouse_window)
<a id='L22874' name='L22874'></a> 22874                           &amp;&amp; !<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, selected_window))
<a id='L22875' name='L22875'></a> 22875                         <em class='brace'>{</em>
<a id='L22876' name='L22876'></a> 22876                           inev.ie.kind = <a href='../S/2231.html#L242' title='Defined at 242 in src/termhooks.h.'>SELECT_WINDOW_EVENT</a>;
<a id='L22877' name='L22877'></a> 22877                           inev.ie.frame_or_window = <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>;
<a id='L22878' name='L22878'></a> 22878 
<a id='L22879' name='L22879'></a> 22879                           <strong class='reserved'>if</strong> (source)
<a id='L22880' name='L22880'></a> 22880                             inev.ie.device = source-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>;
<a id='L22881' name='L22881'></a> 22881                         <em class='brace'>}</em>
<a id='L22882' name='L22882'></a> 22882 
<a id='L22883' name='L22883'></a> 22883                       <em class='comment'>/* Remember the last window where we saw the mouse.  */</em>
<a id='L22884' name='L22884'></a> 22884                       last_mouse_window = <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>;
<a id='L22885' name='L22885'></a> 22885                     <em class='brace'>}</em>
<a id='L22886' name='L22886'></a> 22886 
<a id='L22887' name='L22887'></a> 22887                   <strong class='reserved'>if</strong> (!x_note_mouse_movement (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, &amp;ev, source ? source-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a> : Qnil))
<a id='L22888' name='L22888'></a> 22888                     help_echo_string = previous_help_echo_string;
<a id='L22889' name='L22889'></a> 22889                 <em class='brace'>}</em>
<a id='L22890' name='L22890'></a> 22890               <strong class='reserved'>else</strong>
<a id='L22891' name='L22891'></a> 22891                 <em class='brace'>{</em>
<a id='L22892' name='L22892'></a> 22892 <em class='sharp'>#ifndef</em> USE_TOOLKIT_SCROLL_BARS
<a id='L22893' name='L22893'></a> 22893                   <strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>
<a id='L22894' name='L22894'></a> 22894                     = x_window_to_scroll_bar (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, xev-&gt;event, 2);
<a id='L22895' name='L22895'></a> 22895 
<a id='L22896' name='L22896'></a> 22896                   <strong class='reserved'>if</strong> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>)
<a id='L22897' name='L22897'></a> 22897                     x_scroll_bar_note_movement (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>, &amp;ev);
<a id='L22898' name='L22898'></a> 22898 <em class='sharp'>#endif</em> <em class='comment'>/* USE_TOOLKIT_SCROLL_BARS */</em>
<a id='L22899' name='L22899'></a> 22899 
<a id='L22900' name='L22900'></a> 22900                   <em class='comment'>/* If we move outside the frame, then we're</em>
<a id='L22901' name='L22901'></a> 22901 <em class='comment'>                     certainly no longer on any text in the frame.  */</em>
<a id='L22902' name='L22902'></a> 22902                   <a href='../S/2224.html#L34014' title='Defined at 34014 in src/xdisp.c.'>clear_mouse_face</a> (hlinfo);
<a id='L22903' name='L22903'></a> 22903                 <em class='brace'>}</em>
<a id='L22904' name='L22904'></a> 22904 
<a id='L22905' name='L22905'></a> 22905               <em class='comment'>/* If the contents of the global variable help_echo_string</em>
<a id='L22906' name='L22906'></a> 22906 <em class='comment'>                 has changed, generate a HELP_EVENT.  */</em>
<a id='L22907' name='L22907'></a> 22907               <strong class='reserved'>if</strong> (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (help_echo_string)
<a id='L22908' name='L22908'></a> 22908                   || !<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (previous_help_echo_string))
<a id='L22909' name='L22909'></a> 22909                 <em class='brace'>{</em>
<a id='L22910' name='L22910'></a> 22910                   <em class='comment'>/* Also allow the focus and client pointer to be</em>
<a id='L22911' name='L22911'></a> 22911 <em class='comment'>                     adjusted accordingly, in case a help tooltip is</em>
<a id='L22912' name='L22912'></a> 22912 <em class='comment'>                     shown.  */</em>
<a id='L22913' name='L22913'></a> 22913                   gen_help_device = device;
<a id='L22914' name='L22914'></a> 22914                   gen_help_time = xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L22915' name='L22915'></a> 22915 
<a id='L22916' name='L22916'></a> 22916                   do_help = 1;
<a id='L22917' name='L22917'></a> 22917                 <em class='brace'>}</em>
<a id='L22918' name='L22918'></a> 22918 
<a id='L22919' name='L22919'></a> 22919               <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L22920' name='L22920'></a> 22920                 x_flush_dirty_back_buffer_on (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L22921' name='L22921'></a> 22921               <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L22922' name='L22922'></a> 22922             <em class='brace'>}</em>
<a id='L22923' name='L22923'></a> 22923 
<a id='L22924' name='L22924'></a> 22924           <strong class='reserved'>case</strong> XI_ButtonRelease:
<a id='L22925' name='L22925'></a> 22925           <strong class='reserved'>case</strong> XI_ButtonPress:
<a id='L22926' name='L22926'></a> 22926             <em class='brace'>{</em>
<a id='L22927' name='L22927'></a> 22927               <em class='comment'>/* If we decide we want to generate an event to be seen</em>
<a id='L22928' name='L22928'></a> 22928 <em class='comment'>                 by the rest of Emacs, we put it here.  */</em>
<a id='L22929' name='L22929'></a> 22929               <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> tab_bar_arg = Qnil;
<a id='L22930' name='L22930'></a> 22930               <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> tab_bar_p = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L22931' name='L22931'></a> 22931               <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> tool_bar_p = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L22932' name='L22932'></a> 22932               <strong class='reserved'>struct</strong> <a href='../S/2212.html#L275' title='Defined at 275 in src/xterm.h.'>xi_device_t</a> *device, *source;
<a id='L22933' name='L22933'></a> 22933 <em class='sharp'>#ifdef</em> HAVE_XWIDGETS
<a id='L22934' name='L22934'></a> 22934               <strong class='reserved'>struct</strong> <a href='../S/2261.html#L102' title='Defined at 102 in src/xwidget.h.'>xwidget_view</a> *xvw;
<a id='L22935' name='L22935'></a> 22935 <em class='sharp'>#endif</em>
<a id='L22936' name='L22936'></a> 22936               <em class='comment'>/* A fake XButtonEvent for x_construct_mouse_click. */</em>
<a id='L22937' name='L22937'></a> 22937               XButtonEvent bv;
<a id='L22938' name='L22938'></a> 22938               <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> dnd_grab = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L22939' name='L22939'></a> 22939               <strong class='reserved'>int</strong> dnd_state;
<a id='L22940' name='L22940'></a> 22940 
<a id='L22941' name='L22941'></a> 22941               <strong class='reserved'>if</strong> (x_dnd_in_progress
<a id='L22942' name='L22942'></a> 22942                   &amp;&amp; (command_loop_level + minibuf_level
<a id='L22943' name='L22943'></a> 22943                       &lt;= x_dnd_recursion_depth)
<a id='L22944' name='L22944'></a> 22944                   &amp;&amp; xev-&gt;deviceid == x_dnd_pointer_device
<a id='L22945' name='L22945'></a> 22945                   &amp;&amp; dpyinfo == <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (x_dnd_frame))
<a id='L22946' name='L22946'></a> 22946                 <em class='brace'>{</em>
<a id='L22947' name='L22947'></a> 22947                   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../D/14633.html' title='Multiple defined in 2 places.'>mouse_or_wdesc_frame</a> (dpyinfo, xev-&gt;event);
<a id='L22948' name='L22948'></a> 22948                   device = <a href='../S/2289.html#L5732' title='Defined at 5732 in src/xterm.c.'>xi_device_from_id</a> (dpyinfo, xev-&gt;deviceid);
<a id='L22949' name='L22949'></a> 22949 
<a id='L22950' name='L22950'></a> 22950                   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; xev-&gt;event == <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L22951' name='L22951'></a> 22951                     <em class='comment'>/* See the comment above</em>
<a id='L22952' name='L22952'></a> 22952 <em class='comment'>                       x_compute_root_window_offset for why this</em>
<a id='L22953' name='L22953'></a> 22953 <em class='comment'>                       optimization is performed.  */</em>
<a id='L22954' name='L22954'></a> 22954                     xi_compute_root_window_offset (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, xev);
<a id='L22955' name='L22955'></a> 22955 
<a id='L22956' name='L22956'></a> 22956                   <em class='comment'>/* Don't track grab status for emulated pointer</em>
<a id='L22957' name='L22957'></a> 22957 <em class='comment'>                     events, because they are ignored by the regular</em>
<a id='L22958' name='L22958'></a> 22958 <em class='comment'>                     mouse click processing code.  */</em>
<a id='L22959' name='L22959'></a> 22959 <em class='sharp'>#ifdef</em> XIPointerEmulated
<a id='L22960' name='L22960'></a> 22960                   <strong class='reserved'>if</strong> (!(xev-&gt;flags &amp; XIPointerEmulated))
<a id='L22961' name='L22961'></a> 22961                     <em class='brace'>{</em>
<a id='L22962' name='L22962'></a> 22962 <em class='sharp'>#endif</em>
<a id='L22963' name='L22963'></a> 22963                       <strong class='reserved'>if</strong> (xev-&gt;evtype == XI_ButtonPress)
<a id='L22964' name='L22964'></a> 22964                         <em class='brace'>{</em>
<a id='L22965' name='L22965'></a> 22965                           <a href='../S/2289.html#L7929' title='Defined at 7929 in src/xterm.c.'>x_display_set_last_user_time</a> (dpyinfo, xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>,
<a id='L22966' name='L22966'></a> 22966                                                         xev-&gt;send_event, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L22967' name='L22967'></a> 22967 
<a id='L22968' name='L22968'></a> 22968                           dpyinfo-&gt;grabbed |= (1 &lt;&lt; xev-&gt;detail);
<a id='L22969' name='L22969'></a> 22969                           dpyinfo-&gt;last_mouse_frame = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L22970' name='L22970'></a> 22970 
<a id='L22971' name='L22971'></a> 22971                           <strong class='reserved'>if</strong> (device)
<a id='L22972' name='L22972'></a> 22972                             device-&gt;grab |= (1 &lt;&lt; xev-&gt;detail);
<a id='L22973' name='L22973'></a> 22973 
<a id='L22974' name='L22974'></a> 22974                           <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L22975' name='L22975'></a> 22975                             <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;last_tab_bar_item = -1;
<a id='L22976' name='L22976'></a> 22976 <em class='sharp'>#if</em> ! <strong class='reserved'>defined</strong> (USE_GTK)
<a id='L22977' name='L22977'></a> 22977                           <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L22978' name='L22978'></a> 22978                             <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;last_tool_bar_item = -1;
<a id='L22979' name='L22979'></a> 22979 <em class='sharp'>#endif</em> <em class='comment'>/* not USE_GTK */</em>
<a id='L22980' name='L22980'></a> 22980                         <em class='brace'>}</em>
<a id='L22981' name='L22981'></a> 22981                       <strong class='reserved'>else</strong>
<a id='L22982' name='L22982'></a> 22982                         <em class='brace'>{</em>
<a id='L22983' name='L22983'></a> 22983                           dpyinfo-&gt;grabbed &amp;= ~(1 &lt;&lt; xev-&gt;detail);
<a id='L22984' name='L22984'></a> 22984                           <strong class='reserved'>if</strong> (device)
<a id='L22985' name='L22985'></a> 22985                             device-&gt;grab &amp;= ~(1 &lt;&lt; xev-&gt;detail);
<a id='L22986' name='L22986'></a> 22986                         <em class='brace'>}</em>
<a id='L22987' name='L22987'></a> 22987 <em class='sharp'>#ifdef</em> XIPointerEmulated
<a id='L22988' name='L22988'></a> 22988                     <em class='brace'>}</em>
<a id='L22989' name='L22989'></a> 22989 <em class='sharp'>#endif</em>
<a id='L22990' name='L22990'></a> 22990 
<a id='L22991' name='L22991'></a> 22991                   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; device)
<a id='L22992' name='L22992'></a> 22992                     xi_handle_interaction (dpyinfo, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, device,
<a id='L22993' name='L22993'></a> 22993                                            xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>);
<a id='L22994' name='L22994'></a> 22994 
<a id='L22995' name='L22995'></a> 22995                   <strong class='reserved'>if</strong> (xev-&gt;evtype == XI_ButtonPress
<a id='L22996' name='L22996'></a> 22996                       &amp;&amp; x_dnd_last_seen_window != None)
<a id='L22997' name='L22997'></a> 22997                     <em class='brace'>{</em>
<a id='L22998' name='L22998'></a> 22998                       dnd_state = <a href='../S/2289.html#L5330' title='Defined at 5330 in src/xterm.c.'>xi_convert_event_state</a> (xev);
<a id='L22999' name='L22999'></a> 22999 
<a id='L23000' name='L23000'></a> 23000                       <strong class='reserved'>if</strong> (x_dnd_last_window_is_frame)
<a id='L23001' name='L23001'></a> 23001                         <em class='brace'>{</em>
<a id='L23002' name='L23002'></a> 23002 <em class='sharp'>#ifdef</em> XI_PointerEmulated
<a id='L23003' name='L23003'></a> 23003                           <em class='comment'>/* Set the last user time here even if this</em>
<a id='L23004' name='L23004'></a> 23004 <em class='comment'>                             is an emulated button event, since</em>
<a id='L23005' name='L23005'></a> 23005 <em class='comment'>                             something happened in response.  */</em>
<a id='L23006' name='L23006'></a> 23006 
<a id='L23007' name='L23007'></a> 23007                           <strong class='reserved'>if</strong> (xev-&gt;flags &amp; XIPointerEmulated)
<a id='L23008' name='L23008'></a> 23008                             <a href='../S/2289.html#L7929' title='Defined at 7929 in src/xterm.c.'>x_display_set_last_user_time</a> (dpyinfo, xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>,
<a id='L23009' name='L23009'></a> 23009                                                           xev-&gt;send_event, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L23010' name='L23010'></a> 23010 <em class='sharp'>#endif</em>
<a id='L23011' name='L23011'></a> 23011                           <a href='../S/2289.html#L4945' title='Defined at 4945 in src/xterm.c.'>x_dnd_note_self_wheel</a> (dpyinfo,
<a id='L23012' name='L23012'></a> 23012                                                  x_dnd_last_seen_window,
<a id='L23013' name='L23013'></a> 23013                                                  lrint (xev-&gt;root_x),
<a id='L23014' name='L23014'></a> 23014                                                  lrint (xev-&gt;root_y),
<a id='L23015' name='L23015'></a> 23015                                                  xev-&gt;detail, dnd_state,
<a id='L23016' name='L23016'></a> 23016                                                  xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>);
<a id='L23017' name='L23017'></a> 23017                         <em class='brace'>}</em>
<a id='L23018' name='L23018'></a> 23018                       <strong class='reserved'>else</strong>
<a id='L23019' name='L23019'></a> 23019                         <a href='../S/2289.html#L4574' title='Defined at 4574 in src/xterm.c.'>x_dnd_send_position</a> (x_dnd_frame,
<a id='L23020' name='L23020'></a> 23020                                              x_dnd_last_seen_window,
<a id='L23021' name='L23021'></a> 23021                                              x_dnd_last_seen_toplevel,
<a id='L23022' name='L23022'></a> 23022                                              x_dnd_last_protocol_version,
<a id='L23023' name='L23023'></a> 23023                                              lrint (xev-&gt;root_x),
<a id='L23024' name='L23024'></a> 23024                                              lrint (xev-&gt;root_y),
<a id='L23025' name='L23025'></a> 23025                                              xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>, x_dnd_wanted_action,
<a id='L23026' name='L23026'></a> 23026                                              xev-&gt;detail, dnd_state);
<a id='L23027' name='L23027'></a> 23027 
<a id='L23028' name='L23028'></a> 23028                       <strong class='reserved'>goto</strong> OTHER;
<a id='L23029' name='L23029'></a> 23029                     <em class='brace'>}</em>
<a id='L23030' name='L23030'></a> 23030 
<a id='L23031' name='L23031'></a> 23031                   <strong class='reserved'>if</strong> (xev-&gt;evtype == XI_ButtonRelease)
<a id='L23032' name='L23032'></a> 23032                     <em class='brace'>{</em>
<a id='L23033' name='L23033'></a> 23033                       <strong class='reserved'>for</strong> (<strong class='reserved'>int</strong> i = 0; i &lt; xev-&gt;buttons.mask_len * 8; ++i)
<a id='L23034' name='L23034'></a> 23034                         <em class='brace'>{</em>
<a id='L23035' name='L23035'></a> 23035                           <strong class='reserved'>if</strong> (i != xev-&gt;detail &amp;&amp; XIMaskIsSet (xev-&gt;buttons.mask, i))
<a id='L23036' name='L23036'></a> 23036                             dnd_grab = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L23037' name='L23037'></a> 23037                         <em class='brace'>}</em>
<a id='L23038' name='L23038'></a> 23038 
<a id='L23039' name='L23039'></a> 23039                       <strong class='reserved'>if</strong> (!dnd_grab)
<a id='L23040' name='L23040'></a> 23040                         <em class='brace'>{</em>
<a id='L23041' name='L23041'></a> 23041                           x_dnd_end_window = x_dnd_last_seen_window;
<a id='L23042' name='L23042'></a> 23042                           x_dnd_in_progress = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L23043' name='L23043'></a> 23043 
<a id='L23044' name='L23044'></a> 23044                           <em class='comment'>/* If a tooltip that we're following is</em>
<a id='L23045' name='L23045'></a> 23045 <em class='comment'>                             displayed, hide it now.  */</em>
<a id='L23046' name='L23046'></a> 23046 
<a id='L23047' name='L23047'></a> 23047                           <strong class='reserved'>if</strong> (x_dnd_update_tooltip
<a id='L23048' name='L23048'></a> 23048                               &amp;&amp; <a href='../D/2249.html' title='Multiple defined in 2 places.'>FRAMEP</a> (tip_frame)
<a id='L23049' name='L23049'></a> 23049                               &amp;&amp; <a href='../S/2183.html#L1028' title='Defined at 1028 in src/frame.h.'>FRAME_LIVE_P</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (tip_frame))
<a id='L23050' name='L23050'></a> 23050                               &amp;&amp; (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (tip_frame))
<a id='L23051' name='L23051'></a> 23051                                   == <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (x_dnd_frame)))
<a id='L23052' name='L23052'></a> 23052                             Fx_hide_tip ();
<a id='L23053' name='L23053'></a> 23053 
<a id='L23054' name='L23054'></a> 23054                           <em class='comment'>/* This doesn't have to be marked since it</em>
<a id='L23055' name='L23055'></a> 23055 <em class='comment'>                             is only accessed if</em>
<a id='L23056' name='L23056'></a> 23056 <em class='comment'>                             x_dnd_waiting_for_finish is true, which</em>
<a id='L23057' name='L23057'></a> 23057 <em class='comment'>                             is only possible inside the DND event</em>
<a id='L23058' name='L23058'></a> 23058 <em class='comment'>                             loop where that frame is on the</em>
<a id='L23059' name='L23059'></a> 23059 <em class='comment'>                             stack.  */</em>
<a id='L23060' name='L23060'></a> 23060                           x_dnd_finish_frame = x_dnd_frame;
<a id='L23061' name='L23061'></a> 23061 
<a id='L23062' name='L23062'></a> 23062                           <strong class='reserved'>if</strong> (x_dnd_last_seen_window != None
<a id='L23063' name='L23063'></a> 23063                               &amp;&amp; x_dnd_last_window_is_frame)
<a id='L23064' name='L23064'></a> 23064                             <em class='brace'>{</em>
<a id='L23065' name='L23065'></a> 23065                               x_dnd_waiting_for_finish = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L23066' name='L23066'></a> 23066                               <a href='../S/2289.html#L4973' title='Defined at 4973 in src/xterm.c.'>x_dnd_note_self_drop</a> (dpyinfo, x_dnd_last_seen_window,
<a id='L23067' name='L23067'></a> 23067                                                     lrint (xev-&gt;root_x),
<a id='L23068' name='L23068'></a> 23068                                                     lrint (xev-&gt;root_y), xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>);
<a id='L23069' name='L23069'></a> 23069                             <em class='brace'>}</em>
<a id='L23070' name='L23070'></a> 23070                           <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (x_dnd_last_seen_window != None
<a id='L23071' name='L23071'></a> 23071                                    &amp;&amp; x_dnd_last_protocol_version != -1)
<a id='L23072' name='L23072'></a> 23072                             <em class='brace'>{</em>
<a id='L23073' name='L23073'></a> 23073                               x_dnd_pending_finish_target = x_dnd_last_seen_toplevel;
<a id='L23074' name='L23074'></a> 23074                               x_dnd_waiting_for_finish_proto = x_dnd_last_protocol_version;
<a id='L23075' name='L23075'></a> 23075 
<a id='L23076' name='L23076'></a> 23076                               x_dnd_waiting_for_finish
<a id='L23077' name='L23077'></a> 23077                                 = <a href='../S/2289.html#L4707' title='Defined at 4707 in src/xterm.c.'>x_dnd_do_drop</a> (x_dnd_last_seen_window,
<a id='L23078' name='L23078'></a> 23078                                                  x_dnd_last_seen_toplevel,
<a id='L23079' name='L23079'></a> 23079                                                  x_dnd_last_protocol_version);
<a id='L23080' name='L23080'></a> 23080                               x_dnd_finish_display = dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>;
<a id='L23081' name='L23081'></a> 23081                             <em class='brace'>}</em>
<a id='L23082' name='L23082'></a> 23082                           <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (x_dnd_last_seen_window != None)
<a id='L23083' name='L23083'></a> 23083                             <em class='brace'>{</em>
<a id='L23084' name='L23084'></a> 23084                               <a href='../D/20018.html' title='Multiple defined in 2 places.'>xm_drop_start_message</a> dmsg;
<a id='L23085' name='L23085'></a> 23085                               <a href='../D/20013.html' title='Multiple defined in 2 places.'>xm_drag_receiver_info</a> drag_receiver_info;
<a id='L23086' name='L23086'></a> 23086 
<a id='L23087' name='L23087'></a> 23087                               <strong class='reserved'>if</strong> (!<a href='../S/2289.html#L2776' title='Defined at 2776 in src/xterm.c.'>xm_read_drag_receiver_info</a> (dpyinfo, x_dnd_last_seen_window,
<a id='L23088' name='L23088'></a> 23088                                                                &amp;drag_receiver_info)
<a id='L23089' name='L23089'></a> 23089                                   &amp;&amp; !x_dnd_disable_motif_protocol
<a id='L23090' name='L23090'></a> 23090                                   &amp;&amp; drag_receiver_info.protocol_style != <a href='../S/2289.html#L1740' title='Defined at 1740 in src/xterm.c.'>XM_DRAG_STYLE_NONE</a>
<a id='L23091' name='L23091'></a> 23091                                   &amp;&amp; (x_dnd_allow_current_frame
<a id='L23092' name='L23092'></a> 23092                                       || x_dnd_last_seen_window != <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (x_dnd_frame)))
<a id='L23093' name='L23093'></a> 23093                                 <em class='brace'>{</em>
<a id='L23094' name='L23094'></a> 23094                                   <strong class='reserved'>if</strong> (!x_dnd_motif_setup_p)
<a id='L23095' name='L23095'></a> 23095                                     <a href='../S/2289.html#L2528' title='Defined at 2528 in src/xterm.c.'>xm_setup_drag_info</a> (dpyinfo, x_dnd_frame);
<a id='L23096' name='L23096'></a> 23096 
<a id='L23097' name='L23097'></a> 23097                                   <strong class='reserved'>if</strong> (x_dnd_motif_setup_p)
<a id='L23098' name='L23098'></a> 23098                                     <em class='brace'>{</em>
<a id='L23099' name='L23099'></a> 23099                                       memset (&amp;dmsg, 0, <strong class='reserved'>sizeof</strong> dmsg);
<a id='L23100' name='L23100'></a> 23100 
<a id='L23101' name='L23101'></a> 23101                                       dmsg.reason = <a href='../S/2289.html#L1718' title='Defined at 1718 in src/xterm.c.'>XM_DRAG_REASON</a> (<a href='../S/2289.html#L1732' title='Defined at 1732 in src/xterm.c.'>XM_DRAG_ORIGINATOR_INITIATOR</a>,
<a id='L23102' name='L23102'></a> 23102                                                                     <a href='../S/2289.html#L1724' title='Defined at 1724 in src/xterm.c.'>XM_DRAG_REASON_DROP_START</a>);
<a id='L23103' name='L23103'></a> 23103                                       dmsg.byte_order = <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>;
<a id='L23104' name='L23104'></a> 23104                                       dmsg.side_effects
<a id='L23105' name='L23105'></a> 23105                                         = <a href='../S/2289.html#L1689' title='Defined at 1689 in src/xterm.c.'>XM_DRAG_SIDE_EFFECT</a> (<a href='../S/2289.html#L1766' title='Defined at 1766 in src/xterm.c.'>xm_side_effect_from_action</a> (dpyinfo,
<a id='L23106' name='L23106'></a> 23106                                                                                            x_dnd_wanted_action),
<a id='L23107' name='L23107'></a> 23107                                                                <a href='../S/2289.html#L1756' title='Defined at 1756 in src/xterm.c.'>XM_DROP_SITE_VALID</a>, x_dnd_motif_operations,
<a id='L23108' name='L23108'></a> 23108                                                                (!x_dnd_xm_use_help
<a id='L23109' name='L23109'></a> 23109                                                                 ? <a href='../S/2289.html#L1713' title='Defined at 1713 in src/xterm.c.'>XM_DROP_ACTION_DROP</a>
<a id='L23110' name='L23110'></a> 23110                                                                 : <a href='../S/2289.html#L1714' title='Defined at 1714 in src/xterm.c.'>XM_DROP_ACTION_DROP_HELP</a>));
<a id='L23111' name='L23111'></a> 23111                                       dmsg.timestamp = xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L23112' name='L23112'></a> 23112                                       dmsg.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = lrint (xev-&gt;root_x);
<a id='L23113' name='L23113'></a> 23113                                       dmsg.y = lrint (xev-&gt;root_y);
<a id='L23114' name='L23114'></a> 23114                                       <em class='comment'>/* This atom technically has to be</em>
<a id='L23115' name='L23115'></a> 23115 <em class='comment'>                                         unique to each drag-and-drop</em>
<a id='L23116' name='L23116'></a> 23116 <em class='comment'>                                         operation, but that isn't easy to</em>
<a id='L23117' name='L23117'></a> 23117 <em class='comment'>                                         accomplish, since we cannot</em>
<a id='L23118' name='L23118'></a> 23118 <em class='comment'>                                         randomly move data around between</em>
<a id='L23119' name='L23119'></a> 23119 <em class='comment'>                                         selections.  Let's hope no two</em>
<a id='L23120' name='L23120'></a> 23120 <em class='comment'>                                         instances of Emacs try to drag</em>
<a id='L23121' name='L23121'></a> 23121 <em class='comment'>                                         into the same window at the same</em>
<a id='L23122' name='L23122'></a> 23122 <em class='comment'>                                         time.  */</em>
<a id='L23123' name='L23123'></a> 23123                                       dmsg.index_atom = x_dnd_motif_atom;
<a id='L23124' name='L23124'></a> 23124                                       dmsg.source_window = <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (x_dnd_frame);
<a id='L23125' name='L23125'></a> 23125 
<a id='L23126' name='L23126'></a> 23126                                       <strong class='reserved'>if</strong> (!<a href='../S/2289.html#L1748' title='Defined at 1748 in src/xterm.c.'>XM_DRAG_STYLE_IS_DROP_ONLY</a> (drag_receiver_info.protocol_style))
<a id='L23127' name='L23127'></a> 23127                                         <a href='../S/2289.html#L2899' title='Defined at 2899 in src/xterm.c.'>x_dnd_send_xm_leave_for_drop</a> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (x_dnd_frame),
<a id='L23128' name='L23128'></a> 23128                                                                       x_dnd_frame, x_dnd_last_seen_window,
<a id='L23129' name='L23129'></a> 23129                                                                       xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>);
<a id='L23130' name='L23130'></a> 23130 
<a id='L23131' name='L23131'></a> 23131                                       <a href='../S/2289.html#L2565' title='Defined at 2565 in src/xterm.c.'>xm_send_drop_message</a> (dpyinfo, <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (x_dnd_frame),
<a id='L23132' name='L23132'></a> 23132                                                             x_dnd_last_seen_window, &amp;dmsg);
<a id='L23133' name='L23133'></a> 23133 
<a id='L23134' name='L23134'></a> 23134                                       x_dnd_waiting_for_finish = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L23135' name='L23135'></a> 23135                                       x_dnd_waiting_for_motif_finish_display = dpyinfo;
<a id='L23136' name='L23136'></a> 23136                                       x_dnd_waiting_for_motif_finish = 1;
<a id='L23137' name='L23137'></a> 23137                                       x_dnd_finish_display = dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>;
<a id='L23138' name='L23138'></a> 23138                                     <em class='brace'>}</em>
<a id='L23139' name='L23139'></a> 23139                                 <em class='brace'>}</em>
<a id='L23140' name='L23140'></a> 23140                               <strong class='reserved'>else</strong>
<a id='L23141' name='L23141'></a> 23141                                 <a href='../S/2289.html#L4073' title='Defined at 4073 in src/xterm.c.'>x_dnd_send_unsupported_drop</a> (dpyinfo, (x_dnd_last_seen_toplevel != None
<a id='L23142' name='L23142'></a> 23142                                                                        ? x_dnd_last_seen_toplevel
<a id='L23143' name='L23143'></a> 23143                                                                        : x_dnd_last_seen_window),
<a id='L23144' name='L23144'></a> 23144                                                              lrint (xev-&gt;root_x),
<a id='L23145' name='L23145'></a> 23145                                                              lrint (xev-&gt;root_y), xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>);
<a id='L23146' name='L23146'></a> 23146                             <em class='brace'>}</em>
<a id='L23147' name='L23147'></a> 23147                           <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (x_dnd_last_seen_toplevel != None)
<a id='L23148' name='L23148'></a> 23148                             <a href='../S/2289.html#L4073' title='Defined at 4073 in src/xterm.c.'>x_dnd_send_unsupported_drop</a> (dpyinfo,
<a id='L23149' name='L23149'></a> 23149                                                          x_dnd_last_seen_toplevel,
<a id='L23150' name='L23150'></a> 23150                                                          lrint (xev-&gt;root_x),
<a id='L23151' name='L23151'></a> 23151                                                          lrint (xev-&gt;root_y),
<a id='L23152' name='L23152'></a> 23152                                                          xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>);
<a id='L23153' name='L23153'></a> 23153 
<a id='L23154' name='L23154'></a> 23154                           x_dnd_last_protocol_version = -1;
<a id='L23155' name='L23155'></a> 23155                           x_dnd_last_motif_style = <a href='../S/2289.html#L1740' title='Defined at 1740 in src/xterm.c.'>XM_DRAG_STYLE_NONE</a>;
<a id='L23156' name='L23156'></a> 23156                           x_dnd_last_seen_window = None;
<a id='L23157' name='L23157'></a> 23157                           x_dnd_last_seen_toplevel = None;
<a id='L23158' name='L23158'></a> 23158                           x_dnd_last_window_is_frame = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L23159' name='L23159'></a> 23159                           x_dnd_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L23160' name='L23160'></a> 23160 
<a id='L23161' name='L23161'></a> 23161                           <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L23162' name='L23162'></a> 23162                         <em class='brace'>}</em>
<a id='L23163' name='L23163'></a> 23163                     <em class='brace'>}</em>
<a id='L23164' name='L23164'></a> 23164                 <em class='brace'>}</em>
<a id='L23165' name='L23165'></a> 23165 
<a id='L23166' name='L23166'></a> 23166               <strong class='reserved'>if</strong> (x_dnd_in_progress
<a id='L23167' name='L23167'></a> 23167                   &amp;&amp; (command_loop_level + minibuf_level
<a id='L23168' name='L23168'></a> 23168                       &lt;= x_dnd_recursion_depth))
<a id='L23169' name='L23169'></a> 23169                 <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L23170' name='L23170'></a> 23170 
<a id='L23171' name='L23171'></a> 23171 <em class='sharp'>#ifdef</em> USE_MOTIF
<a id='L23172' name='L23172'></a> 23172 <em class='sharp'>#ifdef</em> USE_TOOLKIT_SCROLL_BARS
<a id='L23173' name='L23173'></a> 23173               <strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>
<a id='L23174' name='L23174'></a> 23174                 = x_window_to_scroll_bar (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L23175' name='L23175'></a> 23175                                           xev-&gt;event, 2);
<a id='L23176' name='L23176'></a> 23176 <em class='sharp'>#endif</em>
<a id='L23177' name='L23177'></a> 23177 
<a id='L23178' name='L23178'></a> 23178               use_copy = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L23179' name='L23179'></a> 23179               copy.xbutton.type = (xev-&gt;evtype == XI_ButtonPress
<a id='L23180' name='L23180'></a> 23180                                    ? ButtonPress : ButtonRelease);
<a id='L23181' name='L23181'></a> 23181               copy.xbutton.serial = xev-&gt;serial;
<a id='L23182' name='L23182'></a> 23182               copy.xbutton.send_event = xev-&gt;send_event;
<a id='L23183' name='L23183'></a> 23183               copy.xbutton.<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> = dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>;
<a id='L23184' name='L23184'></a> 23184               copy.xbutton.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = xev-&gt;event;
<a id='L23185' name='L23185'></a> 23185               copy.xbutton.root = xev-&gt;root;
<a id='L23186' name='L23186'></a> 23186               copy.xbutton.subwindow = xev-&gt;child;
<a id='L23187' name='L23187'></a> 23187               copy.xbutton.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> = xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L23188' name='L23188'></a> 23188               copy.xbutton.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = lrint (xev-&gt;event_x);
<a id='L23189' name='L23189'></a> 23189               copy.xbutton.y = lrint (xev-&gt;event_y);
<a id='L23190' name='L23190'></a> 23190               copy.xbutton.x_root = lrint (xev-&gt;root_x);
<a id='L23191' name='L23191'></a> 23191               copy.xbutton.y_root = lrint (xev-&gt;root_y);
<a id='L23192' name='L23192'></a> 23192               copy.xbutton.state = <a href='../S/2289.html#L5330' title='Defined at 5330 in src/xterm.c.'>xi_convert_event_state</a> (xev);
<a id='L23193' name='L23193'></a> 23193               copy.xbutton.button = xev-&gt;detail;
<a id='L23194' name='L23194'></a> 23194               copy.xbutton.same_screen = True;
<a id='L23195' name='L23195'></a> 23195 
<a id='L23196' name='L23196'></a> 23196 <em class='sharp'>#elif</em> <strong class='reserved'>defined</strong> USE_GTK &amp;&amp; !<strong class='reserved'>defined</strong> HAVE_GTK3
<a id='L23197' name='L23197'></a> 23197               copy = gdk_event_new (xev-&gt;evtype == XI_ButtonPress
<a id='L23198' name='L23198'></a> 23198                                     ? GDK_BUTTON_PRESS : GDK_BUTTON_RELEASE);
<a id='L23199' name='L23199'></a> 23199 
<a id='L23200' name='L23200'></a> 23200               copy-&gt;button.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = gdk_x11_window_lookup_for_display (gdpy, xev-&gt;event);
<a id='L23201' name='L23201'></a> 23201               copy-&gt;button.send_event = xev-&gt;send_event;
<a id='L23202' name='L23202'></a> 23202               copy-&gt;button.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> = xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L23203' name='L23203'></a> 23203               copy-&gt;button.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = xev-&gt;event_x;
<a id='L23204' name='L23204'></a> 23204               copy-&gt;button.y = xev-&gt;event_y;
<a id='L23205' name='L23205'></a> 23205               copy-&gt;button.x_root = xev-&gt;root_x;
<a id='L23206' name='L23206'></a> 23206               copy-&gt;button.y_root = xev-&gt;root_y;
<a id='L23207' name='L23207'></a> 23207               copy-&gt;button.state = <a href='../S/2289.html#L5330' title='Defined at 5330 in src/xterm.c.'>xi_convert_event_state</a> (xev);
<a id='L23208' name='L23208'></a> 23208               copy-&gt;button.button = xev-&gt;detail;
<a id='L23209' name='L23209'></a> 23209 
<a id='L23210' name='L23210'></a> 23210               <strong class='reserved'>if</strong> (!copy-&gt;button.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>)
<a id='L23211' name='L23211'></a> 23211                 <a href='../D/10893.html' title='Multiple defined in 6 places.'>emacs_abort</a> ();
<a id='L23212' name='L23212'></a> 23212 
<a id='L23213' name='L23213'></a> 23213               g_object_ref (copy-&gt;button.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>);
<a id='L23214' name='L23214'></a> 23214 
<a id='L23215' name='L23215'></a> 23215               <strong class='reserved'>if</strong> (<a href='../D/15672.html' title='Multiple defined in 5 places.'>popup_activated</a> ())
<a id='L23216' name='L23216'></a> 23216                 <em class='brace'>{</em>
<a id='L23217' name='L23217'></a> 23217                   <em class='comment'>/* GTK+ popup menus don't respond to core buttons</em>
<a id='L23218' name='L23218'></a> 23218 <em class='comment'>                     after Button3, so don't dismiss popup menus upon</em>
<a id='L23219' name='L23219'></a> 23219 <em class='comment'>                     wheel movement here either.  */</em>
<a id='L23220' name='L23220'></a> 23220                   <strong class='reserved'>if</strong> (xev-&gt;detail &gt; 3)
<a id='L23221' name='L23221'></a> 23221                     *finish = <a href='../S/2289.html#L1136' title='Defined at 1136 in src/xterm.c.'>X_EVENT_DROP</a>;
<a id='L23222' name='L23222'></a> 23222 
<a id='L23223' name='L23223'></a> 23223                   <strong class='reserved'>if</strong> (xev-&gt;evtype == XI_ButtonRelease)
<a id='L23224' name='L23224'></a> 23224                     <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L23225' name='L23225'></a> 23225                 <em class='brace'>}</em>
<a id='L23226' name='L23226'></a> 23226 <em class='sharp'>#endif</em>
<a id='L23227' name='L23227'></a> 23227 
<a id='L23228' name='L23228'></a> 23228 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L168' title='Defined at 168 in src/xterm.h.'>HAVE_XINPUT2_1</a>
<a id='L23229' name='L23229'></a> 23229               <em class='comment'>/* Ignore emulated scroll events when XI2 native</em>
<a id='L23230' name='L23230'></a> 23230 <em class='comment'>                 scroll events are present.  */</em>
<a id='L23231' name='L23231'></a> 23231               <strong class='reserved'>if</strong> (xev-&gt;flags &amp; XIPointerEmulated)
<a id='L23232' name='L23232'></a> 23232                 <em class='brace'>{</em>
<a id='L23233' name='L23233'></a> 23233 <em class='sharp'>#if</em> !<strong class='reserved'>defined</strong> USE_MOTIF || !<strong class='reserved'>defined</strong> USE_TOOLKIT_SCROLL_BARS
<a id='L23234' name='L23234'></a> 23234                   *finish = <a href='../S/2289.html#L1136' title='Defined at 1136 in src/xterm.c.'>X_EVENT_DROP</a>;
<a id='L23235' name='L23235'></a> 23235 <em class='sharp'>#else</em>
<a id='L23236' name='L23236'></a> 23236                   <strong class='reserved'>if</strong> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>)
<a id='L23237' name='L23237'></a> 23237                     *finish = <a href='../S/2289.html#L1136' title='Defined at 1136 in src/xterm.c.'>X_EVENT_DROP</a>;
<a id='L23238' name='L23238'></a> 23238 <em class='sharp'>#endif</em>
<a id='L23239' name='L23239'></a> 23239                   <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L23240' name='L23240'></a> 23240                 <em class='brace'>}</em>
<a id='L23241' name='L23241'></a> 23241 <em class='sharp'>#endif</em>
<a id='L23242' name='L23242'></a> 23242 
<a id='L23243' name='L23243'></a> 23243               <strong class='reserved'>if</strong> (xev-&gt;evtype == XI_ButtonPress)
<a id='L23244' name='L23244'></a> 23244                 <a href='../S/2289.html#L7929' title='Defined at 7929 in src/xterm.c.'>x_display_set_last_user_time</a> (dpyinfo, xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>,
<a id='L23245' name='L23245'></a> 23245                                               xev-&gt;send_event, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L23246' name='L23246'></a> 23246 
<a id='L23247' name='L23247'></a> 23247               source = <a href='../S/2289.html#L5732' title='Defined at 5732 in src/xterm.c.'>xi_device_from_id</a> (dpyinfo, xev-&gt;sourceid);
<a id='L23248' name='L23248'></a> 23248               device = <a href='../S/2289.html#L5732' title='Defined at 5732 in src/xterm.c.'>xi_device_from_id</a> (dpyinfo, xev-&gt;deviceid);
<a id='L23249' name='L23249'></a> 23249 
<a id='L23250' name='L23250'></a> 23250 <em class='sharp'>#ifdef</em> HAVE_XWIDGETS
<a id='L23251' name='L23251'></a> 23251               xvw = <a href='../S/2334.html#L2116' title='Defined at 2116 in src/xwidget.c.'>xwidget_view_from_window</a> (xev-&gt;event);
<a id='L23252' name='L23252'></a> 23252               <strong class='reserved'>if</strong> (xvw)
<a id='L23253' name='L23253'></a> 23253                 <em class='brace'>{</em>
<a id='L23254' name='L23254'></a> 23254                   <em class='comment'>/* If the user interacts with a frame that's focused</em>
<a id='L23255' name='L23255'></a> 23255 <em class='comment'>                     on another device, but not the current focus</em>
<a id='L23256' name='L23256'></a> 23256 <em class='comment'>                     frame, make it the focus frame.  */</em>
<a id='L23257' name='L23257'></a> 23257                   <strong class='reserved'>if</strong> (device)
<a id='L23258' name='L23258'></a> 23258                     xi_handle_interaction (dpyinfo, xvw-&gt;<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>,
<a id='L23259' name='L23259'></a> 23259                                            device, xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>);
<a id='L23260' name='L23260'></a> 23260 
<a id='L23261' name='L23261'></a> 23261                   <a href='../S/2334.html#L1307' title='Defined at 1307 in src/xwidget.c.'>xwidget_button</a> (xvw, xev-&gt;evtype == XI_ButtonPress,
<a id='L23262' name='L23262'></a> 23262                                   lrint (xev-&gt;event_x), lrint (xev-&gt;event_y),
<a id='L23263' name='L23263'></a> 23263                                   xev-&gt;detail, <a href='../S/2289.html#L5330' title='Defined at 5330 in src/xterm.c.'>xi_convert_event_state</a> (xev),
<a id='L23264' name='L23264'></a> 23264                                   xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>);
<a id='L23265' name='L23265'></a> 23265 
<a id='L23266' name='L23266'></a> 23266                   <strong class='reserved'>if</strong> (!<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (selected_window, xvw-&gt;w) &amp;&amp; (xev-&gt;detail &lt; 4))
<a id='L23267' name='L23267'></a> 23267                     <em class='brace'>{</em>
<a id='L23268' name='L23268'></a> 23268                       inev.ie.kind = <a href='../S/2231.html#L242' title='Defined at 242 in src/termhooks.h.'>SELECT_WINDOW_EVENT</a>;
<a id='L23269' name='L23269'></a> 23269                       inev.ie.frame_or_window = xvw-&gt;w;
<a id='L23270' name='L23270'></a> 23270 
<a id='L23271' name='L23271'></a> 23271                       <strong class='reserved'>if</strong> (source)
<a id='L23272' name='L23272'></a> 23272                         inev.ie.device = source-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>;
<a id='L23273' name='L23273'></a> 23273                     <em class='brace'>}</em>
<a id='L23274' name='L23274'></a> 23274 
<a id='L23275' name='L23275'></a> 23275                   *finish = <a href='../S/2289.html#L1136' title='Defined at 1136 in src/xterm.c.'>X_EVENT_DROP</a>;
<a id='L23276' name='L23276'></a> 23276                   <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L23277' name='L23277'></a> 23277                 <em class='brace'>}</em>
<a id='L23278' name='L23278'></a> 23278 <em class='sharp'>#endif</em>
<a id='L23279' name='L23279'></a> 23279 
<a id='L23280' name='L23280'></a> 23280               <strong class='reserved'>if</strong> (!device)
<a id='L23281' name='L23281'></a> 23281                 <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L23282' name='L23282'></a> 23282 
<a id='L23283' name='L23283'></a> 23283               bv.button = xev-&gt;detail;
<a id='L23284' name='L23284'></a> 23284               bv.type = xev-&gt;evtype == XI_ButtonPress ? ButtonPress : ButtonRelease;
<a id='L23285' name='L23285'></a> 23285               bv.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = lrint (xev-&gt;event_x);
<a id='L23286' name='L23286'></a> 23286               bv.y = lrint (xev-&gt;event_y);
<a id='L23287' name='L23287'></a> 23287               bv.x_root = lrint (xev-&gt;root_x);
<a id='L23288' name='L23288'></a> 23288               bv.y_root = lrint (xev-&gt;root_y);
<a id='L23289' name='L23289'></a> 23289               bv.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = xev-&gt;event;
<a id='L23290' name='L23290'></a> 23290               bv.state = <a href='../S/2289.html#L5330' title='Defined at 5330 in src/xterm.c.'>xi_convert_event_state</a> (xev);
<a id='L23291' name='L23291'></a> 23291               bv.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> = xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L23292' name='L23292'></a> 23292 
<a id='L23293' name='L23293'></a> 23293               dpyinfo-&gt;last_mouse_glyph_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L23294' name='L23294'></a> 23294 
<a id='L23295' name='L23295'></a> 23295               <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../D/14633.html' title='Multiple defined in 2 places.'>mouse_or_wdesc_frame</a> (dpyinfo, xev-&gt;event);
<a id='L23296' name='L23296'></a> 23296 
<a id='L23297' name='L23297'></a> 23297               <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; xev-&gt;event == <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L23298' name='L23298'></a> 23298                 <em class='comment'>/* See the comment above x_compute_root_window_offset</em>
<a id='L23299' name='L23299'></a> 23299 <em class='comment'>                   for why this optimization is performed.  */</em>
<a id='L23300' name='L23300'></a> 23300                 xi_compute_root_window_offset (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, xev);
<a id='L23301' name='L23301'></a> 23301 
<a id='L23302' name='L23302'></a> 23302               <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; xev-&gt;evtype == XI_ButtonPress
<a id='L23303' name='L23303'></a> 23303                   &amp;&amp; !<a href='../D/15672.html' title='Multiple defined in 5 places.'>popup_activated</a> ()
<a id='L23304' name='L23304'></a> 23304                   &amp;&amp; !x_window_to_scroll_bar (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, xev-&gt;event, 2)
<a id='L23305' name='L23305'></a> 23305                   &amp;&amp; !<a href='../D/2354.html' title='Multiple defined in 2 places.'>FRAME_NO_ACCEPT_FOCUS</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L23306' name='L23306'></a> 23306                 <em class='brace'>{</em>
<a id='L23307' name='L23307'></a> 23307                   <em class='comment'>/* When clicking into a child frame or when clicking</em>
<a id='L23308' name='L23308'></a> 23308 <em class='comment'>                     into a parent frame with the child frame selected and</em>
<a id='L23309' name='L23309'></a> 23309 <em class='comment'>                     `no-accept-focus' is not set, select the clicked</em>
<a id='L23310' name='L23310'></a> 23310 <em class='comment'>                     frame.  */</em>
<a id='L23311' name='L23311'></a> 23311                   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *hf = dpyinfo-&gt;highlight_frame;
<a id='L23312' name='L23312'></a> 23312 
<a id='L23313' name='L23313'></a> 23313                   <strong class='reserved'>if</strong> (<a href='../D/2370.html' title='Multiple defined in 2 places.'>FRAME_PARENT_FRAME</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) || (hf &amp;&amp; <a href='../S/2247.html#L1728' title='Defined at 1728 in src/frame.c.'>frame_ancestor_p</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, hf)))
<a id='L23314' name='L23314'></a> 23314                     <em class='brace'>{</em>
<a id='L23315' name='L23315'></a> 23315 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_GTK3 || (!<strong class='reserved'>defined</strong> USE_GTK &amp;&amp; !<strong class='reserved'>defined</strong> USE_X_TOOLKIT)
<a id='L23316' name='L23316'></a> 23316                       <strong class='reserved'>if</strong> (device)
<a id='L23317' name='L23317'></a> 23317                         <em class='brace'>{</em>
<a id='L23318' name='L23318'></a> 23318                           <em class='comment'>/* This can generate XI_BadDevice if the</em>
<a id='L23319' name='L23319'></a> 23319 <em class='comment'>                             device's attachment was destroyed</em>
<a id='L23320' name='L23320'></a> 23320 <em class='comment'>                             server-side.  */</em>
<a id='L23321' name='L23321'></a> 23321                           x_ignore_errors_for_next_request (dpyinfo, 0);
<a id='L23322' name='L23322'></a> 23322                           XISetFocus (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, device-&gt;attachment,
<a id='L23323' name='L23323'></a> 23323                                       <em class='comment'>/* Note that the input extension</em>
<a id='L23324' name='L23324'></a> 23324 <em class='comment'>                                         only supports RevertToParent-type</em>
<a id='L23325' name='L23325'></a> 23325 <em class='comment'>                                         behavior.  */</em>
<a id='L23326' name='L23326'></a> 23326                                       <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>);
<a id='L23327' name='L23327'></a> 23327                           x_stop_ignoring_errors (dpyinfo);
<a id='L23328' name='L23328'></a> 23328                         <em class='brace'>}</em>
<a id='L23329' name='L23329'></a> 23329 <em class='sharp'>#else</em>
<a id='L23330' name='L23330'></a> 23330                       <em class='comment'>/* Non-no toolkit builds without GTK 3 use core</em>
<a id='L23331' name='L23331'></a> 23331 <em class='comment'>                         events to handle focus.  Errors are still</em>
<a id='L23332' name='L23332'></a> 23332 <em class='comment'>                         caught here in case the window is not</em>
<a id='L23333' name='L23333'></a> 23333 <em class='comment'>                         viewable.  */</em>
<a id='L23334' name='L23334'></a> 23334                       x_ignore_errors_for_next_request (dpyinfo, 0);
<a id='L23335' name='L23335'></a> 23335                       XSetInputFocus (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L23336' name='L23336'></a> 23336                                       RevertToParent, xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>);
<a id='L23337' name='L23337'></a> 23337                       x_stop_ignoring_errors (dpyinfo);
<a id='L23338' name='L23338'></a> 23338 <em class='sharp'>#endif</em>
<a id='L23339' name='L23339'></a> 23339                       <strong class='reserved'>if</strong> (<a href='../D/2370.html' title='Multiple defined in 2 places.'>FRAME_PARENT_FRAME</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L23340' name='L23340'></a> 23340                         XRaiseWindow (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L23341' name='L23341'></a> 23341                     <em class='brace'>}</em>
<a id='L23342' name='L23342'></a> 23342                 <em class='brace'>}</em>
<a id='L23343' name='L23343'></a> 23343 
<a id='L23344' name='L23344'></a> 23344               <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L23345' name='L23345'></a> 23345                 <em class='brace'>{</em>
<a id='L23346' name='L23346'></a> 23346                   <em class='comment'>/* If the user interacts with a frame that's focused</em>
<a id='L23347' name='L23347'></a> 23347 <em class='comment'>                     on another device, but not the current focus</em>
<a id='L23348' name='L23348'></a> 23348 <em class='comment'>                     frame, make it the focus frame.  */</em>
<a id='L23349' name='L23349'></a> 23349                   <strong class='reserved'>if</strong> (device)
<a id='L23350' name='L23350'></a> 23350                     xi_handle_interaction (dpyinfo, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, device,
<a id='L23351' name='L23351'></a> 23351                                            xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>);
<a id='L23352' name='L23352'></a> 23352                 <em class='brace'>}</em>
<a id='L23353' name='L23353'></a> 23353 
<a id='L23354' name='L23354'></a> 23354 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L23355' name='L23355'></a> 23355               <strong class='reserved'>if</strong> (!<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L23356' name='L23356'></a> 23356                 <em class='brace'>{</em>
<a id='L23357' name='L23357'></a> 23357                   <strong class='reserved'>int</strong> real_x = lrint (xev-&gt;root_x);
<a id='L23358' name='L23358'></a> 23358                   <strong class='reserved'>int</strong> real_y = lrint (xev-&gt;root_y);
<a id='L23359' name='L23359'></a> 23359 
<a id='L23360' name='L23360'></a> 23360                   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../D/19416.html' title='Multiple defined in 2 places.'>x_any_window_to_frame</a> (dpyinfo, xev-&gt;event);
<a id='L23361' name='L23361'></a> 23361 
<a id='L23362' name='L23362'></a> 23362                   <strong class='reserved'>if</strong> (xev-&gt;detail &gt; 3 &amp;&amp; xev-&gt;detail &lt; 8 &amp;&amp; <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L23363' name='L23363'></a> 23363                     <em class='brace'>{</em>
<a id='L23364' name='L23364'></a> 23364                       <strong class='reserved'>if</strong> (xev-&gt;evtype == XI_ButtonRelease)
<a id='L23365' name='L23365'></a> 23365                         <em class='brace'>{</em>
<a id='L23366' name='L23366'></a> 23366                           <strong class='reserved'>if</strong> (<a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) != xev-&gt;event)
<a id='L23367' name='L23367'></a> 23367                             x_translate_coordinates (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, real_x, real_y,
<a id='L23368' name='L23368'></a> 23368                                                      &amp;real_x, &amp;real_y);
<a id='L23369' name='L23369'></a> 23369 
<a id='L23370' name='L23370'></a> 23370                           <strong class='reserved'>if</strong> (xev-&gt;detail &lt;= 5)
<a id='L23371' name='L23371'></a> 23371                             inev.ie.kind = <a href='../S/2231.html#L132' title='Defined at 132 in src/termhooks.h.'>WHEEL_EVENT</a>;
<a id='L23372' name='L23372'></a> 23372                           <strong class='reserved'>else</strong>
<a id='L23373' name='L23373'></a> 23373                             inev.ie.kind = <a href='../S/2231.html#L149' title='Defined at 149 in src/termhooks.h.'>HORIZ_WHEEL_EVENT</a>;
<a id='L23374' name='L23374'></a> 23374 
<a id='L23375' name='L23375'></a> 23375                           <strong class='reserved'>if</strong> (source)
<a id='L23376' name='L23376'></a> 23376                             inev.ie.device = source-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>;
<a id='L23377' name='L23377'></a> 23377 
<a id='L23378' name='L23378'></a> 23378                           inev.ie.timestamp = xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L23379' name='L23379'></a> 23379 
<a id='L23380' name='L23380'></a> 23380                           <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (inev.ie.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, real_x);
<a id='L23381' name='L23381'></a> 23381                           <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (inev.ie.y, real_y);
<a id='L23382' name='L23382'></a> 23382                           <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (inev.ie.frame_or_window, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L23383' name='L23383'></a> 23383 
<a id='L23384' name='L23384'></a> 23384                           inev.ie.modifiers
<a id='L23385' name='L23385'></a> 23385                             |= x_x_to_emacs_modifiers (dpyinfo,
<a id='L23386' name='L23386'></a> 23386                                                        xev-&gt;mods.effective);
<a id='L23387' name='L23387'></a> 23387 
<a id='L23388' name='L23388'></a> 23388                           inev.ie.modifiers |= xev-&gt;detail % 2 ? <a href='../S/2231.html#L417' title='Defined at 417 in src/termhooks.h.'>down_modifier</a> : <a href='../S/2231.html#L414' title='Defined at 414 in src/termhooks.h.'>up_modifier</a>;
<a id='L23389' name='L23389'></a> 23389                         <em class='brace'>}</em>
<a id='L23390' name='L23390'></a> 23390 
<a id='L23391' name='L23391'></a> 23391                       *finish = <a href='../S/2289.html#L1136' title='Defined at 1136 in src/xterm.c.'>X_EVENT_DROP</a>;
<a id='L23392' name='L23392'></a> 23392                       <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L23393' name='L23393'></a> 23393                     <em class='brace'>}</em>
<a id='L23394' name='L23394'></a> 23394                   <strong class='reserved'>else</strong>
<a id='L23395' name='L23395'></a> 23395                     <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L23396' name='L23396'></a> 23396                 <em class='brace'>}</em>
<a id='L23397' name='L23397'></a> 23397 
<a id='L23398' name='L23398'></a> 23398               <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; <a href='../S/2362.html#L5047' title='Defined at 5047 in src/gtkutil.c.'>xg_event_is_for_scrollbar</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, event, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>))
<a id='L23399' name='L23399'></a> 23399                 <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = 0;
<a id='L23400' name='L23400'></a> 23400 <em class='sharp'>#endif</em>
<a id='L23401' name='L23401'></a> 23401 
<a id='L23402' name='L23402'></a> 23402               <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L23403' name='L23403'></a> 23403                 <em class='brace'>{</em>
<a id='L23404' name='L23404'></a> 23404                   <strong class='reserved'>if</strong> (xev-&gt;detail &gt;= 4 &amp;&amp; xev-&gt;detail &lt; 8)
<a id='L23405' name='L23405'></a> 23405                     <em class='brace'>{</em>
<a id='L23406' name='L23406'></a> 23406                       <strong class='reserved'>if</strong> (xev-&gt;evtype == XI_ButtonRelease)
<a id='L23407' name='L23407'></a> 23407                         <em class='brace'>{</em>
<a id='L23408' name='L23408'></a> 23408                           <strong class='reserved'>if</strong> (xev-&gt;detail &lt;= 5)
<a id='L23409' name='L23409'></a> 23409                             inev.ie.kind = <a href='../S/2231.html#L132' title='Defined at 132 in src/termhooks.h.'>WHEEL_EVENT</a>;
<a id='L23410' name='L23410'></a> 23410                           <strong class='reserved'>else</strong>
<a id='L23411' name='L23411'></a> 23411                             inev.ie.kind = <a href='../S/2231.html#L149' title='Defined at 149 in src/termhooks.h.'>HORIZ_WHEEL_EVENT</a>;
<a id='L23412' name='L23412'></a> 23412 
<a id='L23413' name='L23413'></a> 23413                           <strong class='reserved'>if</strong> (source)
<a id='L23414' name='L23414'></a> 23414                             inev.ie.device = source-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>;
<a id='L23415' name='L23415'></a> 23415 
<a id='L23416' name='L23416'></a> 23416                           inev.ie.timestamp = xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L23417' name='L23417'></a> 23417 
<a id='L23418' name='L23418'></a> 23418                           <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (inev.ie.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, lrint (xev-&gt;event_x));
<a id='L23419' name='L23419'></a> 23419                           <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (inev.ie.y, lrint (xev-&gt;event_y));
<a id='L23420' name='L23420'></a> 23420                           <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (inev.ie.frame_or_window, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L23421' name='L23421'></a> 23421 
<a id='L23422' name='L23422'></a> 23422                           inev.ie.modifiers
<a id='L23423' name='L23423'></a> 23423                             |= x_x_to_emacs_modifiers (dpyinfo,
<a id='L23424' name='L23424'></a> 23424                                                        xev-&gt;mods.effective);
<a id='L23425' name='L23425'></a> 23425 
<a id='L23426' name='L23426'></a> 23426                           inev.ie.modifiers |= xev-&gt;detail % 2 ? <a href='../S/2231.html#L417' title='Defined at 417 in src/termhooks.h.'>down_modifier</a> : <a href='../S/2231.html#L414' title='Defined at 414 in src/termhooks.h.'>up_modifier</a>;
<a id='L23427' name='L23427'></a> 23427                         <em class='brace'>}</em>
<a id='L23428' name='L23428'></a> 23428 
<a id='L23429' name='L23429'></a> 23429                       <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L23430' name='L23430'></a> 23430                     <em class='brace'>}</em>
<a id='L23431' name='L23431'></a> 23431 
<a id='L23432' name='L23432'></a> 23432                   <em class='comment'>/* Is this in the tab-bar?  */</em>
<a id='L23433' name='L23433'></a> 23433                   <strong class='reserved'>if</strong> (<a href='../D/6789.html' title='Multiple defined in 2 places.'>WINDOWP</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;tab_bar_window)
<a id='L23434' name='L23434'></a> 23434                       &amp;&amp; <a href='../S/2317.html#L657' title='Defined at 657 in src/window.h.'>WINDOW_TOTAL_LINES</a> (<a href='../D/7409.html' title='Multiple defined in 2 places.'>XWINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;tab_bar_window)))
<a id='L23435' name='L23435'></a> 23435                     <em class='brace'>{</em>
<a id='L23436' name='L23436'></a> 23436                       <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>;
<a id='L23437' name='L23437'></a> 23437                       <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = bv.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L23438' name='L23438'></a> 23438                       <strong class='reserved'>int</strong> y = bv.y;
<a id='L23439' name='L23439'></a> 23439 
<a id='L23440' name='L23440'></a> 23440                       <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = <a href='../S/2108.html#L1682' title='Defined at 1682 in src/window.c.'>window_from_coordinates</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, 0, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L23441' name='L23441'></a> 23441                       tab_bar_p = <a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;tab_bar_window);
<a id='L23442' name='L23442'></a> 23442 
<a id='L23443' name='L23443'></a> 23443                       <strong class='reserved'>if</strong> (tab_bar_p)
<a id='L23444' name='L23444'></a> 23444                         <em class='brace'>{</em>
<a id='L23445' name='L23445'></a> 23445                           tab_bar_arg = <a href='../S/2224.html#L14679' title='Defined at 14679 in src/xdisp.c.'>handle_tab_bar_click</a>
<a id='L23446' name='L23446'></a> 23446                             (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, xev-&gt;evtype == XI_ButtonPress,
<a id='L23447' name='L23447'></a> 23447                              x_x_to_emacs_modifiers (dpyinfo, bv.state));
<a id='L23448' name='L23448'></a> 23448                           x_flush_dirty_back_buffer_on (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L23449' name='L23449'></a> 23449                         <em class='brace'>}</em>
<a id='L23450' name='L23450'></a> 23450                     <em class='brace'>}</em>
<a id='L23451' name='L23451'></a> 23451 
<a id='L23452' name='L23452'></a> 23452 <em class='sharp'>#if</em> ! <strong class='reserved'>defined</strong> (USE_GTK)
<a id='L23453' name='L23453'></a> 23453                   <em class='comment'>/* Is this in the tool-bar?  */</em>
<a id='L23454' name='L23454'></a> 23454                   <strong class='reserved'>if</strong> (<a href='../D/6789.html' title='Multiple defined in 2 places.'>WINDOWP</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;tool_bar_window)
<a id='L23455' name='L23455'></a> 23455                       &amp;&amp; <a href='../S/2317.html#L657' title='Defined at 657 in src/window.h.'>WINDOW_TOTAL_LINES</a> (<a href='../D/7409.html' title='Multiple defined in 2 places.'>XWINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;tool_bar_window)))
<a id='L23456' name='L23456'></a> 23456                     <em class='brace'>{</em>
<a id='L23457' name='L23457'></a> 23457                       <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>;
<a id='L23458' name='L23458'></a> 23458                       <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = bv.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L23459' name='L23459'></a> 23459                       <strong class='reserved'>int</strong> y = bv.y;
<a id='L23460' name='L23460'></a> 23460 
<a id='L23461' name='L23461'></a> 23461                       <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = <a href='../S/2108.html#L1682' title='Defined at 1682 in src/window.c.'>window_from_coordinates</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, 0, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L23462' name='L23462'></a> 23462                       <em class='comment'>/* Ignore button release events if the mouse</em>
<a id='L23463' name='L23463'></a> 23463 <em class='comment'>                         wasn't previously pressed on the tool bar.</em>
<a id='L23464' name='L23464'></a> 23464 <em class='comment'>                         We do this because otherwise selecting some</em>
<a id='L23465' name='L23465'></a> 23465 <em class='comment'>                         text with the mouse and then releasing it on</em>
<a id='L23466' name='L23466'></a> 23466 <em class='comment'>                         the tool bar doesn't stop selecting text,</em>
<a id='L23467' name='L23467'></a> 23467 <em class='comment'>                         since the tool bar eats the button up</em>
<a id='L23468' name='L23468'></a> 23468 <em class='comment'>                         event.  */</em>
<a id='L23469' name='L23469'></a> 23469                       tool_bar_p = (<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;tool_bar_window)
<a id='L23470' name='L23470'></a> 23470                                     &amp;&amp; (xev-&gt;evtype != XI_ButtonRelease
<a id='L23471' name='L23471'></a> 23471                                         || <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;last_tool_bar_item != -1));
<a id='L23472' name='L23472'></a> 23472 
<a id='L23473' name='L23473'></a> 23473                       <strong class='reserved'>if</strong> (tool_bar_p &amp;&amp; xev-&gt;detail &lt; 4)
<a id='L23474' name='L23474'></a> 23474                         <em class='brace'>{</em>
<a id='L23475' name='L23475'></a> 23475                           <a href='../S/2224.html#L15690' title='Defined at 15690 in src/xdisp.c.'>handle_tool_bar_click_with_device</a>
<a id='L23476' name='L23476'></a> 23476                             (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, xev-&gt;evtype == XI_ButtonPress,
<a id='L23477' name='L23477'></a> 23477                              x_x_to_emacs_modifiers (dpyinfo, bv.state),
<a id='L23478' name='L23478'></a> 23478                              source ? source-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a> : Qt);
<a id='L23479' name='L23479'></a> 23479                           x_flush_dirty_back_buffer_on (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L23480' name='L23480'></a> 23480                         <em class='brace'>}</em>
<a id='L23481' name='L23481'></a> 23481                     <em class='brace'>}</em>
<a id='L23482' name='L23482'></a> 23482 <em class='sharp'>#endif</em> <em class='comment'>/* !USE_GTK */</em>
<a id='L23483' name='L23483'></a> 23483 
<a id='L23484' name='L23484'></a> 23484                   <strong class='reserved'>if</strong> (!(tab_bar_p &amp;&amp; <a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (tab_bar_arg)) &amp;&amp; !tool_bar_p)
<a id='L23485' name='L23485'></a> 23485 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> (USE_X_TOOLKIT) || <strong class='reserved'>defined</strong> (USE_GTK)
<a id='L23486' name='L23486'></a> 23486                     <strong class='reserved'>if</strong> (! <a href='../D/15672.html' title='Multiple defined in 5 places.'>popup_activated</a> ())
<a id='L23487' name='L23487'></a> 23487 <em class='sharp'>#endif</em>
<a id='L23488' name='L23488'></a> 23488                       <em class='brace'>{</em>
<a id='L23489' name='L23489'></a> 23489                         <strong class='reserved'>if</strong> (ignore_next_mouse_click_timeout)
<a id='L23490' name='L23490'></a> 23490                           <em class='brace'>{</em>
<a id='L23491' name='L23491'></a> 23491                             <strong class='reserved'>if</strong> (xev-&gt;evtype == XI_ButtonPress
<a id='L23492' name='L23492'></a> 23492                                 &amp;&amp; xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> &gt; ignore_next_mouse_click_timeout)
<a id='L23493' name='L23493'></a> 23493                               <em class='brace'>{</em>
<a id='L23494' name='L23494'></a> 23494                                 ignore_next_mouse_click_timeout = 0;
<a id='L23495' name='L23495'></a> 23495                                 x_construct_mouse_click (&amp;inev.ie, &amp;bv, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L23496' name='L23496'></a> 23496                               <em class='brace'>}</em>
<a id='L23497' name='L23497'></a> 23497                             <strong class='reserved'>if</strong> (xev-&gt;evtype == XI_ButtonRelease)
<a id='L23498' name='L23498'></a> 23498                               ignore_next_mouse_click_timeout = 0;
<a id='L23499' name='L23499'></a> 23499                           <em class='brace'>}</em>
<a id='L23500' name='L23500'></a> 23500                         <strong class='reserved'>else</strong>
<a id='L23501' name='L23501'></a> 23501                           x_construct_mouse_click (&amp;inev.ie, &amp;bv, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L23502' name='L23502'></a> 23502 
<a id='L23503' name='L23503'></a> 23503                         <strong class='reserved'>if</strong> (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (tab_bar_arg))
<a id='L23504' name='L23504'></a> 23504                           inev.ie.arg = tab_bar_arg;
<a id='L23505' name='L23505'></a> 23505                       <em class='brace'>}</em>
<a id='L23506' name='L23506'></a> 23506 
<a id='L23507' name='L23507'></a> 23507                   <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1979' title='Defined at 1979 in src/xterm.h.'>FRAME_X_EMBEDDED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L23508' name='L23508'></a> 23508                       &amp;&amp; !<a href='../D/2354.html' title='Multiple defined in 2 places.'>FRAME_NO_ACCEPT_FOCUS</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L23509' name='L23509'></a> 23509                     xembed_send_message (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>,
<a id='L23510' name='L23510'></a> 23510                                          <a href='../S/2289.html#L1149' title='Defined at 1149 in src/xterm.c.'>XEMBED_REQUEST_FOCUS</a>, 0, 0, 0);
<a id='L23511' name='L23511'></a> 23511                 <em class='brace'>}</em>
<a id='L23512' name='L23512'></a> 23512               <strong class='reserved'>else</strong>
<a id='L23513' name='L23513'></a> 23513                 <em class='brace'>{</em>
<a id='L23514' name='L23514'></a> 23514                   <strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>
<a id='L23515' name='L23515'></a> 23515                     = x_window_to_scroll_bar (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L23516' name='L23516'></a> 23516                                               xev-&gt;event, 2);
<a id='L23517' name='L23517'></a> 23517 
<a id='L23518' name='L23518'></a> 23518 <em class='sharp'>#ifndef</em> USE_TOOLKIT_SCROLL_BARS
<a id='L23519' name='L23519'></a> 23519                   <strong class='reserved'>if</strong> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>)
<a id='L23520' name='L23520'></a> 23520                     x_scroll_bar_handle_click (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>, (XEvent *) &amp;bv, &amp;inev.ie,
<a id='L23521' name='L23521'></a> 23521                                                source ? source-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a> : Qnil);
<a id='L23522' name='L23522'></a> 23522 <em class='sharp'>#else</em>
<a id='L23523' name='L23523'></a> 23523                   <em class='comment'>/* Make the "Ctrl-Mouse-2 splits window" work for toolkit</em>
<a id='L23524' name='L23524'></a> 23524 <em class='comment'>                     scroll bars.  */</em>
<a id='L23525' name='L23525'></a> 23525                   <strong class='reserved'>if</strong> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> &amp;&amp; xev-&gt;mods.effective &amp; ControlMask)
<a id='L23526' name='L23526'></a> 23526                     <em class='brace'>{</em>
<a id='L23527' name='L23527'></a> 23527                       x_scroll_bar_handle_click (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>, (XEvent *) &amp;bv, &amp;inev.ie,
<a id='L23528' name='L23528'></a> 23528                                                  source ? source-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a> : Qnil);
<a id='L23529' name='L23529'></a> 23529                       *finish = <a href='../S/2289.html#L1136' title='Defined at 1136 in src/xterm.c.'>X_EVENT_DROP</a>;
<a id='L23530' name='L23530'></a> 23530                     <em class='brace'>}</em>
<a id='L23531' name='L23531'></a> 23531 <em class='sharp'>#endif</em>
<a id='L23532' name='L23532'></a> 23532                 <em class='brace'>}</em>
<a id='L23533' name='L23533'></a> 23533 
<a id='L23534' name='L23534'></a> 23534               <strong class='reserved'>if</strong> (xev-&gt;evtype == XI_ButtonPress)
<a id='L23535' name='L23535'></a> 23535                 <em class='brace'>{</em>
<a id='L23536' name='L23536'></a> 23536                   dpyinfo-&gt;grabbed |= (1 &lt;&lt; xev-&gt;detail);
<a id='L23537' name='L23537'></a> 23537                   device-&gt;grab |= (1 &lt;&lt; xev-&gt;detail);
<a id='L23538' name='L23538'></a> 23538                   dpyinfo-&gt;last_mouse_frame = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L23539' name='L23539'></a> 23539                   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; !tab_bar_p)
<a id='L23540' name='L23540'></a> 23540                     <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;last_tab_bar_item = -1;
<a id='L23541' name='L23541'></a> 23541 <em class='sharp'>#if</em> ! <strong class='reserved'>defined</strong> (USE_GTK)
<a id='L23542' name='L23542'></a> 23542                   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; !tool_bar_p)
<a id='L23543' name='L23543'></a> 23543                     <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;last_tool_bar_item = -1;
<a id='L23544' name='L23544'></a> 23544 <em class='sharp'>#endif</em> <em class='comment'>/* not USE_GTK */</em>
<a id='L23545' name='L23545'></a> 23545 
<a id='L23546' name='L23546'></a> 23546                 <em class='brace'>}</em>
<a id='L23547' name='L23547'></a> 23547               <strong class='reserved'>else</strong>
<a id='L23548' name='L23548'></a> 23548                 <em class='brace'>{</em>
<a id='L23549' name='L23549'></a> 23549                   dpyinfo-&gt;grabbed &amp;= ~(1 &lt;&lt; xev-&gt;detail);
<a id='L23550' name='L23550'></a> 23550                   device-&gt;grab &amp;= ~(1 &lt;&lt; xev-&gt;detail);
<a id='L23551' name='L23551'></a> 23551                 <em class='brace'>}</em>
<a id='L23552' name='L23552'></a> 23552 
<a id='L23553' name='L23553'></a> 23553               <strong class='reserved'>if</strong> (source &amp;&amp; inev.ie.kind != <a href='../S/2231.html#L74' title='Defined at 74 in src/termhooks.h.'>NO_EVENT</a>)
<a id='L23554' name='L23554'></a> 23554                 inev.ie.device = source-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>;
<a id='L23555' name='L23555'></a> 23555 
<a id='L23556' name='L23556'></a> 23556               <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L23557' name='L23557'></a> 23557                 <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;mouse_moved = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L23558' name='L23558'></a> 23558 
<a id='L23559' name='L23559'></a> 23559 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> (USE_GTK)
<a id='L23560' name='L23560'></a> 23560               <em class='comment'>/* No Xt toolkit currently available has support for XI2.</em>
<a id='L23561' name='L23561'></a> 23561 <em class='comment'>                 So the code here assumes use of GTK.  */</em>
<a id='L23562' name='L23562'></a> 23562               <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2289.html#L12131' title='Defined at 12131 in src/xterm.c.'>x_menubar_window_to_frame</a> (dpyinfo, event);
<a id='L23563' name='L23563'></a> 23563               <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> <em class='comment'>/* Gtk+ menus only react to the first three buttons. */</em>
<a id='L23564' name='L23564'></a> 23564                   &amp;&amp; xev-&gt;detail &lt; 3)
<a id='L23565' name='L23565'></a> 23565                 <em class='brace'>{</em>
<a id='L23566' name='L23566'></a> 23566                   <em class='comment'>/* What is done with Core Input ButtonPressed is not</em>
<a id='L23567' name='L23567'></a> 23567 <em class='comment'>                     possible here, because GenericEvents cannot be saved.  */</em>
<a id='L23568' name='L23568'></a> 23568                   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> was_waiting_for_input = <a href='../S/2352.html#L171' title='Defined at 171 in src/thread.h.'>waiting_for_input</a>;
<a id='L23569' name='L23569'></a> 23569                   <em class='comment'>/* This hack was adopted from the NS port.  Whether</em>
<a id='L23570' name='L23570'></a> 23570 <em class='comment'>                     or not it is actually safe is a different story</em>
<a id='L23571' name='L23571'></a> 23571 <em class='comment'>                     altogether.  */</em>
<a id='L23572' name='L23572'></a> 23572                   <strong class='reserved'>if</strong> (<a href='../S/2352.html#L171' title='Defined at 171 in src/thread.h.'>waiting_for_input</a>)
<a id='L23573' name='L23573'></a> 23573                     <a href='../S/2352.html#L171' title='Defined at 171 in src/thread.h.'>waiting_for_input</a> = 0;
<a id='L23574' name='L23574'></a> 23574                   <a href='../D/16825.html' title='Multiple defined in 4 places.'>set_frame_menubar</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L23575' name='L23575'></a> 23575                   <a href='../S/2352.html#L171' title='Defined at 171 in src/thread.h.'>waiting_for_input</a> = was_waiting_for_input;
<a id='L23576' name='L23576'></a> 23576                 <em class='brace'>}</em>
<a id='L23577' name='L23577'></a> 23577 <em class='sharp'>#endif</em>
<a id='L23578' name='L23578'></a> 23578               <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L23579' name='L23579'></a> 23579             <em class='brace'>}</em>
<a id='L23580' name='L23580'></a> 23580 
<a id='L23581' name='L23581'></a> 23581           <strong class='reserved'>case</strong> XI_KeyPress:
<a id='L23582' name='L23582'></a> 23582             <em class='brace'>{</em>
<a id='L23583' name='L23583'></a> 23583               <strong class='reserved'>int</strong> state = xev-&gt;mods.effective;
<a id='L23584' name='L23584'></a> 23584               <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../D/9440.html' title='Multiple defined in 2 places.'>c</a>;
<a id='L23585' name='L23585'></a> 23585 <em class='sharp'>#ifdef</em> HAVE_XKB
<a id='L23586' name='L23586'></a> 23586               <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> mods_rtrn;
<a id='L23587' name='L23587'></a> 23587 <em class='sharp'>#endif</em>
<a id='L23588' name='L23588'></a> 23588               <strong class='reserved'>int</strong> keycode = xev-&gt;detail;
<a id='L23589' name='L23589'></a> 23589               KeySym keysym;
<a id='L23590' name='L23590'></a> 23590               <strong class='reserved'>char</strong> <a href='../S/2097.html#L86' title='Defined at 86 in src/textconv.c.'>copy_buffer</a>[81];
<a id='L23591' name='L23591'></a> 23591               <strong class='reserved'>char</strong> *copy_bufptr = <a href='../S/2097.html#L86' title='Defined at 86 in src/textconv.c.'>copy_buffer</a>;
<a id='L23592' name='L23592'></a> 23592               <strong class='reserved'>int</strong> copy_bufsiz = <strong class='reserved'>sizeof</strong> (<a href='../S/2097.html#L86' title='Defined at 86 in src/textconv.c.'>copy_buffer</a>);
<a id='L23593' name='L23593'></a> 23593               ptrdiff_t i;
<a id='L23594' name='L23594'></a> 23594               <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> old_state;
<a id='L23595' name='L23595'></a> 23595               <strong class='reserved'>struct</strong> <a href='../S/2212.html#L275' title='Defined at 275 in src/xterm.h.'>xi_device_t</a> *device, *source;
<a id='L23596' name='L23596'></a> 23596 
<a id='L23597' name='L23597'></a> 23597               coding = Qlatin_1;
<a id='L23598' name='L23598'></a> 23598 
<a id='L23599' name='L23599'></a> 23599               device = <a href='../S/2289.html#L5732' title='Defined at 5732 in src/xterm.c.'>xi_device_from_id</a> (dpyinfo, xev-&gt;deviceid);
<a id='L23600' name='L23600'></a> 23600               source = <a href='../S/2289.html#L5732' title='Defined at 5732 in src/xterm.c.'>xi_device_from_id</a> (dpyinfo, xev-&gt;sourceid);
<a id='L23601' name='L23601'></a> 23601 
<a id='L23602' name='L23602'></a> 23602               <strong class='reserved'>if</strong> (!device)
<a id='L23603' name='L23603'></a> 23603                 <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L23604' name='L23604'></a> 23604 
<a id='L23605' name='L23605'></a> 23605 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> (USE_X_TOOLKIT) || <strong class='reserved'>defined</strong> (USE_GTK)
<a id='L23606' name='L23606'></a> 23606               <em class='comment'>/* Dispatch XI_KeyPress events when in menu.  */</em>
<a id='L23607' name='L23607'></a> 23607               <strong class='reserved'>if</strong> (<a href='../D/15672.html' title='Multiple defined in 5 places.'>popup_activated</a> ())
<a id='L23608' name='L23608'></a> 23608                 <em class='brace'>{</em>
<a id='L23609' name='L23609'></a> 23609 <em class='sharp'>#ifdef</em> USE_LUCID
<a id='L23610' name='L23610'></a> 23610                   <em class='comment'>/* This makes key navigation work inside menus.  */</em>
<a id='L23611' name='L23611'></a> 23611                   use_copy = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L23612' name='L23612'></a> 23612                   copy.xkey.type = KeyPress;
<a id='L23613' name='L23613'></a> 23613                   copy.xkey.serial = xev-&gt;serial;
<a id='L23614' name='L23614'></a> 23614                   copy.xkey.send_event = xev-&gt;send_event;
<a id='L23615' name='L23615'></a> 23615                   copy.xkey.<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> = dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>;
<a id='L23616' name='L23616'></a> 23616                   copy.xkey.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = xev-&gt;event;
<a id='L23617' name='L23617'></a> 23617                   copy.xkey.root = xev-&gt;root;
<a id='L23618' name='L23618'></a> 23618                   copy.xkey.subwindow = xev-&gt;child;
<a id='L23619' name='L23619'></a> 23619                   copy.xkey.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> = xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L23620' name='L23620'></a> 23620                   copy.xkey.state = <a href='../S/2289.html#L5347' title='Defined at 5347 in src/xterm.c.'>xi_convert_event_keyboard_state</a> (xev);
<a id='L23621' name='L23621'></a> 23621                   <a href='../S/2289.html#L5308' title='Defined at 5308 in src/xterm.c.'>xi_convert_button_state</a> (&amp;xev-&gt;buttons, &amp;copy.xkey.state);
<a id='L23622' name='L23622'></a> 23622 
<a id='L23623' name='L23623'></a> 23623                   copy.xkey.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = lrint (xev-&gt;event_x);
<a id='L23624' name='L23624'></a> 23624                   copy.xkey.y = lrint (xev-&gt;event_y);
<a id='L23625' name='L23625'></a> 23625                   copy.xkey.x_root = lrint (xev-&gt;root_x);
<a id='L23626' name='L23626'></a> 23626                   copy.xkey.y_root = lrint (xev-&gt;root_y);
<a id='L23627' name='L23627'></a> 23627                   copy.xkey.keycode = xev-&gt;detail;
<a id='L23628' name='L23628'></a> 23628                   copy.xkey.same_screen = True;
<a id='L23629' name='L23629'></a> 23629 <em class='sharp'>#endif</em>
<a id='L23630' name='L23630'></a> 23630                   <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L23631' name='L23631'></a> 23631                 <em class='brace'>}</em>
<a id='L23632' name='L23632'></a> 23632 <em class='sharp'>#endif</em>
<a id='L23633' name='L23633'></a> 23633 
<a id='L23634' name='L23634'></a> 23634               <a href='../S/2289.html#L7929' title='Defined at 7929 in src/xterm.c.'>x_display_set_last_user_time</a> (dpyinfo, xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>,
<a id='L23635' name='L23635'></a> 23635                                             xev-&gt;send_event, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L23636' name='L23636'></a> 23636               ignore_next_mouse_click_timeout = 0;
<a id='L23637' name='L23637'></a> 23637 
<a id='L23638' name='L23638'></a> 23638               <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../D/19416.html' title='Multiple defined in 2 places.'>x_any_window_to_frame</a> (dpyinfo, xev-&gt;event);
<a id='L23639' name='L23639'></a> 23639 
<a id='L23640' name='L23640'></a> 23640               <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; xev-&gt;event == <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L23641' name='L23641'></a> 23641                 <em class='comment'>/* See the comment above x_compute_root_window_offset</em>
<a id='L23642' name='L23642'></a> 23642 <em class='comment'>                   for why this optimization is performed.  */</em>
<a id='L23643' name='L23643'></a> 23643                 xi_compute_root_window_offset (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, xev);
<a id='L23644' name='L23644'></a> 23644 
<a id='L23645' name='L23645'></a> 23645               <em class='comment'>/* GTK handles TAB events in an undesirable manner, so</em>
<a id='L23646' name='L23646'></a> 23646 <em class='comment'>                 keyboard events are always dropped.  But as a side</em>
<a id='L23647' name='L23647'></a> 23647 <em class='comment'>                 effect, the user time will no longer be set by GDK,</em>
<a id='L23648' name='L23648'></a> 23648 <em class='comment'>                 so do that manually.  */</em>
<a id='L23649' name='L23649'></a> 23649 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L23650' name='L23650'></a> 23650               <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L23651' name='L23651'></a> 23651                 <a href='../S/2289.html#L8023' title='Defined at 8023 in src/xterm.c.'>x_set_gtk_user_time</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>);
<a id='L23652' name='L23652'></a> 23652 <em class='sharp'>#endif</em>
<a id='L23653' name='L23653'></a> 23653 
<a id='L23654' name='L23654'></a> 23654               <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L23655' name='L23655'></a> 23655                 <em class='brace'>{</em>
<a id='L23656' name='L23656'></a> 23656                   <em class='comment'>/* If the user interacts with a frame that's focused</em>
<a id='L23657' name='L23657'></a> 23657 <em class='comment'>                     on another device, but not the current focus</em>
<a id='L23658' name='L23658'></a> 23658 <em class='comment'>                     frame, make it the focus frame.  */</em>
<a id='L23659' name='L23659'></a> 23659                   <strong class='reserved'>if</strong> (device)
<a id='L23660' name='L23660'></a> 23660                     xi_handle_interaction (dpyinfo, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, device,
<a id='L23661' name='L23661'></a> 23661                                            xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>);
<a id='L23662' name='L23662'></a> 23662                 <em class='brace'>}</em>
<a id='L23663' name='L23663'></a> 23663 
<a id='L23664' name='L23664'></a> 23664               XKeyPressedEvent xkey;
<a id='L23665' name='L23665'></a> 23665 
<a id='L23666' name='L23666'></a> 23666               memset (&amp;xkey, 0, <strong class='reserved'>sizeof</strong> xkey);
<a id='L23667' name='L23667'></a> 23667 
<a id='L23668' name='L23668'></a> 23668               xkey.type = KeyPress;
<a id='L23669' name='L23669'></a> 23669               xkey.serial = xev-&gt;serial;
<a id='L23670' name='L23670'></a> 23670               xkey.send_event = xev-&gt;send_event;
<a id='L23671' name='L23671'></a> 23671               xkey.<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> = dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>;
<a id='L23672' name='L23672'></a> 23672               xkey.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = xev-&gt;event;
<a id='L23673' name='L23673'></a> 23673               xkey.root = xev-&gt;root;
<a id='L23674' name='L23674'></a> 23674               xkey.subwindow = xev-&gt;child;
<a id='L23675' name='L23675'></a> 23675               xkey.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> = xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L23676' name='L23676'></a> 23676               xkey.state = <a href='../S/2289.html#L5347' title='Defined at 5347 in src/xterm.c.'>xi_convert_event_keyboard_state</a> (xev);
<a id='L23677' name='L23677'></a> 23677 
<a id='L23678' name='L23678'></a> 23678               xkey.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = lrint (xev-&gt;event_x);
<a id='L23679' name='L23679'></a> 23679               xkey.y = lrint (xev-&gt;event_y);
<a id='L23680' name='L23680'></a> 23680               xkey.x_root = lrint (xev-&gt;root_x);
<a id='L23681' name='L23681'></a> 23681               xkey.y_root = lrint (xev-&gt;root_y);
<a id='L23682' name='L23682'></a> 23682 
<a id='L23683' name='L23683'></a> 23683               <em class='comment'>/* Some input methods react differently depending on the</em>
<a id='L23684' name='L23684'></a> 23684 <em class='comment'>                 buttons that are pressed.  */</em>
<a id='L23685' name='L23685'></a> 23685               <a href='../S/2289.html#L5308' title='Defined at 5308 in src/xterm.c.'>xi_convert_button_state</a> (&amp;xev-&gt;buttons, &amp;xkey.state);
<a id='L23686' name='L23686'></a> 23686 
<a id='L23687' name='L23687'></a> 23687               xkey.keycode = xev-&gt;detail;
<a id='L23688' name='L23688'></a> 23688               xkey.same_screen = True;
<a id='L23689' name='L23689'></a> 23689 
<a id='L23690' name='L23690'></a> 23690 <em class='sharp'>#ifdef</em> HAVE_X_I18N
<a id='L23691' name='L23691'></a> 23691 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L23692' name='L23692'></a> 23692               <strong class='reserved'>if</strong> ((!x_gtk_use_native_input
<a id='L23693' name='L23693'></a> 23693                    &amp;&amp; x_filter_event (dpyinfo, (XEvent *) &amp;xkey))
<a id='L23694' name='L23694'></a> 23694                   || (x_gtk_use_native_input
<a id='L23695' name='L23695'></a> 23695                       &amp;&amp; x_filter_event (dpyinfo, event)))
<a id='L23696' name='L23696'></a> 23696                 <em class='brace'>{</em>
<a id='L23697' name='L23697'></a> 23697                   <em class='comment'>/* Try to attribute core key events from the input</em>
<a id='L23698' name='L23698'></a> 23698 <em class='comment'>                     method to the input extension event that caused</em>
<a id='L23699' name='L23699'></a> 23699 <em class='comment'>                     them.  */</em>
<a id='L23700' name='L23700'></a> 23700                   dpyinfo-&gt;pending_keystroke_time = xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L23701' name='L23701'></a> 23701                   dpyinfo-&gt;pending_keystroke_source = xev-&gt;sourceid;
<a id='L23702' name='L23702'></a> 23702 
<a id='L23703' name='L23703'></a> 23703                   *finish = <a href='../S/2289.html#L1136' title='Defined at 1136 in src/xterm.c.'>X_EVENT_DROP</a>;
<a id='L23704' name='L23704'></a> 23704                   <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L23705' name='L23705'></a> 23705                 <em class='brace'>}</em>
<a id='L23706' name='L23706'></a> 23706 <em class='sharp'>#else</em>
<a id='L23707' name='L23707'></a> 23707               <strong class='reserved'>if</strong> (x_filter_event (dpyinfo, (XEvent *) &amp;xkey))
<a id='L23708' name='L23708'></a> 23708                 <em class='brace'>{</em>
<a id='L23709' name='L23709'></a> 23709                   <em class='comment'>/* Try to attribute core key events from the input</em>
<a id='L23710' name='L23710'></a> 23710 <em class='comment'>                     method to the input extension event that caused</em>
<a id='L23711' name='L23711'></a> 23711 <em class='comment'>                     them.  */</em>
<a id='L23712' name='L23712'></a> 23712                   dpyinfo-&gt;pending_keystroke_time = xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L23713' name='L23713'></a> 23713                   dpyinfo-&gt;pending_keystroke_source = xev-&gt;sourceid;
<a id='L23714' name='L23714'></a> 23714 
<a id='L23715' name='L23715'></a> 23715                   *finish = <a href='../S/2289.html#L1136' title='Defined at 1136 in src/xterm.c.'>X_EVENT_DROP</a>;
<a id='L23716' name='L23716'></a> 23716                   <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L23717' name='L23717'></a> 23717                 <em class='brace'>}</em>
<a id='L23718' name='L23718'></a> 23718 <em class='sharp'>#endif</em>
<a id='L23719' name='L23719'></a> 23719 <em class='sharp'>#elif</em> USE_GTK
<a id='L23720' name='L23720'></a> 23720               <strong class='reserved'>if</strong> ((x_gtk_use_native_input
<a id='L23721' name='L23721'></a> 23721                    || dpyinfo-&gt;prefer_native_input)
<a id='L23722' name='L23722'></a> 23722                   &amp;&amp; <a href='../S/2362.html#L6561' title='Defined at 6561 in src/gtkutil.c.'>xg_filter_key</a> (any, event))
<a id='L23723' name='L23723'></a> 23723                 <em class='brace'>{</em>
<a id='L23724' name='L23724'></a> 23724                   <em class='comment'>/* Try to attribute core key events from the input</em>
<a id='L23725' name='L23725'></a> 23725 <em class='comment'>                     method to the input extension event that caused</em>
<a id='L23726' name='L23726'></a> 23726 <em class='comment'>                     them.  */</em>
<a id='L23727' name='L23727'></a> 23727                   dpyinfo-&gt;pending_keystroke_time = xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L23728' name='L23728'></a> 23728                   dpyinfo-&gt;pending_keystroke_source = xev-&gt;sourceid;
<a id='L23729' name='L23729'></a> 23729 
<a id='L23730' name='L23730'></a> 23730                   *finish = <a href='../S/2289.html#L1136' title='Defined at 1136 in src/xterm.c.'>X_EVENT_DROP</a>;
<a id='L23731' name='L23731'></a> 23731                   <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L23732' name='L23732'></a> 23732                 <em class='brace'>}</em>
<a id='L23733' name='L23733'></a> 23733 <em class='sharp'>#endif</em>
<a id='L23734' name='L23734'></a> 23734 
<a id='L23735' name='L23735'></a> 23735               state |= x_emacs_to_x_modifiers (dpyinfo, extra_keyboard_modifiers);
<a id='L23736' name='L23736'></a> 23736 
<a id='L23737' name='L23737'></a> 23737 <em class='sharp'>#ifdef</em> HAVE_XKB
<a id='L23738' name='L23738'></a> 23738               <strong class='reserved'>if</strong> (dpyinfo-&gt;xkb_desc)
<a id='L23739' name='L23739'></a> 23739                 <em class='brace'>{</em>
<a id='L23740' name='L23740'></a> 23740                   <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> xkb_state;
<a id='L23741' name='L23741'></a> 23741 
<a id='L23742' name='L23742'></a> 23742                   xkb_state = state &amp; ~(1 &lt;&lt; 13 | 1 &lt;&lt; 14);
<a id='L23743' name='L23743'></a> 23743                   xkb_state |= xev-&gt;<a href='../S/56.html#L26' title='Defined at 26 in nt/inc/grp.h.'>group</a>.effective &lt;&lt; 13;
<a id='L23744' name='L23744'></a> 23744 
<a id='L23745' name='L23745'></a> 23745                   <strong class='reserved'>if</strong> (!XkbTranslateKeyCode (dpyinfo-&gt;xkb_desc, keycode,
<a id='L23746' name='L23746'></a> 23746                                             xkb_state, &amp;mods_rtrn, &amp;keysym))
<a id='L23747' name='L23747'></a> 23747                     <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L23748' name='L23748'></a> 23748                 <em class='brace'>}</em>
<a id='L23749' name='L23749'></a> 23749               <strong class='reserved'>else</strong>
<a id='L23750' name='L23750'></a> 23750                 <em class='brace'>{</em>
<a id='L23751' name='L23751'></a> 23751 <em class='sharp'>#endif</em>
<a id='L23752' name='L23752'></a> 23752                   <strong class='reserved'>int</strong> keysyms_per_keycode_return;
<a id='L23753' name='L23753'></a> 23753                   KeySym *ksms = XGetKeyboardMapping (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, keycode, 1,
<a id='L23754' name='L23754'></a> 23754                                                       &amp;keysyms_per_keycode_return);
<a id='L23755' name='L23755'></a> 23755                   <strong class='reserved'>if</strong> (!(keysym = ksms[0]))
<a id='L23756' name='L23756'></a> 23756                     <em class='brace'>{</em>
<a id='L23757' name='L23757'></a> 23757                       XFree (ksms);
<a id='L23758' name='L23758'></a> 23758                       <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L23759' name='L23759'></a> 23759                     <em class='brace'>}</em>
<a id='L23760' name='L23760'></a> 23760                   XFree (ksms);
<a id='L23761' name='L23761'></a> 23761 <em class='sharp'>#ifdef</em> HAVE_XKB
<a id='L23762' name='L23762'></a> 23762                 <em class='brace'>}</em>
<a id='L23763' name='L23763'></a> 23763 <em class='sharp'>#endif</em>
<a id='L23764' name='L23764'></a> 23764 
<a id='L23765' name='L23765'></a> 23765               <strong class='reserved'>if</strong> (keysym == NoSymbol)
<a id='L23766' name='L23766'></a> 23766                 <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L23767' name='L23767'></a> 23767 
<a id='L23768' name='L23768'></a> 23768               <em class='comment'>/* If mouse-highlight is an integer, input clears out</em>
<a id='L23769' name='L23769'></a> 23769 <em class='comment'>                 mouse highlighting.  */</em>
<a id='L23770' name='L23770'></a> 23770               <strong class='reserved'>if</strong> (!hlinfo-&gt;mouse_face_hidden &amp;&amp; <a href='../S/2267.html#L469' title='Defined at 469 in src/lisp.h.'>FIXNUMP</a> (Vmouse_highlight)
<a id='L23771' name='L23771'></a> 23771                   &amp;&amp; (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> == 0
<a id='L23772' name='L23772'></a> 23772 <em class='sharp'>#if</em> ! <strong class='reserved'>defined</strong> (USE_GTK)
<a id='L23773' name='L23773'></a> 23773                       || !<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;tool_bar_window, hlinfo-&gt;mouse_face_window)
<a id='L23774' name='L23774'></a> 23774 <em class='sharp'>#endif</em>
<a id='L23775' name='L23775'></a> 23775                       || !<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;tab_bar_window, hlinfo-&gt;mouse_face_window))
<a id='L23776' name='L23776'></a> 23776                   )
<a id='L23777' name='L23777'></a> 23777                 <em class='brace'>{</em>
<a id='L23778' name='L23778'></a> 23778                   mouse_frame = hlinfo-&gt;mouse_face_mouse_frame;
<a id='L23779' name='L23779'></a> 23779 
<a id='L23780' name='L23780'></a> 23780                   <a href='../S/2224.html#L34014' title='Defined at 34014 in src/xdisp.c.'>clear_mouse_face</a> (hlinfo);
<a id='L23781' name='L23781'></a> 23781                   hlinfo-&gt;mouse_face_hidden = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L23782' name='L23782'></a> 23782 
<a id='L23783' name='L23783'></a> 23783                   <strong class='reserved'>if</strong> (mouse_frame)
<a id='L23784' name='L23784'></a> 23784                     x_flush_dirty_back_buffer_on (mouse_frame);
<a id='L23785' name='L23785'></a> 23785                 <em class='brace'>}</em>
<a id='L23786' name='L23786'></a> 23786 
<a id='L23787' name='L23787'></a> 23787               <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> != 0)
<a id='L23788' name='L23788'></a> 23788                 <em class='brace'>{</em>
<a id='L23789' name='L23789'></a> 23789 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L23790' name='L23790'></a> 23790                   <em class='comment'>/* Don't pass keys to GTK.  A Tab will shift focus to the</em>
<a id='L23791' name='L23791'></a> 23791 <em class='comment'>                     tool bar in GTK 2.4.  Keys will still go to menus and</em>
<a id='L23792' name='L23792'></a> 23792 <em class='comment'>                     dialogs because in that case popup_activated is nonzero</em>
<a id='L23793' name='L23793'></a> 23793 <em class='comment'>                     (see above).  */</em>
<a id='L23794' name='L23794'></a> 23794                   *finish = <a href='../S/2289.html#L1136' title='Defined at 1136 in src/xterm.c.'>X_EVENT_DROP</a>;
<a id='L23795' name='L23795'></a> 23795 <em class='sharp'>#endif</em>
<a id='L23796' name='L23796'></a> 23796 
<a id='L23797' name='L23797'></a> 23797                   <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (inev.ie.frame_or_window, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L23798' name='L23798'></a> 23798                   inev.ie.timestamp = xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L23799' name='L23799'></a> 23799 
<a id='L23800' name='L23800'></a> 23800 <em class='sharp'>#ifdef</em> HAVE_X_I18N
<a id='L23801' name='L23801'></a> 23801                   <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1470' title='Defined at 1470 in src/xterm.h.'>FRAME_XIC</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L23802' name='L23802'></a> 23802                     <em class='brace'>{</em>
<a id='L23803' name='L23803'></a> 23803                       Status status_return;
<a id='L23804' name='L23804'></a> 23804                       nbytes = XmbLookupString (<a href='../S/2212.html#L1470' title='Defined at 1470 in src/xterm.h.'>FRAME_XIC</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L23805' name='L23805'></a> 23805                                                 &amp;xkey, (<strong class='reserved'>char</strong> *) copy_bufptr,
<a id='L23806' name='L23806'></a> 23806                                                 copy_bufsiz, &amp;keysym,
<a id='L23807' name='L23807'></a> 23807                                                 &amp;status_return);
<a id='L23808' name='L23808'></a> 23808                       coding = <a href='../S/2212.html#L1475' title='Defined at 1475 in src/xterm.h.'>FRAME_X_XIM_CODING</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L23809' name='L23809'></a> 23809 
<a id='L23810' name='L23810'></a> 23810                       <strong class='reserved'>if</strong> (status_return == XBufferOverflow)
<a id='L23811' name='L23811'></a> 23811                         <em class='brace'>{</em>
<a id='L23812' name='L23812'></a> 23812                           copy_bufsiz = nbytes + 1;
<a id='L23813' name='L23813'></a> 23813                           copy_bufptr = <a href='../D/5389.html' title='Multiple defined in 2 places.'>SAFE_ALLOCA</a> (copy_bufsiz);
<a id='L23814' name='L23814'></a> 23814                           nbytes = XmbLookupString (<a href='../S/2212.html#L1470' title='Defined at 1470 in src/xterm.h.'>FRAME_XIC</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L23815' name='L23815'></a> 23815                                                     &amp;xkey, (<strong class='reserved'>char</strong> *) copy_bufptr,
<a id='L23816' name='L23816'></a> 23816                                                     copy_bufsiz, &amp;keysym,
<a id='L23817' name='L23817'></a> 23817                                                     &amp;status_return);
<a id='L23818' name='L23818'></a> 23818                         <em class='brace'>}</em>
<a id='L23819' name='L23819'></a> 23819 
<a id='L23820' name='L23820'></a> 23820                       <strong class='reserved'>if</strong> (status_return == XLookupNone)
<a id='L23821' name='L23821'></a> 23821                         <strong class='reserved'>goto</strong> xi_done_keysym;
<a id='L23822' name='L23822'></a> 23822                       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (status_return == XLookupChars)
<a id='L23823' name='L23823'></a> 23823                         <em class='brace'>{</em>
<a id='L23824' name='L23824'></a> 23824                           keysym = NoSymbol;
<a id='L23825' name='L23825'></a> 23825                           state = 0;
<a id='L23826' name='L23826'></a> 23826                         <em class='brace'>}</em>
<a id='L23827' name='L23827'></a> 23827                       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (status_return != XLookupKeySym
<a id='L23828' name='L23828'></a> 23828                                &amp;&amp; status_return != XLookupBoth)
<a id='L23829' name='L23829'></a> 23829                         <a href='../D/10893.html' title='Multiple defined in 6 places.'>emacs_abort</a> ();
<a id='L23830' name='L23830'></a> 23830                     <em class='brace'>}</em>
<a id='L23831' name='L23831'></a> 23831                   <strong class='reserved'>else</strong>
<a id='L23832' name='L23832'></a> 23832 <em class='sharp'>#endif</em>
<a id='L23833' name='L23833'></a> 23833                     <em class='brace'>{</em>
<a id='L23834' name='L23834'></a> 23834 <em class='sharp'>#ifdef</em> HAVE_XKB
<a id='L23835' name='L23835'></a> 23835                       <strong class='reserved'>int</strong> overflow = 0;
<a id='L23836' name='L23836'></a> 23836                       KeySym <a href='../S/2974.html#L278' title='Defined at 278 in lib-src/ebrowse.c.'>sym</a> = keysym;
<a id='L23837' name='L23837'></a> 23837 
<a id='L23838' name='L23838'></a> 23838                       <strong class='reserved'>if</strong> (dpyinfo-&gt;xkb_desc)
<a id='L23839' name='L23839'></a> 23839                         <em class='brace'>{</em>
<a id='L23840' name='L23840'></a> 23840                           nbytes = XkbTranslateKeySym (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, &amp;<a href='../S/2974.html#L278' title='Defined at 278 in lib-src/ebrowse.c.'>sym</a>,
<a id='L23841' name='L23841'></a> 23841                                                        state &amp; ~mods_rtrn, copy_bufptr,
<a id='L23842' name='L23842'></a> 23842                                                        copy_bufsiz, &amp;overflow);
<a id='L23843' name='L23843'></a> 23843                           <strong class='reserved'>if</strong> (overflow)
<a id='L23844' name='L23844'></a> 23844                             <em class='brace'>{</em>
<a id='L23845' name='L23845'></a> 23845                               copy_bufptr = <a href='../D/5389.html' title='Multiple defined in 2 places.'>SAFE_ALLOCA</a> ((copy_bufsiz += overflow)
<a id='L23846' name='L23846'></a> 23846                                                          * <strong class='reserved'>sizeof</strong> *copy_bufptr);
<a id='L23847' name='L23847'></a> 23847                               overflow = 0;
<a id='L23848' name='L23848'></a> 23848                               nbytes = XkbTranslateKeySym (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, &amp;<a href='../S/2974.html#L278' title='Defined at 278 in lib-src/ebrowse.c.'>sym</a>,
<a id='L23849' name='L23849'></a> 23849                                                            state &amp; ~mods_rtrn, copy_bufptr,
<a id='L23850' name='L23850'></a> 23850                                                            copy_bufsiz, &amp;overflow);
<a id='L23851' name='L23851'></a> 23851 
<a id='L23852' name='L23852'></a> 23852                               <strong class='reserved'>if</strong> (overflow)
<a id='L23853' name='L23853'></a> 23853                                 nbytes = 0;
<a id='L23854' name='L23854'></a> 23854                             <em class='brace'>}</em>
<a id='L23855' name='L23855'></a> 23855 
<a id='L23856' name='L23856'></a> 23856                           coding = Qnil;
<a id='L23857' name='L23857'></a> 23857                         <em class='brace'>}</em>
<a id='L23858' name='L23858'></a> 23858                       <strong class='reserved'>else</strong>
<a id='L23859' name='L23859'></a> 23859 <em class='sharp'>#endif</em>
<a id='L23860' name='L23860'></a> 23860                         <em class='brace'>{</em>
<a id='L23861' name='L23861'></a> 23861                           old_state = xkey.state;
<a id='L23862' name='L23862'></a> 23862                           xkey.state &amp;= ~ControlMask;
<a id='L23863' name='L23863'></a> 23863                           xkey.state &amp;= ~(dpyinfo-&gt;meta_mod_mask
<a id='L23864' name='L23864'></a> 23864                                           | dpyinfo-&gt;super_mod_mask
<a id='L23865' name='L23865'></a> 23865                                           | dpyinfo-&gt;hyper_mod_mask
<a id='L23866' name='L23866'></a> 23866                                           | dpyinfo-&gt;alt_mod_mask);
<a id='L23867' name='L23867'></a> 23867 
<a id='L23868' name='L23868'></a> 23868                           nbytes = XLookupString (&amp;xkey, copy_bufptr,
<a id='L23869' name='L23869'></a> 23869                                                   copy_bufsiz, &amp;keysym,
<a id='L23870' name='L23870'></a> 23870                                                   <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L23871' name='L23871'></a> 23871 
<a id='L23872' name='L23872'></a> 23872                           xkey.state = old_state;
<a id='L23873' name='L23873'></a> 23873                         <em class='brace'>}</em>
<a id='L23874' name='L23874'></a> 23874                     <em class='brace'>}</em>
<a id='L23875' name='L23875'></a> 23875 
<a id='L23876' name='L23876'></a> 23876                   inev.ie.modifiers = x_x_to_emacs_modifiers (dpyinfo, state);
<a id='L23877' name='L23877'></a> 23877 
<a id='L23878' name='L23878'></a> 23878 <em class='sharp'>#ifdef</em> XK_F1
<a id='L23879' name='L23879'></a> 23879                   <strong class='reserved'>if</strong> (x_dnd_in_progress
<a id='L23880' name='L23880'></a> 23880                       &amp;&amp; xev-&gt;deviceid == x_dnd_keyboard_device
<a id='L23881' name='L23881'></a> 23881                       &amp;&amp; keysym == XK_F1)
<a id='L23882' name='L23882'></a> 23882                     <em class='brace'>{</em>
<a id='L23883' name='L23883'></a> 23883                       x_dnd_xm_use_help = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L23884' name='L23884'></a> 23884                       <strong class='reserved'>goto</strong> xi_done_keysym;
<a id='L23885' name='L23885'></a> 23885                     <em class='brace'>}</em>
<a id='L23886' name='L23886'></a> 23886 <em class='sharp'>#endif</em>
<a id='L23887' name='L23887'></a> 23887 
<a id='L23888' name='L23888'></a> 23888                   <em class='comment'>/* See if keysym should make Emacs quit.  */</em>
<a id='L23889' name='L23889'></a> 23889 
<a id='L23890' name='L23890'></a> 23890                   <strong class='reserved'>if</strong> (keysym == dpyinfo-&gt;quit_keysym
<a id='L23891' name='L23891'></a> 23891                       &amp;&amp; (xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> - dpyinfo-&gt;quit_keysym_time
<a id='L23892' name='L23892'></a> 23892                           &lt;= 350))
<a id='L23893' name='L23893'></a> 23893                     <em class='brace'>{</em>
<a id='L23894' name='L23894'></a> 23894                       Vquit_flag = Qt;
<a id='L23895' name='L23895'></a> 23895                       <strong class='reserved'>goto</strong> xi_done_keysym;
<a id='L23896' name='L23896'></a> 23896                     <em class='brace'>}</em>
<a id='L23897' name='L23897'></a> 23897 
<a id='L23898' name='L23898'></a> 23898                   <strong class='reserved'>if</strong> (keysym == dpyinfo-&gt;quit_keysym)
<a id='L23899' name='L23899'></a> 23899                     <em class='brace'>{</em>
<a id='L23900' name='L23900'></a> 23900                       <em class='comment'>/* Otherwise, set the last time that keysym was</em>
<a id='L23901' name='L23901'></a> 23901 <em class='comment'>                         pressed.  */</em>
<a id='L23902' name='L23902'></a> 23902                       dpyinfo-&gt;quit_keysym_time = xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L23903' name='L23903'></a> 23903                       <strong class='reserved'>goto</strong> xi_done_keysym;
<a id='L23904' name='L23904'></a> 23904                     <em class='brace'>}</em>
<a id='L23905' name='L23905'></a> 23905 
<a id='L23906' name='L23906'></a> 23906                   <em class='comment'>/* First deal with keysyms which have defined</em>
<a id='L23907' name='L23907'></a> 23907 <em class='comment'>                     translations to characters.  */</em>
<a id='L23908' name='L23908'></a> 23908                   <strong class='reserved'>if</strong> (keysym &gt;= 32 &amp;&amp; keysym &lt; 128)
<a id='L23909' name='L23909'></a> 23909                     <em class='comment'>/* Avoid explicitly decoding each ASCII character.  */</em>
<a id='L23910' name='L23910'></a> 23910                     <em class='brace'>{</em>
<a id='L23911' name='L23911'></a> 23911                       inev.ie.kind = <a href='../S/2231.html#L77' title='Defined at 77 in src/termhooks.h.'>ASCII_KEYSTROKE_EVENT</a>;
<a id='L23912' name='L23912'></a> 23912                       inev.ie.code = keysym;
<a id='L23913' name='L23913'></a> 23913 
<a id='L23914' name='L23914'></a> 23914                       <strong class='reserved'>if</strong> (source)
<a id='L23915' name='L23915'></a> 23915                         inev.ie.device = source-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>;
<a id='L23916' name='L23916'></a> 23916 
<a id='L23917' name='L23917'></a> 23917                       <strong class='reserved'>goto</strong> xi_done_keysym;
<a id='L23918' name='L23918'></a> 23918                     <em class='brace'>}</em>
<a id='L23919' name='L23919'></a> 23919 
<a id='L23920' name='L23920'></a> 23920                   <em class='comment'>/* Keysyms directly mapped to Unicode characters.  */</em>
<a id='L23921' name='L23921'></a> 23921                   <strong class='reserved'>if</strong> (keysym &gt;= 0x01000000 &amp;&amp; keysym &lt;= 0x0110FFFF)
<a id='L23922' name='L23922'></a> 23922                     <em class='brace'>{</em>
<a id='L23923' name='L23923'></a> 23923                       <strong class='reserved'>if</strong> (keysym &lt; 0x01000080)
<a id='L23924' name='L23924'></a> 23924                         inev.ie.kind = <a href='../S/2231.html#L77' title='Defined at 77 in src/termhooks.h.'>ASCII_KEYSTROKE_EVENT</a>;
<a id='L23925' name='L23925'></a> 23925                       <strong class='reserved'>else</strong>
<a id='L23926' name='L23926'></a> 23926                         inev.ie.kind = <a href='../S/2231.html#L85' title='Defined at 85 in src/termhooks.h.'>MULTIBYTE_CHAR_KEYSTROKE_EVENT</a>;
<a id='L23927' name='L23927'></a> 23927 
<a id='L23928' name='L23928'></a> 23928                       <strong class='reserved'>if</strong> (source)
<a id='L23929' name='L23929'></a> 23929                         inev.ie.device = source-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>;
<a id='L23930' name='L23930'></a> 23930 
<a id='L23931' name='L23931'></a> 23931                       inev.ie.code = keysym &amp; 0xFFFFFF;
<a id='L23932' name='L23932'></a> 23932                       <strong class='reserved'>goto</strong> xi_done_keysym;
<a id='L23933' name='L23933'></a> 23933                     <em class='brace'>}</em>
<a id='L23934' name='L23934'></a> 23934 
<a id='L23935' name='L23935'></a> 23935                   <em class='comment'>/* Now non-ASCII.  */</em>
<a id='L23936' name='L23936'></a> 23936                   <strong class='reserved'>if</strong> (<a href='../D/2996.html' title='Multiple defined in 2 places.'>HASH_TABLE_P</a> (Vx_keysym_table)
<a id='L23937' name='L23937'></a> 23937                       &amp;&amp; (<a href='../D/9440.html' title='Multiple defined in 2 places.'>c</a> = Fgethash (<a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (keysym),
<a id='L23938' name='L23938'></a> 23938                                         Vx_keysym_table,
<a id='L23939' name='L23939'></a> 23939                                         Qnil),
<a id='L23940' name='L23940'></a> 23940                           <a href='../S/2267.html#L3006' title='Defined at 3006 in src/lisp.h.'>FIXNATP</a> (<a href='../D/9440.html' title='Multiple defined in 2 places.'>c</a>)))
<a id='L23941' name='L23941'></a> 23941                     <em class='brace'>{</em>
<a id='L23942' name='L23942'></a> 23942                       inev.ie.kind = (<a href='../S/2218.html#L98' title='Defined at 98 in src/character.h.'>SINGLE_BYTE_CHAR_P</a> (<a href='../S/2267.html#L3013' title='Defined at 3013 in src/lisp.h.'>XFIXNAT</a> (<a href='../D/9440.html' title='Multiple defined in 2 places.'>c</a>))
<a id='L23943' name='L23943'></a> 23943                                       ? <a href='../S/2231.html#L77' title='Defined at 77 in src/termhooks.h.'>ASCII_KEYSTROKE_EVENT</a>
<a id='L23944' name='L23944'></a> 23944                                       : <a href='../S/2231.html#L85' title='Defined at 85 in src/termhooks.h.'>MULTIBYTE_CHAR_KEYSTROKE_EVENT</a>);
<a id='L23945' name='L23945'></a> 23945                       inev.ie.code = <a href='../S/2267.html#L3013' title='Defined at 3013 in src/lisp.h.'>XFIXNAT</a> (<a href='../D/9440.html' title='Multiple defined in 2 places.'>c</a>);
<a id='L23946' name='L23946'></a> 23946 
<a id='L23947' name='L23947'></a> 23947                       <strong class='reserved'>if</strong> (source)
<a id='L23948' name='L23948'></a> 23948                         inev.ie.device = source-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>;
<a id='L23949' name='L23949'></a> 23949 
<a id='L23950' name='L23950'></a> 23950                       <strong class='reserved'>goto</strong> xi_done_keysym;
<a id='L23951' name='L23951'></a> 23951                     <em class='brace'>}</em>
<a id='L23952' name='L23952'></a> 23952 
<a id='L23953' name='L23953'></a> 23953                   <em class='comment'>/* Random non-modifier sorts of keysyms.  */</em>
<a id='L23954' name='L23954'></a> 23954                   <strong class='reserved'>if</strong> (((keysym &gt;= XK_BackSpace &amp;&amp; keysym &lt;= XK_Escape)
<a id='L23955' name='L23955'></a> 23955                        || keysym == XK_Delete
<a id='L23956' name='L23956'></a> 23956 <em class='sharp'>#ifdef</em> XK_ISO_Left_Tab
<a id='L23957' name='L23957'></a> 23957                        || (keysym &gt;= XK_ISO_Left_Tab
<a id='L23958' name='L23958'></a> 23958                            &amp;&amp; keysym &lt;= XK_ISO_Enter)
<a id='L23959' name='L23959'></a> 23959 <em class='sharp'>#endif</em>
<a id='L23960' name='L23960'></a> 23960                        || <a href='../S/2355.html#L5115' title='Defined at 5115 in src/pgtkterm.c.'>IsCursorKey</a> (keysym) <em class='comment'>/* 0xff50 &lt;= x &lt; 0xff60 */</em>
<a id='L23961' name='L23961'></a> 23961                        || <a href='../S/2355.html#L5116' title='Defined at 5116 in src/pgtkterm.c.'>IsMiscFunctionKey</a> (keysym) <em class='comment'>/* 0xff60 &lt;= x &lt; VARIES */</em>
<a id='L23962' name='L23962'></a> 23962 <em class='sharp'>#ifdef</em> HPUX
<a id='L23963' name='L23963'></a> 23963                        <em class='comment'>/* This recognizes the "extended function</em>
<a id='L23964' name='L23964'></a> 23964 <em class='comment'>                          keys".  It seems there's no cleaner way.</em>
<a id='L23965' name='L23965'></a> 23965 <em class='comment'>                          Test IsModifierKey to avoid handling</em>
<a id='L23966' name='L23966'></a> 23966 <em class='comment'>                          mode_switch incorrectly.  */</em>
<a id='L23967' name='L23967'></a> 23967                        || (XK_Select &lt;= keysym &amp;&amp; keysym &lt; XK_KP_Space)
<a id='L23968' name='L23968'></a> 23968 <em class='sharp'>#endif</em>
<a id='L23969' name='L23969'></a> 23969 <em class='sharp'>#ifdef</em> XK_dead_circumflex
<a id='L23970' name='L23970'></a> 23970                        || keysym == XK_dead_circumflex
<a id='L23971' name='L23971'></a> 23971 <em class='sharp'>#endif</em>
<a id='L23972' name='L23972'></a> 23972 <em class='sharp'>#ifdef</em> XK_dead_grave
<a id='L23973' name='L23973'></a> 23973                        || keysym == XK_dead_grave
<a id='L23974' name='L23974'></a> 23974 <em class='sharp'>#endif</em>
<a id='L23975' name='L23975'></a> 23975 <em class='sharp'>#ifdef</em> XK_dead_tilde
<a id='L23976' name='L23976'></a> 23976                        || keysym == XK_dead_tilde
<a id='L23977' name='L23977'></a> 23977 <em class='sharp'>#endif</em>
<a id='L23978' name='L23978'></a> 23978 <em class='sharp'>#ifdef</em> XK_dead_diaeresis
<a id='L23979' name='L23979'></a> 23979                        || keysym == XK_dead_diaeresis
<a id='L23980' name='L23980'></a> 23980 <em class='sharp'>#endif</em>
<a id='L23981' name='L23981'></a> 23981 <em class='sharp'>#ifdef</em> XK_dead_macron
<a id='L23982' name='L23982'></a> 23982                        || keysym == XK_dead_macron
<a id='L23983' name='L23983'></a> 23983 <em class='sharp'>#endif</em>
<a id='L23984' name='L23984'></a> 23984 <em class='sharp'>#ifdef</em> XK_dead_degree
<a id='L23985' name='L23985'></a> 23985                        || keysym == XK_dead_degree
<a id='L23986' name='L23986'></a> 23986 <em class='sharp'>#endif</em>
<a id='L23987' name='L23987'></a> 23987 <em class='sharp'>#ifdef</em> XK_dead_acute
<a id='L23988' name='L23988'></a> 23988                        || keysym == XK_dead_acute
<a id='L23989' name='L23989'></a> 23989 <em class='sharp'>#endif</em>
<a id='L23990' name='L23990'></a> 23990 <em class='sharp'>#ifdef</em> XK_dead_cedilla
<a id='L23991' name='L23991'></a> 23991                        || keysym == XK_dead_cedilla
<a id='L23992' name='L23992'></a> 23992 <em class='sharp'>#endif</em>
<a id='L23993' name='L23993'></a> 23993 <em class='sharp'>#ifdef</em> XK_dead_breve
<a id='L23994' name='L23994'></a> 23994                        || keysym == XK_dead_breve
<a id='L23995' name='L23995'></a> 23995 <em class='sharp'>#endif</em>
<a id='L23996' name='L23996'></a> 23996 <em class='sharp'>#ifdef</em> XK_dead_ogonek
<a id='L23997' name='L23997'></a> 23997                        || keysym == XK_dead_ogonek
<a id='L23998' name='L23998'></a> 23998 <em class='sharp'>#endif</em>
<a id='L23999' name='L23999'></a> 23999 <em class='sharp'>#ifdef</em> XK_dead_caron
<a id='L24000' name='L24000'></a> 24000                        || keysym == XK_dead_caron
<a id='L24001' name='L24001'></a> 24001 <em class='sharp'>#endif</em>
<a id='L24002' name='L24002'></a> 24002 <em class='sharp'>#ifdef</em> XK_dead_doubleacute
<a id='L24003' name='L24003'></a> 24003                        || keysym == XK_dead_doubleacute
<a id='L24004' name='L24004'></a> 24004 <em class='sharp'>#endif</em>
<a id='L24005' name='L24005'></a> 24005 <em class='sharp'>#ifdef</em> XK_dead_abovedot
<a id='L24006' name='L24006'></a> 24006                        || keysym == XK_dead_abovedot
<a id='L24007' name='L24007'></a> 24007 <em class='sharp'>#endif</em>
<a id='L24008' name='L24008'></a> 24008 <em class='sharp'>#ifdef</em> XK_dead_abovering
<a id='L24009' name='L24009'></a> 24009                        || keysym == XK_dead_abovering
<a id='L24010' name='L24010'></a> 24010 <em class='sharp'>#endif</em>
<a id='L24011' name='L24011'></a> 24011 <em class='sharp'>#ifdef</em> XK_dead_belowdot
<a id='L24012' name='L24012'></a> 24012                        || keysym == XK_dead_belowdot
<a id='L24013' name='L24013'></a> 24013 <em class='sharp'>#endif</em>
<a id='L24014' name='L24014'></a> 24014 <em class='sharp'>#ifdef</em> XK_dead_voiced_sound
<a id='L24015' name='L24015'></a> 24015                        || keysym == XK_dead_voiced_sound
<a id='L24016' name='L24016'></a> 24016 <em class='sharp'>#endif</em>
<a id='L24017' name='L24017'></a> 24017 <em class='sharp'>#ifdef</em> XK_dead_semivoiced_sound
<a id='L24018' name='L24018'></a> 24018                        || keysym == XK_dead_semivoiced_sound
<a id='L24019' name='L24019'></a> 24019 <em class='sharp'>#endif</em>
<a id='L24020' name='L24020'></a> 24020 <em class='sharp'>#ifdef</em> XK_dead_hook
<a id='L24021' name='L24021'></a> 24021                        || keysym == XK_dead_hook
<a id='L24022' name='L24022'></a> 24022 <em class='sharp'>#endif</em>
<a id='L24023' name='L24023'></a> 24023 <em class='sharp'>#ifdef</em> XK_dead_horn
<a id='L24024' name='L24024'></a> 24024                        || keysym == XK_dead_horn
<a id='L24025' name='L24025'></a> 24025 <em class='sharp'>#endif</em>
<a id='L24026' name='L24026'></a> 24026 <em class='sharp'>#ifdef</em> XK_dead_stroke
<a id='L24027' name='L24027'></a> 24027                        || keysym == XK_dead_stroke
<a id='L24028' name='L24028'></a> 24028 <em class='sharp'>#endif</em>
<a id='L24029' name='L24029'></a> 24029 <em class='sharp'>#ifdef</em> XK_dead_abovecomma
<a id='L24030' name='L24030'></a> 24030                        || keysym == XK_dead_abovecomma
<a id='L24031' name='L24031'></a> 24031 <em class='sharp'>#endif</em>
<a id='L24032' name='L24032'></a> 24032                        || <a href='../S/2355.html#L5117' title='Defined at 5117 in src/pgtkterm.c.'>IsKeypadKey</a> (keysym) <em class='comment'>/* 0xff80 &lt;= x &lt; 0xffbe */</em>
<a id='L24033' name='L24033'></a> 24033                        || <a href='../S/2355.html#L5118' title='Defined at 5118 in src/pgtkterm.c.'>IsFunctionKey</a> (keysym) <em class='comment'>/* 0xffbe &lt;= x &lt; 0xffe1 */</em>
<a id='L24034' name='L24034'></a> 24034                        <em class='comment'>/* Any "vendor-specific" key is ok.  */</em>
<a id='L24035' name='L24035'></a> 24035                        || (keysym &amp; (1 &lt;&lt; 28))
<a id='L24036' name='L24036'></a> 24036                        || (keysym != NoSymbol &amp;&amp; nbytes == 0))
<a id='L24037' name='L24037'></a> 24037                       &amp;&amp; ! (<a href='../S/2355.html#L5119' title='Defined at 5119 in src/pgtkterm.c.'>IsModifierKey</a> (keysym)
<a id='L24038' name='L24038'></a> 24038                             <em class='comment'>/* The symbols from XK_ISO_Lock</em>
<a id='L24039' name='L24039'></a> 24039 <em class='comment'>                               to XK_ISO_Last_Group_Lock</em>
<a id='L24040' name='L24040'></a> 24040 <em class='comment'>                               don't have real modifiers but</em>
<a id='L24041' name='L24041'></a> 24041 <em class='comment'>                               should be treated similarly to</em>
<a id='L24042' name='L24042'></a> 24042 <em class='comment'>                               Mode_switch by Emacs. */</em>
<a id='L24043' name='L24043'></a> 24043 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> XK_ISO_Lock &amp;&amp; <strong class='reserved'>defined</strong> XK_ISO_Last_Group_Lock
<a id='L24044' name='L24044'></a> 24044                             || (XK_ISO_Lock &lt;= keysym
<a id='L24045' name='L24045'></a> 24045                                 &amp;&amp; keysym &lt;= XK_ISO_Last_Group_Lock)
<a id='L24046' name='L24046'></a> 24046 <em class='sharp'>#endif</em>
<a id='L24047' name='L24047'></a> 24047                             ))
<a id='L24048' name='L24048'></a> 24048                     <em class='brace'>{</em>
<a id='L24049' name='L24049'></a> 24049                       <a href='../D/5961.html' title='Multiple defined in 2 places.'>STORE_KEYSYM_FOR_DEBUG</a> (keysym);
<a id='L24050' name='L24050'></a> 24050                       <em class='comment'>/* make_lispy_event will convert this to a symbolic</em>
<a id='L24051' name='L24051'></a> 24051 <em class='comment'>                         key.  */</em>
<a id='L24052' name='L24052'></a> 24052                       inev.ie.kind = <a href='../S/2231.html#L108' title='Defined at 108 in src/termhooks.h.'>NON_ASCII_KEYSTROKE_EVENT</a>;
<a id='L24053' name='L24053'></a> 24053                       inev.ie.code = keysym;
<a id='L24054' name='L24054'></a> 24054 
<a id='L24055' name='L24055'></a> 24055                       <strong class='reserved'>if</strong> (source)
<a id='L24056' name='L24056'></a> 24056                         inev.ie.device = source-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>;
<a id='L24057' name='L24057'></a> 24057 
<a id='L24058' name='L24058'></a> 24058                       <strong class='reserved'>goto</strong> xi_done_keysym;
<a id='L24059' name='L24059'></a> 24059                     <em class='brace'>}</em>
<a id='L24060' name='L24060'></a> 24060 
<a id='L24061' name='L24061'></a> 24061                   <strong class='reserved'>for</strong> (i = 0; i &lt; nbytes; i++)
<a id='L24062' name='L24062'></a> 24062                     <em class='brace'>{</em>
<a id='L24063' name='L24063'></a> 24063                       <a href='../D/5961.html' title='Multiple defined in 2 places.'>STORE_KEYSYM_FOR_DEBUG</a> (copy_bufptr[i]);
<a id='L24064' name='L24064'></a> 24064                     <em class='brace'>}</em>
<a id='L24065' name='L24065'></a> 24065 
<a id='L24066' name='L24066'></a> 24066                   <strong class='reserved'>if</strong> (nbytes)
<a id='L24067' name='L24067'></a> 24067                     <em class='brace'>{</em>
<a id='L24068' name='L24068'></a> 24068                       inev.ie.kind = <a href='../S/2231.html#L85' title='Defined at 85 in src/termhooks.h.'>MULTIBYTE_CHAR_KEYSTROKE_EVENT</a>;
<a id='L24069' name='L24069'></a> 24069                       inev.ie.arg = <a href='../S/2350.html#L2504' title='Defined at 2504 in src/alloc.c.'>make_unibyte_string</a> (copy_bufptr, nbytes);
<a id='L24070' name='L24070'></a> 24070 
<a id='L24071' name='L24071'></a> 24071                       Fput_text_property (<a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (0), <a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (nbytes),
<a id='L24072' name='L24072'></a> 24072                                           Qcoding, coding, inev.ie.arg);
<a id='L24073' name='L24073'></a> 24073 
<a id='L24074' name='L24074'></a> 24074                       <strong class='reserved'>if</strong> (source)
<a id='L24075' name='L24075'></a> 24075                         inev.ie.device = source-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>;
<a id='L24076' name='L24076'></a> 24076                     <em class='brace'>}</em>
<a id='L24077' name='L24077'></a> 24077                   <strong class='reserved'>goto</strong> xi_done_keysym;
<a id='L24078' name='L24078'></a> 24078                 <em class='brace'>}</em>
<a id='L24079' name='L24079'></a> 24079 
<a id='L24080' name='L24080'></a> 24080               <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L24081' name='L24081'></a> 24081             <em class='brace'>}</em>
<a id='L24082' name='L24082'></a> 24082 
<a id='L24083' name='L24083'></a> 24083 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> USE_GTK &amp;&amp; !<strong class='reserved'>defined</strong> HAVE_GTK3
<a id='L24084' name='L24084'></a> 24084           <strong class='reserved'>case</strong> XI_RawKeyPress:
<a id='L24085' name='L24085'></a> 24085             <em class='brace'>{</em>
<a id='L24086' name='L24086'></a> 24086               XIRawEvent *raw_event = (XIRawEvent *) xi_event;
<a id='L24087' name='L24087'></a> 24087 
<a id='L24088' name='L24088'></a> 24088               <em class='comment'>/* This is the only way to attribute core keyboard</em>
<a id='L24089' name='L24089'></a> 24089 <em class='comment'>                 events generated on GTK+ 2.x to the extension device</em>
<a id='L24090' name='L24090'></a> 24090 <em class='comment'>                 that generated them.  */</em>
<a id='L24091' name='L24091'></a> 24091               dpyinfo-&gt;pending_keystroke_time = raw_event-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L24092' name='L24092'></a> 24092               dpyinfo-&gt;pending_keystroke_source = raw_event-&gt;sourceid;
<a id='L24093' name='L24093'></a> 24093               dpyinfo-&gt;pending_keystroke_time_special_p = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L24094' name='L24094'></a> 24094               <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L24095' name='L24095'></a> 24095             <em class='brace'>}</em>
<a id='L24096' name='L24096'></a> 24096 <em class='sharp'>#endif</em>
<a id='L24097' name='L24097'></a> 24097 
<a id='L24098' name='L24098'></a> 24098           <strong class='reserved'>case</strong> XI_KeyRelease:
<a id='L24099' name='L24099'></a> 24099 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_X_I18N || <strong class='reserved'>defined</strong> USE_GTK || <strong class='reserved'>defined</strong> USE_LUCID
<a id='L24100' name='L24100'></a> 24100             <em class='brace'>{</em>
<a id='L24101' name='L24101'></a> 24101               XKeyPressedEvent xkey;
<a id='L24102' name='L24102'></a> 24102 
<a id='L24103' name='L24103'></a> 24103               memset (&amp;xkey, 0, <strong class='reserved'>sizeof</strong> xkey);
<a id='L24104' name='L24104'></a> 24104 
<a id='L24105' name='L24105'></a> 24105               xkey.type = KeyRelease;
<a id='L24106' name='L24106'></a> 24106               xkey.serial = xev-&gt;serial;
<a id='L24107' name='L24107'></a> 24107               xkey.send_event = xev-&gt;send_event;
<a id='L24108' name='L24108'></a> 24108               xkey.<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> = dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>;
<a id='L24109' name='L24109'></a> 24109               xkey.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = xev-&gt;event;
<a id='L24110' name='L24110'></a> 24110               xkey.root = xev-&gt;root;
<a id='L24111' name='L24111'></a> 24111               xkey.subwindow = xev-&gt;child;
<a id='L24112' name='L24112'></a> 24112               xkey.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> = xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L24113' name='L24113'></a> 24113               xkey.state = <a href='../S/2289.html#L5347' title='Defined at 5347 in src/xterm.c.'>xi_convert_event_keyboard_state</a> (xev);
<a id='L24114' name='L24114'></a> 24114               xkey.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = lrint (xev-&gt;event_x);
<a id='L24115' name='L24115'></a> 24115               xkey.y = lrint (xev-&gt;event_y);
<a id='L24116' name='L24116'></a> 24116               xkey.x_root = lrint (xev-&gt;root_x);
<a id='L24117' name='L24117'></a> 24117               xkey.y_root = lrint (xev-&gt;root_y);
<a id='L24118' name='L24118'></a> 24118 
<a id='L24119' name='L24119'></a> 24119               <em class='comment'>/* Some input methods react differently depending on the</em>
<a id='L24120' name='L24120'></a> 24120 <em class='comment'>                 buttons that are pressed.  */</em>
<a id='L24121' name='L24121'></a> 24121               <a href='../S/2289.html#L5308' title='Defined at 5308 in src/xterm.c.'>xi_convert_button_state</a> (&amp;xev-&gt;buttons, &amp;xkey.state);
<a id='L24122' name='L24122'></a> 24122 
<a id='L24123' name='L24123'></a> 24123               xkey.keycode = xev-&gt;detail;
<a id='L24124' name='L24124'></a> 24124               xkey.same_screen = True;
<a id='L24125' name='L24125'></a> 24125 
<a id='L24126' name='L24126'></a> 24126 <em class='sharp'>#ifdef</em> USE_LUCID
<a id='L24127' name='L24127'></a> 24127               <strong class='reserved'>if</strong> (!<a href='../D/15672.html' title='Multiple defined in 5 places.'>popup_activated</a> ())
<a id='L24128' name='L24128'></a> 24128                 <em class='brace'>{</em>
<a id='L24129' name='L24129'></a> 24129 <em class='sharp'>#endif</em>
<a id='L24130' name='L24130'></a> 24130 <em class='sharp'>#ifdef</em> HAVE_X_I18N
<a id='L24131' name='L24131'></a> 24131                   <strong class='reserved'>if</strong> (x_filter_event (dpyinfo, (XEvent *) &amp;xkey))
<a id='L24132' name='L24132'></a> 24132                     *finish = <a href='../S/2289.html#L1136' title='Defined at 1136 in src/xterm.c.'>X_EVENT_DROP</a>;
<a id='L24133' name='L24133'></a> 24133 <em class='sharp'>#elif</em> <strong class='reserved'>defined</strong> USE_GTK
<a id='L24134' name='L24134'></a> 24134                   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../D/19416.html' title='Multiple defined in 2 places.'>x_any_window_to_frame</a> (xkey-&gt;event);
<a id='L24135' name='L24135'></a> 24135 
<a id='L24136' name='L24136'></a> 24136                   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; <a href='../S/2362.html#L6561' title='Defined at 6561 in src/gtkutil.c.'>xg_filter_key</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, event))
<a id='L24137' name='L24137'></a> 24137                     *finish = <a href='../S/2289.html#L1136' title='Defined at 1136 in src/xterm.c.'>X_EVENT_DROP</a>;
<a id='L24138' name='L24138'></a> 24138 <em class='sharp'>#endif</em>
<a id='L24139' name='L24139'></a> 24139 <em class='sharp'>#ifdef</em> USE_LUCID
<a id='L24140' name='L24140'></a> 24140                 <em class='brace'>}</em>
<a id='L24141' name='L24141'></a> 24141               <strong class='reserved'>else</strong>
<a id='L24142' name='L24142'></a> 24142                 <em class='brace'>{</em>
<a id='L24143' name='L24143'></a> 24143                   <em class='comment'>/* FIXME: the Lucid menu bar pops down upon any key</em>
<a id='L24144' name='L24144'></a> 24144 <em class='comment'>                     release event, so we don't dispatch these events</em>
<a id='L24145' name='L24145'></a> 24145 <em class='comment'>                     at all, which doesn't seem to be the right</em>
<a id='L24146' name='L24146'></a> 24146 <em class='comment'>                     solution.</em>
<a id='L24147' name='L24147'></a> 24147 <em class='comment'></em>
<a id='L24148' name='L24148'></a> 24148 <em class='comment'>                     use_copy = true;</em>
<a id='L24149' name='L24149'></a> 24149 <em class='comment'>                     copy.xkey = xkey; */</em>
<a id='L24150' name='L24150'></a> 24150                 <em class='brace'>}</em>
<a id='L24151' name='L24151'></a> 24151 <em class='sharp'>#endif</em>
<a id='L24152' name='L24152'></a> 24152             <em class='brace'>}</em>
<a id='L24153' name='L24153'></a> 24153 <em class='sharp'>#endif</em>
<a id='L24154' name='L24154'></a> 24154 
<a id='L24155' name='L24155'></a> 24155             <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L24156' name='L24156'></a> 24156 
<a id='L24157' name='L24157'></a> 24157           <strong class='reserved'>case</strong> XI_PropertyEvent:
<a id='L24158' name='L24158'></a> 24158             <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L24159' name='L24159'></a> 24159 
<a id='L24160' name='L24160'></a> 24160           <strong class='reserved'>case</strong> XI_HierarchyChanged:
<a id='L24161' name='L24161'></a> 24161             <em class='brace'>{</em>
<a id='L24162' name='L24162'></a> 24162               XIHierarchyEvent *hev;
<a id='L24163' name='L24163'></a> 24163               XIDeviceInfo *<a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a>;
<a id='L24164' name='L24164'></a> 24164               <strong class='reserved'>int</strong> i, ndevices, n_disabled, *disabled;
<a id='L24165' name='L24165'></a> 24165               <strong class='reserved'>struct</strong> <a href='../S/2212.html#L275' title='Defined at 275 in src/xterm.h.'>xi_device_t</a> *device;
<a id='L24166' name='L24166'></a> 24166               <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> any_changed;
<a id='L24167' name='L24167'></a> 24167 
<a id='L24168' name='L24168'></a> 24168               any_changed = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L24169' name='L24169'></a> 24169               hev = (XIHierarchyEvent *) xi_event;
<a id='L24170' name='L24170'></a> 24170               disabled = <a href='../D/5389.html' title='Multiple defined in 2 places.'>SAFE_ALLOCA</a> (<strong class='reserved'>sizeof</strong> *disabled * hev-&gt;num_info);
<a id='L24171' name='L24171'></a> 24171               n_disabled = 0;
<a id='L24172' name='L24172'></a> 24172 
<a id='L24173' name='L24173'></a> 24173               <strong class='reserved'>for</strong> (i = 0; i &lt; hev-&gt;num_info; ++i)
<a id='L24174' name='L24174'></a> 24174                 <em class='brace'>{</em>
<a id='L24175' name='L24175'></a> 24175                   <strong class='reserved'>if</strong> (hev-&gt;<a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a>[i].flags &amp; XIDeviceEnabled)
<a id='L24176' name='L24176'></a> 24176                     <em class='brace'>{</em>
<a id='L24177' name='L24177'></a> 24177                       <em class='comment'>/* Handle all disabled devices now, to prevent</em>
<a id='L24178' name='L24178'></a> 24178 <em class='comment'>                         things happening out-of-order later.  */</em>
<a id='L24179' name='L24179'></a> 24179 
<a id='L24180' name='L24180'></a> 24180                       <strong class='reserved'>if</strong> (n_disabled)
<a id='L24181' name='L24181'></a> 24181                         <em class='brace'>{</em>
<a id='L24182' name='L24182'></a> 24182                           xi_disable_devices (dpyinfo, disabled, n_disabled);
<a id='L24183' name='L24183'></a> 24183                           n_disabled = 0;
<a id='L24184' name='L24184'></a> 24184 
<a id='L24185' name='L24185'></a> 24185                           <em class='comment'>/* This flag really just means that disabled</em>
<a id='L24186' name='L24186'></a> 24186 <em class='comment'>                             devices were handled early and should be</em>
<a id='L24187' name='L24187'></a> 24187 <em class='comment'>                             used in conjunction with n_disabled.  */</em>
<a id='L24188' name='L24188'></a> 24188                           any_changed = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L24189' name='L24189'></a> 24189                         <em class='brace'>}</em>
<a id='L24190' name='L24190'></a> 24190 
<a id='L24191' name='L24191'></a> 24191                       <em class='comment'>/* Under unknown circumstances, multiple</em>
<a id='L24192' name='L24192'></a> 24192 <em class='comment'>                         XIDeviceEnabled events are sent at once,</em>
<a id='L24193' name='L24193'></a> 24193 <em class='comment'>                         causing the device to be duplicated.  Check</em>
<a id='L24194' name='L24194'></a> 24194 <em class='comment'>                         that the device doesn't exist before adding</em>
<a id='L24195' name='L24195'></a> 24195 <em class='comment'>                         it.  */</em>
<a id='L24196' name='L24196'></a> 24196 
<a id='L24197' name='L24197'></a> 24197                       <strong class='reserved'>if</strong> (!<a href='../S/2289.html#L5732' title='Defined at 5732 in src/xterm.c.'>xi_device_from_id</a> (dpyinfo,
<a id='L24198' name='L24198'></a> 24198                                               hev-&gt;<a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a>[i].deviceid))
<a id='L24199' name='L24199'></a> 24199                         <em class='brace'>{</em>
<a id='L24200' name='L24200'></a> 24200                           x_catch_errors (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L24201' name='L24201'></a> 24201                           <a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a> = XIQueryDevice (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L24202' name='L24202'></a> 24202                                                 hev-&gt;<a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a>[i].deviceid,
<a id='L24203' name='L24203'></a> 24203                                                 &amp;ndevices);
<a id='L24204' name='L24204'></a> 24204                           x_uncatch_errors ();
<a id='L24205' name='L24205'></a> 24205 
<a id='L24206' name='L24206'></a> 24206                           <strong class='reserved'>if</strong> (<a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a> &amp;&amp; <a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a>-&gt;enabled)
<a id='L24207' name='L24207'></a> 24207                             <em class='brace'>{</em>
<a id='L24208' name='L24208'></a> 24208                               dpyinfo-&gt;devices
<a id='L24209' name='L24209'></a> 24209                                 = <a href='../D/20107.html' title='Multiple defined in 7 places.'>xrealloc</a> (dpyinfo-&gt;devices,
<a id='L24210' name='L24210'></a> 24210                                             (<strong class='reserved'>sizeof</strong> *dpyinfo-&gt;devices
<a id='L24211' name='L24211'></a> 24211                                              * ++dpyinfo-&gt;num_devices));
<a id='L24212' name='L24212'></a> 24212                               memset (dpyinfo-&gt;devices + dpyinfo-&gt;num_devices - 1,
<a id='L24213' name='L24213'></a> 24213                                       0, <strong class='reserved'>sizeof</strong> *dpyinfo-&gt;devices);
<a id='L24214' name='L24214'></a> 24214                               device = &amp;dpyinfo-&gt;devices[dpyinfo-&gt;num_devices - 1];
<a id='L24215' name='L24215'></a> 24215                               <a href='../S/2289.html#L5447' title='Defined at 5447 in src/xterm.c.'>xi_populate_device_from_info</a> (dpyinfo, device, <a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a>);
<a id='L24216' name='L24216'></a> 24216                             <em class='brace'>}</em>
<a id='L24217' name='L24217'></a> 24217 
<a id='L24218' name='L24218'></a> 24218                           <strong class='reserved'>if</strong> (<a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a>)
<a id='L24219' name='L24219'></a> 24219                             XIFreeDeviceInfo (<a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a>);
<a id='L24220' name='L24220'></a> 24220                         <em class='brace'>}</em>
<a id='L24221' name='L24221'></a> 24221                     <em class='brace'>}</em>
<a id='L24222' name='L24222'></a> 24222                   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (hev-&gt;<a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a>[i].flags &amp; XIDeviceDisabled)
<a id='L24223' name='L24223'></a> 24223                     disabled[n_disabled++] = hev-&gt;<a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a>[i].deviceid;
<a id='L24224' name='L24224'></a> 24224                   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (hev-&gt;<a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a>[i].flags &amp; XISlaveDetached
<a id='L24225' name='L24225'></a> 24225                            || hev-&gt;<a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a>[i].flags &amp; XISlaveAttached)
<a id='L24226' name='L24226'></a> 24226                     <em class='brace'>{</em>
<a id='L24227' name='L24227'></a> 24227                       device = <a href='../S/2289.html#L5732' title='Defined at 5732 in src/xterm.c.'>xi_device_from_id</a> (dpyinfo, hev-&gt;<a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a>[i].deviceid);
<a id='L24228' name='L24228'></a> 24228                       x_catch_errors (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L24229' name='L24229'></a> 24229                       <a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a> = XIQueryDevice (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, hev-&gt;<a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a>[i].deviceid,
<a id='L24230' name='L24230'></a> 24230                                             &amp;ndevices);
<a id='L24231' name='L24231'></a> 24231                       x_uncatch_errors ();
<a id='L24232' name='L24232'></a> 24232 
<a id='L24233' name='L24233'></a> 24233                       <strong class='reserved'>if</strong> (<a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a>)
<a id='L24234' name='L24234'></a> 24234                         <em class='brace'>{</em>
<a id='L24235' name='L24235'></a> 24235                           <strong class='reserved'>if</strong> (device)
<a id='L24236' name='L24236'></a> 24236                             <em class='brace'>{</em>
<a id='L24237' name='L24237'></a> 24237                               device-&gt;use = <a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a>-&gt;use;
<a id='L24238' name='L24238'></a> 24238                               device-&gt;attachment = <a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a>-&gt;attachment;
<a id='L24239' name='L24239'></a> 24239                             <em class='brace'>}</em>
<a id='L24240' name='L24240'></a> 24240 
<a id='L24241' name='L24241'></a> 24241                           <em class='comment'>/* device could have been disabled by now.</em>
<a id='L24242' name='L24242'></a> 24242 <em class='comment'>                             But instead of removing it immediately,</em>
<a id='L24243' name='L24243'></a> 24243 <em class='comment'>                             wait for XIDeviceDisabled, or internal</em>
<a id='L24244' name='L24244'></a> 24244 <em class='comment'>                             state could be left inconsistent.  */</em>
<a id='L24245' name='L24245'></a> 24245 
<a id='L24246' name='L24246'></a> 24246                           XIFreeDeviceInfo (<a href='../D/13181.html' title='Multiple defined in 2 places.'>info</a>);
<a id='L24247' name='L24247'></a> 24247                         <em class='brace'>}</em>
<a id='L24248' name='L24248'></a> 24248                     <em class='brace'>}</em>
<a id='L24249' name='L24249'></a> 24249                 <em class='brace'>}</em>
<a id='L24250' name='L24250'></a> 24250 
<a id='L24251' name='L24251'></a> 24251               <em class='comment'>/* Delete all devices that were disabled by this</em>
<a id='L24252' name='L24252'></a> 24252 <em class='comment'>                 event.  */</em>
<a id='L24253' name='L24253'></a> 24253               xi_disable_devices (dpyinfo, disabled, n_disabled);
<a id='L24254' name='L24254'></a> 24254 
<a id='L24255' name='L24255'></a> 24255               <em class='comment'>/* If the device hierarchy has been changed, recompute</em>
<a id='L24256' name='L24256'></a> 24256 <em class='comment'>                 focus.  This might seem like a micro-optimization but</em>
<a id='L24257' name='L24257'></a> 24257 <em class='comment'>                 it actually keeps the focus from changing in some</em>
<a id='L24258' name='L24258'></a> 24258 <em class='comment'>                 cases where it would be undesierable.  */</em>
<a id='L24259' name='L24259'></a> 24259               <strong class='reserved'>if</strong> (any_changed || n_disabled)
<a id='L24260' name='L24260'></a> 24260                 xi_handle_focus_change (dpyinfo);
<a id='L24261' name='L24261'></a> 24261 
<a id='L24262' name='L24262'></a> 24262               <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L24263' name='L24263'></a> 24263             <em class='brace'>}</em>
<a id='L24264' name='L24264'></a> 24264 
<a id='L24265' name='L24265'></a> 24265           <strong class='reserved'>case</strong> XI_DeviceChanged:
<a id='L24266' name='L24266'></a> 24266             <em class='brace'>{</em>
<a id='L24267' name='L24267'></a> 24267               XIDeviceChangedEvent *device_changed;
<a id='L24268' name='L24268'></a> 24268               <strong class='reserved'>struct</strong> <a href='../S/2212.html#L275' title='Defined at 275 in src/xterm.h.'>xi_device_t</a> *device;
<a id='L24269' name='L24269'></a> 24269 
<a id='L24270' name='L24270'></a> 24270               device_changed = (XIDeviceChangedEvent *) xi_event;
<a id='L24271' name='L24271'></a> 24271               device = <a href='../S/2289.html#L5732' title='Defined at 5732 in src/xterm.c.'>xi_device_from_id</a> (dpyinfo, device_changed-&gt;deviceid);
<a id='L24272' name='L24272'></a> 24272 
<a id='L24273' name='L24273'></a> 24273               <em class='comment'>/* If the device isn't enabled, then stop handling this</em>
<a id='L24274' name='L24274'></a> 24274 <em class='comment'>                 event.  A HierarchyChanged event will be sent if it</em>
<a id='L24275' name='L24275'></a> 24275 <em class='comment'>                 is enabled afterwards.  */</em>
<a id='L24276' name='L24276'></a> 24276               <strong class='reserved'>if</strong> (!device)
<a id='L24277' name='L24277'></a> 24277                 <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L24278' name='L24278'></a> 24278 
<a id='L24279' name='L24279'></a> 24279               <em class='comment'>/* Now handle the event by retrieving scroll valuators</em>
<a id='L24280' name='L24280'></a> 24280 <em class='comment'>                 and touch info.  */</em>
<a id='L24281' name='L24281'></a> 24281               xi_handle_device_changed (dpyinfo, device, device_changed);
<a id='L24282' name='L24282'></a> 24282               <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L24283' name='L24283'></a> 24283             <em class='brace'>}</em>
<a id='L24284' name='L24284'></a> 24284 
<a id='L24285' name='L24285'></a> 24285 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L171' title='Defined at 171 in src/xterm.h.'>HAVE_XINPUT2_2</a>
<a id='L24286' name='L24286'></a> 24286           <strong class='reserved'>case</strong> XI_TouchBegin:
<a id='L24287' name='L24287'></a> 24287             <em class='brace'>{</em>
<a id='L24288' name='L24288'></a> 24288               <strong class='reserved'>struct</strong> <a href='../S/2212.html#L275' title='Defined at 275 in src/xterm.h.'>xi_device_t</a> *device, *source;
<a id='L24289' name='L24289'></a> 24289               <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> menu_bar_p = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>, tool_bar_p = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L24290' name='L24290'></a> 24290 <em class='sharp'>#ifdef</em> HAVE_GTK3
<a id='L24291' name='L24291'></a> 24291               GdkRectangle test_rect;
<a id='L24292' name='L24292'></a> 24292 <em class='sharp'>#endif</em>
<a id='L24293' name='L24293'></a> 24293               device = <a href='../S/2289.html#L5732' title='Defined at 5732 in src/xterm.c.'>xi_device_from_id</a> (dpyinfo, xev-&gt;deviceid);
<a id='L24294' name='L24294'></a> 24294               source = <a href='../S/2289.html#L5732' title='Defined at 5732 in src/xterm.c.'>xi_device_from_id</a> (dpyinfo, xev-&gt;sourceid);
<a id='L24295' name='L24295'></a> 24295               <a href='../S/2289.html#L7929' title='Defined at 7929 in src/xterm.c.'>x_display_set_last_user_time</a> (dpyinfo, xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>,
<a id='L24296' name='L24296'></a> 24296                                             xev-&gt;send_event, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L24297' name='L24297'></a> 24297 
<a id='L24298' name='L24298'></a> 24298               <strong class='reserved'>if</strong> (!device)
<a id='L24299' name='L24299'></a> 24299                 <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L24300' name='L24300'></a> 24300 
<a id='L24301' name='L24301'></a> 24301               <strong class='reserved'>if</strong> (<a href='../S/2289.html#L5817' title='Defined at 5817 in src/xterm.c.'>xi_find_touch_point</a> (device, xev-&gt;detail))
<a id='L24302' name='L24302'></a> 24302                 <a href='../D/10893.html' title='Multiple defined in 6 places.'>emacs_abort</a> ();
<a id='L24303' name='L24303'></a> 24303 
<a id='L24304' name='L24304'></a> 24304               <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2289.html#L11957' title='Defined at 11957 in src/xterm.c.'>x_window_to_frame</a> (dpyinfo, xev-&gt;event);
<a id='L24305' name='L24305'></a> 24305 
<a id='L24306' name='L24306'></a> 24306               <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L24307' name='L24307'></a> 24307                 <em class='comment'>/* See the comment above x_compute_root_window_offset</em>
<a id='L24308' name='L24308'></a> 24308 <em class='comment'>                   for why this optimization is performed.  */</em>
<a id='L24309' name='L24309'></a> 24309                 xi_compute_root_window_offset (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, xev);
<a id='L24310' name='L24310'></a> 24310 
<a id='L24311' name='L24311'></a> 24311 <em class='sharp'>#ifdef</em> HAVE_GTK3
<a id='L24312' name='L24312'></a> 24312               menu_bar_p = (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;menubar_widget
<a id='L24313' name='L24313'></a> 24313                             &amp;&amp; <a href='../S/2362.html#L4189' title='Defined at 4189 in src/gtkutil.c.'>xg_event_is_for_menubar</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, event));
<a id='L24314' name='L24314'></a> 24314               <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;toolbar_widget)
<a id='L24315' name='L24315'></a> 24315                 <em class='brace'>{</em>
<a id='L24316' name='L24316'></a> 24316                   <strong class='reserved'>int</strong> scale = <a href='../S/2362.html#L284' title='Defined at 284 in src/gtkutil.c.'>xg_get_scale</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L24317' name='L24317'></a> 24317 
<a id='L24318' name='L24318'></a> 24318                   test_rect.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = xev-&gt;event_x / scale;
<a id='L24319' name='L24319'></a> 24319                   test_rect.y = xev-&gt;event_y / scale;
<a id='L24320' name='L24320'></a> 24320                   test_rect.width = 1;
<a id='L24321' name='L24321'></a> 24321                   test_rect.height = 1;
<a id='L24322' name='L24322'></a> 24322 
<a id='L24323' name='L24323'></a> 24323                   tool_bar_p = gtk_widget_intersect (<a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;toolbar_widget,
<a id='L24324' name='L24324'></a> 24324                                                      &amp;test_rect, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L24325' name='L24325'></a> 24325                 <em class='brace'>}</em>
<a id='L24326' name='L24326'></a> 24326 <em class='sharp'>#endif</em>
<a id='L24327' name='L24327'></a> 24327 
<a id='L24328' name='L24328'></a> 24328 <em class='sharp'>#ifndef</em> <a href='../S/2267.html#L3724' title='Defined at 3724 in src/lisp.h.'>HAVE_EXT_TOOL_BAR</a>
<a id='L24329' name='L24329'></a> 24329               <em class='comment'>/* Is this a touch from a direct touch device that is in</em>
<a id='L24330' name='L24330'></a> 24330 <em class='comment'>                 the tool-bar?  */</em>
<a id='L24331' name='L24331'></a> 24331               <strong class='reserved'>if</strong> (device-&gt;direct_p
<a id='L24332' name='L24332'></a> 24332                   &amp;&amp; <a href='../D/6789.html' title='Multiple defined in 2 places.'>WINDOWP</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;tool_bar_window)
<a id='L24333' name='L24333'></a> 24333                   &amp;&amp; <a href='../S/2317.html#L657' title='Defined at 657 in src/window.h.'>WINDOW_TOTAL_LINES</a> (<a href='../D/7409.html' title='Multiple defined in 2 places.'>XWINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;tool_bar_window)))
<a id='L24334' name='L24334'></a> 24334                 <em class='brace'>{</em>
<a id='L24335' name='L24335'></a> 24335                   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>;
<a id='L24336' name='L24336'></a> 24336                   <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = xev-&gt;event_x;
<a id='L24337' name='L24337'></a> 24337                   <strong class='reserved'>int</strong> y = xev-&gt;event_y;
<a id='L24338' name='L24338'></a> 24338 
<a id='L24339' name='L24339'></a> 24339                   <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = <a href='../S/2108.html#L1682' title='Defined at 1682 in src/window.c.'>window_from_coordinates</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, 0, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L24340' name='L24340'></a> 24340                   <em class='comment'>/* Ignore button release events if the mouse</em>
<a id='L24341' name='L24341'></a> 24341 <em class='comment'>                     wasn't previously pressed on the tool bar.</em>
<a id='L24342' name='L24342'></a> 24342 <em class='comment'>                     We do this because otherwise selecting some</em>
<a id='L24343' name='L24343'></a> 24343 <em class='comment'>                     text with the mouse and then releasing it on</em>
<a id='L24344' name='L24344'></a> 24344 <em class='comment'>                     the tool bar doesn't stop selecting text,</em>
<a id='L24345' name='L24345'></a> 24345 <em class='comment'>                     since the tool bar eats the button up</em>
<a id='L24346' name='L24346'></a> 24346 <em class='comment'>                     event.  */</em>
<a id='L24347' name='L24347'></a> 24347                   tool_bar_p = <a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;tool_bar_window);
<a id='L24348' name='L24348'></a> 24348 
<a id='L24349' name='L24349'></a> 24349                   <em class='comment'>/* If this touch has started in the tool bar, do not</em>
<a id='L24350' name='L24350'></a> 24350 <em class='comment'>                     send it to Lisp.  Instead, simulate a tool bar</em>
<a id='L24351' name='L24351'></a> 24351 <em class='comment'>                     click, releasing it once it goes away.  */</em>
<a id='L24352' name='L24352'></a> 24352 
<a id='L24353' name='L24353'></a> 24353                   <strong class='reserved'>if</strong> (tool_bar_p)
<a id='L24354' name='L24354'></a> 24354                     <em class='brace'>{</em>
<a id='L24355' name='L24355'></a> 24355                       <em class='comment'>/* Call note_mouse_highlight on the tool bar</em>
<a id='L24356' name='L24356'></a> 24356 <em class='comment'>                         item.  Otherwise, get_tool_bar_item will</em>
<a id='L24357' name='L24357'></a> 24357 <em class='comment'>                         return 1.</em>
<a id='L24358' name='L24358'></a> 24358 <em class='comment'></em>
<a id='L24359' name='L24359'></a> 24359 <em class='comment'>                         This is not necessary when mouse-highlight is</em>
<a id='L24360' name='L24360'></a> 24360 <em class='comment'>                         nil.  */</em>
<a id='L24361' name='L24361'></a> 24361 
<a id='L24362' name='L24362'></a> 24362                       <strong class='reserved'>if</strong> (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (Vmouse_highlight))
<a id='L24363' name='L24363'></a> 24363                         <em class='brace'>{</em>
<a id='L24364' name='L24364'></a> 24364                           <a href='../S/2224.html#L35323' title='Defined at 35323 in src/xdisp.c.'>note_mouse_highlight</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y);
<a id='L24365' name='L24365'></a> 24365 
<a id='L24366' name='L24366'></a> 24366                           <em class='comment'>/* Always allow future mouse motion to</em>
<a id='L24367' name='L24367'></a> 24367 <em class='comment'>                             update the mouse highlight, no matter</em>
<a id='L24368' name='L24368'></a> 24368 <em class='comment'>                             where it is.  */</em>
<a id='L24369' name='L24369'></a> 24369                           memset (&amp;dpyinfo-&gt;last_mouse_glyph, 0,
<a id='L24370' name='L24370'></a> 24370                                   <strong class='reserved'>sizeof</strong> dpyinfo-&gt;last_mouse_glyph);
<a id='L24371' name='L24371'></a> 24371                           dpyinfo-&gt;last_mouse_glyph_frame = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L24372' name='L24372'></a> 24372                         <em class='brace'>}</em>
<a id='L24373' name='L24373'></a> 24373 
<a id='L24374' name='L24374'></a> 24374                       <a href='../S/2224.html#L15690' title='Defined at 15690 in src/xdisp.c.'>handle_tool_bar_click_with_device</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>, 0,
<a id='L24375' name='L24375'></a> 24375                                                          (source
<a id='L24376' name='L24376'></a> 24376                                                           ? source-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a> : Qt));
<a id='L24377' name='L24377'></a> 24377 
<a id='L24378' name='L24378'></a> 24378                       <em class='comment'>/* Flush any changes made by that to the front</em>
<a id='L24379' name='L24379'></a> 24379 <em class='comment'>                         buffer.  */</em>
<a id='L24380' name='L24380'></a> 24380                       x_flush_dirty_back_buffer_on (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L24381' name='L24381'></a> 24381 
<a id='L24382' name='L24382'></a> 24382                       <em class='comment'>/* Record the device and the touch ID on the</em>
<a id='L24383' name='L24383'></a> 24383 <em class='comment'>                         frame.  That way, Emacs knows when to dismiss</em>
<a id='L24384' name='L24384'></a> 24384 <em class='comment'>                         the tool bar click later.  */</em>
<a id='L24385' name='L24385'></a> 24385 
<a id='L24386' name='L24386'></a> 24386                       <a href='../D/2368.html' title='Multiple defined in 7 places.'>FRAME_OUTPUT_DATA</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;tool_bar_touch_device
<a id='L24387' name='L24387'></a> 24387                         = device-&gt;device_id;
<a id='L24388' name='L24388'></a> 24388                       <a href='../D/2368.html' title='Multiple defined in 7 places.'>FRAME_OUTPUT_DATA</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;tool_bar_touch_id = xev-&gt;detail;
<a id='L24389' name='L24389'></a> 24389 
<a id='L24390' name='L24390'></a> 24390                       <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L24391' name='L24391'></a> 24391                     <em class='brace'>}</em>
<a id='L24392' name='L24392'></a> 24392                 <em class='brace'>}</em>
<a id='L24393' name='L24393'></a> 24393 <em class='sharp'>#endif</em>
<a id='L24394' name='L24394'></a> 24394 
<a id='L24395' name='L24395'></a> 24395               <strong class='reserved'>if</strong> (!menu_bar_p &amp;&amp; !tool_bar_p)
<a id='L24396' name='L24396'></a> 24396                 <em class='brace'>{</em>
<a id='L24397' name='L24397'></a> 24397                   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; device-&gt;direct_p)
<a id='L24398' name='L24398'></a> 24398                     <em class='brace'>{</em>
<a id='L24399' name='L24399'></a> 24399                       *finish = <a href='../S/2289.html#L1136' title='Defined at 1136 in src/xterm.c.'>X_EVENT_DROP</a>;
<a id='L24400' name='L24400'></a> 24400 
<a id='L24401' name='L24401'></a> 24401                       x_catch_errors (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L24402' name='L24402'></a> 24402 
<a id='L24403' name='L24403'></a> 24403                       <strong class='reserved'>if</strong> (x_input_grab_touch_events)
<a id='L24404' name='L24404'></a> 24404                         XIAllowTouchEvents (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L24405' name='L24405'></a> 24405                                             xev-&gt;deviceid,
<a id='L24406' name='L24406'></a> 24406                                             xev-&gt;detail, xev-&gt;event,
<a id='L24407' name='L24407'></a> 24407                                             XIAcceptTouch);
<a id='L24408' name='L24408'></a> 24408 
<a id='L24409' name='L24409'></a> 24409                       <strong class='reserved'>if</strong> (!x_had_errors_p (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>))
<a id='L24410' name='L24410'></a> 24410                         <em class='brace'>{</em>
<a id='L24411' name='L24411'></a> 24411                           <a href='../S/2289.html#L5746' title='Defined at 5746 in src/xterm.c.'>xi_link_touch_point</a> (device, xev-&gt;detail,
<a id='L24412' name='L24412'></a> 24412                                                xev-&gt;event_x,
<a id='L24413' name='L24413'></a> 24413                                                xev-&gt;event_y, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L24414' name='L24414'></a> 24414 
<a id='L24415' name='L24415'></a> 24415                           inev.ie.kind = <a href='../S/2231.html#L314' title='Defined at 314 in src/termhooks.h.'>TOUCHSCREEN_BEGIN_EVENT</a>;
<a id='L24416' name='L24416'></a> 24416                           inev.ie.timestamp = xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L24417' name='L24417'></a> 24417                           <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (inev.ie.frame_or_window, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L24418' name='L24418'></a> 24418                           <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (inev.ie.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, lrint (xev-&gt;event_x));
<a id='L24419' name='L24419'></a> 24419                           <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (inev.ie.y, lrint (xev-&gt;event_y));
<a id='L24420' name='L24420'></a> 24420                           <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (inev.ie.arg, xev-&gt;detail);
<a id='L24421' name='L24421'></a> 24421 
<a id='L24422' name='L24422'></a> 24422                           <strong class='reserved'>if</strong> (source)
<a id='L24423' name='L24423'></a> 24423                             inev.ie.device = source-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>;
<a id='L24424' name='L24424'></a> 24424                         <em class='brace'>}</em>
<a id='L24425' name='L24425'></a> 24425 
<a id='L24426' name='L24426'></a> 24426                       x_uncatch_errors ();
<a id='L24427' name='L24427'></a> 24427                     <em class='brace'>}</em>
<a id='L24428' name='L24428'></a> 24428 <em class='sharp'>#ifndef</em> HAVE_GTK3
<a id='L24429' name='L24429'></a> 24429                   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (x_input_grab_touch_events)
<a id='L24430' name='L24430'></a> 24430                     <em class='brace'>{</em>
<a id='L24431' name='L24431'></a> 24431                       x_ignore_errors_for_next_request (dpyinfo, 0);
<a id='L24432' name='L24432'></a> 24432                       XIAllowTouchEvents (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, xev-&gt;deviceid,
<a id='L24433' name='L24433'></a> 24433                                           xev-&gt;detail, xev-&gt;event, XIRejectTouch);
<a id='L24434' name='L24434'></a> 24434                       x_stop_ignoring_errors (dpyinfo);
<a id='L24435' name='L24435'></a> 24435                     <em class='brace'>}</em>
<a id='L24436' name='L24436'></a> 24436 <em class='sharp'>#endif</em>
<a id='L24437' name='L24437'></a> 24437                 <em class='brace'>}</em>
<a id='L24438' name='L24438'></a> 24438               <strong class='reserved'>else</strong>
<a id='L24439' name='L24439'></a> 24439                 <em class='brace'>{</em>
<a id='L24440' name='L24440'></a> 24440 <em class='sharp'>#ifdef</em> HAVE_GTK3
<a id='L24441' name='L24441'></a> 24441                   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> was_waiting_for_input = <a href='../S/2352.html#L171' title='Defined at 171 in src/thread.h.'>waiting_for_input</a>;
<a id='L24442' name='L24442'></a> 24442                   <em class='comment'>/* This hack was adopted from the NS port.  Whether</em>
<a id='L24443' name='L24443'></a> 24443 <em class='comment'>                     or not it is actually safe is a different story</em>
<a id='L24444' name='L24444'></a> 24444 <em class='comment'>                     altogether.  */</em>
<a id='L24445' name='L24445'></a> 24445                   <strong class='reserved'>if</strong> (<a href='../S/2352.html#L171' title='Defined at 171 in src/thread.h.'>waiting_for_input</a>)
<a id='L24446' name='L24446'></a> 24446                     <a href='../S/2352.html#L171' title='Defined at 171 in src/thread.h.'>waiting_for_input</a> = 0;
<a id='L24447' name='L24447'></a> 24447                   <a href='../D/16825.html' title='Multiple defined in 4 places.'>set_frame_menubar</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L24448' name='L24448'></a> 24448                   <a href='../S/2352.html#L171' title='Defined at 171 in src/thread.h.'>waiting_for_input</a> = was_waiting_for_input;
<a id='L24449' name='L24449'></a> 24449 <em class='sharp'>#endif</em>
<a id='L24450' name='L24450'></a> 24450                 <em class='brace'>}</em>
<a id='L24451' name='L24451'></a> 24451 
<a id='L24452' name='L24452'></a> 24452               <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L24453' name='L24453'></a> 24453             <em class='brace'>}</em>
<a id='L24454' name='L24454'></a> 24454 
<a id='L24455' name='L24455'></a> 24455           <strong class='reserved'>case</strong> XI_TouchUpdate:
<a id='L24456' name='L24456'></a> 24456             <em class='brace'>{</em>
<a id='L24457' name='L24457'></a> 24457               <strong class='reserved'>struct</strong> <a href='../S/2212.html#L275' title='Defined at 275 in src/xterm.h.'>xi_device_t</a> *device, *source;
<a id='L24458' name='L24458'></a> 24458               <strong class='reserved'>struct</strong> <a href='../S/2212.html#L258' title='Defined at 258 in src/xterm.h.'>xi_touch_point_t</a> *touchpoint;
<a id='L24459' name='L24459'></a> 24459               <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> arg = Qnil;
<a id='L24460' name='L24460'></a> 24460 
<a id='L24461' name='L24461'></a> 24461               device = <a href='../S/2289.html#L5732' title='Defined at 5732 in src/xterm.c.'>xi_device_from_id</a> (dpyinfo, xev-&gt;deviceid);
<a id='L24462' name='L24462'></a> 24462               source = <a href='../S/2289.html#L5732' title='Defined at 5732 in src/xterm.c.'>xi_device_from_id</a> (dpyinfo, xev-&gt;sourceid);
<a id='L24463' name='L24463'></a> 24463               <a href='../S/2289.html#L7929' title='Defined at 7929 in src/xterm.c.'>x_display_set_last_user_time</a> (dpyinfo, xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>,
<a id='L24464' name='L24464'></a> 24464                                             xev-&gt;send_event, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L24465' name='L24465'></a> 24465 
<a id='L24466' name='L24466'></a> 24466               <strong class='reserved'>if</strong> (!device)
<a id='L24467' name='L24467'></a> 24467                 <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L24468' name='L24468'></a> 24468 
<a id='L24469' name='L24469'></a> 24469               touchpoint = <a href='../S/2289.html#L5817' title='Defined at 5817 in src/xterm.c.'>xi_find_touch_point</a> (device, xev-&gt;detail);
<a id='L24470' name='L24470'></a> 24470 
<a id='L24471' name='L24471'></a> 24471               <strong class='reserved'>if</strong> (!touchpoint)
<a id='L24472' name='L24472'></a> 24472                 <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L24473' name='L24473'></a> 24473 
<a id='L24474' name='L24474'></a> 24474               touchpoint-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = xev-&gt;event_x;
<a id='L24475' name='L24475'></a> 24475               touchpoint-&gt;y = xev-&gt;event_y;
<a id='L24476' name='L24476'></a> 24476 
<a id='L24477' name='L24477'></a> 24477               <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2289.html#L11957' title='Defined at 11957 in src/xterm.c.'>x_window_to_frame</a> (dpyinfo, xev-&gt;event);
<a id='L24478' name='L24478'></a> 24478 
<a id='L24479' name='L24479'></a> 24479               <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; device-&gt;direct_p)
<a id='L24480' name='L24480'></a> 24480                 <em class='brace'>{</em>
<a id='L24481' name='L24481'></a> 24481                   inev.ie.kind = <a href='../S/2231.html#L313' title='Defined at 313 in src/termhooks.h.'>TOUCHSCREEN_UPDATE_EVENT</a>;
<a id='L24482' name='L24482'></a> 24482                   inev.ie.timestamp = xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L24483' name='L24483'></a> 24483                   <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (inev.ie.frame_or_window, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L24484' name='L24484'></a> 24484 
<a id='L24485' name='L24485'></a> 24485                   <strong class='reserved'>for</strong> (touchpoint = device-&gt;touchpoints;
<a id='L24486' name='L24486'></a> 24486                        touchpoint; touchpoint = touchpoint-&gt;next)
<a id='L24487' name='L24487'></a> 24487                     <em class='brace'>{</em>
<a id='L24488' name='L24488'></a> 24488                       <strong class='reserved'>if</strong> (touchpoint-&gt;<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> == <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L24489' name='L24489'></a> 24489                         arg = Fcons (<a href='../D/13856.html' title='Multiple defined in 2 places.'>list3i</a> (lrint (touchpoint-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>),
<a id='L24490' name='L24490'></a> 24490                                              lrint (touchpoint-&gt;y),
<a id='L24491' name='L24491'></a> 24491                                              lrint (touchpoint-&gt;number)),
<a id='L24492' name='L24492'></a> 24492                                      arg);
<a id='L24493' name='L24493'></a> 24493                     <em class='brace'>}</em>
<a id='L24494' name='L24494'></a> 24494 
<a id='L24495' name='L24495'></a> 24495                   <strong class='reserved'>if</strong> (source)
<a id='L24496' name='L24496'></a> 24496                     inev.ie.device = source-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>;
<a id='L24497' name='L24497'></a> 24497 
<a id='L24498' name='L24498'></a> 24498                   inev.ie.arg = arg;
<a id='L24499' name='L24499'></a> 24499                 <em class='brace'>}</em>
<a id='L24500' name='L24500'></a> 24500 
<a id='L24501' name='L24501'></a> 24501               <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L24502' name='L24502'></a> 24502             <em class='brace'>}</em>
<a id='L24503' name='L24503'></a> 24503 
<a id='L24504' name='L24504'></a> 24504           <strong class='reserved'>case</strong> XI_TouchEnd:
<a id='L24505' name='L24505'></a> 24505             <em class='brace'>{</em>
<a id='L24506' name='L24506'></a> 24506               <strong class='reserved'>struct</strong> <a href='../S/2212.html#L275' title='Defined at 275 in src/xterm.h.'>xi_device_t</a> *device, *source;
<a id='L24507' name='L24507'></a> 24507               <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> unlinked_p;
<a id='L24508' name='L24508'></a> 24508 
<a id='L24509' name='L24509'></a> 24509               device = <a href='../S/2289.html#L5732' title='Defined at 5732 in src/xterm.c.'>xi_device_from_id</a> (dpyinfo, xev-&gt;deviceid);
<a id='L24510' name='L24510'></a> 24510               source = <a href='../S/2289.html#L5732' title='Defined at 5732 in src/xterm.c.'>xi_device_from_id</a> (dpyinfo, xev-&gt;sourceid);
<a id='L24511' name='L24511'></a> 24511               <a href='../S/2289.html#L7929' title='Defined at 7929 in src/xterm.c.'>x_display_set_last_user_time</a> (dpyinfo, xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>,
<a id='L24512' name='L24512'></a> 24512                                             xev-&gt;send_event, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L24513' name='L24513'></a> 24513 
<a id='L24514' name='L24514'></a> 24514               <strong class='reserved'>if</strong> (!device)
<a id='L24515' name='L24515'></a> 24515                 <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L24516' name='L24516'></a> 24516 
<a id='L24517' name='L24517'></a> 24517               unlinked_p = <a href='../S/2289.html#L5763' title='Defined at 5763 in src/xterm.c.'>xi_unlink_touch_point</a> (xev-&gt;detail, device);
<a id='L24518' name='L24518'></a> 24518 
<a id='L24519' name='L24519'></a> 24519               <strong class='reserved'>if</strong> (unlinked_p)
<a id='L24520' name='L24520'></a> 24520                 <em class='brace'>{</em>
<a id='L24521' name='L24521'></a> 24521                   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2289.html#L11957' title='Defined at 11957 in src/xterm.c.'>x_window_to_frame</a> (dpyinfo, xev-&gt;event);
<a id='L24522' name='L24522'></a> 24522 
<a id='L24523' name='L24523'></a> 24523                   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; device-&gt;direct_p)
<a id='L24524' name='L24524'></a> 24524                     <em class='brace'>{</em>
<a id='L24525' name='L24525'></a> 24525                       inev.ie.kind = <a href='../S/2231.html#L315' title='Defined at 315 in src/termhooks.h.'>TOUCHSCREEN_END_EVENT</a>;
<a id='L24526' name='L24526'></a> 24526                       inev.ie.timestamp = xev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L24527' name='L24527'></a> 24527 
<a id='L24528' name='L24528'></a> 24528                       <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (inev.ie.frame_or_window, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L24529' name='L24529'></a> 24529                       <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (inev.ie.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, lrint (xev-&gt;event_x));
<a id='L24530' name='L24530'></a> 24530                       <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (inev.ie.y, lrint (xev-&gt;event_y));
<a id='L24531' name='L24531'></a> 24531                       <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (inev.ie.arg, xev-&gt;detail);
<a id='L24532' name='L24532'></a> 24532 
<a id='L24533' name='L24533'></a> 24533                       <strong class='reserved'>if</strong> (source)
<a id='L24534' name='L24534'></a> 24534                         inev.ie.device = source-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>;
<a id='L24535' name='L24535'></a> 24535                     <em class='brace'>}</em>
<a id='L24536' name='L24536'></a> 24536                 <em class='brace'>}</em>
<a id='L24537' name='L24537'></a> 24537 
<a id='L24538' name='L24538'></a> 24538 <em class='sharp'>#ifndef</em> <a href='../S/2267.html#L3724' title='Defined at 3724 in src/lisp.h.'>HAVE_EXT_TOOL_BAR</a>
<a id='L24539' name='L24539'></a> 24539               <em class='comment'>/* Now see if the touchpoint was previously on the tool bar.</em>
<a id='L24540' name='L24540'></a> 24540 <em class='comment'>                 If it was, release the tool bar.  */</em>
<a id='L24541' name='L24541'></a> 24541 
<a id='L24542' name='L24542'></a> 24542               <strong class='reserved'>if</strong> (!<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L24543' name='L24543'></a> 24543                 <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2289.html#L11957' title='Defined at 11957 in src/xterm.c.'>x_window_to_frame</a> (dpyinfo, xev-&gt;event);
<a id='L24544' name='L24544'></a> 24544 
<a id='L24545' name='L24545'></a> 24545               <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> &amp;&amp; (<a href='../D/2368.html' title='Multiple defined in 7 places.'>FRAME_OUTPUT_DATA</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;tool_bar_touch_id
<a id='L24546' name='L24546'></a> 24546                         == xev-&gt;detail))
<a id='L24547' name='L24547'></a> 24547                 <em class='brace'>{</em>
<a id='L24548' name='L24548'></a> 24548                   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;last_tool_bar_item != -1)
<a id='L24549' name='L24549'></a> 24549                     <a href='../S/2224.html#L15690' title='Defined at 15690 in src/xdisp.c.'>handle_tool_bar_click_with_device</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, xev-&gt;event_x,
<a id='L24550' name='L24550'></a> 24550                                                        xev-&gt;event_y,
<a id='L24551' name='L24551'></a> 24551                                                        <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>, 0,
<a id='L24552' name='L24552'></a> 24552                                                        (source
<a id='L24553' name='L24553'></a> 24553                                                         ? source-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>
<a id='L24554' name='L24554'></a> 24554                                                         : Qnil));
<a id='L24555' name='L24555'></a> 24555 
<a id='L24556' name='L24556'></a> 24556                   <em class='comment'>/* Cancel any outstanding mouse highlight.  */</em>
<a id='L24557' name='L24557'></a> 24557                   <a href='../S/2224.html#L35323' title='Defined at 35323 in src/xdisp.c.'>note_mouse_highlight</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, -1, -1);
<a id='L24558' name='L24558'></a> 24558                   x_flush_dirty_back_buffer_on (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L24559' name='L24559'></a> 24559 
<a id='L24560' name='L24560'></a> 24560                   <em class='comment'>/* Now clear the tool bar device.  */</em>
<a id='L24561' name='L24561'></a> 24561                   <a href='../D/2368.html' title='Multiple defined in 7 places.'>FRAME_OUTPUT_DATA</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;tool_bar_touch_device = 0;
<a id='L24562' name='L24562'></a> 24562                 <em class='brace'>}</em>
<a id='L24563' name='L24563'></a> 24563 <em class='sharp'>#endif</em>
<a id='L24564' name='L24564'></a> 24564 
<a id='L24565' name='L24565'></a> 24565               <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L24566' name='L24566'></a> 24566             <em class='brace'>}</em>
<a id='L24567' name='L24567'></a> 24567 
<a id='L24568' name='L24568'></a> 24568 <em class='sharp'>#endif</em>
<a id='L24569' name='L24569'></a> 24569 
<a id='L24570' name='L24570'></a> 24570 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L177' title='Defined at 177 in src/xterm.h.'>HAVE_XINPUT2_4</a>
<a id='L24571' name='L24571'></a> 24571           <strong class='reserved'>case</strong> XI_GesturePinchBegin:
<a id='L24572' name='L24572'></a> 24572           <strong class='reserved'>case</strong> XI_GesturePinchUpdate:
<a id='L24573' name='L24573'></a> 24573             <em class='brace'>{</em>
<a id='L24574' name='L24574'></a> 24574               XIGesturePinchEvent *pev = (XIGesturePinchEvent *) xi_event;
<a id='L24575' name='L24575'></a> 24575               <strong class='reserved'>struct</strong> <a href='../S/2212.html#L275' title='Defined at 275 in src/xterm.h.'>xi_device_t</a> *device, *source;
<a id='L24576' name='L24576'></a> 24576 
<a id='L24577' name='L24577'></a> 24577               device = <a href='../S/2289.html#L5732' title='Defined at 5732 in src/xterm.c.'>xi_device_from_id</a> (dpyinfo, pev-&gt;deviceid);
<a id='L24578' name='L24578'></a> 24578               source = <a href='../S/2289.html#L5732' title='Defined at 5732 in src/xterm.c.'>xi_device_from_id</a> (dpyinfo, pev-&gt;sourceid);
<a id='L24579' name='L24579'></a> 24579               <a href='../S/2289.html#L7929' title='Defined at 7929 in src/xterm.c.'>x_display_set_last_user_time</a> (dpyinfo, pev-&gt;<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>,
<a id='L24580' name='L24580'></a> 24580                                             pev-&gt;send_event, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L24581' name='L24581'></a> 24581 
<a id='L24582' name='L24582'></a> 24582               <strong class='reserved'>if</strong> (!device)
<a id='L24583' name='L24583'></a> 24583                 <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L24584' name='L24584'></a> 24584 
<a id='L24585' name='L24585'></a> 24585 <em class='sharp'>#ifdef</em> HAVE_XWIDGETS
<a id='L24586' name='L24586'></a> 24586               <strong class='reserved'>struct</strong> <a href='../S/2261.html#L102' title='Defined at 102 in src/xwidget.h.'>xwidget_view</a> *xvw = <a href='../S/2334.html#L2116' title='Defined at 2116 in src/xwidget.c.'>xwidget_view_from_window</a> (pev-&gt;event);
<a id='L24587' name='L24587'></a> 24587 
<a id='L24588' name='L24588'></a> 24588               <strong class='reserved'>if</strong> (xvw)
<a id='L24589' name='L24589'></a> 24589                 <em class='brace'>{</em>
<a id='L24590' name='L24590'></a> 24590                   *finish = <a href='../S/2289.html#L1136' title='Defined at 1136 in src/xterm.c.'>X_EVENT_DROP</a>;
<a id='L24591' name='L24591'></a> 24591                   <a href='../S/2334.html#L1470' title='Defined at 1470 in src/xwidget.c.'>xwidget_pinch</a> (xvw, pev);
<a id='L24592' name='L24592'></a> 24592                   <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L24593' name='L24593'></a> 24593                 <em class='brace'>}</em>
<a id='L24594' name='L24594'></a> 24594 <em class='sharp'>#endif</em>
<a id='L24595' name='L24595'></a> 24595 
<a id='L24596' name='L24596'></a> 24596               any = <a href='../S/2289.html#L11957' title='Defined at 11957 in src/xterm.c.'>x_window_to_frame</a> (dpyinfo, pev-&gt;event);
<a id='L24597' name='L24597'></a> 24597 
<a id='L24598' name='L24598'></a> 24598               <strong class='reserved'>if</strong> (any)
<a id='L24599' name='L24599'></a> 24599                 <em class='brace'>{</em>
<a id='L24600' name='L24600'></a> 24600                   <strong class='reserved'>if</strong> (pev-&gt;event == <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (any))
<a id='L24601' name='L24601'></a> 24601                     xi_compute_root_window_offset_pinch (any, pev);
<a id='L24602' name='L24602'></a> 24602 
<a id='L24603' name='L24603'></a> 24603                   inev.ie.kind = <a href='../S/2231.html#L330' title='Defined at 330 in src/termhooks.h.'>PINCH_EVENT</a>;
<a id='L24604' name='L24604'></a> 24604                   inev.ie.modifiers
<a id='L24605' name='L24605'></a> 24605                     = x_x_to_emacs_modifiers (dpyinfo, pev-&gt;mods.effective);
<a id='L24606' name='L24606'></a> 24606 
<a id='L24607' name='L24607'></a> 24607                   <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (inev.ie.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, lrint (pev-&gt;event_x));
<a id='L24608' name='L24608'></a> 24608                   <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (inev.ie.y, lrint (pev-&gt;event_y));
<a id='L24609' name='L24609'></a> 24609                   <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (inev.ie.frame_or_window, any);
<a id='L24610' name='L24610'></a> 24610                   inev.ie.arg = <a href='../S/2350.html#L2938' title='Defined at 2938 in src/alloc.c.'>list4</a> (<a href='../S/2350.html#L2753' title='Defined at 2753 in src/alloc.c.'>make_float</a> (pev-&gt;delta_x),
<a id='L24611' name='L24611'></a> 24611                                        <a href='../S/2350.html#L2753' title='Defined at 2753 in src/alloc.c.'>make_float</a> (pev-&gt;delta_y),
<a id='L24612' name='L24612'></a> 24612                                        <a href='../S/2350.html#L2753' title='Defined at 2753 in src/alloc.c.'>make_float</a> (pev-&gt;scale),
<a id='L24613' name='L24613'></a> 24613                                        <a href='../S/2350.html#L2753' title='Defined at 2753 in src/alloc.c.'>make_float</a> (pev-&gt;delta_angle));
<a id='L24614' name='L24614'></a> 24614 
<a id='L24615' name='L24615'></a> 24615                   <strong class='reserved'>if</strong> (source)
<a id='L24616' name='L24616'></a> 24616                     inev.ie.device = source-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>;
<a id='L24617' name='L24617'></a> 24617                 <em class='brace'>}</em>
<a id='L24618' name='L24618'></a> 24618 
<a id='L24619' name='L24619'></a> 24619               <em class='comment'>/* Once again GTK seems to crash when confronted by</em>
<a id='L24620' name='L24620'></a> 24620 <em class='comment'>                 events it doesn't understand.  */</em>
<a id='L24621' name='L24621'></a> 24621               *finish = <a href='../S/2289.html#L1136' title='Defined at 1136 in src/xterm.c.'>X_EVENT_DROP</a>;
<a id='L24622' name='L24622'></a> 24622               <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L24623' name='L24623'></a> 24623             <em class='brace'>}</em>
<a id='L24624' name='L24624'></a> 24624 
<a id='L24625' name='L24625'></a> 24625           <strong class='reserved'>case</strong> XI_GesturePinchEnd:
<a id='L24626' name='L24626'></a> 24626             <em class='brace'>{</em>
<a id='L24627' name='L24627'></a> 24627 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XWIDGETS
<a id='L24628' name='L24628'></a> 24628               XIGesturePinchEvent *pev = (XIGesturePinchEvent *) xi_event;
<a id='L24629' name='L24629'></a> 24629               <strong class='reserved'>struct</strong> <a href='../S/2261.html#L102' title='Defined at 102 in src/xwidget.h.'>xwidget_view</a> *xvw = <a href='../S/2334.html#L2116' title='Defined at 2116 in src/xwidget.c.'>xwidget_view_from_window</a> (pev-&gt;event);
<a id='L24630' name='L24630'></a> 24630 
<a id='L24631' name='L24631'></a> 24631               <strong class='reserved'>if</strong> (xvw)
<a id='L24632' name='L24632'></a> 24632                 <a href='../S/2334.html#L1470' title='Defined at 1470 in src/xwidget.c.'>xwidget_pinch</a> (xvw, pev);
<a id='L24633' name='L24633'></a> 24633 <em class='sharp'>#endif</em>
<a id='L24634' name='L24634'></a> 24634               *finish = <a href='../S/2289.html#L1136' title='Defined at 1136 in src/xterm.c.'>X_EVENT_DROP</a>;
<a id='L24635' name='L24635'></a> 24635               <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L24636' name='L24636'></a> 24636             <em class='brace'>}</em>
<a id='L24637' name='L24637'></a> 24637 <em class='sharp'>#endif</em>
<a id='L24638' name='L24638'></a> 24638           <strong class='reserved'>default</strong>:
<a id='L24639' name='L24639'></a> 24639             <strong class='reserved'>goto</strong> XI_OTHER;
<a id='L24640' name='L24640'></a> 24640           <em class='brace'>}</em>
<a id='L24641' name='L24641'></a> 24641 
<a id='L24642' name='L24642'></a> 24642       xi_done_keysym:
<a id='L24643' name='L24643'></a> 24643 <em class='sharp'>#ifdef</em> HAVE_X_I18N
<a id='L24644' name='L24644'></a> 24644       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L24645' name='L24645'></a> 24645         <em class='brace'>{</em>
<a id='L24646' name='L24646'></a> 24646           <strong class='reserved'>struct</strong> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> *w = <a href='../D/7409.html' title='Multiple defined in 2 places.'>XWINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;selected_window);
<a id='L24647' name='L24647'></a> 24647           <a href='../S/2296.html#L3218' title='Defined at 3218 in src/xfns.c.'>xic_set_preeditarea</a> (w, w-&gt;cursor.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, w-&gt;cursor.y);
<a id='L24648' name='L24648'></a> 24648 
<a id='L24649' name='L24649'></a> 24649           <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1470' title='Defined at 1470 in src/xterm.h.'>FRAME_XIC</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) &amp;&amp; (<a href='../S/2212.html#L1473' title='Defined at 1473 in src/xterm.h.'>FRAME_XIC_STYLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) &amp; XIMStatusArea))
<a id='L24650' name='L24650'></a> 24650             <a href='../S/2296.html#L3269' title='Defined at 3269 in src/xfns.c.'>xic_set_statusarea</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L24651' name='L24651'></a> 24651         <em class='brace'>}</em>
<a id='L24652' name='L24652'></a> 24652 <em class='sharp'>#endif</em>
<a id='L24653' name='L24653'></a> 24653         <strong class='reserved'>if</strong> (must_free_data)
<a id='L24654' name='L24654'></a> 24654           XFreeEventData (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, &amp;event-&gt;xcookie);
<a id='L24655' name='L24655'></a> 24655         <strong class='reserved'>goto</strong> done_keysym;
<a id='L24656' name='L24656'></a> 24656 
<a id='L24657' name='L24657'></a> 24657       XI_OTHER:
<a id='L24658' name='L24658'></a> 24658         <strong class='reserved'>if</strong> (must_free_data)
<a id='L24659' name='L24659'></a> 24659           XFreeEventData (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, &amp;event-&gt;xcookie);
<a id='L24660' name='L24660'></a> 24660         <strong class='reserved'>goto</strong> OTHER;
<a id='L24661' name='L24661'></a> 24661       <em class='brace'>}</em>
<a id='L24662' name='L24662'></a> 24662 <em class='sharp'>#endif</em>
<a id='L24663' name='L24663'></a> 24663 
<a id='L24664' name='L24664'></a> 24664     <strong class='reserved'>default</strong>:
<a id='L24665' name='L24665'></a> 24665 <em class='sharp'>#ifdef</em> HAVE_XKB
<a id='L24666' name='L24666'></a> 24666       <strong class='reserved'>if</strong> (dpyinfo-&gt;supports_xkb
<a id='L24667' name='L24667'></a> 24667           &amp;&amp; event-&gt;type == dpyinfo-&gt;xkb_event_type)
<a id='L24668' name='L24668'></a> 24668         <em class='brace'>{</em>
<a id='L24669' name='L24669'></a> 24669           XkbEvent *xkbevent = (XkbEvent *) event;
<a id='L24670' name='L24670'></a> 24670 
<a id='L24671' name='L24671'></a> 24671           <strong class='reserved'>if</strong> (xkbevent-&gt;any.xkb_type == XkbNewKeyboardNotify
<a id='L24672' name='L24672'></a> 24672               || xkbevent-&gt;any.xkb_type == XkbMapNotify)
<a id='L24673' name='L24673'></a> 24673             <em class='brace'>{</em>
<a id='L24674' name='L24674'></a> 24674               <a href='../S/2296.html#L10160' title='Defined at 10160 in src/xfns.c.'>XkbRefreshKeyboardMapping</a> (&amp;xkbevent-&gt;map);
<a id='L24675' name='L24675'></a> 24675 
<a id='L24676' name='L24676'></a> 24676               <strong class='reserved'>if</strong> (dpyinfo-&gt;xkb_desc)
<a id='L24677' name='L24677'></a> 24677                 <em class='brace'>{</em>
<a id='L24678' name='L24678'></a> 24678                   <strong class='reserved'>if</strong> (XkbGetUpdatedMap (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L24679' name='L24679'></a> 24679                                         (XkbKeySymsMask
<a id='L24680' name='L24680'></a> 24680                                          | XkbKeyTypesMask
<a id='L24681' name='L24681'></a> 24681                                          | XkbModifierMapMask
<a id='L24682' name='L24682'></a> 24682                                          | XkbVirtualModsMask),
<a id='L24683' name='L24683'></a> 24683                                         dpyinfo-&gt;xkb_desc) == Success)
<a id='L24684' name='L24684'></a> 24684                     XkbGetNames (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, XkbAllNamesMask,
<a id='L24685' name='L24685'></a> 24685                                  dpyinfo-&gt;xkb_desc);
<a id='L24686' name='L24686'></a> 24686                   <strong class='reserved'>else</strong>
<a id='L24687' name='L24687'></a> 24687                     <em class='brace'>{</em>
<a id='L24688' name='L24688'></a> 24688                       XkbFreeKeyboard (dpyinfo-&gt;xkb_desc,
<a id='L24689' name='L24689'></a> 24689                                        XkbAllComponentsMask, True);
<a id='L24690' name='L24690'></a> 24690                       dpyinfo-&gt;xkb_desc = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L24691' name='L24691'></a> 24691                     <em class='brace'>}</em>
<a id='L24692' name='L24692'></a> 24692                 <em class='brace'>}</em>
<a id='L24693' name='L24693'></a> 24693               <strong class='reserved'>else</strong>
<a id='L24694' name='L24694'></a> 24694                 <em class='brace'>{</em>
<a id='L24695' name='L24695'></a> 24695                   dpyinfo-&gt;xkb_desc = XkbGetMap (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L24696' name='L24696'></a> 24696                                                  (XkbKeySymsMask
<a id='L24697' name='L24697'></a> 24697                                                   | XkbKeyTypesMask
<a id='L24698' name='L24698'></a> 24698                                                   | XkbModifierMapMask
<a id='L24699' name='L24699'></a> 24699                                                   | XkbVirtualModsMask),
<a id='L24700' name='L24700'></a> 24700                                                  XkbUseCoreKbd);
<a id='L24701' name='L24701'></a> 24701 
<a id='L24702' name='L24702'></a> 24702                   <strong class='reserved'>if</strong> (dpyinfo-&gt;xkb_desc)
<a id='L24703' name='L24703'></a> 24703                     XkbGetNames (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, XkbAllNamesMask,
<a id='L24704' name='L24704'></a> 24704                                  dpyinfo-&gt;xkb_desc);
<a id='L24705' name='L24705'></a> 24705                 <em class='brace'>}</em>
<a id='L24706' name='L24706'></a> 24706 
<a id='L24707' name='L24707'></a> 24707               x_find_modifier_meanings (dpyinfo);
<a id='L24708' name='L24708'></a> 24708             <em class='brace'>}</em>
<a id='L24709' name='L24709'></a> 24709           <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (x_dnd_in_progress
<a id='L24710' name='L24710'></a> 24710                    &amp;&amp; xkbevent-&gt;any.xkb_type == XkbStateNotify)
<a id='L24711' name='L24711'></a> 24711             x_dnd_keyboard_state = (xkbevent-&gt;state.mods
<a id='L24712' name='L24712'></a> 24712                                     | xkbevent-&gt;state.ptr_buttons);
<a id='L24713' name='L24713'></a> 24713         <em class='brace'>}</em>
<a id='L24714' name='L24714'></a> 24714 <em class='sharp'>#endif</em>
<a id='L24715' name='L24715'></a> 24715 <em class='sharp'>#ifdef</em> HAVE_XSHAPE
<a id='L24716' name='L24716'></a> 24716       <strong class='reserved'>if</strong> (dpyinfo-&gt;xshape_supported_p
<a id='L24717' name='L24717'></a> 24717           &amp;&amp; event-&gt;type == dpyinfo-&gt;xshape_event_base + ShapeNotify
<a id='L24718' name='L24718'></a> 24718           &amp;&amp; x_dnd_in_progress &amp;&amp; x_dnd_use_toplevels
<a id='L24719' name='L24719'></a> 24719           &amp;&amp; dpyinfo == <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (x_dnd_frame))
<a id='L24720' name='L24720'></a> 24720         <em class='brace'>{</em>
<a id='L24721' name='L24721'></a> 24721 <em class='sharp'>#ifndef</em> USE_GTK
<a id='L24722' name='L24722'></a> 24722           XEvent xevent;
<a id='L24723' name='L24723'></a> 24723 <em class='sharp'>#endif</em>
<a id='L24724' name='L24724'></a> 24724           XShapeEvent *xse = (XShapeEvent *) event;
<a id='L24725' name='L24725'></a> 24725 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XCB_SHAPE &amp;&amp; <strong class='reserved'>defined</strong> <a href='../S/2289.html#L804' title='Defined at 804 in src/xterm.c.'>HAVE_XCB_SHAPE_INPUT_RECTS</a>
<a id='L24726' name='L24726'></a> 24726           xcb_shape_get_rectangles_cookie_t bounding_rect_cookie;
<a id='L24727' name='L24727'></a> 24727           xcb_shape_get_rectangles_reply_t *bounding_rect_reply;
<a id='L24728' name='L24728'></a> 24728           xcb_rectangle_iterator_t bounding_rect_iterator;
<a id='L24729' name='L24729'></a> 24729 
<a id='L24730' name='L24730'></a> 24730           xcb_shape_get_rectangles_cookie_t input_rect_cookie;
<a id='L24731' name='L24731'></a> 24731           xcb_shape_get_rectangles_reply_t *input_rect_reply;
<a id='L24732' name='L24732'></a> 24732           xcb_rectangle_iterator_t input_rect_iterator;
<a id='L24733' name='L24733'></a> 24733 
<a id='L24734' name='L24734'></a> 24734           xcb_generic_error_t *<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>;
<a id='L24735' name='L24735'></a> 24735 <em class='sharp'>#else</em>
<a id='L24736' name='L24736'></a> 24736           <a href='../S/2150.html#L62' title='Defined at 62 in src/pgtkgui.h.'>XRectangle</a> *rects;
<a id='L24737' name='L24737'></a> 24737           <strong class='reserved'>int</strong> rc, ordering;
<a id='L24738' name='L24738'></a> 24738 <em class='sharp'>#endif</em>
<a id='L24739' name='L24739'></a> 24739 
<a id='L24740' name='L24740'></a> 24740           <em class='comment'>/* Somehow this really interferes with GTK's own processing</em>
<a id='L24741' name='L24741'></a> 24741 <em class='comment'>             of ShapeNotify events.  Not sure what GTK uses them for,</em>
<a id='L24742' name='L24742'></a> 24742 <em class='comment'>             but we cannot skip any of them here.  */</em>
<a id='L24743' name='L24743'></a> 24743 <em class='sharp'>#ifndef</em> USE_GTK
<a id='L24744' name='L24744'></a> 24744           <strong class='reserved'>while</strong> (XPending (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>))
<a id='L24745' name='L24745'></a> 24745             <em class='brace'>{</em>
<a id='L24746' name='L24746'></a> 24746               XNextEvent (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, &amp;xevent);
<a id='L24747' name='L24747'></a> 24747 
<a id='L24748' name='L24748'></a> 24748               <strong class='reserved'>if</strong> (xevent.type == dpyinfo-&gt;xshape_event_base + ShapeNotify
<a id='L24749' name='L24749'></a> 24749                   &amp;&amp; ((XShapeEvent *) &amp;xevent)-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> == xse-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>)
<a id='L24750' name='L24750'></a> 24750                 xse = (XShapeEvent *) &amp;xevent;
<a id='L24751' name='L24751'></a> 24751               <strong class='reserved'>else</strong>
<a id='L24752' name='L24752'></a> 24752                 <em class='brace'>{</em>
<a id='L24753' name='L24753'></a> 24753                   XPutBackEvent (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, &amp;xevent);
<a id='L24754' name='L24754'></a> 24754                   <strong class='reserved'>break</strong>;
<a id='L24755' name='L24755'></a> 24755                 <em class='brace'>}</em>
<a id='L24756' name='L24756'></a> 24756             <em class='brace'>}</em>
<a id='L24757' name='L24757'></a> 24757 <em class='sharp'>#endif</em>
<a id='L24758' name='L24758'></a> 24758 
<a id='L24759' name='L24759'></a> 24759           <strong class='reserved'>for</strong> (<strong class='reserved'>struct</strong> <a href='../S/2289.html#L1484' title='Defined at 1484 in src/xterm.c.'>x_client_list_window</a> *tem = x_dnd_toplevels; tem;
<a id='L24760' name='L24760'></a> 24760                tem = tem-&gt;next)
<a id='L24761' name='L24761'></a> 24761             <em class='brace'>{</em>
<a id='L24762' name='L24762'></a> 24762               <strong class='reserved'>if</strong> (tem-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> == xse-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>)
<a id='L24763' name='L24763'></a> 24763                 <em class='brace'>{</em>
<a id='L24764' name='L24764'></a> 24764                   <strong class='reserved'>if</strong> (tem-&gt;n_input_rects != -1)
<a id='L24765' name='L24765'></a> 24765                     <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (tem-&gt;input_rects);
<a id='L24766' name='L24766'></a> 24766                   <strong class='reserved'>if</strong> (tem-&gt;n_bounding_rects != -1)
<a id='L24767' name='L24767'></a> 24767                     <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (tem-&gt;bounding_rects);
<a id='L24768' name='L24768'></a> 24768 
<a id='L24769' name='L24769'></a> 24769                   tem-&gt;n_input_rects = -1;
<a id='L24770' name='L24770'></a> 24770                   tem-&gt;n_bounding_rects = -1;
<a id='L24771' name='L24771'></a> 24771 
<a id='L24772' name='L24772'></a> 24772 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XCB_SHAPE &amp;&amp; <strong class='reserved'>defined</strong> <a href='../S/2289.html#L804' title='Defined at 804 in src/xterm.c.'>HAVE_XCB_SHAPE_INPUT_RECTS</a>
<a id='L24773' name='L24773'></a> 24773                   bounding_rect_cookie = xcb_shape_get_rectangles (dpyinfo-&gt;xcb_connection,
<a id='L24774' name='L24774'></a> 24774                                                                    (xcb_window_t) xse-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>,
<a id='L24775' name='L24775'></a> 24775                                                                    XCB_SHAPE_SK_BOUNDING);
<a id='L24776' name='L24776'></a> 24776                   <strong class='reserved'>if</strong> (dpyinfo-&gt;xshape_major &gt; 1
<a id='L24777' name='L24777'></a> 24777                       || (dpyinfo-&gt;xshape_major == 1
<a id='L24778' name='L24778'></a> 24778                           &amp;&amp; dpyinfo-&gt;xshape_minor &gt;= 1))
<a id='L24779' name='L24779'></a> 24779                     input_rect_cookie
<a id='L24780' name='L24780'></a> 24780                       = xcb_shape_get_rectangles (dpyinfo-&gt;xcb_connection,
<a id='L24781' name='L24781'></a> 24781                                                   (xcb_window_t) xse-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>,
<a id='L24782' name='L24782'></a> 24782                                                   XCB_SHAPE_SK_INPUT);
<a id='L24783' name='L24783'></a> 24783 
<a id='L24784' name='L24784'></a> 24784                   bounding_rect_reply = xcb_shape_get_rectangles_reply (dpyinfo-&gt;xcb_connection,
<a id='L24785' name='L24785'></a> 24785                                                                         bounding_rect_cookie,
<a id='L24786' name='L24786'></a> 24786                                                                         &amp;<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L24787' name='L24787'></a> 24787 
<a id='L24788' name='L24788'></a> 24788                   <strong class='reserved'>if</strong> (bounding_rect_reply)
<a id='L24789' name='L24789'></a> 24789                     <em class='brace'>{</em>
<a id='L24790' name='L24790'></a> 24790                       bounding_rect_iterator
<a id='L24791' name='L24791'></a> 24791                         = xcb_shape_get_rectangles_rectangles_iterator (bounding_rect_reply);
<a id='L24792' name='L24792'></a> 24792                       tem-&gt;n_bounding_rects = bounding_rect_iterator.rem + 1;
<a id='L24793' name='L24793'></a> 24793                       tem-&gt;bounding_rects = <a href='../D/20068.html' title='Multiple defined in 10 places.'>xmalloc</a> (tem-&gt;n_bounding_rects
<a id='L24794' name='L24794'></a> 24794                                                      * <strong class='reserved'>sizeof</strong> *tem-&gt;bounding_rects);
<a id='L24795' name='L24795'></a> 24795                       tem-&gt;n_bounding_rects = 0;
<a id='L24796' name='L24796'></a> 24796 
<a id='L24797' name='L24797'></a> 24797                       <strong class='reserved'>for</strong> (; bounding_rect_iterator.rem; xcb_rectangle_next (&amp;bounding_rect_iterator))
<a id='L24798' name='L24798'></a> 24798                         <em class='brace'>{</em>
<a id='L24799' name='L24799'></a> 24799                           tem-&gt;bounding_rects[tem-&gt;n_bounding_rects].<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>
<a id='L24800' name='L24800'></a> 24800                             = bounding_rect_iterator.data-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L24801' name='L24801'></a> 24801                           tem-&gt;bounding_rects[tem-&gt;n_bounding_rects].y
<a id='L24802' name='L24802'></a> 24802                             = bounding_rect_iterator.data-&gt;y;
<a id='L24803' name='L24803'></a> 24803                           tem-&gt;bounding_rects[tem-&gt;n_bounding_rects].width
<a id='L24804' name='L24804'></a> 24804                             = bounding_rect_iterator.data-&gt;width;
<a id='L24805' name='L24805'></a> 24805                           tem-&gt;bounding_rects[tem-&gt;n_bounding_rects].height
<a id='L24806' name='L24806'></a> 24806                             = bounding_rect_iterator.data-&gt;height;
<a id='L24807' name='L24807'></a> 24807 
<a id='L24808' name='L24808'></a> 24808                           tem-&gt;n_bounding_rects++;
<a id='L24809' name='L24809'></a> 24809                         <em class='brace'>}</em>
<a id='L24810' name='L24810'></a> 24810 
<a id='L24811' name='L24811'></a> 24811                       <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (bounding_rect_reply);
<a id='L24812' name='L24812'></a> 24812                     <em class='brace'>}</em>
<a id='L24813' name='L24813'></a> 24813                   <strong class='reserved'>else</strong>
<a id='L24814' name='L24814'></a> 24814                     <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L24815' name='L24815'></a> 24815 
<a id='L24816' name='L24816'></a> 24816                   <strong class='reserved'>if</strong> (dpyinfo-&gt;xshape_major &gt; 1
<a id='L24817' name='L24817'></a> 24817                       || (dpyinfo-&gt;xshape_major == 1
<a id='L24818' name='L24818'></a> 24818                           &amp;&amp; dpyinfo-&gt;xshape_minor &gt;= 1))
<a id='L24819' name='L24819'></a> 24819                     <em class='brace'>{</em>
<a id='L24820' name='L24820'></a> 24820                       input_rect_reply = xcb_shape_get_rectangles_reply (dpyinfo-&gt;xcb_connection,
<a id='L24821' name='L24821'></a> 24821                                                                          input_rect_cookie, &amp;<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L24822' name='L24822'></a> 24822 
<a id='L24823' name='L24823'></a> 24823                       <strong class='reserved'>if</strong> (input_rect_reply)
<a id='L24824' name='L24824'></a> 24824                         <em class='brace'>{</em>
<a id='L24825' name='L24825'></a> 24825                           input_rect_iterator
<a id='L24826' name='L24826'></a> 24826                             = xcb_shape_get_rectangles_rectangles_iterator (input_rect_reply);
<a id='L24827' name='L24827'></a> 24827                           tem-&gt;n_input_rects = input_rect_iterator.rem + 1;
<a id='L24828' name='L24828'></a> 24828                           tem-&gt;input_rects = <a href='../D/20068.html' title='Multiple defined in 10 places.'>xmalloc</a> (tem-&gt;n_input_rects
<a id='L24829' name='L24829'></a> 24829                                                       * <strong class='reserved'>sizeof</strong> *tem-&gt;input_rects);
<a id='L24830' name='L24830'></a> 24830                           tem-&gt;n_input_rects = 0;
<a id='L24831' name='L24831'></a> 24831 
<a id='L24832' name='L24832'></a> 24832                           <strong class='reserved'>for</strong> (; input_rect_iterator.rem; xcb_rectangle_next (&amp;input_rect_iterator))
<a id='L24833' name='L24833'></a> 24833                             <em class='brace'>{</em>
<a id='L24834' name='L24834'></a> 24834                               tem-&gt;input_rects[tem-&gt;n_input_rects].<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>
<a id='L24835' name='L24835'></a> 24835                                 = input_rect_iterator.data-&gt;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L24836' name='L24836'></a> 24836                               tem-&gt;input_rects[tem-&gt;n_input_rects].y
<a id='L24837' name='L24837'></a> 24837                                 = input_rect_iterator.data-&gt;y;
<a id='L24838' name='L24838'></a> 24838                               tem-&gt;input_rects[tem-&gt;n_input_rects].width
<a id='L24839' name='L24839'></a> 24839                                 = input_rect_iterator.data-&gt;width;
<a id='L24840' name='L24840'></a> 24840                               tem-&gt;input_rects[tem-&gt;n_input_rects].height
<a id='L24841' name='L24841'></a> 24841                                 = input_rect_iterator.data-&gt;height;
<a id='L24842' name='L24842'></a> 24842 
<a id='L24843' name='L24843'></a> 24843                               tem-&gt;n_input_rects++;
<a id='L24844' name='L24844'></a> 24844                             <em class='brace'>}</em>
<a id='L24845' name='L24845'></a> 24845 
<a id='L24846' name='L24846'></a> 24846                           <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (input_rect_reply);
<a id='L24847' name='L24847'></a> 24847                         <em class='brace'>}</em>
<a id='L24848' name='L24848'></a> 24848                       <strong class='reserved'>else</strong>
<a id='L24849' name='L24849'></a> 24849                         <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L24850' name='L24850'></a> 24850                     <em class='brace'>}</em>
<a id='L24851' name='L24851'></a> 24851 <em class='sharp'>#else</em>
<a id='L24852' name='L24852'></a> 24852                   x_catch_errors (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L24853' name='L24853'></a> 24853                   rects = XShapeGetRectangles (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L24854' name='L24854'></a> 24854                                                xse-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>,
<a id='L24855' name='L24855'></a> 24855                                                ShapeBounding,
<a id='L24856' name='L24856'></a> 24856                                                &amp;count, &amp;ordering);
<a id='L24857' name='L24857'></a> 24857                   rc = x_had_errors_p (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L24858' name='L24858'></a> 24858                   x_uncatch_errors_after_check ();
<a id='L24859' name='L24859'></a> 24859 
<a id='L24860' name='L24860'></a> 24860                   <em class='comment'>/* Does XShapeGetRectangles allocate anything upon an</em>
<a id='L24861' name='L24861'></a> 24861 <em class='comment'>                     error?  */</em>
<a id='L24862' name='L24862'></a> 24862                   <strong class='reserved'>if</strong> (!rc)
<a id='L24863' name='L24863'></a> 24863                     <em class='brace'>{</em>
<a id='L24864' name='L24864'></a> 24864                       tem-&gt;n_bounding_rects = count;
<a id='L24865' name='L24865'></a> 24865                       tem-&gt;bounding_rects
<a id='L24866' name='L24866'></a> 24866                         = <a href='../D/20068.html' title='Multiple defined in 10 places.'>xmalloc</a> (<strong class='reserved'>sizeof</strong> *tem-&gt;bounding_rects * count);
<a id='L24867' name='L24867'></a> 24867                       memcpy (tem-&gt;bounding_rects, rects,
<a id='L24868' name='L24868'></a> 24868                               <strong class='reserved'>sizeof</strong> *tem-&gt;bounding_rects * count);
<a id='L24869' name='L24869'></a> 24869 
<a id='L24870' name='L24870'></a> 24870                       XFree (rects);
<a id='L24871' name='L24871'></a> 24871                     <em class='brace'>}</em>
<a id='L24872' name='L24872'></a> 24872 
<a id='L24873' name='L24873'></a> 24873 <em class='sharp'>#ifdef</em> ShapeInput
<a id='L24874' name='L24874'></a> 24874                   <strong class='reserved'>if</strong> (dpyinfo-&gt;xshape_major &gt; 1
<a id='L24875' name='L24875'></a> 24875                       || (dpyinfo-&gt;xshape_major == 1
<a id='L24876' name='L24876'></a> 24876                           &amp;&amp; dpyinfo-&gt;xshape_minor &gt;= 1))
<a id='L24877' name='L24877'></a> 24877                     <em class='brace'>{</em>
<a id='L24878' name='L24878'></a> 24878                       x_catch_errors (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L24879' name='L24879'></a> 24879                       rects = XShapeGetRectangles (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L24880' name='L24880'></a> 24880                                                    xse-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, ShapeInput,
<a id='L24881' name='L24881'></a> 24881                                                    &amp;count, &amp;ordering);
<a id='L24882' name='L24882'></a> 24882                       rc = x_had_errors_p (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L24883' name='L24883'></a> 24883                       x_uncatch_errors_after_check ();
<a id='L24884' name='L24884'></a> 24884 
<a id='L24885' name='L24885'></a> 24885                       <em class='comment'>/* Does XShapeGetRectangles allocate anything upon</em>
<a id='L24886' name='L24886'></a> 24886 <em class='comment'>                         an error?  */</em>
<a id='L24887' name='L24887'></a> 24887                       <strong class='reserved'>if</strong> (!rc)
<a id='L24888' name='L24888'></a> 24888                         <em class='brace'>{</em>
<a id='L24889' name='L24889'></a> 24889                           tem-&gt;n_input_rects = count;
<a id='L24890' name='L24890'></a> 24890                           tem-&gt;input_rects
<a id='L24891' name='L24891'></a> 24891                             = <a href='../D/20068.html' title='Multiple defined in 10 places.'>xmalloc</a> (<strong class='reserved'>sizeof</strong> *tem-&gt;input_rects * count);
<a id='L24892' name='L24892'></a> 24892                           memcpy (tem-&gt;input_rects, rects,
<a id='L24893' name='L24893'></a> 24893                                   <strong class='reserved'>sizeof</strong> *tem-&gt;input_rects * count);
<a id='L24894' name='L24894'></a> 24894 
<a id='L24895' name='L24895'></a> 24895                           XFree (rects);
<a id='L24896' name='L24896'></a> 24896                         <em class='brace'>}</em>
<a id='L24897' name='L24897'></a> 24897                     <em class='brace'>}</em>
<a id='L24898' name='L24898'></a> 24898 <em class='sharp'>#endif</em>
<a id='L24899' name='L24899'></a> 24899 <em class='sharp'>#endif</em>
<a id='L24900' name='L24900'></a> 24900 
<a id='L24901' name='L24901'></a> 24901                   <em class='comment'>/* Handle the common case where the input shape equals the</em>
<a id='L24902' name='L24902'></a> 24902 <em class='comment'>                     bounding shape.  */</em>
<a id='L24903' name='L24903'></a> 24903 
<a id='L24904' name='L24904'></a> 24904                   <strong class='reserved'>if</strong> (tem-&gt;n_input_rects != -1
<a id='L24905' name='L24905'></a> 24905                       &amp;&amp; tem-&gt;n_bounding_rects == tem-&gt;n_input_rects
<a id='L24906' name='L24906'></a> 24906                       &amp;&amp; !memcmp (tem-&gt;bounding_rects, tem-&gt;input_rects,
<a id='L24907' name='L24907'></a> 24907                                   tem-&gt;n_input_rects * <strong class='reserved'>sizeof</strong> *tem-&gt;input_rects))
<a id='L24908' name='L24908'></a> 24908                     <em class='brace'>{</em>
<a id='L24909' name='L24909'></a> 24909                       <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (tem-&gt;input_rects);
<a id='L24910' name='L24910'></a> 24910                       tem-&gt;n_input_rects = -1;
<a id='L24911' name='L24911'></a> 24911                     <em class='brace'>}</em>
<a id='L24912' name='L24912'></a> 24912 
<a id='L24913' name='L24913'></a> 24913                   <em class='comment'>/* And the common case where there is no input rect and the</em>
<a id='L24914' name='L24914'></a> 24914 <em class='comment'>                     bounding rect equals the window dimensions.  */</em>
<a id='L24915' name='L24915'></a> 24915 
<a id='L24916' name='L24916'></a> 24916                   <strong class='reserved'>if</strong> (tem-&gt;n_input_rects == -1
<a id='L24917' name='L24917'></a> 24917                       &amp;&amp; tem-&gt;n_bounding_rects == 1
<a id='L24918' name='L24918'></a> 24918                       &amp;&amp; tem-&gt;bounding_rects[0].width == tem-&gt;width
<a id='L24919' name='L24919'></a> 24919                       &amp;&amp; tem-&gt;bounding_rects[0].height == tem-&gt;height
<a id='L24920' name='L24920'></a> 24920                       &amp;&amp; tem-&gt;bounding_rects[0].<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> == -tem-&gt;border_width
<a id='L24921' name='L24921'></a> 24921                       &amp;&amp; tem-&gt;bounding_rects[0].y == -tem-&gt;border_width)
<a id='L24922' name='L24922'></a> 24922                     <em class='brace'>{</em>
<a id='L24923' name='L24923'></a> 24923                       <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (tem-&gt;bounding_rects);
<a id='L24924' name='L24924'></a> 24924                       tem-&gt;n_bounding_rects = -1;
<a id='L24925' name='L24925'></a> 24925                     <em class='brace'>}</em>
<a id='L24926' name='L24926'></a> 24926 
<a id='L24927' name='L24927'></a> 24927                   <strong class='reserved'>break</strong>;
<a id='L24928' name='L24928'></a> 24928                 <em class='brace'>}</em>
<a id='L24929' name='L24929'></a> 24929             <em class='brace'>}</em>
<a id='L24930' name='L24930'></a> 24930         <em class='brace'>}</em>
<a id='L24931' name='L24931'></a> 24931 <em class='sharp'>#endif</em>
<a id='L24932' name='L24932'></a> 24932 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XRANDR &amp;&amp; !<strong class='reserved'>defined</strong> USE_GTK
<a id='L24933' name='L24933'></a> 24933       <strong class='reserved'>if</strong> (dpyinfo-&gt;xrandr_supported_p
<a id='L24934' name='L24934'></a> 24934           &amp;&amp; (event-&gt;type == (dpyinfo-&gt;xrandr_event_base
<a id='L24935' name='L24935'></a> 24935                               + RRScreenChangeNotify)
<a id='L24936' name='L24936'></a> 24936               || event-&gt;type == (dpyinfo-&gt;xrandr_event_base
<a id='L24937' name='L24937'></a> 24937                                  + RRNotify)))
<a id='L24938' name='L24938'></a> 24938         <em class='brace'>{</em>
<a id='L24939' name='L24939'></a> 24939           <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a> timestamp;
<a id='L24940' name='L24940'></a> 24940           <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> current_monitors;
<a id='L24941' name='L24941'></a> 24941           XRRScreenChangeNotifyEvent *notify;
<a id='L24942' name='L24942'></a> 24942 
<a id='L24943' name='L24943'></a> 24943           <strong class='reserved'>if</strong> (event-&gt;type == (dpyinfo-&gt;xrandr_event_base
<a id='L24944' name='L24944'></a> 24944                               + RRScreenChangeNotify))
<a id='L24945' name='L24945'></a> 24945             XRRUpdateConfiguration ((XEvent *) event);
<a id='L24946' name='L24946'></a> 24946 
<a id='L24947' name='L24947'></a> 24947           <strong class='reserved'>if</strong> (event-&gt;type == (dpyinfo-&gt;xrandr_event_base
<a id='L24948' name='L24948'></a> 24948                               + RRScreenChangeNotify))
<a id='L24949' name='L24949'></a> 24949             <em class='brace'>{</em>
<a id='L24950' name='L24950'></a> 24950               notify = ((XRRScreenChangeNotifyEvent *) event);
<a id='L24951' name='L24951'></a> 24951               timestamp = notify-&gt;timestamp;
<a id='L24952' name='L24952'></a> 24952 
<a id='L24953' name='L24953'></a> 24953               <em class='comment'>/* Don't set screen dimensions if the notification is</em>
<a id='L24954' name='L24954'></a> 24954 <em class='comment'>                 for a different screen.  */</em>
<a id='L24955' name='L24955'></a> 24955               <strong class='reserved'>if</strong> (notify-&gt;root == dpyinfo-&gt;root_window)
<a id='L24956' name='L24956'></a> 24956                 <em class='brace'>{</em>
<a id='L24957' name='L24957'></a> 24957                   dpyinfo-&gt;screen_width = notify-&gt;width;
<a id='L24958' name='L24958'></a> 24958                   dpyinfo-&gt;screen_height = notify-&gt;height;
<a id='L24959' name='L24959'></a> 24959                   dpyinfo-&gt;screen_mm_width = notify-&gt;mwidth;
<a id='L24960' name='L24960'></a> 24960                   dpyinfo-&gt;screen_mm_height = notify-&gt;mheight;
<a id='L24961' name='L24961'></a> 24961                 <em class='brace'>}</em>
<a id='L24962' name='L24962'></a> 24962             <em class='brace'>}</em>
<a id='L24963' name='L24963'></a> 24963           <strong class='reserved'>else</strong>
<a id='L24964' name='L24964'></a> 24964             timestamp = 0;
<a id='L24965' name='L24965'></a> 24965 
<a id='L24966' name='L24966'></a> 24966           <strong class='reserved'>if</strong> (x_find_monitors_changed_event (dpyinfo))
<a id='L24967' name='L24967'></a> 24967             <em class='comment'>/* Don't store a MONITORS_CHANGED_EVENT if there is</em>
<a id='L24968' name='L24968'></a> 24968 <em class='comment'>               already an undelivered event on the queue.  */</em>
<a id='L24969' name='L24969'></a> 24969             <strong class='reserved'>goto</strong> OTHER;
<a id='L24970' name='L24970'></a> 24970 
<a id='L24971' name='L24971'></a> 24971           inev.ie.kind = <a href='../S/2231.html#L335' title='Defined at 335 in src/termhooks.h.'>MONITORS_CHANGED_EVENT</a>;
<a id='L24972' name='L24972'></a> 24972           inev.ie.timestamp = timestamp;
<a id='L24973' name='L24973'></a> 24973           <a href='../D/7354.html' title='Multiple defined in 2 places.'>XSETTERMINAL</a> (inev.ie.arg, dpyinfo-&gt;<a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>);
<a id='L24974' name='L24974'></a> 24974 
<a id='L24975' name='L24975'></a> 24975           <em class='comment'>/* Also don't do anything if the monitor configuration</em>
<a id='L24976' name='L24976'></a> 24976 <em class='comment'>             didn't really change.  */</em>
<a id='L24977' name='L24977'></a> 24977 
<a id='L24978' name='L24978'></a> 24978           current_monitors
<a id='L24979' name='L24979'></a> 24979             = Fx_display_monitor_attributes_list (inev.ie.arg);
<a id='L24980' name='L24980'></a> 24980 
<a id='L24981' name='L24981'></a> 24981           <strong class='reserved'>if</strong> (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (Fequal (current_monitors,
<a id='L24982' name='L24982'></a> 24982                              dpyinfo-&gt;last_monitor_attributes_list)))
<a id='L24983' name='L24983'></a> 24983             inev.ie.kind = <a href='../S/2231.html#L74' title='Defined at 74 in src/termhooks.h.'>NO_EVENT</a>;
<a id='L24984' name='L24984'></a> 24984 
<a id='L24985' name='L24985'></a> 24985           dpyinfo-&gt;last_monitor_attributes_list = current_monitors;
<a id='L24986' name='L24986'></a> 24986 
<a id='L24987' name='L24987'></a> 24987           <strong class='reserved'>if</strong> (x_dnd_in_progress &amp;&amp; x_dnd_update_tooltip)
<a id='L24988' name='L24988'></a> 24988             x_dnd_monitors = current_monitors;
<a id='L24989' name='L24989'></a> 24989 
<a id='L24990' name='L24990'></a> 24990           <strong class='reserved'>if</strong> (inev.ie.kind != <a href='../S/2231.html#L74' title='Defined at 74 in src/termhooks.h.'>NO_EVENT</a>)
<a id='L24991' name='L24991'></a> 24991             x_dnd_update_tooltip_now ();
<a id='L24992' name='L24992'></a> 24992         <em class='brace'>}</em>
<a id='L24993' name='L24993'></a> 24993 <em class='sharp'>#endif</em>
<a id='L24994' name='L24994'></a> 24994 <em class='sharp'>#ifdef</em> HAVE_XFIXES
<a id='L24995' name='L24995'></a> 24995       <strong class='reserved'>if</strong> (dpyinfo-&gt;xfixes_supported_p
<a id='L24996' name='L24996'></a> 24996           &amp;&amp; event-&gt;type == (dpyinfo-&gt;xfixes_event_base
<a id='L24997' name='L24997'></a> 24997                              + XFixesSelectionNotify)
<a id='L24998' name='L24998'></a> 24998           &amp;&amp; x_handle_selection_monitor_event (dpyinfo, event))
<a id='L24999' name='L24999'></a> 24999         <em class='comment'>/* GTK 3 crashes if an XFixesSelectionNotify arrives with a</em>
<a id='L25000' name='L25000'></a> 25000 <em class='comment'>           window other than the root window, because it wants to know</em>
<a id='L25001' name='L25001'></a> 25001 <em class='comment'>           the screen in order to determine the compositing manager</em>
<a id='L25002' name='L25002'></a> 25002 <em class='comment'>           selection name.  (bug#58584) */</em>
<a id='L25003' name='L25003'></a> 25003         *finish = <a href='../S/2289.html#L1136' title='Defined at 1136 in src/xterm.c.'>X_EVENT_DROP</a>;
<a id='L25004' name='L25004'></a> 25004 <em class='sharp'>#endif</em>
<a id='L25005' name='L25005'></a> 25005     OTHER:
<a id='L25006' name='L25006'></a> 25006 <em class='sharp'>#ifdef</em> USE_X_TOOLKIT
<a id='L25007' name='L25007'></a> 25007       <strong class='reserved'>if</strong> (*finish != <a href='../S/2289.html#L1136' title='Defined at 1136 in src/xterm.c.'>X_EVENT_DROP</a>)
<a id='L25008' name='L25008'></a> 25008         <em class='brace'>{</em>
<a id='L25009' name='L25009'></a> 25009           <em class='comment'>/* Ignore some obviously bogus ConfigureNotify events that</em>
<a id='L25010' name='L25010'></a> 25010 <em class='comment'>             other clients have been known to send Emacs.</em>
<a id='L25011' name='L25011'></a> 25011 <em class='comment'>             (bug#54051) */</em>
<a id='L25012' name='L25012'></a> 25012           <strong class='reserved'>if</strong> (event-&gt;type != ConfigureNotify
<a id='L25013' name='L25013'></a> 25013               || (event-&gt;xconfigure.width != 0
<a id='L25014' name='L25014'></a> 25014                   &amp;&amp; event-&gt;xconfigure.height != 0))
<a id='L25015' name='L25015'></a> 25015             <em class='brace'>{</em>
<a id='L25016' name='L25016'></a> 25016 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> USE_X_TOOLKIT &amp;&amp; <strong class='reserved'>defined</strong> HAVE_XINPUT2
<a id='L25017' name='L25017'></a> 25017               XtDispatchEvent (use_copy ? &amp;copy : (XEvent *) event);
<a id='L25018' name='L25018'></a> 25018 <em class='sharp'>#else</em>
<a id='L25019' name='L25019'></a> 25019               XtDispatchEvent ((XEvent *) event);
<a id='L25020' name='L25020'></a> 25020 <em class='sharp'>#endif</em>
<a id='L25021' name='L25021'></a> 25021             <em class='brace'>}</em>
<a id='L25022' name='L25022'></a> 25022         <em class='brace'>}</em>
<a id='L25023' name='L25023'></a> 25023 <em class='sharp'>#endif</em> <em class='comment'>/* USE_X_TOOLKIT */</em>
<a id='L25024' name='L25024'></a> 25024 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> USE_GTK &amp;&amp; !<strong class='reserved'>defined</strong> HAVE_GTK3 &amp;&amp; <strong class='reserved'>defined</strong> HAVE_XINPUT2
<a id='L25025' name='L25025'></a> 25025       <strong class='reserved'>if</strong> (*finish != <a href='../S/2289.html#L1136' title='Defined at 1136 in src/xterm.c.'>X_EVENT_DROP</a> &amp;&amp; copy)
<a id='L25026' name='L25026'></a> 25026         <em class='brace'>{</em>
<a id='L25027' name='L25027'></a> 25027           gtk_main_do_event (copy);
<a id='L25028' name='L25028'></a> 25028           *finish = <a href='../S/2289.html#L1136' title='Defined at 1136 in src/xterm.c.'>X_EVENT_DROP</a>;
<a id='L25029' name='L25029'></a> 25029         <em class='brace'>}</em>
<a id='L25030' name='L25030'></a> 25030 
<a id='L25031' name='L25031'></a> 25031       <strong class='reserved'>if</strong> (copy)
<a id='L25032' name='L25032'></a> 25032         gdk_event_free (copy);
<a id='L25033' name='L25033'></a> 25033 <em class='sharp'>#endif</em>
<a id='L25034' name='L25034'></a> 25034     <strong class='reserved'>break</strong>;
<a id='L25035' name='L25035'></a> 25035     <em class='brace'>}</em>
<a id='L25036' name='L25036'></a> 25036 
<a id='L25037' name='L25037'></a> 25037  done:
<a id='L25038' name='L25038'></a> 25038   <strong class='reserved'>if</strong> (inev.ie.kind != <a href='../S/2231.html#L74' title='Defined at 74 in src/termhooks.h.'>NO_EVENT</a>)
<a id='L25039' name='L25039'></a> 25039     <em class='brace'>{</em>
<a id='L25040' name='L25040'></a> 25040       <a href='../S/2104.html#L3691' title='Defined at 3691 in src/keyboard.c.'>kbd_buffer_store_buffered_event</a> (&amp;inev, hold_quit);
<a id='L25041' name='L25041'></a> 25041       count++;
<a id='L25042' name='L25042'></a> 25042     <em class='brace'>}</em>
<a id='L25043' name='L25043'></a> 25043 
<a id='L25044' name='L25044'></a> 25044   <strong class='reserved'>if</strong> (do_help
<a id='L25045' name='L25045'></a> 25045       &amp;&amp; !(hold_quit &amp;&amp; hold_quit-&gt;kind != <a href='../S/2231.html#L74' title='Defined at 74 in src/termhooks.h.'>NO_EVENT</a>))
<a id='L25046' name='L25046'></a> 25046     <em class='brace'>{</em>
<a id='L25047' name='L25047'></a> 25047       <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>;
<a id='L25048' name='L25048'></a> 25048 
<a id='L25049' name='L25049'></a> 25049       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L25050' name='L25050'></a> 25050         <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L25051' name='L25051'></a> 25051       <strong class='reserved'>else</strong>
<a id='L25052' name='L25052'></a> 25052         <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> = Qnil;
<a id='L25053' name='L25053'></a> 25053 
<a id='L25054' name='L25054'></a> 25054       <strong class='reserved'>if</strong> (do_help &gt; 0)
<a id='L25055' name='L25055'></a> 25055         <em class='brace'>{</em>
<a id='L25056' name='L25056'></a> 25056           any_help_event_p = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L25057' name='L25057'></a> 25057 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L25058' name='L25058'></a> 25058           <strong class='reserved'>if</strong> (gen_help_device)
<a id='L25059' name='L25059'></a> 25059             xi_handle_interaction (dpyinfo, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>,
<a id='L25060' name='L25060'></a> 25060                                    gen_help_device,
<a id='L25061' name='L25061'></a> 25061                                    gen_help_time);
<a id='L25062' name='L25062'></a> 25062 <em class='sharp'>#endif</em>
<a id='L25063' name='L25063'></a> 25063           <a href='../D/12040.html' title='Multiple defined in 2 places.'>gen_help_event</a> (help_echo_string, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, help_echo_window,
<a id='L25064' name='L25064'></a> 25064                           help_echo_object, help_echo_pos);
<a id='L25065' name='L25065'></a> 25065         <em class='brace'>}</em>
<a id='L25066' name='L25066'></a> 25066       <strong class='reserved'>else</strong>
<a id='L25067' name='L25067'></a> 25067         <em class='brace'>{</em>
<a id='L25068' name='L25068'></a> 25068           help_echo_string = Qnil;
<a id='L25069' name='L25069'></a> 25069           <a href='../D/12040.html' title='Multiple defined in 2 places.'>gen_help_event</a> (Qnil, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, Qnil, Qnil, 0);
<a id='L25070' name='L25070'></a> 25070         <em class='brace'>}</em>
<a id='L25071' name='L25071'></a> 25071       count++;
<a id='L25072' name='L25072'></a> 25072     <em class='brace'>}</em>
<a id='L25073' name='L25073'></a> 25073 
<a id='L25074' name='L25074'></a> 25074 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XINPUT2 || <strong class='reserved'>defined</strong> HAVE_XKB || <strong class='reserved'>defined</strong> HAVE_X_I18N
<a id='L25075' name='L25075'></a> 25075   <a href='../D/5394.html' title='Multiple defined in 2 places.'>SAFE_FREE</a> ();
<a id='L25076' name='L25076'></a> 25076 <em class='sharp'>#endif</em>
<a id='L25077' name='L25077'></a> 25077 
<a id='L25078' name='L25078'></a> 25078   <strong class='reserved'>return</strong> count;
<a id='L25079' name='L25079'></a> 25079 <em class='brace'>}</em>
<a id='L25080' name='L25080'></a> 25080 
<a id='L25081' name='L25081'></a> 25081 <em class='comment'>/* Handles the XEvent EVENT on display DISPLAY.</em>
<a id='L25082' name='L25082'></a> 25082 <em class='comment'>   This is used for event loops outside the normal event handling,</em>
<a id='L25083' name='L25083'></a> 25083 <em class='comment'>   i.e. looping while a popup menu or a dialog is posted.</em>
<a id='L25084' name='L25084'></a> 25084 <em class='comment'></em>
<a id='L25085' name='L25085'></a> 25085 <em class='comment'>   Returns the value handle_one_xevent sets in the finish argument.  */</em>
<a id='L25086' name='L25086'></a> 25086 
<a id='L25087' name='L25087'></a> 25087 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L25088' name='L25088'></a> 25088 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L25089' name='L25089'></a> 25089 <em class='sharp'>#else</em>
<a id='L25090' name='L25090'></a> 25090 <strong class='reserved'>int</strong>
<a id='L25091' name='L25091'></a> 25091 <em class='sharp'>#endif</em>
<a id='L25092' name='L25092'></a> 25092 x_dispatch_event (XEvent *event, <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>)
<a id='L25093' name='L25093'></a> 25093 <em class='brace'>{</em>
<a id='L25094' name='L25094'></a> 25094   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L25095' name='L25095'></a> 25095   <strong class='reserved'>int</strong> finish = <a href='../S/2289.html#L1134' title='Defined at 1134 in src/xterm.c.'>X_EVENT_NORMAL</a>;
<a id='L25096' name='L25096'></a> 25096 
<a id='L25097' name='L25097'></a> 25097   dpyinfo = <a href='../S/2289.html#L6774' title='Defined at 6774 in src/xterm.c.'>x_display_info_for_display</a> (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L25098' name='L25098'></a> 25098 
<a id='L25099' name='L25099'></a> 25099   <strong class='reserved'>if</strong> (dpyinfo)
<a id='L25100' name='L25100'></a> 25100     <em class='brace'>{</em>
<a id='L25101' name='L25101'></a> 25101       <em class='comment'>/* Block input before calling x_dispatch_event.  */</em>
<a id='L25102' name='L25102'></a> 25102       <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L25103' name='L25103'></a> 25103       handle_one_xevent (dpyinfo, event, &amp;finish, 0);
<a id='L25104' name='L25104'></a> 25104       <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L25105' name='L25105'></a> 25105     <em class='brace'>}</em>
<a id='L25106' name='L25106'></a> 25106 
<a id='L25107' name='L25107'></a> 25107   <strong class='reserved'>return</strong> finish;
<a id='L25108' name='L25108'></a> 25108 <em class='brace'>}</em>
<a id='L25109' name='L25109'></a> 25109 
<a id='L25110' name='L25110'></a> 25110 <em class='comment'>/* Read events coming from the X server.</em>
<a id='L25111' name='L25111'></a> 25111 <em class='comment'>   Return as soon as there are no more events to be read.</em>
<a id='L25112' name='L25112'></a> 25112 <em class='comment'></em>
<a id='L25113' name='L25113'></a> 25113 <em class='comment'>   Return the number of characters stored into the buffer,</em>
<a id='L25114' name='L25114'></a> 25114 <em class='comment'>   thus pretending to be `read' (except the characters we store</em>
<a id='L25115' name='L25115'></a> 25115 <em class='comment'>   in the keyboard buffer can be multibyte, so are not necessarily</em>
<a id='L25116' name='L25116'></a> 25116 <em class='comment'>   C chars).  */</em>
<a id='L25117' name='L25117'></a> 25117 
<a id='L25118' name='L25118'></a> 25118 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L25119' name='L25119'></a> 25119 XTread_socket (<strong class='reserved'>struct</strong> <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a> *<a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>, <strong class='reserved'>struct</strong> <a href='../S/2231.html#L350' title='Defined at 350 in src/termhooks.h.'>input_event</a> *hold_quit)
<a id='L25120' name='L25120'></a> 25120 <em class='brace'>{</em>
<a id='L25121' name='L25121'></a> 25121   <strong class='reserved'>int</strong> count = 0;
<a id='L25122' name='L25122'></a> 25122   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> event_found = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L25123' name='L25123'></a> 25123   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo = <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;<a href='../S/2231.html#L518' title='Defined at 518 in src/termhooks.h.'>display_info</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L25124' name='L25124'></a> 25124 
<a id='L25125' name='L25125'></a> 25125   <em class='comment'>/* Don't allow XTread_socket to do anything if drag-and-drop is in</em>
<a id='L25126' name='L25126'></a> 25126 <em class='comment'>     progress.  If unblock_input causes XTread_socket to be called and</em>
<a id='L25127' name='L25127'></a> 25127 <em class='comment'>     read X events while the drag-and-drop event loop is in progress,</em>
<a id='L25128' name='L25128'></a> 25128 <em class='comment'>     things can go wrong very quick.</em>
<a id='L25129' name='L25129'></a> 25129 <em class='comment'></em>
<a id='L25130' name='L25130'></a> 25130 <em class='comment'>     When x_dnd_unwind_flag is true, the above doesn't apply, since</em>
<a id='L25131' name='L25131'></a> 25131 <em class='comment'>     the surrounding code takes special precautions to keep it safe.</em>
<a id='L25132' name='L25132'></a> 25132 <em class='comment'></em>
<a id='L25133' name='L25133'></a> 25133 <em class='comment'>     That doesn't matter for events from displays other than the</em>
<a id='L25134' name='L25134'></a> 25134 <em class='comment'>     display of the drag-and-drop operation, though.  */</em>
<a id='L25135' name='L25135'></a> 25135   <strong class='reserved'>if</strong> (!x_dnd_unwind_flag
<a id='L25136' name='L25136'></a> 25136       &amp;&amp; ((x_dnd_in_progress
<a id='L25137' name='L25137'></a> 25137            &amp;&amp; dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> == <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (x_dnd_frame))
<a id='L25138' name='L25138'></a> 25138           || (x_dnd_waiting_for_finish
<a id='L25139' name='L25139'></a> 25139               &amp;&amp; dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> == x_dnd_finish_display)))
<a id='L25140' name='L25140'></a> 25140     <strong class='reserved'>return</strong> 0;
<a id='L25141' name='L25141'></a> 25141 
<a id='L25142' name='L25142'></a> 25142   x_clean_failable_requests (dpyinfo);
<a id='L25143' name='L25143'></a> 25143 
<a id='L25144' name='L25144'></a> 25144   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L25145' name='L25145'></a> 25145 
<a id='L25146' name='L25146'></a> 25146   <em class='comment'>/* For debugging, this gives a way to fake an I/O error.  */</em>
<a id='L25147' name='L25147'></a> 25147   <strong class='reserved'>if</strong> (dpyinfo == XTread_socket_fake_io_error)
<a id='L25148' name='L25148'></a> 25148     <em class='brace'>{</em>
<a id='L25149' name='L25149'></a> 25149       XTread_socket_fake_io_error = 0;
<a id='L25150' name='L25150'></a> 25150       x_io_error_quitter (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L25151' name='L25151'></a> 25151     <em class='brace'>}</em>
<a id='L25152' name='L25152'></a> 25152 
<a id='L25153' name='L25153'></a> 25153 <em class='sharp'>#ifndef</em> USE_GTK
<a id='L25154' name='L25154'></a> 25154   <strong class='reserved'>while</strong> (XPending (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>))
<a id='L25155' name='L25155'></a> 25155     <em class='brace'>{</em>
<a id='L25156' name='L25156'></a> 25156       <strong class='reserved'>int</strong> finish;
<a id='L25157' name='L25157'></a> 25157       XEvent event;
<a id='L25158' name='L25158'></a> 25158 
<a id='L25159' name='L25159'></a> 25159       XNextEvent (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, &amp;event);
<a id='L25160' name='L25160'></a> 25160 
<a id='L25161' name='L25161'></a> 25161 <em class='sharp'>#ifdef</em> HAVE_X_I18N
<a id='L25162' name='L25162'></a> 25162       <em class='comment'>/* Filter events for the current X input method.  */</em>
<a id='L25163' name='L25163'></a> 25163 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L25164' name='L25164'></a> 25164       <strong class='reserved'>if</strong> (event.type != GenericEvent
<a id='L25165' name='L25165'></a> 25165           || !dpyinfo-&gt;supports_xi2
<a id='L25166' name='L25166'></a> 25166           || event.xgeneric.extension != dpyinfo-&gt;xi2_opcode)
<a id='L25167' name='L25167'></a> 25167         <em class='brace'>{</em>
<a id='L25168' name='L25168'></a> 25168           <em class='comment'>/* Input extension key events are filtered inside</em>
<a id='L25169' name='L25169'></a> 25169 <em class='comment'>             handle_one_xevent.  */</em>
<a id='L25170' name='L25170'></a> 25170 <em class='sharp'>#endif</em>
<a id='L25171' name='L25171'></a> 25171           <strong class='reserved'>if</strong> (x_filter_event (dpyinfo, &amp;event))
<a id='L25172' name='L25172'></a> 25172             <strong class='reserved'>continue</strong>;
<a id='L25173' name='L25173'></a> 25173 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L25174' name='L25174'></a> 25174         <em class='brace'>}</em>
<a id='L25175' name='L25175'></a> 25175 <em class='sharp'>#endif</em>
<a id='L25176' name='L25176'></a> 25176 <em class='sharp'>#endif</em>
<a id='L25177' name='L25177'></a> 25177       event_found = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L25178' name='L25178'></a> 25178 
<a id='L25179' name='L25179'></a> 25179       count += handle_one_xevent (dpyinfo, &amp;event, &amp;finish, hold_quit);
<a id='L25180' name='L25180'></a> 25180 
<a id='L25181' name='L25181'></a> 25181       <strong class='reserved'>if</strong> (finish == <a href='../S/2289.html#L1135' title='Defined at 1135 in src/xterm.c.'>X_EVENT_GOTO_OUT</a>)
<a id='L25182' name='L25182'></a> 25182         <strong class='reserved'>break</strong>;
<a id='L25183' name='L25183'></a> 25183     <em class='brace'>}</em>
<a id='L25184' name='L25184'></a> 25184 
<a id='L25185' name='L25185'></a> 25185 <em class='sharp'>#else</em> <em class='comment'>/* USE_GTK */</em>
<a id='L25186' name='L25186'></a> 25186 
<a id='L25187' name='L25187'></a> 25187   <em class='comment'>/* For GTK we must use the GTK event loop.  But XEvents gets passed</em>
<a id='L25188' name='L25188'></a> 25188 <em class='comment'>     to our filter function above, and then to the big event switch.</em>
<a id='L25189' name='L25189'></a> 25189 <em class='comment'>     We use a bunch of globals to communicate with our filter function,</em>
<a id='L25190' name='L25190'></a> 25190 <em class='comment'>     that is kind of ugly, but it works.</em>
<a id='L25191' name='L25191'></a> 25191 <em class='comment'></em>
<a id='L25192' name='L25192'></a> 25192 <em class='comment'>     There is no way to do one display at the time, GTK just does events</em>
<a id='L25193' name='L25193'></a> 25193 <em class='comment'>     from all displays.  */</em>
<a id='L25194' name='L25194'></a> 25194 
<a id='L25195' name='L25195'></a> 25195   <strong class='reserved'>while</strong> (gtk_events_pending ())
<a id='L25196' name='L25196'></a> 25196     <em class='brace'>{</em>
<a id='L25197' name='L25197'></a> 25197       current_count = count;
<a id='L25198' name='L25198'></a> 25198       current_hold_quit = hold_quit;
<a id='L25199' name='L25199'></a> 25199 
<a id='L25200' name='L25200'></a> 25200       gtk_main_iteration ();
<a id='L25201' name='L25201'></a> 25201 
<a id='L25202' name='L25202'></a> 25202       count = current_count;
<a id='L25203' name='L25203'></a> 25203       current_count = -1;
<a id='L25204' name='L25204'></a> 25204       current_hold_quit = 0;
<a id='L25205' name='L25205'></a> 25205 
<a id='L25206' name='L25206'></a> 25206       <strong class='reserved'>if</strong> (current_finish == <a href='../S/2289.html#L1135' title='Defined at 1135 in src/xterm.c.'>X_EVENT_GOTO_OUT</a>)
<a id='L25207' name='L25207'></a> 25207         <strong class='reserved'>break</strong>;
<a id='L25208' name='L25208'></a> 25208     <em class='brace'>}</em>
<a id='L25209' name='L25209'></a> 25209 
<a id='L25210' name='L25210'></a> 25210   <em class='comment'>/* Now see if `xg_pending_quit_event' was set.  */</em>
<a id='L25211' name='L25211'></a> 25211   <strong class='reserved'>if</strong> (xg_pending_quit_event.kind != <a href='../S/2231.html#L74' title='Defined at 74 in src/termhooks.h.'>NO_EVENT</a>)
<a id='L25212' name='L25212'></a> 25212     <em class='brace'>{</em>
<a id='L25213' name='L25213'></a> 25213       <em class='comment'>/* Check that the frame is still valid.  It could have been</em>
<a id='L25214' name='L25214'></a> 25214 <em class='comment'>         deleted between now and the time the event was recorded.  */</em>
<a id='L25215' name='L25215'></a> 25215       <strong class='reserved'>if</strong> (<a href='../S/2183.html#L1028' title='Defined at 1028 in src/frame.h.'>FRAME_LIVE_P</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (xg_pending_quit_event.frame_or_window)))
<a id='L25216' name='L25216'></a> 25216         <em class='comment'>/* Store that event into hold_quit and clear the pending quit</em>
<a id='L25217' name='L25217'></a> 25217 <em class='comment'>           event.  */</em>
<a id='L25218' name='L25218'></a> 25218         *hold_quit = xg_pending_quit_event;
<a id='L25219' name='L25219'></a> 25219 
<a id='L25220' name='L25220'></a> 25220       <em class='comment'>/* If the frame is invalid, just clear the event as well.  */</em>
<a id='L25221' name='L25221'></a> 25221       xg_pending_quit_event.kind = <a href='../S/2231.html#L74' title='Defined at 74 in src/termhooks.h.'>NO_EVENT</a>;
<a id='L25222' name='L25222'></a> 25222     <em class='brace'>}</em>
<a id='L25223' name='L25223'></a> 25223 <em class='sharp'>#endif</em> <em class='comment'>/* USE_GTK */</em>
<a id='L25224' name='L25224'></a> 25224 
<a id='L25225' name='L25225'></a> 25225   <em class='comment'>/* On some systems, an X bug causes Emacs to get no more events</em>
<a id='L25226' name='L25226'></a> 25226 <em class='comment'>     when the window is destroyed.  Detect that.  (1994.)  */</em>
<a id='L25227' name='L25227'></a> 25227   <strong class='reserved'>if</strong> (! event_found)
<a id='L25228' name='L25228'></a> 25228     <em class='brace'>{</em>
<a id='L25229' name='L25229'></a> 25229       <em class='comment'>/* Emacs and the X Server eats up CPU time if XNoOp is done every time.</em>
<a id='L25230' name='L25230'></a> 25230 <em class='comment'>         One XNOOP in 100 loops will make Emacs terminate.</em>
<a id='L25231' name='L25231'></a> 25231 <em class='comment'>         B. Bretthauer, 1994 */</em>
<a id='L25232' name='L25232'></a> 25232       x_noop_count++;
<a id='L25233' name='L25233'></a> 25233       <strong class='reserved'>if</strong> (x_noop_count &gt;= 100)
<a id='L25234' name='L25234'></a> 25234         <em class='brace'>{</em>
<a id='L25235' name='L25235'></a> 25235           x_noop_count=0;
<a id='L25236' name='L25236'></a> 25236 
<a id='L25237' name='L25237'></a> 25237           <strong class='reserved'>if</strong> (next_noop_dpyinfo == 0)
<a id='L25238' name='L25238'></a> 25238             next_noop_dpyinfo = x_display_list;
<a id='L25239' name='L25239'></a> 25239 
<a id='L25240' name='L25240'></a> 25240           XNoOp (next_noop_dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L25241' name='L25241'></a> 25241 
<a id='L25242' name='L25242'></a> 25242           <em class='comment'>/* Each time we get here, cycle through the displays now open.  */</em>
<a id='L25243' name='L25243'></a> 25243           next_noop_dpyinfo = next_noop_dpyinfo-&gt;next;
<a id='L25244' name='L25244'></a> 25244         <em class='brace'>}</em>
<a id='L25245' name='L25245'></a> 25245     <em class='brace'>}</em>
<a id='L25246' name='L25246'></a> 25246 
<a id='L25247' name='L25247'></a> 25247   <em class='comment'>/* If the focus was just given to an auto-raising frame,</em>
<a id='L25248' name='L25248'></a> 25248 <em class='comment'>     raise it now.  FIXME: handle more than one such frame.  */</em>
<a id='L25249' name='L25249'></a> 25249   <strong class='reserved'>if</strong> (dpyinfo-&gt;x_pending_autoraise_frame)
<a id='L25250' name='L25250'></a> 25250     <em class='brace'>{</em>
<a id='L25251' name='L25251'></a> 25251       x_raise_frame (dpyinfo-&gt;x_pending_autoraise_frame);
<a id='L25252' name='L25252'></a> 25252       dpyinfo-&gt;x_pending_autoraise_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L25253' name='L25253'></a> 25253     <em class='brace'>}</em>
<a id='L25254' name='L25254'></a> 25254 
<a id='L25255' name='L25255'></a> 25255   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L25256' name='L25256'></a> 25256 
<a id='L25257' name='L25257'></a> 25257   <strong class='reserved'>return</strong> count;
<a id='L25258' name='L25258'></a> 25258 <em class='brace'>}</em>
<a id='L25259' name='L25259'></a> 25259 
<a id='L25260' name='L25260'></a> 25260 
<a id='L25261' name='L25261'></a> 25261 
<a id='L25262' name='L25262'></a> 25262 
<a id='L25263' name='L25263'></a> 25263 <em class='comment'>/***********************************************************************</em>
<a id='L25264' name='L25264'></a> 25264 <em class='comment'>                             Text Cursor</em>
<a id='L25265' name='L25265'></a> 25265 <em class='comment'> ***********************************************************************/</em>
<a id='L25266' name='L25266'></a> 25266 
<a id='L25267' name='L25267'></a> 25267 <em class='comment'>/* Set clipping for output in glyph row ROW.  W is the window in which</em>
<a id='L25268' name='L25268'></a> 25268 <em class='comment'>   we operate.  GC is the graphics context to set clipping in.</em>
<a id='L25269' name='L25269'></a> 25269 <em class='comment'></em>
<a id='L25270' name='L25270'></a> 25270 <em class='comment'>   ROW may be a text row or, e.g., a mode line.  Text rows must be</em>
<a id='L25271' name='L25271'></a> 25271 <em class='comment'>   clipped to the interior of the window dedicated to text display,</em>
<a id='L25272' name='L25272'></a> 25272 <em class='comment'>   mode lines must be clipped to the whole window.  */</em>
<a id='L25273' name='L25273'></a> 25273 
<a id='L25274' name='L25274'></a> 25274 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L25275' name='L25275'></a> 25275 x_clip_to_row (<strong class='reserved'>struct</strong> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> *w, <strong class='reserved'>struct</strong> <a href='../S/2315.html#L892' title='Defined at 892 in src/dispextern.h.'>glyph_row</a> *row,
<a id='L25276' name='L25276'></a> 25276                <strong class='reserved'>enum</strong> <a href='../S/2315.html#L855' title='Defined at 855 in src/dispextern.h.'>glyph_row_area</a> area, <a href='../D/2619.html' title='Multiple defined in 2 places.'>GC</a> gc)
<a id='L25277' name='L25277'></a> 25277 <em class='brace'>{</em>
<a id='L25278' name='L25278'></a> 25278   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../S/2183.html#L914' title='Defined at 914 in src/frame.h.'>WINDOW_FRAME</a> (w));
<a id='L25279' name='L25279'></a> 25279   <a href='../S/2150.html#L62' title='Defined at 62 in src/pgtkgui.h.'>XRectangle</a> clip_rect;
<a id='L25280' name='L25280'></a> 25280   <strong class='reserved'>int</strong> window_x, window_y, window_width;
<a id='L25281' name='L25281'></a> 25281 
<a id='L25282' name='L25282'></a> 25282   <a href='../S/2224.html#L1418' title='Defined at 1418 in src/xdisp.c.'>window_box</a> (w, area, &amp;window_x, &amp;window_y, &amp;window_width, 0);
<a id='L25283' name='L25283'></a> 25283 
<a id='L25284' name='L25284'></a> 25284   clip_rect.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = window_x;
<a id='L25285' name='L25285'></a> 25285   clip_rect.y = <a href='../S/2317.html#L1071' title='Defined at 1071 in src/window.h.'>WINDOW_TO_FRAME_PIXEL_Y</a> (w, <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> (0, row-&gt;y));
<a id='L25286' name='L25286'></a> 25286   clip_rect.y = <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> (clip_rect.y, window_y);
<a id='L25287' name='L25287'></a> 25287   clip_rect.width = window_width;
<a id='L25288' name='L25288'></a> 25288   clip_rect.height = row-&gt;visible_height;
<a id='L25289' name='L25289'></a> 25289 
<a id='L25290' name='L25290'></a> 25290   <a href='../S/2289.html#L6374' title='Defined at 6374 in src/xterm.c.'>x_set_clip_rectangles</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, &amp;clip_rect, 1);
<a id='L25291' name='L25291'></a> 25291 <em class='brace'>}</em>
<a id='L25292' name='L25292'></a> 25292 
<a id='L25293' name='L25293'></a> 25293 
<a id='L25294' name='L25294'></a> 25294 <em class='comment'>/* Draw a hollow box cursor on window W in glyph row ROW.  */</em>
<a id='L25295' name='L25295'></a> 25295 
<a id='L25296' name='L25296'></a> 25296 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L25297' name='L25297'></a> 25297 x_draw_hollow_cursor (<strong class='reserved'>struct</strong> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> *w, <strong class='reserved'>struct</strong> <a href='../S/2315.html#L892' title='Defined at 892 in src/dispextern.h.'>glyph_row</a> *row)
<a id='L25298' name='L25298'></a> 25298 <em class='brace'>{</em>
<a id='L25299' name='L25299'></a> 25299   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../S/2183.html#L914' title='Defined at 914 in src/frame.h.'>WINDOW_FRAME</a> (w));
<a id='L25300' name='L25300'></a> 25300   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L25301' name='L25301'></a> 25301   <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy = <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L25302' name='L25302'></a> 25302   <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, wd, h;
<a id='L25303' name='L25303'></a> 25303   XGCValues xgcv;
<a id='L25304' name='L25304'></a> 25304   <strong class='reserved'>struct</strong> <a href='../S/2315.html#L454' title='Defined at 454 in src/dispextern.h.'>glyph</a> *cursor_glyph;
<a id='L25305' name='L25305'></a> 25305   <a href='../D/2619.html' title='Multiple defined in 2 places.'>GC</a> gc;
<a id='L25306' name='L25306'></a> 25306 
<a id='L25307' name='L25307'></a> 25307   <em class='comment'>/* Get the glyph the cursor is on.  If we can't tell because</em>
<a id='L25308' name='L25308'></a> 25308 <em class='comment'>     the current matrix is invalid or such, give up.  */</em>
<a id='L25309' name='L25309'></a> 25309   cursor_glyph = <a href='../S/2108.html#L7536' title='Defined at 7536 in src/window.c.'>get_phys_cursor_glyph</a> (w);
<a id='L25310' name='L25310'></a> 25310   <strong class='reserved'>if</strong> (cursor_glyph == <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>)
<a id='L25311' name='L25311'></a> 25311     <strong class='reserved'>return</strong>;
<a id='L25312' name='L25312'></a> 25312 
<a id='L25313' name='L25313'></a> 25313   <em class='comment'>/* Compute frame-relative coordinates for phys cursor.  */</em>
<a id='L25314' name='L25314'></a> 25314   <a href='../S/2224.html#L2647' title='Defined at 2647 in src/xdisp.c.'>get_phys_cursor_geometry</a> (w, row, cursor_glyph, &amp;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, &amp;y, &amp;h);
<a id='L25315' name='L25315'></a> 25315   wd = w-&gt;phys_cursor_width - 1;
<a id='L25316' name='L25316'></a> 25316 
<a id='L25317' name='L25317'></a> 25317   <em class='comment'>/* The foreground of cursor_gc is typically the same as the normal</em>
<a id='L25318' name='L25318'></a> 25318 <em class='comment'>     background color, which can cause the cursor box to be invisible.  */</em>
<a id='L25319' name='L25319'></a> 25319   xgcv.foreground = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;cursor_pixel;
<a id='L25320' name='L25320'></a> 25320   xgcv.line_width = 1;
<a id='L25321' name='L25321'></a> 25321   <strong class='reserved'>if</strong> (dpyinfo-&gt;scratch_cursor_gc)
<a id='L25322' name='L25322'></a> 25322     <a href='../S/2215.html#L250' title='Defined at 250 in src/w32term.c.'>XChangeGC</a> (dpy, dpyinfo-&gt;scratch_cursor_gc, <a href='../S/2315.html#L89' title='Defined at 89 in src/dispextern.h.'>GCForeground</a> | GCLineWidth, &amp;xgcv);
<a id='L25323' name='L25323'></a> 25323   <strong class='reserved'>else</strong>
<a id='L25324' name='L25324'></a> 25324     dpyinfo-&gt;scratch_cursor_gc = <a href='../S/2215.html#L260' title='Defined at 260 in src/w32term.c.'>XCreateGC</a> (dpy, <a href='../S/2212.html#L1352' title='Defined at 1352 in src/xterm.h.'>FRAME_X_DRAWABLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L25325' name='L25325'></a> 25325                                             <a href='../S/2315.html#L89' title='Defined at 89 in src/dispextern.h.'>GCForeground</a> | GCLineWidth, &amp;xgcv);
<a id='L25326' name='L25326'></a> 25326   gc = dpyinfo-&gt;scratch_cursor_gc;
<a id='L25327' name='L25327'></a> 25327 
<a id='L25328' name='L25328'></a> 25328   <em class='comment'>/* When on R2L character, show cursor at the right edge of the</em>
<a id='L25329' name='L25329'></a> 25329 <em class='comment'>     glyph, unless the cursor box is as wide as the glyph or wider</em>
<a id='L25330' name='L25330'></a> 25330 <em class='comment'>     (the latter happens when x-stretch-cursor is non-nil).  */</em>
<a id='L25331' name='L25331'></a> 25331   <strong class='reserved'>if</strong> ((cursor_glyph-&gt;resolved_level &amp; 1) != 0
<a id='L25332' name='L25332'></a> 25332       &amp;&amp; cursor_glyph-&gt;pixel_width &gt; wd)
<a id='L25333' name='L25333'></a> 25333     <em class='brace'>{</em>
<a id='L25334' name='L25334'></a> 25334       <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> += cursor_glyph-&gt;pixel_width - wd;
<a id='L25335' name='L25335'></a> 25335       <strong class='reserved'>if</strong> (wd &gt; 0)
<a id='L25336' name='L25336'></a> 25336         wd -= 1;
<a id='L25337' name='L25337'></a> 25337     <em class='brace'>}</em>
<a id='L25338' name='L25338'></a> 25338   <em class='comment'>/* Set clipping, draw the rectangle, and reset clipping again.  */</em>
<a id='L25339' name='L25339'></a> 25339   x_clip_to_row (w, row, <a href='../S/2315.html#L859' title='Defined at 859 in src/dispextern.h.'>TEXT_AREA</a>, gc);
<a id='L25340' name='L25340'></a> 25340   <a href='../S/2289.html#L6625' title='Defined at 6625 in src/xterm.c.'>x_draw_rectangle</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, wd, h - 1);
<a id='L25341' name='L25341'></a> 25341   <a href='../S/2289.html#L6390' title='Defined at 6390 in src/xterm.c.'>x_reset_clip_rectangles</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc);
<a id='L25342' name='L25342'></a> 25342 <em class='brace'>}</em>
<a id='L25343' name='L25343'></a> 25343 
<a id='L25344' name='L25344'></a> 25344 
<a id='L25345' name='L25345'></a> 25345 <em class='comment'>/* Draw a bar cursor on window W in glyph row ROW.</em>
<a id='L25346' name='L25346'></a> 25346 <em class='comment'></em>
<a id='L25347' name='L25347'></a> 25347 <em class='comment'>   Implementation note: One would like to draw a bar cursor with an</em>
<a id='L25348' name='L25348'></a> 25348 <em class='comment'>   angle equal to the one given by the font property XA_ITALIC_ANGLE.</em>
<a id='L25349' name='L25349'></a> 25349 <em class='comment'>   Unfortunately, I didn't find a font yet that has this property set.</em>
<a id='L25350' name='L25350'></a> 25350 <em class='comment'>   --gerd.  */</em>
<a id='L25351' name='L25351'></a> 25351 
<a id='L25352' name='L25352'></a> 25352 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L25353' name='L25353'></a> 25353 x_draw_bar_cursor (<strong class='reserved'>struct</strong> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> *w, <strong class='reserved'>struct</strong> <a href='../S/2315.html#L892' title='Defined at 892 in src/dispextern.h.'>glyph_row</a> *row, <strong class='reserved'>int</strong> width, <strong class='reserved'>enum</strong> <a href='../S/2315.html#L198' title='Defined at 198 in src/dispextern.h.'>text_cursor_kinds</a> kind)
<a id='L25354' name='L25354'></a> 25354 <em class='brace'>{</em>
<a id='L25355' name='L25355'></a> 25355   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (w-&gt;<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>);
<a id='L25356' name='L25356'></a> 25356   <strong class='reserved'>struct</strong> <a href='../S/2315.html#L454' title='Defined at 454 in src/dispextern.h.'>glyph</a> *cursor_glyph;
<a id='L25357' name='L25357'></a> 25357 
<a id='L25358' name='L25358'></a> 25358   <em class='comment'>/* If cursor is out of bounds, don't draw garbage.  This can happen</em>
<a id='L25359' name='L25359'></a> 25359 <em class='comment'>     in mini-buffer windows when switching between echo area glyphs</em>
<a id='L25360' name='L25360'></a> 25360 <em class='comment'>     and mini-buffer.  */</em>
<a id='L25361' name='L25361'></a> 25361   cursor_glyph = <a href='../S/2108.html#L7536' title='Defined at 7536 in src/window.c.'>get_phys_cursor_glyph</a> (w);
<a id='L25362' name='L25362'></a> 25362   <strong class='reserved'>if</strong> (cursor_glyph == <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>)
<a id='L25363' name='L25363'></a> 25363     <strong class='reserved'>return</strong>;
<a id='L25364' name='L25364'></a> 25364 
<a id='L25365' name='L25365'></a> 25365   <em class='comment'>/* Experimental avoidance of cursor on xwidget.  */</em>
<a id='L25366' name='L25366'></a> 25366   <strong class='reserved'>if</strong> (cursor_glyph-&gt;type == <a href='../S/2315.html#L431' title='Defined at 431 in src/dispextern.h.'>XWIDGET_GLYPH</a>)
<a id='L25367' name='L25367'></a> 25367     <strong class='reserved'>return</strong>;
<a id='L25368' name='L25368'></a> 25368 
<a id='L25369' name='L25369'></a> 25369   <em class='comment'>/* If on an image, draw like a normal cursor.  That's usually better</em>
<a id='L25370' name='L25370'></a> 25370 <em class='comment'>     visible than drawing a bar, esp. if the image is large so that</em>
<a id='L25371' name='L25371'></a> 25371 <em class='comment'>     the bar might not be in the window.  */</em>
<a id='L25372' name='L25372'></a> 25372   <strong class='reserved'>if</strong> (cursor_glyph-&gt;type == <a href='../S/2315.html#L425' title='Defined at 425 in src/dispextern.h.'>IMAGE_GLYPH</a>)
<a id='L25373' name='L25373'></a> 25373     <em class='brace'>{</em>
<a id='L25374' name='L25374'></a> 25374       <strong class='reserved'>struct</strong> <a href='../S/2315.html#L892' title='Defined at 892 in src/dispextern.h.'>glyph_row</a> *r;
<a id='L25375' name='L25375'></a> 25375       r = <a href='../D/3909.html' title='Multiple defined in 2 places.'>MATRIX_ROW</a> (w-&gt;current_matrix, w-&gt;phys_cursor.vpos);
<a id='L25376' name='L25376'></a> 25376       <a href='../S/2224.html#L33459' title='Defined at 33459 in src/xdisp.c.'>draw_phys_cursor_glyph</a> (w, r, <a href='../S/2315.html#L1326' title='Defined at 1326 in src/dispextern.h.'>DRAW_CURSOR</a>);
<a id='L25377' name='L25377'></a> 25377     <em class='brace'>}</em>
<a id='L25378' name='L25378'></a> 25378   <strong class='reserved'>else</strong>
<a id='L25379' name='L25379'></a> 25379     <em class='brace'>{</em>
<a id='L25380' name='L25380'></a> 25380       <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy = <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L25381' name='L25381'></a> 25381       <a href='../D/1653.html' title='Multiple defined in 2 places.'>Drawable</a> drawable = <a href='../S/2212.html#L1352' title='Defined at 1352 in src/xterm.h.'>FRAME_X_DRAWABLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L25382' name='L25382'></a> 25382       <a href='../D/2619.html' title='Multiple defined in 2 places.'>GC</a> gc = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;scratch_cursor_gc;
<a id='L25383' name='L25383'></a> 25383       <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> mask = <a href='../S/2315.html#L89' title='Defined at 89 in src/dispextern.h.'>GCForeground</a> | <a href='../S/2315.html#L90' title='Defined at 90 in src/dispextern.h.'>GCBackground</a> | <a href='../D/2628.html' title='Multiple defined in 5 places.'>GCGraphicsExposures</a>;
<a id='L25384' name='L25384'></a> 25384       <strong class='reserved'>struct</strong> <a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a> *<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a> = <a href='../S/2183.html#L1632' title='Defined at 1632 in src/frame.h.'>FACE_FROM_ID</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, cursor_glyph-&gt;<a href='../S/2315.html#L1878' title='Defined at 1878 in src/dispextern.h.'>face_id</a>);
<a id='L25385' name='L25385'></a> 25385       XGCValues xgcv;
<a id='L25386' name='L25386'></a> 25386 
<a id='L25387' name='L25387'></a> 25387       <em class='comment'>/* If the glyph's background equals the color we normally draw</em>
<a id='L25388' name='L25388'></a> 25388 <em class='comment'>         the bars cursor in, the bar cursor in its normal color is</em>
<a id='L25389' name='L25389'></a> 25389 <em class='comment'>         invisible.  Use the glyph's foreground color instead in this</em>
<a id='L25390' name='L25390'></a> 25390 <em class='comment'>         case, on the assumption that the glyph's colors are chosen so</em>
<a id='L25391' name='L25391'></a> 25391 <em class='comment'>         that the glyph is legible.  */</em>
<a id='L25392' name='L25392'></a> 25392       <strong class='reserved'>if</strong> (<a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;background == <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;cursor_pixel)
<a id='L25393' name='L25393'></a> 25393         xgcv.background = xgcv.foreground = <a href='../S/2315.html#L1706' title='Defined at 1706 in src/dispextern.h.'>face</a>-&gt;foreground;
<a id='L25394' name='L25394'></a> 25394       <strong class='reserved'>else</strong>
<a id='L25395' name='L25395'></a> 25395         xgcv.background = xgcv.foreground = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;cursor_pixel;
<a id='L25396' name='L25396'></a> 25396       xgcv.graphics_exposures = False;
<a id='L25397' name='L25397'></a> 25397       xgcv.line_width = 1;
<a id='L25398' name='L25398'></a> 25398 
<a id='L25399' name='L25399'></a> 25399       mask |= GCLineWidth;
<a id='L25400' name='L25400'></a> 25400 
<a id='L25401' name='L25401'></a> 25401       <strong class='reserved'>if</strong> (gc)
<a id='L25402' name='L25402'></a> 25402         <a href='../S/2215.html#L250' title='Defined at 250 in src/w32term.c.'>XChangeGC</a> (dpy, gc, mask, &amp;xgcv);
<a id='L25403' name='L25403'></a> 25403       <strong class='reserved'>else</strong>
<a id='L25404' name='L25404'></a> 25404         <em class='brace'>{</em>
<a id='L25405' name='L25405'></a> 25405           gc = <a href='../S/2215.html#L260' title='Defined at 260 in src/w32term.c.'>XCreateGC</a> (dpy, drawable, mask, &amp;xgcv);
<a id='L25406' name='L25406'></a> 25406           <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;scratch_cursor_gc = gc;
<a id='L25407' name='L25407'></a> 25407         <em class='brace'>}</em>
<a id='L25408' name='L25408'></a> 25408 
<a id='L25409' name='L25409'></a> 25409       x_clip_to_row (w, row, <a href='../S/2315.html#L859' title='Defined at 859 in src/dispextern.h.'>TEXT_AREA</a>, gc);
<a id='L25410' name='L25410'></a> 25410 
<a id='L25411' name='L25411'></a> 25411       <strong class='reserved'>if</strong> (kind == <a href='../S/2315.html#L204' title='Defined at 204 in src/dispextern.h.'>BAR_CURSOR</a>)
<a id='L25412' name='L25412'></a> 25412         <em class='brace'>{</em>
<a id='L25413' name='L25413'></a> 25413           <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = <a href='../S/2317.html#L1084' title='Defined at 1084 in src/window.h.'>WINDOW_TEXT_TO_FRAME_PIXEL_X</a> (w, w-&gt;phys_cursor.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>);
<a id='L25414' name='L25414'></a> 25414 
<a id='L25415' name='L25415'></a> 25415           <strong class='reserved'>if</strong> (width &lt; 0)
<a id='L25416' name='L25416'></a> 25416             width = <a href='../S/2183.html#L1373' title='Defined at 1373 in src/frame.h.'>FRAME_CURSOR_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L25417' name='L25417'></a> 25417           width = <a href='../D/14475.html' title='Multiple defined in 11 places.'>min</a> (cursor_glyph-&gt;pixel_width, width);
<a id='L25418' name='L25418'></a> 25418 
<a id='L25419' name='L25419'></a> 25419           w-&gt;phys_cursor_width = width;
<a id='L25420' name='L25420'></a> 25420 
<a id='L25421' name='L25421'></a> 25421           <em class='comment'>/* If the character under cursor is R2L, draw the bar cursor</em>
<a id='L25422' name='L25422'></a> 25422 <em class='comment'>             on the right of its glyph, rather than on the left.  */</em>
<a id='L25423' name='L25423'></a> 25423           <strong class='reserved'>if</strong> ((cursor_glyph-&gt;resolved_level &amp; 1) != 0)
<a id='L25424' name='L25424'></a> 25424             <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> += cursor_glyph-&gt;pixel_width - width;
<a id='L25425' name='L25425'></a> 25425 
<a id='L25426' name='L25426'></a> 25426           <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>,
<a id='L25427' name='L25427'></a> 25427                             <a href='../S/2317.html#L1071' title='Defined at 1071 in src/window.h.'>WINDOW_TO_FRAME_PIXEL_Y</a> (w, w-&gt;phys_cursor.y),
<a id='L25428' name='L25428'></a> 25428                             width, row-&gt;height, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L25429' name='L25429'></a> 25429         <em class='brace'>}</em>
<a id='L25430' name='L25430'></a> 25430       <strong class='reserved'>else</strong> <em class='comment'>/* HBAR_CURSOR */</em>
<a id='L25431' name='L25431'></a> 25431         <em class='brace'>{</em>
<a id='L25432' name='L25432'></a> 25432           <strong class='reserved'>int</strong> dummy_x, dummy_y, dummy_h;
<a id='L25433' name='L25433'></a> 25433           <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = <a href='../S/2317.html#L1084' title='Defined at 1084 in src/window.h.'>WINDOW_TEXT_TO_FRAME_PIXEL_X</a> (w, w-&gt;phys_cursor.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>);
<a id='L25434' name='L25434'></a> 25434 
<a id='L25435' name='L25435'></a> 25435           <strong class='reserved'>if</strong> (width &lt; 0)
<a id='L25436' name='L25436'></a> 25436             width = row-&gt;height;
<a id='L25437' name='L25437'></a> 25437 
<a id='L25438' name='L25438'></a> 25438           width = <a href='../D/14475.html' title='Multiple defined in 11 places.'>min</a> (row-&gt;height, width);
<a id='L25439' name='L25439'></a> 25439 
<a id='L25440' name='L25440'></a> 25440           <a href='../S/2224.html#L2647' title='Defined at 2647 in src/xdisp.c.'>get_phys_cursor_geometry</a> (w, row, cursor_glyph, &amp;dummy_x,
<a id='L25441' name='L25441'></a> 25441                                     &amp;dummy_y, &amp;dummy_h);
<a id='L25442' name='L25442'></a> 25442 
<a id='L25443' name='L25443'></a> 25443           <strong class='reserved'>if</strong> ((cursor_glyph-&gt;resolved_level &amp; 1) != 0
<a id='L25444' name='L25444'></a> 25444               &amp;&amp; cursor_glyph-&gt;pixel_width &gt; w-&gt;phys_cursor_width - 1)
<a id='L25445' name='L25445'></a> 25445             <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> += cursor_glyph-&gt;pixel_width - w-&gt;phys_cursor_width + 1;
<a id='L25446' name='L25446'></a> 25446           <a href='../S/2289.html#L6466' title='Defined at 6466 in src/xterm.c.'>x_fill_rectangle</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>,
<a id='L25447' name='L25447'></a> 25447                             <a href='../S/2317.html#L1071' title='Defined at 1071 in src/window.h.'>WINDOW_TO_FRAME_PIXEL_Y</a> (w, w-&gt;phys_cursor.y +
<a id='L25448' name='L25448'></a> 25448                                                      row-&gt;height - width),
<a id='L25449' name='L25449'></a> 25449                             w-&gt;phys_cursor_width - 1, width, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L25450' name='L25450'></a> 25450         <em class='brace'>}</em>
<a id='L25451' name='L25451'></a> 25451 
<a id='L25452' name='L25452'></a> 25452       <a href='../S/2289.html#L6390' title='Defined at 6390 in src/xterm.c.'>x_reset_clip_rectangles</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gc);
<a id='L25453' name='L25453'></a> 25453     <em class='brace'>}</em>
<a id='L25454' name='L25454'></a> 25454 <em class='brace'>}</em>
<a id='L25455' name='L25455'></a> 25455 
<a id='L25456' name='L25456'></a> 25456 
<a id='L25457' name='L25457'></a> 25457 <em class='comment'>/* RIF: Define cursor CURSOR on frame F.  */</em>
<a id='L25458' name='L25458'></a> 25458 
<a id='L25459' name='L25459'></a> 25459 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L25460' name='L25460'></a> 25460 x_define_frame_cursor (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/1990.html' title='Multiple defined in 8 places.'>Emacs_Cursor</a> cursor)
<a id='L25461' name='L25461'></a> 25461 <em class='brace'>{</em>
<a id='L25462' name='L25462'></a> 25462   <strong class='reserved'>if</strong> (!<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;pointer_invisible
<a id='L25463' name='L25463'></a> 25463       &amp;&amp; <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;current_cursor != cursor)
<a id='L25464' name='L25464'></a> 25464     XDefineCursor (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), cursor);
<a id='L25465' name='L25465'></a> 25465   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;current_cursor = cursor;
<a id='L25466' name='L25466'></a> 25466 <em class='brace'>}</em>
<a id='L25467' name='L25467'></a> 25467 
<a id='L25468' name='L25468'></a> 25468 
<a id='L25469' name='L25469'></a> 25469 <em class='comment'>/* RIF: Clear area on frame F.  */</em>
<a id='L25470' name='L25470'></a> 25470 
<a id='L25471' name='L25471'></a> 25471 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L25472' name='L25472'></a> 25472 x_clear_frame_area (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, <strong class='reserved'>int</strong> y, <strong class='reserved'>int</strong> width, <strong class='reserved'>int</strong> height)
<a id='L25473' name='L25473'></a> 25473 <em class='brace'>{</em>
<a id='L25474' name='L25474'></a> 25474   <a href='../S/2289.html#L11076' title='Defined at 11076 in src/xterm.c.'>x_clear_area</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y, width, height);
<a id='L25475' name='L25475'></a> 25475 <em class='brace'>}</em>
<a id='L25476' name='L25476'></a> 25476 
<a id='L25477' name='L25477'></a> 25477 
<a id='L25478' name='L25478'></a> 25478 <em class='comment'>/* RIF: Draw cursor on window W.  */</em>
<a id='L25479' name='L25479'></a> 25479 
<a id='L25480' name='L25480'></a> 25480 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L25481' name='L25481'></a> 25481 x_draw_window_cursor (<strong class='reserved'>struct</strong> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> *w, <strong class='reserved'>struct</strong> <a href='../S/2315.html#L892' title='Defined at 892 in src/dispextern.h.'>glyph_row</a> *<a href='../S/2315.html#L892' title='Defined at 892 in src/dispextern.h.'>glyph_row</a>, <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>,
<a id='L25482' name='L25482'></a> 25482                       <strong class='reserved'>int</strong> y, <strong class='reserved'>enum</strong> <a href='../S/2315.html#L198' title='Defined at 198 in src/dispextern.h.'>text_cursor_kinds</a> cursor_type,
<a id='L25483' name='L25483'></a> 25483                       <strong class='reserved'>int</strong> cursor_width, <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> on_p, <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> active_p)
<a id='L25484' name='L25484'></a> 25484 <em class='brace'>{</em>
<a id='L25485' name='L25485'></a> 25485 <em class='sharp'>#ifdef</em> HAVE_X_I18N
<a id='L25486' name='L25486'></a> 25486   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../S/2183.html#L914' title='Defined at 914 in src/frame.h.'>WINDOW_FRAME</a> (w));
<a id='L25487' name='L25487'></a> 25487 <em class='sharp'>#endif</em>
<a id='L25488' name='L25488'></a> 25488 
<a id='L25489' name='L25489'></a> 25489   <strong class='reserved'>if</strong> (on_p)
<a id='L25490' name='L25490'></a> 25490     <em class='brace'>{</em>
<a id='L25491' name='L25491'></a> 25491       w-&gt;phys_cursor_type = cursor_type;
<a id='L25492' name='L25492'></a> 25492       w-&gt;phys_cursor_on_p = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L25493' name='L25493'></a> 25493 
<a id='L25494' name='L25494'></a> 25494       <strong class='reserved'>if</strong> (<a href='../S/2315.html#L892' title='Defined at 892 in src/dispextern.h.'>glyph_row</a>-&gt;exact_window_width_line_p
<a id='L25495' name='L25495'></a> 25495           &amp;&amp; (<a href='../S/2315.html#L892' title='Defined at 892 in src/dispextern.h.'>glyph_row</a>-&gt;reversed_p
<a id='L25496' name='L25496'></a> 25496               ? (w-&gt;phys_cursor.hpos &lt; 0)
<a id='L25497' name='L25497'></a> 25497               : (w-&gt;phys_cursor.hpos &gt;= <a href='../S/2315.html#L892' title='Defined at 892 in src/dispextern.h.'>glyph_row</a>-&gt;used[<a href='../S/2315.html#L859' title='Defined at 859 in src/dispextern.h.'>TEXT_AREA</a>])))
<a id='L25498' name='L25498'></a> 25498         <em class='brace'>{</em>
<a id='L25499' name='L25499'></a> 25499           <a href='../S/2315.html#L892' title='Defined at 892 in src/dispextern.h.'>glyph_row</a>-&gt;cursor_in_fringe_p = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L25500' name='L25500'></a> 25500           <a href='../S/2354.html#L838' title='Defined at 838 in src/fringe.c.'>draw_fringe_bitmap</a> (w, <a href='../S/2315.html#L892' title='Defined at 892 in src/dispextern.h.'>glyph_row</a>, <a href='../S/2315.html#L892' title='Defined at 892 in src/dispextern.h.'>glyph_row</a>-&gt;reversed_p);
<a id='L25501' name='L25501'></a> 25501         <em class='brace'>}</em>
<a id='L25502' name='L25502'></a> 25502       <strong class='reserved'>else</strong>
<a id='L25503' name='L25503'></a> 25503         <em class='brace'>{</em>
<a id='L25504' name='L25504'></a> 25504           <strong class='reserved'>switch</strong> (cursor_type)
<a id='L25505' name='L25505'></a> 25505             <em class='brace'>{</em>
<a id='L25506' name='L25506'></a> 25506             <strong class='reserved'>case</strong> <a href='../S/2315.html#L203' title='Defined at 203 in src/dispextern.h.'>HOLLOW_BOX_CURSOR</a>:
<a id='L25507' name='L25507'></a> 25507               x_draw_hollow_cursor (w, <a href='../S/2315.html#L892' title='Defined at 892 in src/dispextern.h.'>glyph_row</a>);
<a id='L25508' name='L25508'></a> 25508               <strong class='reserved'>break</strong>;
<a id='L25509' name='L25509'></a> 25509 
<a id='L25510' name='L25510'></a> 25510             <strong class='reserved'>case</strong> <a href='../S/2315.html#L202' title='Defined at 202 in src/dispextern.h.'>FILLED_BOX_CURSOR</a>:
<a id='L25511' name='L25511'></a> 25511               <a href='../S/2224.html#L33459' title='Defined at 33459 in src/xdisp.c.'>draw_phys_cursor_glyph</a> (w, <a href='../S/2315.html#L892' title='Defined at 892 in src/dispextern.h.'>glyph_row</a>, <a href='../S/2315.html#L1326' title='Defined at 1326 in src/dispextern.h.'>DRAW_CURSOR</a>);
<a id='L25512' name='L25512'></a> 25512               <strong class='reserved'>break</strong>;
<a id='L25513' name='L25513'></a> 25513 
<a id='L25514' name='L25514'></a> 25514             <strong class='reserved'>case</strong> <a href='../S/2315.html#L204' title='Defined at 204 in src/dispextern.h.'>BAR_CURSOR</a>:
<a id='L25515' name='L25515'></a> 25515               x_draw_bar_cursor (w, <a href='../S/2315.html#L892' title='Defined at 892 in src/dispextern.h.'>glyph_row</a>, cursor_width, <a href='../S/2315.html#L204' title='Defined at 204 in src/dispextern.h.'>BAR_CURSOR</a>);
<a id='L25516' name='L25516'></a> 25516               <strong class='reserved'>break</strong>;
<a id='L25517' name='L25517'></a> 25517 
<a id='L25518' name='L25518'></a> 25518             <strong class='reserved'>case</strong> <a href='../S/2315.html#L205' title='Defined at 205 in src/dispextern.h.'>HBAR_CURSOR</a>:
<a id='L25519' name='L25519'></a> 25519               x_draw_bar_cursor (w, <a href='../S/2315.html#L892' title='Defined at 892 in src/dispextern.h.'>glyph_row</a>, cursor_width, <a href='../S/2315.html#L205' title='Defined at 205 in src/dispextern.h.'>HBAR_CURSOR</a>);
<a id='L25520' name='L25520'></a> 25520               <strong class='reserved'>break</strong>;
<a id='L25521' name='L25521'></a> 25521 
<a id='L25522' name='L25522'></a> 25522             <strong class='reserved'>case</strong> <a href='../S/2315.html#L201' title='Defined at 201 in src/dispextern.h.'>NO_CURSOR</a>:
<a id='L25523' name='L25523'></a> 25523               w-&gt;phys_cursor_width = 0;
<a id='L25524' name='L25524'></a> 25524               <strong class='reserved'>break</strong>;
<a id='L25525' name='L25525'></a> 25525 
<a id='L25526' name='L25526'></a> 25526             <strong class='reserved'>default</strong>:
<a id='L25527' name='L25527'></a> 25527               <a href='../D/10893.html' title='Multiple defined in 6 places.'>emacs_abort</a> ();
<a id='L25528' name='L25528'></a> 25528             <em class='brace'>}</em>
<a id='L25529' name='L25529'></a> 25529         <em class='brace'>}</em>
<a id='L25530' name='L25530'></a> 25530 
<a id='L25531' name='L25531'></a> 25531 <em class='sharp'>#ifdef</em> HAVE_X_I18N
<a id='L25532' name='L25532'></a> 25532       <strong class='reserved'>if</strong> (w == <a href='../D/7409.html' title='Multiple defined in 2 places.'>XWINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;selected_window))
<a id='L25533' name='L25533'></a> 25533         <a href='../S/2296.html#L3218' title='Defined at 3218 in src/xfns.c.'>xic_set_preeditarea</a> (w, <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y);
<a id='L25534' name='L25534'></a> 25534 <em class='sharp'>#endif</em>
<a id='L25535' name='L25535'></a> 25535     <em class='brace'>}</em>
<a id='L25536' name='L25536'></a> 25536 <em class='brace'>}</em>
<a id='L25537' name='L25537'></a> 25537 
<a id='L25538' name='L25538'></a> 25538 
<a id='L25539' name='L25539'></a> 25539 <em class='comment'>/* Icons.  */</em>
<a id='L25540' name='L25540'></a> 25540 
<a id='L25541' name='L25541'></a> 25541 <em class='comment'>/* Make the x-window of frame F use the gnu icon bitmap.  */</em>
<a id='L25542' name='L25542'></a> 25542 
<a id='L25543' name='L25543'></a> 25543 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L25544' name='L25544'></a> 25544 x_bitmap_icon (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> file)
<a id='L25545' name='L25545'></a> 25545 <em class='brace'>{</em>
<a id='L25546' name='L25546'></a> 25546   ptrdiff_t bitmap_id;
<a id='L25547' name='L25547'></a> 25547 
<a id='L25548' name='L25548'></a> 25548   <strong class='reserved'>if</strong> (<a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) == 0)
<a id='L25549' name='L25549'></a> 25549     <strong class='reserved'>return</strong> <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L25550' name='L25550'></a> 25550 
<a id='L25551' name='L25551'></a> 25551   <em class='comment'>/* Free up our existing icon bitmap and mask if any.  */</em>
<a id='L25552' name='L25552'></a> 25552   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;icon_bitmap &gt; 0)
<a id='L25553' name='L25553'></a> 25553     <a href='../S/2204.html#L1015' title='Defined at 1015 in src/image.c.'>image_destroy_bitmap</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;icon_bitmap);
<a id='L25554' name='L25554'></a> 25554   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;icon_bitmap = 0;
<a id='L25555' name='L25555'></a> 25555 
<a id='L25556' name='L25556'></a> 25556   <strong class='reserved'>if</strong> (<a href='../S/2267.html#L1597' title='Defined at 1597 in src/lisp.h.'>STRINGP</a> (file))
<a id='L25557' name='L25557'></a> 25557     <em class='brace'>{</em>
<a id='L25558' name='L25558'></a> 25558 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L25559' name='L25559'></a> 25559       <em class='comment'>/* Use gtk_window_set_icon_from_file () if available,</em>
<a id='L25560' name='L25560'></a> 25560 <em class='comment'>         It's not restricted to bitmaps */</em>
<a id='L25561' name='L25561'></a> 25561       <strong class='reserved'>if</strong> (<a href='../D/19919.html' title='Multiple defined in 2 places.'>xg_set_icon</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, file))
<a id='L25562' name='L25562'></a> 25562         <strong class='reserved'>return</strong> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L25563' name='L25563'></a> 25563 <em class='sharp'>#endif</em> <em class='comment'>/* USE_GTK */</em>
<a id='L25564' name='L25564'></a> 25564       bitmap_id = <a href='../S/2204.html#L678' title='Defined at 678 in src/image.c.'>image_create_bitmap_from_file</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, file);
<a id='L25565' name='L25565'></a> 25565       <a href='../S/2204.html#L1092' title='Defined at 1092 in src/image.c.'>x_create_bitmap_mask</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, bitmap_id);
<a id='L25566' name='L25566'></a> 25566     <em class='brace'>}</em>
<a id='L25567' name='L25567'></a> 25567   <strong class='reserved'>else</strong>
<a id='L25568' name='L25568'></a> 25568     <em class='brace'>{</em>
<a id='L25569' name='L25569'></a> 25569       <em class='comment'>/* Create the GNU bitmap and mask if necessary.  */</em>
<a id='L25570' name='L25570'></a> 25570       <strong class='reserved'>if</strong> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;icon_bitmap_id &lt; 0)
<a id='L25571' name='L25571'></a> 25571         <em class='brace'>{</em>
<a id='L25572' name='L25572'></a> 25572           ptrdiff_t rc = -1;
<a id='L25573' name='L25573'></a> 25573 
<a id='L25574' name='L25574'></a> 25574 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L25575' name='L25575'></a> 25575 
<a id='L25576' name='L25576'></a> 25576           <strong class='reserved'>if</strong> (<a href='../D/19919.html' title='Multiple defined in 2 places.'>xg_set_icon</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, xg_default_icon_file)
<a id='L25577' name='L25577'></a> 25577               || <a href='../D/19920.html' title='Multiple defined in 2 places.'>xg_set_icon_from_xpm_data</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gnu_xpm_bits))
<a id='L25578' name='L25578'></a> 25578             <em class='brace'>{</em>
<a id='L25579' name='L25579'></a> 25579               <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;icon_bitmap_id = -2;
<a id='L25580' name='L25580'></a> 25580               <strong class='reserved'>return</strong> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L25581' name='L25581'></a> 25581             <em class='brace'>}</em>
<a id='L25582' name='L25582'></a> 25582 
<a id='L25583' name='L25583'></a> 25583 <em class='sharp'>#elif</em> <strong class='reserved'>defined</strong> (HAVE_XPM) &amp;&amp; <strong class='reserved'>defined</strong> (HAVE_X_WINDOWS)
<a id='L25584' name='L25584'></a> 25584           <em class='comment'>/* This allocates too many colors.  */</em>
<a id='L25585' name='L25585'></a> 25585           <strong class='reserved'>if</strong> ((<a href='../S/2212.html#L1437' title='Defined at 1437 in src/xterm.h.'>FRAME_X_VISUAL_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;class == TrueColor
<a id='L25586' name='L25586'></a> 25586                || <a href='../S/2212.html#L1437' title='Defined at 1437 in src/xterm.h.'>FRAME_X_VISUAL_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;class == StaticColor
<a id='L25587' name='L25587'></a> 25587                || <a href='../S/2212.html#L1437' title='Defined at 1437 in src/xterm.h.'>FRAME_X_VISUAL_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;class == StaticGray)
<a id='L25588' name='L25588'></a> 25588               <em class='comment'>/* That pixmap needs about 240 colors, and we should</em>
<a id='L25589' name='L25589'></a> 25589 <em class='comment'>                 also leave some more space for other colors as</em>
<a id='L25590' name='L25590'></a> 25590 <em class='comment'>                 well.  */</em>
<a id='L25591' name='L25591'></a> 25591               || <a href='../S/2212.html#L1437' title='Defined at 1437 in src/xterm.h.'>FRAME_X_VISUAL_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;colormap_size &gt;= (240 * 4))
<a id='L25592' name='L25592'></a> 25592             <em class='brace'>{</em>
<a id='L25593' name='L25593'></a> 25593               rc = <a href='../S/2204.html#L5503' title='Defined at 5503 in src/image.c.'>x_create_bitmap_from_xpm_data</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, gnu_xpm_bits);
<a id='L25594' name='L25594'></a> 25594               <strong class='reserved'>if</strong> (rc != -1)
<a id='L25595' name='L25595'></a> 25595                 <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;icon_bitmap_id = rc;
<a id='L25596' name='L25596'></a> 25596             <em class='brace'>}</em>
<a id='L25597' name='L25597'></a> 25597 <em class='sharp'>#endif</em>
<a id='L25598' name='L25598'></a> 25598 
<a id='L25599' name='L25599'></a> 25599           <em class='comment'>/* If all else fails, use the (black and white) xbm image. */</em>
<a id='L25600' name='L25600'></a> 25600           <strong class='reserved'>if</strong> (rc == -1)
<a id='L25601' name='L25601'></a> 25601             <em class='brace'>{</em>
<a id='L25602' name='L25602'></a> 25602               rc = <a href='../S/2204.html#L499' title='Defined at 499 in src/image.c.'>image_create_bitmap_from_data</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>,
<a id='L25603' name='L25603'></a> 25603                                                   (<strong class='reserved'>char</strong> *) gnu_xbm_bits,
<a id='L25604' name='L25604'></a> 25604                                                   <a href='../S/2100.html#L321' title='Defined at 321 in src/emacs-icon.h.'>gnu_xbm_width</a>,
<a id='L25605' name='L25605'></a> 25605                                                   <a href='../S/2100.html#L322' title='Defined at 322 in src/emacs-icon.h.'>gnu_xbm_height</a>);
<a id='L25606' name='L25606'></a> 25606               <strong class='reserved'>if</strong> (rc == -1)
<a id='L25607' name='L25607'></a> 25607                 <strong class='reserved'>return</strong> <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L25608' name='L25608'></a> 25608 
<a id='L25609' name='L25609'></a> 25609               <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;icon_bitmap_id = rc;
<a id='L25610' name='L25610'></a> 25610               <a href='../S/2204.html#L1092' title='Defined at 1092 in src/image.c.'>x_create_bitmap_mask</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;icon_bitmap_id);
<a id='L25611' name='L25611'></a> 25611             <em class='brace'>}</em>
<a id='L25612' name='L25612'></a> 25612         <em class='brace'>}</em>
<a id='L25613' name='L25613'></a> 25613 
<a id='L25614' name='L25614'></a> 25614       <em class='comment'>/* The first time we create the GNU bitmap and mask,</em>
<a id='L25615' name='L25615'></a> 25615 <em class='comment'>         this increments the ref-count one extra time.</em>
<a id='L25616' name='L25616'></a> 25616 <em class='comment'>         As a result, the GNU bitmap and mask are never freed.</em>
<a id='L25617' name='L25617'></a> 25617 <em class='comment'>         That way, we don't have to worry about allocating it again.  */</em>
<a id='L25618' name='L25618'></a> 25618       <a href='../S/2204.html#L463' title='Defined at 463 in src/image.c.'>image_reference_bitmap</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;icon_bitmap_id);
<a id='L25619' name='L25619'></a> 25619 
<a id='L25620' name='L25620'></a> 25620       bitmap_id = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;icon_bitmap_id;
<a id='L25621' name='L25621'></a> 25621     <em class='brace'>}</em>
<a id='L25622' name='L25622'></a> 25622 
<a id='L25623' name='L25623'></a> 25623   x_wm_set_icon_pixmap (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, bitmap_id);
<a id='L25624' name='L25624'></a> 25624   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;icon_bitmap = bitmap_id;
<a id='L25625' name='L25625'></a> 25625 
<a id='L25626' name='L25626'></a> 25626   <strong class='reserved'>return</strong> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L25627' name='L25627'></a> 25627 <em class='brace'>}</em>
<a id='L25628' name='L25628'></a> 25628 
<a id='L25629' name='L25629'></a> 25629 
<a id='L25630' name='L25630'></a> 25630 <em class='comment'>/* Make the x-window of frame F use a rectangle with text.</em>
<a id='L25631' name='L25631'></a> 25631 <em class='comment'>   Use ICON_NAME as the text.  */</em>
<a id='L25632' name='L25632'></a> 25632 
<a id='L25633' name='L25633'></a> 25633 <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L25634' name='L25634'></a> 25634 x_text_icon (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <strong class='reserved'>const</strong> <strong class='reserved'>char</strong> *icon_name)
<a id='L25635' name='L25635'></a> 25635 <em class='brace'>{</em>
<a id='L25636' name='L25636'></a> 25636   <strong class='reserved'>if</strong> (<a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) == 0)
<a id='L25637' name='L25637'></a> 25637     <strong class='reserved'>return</strong> <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L25638' name='L25638'></a> 25638 
<a id='L25639' name='L25639'></a> 25639   <em class='brace'>{</em>
<a id='L25640' name='L25640'></a> 25640     XTextProperty text;
<a id='L25641' name='L25641'></a> 25641     text.<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a> = (<strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *) icon_name;
<a id='L25642' name='L25642'></a> 25642     text.encoding = XA_STRING;
<a id='L25643' name='L25643'></a> 25643     text.format = 8;
<a id='L25644' name='L25644'></a> 25644     text.nitems = strlen (icon_name);
<a id='L25645' name='L25645'></a> 25645     XSetWMIconName (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), &amp;text);
<a id='L25646' name='L25646'></a> 25646   <em class='brace'>}</em>
<a id='L25647' name='L25647'></a> 25647 
<a id='L25648' name='L25648'></a> 25648   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;icon_bitmap &gt; 0)
<a id='L25649' name='L25649'></a> 25649     <a href='../S/2204.html#L1015' title='Defined at 1015 in src/image.c.'>image_destroy_bitmap</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;icon_bitmap);
<a id='L25650' name='L25650'></a> 25650   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;icon_bitmap = 0;
<a id='L25651' name='L25651'></a> 25651   x_wm_set_icon_pixmap (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 0);
<a id='L25652' name='L25652'></a> 25652 
<a id='L25653' name='L25653'></a> 25653   <strong class='reserved'>return</strong> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L25654' name='L25654'></a> 25654 <em class='brace'>}</em>
<a id='L25655' name='L25655'></a> 25655 
<a id='L25656' name='L25656'></a> 25656 
<a id='L25657' name='L25657'></a> 25657 <strong class='reserved'>struct</strong> <a href='../R/18178.html' title='Multiple referred from 10 places.'>x_error_message_stack</a>
<a id='L25658' name='L25658'></a> 25658 <em class='brace'>{</em>
<a id='L25659' name='L25659'></a> 25659   <em class='comment'>/* Pointer to the error message of any error that was generated, or</em>
<a id='L25660' name='L25660'></a> 25660 <em class='comment'>     NULL.  */</em>
<a id='L25661' name='L25661'></a> 25661   <strong class='reserved'>char</strong> *string;
<a id='L25662' name='L25662'></a> 25662 
<a id='L25663' name='L25663'></a> 25663   <em class='comment'>/* The display this error handler applies to.  */</em>
<a id='L25664' name='L25664'></a> 25664   <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy;
<a id='L25665' name='L25665'></a> 25665 
<a id='L25666' name='L25666'></a> 25666   <em class='comment'>/* A function to call upon an error if non-NULL.  */</em>
<a id='L25667' name='L25667'></a> 25667   x_special_error_handler <a href='../D/12936.html' title='Multiple defined in 2 places.'>handler</a>;
<a id='L25668' name='L25668'></a> 25668 
<a id='L25669' name='L25669'></a> 25669   <em class='comment'>/* Some data to pass to that handler function.  */</em>
<a id='L25670' name='L25670'></a> 25670   <strong class='reserved'>void</strong> *handler_data;
<a id='L25671' name='L25671'></a> 25671 
<a id='L25672' name='L25672'></a> 25672   <em class='comment'>/* The previous handler in this stack.  */</em>
<a id='L25673' name='L25673'></a> 25673   <strong class='reserved'>struct</strong> <a href='../S/2289.html#L25657' title='Defined at 25657 in src/xterm.c.'>x_error_message_stack</a> *prev;
<a id='L25674' name='L25674'></a> 25674 
<a id='L25675' name='L25675'></a> 25675   <em class='comment'>/* The first request that this error handler applies to.  Keeping</em>
<a id='L25676' name='L25676'></a> 25676 <em class='comment'>     track of this allows us to avoid an XSync yet still have errors</em>
<a id='L25677' name='L25677'></a> 25677 <em class='comment'>     for previously made requests be handled correctly.  */</em>
<a id='L25678' name='L25678'></a> 25678   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> first_request;
<a id='L25679' name='L25679'></a> 25679 <em class='brace'>}</em>;
<a id='L25680' name='L25680'></a> 25680 
<a id='L25681' name='L25681'></a> 25681 <em class='comment'>/* Stack of X error message handlers.  Whenever an error is generated</em>
<a id='L25682' name='L25682'></a> 25682 <em class='comment'>   on a display, look in this stack for an appropriate error handler,</em>
<a id='L25683' name='L25683'></a> 25683 <em class='comment'>   set its `string' to the error message and call its `handler' with</em>
<a id='L25684' name='L25684'></a> 25684 <em class='comment'>   `handler_data'.  If no handler applies to the error, don't catch</em>
<a id='L25685' name='L25685'></a> 25685 <em class='comment'>   it, and let it crash Emacs instead.</em>
<a id='L25686' name='L25686'></a> 25686 <em class='comment'></em>
<a id='L25687' name='L25687'></a> 25687 <em class='comment'>   This used to be a pointer to a string in which any error would be</em>
<a id='L25688' name='L25688'></a> 25688 <em class='comment'>   placed before 2006.  */</em>
<a id='L25689' name='L25689'></a> 25689 <strong class='reserved'>static</strong> <strong class='reserved'>struct</strong> <a href='../S/2289.html#L25657' title='Defined at 25657 in src/xterm.c.'>x_error_message_stack</a> *x_error_message;
<a id='L25690' name='L25690'></a> 25690 
<a id='L25691' name='L25691'></a> 25691 <em class='comment'>/* The amount of items (depth) in that stack.  */</em>
<a id='L25692' name='L25692'></a> 25692 <strong class='reserved'>int</strong> x_error_message_count;
<a id='L25693' name='L25693'></a> 25693 
<a id='L25694' name='L25694'></a> 25694 <em class='comment'>/* Compare various request serials while handling wraparound.  Treat a</em>
<a id='L25695' name='L25695'></a> 25695 <em class='comment'>   difference of more than X_ULONG_MAX / 2 as wraparound.</em>
<a id='L25696' name='L25696'></a> 25696 <em class='comment'></em>
<a id='L25697' name='L25697'></a> 25697 <em class='comment'>   Note that these functions truncate serials to 32 bits before</em>
<a id='L25698' name='L25698'></a> 25698 <em class='comment'>   comparison.  */</em>
<a id='L25699' name='L25699'></a> 25699 
<a id='L25700' name='L25700'></a> 25700 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L25701' name='L25701'></a> 25701 x_is_serial_more_than (<strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> <a href='../D/8258.html' title='Multiple defined in 6 places.'>a</a>, <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> <a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>)
<a id='L25702' name='L25702'></a> 25702 <em class='brace'>{</em>
<a id='L25703' name='L25703'></a> 25703   <strong class='reserved'>if</strong> (<a href='../D/8258.html' title='Multiple defined in 6 places.'>a</a> &gt; <a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>)
<a id='L25704' name='L25704'></a> 25704     <strong class='reserved'>return</strong> <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L25705' name='L25705'></a> 25705 
<a id='L25706' name='L25706'></a> 25706   <strong class='reserved'>return</strong> (<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a> - <a href='../D/8258.html' title='Multiple defined in 6 places.'>a</a> &gt; <a href='../S/2212.html#L1276' title='Defined at 1276 in src/xterm.h.'>X_ULONG_MAX</a> / 2);
<a id='L25707' name='L25707'></a> 25707 <em class='brace'>}</em>
<a id='L25708' name='L25708'></a> 25708 
<a id='L25709' name='L25709'></a> 25709 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L25710' name='L25710'></a> 25710 x_is_serial_more_than_or_equal_to (<strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> <a href='../D/8258.html' title='Multiple defined in 6 places.'>a</a>, <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> <a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>)
<a id='L25711' name='L25711'></a> 25711 <em class='brace'>{</em>
<a id='L25712' name='L25712'></a> 25712   <strong class='reserved'>if</strong> (<a href='../D/8258.html' title='Multiple defined in 6 places.'>a</a> &gt;= <a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>)
<a id='L25713' name='L25713'></a> 25713     <strong class='reserved'>return</strong> <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L25714' name='L25714'></a> 25714 
<a id='L25715' name='L25715'></a> 25715   <strong class='reserved'>return</strong> (<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a> - <a href='../D/8258.html' title='Multiple defined in 6 places.'>a</a> &gt; <a href='../S/2212.html#L1276' title='Defined at 1276 in src/xterm.h.'>X_ULONG_MAX</a> / 2);
<a id='L25716' name='L25716'></a> 25716 <em class='brace'>}</em>
<a id='L25717' name='L25717'></a> 25717 
<a id='L25718' name='L25718'></a> 25718 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L25719' name='L25719'></a> 25719 x_is_serial_less_than (<strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> <a href='../D/8258.html' title='Multiple defined in 6 places.'>a</a>, <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> <a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>)
<a id='L25720' name='L25720'></a> 25720 <em class='brace'>{</em>
<a id='L25721' name='L25721'></a> 25721   <strong class='reserved'>if</strong> (<a href='../D/8258.html' title='Multiple defined in 6 places.'>a</a> &lt; <a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>)
<a id='L25722' name='L25722'></a> 25722     <strong class='reserved'>return</strong> <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L25723' name='L25723'></a> 25723 
<a id='L25724' name='L25724'></a> 25724   <strong class='reserved'>return</strong> (<a href='../D/8258.html' title='Multiple defined in 6 places.'>a</a> - <a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a> &gt; <a href='../S/2212.html#L1276' title='Defined at 1276 in src/xterm.h.'>X_ULONG_MAX</a> / 2);
<a id='L25725' name='L25725'></a> 25725 <em class='brace'>}</em>
<a id='L25726' name='L25726'></a> 25726 
<a id='L25727' name='L25727'></a> 25727 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L25728' name='L25728'></a> 25728 x_is_serial_less_than_or_equal_to (<strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> <a href='../D/8258.html' title='Multiple defined in 6 places.'>a</a>, <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> <a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>)
<a id='L25729' name='L25729'></a> 25729 <em class='brace'>{</em>
<a id='L25730' name='L25730'></a> 25730   <strong class='reserved'>if</strong> (<a href='../D/8258.html' title='Multiple defined in 6 places.'>a</a> &lt;= <a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>)
<a id='L25731' name='L25731'></a> 25731     <strong class='reserved'>return</strong> <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L25732' name='L25732'></a> 25732 
<a id='L25733' name='L25733'></a> 25733   <strong class='reserved'>return</strong> (<a href='../D/8258.html' title='Multiple defined in 6 places.'>a</a> - <a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a> &gt; <a href='../S/2212.html#L1276' title='Defined at 1276 in src/xterm.h.'>X_ULONG_MAX</a> / 2);
<a id='L25734' name='L25734'></a> 25734 <em class='brace'>}</em>
<a id='L25735' name='L25735'></a> 25735 
<a id='L25736' name='L25736'></a> 25736 <strong class='reserved'>static</strong> <strong class='reserved'>struct</strong> <a href='../S/2289.html#L25657' title='Defined at 25657 in src/xterm.c.'>x_error_message_stack</a> *
<a id='L25737' name='L25737'></a> 25737 x_find_error_handler (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy, XErrorEvent *event)
<a id='L25738' name='L25738'></a> 25738 <em class='brace'>{</em>
<a id='L25739' name='L25739'></a> 25739   <strong class='reserved'>struct</strong> <a href='../S/2289.html#L25657' title='Defined at 25657 in src/xterm.c.'>x_error_message_stack</a> *stack;
<a id='L25740' name='L25740'></a> 25740 
<a id='L25741' name='L25741'></a> 25741   stack = x_error_message;
<a id='L25742' name='L25742'></a> 25742 
<a id='L25743' name='L25743'></a> 25743   <strong class='reserved'>while</strong> (stack)
<a id='L25744' name='L25744'></a> 25744     <em class='brace'>{</em>
<a id='L25745' name='L25745'></a> 25745       <strong class='reserved'>if</strong> (x_is_serial_more_than_or_equal_to (event-&gt;serial,
<a id='L25746' name='L25746'></a> 25746                                              stack-&gt;first_request)
<a id='L25747' name='L25747'></a> 25747           &amp;&amp; dpy == stack-&gt;dpy)
<a id='L25748' name='L25748'></a> 25748         <strong class='reserved'>return</strong> stack;
<a id='L25749' name='L25749'></a> 25749 
<a id='L25750' name='L25750'></a> 25750       stack = stack-&gt;prev;
<a id='L25751' name='L25751'></a> 25751     <em class='brace'>}</em>
<a id='L25752' name='L25752'></a> 25752 
<a id='L25753' name='L25753'></a> 25753   <strong class='reserved'>return</strong> <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L25754' name='L25754'></a> 25754 <em class='brace'>}</em>
<a id='L25755' name='L25755'></a> 25755 
<a id='L25756' name='L25756'></a> 25756 <strong class='reserved'>void</strong>
<a id='L25757' name='L25757'></a> 25757 x_unwind_errors_to (<strong class='reserved'>int</strong> depth)
<a id='L25758' name='L25758'></a> 25758 <em class='brace'>{</em>
<a id='L25759' name='L25759'></a> 25759   <strong class='reserved'>while</strong> (x_error_message_count &gt; depth)
<a id='L25760' name='L25760'></a> 25760     <em class='comment'>/* This is safe to call because we check whether or not</em>
<a id='L25761' name='L25761'></a> 25761 <em class='comment'>       x_error_message-&gt;dpy is still alive before calling XSync.  */</em>
<a id='L25762' name='L25762'></a> 25762     x_uncatch_errors ();
<a id='L25763' name='L25763'></a> 25763 <em class='brace'>}</em>
<a id='L25764' name='L25764'></a> 25764 
<a id='L25765' name='L25765'></a> 25765 <em class='sharp'>#define</em> <a href='../R/6667.html' title='Multiple referred from 2 places.'>X_ERROR_MESSAGE_SIZE</a> 200
<a id='L25766' name='L25766'></a> 25766 
<a id='L25767' name='L25767'></a> 25767 <em class='comment'>/* An X error handler which stores the error message in the first</em>
<a id='L25768' name='L25768'></a> 25768 <em class='comment'>   applicable handler in the x_error_message stack.  This is called</em>
<a id='L25769' name='L25769'></a> 25769 <em class='comment'>   from *x_error_handler if an x_catch_errors for DISPLAY is in</em>
<a id='L25770' name='L25770'></a> 25770 <em class='comment'>   effect.  */</em>
<a id='L25771' name='L25771'></a> 25771 
<a id='L25772' name='L25772'></a> 25772 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L25773' name='L25773'></a> 25773 x_error_catcher (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, XErrorEvent *event,
<a id='L25774' name='L25774'></a> 25774                  <strong class='reserved'>struct</strong> <a href='../S/2289.html#L25657' title='Defined at 25657 in src/xterm.c.'>x_error_message_stack</a> *stack)
<a id='L25775' name='L25775'></a> 25775 <em class='brace'>{</em>
<a id='L25776' name='L25776'></a> 25776   <strong class='reserved'>char</strong> buf[<a href='../S/2289.html#L25765' title='Defined at 25765 in src/xterm.c.'>X_ERROR_MESSAGE_SIZE</a>];
<a id='L25777' name='L25777'></a> 25777 
<a id='L25778' name='L25778'></a> 25778   XGetErrorText (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, event-&gt;error_code,
<a id='L25779' name='L25779'></a> 25779                  buf, <a href='../S/2289.html#L25765' title='Defined at 25765 in src/xterm.c.'>X_ERROR_MESSAGE_SIZE</a>);
<a id='L25780' name='L25780'></a> 25780 
<a id='L25781' name='L25781'></a> 25781   <strong class='reserved'>if</strong> (stack-&gt;string)
<a id='L25782' name='L25782'></a> 25782     <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (stack-&gt;string);
<a id='L25783' name='L25783'></a> 25783 
<a id='L25784' name='L25784'></a> 25784   stack-&gt;string = <a href='../D/20121.html' title='Multiple defined in 3 places.'>xstrdup</a> (buf);
<a id='L25785' name='L25785'></a> 25785 
<a id='L25786' name='L25786'></a> 25786   <strong class='reserved'>if</strong> (stack-&gt;<a href='../D/12936.html' title='Multiple defined in 2 places.'>handler</a>)
<a id='L25787' name='L25787'></a> 25787     stack-&gt;<a href='../D/12936.html' title='Multiple defined in 2 places.'>handler</a> (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, event, stack-&gt;string,
<a id='L25788' name='L25788'></a> 25788                     stack-&gt;handler_data);
<a id='L25789' name='L25789'></a> 25789 <em class='brace'>}</em>
<a id='L25790' name='L25790'></a> 25790 
<a id='L25791' name='L25791'></a> 25791 <em class='comment'>/* Begin trapping X errors for display DPY.</em>
<a id='L25792' name='L25792'></a> 25792 <em class='comment'></em>
<a id='L25793' name='L25793'></a> 25793 <em class='comment'>   After calling this function, X protocol errors generated on DPY no</em>
<a id='L25794' name='L25794'></a> 25794 <em class='comment'>   longer cause Emacs to exit; instead, they are recorded in an error</em>
<a id='L25795' name='L25795'></a> 25795 <em class='comment'>   handler pushed onto the stack `x_error_message'.</em>
<a id='L25796' name='L25796'></a> 25796 <em class='comment'></em>
<a id='L25797' name='L25797'></a> 25797 <em class='comment'>   Calling x_check_errors signals an Emacs error if an X error has</em>
<a id='L25798' name='L25798'></a> 25798 <em class='comment'>   occurred since the last call to x_catch_errors or x_check_errors.</em>
<a id='L25799' name='L25799'></a> 25799 <em class='comment'></em>
<a id='L25800' name='L25800'></a> 25800 <em class='comment'>   Calling x_uncatch_errors resumes the normal error handling,</em>
<a id='L25801' name='L25801'></a> 25801 <em class='comment'>   skipping an XSync if the last request made is known to have been</em>
<a id='L25802' name='L25802'></a> 25802 <em class='comment'>   processed.  Calling x_uncatch_errors_after_check is similar, but</em>
<a id='L25803' name='L25803'></a> 25803 <em class='comment'>   always skips an XSync to the server, and should be used only</em>
<a id='L25804' name='L25804'></a> 25804 <em class='comment'>   immediately after x_had_errors_p or x_check_errors, or when it is</em>
<a id='L25805' name='L25805'></a> 25805 <em class='comment'>   known that no requests have been made since the last x_catch_errors</em>
<a id='L25806' name='L25806'></a> 25806 <em class='comment'>   call for DPY.</em>
<a id='L25807' name='L25807'></a> 25807 <em class='comment'></em>
<a id='L25808' name='L25808'></a> 25808 <em class='comment'>   There is no need to use this mechanism for ignoring errors from</em>
<a id='L25809' name='L25809'></a> 25809 <em class='comment'>   single asynchronous requests, such as sending a ClientMessage to a</em>
<a id='L25810' name='L25810'></a> 25810 <em class='comment'>   window that might no longer exist.  Use</em>
<a id='L25811' name='L25811'></a> 25811 <em class='comment'>   x_ignore_errors_for_next_request (paired with</em>
<a id='L25812' name='L25812'></a> 25812 <em class='comment'>   x_stop_ignoring_errors) instead.  */</em>
<a id='L25813' name='L25813'></a> 25813 
<a id='L25814' name='L25814'></a> 25814 <strong class='reserved'>void</strong>
<a id='L25815' name='L25815'></a> 25815 x_catch_errors_with_handler (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy, x_special_error_handler <a href='../D/12936.html' title='Multiple defined in 2 places.'>handler</a>,
<a id='L25816' name='L25816'></a> 25816                              <strong class='reserved'>void</strong> *handler_data)
<a id='L25817' name='L25817'></a> 25817 <em class='brace'>{</em>
<a id='L25818' name='L25818'></a> 25818   <strong class='reserved'>struct</strong> <a href='../S/2289.html#L25657' title='Defined at 25657 in src/xterm.c.'>x_error_message_stack</a> *data;
<a id='L25819' name='L25819'></a> 25819 
<a id='L25820' name='L25820'></a> 25820   data = <a href='../S/2350.html#L802' title='Defined at 802 in src/alloc.c.'>xzalloc</a> (<strong class='reserved'>sizeof</strong> *data);
<a id='L25821' name='L25821'></a> 25821   data-&gt;dpy = dpy;
<a id='L25822' name='L25822'></a> 25822   data-&gt;<a href='../D/12936.html' title='Multiple defined in 2 places.'>handler</a> = <a href='../D/12936.html' title='Multiple defined in 2 places.'>handler</a>;
<a id='L25823' name='L25823'></a> 25823   data-&gt;handler_data = handler_data;
<a id='L25824' name='L25824'></a> 25824   data-&gt;prev = x_error_message;
<a id='L25825' name='L25825'></a> 25825   data-&gt;first_request = XNextRequest (dpy);
<a id='L25826' name='L25826'></a> 25826   x_error_message = data;
<a id='L25827' name='L25827'></a> 25827 
<a id='L25828' name='L25828'></a> 25828   ++x_error_message_count;
<a id='L25829' name='L25829'></a> 25829 <em class='brace'>}</em>
<a id='L25830' name='L25830'></a> 25830 
<a id='L25831' name='L25831'></a> 25831 <strong class='reserved'>void</strong>
<a id='L25832' name='L25832'></a> 25832 x_catch_errors (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy)
<a id='L25833' name='L25833'></a> 25833 <em class='brace'>{</em>
<a id='L25834' name='L25834'></a> 25834   x_catch_errors_with_handler (dpy, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L25835' name='L25835'></a> 25835 <em class='brace'>}</em>
<a id='L25836' name='L25836'></a> 25836 
<a id='L25837' name='L25837'></a> 25837 <em class='comment'>/* Return if errors for REQUEST should be ignored even if there is no</em>
<a id='L25838' name='L25838'></a> 25838 <em class='comment'>   error handler applied.  */</em>
<a id='L25839' name='L25839'></a> 25839 <strong class='reserved'>static</strong> <strong class='reserved'>struct</strong> <a href='../S/2212.html#L336' title='Defined at 336 in src/xterm.h.'>x_failable_request</a> *
<a id='L25840' name='L25840'></a> 25840 x_request_can_fail (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L25841' name='L25841'></a> 25841                     <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> <a href='../S/4039.html#L133' title='Defined at 133 in test/manual/etags/c-src/c.c.'>request</a>)
<a id='L25842' name='L25842'></a> 25842 <em class='brace'>{</em>
<a id='L25843' name='L25843'></a> 25843   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L336' title='Defined at 336 in src/xterm.h.'>x_failable_request</a> *failable_requests;
<a id='L25844' name='L25844'></a> 25844 
<a id='L25845' name='L25845'></a> 25845   <strong class='reserved'>for</strong> (failable_requests = dpyinfo-&gt;failable_requests;
<a id='L25846' name='L25846'></a> 25846        failable_requests &lt; dpyinfo-&gt;next_failable_request;
<a id='L25847' name='L25847'></a> 25847        failable_requests++)
<a id='L25848' name='L25848'></a> 25848     <em class='brace'>{</em>
<a id='L25849' name='L25849'></a> 25849       <strong class='reserved'>if</strong> (x_is_serial_more_than_or_equal_to (<a href='../S/4039.html#L133' title='Defined at 133 in test/manual/etags/c-src/c.c.'>request</a>,
<a id='L25850' name='L25850'></a> 25850                                              failable_requests-&gt;<a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a>)
<a id='L25851' name='L25851'></a> 25851           &amp;&amp; (!failable_requests-&gt;end
<a id='L25852' name='L25852'></a> 25852               || x_is_serial_less_than_or_equal_to (<a href='../S/4039.html#L133' title='Defined at 133 in test/manual/etags/c-src/c.c.'>request</a>,
<a id='L25853' name='L25853'></a> 25853                                                     failable_requests-&gt;end)))
<a id='L25854' name='L25854'></a> 25854         <strong class='reserved'>return</strong> failable_requests;
<a id='L25855' name='L25855'></a> 25855     <em class='brace'>}</em>
<a id='L25856' name='L25856'></a> 25856 
<a id='L25857' name='L25857'></a> 25857   <strong class='reserved'>return</strong> <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L25858' name='L25858'></a> 25858 <em class='brace'>}</em>
<a id='L25859' name='L25859'></a> 25859 
<a id='L25860' name='L25860'></a> 25860 <em class='comment'>/* Remove outdated request serials from</em>
<a id='L25861' name='L25861'></a> 25861 <em class='comment'>   dpyinfo-&gt;failable_requests.  */</em>
<a id='L25862' name='L25862'></a> 25862 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L25863' name='L25863'></a> 25863 x_clean_failable_requests (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo)
<a id='L25864' name='L25864'></a> 25864 <em class='brace'>{</em>
<a id='L25865' name='L25865'></a> 25865   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L336' title='Defined at 336 in src/xterm.h.'>x_failable_request</a> *<a href='../S/3358.html#L146' title='Defined at 146 in test/lisp/cedet/semantic-utest-ia-resources/testusing.hh.'>first</a>, *last;
<a id='L25866' name='L25866'></a> 25866 
<a id='L25867' name='L25867'></a> 25867   last = dpyinfo-&gt;next_failable_request;
<a id='L25868' name='L25868'></a> 25868 
<a id='L25869' name='L25869'></a> 25869   <strong class='reserved'>for</strong> (<a href='../S/3358.html#L146' title='Defined at 146 in test/lisp/cedet/semantic-utest-ia-resources/testusing.hh.'>first</a> = dpyinfo-&gt;failable_requests; <a href='../S/3358.html#L146' title='Defined at 146 in test/lisp/cedet/semantic-utest-ia-resources/testusing.hh.'>first</a> &lt; last; <a href='../S/3358.html#L146' title='Defined at 146 in test/lisp/cedet/semantic-utest-ia-resources/testusing.hh.'>first</a>++)
<a id='L25870' name='L25870'></a> 25870     <em class='brace'>{</em>
<a id='L25871' name='L25871'></a> 25871       <strong class='reserved'>if</strong> (x_is_serial_more_than (<a href='../S/3358.html#L146' title='Defined at 146 in test/lisp/cedet/semantic-utest-ia-resources/testusing.hh.'>first</a>-&gt;<a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a>,
<a id='L25872' name='L25872'></a> 25872                                  LastKnownRequestProcessed (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>))
<a id='L25873' name='L25873'></a> 25873           || !<a href='../S/3358.html#L146' title='Defined at 146 in test/lisp/cedet/semantic-utest-ia-resources/testusing.hh.'>first</a>-&gt;end
<a id='L25874' name='L25874'></a> 25874           || x_is_serial_more_than (<a href='../S/3358.html#L146' title='Defined at 146 in test/lisp/cedet/semantic-utest-ia-resources/testusing.hh.'>first</a>-&gt;end,
<a id='L25875' name='L25875'></a> 25875                                     LastKnownRequestProcessed (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>)))
<a id='L25876' name='L25876'></a> 25876         <strong class='reserved'>break</strong>;
<a id='L25877' name='L25877'></a> 25877     <em class='brace'>}</em>
<a id='L25878' name='L25878'></a> 25878 
<a id='L25879' name='L25879'></a> 25879   <strong class='reserved'>if</strong> (<a href='../S/3358.html#L146' title='Defined at 146 in test/lisp/cedet/semantic-utest-ia-resources/testusing.hh.'>first</a> != last)
<a id='L25880' name='L25880'></a> 25880     <a href='../S/2936.html#L81' title='Defined at 81 in lib/canonicalize-lgpl.c.'>memmove</a> (&amp;dpyinfo-&gt;failable_requests, <a href='../S/3358.html#L146' title='Defined at 146 in test/lisp/cedet/semantic-utest-ia-resources/testusing.hh.'>first</a>,
<a id='L25881' name='L25881'></a> 25881              <strong class='reserved'>sizeof</strong> *<a href='../S/3358.html#L146' title='Defined at 146 in test/lisp/cedet/semantic-utest-ia-resources/testusing.hh.'>first</a> * (last - <a href='../S/3358.html#L146' title='Defined at 146 in test/lisp/cedet/semantic-utest-ia-resources/testusing.hh.'>first</a>));
<a id='L25882' name='L25882'></a> 25882 
<a id='L25883' name='L25883'></a> 25883   dpyinfo-&gt;next_failable_request = (dpyinfo-&gt;failable_requests
<a id='L25884' name='L25884'></a> 25884                                     + (last - <a href='../S/3358.html#L146' title='Defined at 146 in test/lisp/cedet/semantic-utest-ia-resources/testusing.hh.'>first</a>));
<a id='L25885' name='L25885'></a> 25885 <em class='brace'>}</em>
<a id='L25886' name='L25886'></a> 25886 
<a id='L25887' name='L25887'></a> 25887 <em class='comment'>/* Protect a section of X requests: ignore errors generated by X</em>
<a id='L25888' name='L25888'></a> 25888 <em class='comment'>   requests made from now until `x_stop_ignoring_errors'.  Each call</em>
<a id='L25889' name='L25889'></a> 25889 <em class='comment'>   must be paired with a call to `x_stop_ignoring_errors', and</em>
<a id='L25890' name='L25890'></a> 25890 <em class='comment'>   recursive calls inside the protected section are not allowed.</em>
<a id='L25891' name='L25891'></a> 25891 <em class='comment'></em>
<a id='L25892' name='L25892'></a> 25892 <em class='comment'>   The advantage over x_catch_errors followed by</em>
<a id='L25893' name='L25893'></a> 25893 <em class='comment'>   x_uncatch_errors_after_check is that this function does not sync to</em>
<a id='L25894' name='L25894'></a> 25894 <em class='comment'>   catch errors if requests were made.  It should be used instead of</em>
<a id='L25895' name='L25895'></a> 25895 <em class='comment'>   those two functions for catching errors around requests that do not</em>
<a id='L25896' name='L25896'></a> 25896 <em class='comment'>   require a reply.</em>
<a id='L25897' name='L25897'></a> 25897 <em class='comment'></em>
<a id='L25898' name='L25898'></a> 25898 <em class='comment'>   As a special feature intended to support xselect.c,</em>
<a id='L25899' name='L25899'></a> 25899 <em class='comment'>   SELECTION_SERIAL may be an arbitrary number greater than zero: when</em>
<a id='L25900' name='L25900'></a> 25900 <em class='comment'>   that is the case, x_select_handle_selection_error is called with</em>
<a id='L25901' name='L25901'></a> 25901 <em class='comment'>   the specified number to delete the selection request that</em>
<a id='L25902' name='L25902'></a> 25902 <em class='comment'>   encountered the error.  */</em>
<a id='L25903' name='L25903'></a> 25903 
<a id='L25904' name='L25904'></a> 25904 <strong class='reserved'>void</strong>
<a id='L25905' name='L25905'></a> 25905 x_ignore_errors_for_next_request (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L25906' name='L25906'></a> 25906                                   <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> selection_serial)
<a id='L25907' name='L25907'></a> 25907 <em class='brace'>{</em>
<a id='L25908' name='L25908'></a> 25908   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L336' title='Defined at 336 in src/xterm.h.'>x_failable_request</a> *<a href='../S/4039.html#L133' title='Defined at 133 in test/manual/etags/c-src/c.c.'>request</a>, *<a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a>;
<a id='L25909' name='L25909'></a> 25909   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> next_request;
<a id='L25910' name='L25910'></a> 25910 <em class='sharp'>#ifdef</em> HAVE_GTK3
<a id='L25911' name='L25911'></a> 25911   GdkDisplay *gdpy;
<a id='L25912' name='L25912'></a> 25912 <em class='sharp'>#endif</em>
<a id='L25913' name='L25913'></a> 25913 
<a id='L25914' name='L25914'></a> 25914   <em class='comment'>/* This code is not reentrant, so be sure nothing calls it</em>
<a id='L25915' name='L25915'></a> 25915 <em class='comment'>     recursively in response to input.  */</em>
<a id='L25916' name='L25916'></a> 25916   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L25917' name='L25917'></a> 25917 
<a id='L25918' name='L25918'></a> 25918 <em class='sharp'>#ifdef</em> HAVE_GTK3
<a id='L25919' name='L25919'></a> 25919   <em class='comment'>/* GTK 3 tends to override our own error handler inside certain</em>
<a id='L25920' name='L25920'></a> 25920 <em class='comment'>     callbacks, which this can be called from.  Instead of trying to</em>
<a id='L25921' name='L25921'></a> 25921 <em class='comment'>     restore our own, add a trap for the following requests with</em>
<a id='L25922' name='L25922'></a> 25922 <em class='comment'>     GDK as well.  */</em>
<a id='L25923' name='L25923'></a> 25923 
<a id='L25924' name='L25924'></a> 25924   gdpy = gdk_x11_lookup_xdisplay (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L25925' name='L25925'></a> 25925 
<a id='L25926' name='L25926'></a> 25926   <strong class='reserved'>if</strong> (gdpy)
<a id='L25927' name='L25927'></a> 25927     gdk_x11_display_error_trap_push (gdpy);
<a id='L25928' name='L25928'></a> 25928 <em class='sharp'>#endif</em>
<a id='L25929' name='L25929'></a> 25929 
<a id='L25930' name='L25930'></a> 25930   <strong class='reserved'>if</strong> ((dpyinfo-&gt;next_failable_request
<a id='L25931' name='L25931'></a> 25931        != dpyinfo-&gt;failable_requests)
<a id='L25932' name='L25932'></a> 25932       &amp;&amp; (dpyinfo-&gt;next_failable_request - 1)-&gt;end == 0)
<a id='L25933' name='L25933'></a> 25933     <em class='comment'>/* A new sequence should never be started before an old one</em>
<a id='L25934' name='L25934'></a> 25934 <em class='comment'>       finishes.  Use `x_catch_errors' to nest error handlers.  */</em>
<a id='L25935' name='L25935'></a> 25935     <a href='../D/10893.html' title='Multiple defined in 6 places.'>emacs_abort</a> ();
<a id='L25936' name='L25936'></a> 25936 
<a id='L25937' name='L25937'></a> 25937   <a href='../S/4039.html#L133' title='Defined at 133 in test/manual/etags/c-src/c.c.'>request</a> = dpyinfo-&gt;next_failable_request;
<a id='L25938' name='L25938'></a> 25938   <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a> = dpyinfo-&gt;failable_requests + <a href='../S/2212.html#L95' title='Defined at 95 in src/xterm.h.'>N_FAILABLE_REQUESTS</a>;
<a id='L25939' name='L25939'></a> 25939   next_request = XNextRequest (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L25940' name='L25940'></a> 25940 
<a id='L25941' name='L25941'></a> 25941   <strong class='reserved'>if</strong> (<a href='../S/4039.html#L133' title='Defined at 133 in test/manual/etags/c-src/c.c.'>request</a> &gt;= <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a>)
<a id='L25942' name='L25942'></a> 25942     <em class='brace'>{</em>
<a id='L25943' name='L25943'></a> 25943       <em class='comment'>/* There is no point in making this extra sync if all requests</em>
<a id='L25944' name='L25944'></a> 25944 <em class='comment'>         are known to have been fully processed.  */</em>
<a id='L25945' name='L25945'></a> 25945       <strong class='reserved'>if</strong> ((LastKnownRequestProcessed (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>)
<a id='L25946' name='L25946'></a> 25946            != next_request - 1))
<a id='L25947' name='L25947'></a> 25947         <a href='../D/7378.html' title='Multiple defined in 3 places.'>XSync</a> (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, False);
<a id='L25948' name='L25948'></a> 25948 
<a id='L25949' name='L25949'></a> 25949       x_clean_failable_requests (dpyinfo);
<a id='L25950' name='L25950'></a> 25950       <a href='../S/4039.html#L133' title='Defined at 133 in test/manual/etags/c-src/c.c.'>request</a> = dpyinfo-&gt;next_failable_request;
<a id='L25951' name='L25951'></a> 25951     <em class='brace'>}</em>
<a id='L25952' name='L25952'></a> 25952 
<a id='L25953' name='L25953'></a> 25953   <strong class='reserved'>if</strong> (<a href='../S/4039.html#L133' title='Defined at 133 in test/manual/etags/c-src/c.c.'>request</a> &gt;= <a href='../D/14328.html' title='Multiple defined in 11 places.'>max</a>)
<a id='L25954' name='L25954'></a> 25954     <em class='comment'>/* A request should always be made immediately after calling this</em>
<a id='L25955' name='L25955'></a> 25955 <em class='comment'>       function.  */</em>
<a id='L25956' name='L25956'></a> 25956     <a href='../D/10893.html' title='Multiple defined in 6 places.'>emacs_abort</a> ();
<a id='L25957' name='L25957'></a> 25957 
<a id='L25958' name='L25958'></a> 25958   <a href='../S/4039.html#L133' title='Defined at 133 in test/manual/etags/c-src/c.c.'>request</a>-&gt;<a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a> = next_request;
<a id='L25959' name='L25959'></a> 25959   <a href='../S/4039.html#L133' title='Defined at 133 in test/manual/etags/c-src/c.c.'>request</a>-&gt;end = 0;
<a id='L25960' name='L25960'></a> 25960   <a href='../S/4039.html#L133' title='Defined at 133 in test/manual/etags/c-src/c.c.'>request</a>-&gt;selection_serial = selection_serial;
<a id='L25961' name='L25961'></a> 25961 
<a id='L25962' name='L25962'></a> 25962   dpyinfo-&gt;next_failable_request++;
<a id='L25963' name='L25963'></a> 25963 <em class='brace'>}</em>
<a id='L25964' name='L25964'></a> 25964 
<a id='L25965' name='L25965'></a> 25965 <strong class='reserved'>void</strong>
<a id='L25966' name='L25966'></a> 25966 x_stop_ignoring_errors (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo)
<a id='L25967' name='L25967'></a> 25967 <em class='brace'>{</em>
<a id='L25968' name='L25968'></a> 25968   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L336' title='Defined at 336 in src/xterm.h.'>x_failable_request</a> *range;
<a id='L25969' name='L25969'></a> 25969 <em class='sharp'>#ifdef</em> HAVE_GTK3
<a id='L25970' name='L25970'></a> 25970   GdkDisplay *gdpy;
<a id='L25971' name='L25971'></a> 25971 <em class='sharp'>#endif</em>
<a id='L25972' name='L25972'></a> 25972 
<a id='L25973' name='L25973'></a> 25973   range = dpyinfo-&gt;next_failable_request - 1;
<a id='L25974' name='L25974'></a> 25974   range-&gt;end = XNextRequest (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>) - 1;
<a id='L25975' name='L25975'></a> 25975 
<a id='L25976' name='L25976'></a> 25976   <em class='comment'>/* Abort if no request was made since</em>
<a id='L25977' name='L25977'></a> 25977 <em class='comment'>     `x_ignore_errors_for_next_request'.  */</em>
<a id='L25978' name='L25978'></a> 25978 
<a id='L25979' name='L25979'></a> 25979   <strong class='reserved'>if</strong> (x_is_serial_less_than (range-&gt;end, range-&gt;<a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a>))
<a id='L25980' name='L25980'></a> 25980     <a href='../D/10893.html' title='Multiple defined in 6 places.'>emacs_abort</a> ();
<a id='L25981' name='L25981'></a> 25981 
<a id='L25982' name='L25982'></a> 25982 <em class='sharp'>#ifdef</em> HAVE_GTK3
<a id='L25983' name='L25983'></a> 25983   gdpy = gdk_x11_lookup_xdisplay (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L25984' name='L25984'></a> 25984 
<a id='L25985' name='L25985'></a> 25985   <strong class='reserved'>if</strong> (gdpy)
<a id='L25986' name='L25986'></a> 25986     gdk_x11_display_error_trap_pop_ignored (gdpy);
<a id='L25987' name='L25987'></a> 25987 <em class='sharp'>#endif</em>
<a id='L25988' name='L25988'></a> 25988 
<a id='L25989' name='L25989'></a> 25989   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L25990' name='L25990'></a> 25990 <em class='brace'>}</em>
<a id='L25991' name='L25991'></a> 25991 
<a id='L25992' name='L25992'></a> 25992 <em class='comment'>/* Undo the last x_catch_errors call.</em>
<a id='L25993' name='L25993'></a> 25993 <em class='comment'>   DPY should be the display that was passed to x_catch_errors.</em>
<a id='L25994' name='L25994'></a> 25994 <em class='comment'></em>
<a id='L25995' name='L25995'></a> 25995 <em class='comment'>   This version should be used only if the immediately preceding</em>
<a id='L25996' name='L25996'></a> 25996 <em class='comment'>   X-protocol-related thing was x_check_errors or x_had_error_p, both</em>
<a id='L25997' name='L25997'></a> 25997 <em class='comment'>   of which issue XSync calls, so we don't need to re-sync here.  */</em>
<a id='L25998' name='L25998'></a> 25998 
<a id='L25999' name='L25999'></a> 25999 <strong class='reserved'>void</strong>
<a id='L26000' name='L26000'></a> 26000 x_uncatch_errors_after_check (<strong class='reserved'>void</strong>)
<a id='L26001' name='L26001'></a> 26001 <em class='brace'>{</em>
<a id='L26002' name='L26002'></a> 26002   <strong class='reserved'>struct</strong> <a href='../S/2289.html#L25657' title='Defined at 25657 in src/xterm.c.'>x_error_message_stack</a> *tmp;
<a id='L26003' name='L26003'></a> 26003 
<a id='L26004' name='L26004'></a> 26004   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L26005' name='L26005'></a> 26005   tmp = x_error_message;
<a id='L26006' name='L26006'></a> 26006   x_error_message = x_error_message-&gt;prev;
<a id='L26007' name='L26007'></a> 26007   --x_error_message_count;
<a id='L26008' name='L26008'></a> 26008   <strong class='reserved'>if</strong> (tmp-&gt;string)
<a id='L26009' name='L26009'></a> 26009     <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (tmp-&gt;string);
<a id='L26010' name='L26010'></a> 26010   <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (tmp);
<a id='L26011' name='L26011'></a> 26011   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L26012' name='L26012'></a> 26012 <em class='brace'>}</em>
<a id='L26013' name='L26013'></a> 26013 
<a id='L26014' name='L26014'></a> 26014 <em class='comment'>/* Undo the last x_catch_errors call.  */</em>
<a id='L26015' name='L26015'></a> 26015 
<a id='L26016' name='L26016'></a> 26016 <strong class='reserved'>void</strong>
<a id='L26017' name='L26017'></a> 26017 x_uncatch_errors (<strong class='reserved'>void</strong>)
<a id='L26018' name='L26018'></a> 26018 <em class='brace'>{</em>
<a id='L26019' name='L26019'></a> 26019   <strong class='reserved'>struct</strong> <a href='../S/2289.html#L25657' title='Defined at 25657 in src/xterm.c.'>x_error_message_stack</a> *tmp;
<a id='L26020' name='L26020'></a> 26020   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L26021' name='L26021'></a> 26021 
<a id='L26022' name='L26022'></a> 26022   <em class='comment'>/* In rare situations when running Emacs run in daemon mode,</em>
<a id='L26023' name='L26023'></a> 26023 <em class='comment'>     shutting down an emacsclient via delete-frame can cause</em>
<a id='L26024' name='L26024'></a> 26024 <em class='comment'>     x_uncatch_errors to be called when x_error_message is set to</em>
<a id='L26025' name='L26025'></a> 26025 <em class='comment'>     NULL.  */</em>
<a id='L26026' name='L26026'></a> 26026   <strong class='reserved'>if</strong> (x_error_message == <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>)
<a id='L26027' name='L26027'></a> 26027     <strong class='reserved'>return</strong>;
<a id='L26028' name='L26028'></a> 26028 
<a id='L26029' name='L26029'></a> 26029   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L26030' name='L26030'></a> 26030 
<a id='L26031' name='L26031'></a> 26031   dpyinfo = <a href='../S/2289.html#L6774' title='Defined at 6774 in src/xterm.c.'>x_display_info_for_display</a> (x_error_message-&gt;dpy);
<a id='L26032' name='L26032'></a> 26032 
<a id='L26033' name='L26033'></a> 26033   <em class='comment'>/* The display may have been closed before this function is called.</em>
<a id='L26034' name='L26034'></a> 26034 <em class='comment'>     Check if it is still open before calling XSync.  */</em>
<a id='L26035' name='L26035'></a> 26035   <strong class='reserved'>if</strong> (dpyinfo != 0
<a id='L26036' name='L26036'></a> 26036       <em class='comment'>/* There is no point in making this extra sync if all requests</em>
<a id='L26037' name='L26037'></a> 26037 <em class='comment'>         are known to have been fully processed.  */</em>
<a id='L26038' name='L26038'></a> 26038       &amp;&amp; (LastKnownRequestProcessed (x_error_message-&gt;dpy)
<a id='L26039' name='L26039'></a> 26039           != XNextRequest (x_error_message-&gt;dpy) - 1)
<a id='L26040' name='L26040'></a> 26040       <em class='comment'>/* Likewise if no request was made since the trap was</em>
<a id='L26041' name='L26041'></a> 26041 <em class='comment'>         installed.  */</em>
<a id='L26042' name='L26042'></a> 26042       &amp;&amp; (NextRequest (x_error_message-&gt;dpy)
<a id='L26043' name='L26043'></a> 26043           &gt; x_error_message-&gt;first_request))
<a id='L26044' name='L26044'></a> 26044     <em class='brace'>{</em>
<a id='L26045' name='L26045'></a> 26045       <a href='../D/7378.html' title='Multiple defined in 3 places.'>XSync</a> (x_error_message-&gt;dpy, False);
<a id='L26046' name='L26046'></a> 26046       x_clean_failable_requests (dpyinfo);
<a id='L26047' name='L26047'></a> 26047     <em class='brace'>}</em>
<a id='L26048' name='L26048'></a> 26048 
<a id='L26049' name='L26049'></a> 26049   tmp = x_error_message;
<a id='L26050' name='L26050'></a> 26050   x_error_message = x_error_message-&gt;prev;
<a id='L26051' name='L26051'></a> 26051   --x_error_message_count;
<a id='L26052' name='L26052'></a> 26052   <strong class='reserved'>if</strong> (tmp-&gt;string)
<a id='L26053' name='L26053'></a> 26053     <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (tmp-&gt;string);
<a id='L26054' name='L26054'></a> 26054   <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (tmp);
<a id='L26055' name='L26055'></a> 26055   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L26056' name='L26056'></a> 26056 <em class='brace'>}</em>
<a id='L26057' name='L26057'></a> 26057 
<a id='L26058' name='L26058'></a> 26058 <em class='comment'>/* If any X protocol errors have arrived since the last call to</em>
<a id='L26059' name='L26059'></a> 26059 <em class='comment'>   x_catch_errors or x_check_errors, signal an Emacs error using</em>
<a id='L26060' name='L26060'></a> 26060 <em class='comment'>   sprintf (a buffer, FORMAT, the x error message text) as the text.  */</em>
<a id='L26061' name='L26061'></a> 26061 
<a id='L26062' name='L26062'></a> 26062 <strong class='reserved'>void</strong>
<a id='L26063' name='L26063'></a> 26063 x_check_errors (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy, <strong class='reserved'>const</strong> <strong class='reserved'>char</strong> *format)
<a id='L26064' name='L26064'></a> 26064 <em class='brace'>{</em>
<a id='L26065' name='L26065'></a> 26065   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L26066' name='L26066'></a> 26066   <strong class='reserved'>char</strong> *string;
<a id='L26067' name='L26067'></a> 26067 
<a id='L26068' name='L26068'></a> 26068   <em class='comment'>/* This shouldn't happen, since x_check_errors should be called</em>
<a id='L26069' name='L26069'></a> 26069 <em class='comment'>     immediately inside an x_catch_errors block.  */</em>
<a id='L26070' name='L26070'></a> 26070   <strong class='reserved'>if</strong> (dpy != x_error_message-&gt;dpy)
<a id='L26071' name='L26071'></a> 26071     <a href='../D/10893.html' title='Multiple defined in 6 places.'>emacs_abort</a> ();
<a id='L26072' name='L26072'></a> 26072 
<a id='L26073' name='L26073'></a> 26073   <em class='comment'>/* There is no point in making this extra sync if all requests</em>
<a id='L26074' name='L26074'></a> 26074 <em class='comment'>     are known to have been fully processed.  */</em>
<a id='L26075' name='L26075'></a> 26075   <strong class='reserved'>if</strong> ((LastKnownRequestProcessed (dpy)
<a id='L26076' name='L26076'></a> 26076        != XNextRequest (dpy) - 1)
<a id='L26077' name='L26077'></a> 26077       &amp;&amp; (NextRequest (dpy)
<a id='L26078' name='L26078'></a> 26078           &gt; x_error_message-&gt;first_request))
<a id='L26079' name='L26079'></a> 26079     <a href='../D/7378.html' title='Multiple defined in 3 places.'>XSync</a> (dpy, False);
<a id='L26080' name='L26080'></a> 26080 
<a id='L26081' name='L26081'></a> 26081   dpyinfo = <a href='../S/2289.html#L6774' title='Defined at 6774 in src/xterm.c.'>x_display_info_for_display</a> (dpy);
<a id='L26082' name='L26082'></a> 26082 
<a id='L26083' name='L26083'></a> 26083   <em class='comment'>/* Clean the array of failable requests, since a sync happened.  */</em>
<a id='L26084' name='L26084'></a> 26084   <strong class='reserved'>if</strong> (dpyinfo)
<a id='L26085' name='L26085'></a> 26085     x_clean_failable_requests (dpyinfo);
<a id='L26086' name='L26086'></a> 26086 
<a id='L26087' name='L26087'></a> 26087   <strong class='reserved'>if</strong> (x_error_message-&gt;string)
<a id='L26088' name='L26088'></a> 26088     <em class='brace'>{</em>
<a id='L26089' name='L26089'></a> 26089       string = <a href='../D/8439.html' title='Multiple defined in 8 places.'>alloca</a> (strlen (x_error_message-&gt;string) + 1);
<a id='L26090' name='L26090'></a> 26090       strcpy (string, x_error_message-&gt;string);
<a id='L26091' name='L26091'></a> 26091 
<a id='L26092' name='L26092'></a> 26092       <a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a> (format, string);
<a id='L26093' name='L26093'></a> 26093     <em class='brace'>}</em>
<a id='L26094' name='L26094'></a> 26094 <em class='brace'>}</em>
<a id='L26095' name='L26095'></a> 26095 
<a id='L26096' name='L26096'></a> 26096 <em class='comment'>/* Nonzero if any X protocol errors were generated since the last call</em>
<a id='L26097' name='L26097'></a> 26097 <em class='comment'>   to x_catch_errors on DPY.  */</em>
<a id='L26098' name='L26098'></a> 26098 
<a id='L26099' name='L26099'></a> 26099 <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L26100' name='L26100'></a> 26100 x_had_errors_p (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy)
<a id='L26101' name='L26101'></a> 26101 <em class='brace'>{</em>
<a id='L26102' name='L26102'></a> 26102   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L26103' name='L26103'></a> 26103 
<a id='L26104' name='L26104'></a> 26104   <em class='comment'>/* This shouldn't happen, since x_check_errors should be called</em>
<a id='L26105' name='L26105'></a> 26105 <em class='comment'>     immediately inside an x_catch_errors block.  */</em>
<a id='L26106' name='L26106'></a> 26106   <strong class='reserved'>if</strong> (dpy != x_error_message-&gt;dpy)
<a id='L26107' name='L26107'></a> 26107     <a href='../D/10893.html' title='Multiple defined in 6 places.'>emacs_abort</a> ();
<a id='L26108' name='L26108'></a> 26108 
<a id='L26109' name='L26109'></a> 26109   <em class='comment'>/* Make sure to catch any errors incurred so far.  */</em>
<a id='L26110' name='L26110'></a> 26110   <strong class='reserved'>if</strong> ((LastKnownRequestProcessed (dpy)
<a id='L26111' name='L26111'></a> 26111        != XNextRequest (dpy) - 1)
<a id='L26112' name='L26112'></a> 26112       &amp;&amp; (NextRequest (dpy)
<a id='L26113' name='L26113'></a> 26113           &gt; x_error_message-&gt;first_request))
<a id='L26114' name='L26114'></a> 26114     <a href='../D/7378.html' title='Multiple defined in 3 places.'>XSync</a> (dpy, False);
<a id='L26115' name='L26115'></a> 26115 
<a id='L26116' name='L26116'></a> 26116   dpyinfo = <a href='../S/2289.html#L6774' title='Defined at 6774 in src/xterm.c.'>x_display_info_for_display</a> (dpy);
<a id='L26117' name='L26117'></a> 26117 
<a id='L26118' name='L26118'></a> 26118   <em class='comment'>/* Clean the array of failable requests, since a sync happened.  */</em>
<a id='L26119' name='L26119'></a> 26119   <strong class='reserved'>if</strong> (dpyinfo)
<a id='L26120' name='L26120'></a> 26120     x_clean_failable_requests (dpyinfo);
<a id='L26121' name='L26121'></a> 26121 
<a id='L26122' name='L26122'></a> 26122   <strong class='reserved'>return</strong> !!x_error_message-&gt;string;
<a id='L26123' name='L26123'></a> 26123 <em class='brace'>}</em>
<a id='L26124' name='L26124'></a> 26124 
<a id='L26125' name='L26125'></a> 26125 <em class='comment'>/* Forget about any errors we have had, since we did x_catch_errors on</em>
<a id='L26126' name='L26126'></a> 26126 <em class='comment'>   DPY.  */</em>
<a id='L26127' name='L26127'></a> 26127 
<a id='L26128' name='L26128'></a> 26128 <strong class='reserved'>void</strong>
<a id='L26129' name='L26129'></a> 26129 x_clear_errors (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy)
<a id='L26130' name='L26130'></a> 26130 <em class='brace'>{</em>
<a id='L26131' name='L26131'></a> 26131   <em class='comment'>/* This shouldn't happen, since x_check_errors should be called</em>
<a id='L26132' name='L26132'></a> 26132 <em class='comment'>     immediately inside an x_catch_errors block.  */</em>
<a id='L26133' name='L26133'></a> 26133   <strong class='reserved'>if</strong> (dpy != x_error_message-&gt;dpy)
<a id='L26134' name='L26134'></a> 26134     <a href='../D/10893.html' title='Multiple defined in 6 places.'>emacs_abort</a> ();
<a id='L26135' name='L26135'></a> 26135 
<a id='L26136' name='L26136'></a> 26136   <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (x_error_message-&gt;string);
<a id='L26137' name='L26137'></a> 26137   x_error_message-&gt;string = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L26138' name='L26138'></a> 26138 <em class='brace'>}</em>
<a id='L26139' name='L26139'></a> 26139 
<a id='L26140' name='L26140'></a> 26140 <em class='sharp'>#if</em> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>
<a id='L26141' name='L26141'></a> 26141       <em class='comment'>/* See comment in unwind_to_catch why calling this is a bad</em>
<a id='L26142' name='L26142'></a> 26142 <em class='comment'>       * idea.  --lorentey   */</em>
<a id='L26143' name='L26143'></a> 26143 <em class='comment'>/* Close off all unclosed x_catch_errors calls.  */</em>
<a id='L26144' name='L26144'></a> 26144 
<a id='L26145' name='L26145'></a> 26145 <strong class='reserved'>void</strong>
<a id='L26146' name='L26146'></a> 26146 x_fully_uncatch_errors (<strong class='reserved'>void</strong>)
<a id='L26147' name='L26147'></a> 26147 <em class='brace'>{</em>
<a id='L26148' name='L26148'></a> 26148   <strong class='reserved'>while</strong> (x_error_message)
<a id='L26149' name='L26149'></a> 26149     x_uncatch_errors ();
<a id='L26150' name='L26150'></a> 26150 <em class='brace'>}</em>
<a id='L26151' name='L26151'></a> 26151 <em class='sharp'>#endif</em>
<a id='L26152' name='L26152'></a> 26152 
<a id='L26153' name='L26153'></a> 26153 <em class='sharp'>#if</em> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>
<a id='L26154' name='L26154'></a> 26154 <strong class='reserved'>static</strong> <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> x_wire_count;
<a id='L26155' name='L26155'></a> 26155 
<a id='L26156' name='L26156'></a> 26156 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L26157' name='L26157'></a> 26157 x_trace_wire (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy)
<a id='L26158' name='L26158'></a> 26158 <em class='brace'>{</em>
<a id='L26159' name='L26159'></a> 26159   <a href='../D/11675.html' title='Multiple defined in 4 places.'>fprintf</a> (<a href='../S/20.html#L50' title='Defined at 50 in nt/cmdproxy.c.'>stderr</a>, "Lib call: %u\n", ++x_wire_count);
<a id='L26160' name='L26160'></a> 26160   <strong class='reserved'>return</strong> 0;
<a id='L26161' name='L26161'></a> 26161 <em class='brace'>}</em>
<a id='L26162' name='L26162'></a> 26162 <em class='sharp'>#endif</em>
<a id='L26163' name='L26163'></a> 26163 
<a id='L26164' name='L26164'></a> 26164 
<a id='L26165' name='L26165'></a> 26165 <em class='comment'>/************************************************************************</em>
<a id='L26166' name='L26166'></a> 26166 <em class='comment'>                          Handling X errors</em>
<a id='L26167' name='L26167'></a> 26167 <em class='comment'> ************************************************************************/</em>
<a id='L26168' name='L26168'></a> 26168 
<a id='L26169' name='L26169'></a> 26169 <em class='comment'>/* Error message passed to x_connection_closed.  */</em>
<a id='L26170' name='L26170'></a> 26170 
<a id='L26171' name='L26171'></a> 26171 <strong class='reserved'>static</strong> <strong class='reserved'>char</strong> *error_msg;
<a id='L26172' name='L26172'></a> 26172 
<a id='L26173' name='L26173'></a> 26173 <em class='comment'>/* Try to find a frame in Vframe_list, and make it the selected frame.</em>
<a id='L26174' name='L26174'></a> 26174 <em class='comment'>   `delete_frame' sometimes misses the initial frame for an unknown</em>
<a id='L26175' name='L26175'></a> 26175 <em class='comment'>   reason when Emacs is running as a background daemon.  */</em>
<a id='L26176' name='L26176'></a> 26176 
<a id='L26177' name='L26177'></a> 26177 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L26178' name='L26178'></a> 26178 x_try_restore_frame (<strong class='reserved'>void</strong>)
<a id='L26179' name='L26179'></a> 26179 <em class='brace'>{</em>
<a id='L26180' name='L26180'></a> 26180   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>;
<a id='L26181' name='L26181'></a> 26181 
<a id='L26182' name='L26182'></a> 26182   <a href='../S/2183.html#L1405' title='Defined at 1405 in src/frame.h.'>FOR_EACH_FRAME</a> (<a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)
<a id='L26183' name='L26183'></a> 26183     <em class='brace'>{</em>
<a id='L26184' name='L26184'></a> 26184       <strong class='reserved'>if</strong> (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (<a href='../S/2247.html#L1479' title='Defined at 1479 in src/frame.c.'>do_switch_frame</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, 0, 1, Qnil)))
<a id='L26185' name='L26185'></a> 26185         <strong class='reserved'>return</strong>;
<a id='L26186' name='L26186'></a> 26186     <em class='brace'>}</em>
<a id='L26187' name='L26187'></a> 26187 <em class='brace'>}</em>
<a id='L26188' name='L26188'></a> 26188 
<a id='L26189' name='L26189'></a> 26189 <em class='comment'>/* Handle the loss of connection to display DPY.  ERROR_MESSAGE is</em>
<a id='L26190' name='L26190'></a> 26190 <em class='comment'>   the text of an error message that lead to the connection loss.  */</em>
<a id='L26191' name='L26191'></a> 26191 
<a id='L26192' name='L26192'></a> 26192 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L26193' name='L26193'></a> 26193 x_connection_closed (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy, <strong class='reserved'>const</strong> <strong class='reserved'>char</strong> *error_message, <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> ioerror)
<a id='L26194' name='L26194'></a> 26194 <em class='brace'>{</em>
<a id='L26195' name='L26195'></a> 26195   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L26196' name='L26196'></a> 26196   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>;
<a id='L26197' name='L26197'></a> 26197   <a href='../D/17570.html' title='Multiple defined in 2 places.'>specpdl_ref</a> idx = <a href='../D/5888.html' title='Multiple defined in 2 places.'>SPECPDL_INDEX</a> ();
<a id='L26198' name='L26198'></a> 26198   Emacs_XIOErrorHandler io_error_handler;
<a id='L26199' name='L26199'></a> 26199   <a href='../D/20018.html' title='Multiple defined in 2 places.'>xm_drop_start_message</a> dmsg;
<a id='L26200' name='L26200'></a> 26200   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L26201' name='L26201'></a> 26201   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> minibuf_frame, tmp;
<a id='L26202' name='L26202'></a> 26202   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L336' title='Defined at 336 in src/xterm.h.'>x_failable_request</a> *failable;
<a id='L26203' name='L26203'></a> 26203   <strong class='reserved'>struct</strong> <a href='../S/2289.html#L25657' title='Defined at 25657 in src/xterm.c.'>x_error_message_stack</a> *stack;
<a id='L26204' name='L26204'></a> 26204   <strong class='reserved'>static</strong> <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *current_display;
<a id='L26205' name='L26205'></a> 26205 
<a id='L26206' name='L26206'></a> 26206   <em class='comment'>/* Prevent recursive calls of this function for the same display.</em>
<a id='L26207' name='L26207'></a> 26207 <em class='comment'>     This is because destroying a frame might still cause an IO error</em>
<a id='L26208' name='L26208'></a> 26208 <em class='comment'>     in some cases.  (bug#56528) */</em>
<a id='L26209' name='L26209'></a> 26209   <strong class='reserved'>if</strong> (current_display == dpy)
<a id='L26210' name='L26210'></a> 26210     <strong class='reserved'>return</strong>;
<a id='L26211' name='L26211'></a> 26211 
<a id='L26212' name='L26212'></a> 26212   current_display = dpy;
<a id='L26213' name='L26213'></a> 26213 
<a id='L26214' name='L26214'></a> 26214   dpyinfo = <a href='../S/2289.html#L6774' title='Defined at 6774 in src/xterm.c.'>x_display_info_for_display</a> (dpy);
<a id='L26215' name='L26215'></a> 26215   error_msg = <a href='../D/8439.html' title='Multiple defined in 8 places.'>alloca</a> (strlen (error_message) + 1);
<a id='L26216' name='L26216'></a> 26216   strcpy (error_msg, error_message);
<a id='L26217' name='L26217'></a> 26217 
<a id='L26218' name='L26218'></a> 26218   <em class='comment'>/* Inhibit redisplay while frames are being deleted. */</em>
<a id='L26219' name='L26219'></a> 26219   <a href='../S/2188.html#L3480' title='Defined at 3480 in src/eval.c.'>specbind</a> (Qinhibit_redisplay, Qt);
<a id='L26220' name='L26220'></a> 26220 
<a id='L26221' name='L26221'></a> 26221   <em class='comment'>/* If drag-and-drop is in progress, cancel drag-and-drop.  If DND</em>
<a id='L26222' name='L26222'></a> 26222 <em class='comment'>     frame's display is DPY, don't reset event masks or try to send</em>
<a id='L26223' name='L26223'></a> 26223 <em class='comment'>     responses to other programs because the display is going</em>
<a id='L26224' name='L26224'></a> 26224 <em class='comment'>     away.  */</em>
<a id='L26225' name='L26225'></a> 26225 
<a id='L26226' name='L26226'></a> 26226   <strong class='reserved'>if</strong> (x_dnd_in_progress || x_dnd_waiting_for_finish)
<a id='L26227' name='L26227'></a> 26227     <em class='brace'>{</em>
<a id='L26228' name='L26228'></a> 26228       <strong class='reserved'>if</strong> (!ioerror)
<a id='L26229' name='L26229'></a> 26229         <em class='brace'>{</em>
<a id='L26230' name='L26230'></a> 26230           <em class='comment'>/* Handle display disconnect errors here because this function</em>
<a id='L26231' name='L26231'></a> 26231 <em class='comment'>             is not reentrant at this particular spot.  */</em>
<a id='L26232' name='L26232'></a> 26232           io_error_handler = XSetIOErrorHandler (<a href='../S/2289.html#L3611' title='Defined at 3611 in src/xterm.c.'>x_dnd_io_error_handler</a>);
<a id='L26233' name='L26233'></a> 26233 
<a id='L26234' name='L26234'></a> 26234           <strong class='reserved'>if</strong> (!!<a href='../D/17468.html' title='Multiple defined in 2 places.'>sigsetjmp</a> (x_dnd_disconnect_handler, 1)
<a id='L26235' name='L26235'></a> 26235               &amp;&amp; x_dnd_in_progress
<a id='L26236' name='L26236'></a> 26236               &amp;&amp; dpy == (x_dnd_waiting_for_finish
<a id='L26237' name='L26237'></a> 26237                          ? x_dnd_finish_display
<a id='L26238' name='L26238'></a> 26238                          : <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (x_dnd_frame)))
<a id='L26239' name='L26239'></a> 26239             <em class='brace'>{</em>
<a id='L26240' name='L26240'></a> 26240               <em class='comment'>/* Clean up drag and drop if the drag frame's display isn't</em>
<a id='L26241' name='L26241'></a> 26241 <em class='comment'>                 the one being disconnected.  */</em>
<a id='L26242' name='L26242'></a> 26242               <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = x_dnd_frame;
<a id='L26243' name='L26243'></a> 26243 
<a id='L26244' name='L26244'></a> 26244               <strong class='reserved'>if</strong> (x_dnd_last_seen_window != None
<a id='L26245' name='L26245'></a> 26245                   &amp;&amp; x_dnd_last_protocol_version != -1)
<a id='L26246' name='L26246'></a> 26246                 <a href='../S/2289.html#L4649' title='Defined at 4649 in src/xterm.c.'>x_dnd_send_leave</a> (x_dnd_frame,
<a id='L26247' name='L26247'></a> 26247                                   x_dnd_last_seen_window,
<a id='L26248' name='L26248'></a> 26248                                   x_dnd_last_seen_toplevel);
<a id='L26249' name='L26249'></a> 26249               <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (x_dnd_last_seen_window != None
<a id='L26250' name='L26250'></a> 26250                        &amp;&amp; !<a href='../S/2289.html#L1748' title='Defined at 1748 in src/xterm.c.'>XM_DRAG_STYLE_IS_DROP_ONLY</a> (x_dnd_last_motif_style)
<a id='L26251' name='L26251'></a> 26251                        &amp;&amp; x_dnd_last_motif_style != <a href='../S/2289.html#L1740' title='Defined at 1740 in src/xterm.c.'>XM_DRAG_STYLE_NONE</a>
<a id='L26252' name='L26252'></a> 26252                        &amp;&amp; x_dnd_motif_setup_p)
<a id='L26253' name='L26253'></a> 26253                 <em class='brace'>{</em>
<a id='L26254' name='L26254'></a> 26254                   dmsg.reason = <a href='../S/2289.html#L1718' title='Defined at 1718 in src/xterm.c.'>XM_DRAG_REASON</a> (<a href='../S/2289.html#L1732' title='Defined at 1732 in src/xterm.c.'>XM_DRAG_ORIGINATOR_INITIATOR</a>,
<a id='L26255' name='L26255'></a> 26255                                                 <a href='../S/2289.html#L1724' title='Defined at 1724 in src/xterm.c.'>XM_DRAG_REASON_DROP_START</a>);
<a id='L26256' name='L26256'></a> 26256                   dmsg.byte_order = <a href='../D/7223.html' title='Multiple defined in 2 places.'>XM_BYTE_ORDER_CUR_FIRST</a>;
<a id='L26257' name='L26257'></a> 26257                   dmsg.timestamp = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;last_user_time;
<a id='L26258' name='L26258'></a> 26258                   dmsg.side_effects
<a id='L26259' name='L26259'></a> 26259                     = <a href='../S/2289.html#L1689' title='Defined at 1689 in src/xterm.c.'>XM_DRAG_SIDE_EFFECT</a> (<a href='../S/2289.html#L1766' title='Defined at 1766 in src/xterm.c.'>xm_side_effect_from_action</a> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L26260' name='L26260'></a> 26260                                                                        x_dnd_wanted_action),
<a id='L26261' name='L26261'></a> 26261                                            <a href='../S/2289.html#L1756' title='Defined at 1756 in src/xterm.c.'>XM_DROP_SITE_VALID</a>, x_dnd_motif_operations,
<a id='L26262' name='L26262'></a> 26262                                            <a href='../S/2289.html#L1715' title='Defined at 1715 in src/xterm.c.'>XM_DROP_ACTION_DROP_CANCEL</a>);
<a id='L26263' name='L26263'></a> 26263                   dmsg.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = 0;
<a id='L26264' name='L26264'></a> 26264                   dmsg.y = 0;
<a id='L26265' name='L26265'></a> 26265                   dmsg.index_atom = x_dnd_motif_atom;
<a id='L26266' name='L26266'></a> 26266                   dmsg.source_window = <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L26267' name='L26267'></a> 26267 
<a id='L26268' name='L26268'></a> 26268                   <a href='../S/2289.html#L2899' title='Defined at 2899 in src/xterm.c.'>x_dnd_send_xm_leave_for_drop</a> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>,
<a id='L26269' name='L26269'></a> 26269                                                 x_dnd_last_seen_window, 0);
<a id='L26270' name='L26270'></a> 26270                   <a href='../S/2289.html#L2565' title='Defined at 2565 in src/xterm.c.'>xm_send_drop_message</a> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L26271' name='L26271'></a> 26271                                         x_dnd_last_seen_window, &amp;dmsg);
<a id='L26272' name='L26272'></a> 26272                 <em class='brace'>}</em>
<a id='L26273' name='L26273'></a> 26273             <em class='brace'>}</em>
<a id='L26274' name='L26274'></a> 26274 
<a id='L26275' name='L26275'></a> 26275           XSetIOErrorHandler (io_error_handler);
<a id='L26276' name='L26276'></a> 26276         <em class='brace'>}</em>
<a id='L26277' name='L26277'></a> 26277 
<a id='L26278' name='L26278'></a> 26278       dpyinfo = <a href='../S/2289.html#L6774' title='Defined at 6774 in src/xterm.c.'>x_display_info_for_display</a> (dpy);
<a id='L26279' name='L26279'></a> 26279 
<a id='L26280' name='L26280'></a> 26280       x_dnd_last_seen_window = None;
<a id='L26281' name='L26281'></a> 26281       x_dnd_last_seen_toplevel = None;
<a id='L26282' name='L26282'></a> 26282       x_dnd_in_progress = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L26283' name='L26283'></a> 26283       x_dnd_waiting_for_finish = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L26284' name='L26284'></a> 26284 
<a id='L26285' name='L26285'></a> 26285       <strong class='reserved'>if</strong> (x_dnd_use_toplevels)
<a id='L26286' name='L26286'></a> 26286         <a href='../S/2289.html#L2918' title='Defined at 2918 in src/xterm.c.'>x_dnd_free_toplevels</a> (!ioerror);
<a id='L26287' name='L26287'></a> 26287 
<a id='L26288' name='L26288'></a> 26288       x_dnd_return_frame_object = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L26289' name='L26289'></a> 26289       x_dnd_movement_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L26290' name='L26290'></a> 26290       x_dnd_wheel_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L26291' name='L26291'></a> 26291       x_dnd_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L26292' name='L26292'></a> 26292     <em class='brace'>}</em>
<a id='L26293' name='L26293'></a> 26293 
<a id='L26294' name='L26294'></a> 26294   <strong class='reserved'>if</strong> (dpyinfo)
<a id='L26295' name='L26295'></a> 26295     <em class='brace'>{</em>
<a id='L26296' name='L26296'></a> 26296       <em class='comment'>/* Protect display from being closed when we delete the last</em>
<a id='L26297' name='L26297'></a> 26297 <em class='comment'>         frame on it. */</em>
<a id='L26298' name='L26298'></a> 26298       dpyinfo-&gt;reference_count++;
<a id='L26299' name='L26299'></a> 26299       dpyinfo-&gt;<a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;reference_count++;
<a id='L26300' name='L26300'></a> 26300       <strong class='reserved'>if</strong> (ioerror)
<a id='L26301' name='L26301'></a> 26301         dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> = 0;
<a id='L26302' name='L26302'></a> 26302     <em class='brace'>}</em>
<a id='L26303' name='L26303'></a> 26303 
<a id='L26304' name='L26304'></a> 26304   <em class='comment'>/* delete_frame can still try to read async input (even though we</em>
<a id='L26305' name='L26305'></a> 26305 <em class='comment'>     tell pass `noelisp'), because looking up the `delete-before'</em>
<a id='L26306' name='L26306'></a> 26306 <em class='comment'>     parameter calls Fassq which then calls maybe_quit.  So block</em>
<a id='L26307' name='L26307'></a> 26307 <em class='comment'>     input while deleting frames.  */</em>
<a id='L26308' name='L26308'></a> 26308   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L26309' name='L26309'></a> 26309 
<a id='L26310' name='L26310'></a> 26310   <em class='comment'>/* First delete frames whose mini-buffers are on frames</em>
<a id='L26311' name='L26311'></a> 26311 <em class='comment'>     that are on the dead display.  */</em>
<a id='L26312' name='L26312'></a> 26312   <a href='../S/2183.html#L1405' title='Defined at 1405 in src/frame.h.'>FOR_EACH_FRAME</a> (<a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)
<a id='L26313' name='L26313'></a> 26313     <em class='brace'>{</em>
<a id='L26314' name='L26314'></a> 26314       <em class='comment'>/* Tooltip frames don't have these, so avoid crashing.  */</em>
<a id='L26315' name='L26315'></a> 26315 
<a id='L26316' name='L26316'></a> 26316       <strong class='reserved'>if</strong> (<a href='../D/2425.html' title='Multiple defined in 2 places.'>FRAME_TOOLTIP_P</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)))
<a id='L26317' name='L26317'></a> 26317         <strong class='reserved'>continue</strong>;
<a id='L26318' name='L26318'></a> 26318 
<a id='L26319' name='L26319'></a> 26319       minibuf_frame
<a id='L26320' name='L26320'></a> 26320         = <a href='../S/2183.html#L914' title='Defined at 914 in src/frame.h.'>WINDOW_FRAME</a> (<a href='../D/7409.html' title='Multiple defined in 2 places.'>XWINDOW</a> (<a href='../S/2183.html#L1200' title='Defined at 1200 in src/frame.h.'>FRAME_MINIBUF_WINDOW</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>))));
<a id='L26321' name='L26321'></a> 26321 
<a id='L26322' name='L26322'></a> 26322       <strong class='reserved'>if</strong> (<a href='../S/2183.html#L919' title='Defined at 919 in src/frame.h.'>FRAME_X_P</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>))
<a id='L26323' name='L26323'></a> 26323           &amp;&amp; <a href='../S/2183.html#L919' title='Defined at 919 in src/frame.h.'>FRAME_X_P</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (minibuf_frame))
<a id='L26324' name='L26324'></a> 26324           &amp;&amp; ! <a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, minibuf_frame)
<a id='L26325' name='L26325'></a> 26325           &amp;&amp; <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (minibuf_frame)) == dpyinfo)
<a id='L26326' name='L26326'></a> 26326         <a href='../S/2247.html#L2043' title='Defined at 2043 in src/frame.c.'>delete_frame</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, Qnoelisp);
<a id='L26327' name='L26327'></a> 26327     <em class='brace'>}</em>
<a id='L26328' name='L26328'></a> 26328 
<a id='L26329' name='L26329'></a> 26329   <em class='comment'>/* Now delete all remaining frames on the dead display.</em>
<a id='L26330' name='L26330'></a> 26330 <em class='comment'>     We are now sure none of these is used as the mini-buffer</em>
<a id='L26331' name='L26331'></a> 26331 <em class='comment'>     for another frame that we need to delete.  */</em>
<a id='L26332' name='L26332'></a> 26332   <a href='../S/2183.html#L1405' title='Defined at 1405 in src/frame.h.'>FOR_EACH_FRAME</a> (<a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)
<a id='L26333' name='L26333'></a> 26333     <strong class='reserved'>if</strong> (<a href='../S/2183.html#L919' title='Defined at 919 in src/frame.h.'>FRAME_X_P</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>))
<a id='L26334' name='L26334'></a> 26334         &amp;&amp; <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)) == dpyinfo)
<a id='L26335' name='L26335'></a> 26335       <em class='brace'>{</em>
<a id='L26336' name='L26336'></a> 26336         <em class='comment'>/* Set this to t so that delete_frame won't get confused</em>
<a id='L26337' name='L26337'></a> 26337 <em class='comment'>           trying to find a replacement.  */</em>
<a id='L26338' name='L26338'></a> 26338         <a href='../S/2185.html#L189' title='Defined at 189 in src/keyboard.h.'>kset_default_minibuffer_frame</a> (<a href='../S/2183.html#L904' title='Defined at 904 in src/frame.h.'>FRAME_KBOARD</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)), Qt);
<a id='L26339' name='L26339'></a> 26339         <a href='../S/2247.html#L2043' title='Defined at 2043 in src/frame.c.'>delete_frame</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, Qnoelisp);
<a id='L26340' name='L26340'></a> 26340       <em class='brace'>}</em>
<a id='L26341' name='L26341'></a> 26341 
<a id='L26342' name='L26342'></a> 26342   <em class='comment'>/* If DPYINFO is null, this means we didn't open the display in the</em>
<a id='L26343' name='L26343'></a> 26343 <em class='comment'>     first place, so don't try to close it.  */</em>
<a id='L26344' name='L26344'></a> 26344   <strong class='reserved'>if</strong> (dpyinfo)
<a id='L26345' name='L26345'></a> 26345     <em class='brace'>{</em>
<a id='L26346' name='L26346'></a> 26346       <em class='comment'>/* We can not call XtCloseDisplay here because it calls XSync.</em>
<a id='L26347' name='L26347'></a> 26347 <em class='comment'>         XSync inside the error handler apparently hangs Emacs.  On</em>
<a id='L26348' name='L26348'></a> 26348 <em class='comment'>         current Xt versions, this isn't needed either.  */</em>
<a id='L26349' name='L26349'></a> 26349 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L26350' name='L26350'></a> 26350       <em class='comment'>/* A long-standing GTK bug prevents proper disconnect handling</em>
<a id='L26351' name='L26351'></a> 26351 <em class='comment'>         &lt;https://gitlab.gnome.org/GNOME/gtk/issues/221&gt;.  Once,</em>
<a id='L26352' name='L26352'></a> 26352 <em class='comment'>         the resulting Glib error message loop filled a user's disk.</em>
<a id='L26353' name='L26353'></a> 26353 <em class='comment'>         To avoid this, kill Emacs unconditionally on disconnect.  */</em>
<a id='L26354' name='L26354'></a> 26354       <a href='../S/2340.html#L3063' title='Defined at 3063 in src/emacs.c.'>shut_down_emacs</a> (0, Qnil);
<a id='L26355' name='L26355'></a> 26355       <a href='../D/11675.html' title='Multiple defined in 4 places.'>fprintf</a> (<a href='../S/20.html#L50' title='Defined at 50 in nt/cmdproxy.c.'>stderr</a>, "%s\n\
<a id='L26356' name='L26356'></a> 26356 When compiled with GTK, Emacs cannot recover from X disconnects.\n\
<a id='L26357' name='L26357'></a> 26357 This is a GTK bug: https://gitlab.gnome.org/GNOME/gtk/issues/221\n\
<a id='L26358' name='L26358'></a> 26358 For details, see etc/PROBLEMS.\n",
<a id='L26359' name='L26359'></a> 26359                error_msg);
<a id='L26360' name='L26360'></a> 26360       <a href='../D/10893.html' title='Multiple defined in 6 places.'>emacs_abort</a> ();
<a id='L26361' name='L26361'></a> 26361 <em class='sharp'>#endif</em> <em class='comment'>/* USE_GTK */</em>
<a id='L26362' name='L26362'></a> 26362 
<a id='L26363' name='L26363'></a> 26363       <em class='comment'>/* Indicate that this display is dead.  */</em>
<a id='L26364' name='L26364'></a> 26364       dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> = 0;
<a id='L26365' name='L26365'></a> 26365 
<a id='L26366' name='L26366'></a> 26366       dpyinfo-&gt;reference_count--;
<a id='L26367' name='L26367'></a> 26367       dpyinfo-&gt;<a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;reference_count--;
<a id='L26368' name='L26368'></a> 26368       <strong class='reserved'>if</strong> (dpyinfo-&gt;reference_count != 0)
<a id='L26369' name='L26369'></a> 26369         <em class='comment'>/* We have just closed all frames on this display. */</em>
<a id='L26370' name='L26370'></a> 26370         <a href='../D/10893.html' title='Multiple defined in 6 places.'>emacs_abort</a> ();
<a id='L26371' name='L26371'></a> 26371 
<a id='L26372' name='L26372'></a> 26372       <em class='comment'>/* This was the last terminal remaining, so print the error</em>
<a id='L26373' name='L26373'></a> 26373 <em class='comment'>         message and associated error handlers and kill Emacs.  */</em>
<a id='L26374' name='L26374'></a> 26374       <strong class='reserved'>if</strong> (dpyinfo-&gt;<a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a> == terminal_list
<a id='L26375' name='L26375'></a> 26375           &amp;&amp; !terminal_list-&gt;next_terminal)
<a id='L26376' name='L26376'></a> 26376         <em class='brace'>{</em>
<a id='L26377' name='L26377'></a> 26377           <a href='../D/11675.html' title='Multiple defined in 4 places.'>fprintf</a> (<a href='../S/20.html#L50' title='Defined at 50 in nt/cmdproxy.c.'>stderr</a>, "%s\n", error_msg);
<a id='L26378' name='L26378'></a> 26378 
<a id='L26379' name='L26379'></a> 26379           <strong class='reserved'>if</strong> (!ioerror &amp;&amp; dpyinfo)
<a id='L26380' name='L26380'></a> 26380             <em class='brace'>{</em>
<a id='L26381' name='L26381'></a> 26381               <em class='comment'>/* Dump the list of error handlers for debugging</em>
<a id='L26382' name='L26382'></a> 26382 <em class='comment'>                 purposes if the list exists.  */</em>
<a id='L26383' name='L26383'></a> 26383 
<a id='L26384' name='L26384'></a> 26384               <strong class='reserved'>if</strong> ((dpyinfo-&gt;failable_requests
<a id='L26385' name='L26385'></a> 26385                    != dpyinfo-&gt;next_failable_request) || x_error_message)
<a id='L26386' name='L26386'></a> 26386                 <a href='../D/11675.html' title='Multiple defined in 4 places.'>fprintf</a> (<a href='../S/20.html#L50' title='Defined at 50 in nt/cmdproxy.c.'>stderr</a>, "X error handlers currently installed:\n");
<a id='L26387' name='L26387'></a> 26387 
<a id='L26388' name='L26388'></a> 26388               <strong class='reserved'>for</strong> (failable = dpyinfo-&gt;failable_requests;
<a id='L26389' name='L26389'></a> 26389                    failable &lt; dpyinfo-&gt;next_failable_request;
<a id='L26390' name='L26390'></a> 26390                    ++failable)
<a id='L26391' name='L26391'></a> 26391                 <em class='brace'>{</em>
<a id='L26392' name='L26392'></a> 26392                   <strong class='reserved'>if</strong> (failable-&gt;end)
<a id='L26393' name='L26393'></a> 26393                     <a href='../D/11675.html' title='Multiple defined in 4 places.'>fprintf</a> (<a href='../S/20.html#L50' title='Defined at 50 in nt/cmdproxy.c.'>stderr</a>, "Ignoring errors between %lu to %lu\n",
<a id='L26394' name='L26394'></a> 26394                              failable-&gt;<a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a>, failable-&gt;end);
<a id='L26395' name='L26395'></a> 26395                   <strong class='reserved'>else</strong>
<a id='L26396' name='L26396'></a> 26396                     <a href='../D/11675.html' title='Multiple defined in 4 places.'>fprintf</a> (<a href='../S/20.html#L50' title='Defined at 50 in nt/cmdproxy.c.'>stderr</a>, "Ignoring errors from %lu onwards\n",
<a id='L26397' name='L26397'></a> 26397                              failable-&gt;<a href='../D/17653.html' title='Multiple defined in 2 places.'>start</a>);
<a id='L26398' name='L26398'></a> 26398                 <em class='brace'>}</em>
<a id='L26399' name='L26399'></a> 26399 
<a id='L26400' name='L26400'></a> 26400               <strong class='reserved'>for</strong> (stack = x_error_message; stack; stack = stack-&gt;prev)
<a id='L26401' name='L26401'></a> 26401                 <a href='../D/11675.html' title='Multiple defined in 4 places.'>fprintf</a> (<a href='../S/20.html#L50' title='Defined at 50 in nt/cmdproxy.c.'>stderr</a>, "Trapping errors from %lu\n",
<a id='L26402' name='L26402'></a> 26402                          stack-&gt;first_request);
<a id='L26403' name='L26403'></a> 26403             <em class='brace'>}</em>
<a id='L26404' name='L26404'></a> 26404         <em class='brace'>}</em>
<a id='L26405' name='L26405'></a> 26405 
<a id='L26406' name='L26406'></a> 26406       <a href='../D/7354.html' title='Multiple defined in 2 places.'>XSETTERMINAL</a> (tmp, dpyinfo-&gt;<a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>);
<a id='L26407' name='L26407'></a> 26407       Fdelete_terminal (tmp, Qnoelisp);
<a id='L26408' name='L26408'></a> 26408     <em class='brace'>}</em>
<a id='L26409' name='L26409'></a> 26409 
<a id='L26410' name='L26410'></a> 26410   <em class='comment'>/* The initial "daemon" frame is sometimes not selected by</em>
<a id='L26411' name='L26411'></a> 26411 <em class='comment'>     `delete_frame' when Emacs is a background daemon.  */</em>
<a id='L26412' name='L26412'></a> 26412   <strong class='reserved'>if</strong> (<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (selected_frame))
<a id='L26413' name='L26413'></a> 26413     x_try_restore_frame ();
<a id='L26414' name='L26414'></a> 26414 
<a id='L26415' name='L26415'></a> 26415   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L26416' name='L26416'></a> 26416 
<a id='L26417' name='L26417'></a> 26417   <em class='comment'>/* Sometimes another terminal is still alive, but deleting this</em>
<a id='L26418' name='L26418'></a> 26418 <em class='comment'>     terminal caused all frames to vanish.  In that case, simply kill</em>
<a id='L26419' name='L26419'></a> 26419 <em class='comment'>     Emacs, since the next redisplay will abort as there is no more</em>
<a id='L26420' name='L26420'></a> 26420 <em class='comment'>     selected frame.  (bug#56528) */</em>
<a id='L26421' name='L26421'></a> 26421   <strong class='reserved'>if</strong> (terminal_list == 0 || <a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (selected_frame))
<a id='L26422' name='L26422'></a> 26422     Fkill_emacs (<a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (70), Qnil);
<a id='L26423' name='L26423'></a> 26423 
<a id='L26424' name='L26424'></a> 26424   <a href='../D/18322.html' title='Multiple defined in 2 places.'>totally_unblock_input</a> ();
<a id='L26425' name='L26425'></a> 26425 
<a id='L26426' name='L26426'></a> 26426   <a href='../S/2188.html#L3757' title='Defined at 3757 in src/eval.c.'>unbind_to</a> (idx, Qnil);
<a id='L26427' name='L26427'></a> 26427   <a href='../D/9781.html' title='Multiple defined in 2 places.'>clear_waiting_for_input</a> ();
<a id='L26428' name='L26428'></a> 26428 
<a id='L26429' name='L26429'></a> 26429   <em class='comment'>/* Here, we absolutely have to use a non-local exit (e.g. signal, throw,</em>
<a id='L26430' name='L26430'></a> 26430 <em class='comment'>     longjmp), because returning from this function would get us back into</em>
<a id='L26431' name='L26431'></a> 26431 <em class='comment'>     Xlib's code which will directly call `exit'.  */</em>
<a id='L26432' name='L26432'></a> 26432   current_display = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L26433' name='L26433'></a> 26433   <a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a> ("%s", error_msg);
<a id='L26434' name='L26434'></a> 26434 <em class='brace'>}</em>
<a id='L26435' name='L26435'></a> 26435 
<a id='L26436' name='L26436'></a> 26436 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong> x_error_quitter (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *, XErrorEvent *);
<a id='L26437' name='L26437'></a> 26437 
<a id='L26438' name='L26438'></a> 26438 <em class='comment'>/* This is the first-level handler for X protocol errors.</em>
<a id='L26439' name='L26439'></a> 26439 <em class='comment'>   It calls x_error_quitter or x_error_catcher.  */</em>
<a id='L26440' name='L26440'></a> 26440 
<a id='L26441' name='L26441'></a> 26441 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L26442' name='L26442'></a> 26442 x_error_handler (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, XErrorEvent *event)
<a id='L26443' name='L26443'></a> 26443 <em class='brace'>{</em>
<a id='L26444' name='L26444'></a> 26444   <strong class='reserved'>struct</strong> <a href='../S/2289.html#L25657' title='Defined at 25657 in src/xterm.c.'>x_error_message_stack</a> *stack;
<a id='L26445' name='L26445'></a> 26445   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L26446' name='L26446'></a> 26446   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L336' title='Defined at 336 in src/xterm.h.'>x_failable_request</a> *<a href='../D/11278.html' title='Multiple defined in 2 places.'>fail</a>, *last;
<a id='L26447' name='L26447'></a> 26447 
<a id='L26448' name='L26448'></a> 26448 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> USE_GTK &amp;&amp; <strong class='reserved'>defined</strong> HAVE_GTK3
<a id='L26449' name='L26449'></a> 26449   <strong class='reserved'>if</strong> ((event-&gt;error_code == BadMatch
<a id='L26450' name='L26450'></a> 26450        || event-&gt;error_code == BadWindow)
<a id='L26451' name='L26451'></a> 26451       &amp;&amp; event-&gt;request_code == X_SetInputFocus)
<a id='L26452' name='L26452'></a> 26452     <strong class='reserved'>return</strong> 0;
<a id='L26453' name='L26453'></a> 26453 <em class='sharp'>#endif</em>
<a id='L26454' name='L26454'></a> 26454 
<a id='L26455' name='L26455'></a> 26455   dpyinfo = <a href='../S/2289.html#L6774' title='Defined at 6774 in src/xterm.c.'>x_display_info_for_display</a> (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L26456' name='L26456'></a> 26456 
<a id='L26457' name='L26457'></a> 26457   <strong class='reserved'>if</strong> (dpyinfo)
<a id='L26458' name='L26458'></a> 26458     <em class='brace'>{</em>
<a id='L26459' name='L26459'></a> 26459       <a href='../D/11278.html' title='Multiple defined in 2 places.'>fail</a> = x_request_can_fail (dpyinfo, event-&gt;serial);
<a id='L26460' name='L26460'></a> 26460 
<a id='L26461' name='L26461'></a> 26461       <strong class='reserved'>if</strong> (<a href='../D/11278.html' title='Multiple defined in 2 places.'>fail</a>)
<a id='L26462' name='L26462'></a> 26462         <em class='brace'>{</em>
<a id='L26463' name='L26463'></a> 26463           <em class='comment'>/* Now that this request sequence has been fully handled,</em>
<a id='L26464' name='L26464'></a> 26464 <em class='comment'>             remove it from the list of requests that can fail.  */</em>
<a id='L26465' name='L26465'></a> 26465 
<a id='L26466' name='L26466'></a> 26466           <strong class='reserved'>if</strong> (event-&gt;serial == <a href='../D/11278.html' title='Multiple defined in 2 places.'>fail</a>-&gt;end)
<a id='L26467' name='L26467'></a> 26467             <em class='brace'>{</em>
<a id='L26468' name='L26468'></a> 26468               last = dpyinfo-&gt;next_failable_request;
<a id='L26469' name='L26469'></a> 26469               <a href='../S/2936.html#L81' title='Defined at 81 in lib/canonicalize-lgpl.c.'>memmove</a> (&amp;dpyinfo-&gt;failable_requests, <a href='../D/11278.html' title='Multiple defined in 2 places.'>fail</a>,
<a id='L26470' name='L26470'></a> 26470                        <strong class='reserved'>sizeof</strong> *<a href='../D/11278.html' title='Multiple defined in 2 places.'>fail</a> * (last - <a href='../D/11278.html' title='Multiple defined in 2 places.'>fail</a>));
<a id='L26471' name='L26471'></a> 26471               dpyinfo-&gt;next_failable_request = (dpyinfo-&gt;failable_requests
<a id='L26472' name='L26472'></a> 26472                                                 + (last - <a href='../D/11278.html' title='Multiple defined in 2 places.'>fail</a>));
<a id='L26473' name='L26473'></a> 26473             <em class='brace'>}</em>
<a id='L26474' name='L26474'></a> 26474 
<a id='L26475' name='L26475'></a> 26475           <em class='comment'>/* If a selection transfer is the cause of this error,</em>
<a id='L26476' name='L26476'></a> 26476 <em class='comment'>             remove the selection transfer now.  */</em>
<a id='L26477' name='L26477'></a> 26477           <strong class='reserved'>if</strong> (<a href='../D/11278.html' title='Multiple defined in 2 places.'>fail</a>-&gt;selection_serial)
<a id='L26478' name='L26478'></a> 26478             <a href='../S/2281.html#L1029' title='Defined at 1029 in src/xselect.c.'>x_handle_selection_error</a> (<a href='../D/11278.html' title='Multiple defined in 2 places.'>fail</a>-&gt;selection_serial,
<a id='L26479' name='L26479'></a> 26479                                       event);
<a id='L26480' name='L26480'></a> 26480 
<a id='L26481' name='L26481'></a> 26481           <strong class='reserved'>return</strong> 0;
<a id='L26482' name='L26482'></a> 26482         <em class='brace'>}</em>
<a id='L26483' name='L26483'></a> 26483     <em class='brace'>}</em>
<a id='L26484' name='L26484'></a> 26484 
<a id='L26485' name='L26485'></a> 26485   <em class='comment'>/* If we try to ungrab or grab a device that doesn't exist anymore</em>
<a id='L26486' name='L26486'></a> 26486 <em class='comment'>     (that happens a lot in xmenu.c), just ignore the error.  */</em>
<a id='L26487' name='L26487'></a> 26487 
<a id='L26488' name='L26488'></a> 26488 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L26489' name='L26489'></a> 26489   <em class='comment'>/* Handle errors from some specific XI2 requests here to avoid a</em>
<a id='L26490' name='L26490'></a> 26490 <em class='comment'>     sync in handle_one_xevent.  */</em>
<a id='L26491' name='L26491'></a> 26491   <strong class='reserved'>if</strong> (dpyinfo &amp;&amp; dpyinfo-&gt;supports_xi2
<a id='L26492' name='L26492'></a> 26492       &amp;&amp; event-&gt;request_code == dpyinfo-&gt;xi2_opcode
<a id='L26493' name='L26493'></a> 26493       &amp;&amp; (event-&gt;minor_code == <a href='../S/2289.html#L871' title='Defined at 871 in src/xterm.c.'>X_XIGrabDevice</a>
<a id='L26494' name='L26494'></a> 26494           || event-&gt;minor_code == <a href='../S/2289.html#L875' title='Defined at 875 in src/xterm.c.'>X_XIUngrabDevice</a>
<a id='L26495' name='L26495'></a> 26495           || event-&gt;minor_code == <a href='../S/2289.html#L879' title='Defined at 879 in src/xterm.c.'>X_XIAllowEvents</a>))
<a id='L26496' name='L26496'></a> 26496     <strong class='reserved'>return</strong> 0;
<a id='L26497' name='L26497'></a> 26497 <em class='sharp'>#endif</em>
<a id='L26498' name='L26498'></a> 26498 
<a id='L26499' name='L26499'></a> 26499   stack = x_find_error_handler (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, event);
<a id='L26500' name='L26500'></a> 26500 
<a id='L26501' name='L26501'></a> 26501   <strong class='reserved'>if</strong> (stack)
<a id='L26502' name='L26502'></a> 26502     x_error_catcher (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, event, stack);
<a id='L26503' name='L26503'></a> 26503   <strong class='reserved'>else</strong>
<a id='L26504' name='L26504'></a> 26504     x_error_quitter (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, event);
<a id='L26505' name='L26505'></a> 26505   <strong class='reserved'>return</strong> 0;
<a id='L26506' name='L26506'></a> 26506 <em class='brace'>}</em>
<a id='L26507' name='L26507'></a> 26507 
<a id='L26508' name='L26508'></a> 26508 <em class='comment'>/* This is the usual handler for X protocol errors.</em>
<a id='L26509' name='L26509'></a> 26509 <em class='comment'>   It kills all frames on the display that we got the error for.</em>
<a id='L26510' name='L26510'></a> 26510 <em class='comment'>   If that was the only one, it prints an error message and kills Emacs.  */</em>
<a id='L26511' name='L26511'></a> 26511 
<a id='L26512' name='L26512'></a> 26512 <em class='comment'>/* .gdbinit puts a breakpoint here, so make sure it is not inlined.  */</em>
<a id='L26513' name='L26513'></a> 26513 
<a id='L26514' name='L26514'></a> 26514 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong> <a href='../S/2374.html#L276' title='Defined at 276 in src/conf_post.h.'>NO_INLINE</a>
<a id='L26515' name='L26515'></a> 26515 x_error_quitter (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, XErrorEvent *event)
<a id='L26516' name='L26516'></a> 26516 <em class='brace'>{</em>
<a id='L26517' name='L26517'></a> 26517   <strong class='reserved'>char</strong> buf[256], buf1[800 + <a href='../S/2707.html#L66' title='Defined at 66 in lib/intprops.h.'>INT_STRLEN_BOUND</a> (<strong class='reserved'>int</strong>)
<a id='L26518' name='L26518'></a> 26518                       + <a href='../S/2707.html#L66' title='Defined at 66 in lib/intprops.h.'>INT_STRLEN_BOUND</a> (<strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong>)
<a id='L26519' name='L26519'></a> 26519                       + <a href='../S/2707.html#L66' title='Defined at 66 in lib/intprops.h.'>INT_STRLEN_BOUND</a> (XID)
<a id='L26520' name='L26520'></a> 26520                       + <a href='../S/2707.html#L66' title='Defined at 66 in lib/intprops.h.'>INT_STRLEN_BOUND</a> (<strong class='reserved'>int</strong>)];
<a id='L26521' name='L26521'></a> 26521 
<a id='L26522' name='L26522'></a> 26522   <em class='comment'>/* Ignore BadName errors.  They can happen because of fonts</em>
<a id='L26523' name='L26523'></a> 26523 <em class='comment'>     or colors that are not defined.  */</em>
<a id='L26524' name='L26524'></a> 26524 
<a id='L26525' name='L26525'></a> 26525   <strong class='reserved'>if</strong> (event-&gt;error_code == BadName)
<a id='L26526' name='L26526'></a> 26526     <strong class='reserved'>return</strong>;
<a id='L26527' name='L26527'></a> 26527 
<a id='L26528' name='L26528'></a> 26528   <em class='comment'>/* Note that there is no real way portable across R3/R4 to get the</em>
<a id='L26529' name='L26529'></a> 26529 <em class='comment'>     original error handler.  */</em>
<a id='L26530' name='L26530'></a> 26530 
<a id='L26531' name='L26531'></a> 26531   XGetErrorText (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, event-&gt;error_code, buf, <strong class='reserved'>sizeof</strong> (buf));
<a id='L26532' name='L26532'></a> 26532   <a href='../D/17583.html' title='Multiple defined in 3 places.'>sprintf</a> (buf1, "X protocol error: %s on protocol request %d\n"
<a id='L26533' name='L26533'></a> 26533            "Serial no: %lu\n"
<a id='L26534' name='L26534'></a> 26534            "Failing resource ID (if any): 0x%lx\n"
<a id='L26535' name='L26535'></a> 26535            "Minor code: %d\n"
<a id='L26536' name='L26536'></a> 26536            "This is a bug!  Please report this to bug-gnu-emacs@gnu.org!\n",
<a id='L26537' name='L26537'></a> 26537            buf, event-&gt;request_code, event-&gt;serial, event-&gt;resourceid,
<a id='L26538' name='L26538'></a> 26538            event-&gt;minor_code);
<a id='L26539' name='L26539'></a> 26539   x_connection_closed (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, buf1, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L26540' name='L26540'></a> 26540 <em class='brace'>}</em>
<a id='L26541' name='L26541'></a> 26541 
<a id='L26542' name='L26542'></a> 26542 
<a id='L26543' name='L26543'></a> 26543 <em class='comment'>/* This is the handler for X IO errors, always.</em>
<a id='L26544' name='L26544'></a> 26544 <em class='comment'>   It kills all frames on the display that we lost touch with.</em>
<a id='L26545' name='L26545'></a> 26545 <em class='comment'>   If that was the only one, it prints an error message and kills Emacs.  */</em>
<a id='L26546' name='L26546'></a> 26546 
<a id='L26547' name='L26547'></a> 26547 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong> <a href='../S/2374.html#L276' title='Defined at 276 in src/conf_post.h.'>NO_INLINE</a>
<a id='L26548' name='L26548'></a> 26548 x_io_error_quitter (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>)
<a id='L26549' name='L26549'></a> 26549 <em class='brace'>{</em>
<a id='L26550' name='L26550'></a> 26550   <strong class='reserved'>char</strong> buf[256];
<a id='L26551' name='L26551'></a> 26551 
<a id='L26552' name='L26552'></a> 26552   <a href='../D/17523.html' title='Multiple defined in 10 places.'>snprintf</a> (buf, <strong class='reserved'>sizeof</strong> buf, "Connection lost to X server '%s'",
<a id='L26553' name='L26553'></a> 26553             DisplayString (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>));
<a id='L26554' name='L26554'></a> 26554   x_connection_closed (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, buf, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L26555' name='L26555'></a> 26555 
<a id='L26556' name='L26556'></a> 26556   <strong class='reserved'>return</strong> 0;
<a id='L26557' name='L26557'></a> 26557 <em class='brace'>}</em>
<a id='L26558' name='L26558'></a> 26558 
<a id='L26559' name='L26559'></a> 26559 
<a id='L26560' name='L26560'></a> 26560 <em class='comment'>/* Changing the font of the frame.  */</em>
<a id='L26561' name='L26561'></a> 26561 
<a id='L26562' name='L26562'></a> 26562 <em class='comment'>/* Give frame F the font FONT-OBJECT as its default font.  The return</em>
<a id='L26563' name='L26563'></a> 26563 <em class='comment'>   value is FONT-OBJECT.  FONTSET is an ID of the fontset for the</em>
<a id='L26564' name='L26564'></a> 26564 <em class='comment'>   frame.  If it is negative, generate a new fontset from</em>
<a id='L26565' name='L26565'></a> 26565 <em class='comment'>   FONT-OBJECT.  */</em>
<a id='L26566' name='L26566'></a> 26566 
<a id='L26567' name='L26567'></a> 26567 <strong class='reserved'>static</strong> <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a>
<a id='L26568' name='L26568'></a> 26568 x_new_font (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> font_object, <strong class='reserved'>int</strong> fontset)
<a id='L26569' name='L26569'></a> 26569 <em class='brace'>{</em>
<a id='L26570' name='L26570'></a> 26570   <strong class='reserved'>struct</strong> <a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a> *<a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a> = <a href='../S/2293.html#L533' title='Defined at 533 in src/font.h.'>XFONT_OBJECT</a> (font_object);
<a id='L26571' name='L26571'></a> 26571   <strong class='reserved'>int</strong> unit, font_ascent, font_descent;
<a id='L26572' name='L26572'></a> 26572 
<a id='L26573' name='L26573'></a> 26573   <strong class='reserved'>if</strong> (fontset &lt; 0)
<a id='L26574' name='L26574'></a> 26574     fontset = <a href='../S/2163.html#L1813' title='Defined at 1813 in src/fontset.c.'>fontset_from_font</a> (font_object);
<a id='L26575' name='L26575'></a> 26575   <a href='../D/2303.html' title='Multiple defined in 6 places.'>FRAME_FONTSET</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = fontset;
<a id='L26576' name='L26576'></a> 26576   <strong class='reserved'>if</strong> (<a href='../D/2302.html' title='Multiple defined in 7 places.'>FRAME_FONT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) == <a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>)
<a id='L26577' name='L26577'></a> 26577     <em class='comment'>/* This font is already set in frame F.  There's nothing more to</em>
<a id='L26578' name='L26578'></a> 26578 <em class='comment'>       do.  */</em>
<a id='L26579' name='L26579'></a> 26579     <strong class='reserved'>return</strong> font_object;
<a id='L26580' name='L26580'></a> 26580 
<a id='L26581' name='L26581'></a> 26581   <a href='../D/2302.html' title='Multiple defined in 7 places.'>FRAME_FONT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = <a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>;
<a id='L26582' name='L26582'></a> 26582   <a href='../D/2258.html' title='Multiple defined in 6 places.'>FRAME_BASELINE_OFFSET</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = <a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>-&gt;baseline_offset;
<a id='L26583' name='L26583'></a> 26583   <a href='../S/2183.html#L1547' title='Defined at 1547 in src/frame.h.'>FRAME_COLUMN_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = <a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>-&gt;average_width;
<a id='L26584' name='L26584'></a> 26584   <a href='../S/2224.html#L29390' title='Defined at 29390 in src/xdisp.c.'>get_font_ascent_descent</a> (<a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>, &amp;font_ascent, &amp;font_descent);
<a id='L26585' name='L26585'></a> 26585   <a href='../S/2183.html#L1543' title='Defined at 1543 in src/frame.h.'>FRAME_LINE_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = font_ascent + font_descent;
<a id='L26586' name='L26586'></a> 26586 
<a id='L26587' name='L26587'></a> 26587 <em class='sharp'>#ifndef</em> USE_X_TOOLKIT
<a id='L26588' name='L26588'></a> 26588   <a href='../S/2183.html#L1072' title='Defined at 1072 in src/frame.h.'>FRAME_MENU_BAR_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = <a href='../S/2183.html#L1071' title='Defined at 1071 in src/frame.h.'>FRAME_MENU_BAR_LINES</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) * <a href='../S/2183.html#L1543' title='Defined at 1543 in src/frame.h.'>FRAME_LINE_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L26589' name='L26589'></a> 26589 <em class='sharp'>#endif</em>
<a id='L26590' name='L26590'></a> 26590   <em class='comment'>/* We could use a more elaborate calculation here.  */</em>
<a id='L26591' name='L26591'></a> 26591   <a href='../S/2183.html#L1076' title='Defined at 1076 in src/frame.h.'>FRAME_TAB_BAR_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = <a href='../S/2183.html#L1075' title='Defined at 1075 in src/frame.h.'>FRAME_TAB_BAR_LINES</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) * <a href='../S/2183.html#L1543' title='Defined at 1543 in src/frame.h.'>FRAME_LINE_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L26592' name='L26592'></a> 26592 
<a id='L26593' name='L26593'></a> 26593   <em class='comment'>/* Compute character columns occupied by scrollbar.</em>
<a id='L26594' name='L26594'></a> 26594 <em class='comment'></em>
<a id='L26595' name='L26595'></a> 26595 <em class='comment'>     Don't do things differently for non-toolkit scrollbars</em>
<a id='L26596' name='L26596'></a> 26596 <em class='comment'>     (Bug#17163).  */</em>
<a id='L26597' name='L26597'></a> 26597   unit = <a href='../S/2183.html#L1547' title='Defined at 1547 in src/frame.h.'>FRAME_COLUMN_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L26598' name='L26598'></a> 26598   <strong class='reserved'>if</strong> (<a href='../S/2183.html#L1287' title='Defined at 1287 in src/frame.h.'>FRAME_CONFIG_SCROLL_BAR_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) &gt; 0)
<a id='L26599' name='L26599'></a> 26599     <a href='../S/2183.html#L1297' title='Defined at 1297 in src/frame.h.'>FRAME_CONFIG_SCROLL_BAR_COLS</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L26600' name='L26600'></a> 26600       = (<a href='../S/2183.html#L1287' title='Defined at 1287 in src/frame.h.'>FRAME_CONFIG_SCROLL_BAR_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) + unit - 1) / unit;
<a id='L26601' name='L26601'></a> 26601   <strong class='reserved'>else</strong>
<a id='L26602' name='L26602'></a> 26602     <a href='../S/2183.html#L1297' title='Defined at 1297 in src/frame.h.'>FRAME_CONFIG_SCROLL_BAR_COLS</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = (14 + unit - 1) / unit;
<a id='L26603' name='L26603'></a> 26603 
<a id='L26604' name='L26604'></a> 26604 
<a id='L26605' name='L26605'></a> 26605   <em class='comment'>/* Don't change the size of a tip frame; there's no point in doing it</em>
<a id='L26606' name='L26606'></a> 26606 <em class='comment'>     because it's done in Fx_show_tip, and it leads to problems because</em>
<a id='L26607' name='L26607'></a> 26607 <em class='comment'>     the tip frame has no widget.  */</em>
<a id='L26608' name='L26608'></a> 26608   <strong class='reserved'>if</strong> (<a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) != 0 &amp;&amp; !<a href='../D/2425.html' title='Multiple defined in 2 places.'>FRAME_TOOLTIP_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L26609' name='L26609'></a> 26609     <a href='../S/2247.html#L643' title='Defined at 643 in src/frame.c.'>adjust_frame_size</a>
<a id='L26610' name='L26610'></a> 26610       (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/2183.html#L1060' title='Defined at 1060 in src/frame.h.'>FRAME_COLS</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) * <a href='../S/2183.html#L1547' title='Defined at 1547 in src/frame.h.'>FRAME_COLUMN_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L26611' name='L26611'></a> 26611        <a href='../S/2183.html#L1061' title='Defined at 1061 in src/frame.h.'>FRAME_LINES</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) * <a href='../S/2183.html#L1543' title='Defined at 1543 in src/frame.h.'>FRAME_LINE_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), 3, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>, Qfont);
<a id='L26612' name='L26612'></a> 26612 
<a id='L26613' name='L26613'></a> 26613 <em class='sharp'>#ifdef</em> HAVE_X_I18N
<a id='L26614' name='L26614'></a> 26614   <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1470' title='Defined at 1470 in src/xterm.h.'>FRAME_XIC</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L26615' name='L26615'></a> 26615       &amp;&amp; (<a href='../S/2212.html#L1473' title='Defined at 1473 in src/xterm.h.'>FRAME_XIC_STYLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) &amp; (XIMPreeditPosition | XIMStatusArea)))
<a id='L26616' name='L26616'></a> 26616     <em class='brace'>{</em>
<a id='L26617' name='L26617'></a> 26617       <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L26618' name='L26618'></a> 26618       <a href='../S/2296.html#L3781' title='Defined at 3781 in src/xfns.c.'>xic_set_xfontset</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/5917.html' title='Multiple defined in 2 places.'>SSDATA</a> (<a href='../S/2163.html#L899' title='Defined at 899 in src/fontset.c.'>fontset_ascii</a> (fontset)));
<a id='L26619' name='L26619'></a> 26619       <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L26620' name='L26620'></a> 26620     <em class='brace'>}</em>
<a id='L26621' name='L26621'></a> 26621 <em class='sharp'>#endif</em>
<a id='L26622' name='L26622'></a> 26622 
<a id='L26623' name='L26623'></a> 26623   <strong class='reserved'>return</strong> font_object;
<a id='L26624' name='L26624'></a> 26624 <em class='brace'>}</em>
<a id='L26625' name='L26625'></a> 26625 
<a id='L26626' name='L26626'></a> 26626 
<a id='L26627' name='L26627'></a> 26627 <em class='comment'>/***********************************************************************</em>
<a id='L26628' name='L26628'></a> 26628 <em class='comment'>                           X Input Methods</em>
<a id='L26629' name='L26629'></a> 26629 <em class='comment'> ***********************************************************************/</em>
<a id='L26630' name='L26630'></a> 26630 
<a id='L26631' name='L26631'></a> 26631 <em class='sharp'>#ifdef</em> HAVE_X_I18N
<a id='L26632' name='L26632'></a> 26632 
<a id='L26633' name='L26633'></a> 26633 <em class='sharp'>#ifdef</em> HAVE_X11R6
<a id='L26634' name='L26634'></a> 26634 
<a id='L26635' name='L26635'></a> 26635 <em class='comment'>/* HAVE_X11R6 means Xlib conforms to the R6 specification or later.</em>
<a id='L26636' name='L26636'></a> 26636 <em class='comment'>   HAVE_X11R6_XIM, OTOH, means that Emacs should try to use R6-style</em>
<a id='L26637' name='L26637'></a> 26637 <em class='comment'>   callback driven input method initialization.  They are separate</em>
<a id='L26638' name='L26638'></a> 26638 <em class='comment'>   because Sun apparently ships buggy Xlib with some versions of</em>
<a id='L26639' name='L26639'></a> 26639 <em class='comment'>   Solaris... */</em>
<a id='L26640' name='L26640'></a> 26640 
<a id='L26641' name='L26641'></a> 26641 <em class='sharp'>#ifdef</em> HAVE_X11R6_XIM
<a id='L26642' name='L26642'></a> 26642 
<a id='L26643' name='L26643'></a> 26643 <em class='comment'>/* If preedit text is set on F, cancel preedit, free the text, and</em>
<a id='L26644' name='L26644'></a> 26644 <em class='comment'>   generate the appropriate events to cancel the preedit display.</em>
<a id='L26645' name='L26645'></a> 26645 <em class='comment'></em>
<a id='L26646' name='L26646'></a> 26646 <em class='comment'>   This is mainly useful when the connection to the IM server is</em>
<a id='L26647' name='L26647'></a> 26647 <em class='comment'>   dropped during preconversion.  */</em>
<a id='L26648' name='L26648'></a> 26648 
<a id='L26649' name='L26649'></a> 26649 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L26650' name='L26650'></a> 26650 x_maybe_clear_preedit (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L26651' name='L26651'></a> 26651 <em class='brace'>{</em>
<a id='L26652' name='L26652'></a> 26652   <strong class='reserved'>struct</strong> <a href='../D/19627.html' title='Multiple defined in 5 places.'>x_output</a> *output;
<a id='L26653' name='L26653'></a> 26653   <strong class='reserved'>struct</strong> <a href='../S/2231.html#L350' title='Defined at 350 in src/termhooks.h.'>input_event</a> ie;
<a id='L26654' name='L26654'></a> 26654 
<a id='L26655' name='L26655'></a> 26655   output = <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L26656' name='L26656'></a> 26656 
<a id='L26657' name='L26657'></a> 26657   <strong class='reserved'>if</strong> (!output-&gt;preedit_chars)
<a id='L26658' name='L26658'></a> 26658     <strong class='reserved'>return</strong>;
<a id='L26659' name='L26659'></a> 26659 
<a id='L26660' name='L26660'></a> 26660   <a href='../S/2231.html#L393' title='Defined at 393 in src/termhooks.h.'>EVENT_INIT</a> (ie);
<a id='L26661' name='L26661'></a> 26661   ie.kind = <a href='../S/2231.html#L295' title='Defined at 295 in src/termhooks.h.'>PREEDIT_TEXT_EVENT</a>;
<a id='L26662' name='L26662'></a> 26662   ie.arg = Qnil;
<a id='L26663' name='L26663'></a> 26663   <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (ie.frame_or_window, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L26664' name='L26664'></a> 26664   <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (ie.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, 0);
<a id='L26665' name='L26665'></a> 26665   <a href='../D/7342.html' title='Multiple defined in 2 places.'>XSETINT</a> (ie.y, 0);
<a id='L26666' name='L26666'></a> 26666   <a href='../D/13636.html' title='Multiple defined in 2 places.'>kbd_buffer_store_event</a> (&amp;ie);
<a id='L26667' name='L26667'></a> 26667 
<a id='L26668' name='L26668'></a> 26668   <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (output-&gt;preedit_chars);
<a id='L26669' name='L26669'></a> 26669 
<a id='L26670' name='L26670'></a> 26670   output-&gt;preedit_size = 0;
<a id='L26671' name='L26671'></a> 26671   output-&gt;preedit_active = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L26672' name='L26672'></a> 26672   output-&gt;preedit_chars = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L26673' name='L26673'></a> 26673   output-&gt;preedit_caret = 0;
<a id='L26674' name='L26674'></a> 26674 <em class='brace'>}</em>
<a id='L26675' name='L26675'></a> 26675 
<a id='L26676' name='L26676'></a> 26676 <em class='comment'>/* XIM destroy callback function, which is called whenever the</em>
<a id='L26677' name='L26677'></a> 26677 <em class='comment'>   connection to input method XIM dies.  CLIENT_DATA contains a</em>
<a id='L26678' name='L26678'></a> 26678 <em class='comment'>   pointer to the x_display_info structure corresponding to XIM.  */</em>
<a id='L26679' name='L26679'></a> 26679 
<a id='L26680' name='L26680'></a> 26680 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L26681' name='L26681'></a> 26681 xim_destroy_callback (XIM xim, XPointer client_data, XPointer call_data)
<a id='L26682' name='L26682'></a> 26682 <em class='brace'>{</em>
<a id='L26683' name='L26683'></a> 26683   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo = (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *) client_data;
<a id='L26684' name='L26684'></a> 26684   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>;
<a id='L26685' name='L26685'></a> 26685 
<a id='L26686' name='L26686'></a> 26686   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L26687' name='L26687'></a> 26687 
<a id='L26688' name='L26688'></a> 26688   <em class='comment'>/* No need to call XDestroyIC.. */</em>
<a id='L26689' name='L26689'></a> 26689   <a href='../S/2183.html#L1405' title='Defined at 1405 in src/frame.h.'>FOR_EACH_FRAME</a> (<a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)
<a id='L26690' name='L26690'></a> 26690     <em class='brace'>{</em>
<a id='L26691' name='L26691'></a> 26691       <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>);
<a id='L26692' name='L26692'></a> 26692       <strong class='reserved'>if</strong> (<a href='../S/2183.html#L919' title='Defined at 919 in src/frame.h.'>FRAME_X_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) &amp;&amp; <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) == dpyinfo)
<a id='L26693' name='L26693'></a> 26693         <em class='brace'>{</em>
<a id='L26694' name='L26694'></a> 26694           <a href='../S/2212.html#L1470' title='Defined at 1470 in src/xterm.h.'>FRAME_XIC</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L26695' name='L26695'></a> 26695           <a href='../S/2296.html#L2992' title='Defined at 2992 in src/xfns.c.'>xic_free_xfontset</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L26696' name='L26696'></a> 26696 
<a id='L26697' name='L26697'></a> 26697           <em class='comment'>/* Free the preedit text if necessary.  */</em>
<a id='L26698' name='L26698'></a> 26698           x_maybe_clear_preedit (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L26699' name='L26699'></a> 26699         <em class='brace'>}</em>
<a id='L26700' name='L26700'></a> 26700     <em class='brace'>}</em>
<a id='L26701' name='L26701'></a> 26701 
<a id='L26702' name='L26702'></a> 26702   <em class='comment'>/* No need to call XCloseIM.  */</em>
<a id='L26703' name='L26703'></a> 26703   dpyinfo-&gt;xim = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L26704' name='L26704'></a> 26704 
<a id='L26705' name='L26705'></a> 26705   <em class='comment'>/* Also free IM values; those are allocated separately upon</em>
<a id='L26706' name='L26706'></a> 26706 <em class='comment'>     XGetIMValues.  */</em>
<a id='L26707' name='L26707'></a> 26707   <strong class='reserved'>if</strong> (dpyinfo-&gt;xim_styles)
<a id='L26708' name='L26708'></a> 26708     XFree (dpyinfo-&gt;xim_styles);
<a id='L26709' name='L26709'></a> 26709   dpyinfo-&gt;xim_styles = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L26710' name='L26710'></a> 26710   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L26711' name='L26711'></a> 26711 <em class='brace'>}</em>
<a id='L26712' name='L26712'></a> 26712 
<a id='L26713' name='L26713'></a> 26713 <em class='sharp'>#endif</em>
<a id='L26714' name='L26714'></a> 26714 
<a id='L26715' name='L26715'></a> 26715 <em class='sharp'>#endif</em> <em class='comment'>/* HAVE_X11R6 */</em>
<a id='L26716' name='L26716'></a> 26716 
<a id='L26717' name='L26717'></a> 26717 <em class='comment'>/* Open the connection to the XIM server on display DPYINFO.</em>
<a id='L26718' name='L26718'></a> 26718 <em class='comment'>   RESOURCE_NAME is the resource name Emacs uses.  */</em>
<a id='L26719' name='L26719'></a> 26719 
<a id='L26720' name='L26720'></a> 26720 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L26721' name='L26721'></a> 26721 xim_open_dpy (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo, <strong class='reserved'>char</strong> *resource_name)
<a id='L26722' name='L26722'></a> 26722 <em class='brace'>{</em>
<a id='L26723' name='L26723'></a> 26723 <em class='sharp'>#ifdef</em> HAVE_XIM
<a id='L26724' name='L26724'></a> 26724   XIM xim;
<a id='L26725' name='L26725'></a> 26725   <strong class='reserved'>const</strong> <strong class='reserved'>char</strong> *locale;
<a id='L26726' name='L26726'></a> 26726 
<a id='L26727' name='L26727'></a> 26727   <strong class='reserved'>if</strong> (dpyinfo-&gt;use_xim)
<a id='L26728' name='L26728'></a> 26728     <em class='brace'>{</em>
<a id='L26729' name='L26729'></a> 26729       <strong class='reserved'>if</strong> (dpyinfo-&gt;xim)
<a id='L26730' name='L26730'></a> 26730         <em class='brace'>{</em>
<a id='L26731' name='L26731'></a> 26731           XCloseIM (dpyinfo-&gt;xim);
<a id='L26732' name='L26732'></a> 26732 
<a id='L26733' name='L26733'></a> 26733           <em class='comment'>/* Free values left over from the last time the IM</em>
<a id='L26734' name='L26734'></a> 26734 <em class='comment'>             connection was established.  */</em>
<a id='L26735' name='L26735'></a> 26735 
<a id='L26736' name='L26736'></a> 26736           <strong class='reserved'>if</strong> (dpyinfo-&gt;xim_styles)
<a id='L26737' name='L26737'></a> 26737             XFree (dpyinfo-&gt;xim_styles);
<a id='L26738' name='L26738'></a> 26738           dpyinfo-&gt;xim_styles = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L26739' name='L26739'></a> 26739         <em class='brace'>}</em>
<a id='L26740' name='L26740'></a> 26740 
<a id='L26741' name='L26741'></a> 26741       xim = XOpenIM (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, dpyinfo-&gt;rdb, resource_name,
<a id='L26742' name='L26742'></a> 26742                      emacs_class);
<a id='L26743' name='L26743'></a> 26743       dpyinfo-&gt;xim = xim;
<a id='L26744' name='L26744'></a> 26744 
<a id='L26745' name='L26745'></a> 26745       <strong class='reserved'>if</strong> (xim)
<a id='L26746' name='L26746'></a> 26746         <em class='brace'>{</em>
<a id='L26747' name='L26747'></a> 26747 <em class='sharp'>#ifdef</em> HAVE_X11R6_XIM
<a id='L26748' name='L26748'></a> 26748           XIMCallback <a href='../D/10432.html' title='Multiple defined in 2 places.'>destroy</a>;
<a id='L26749' name='L26749'></a> 26749 <em class='sharp'>#endif</em>
<a id='L26750' name='L26750'></a> 26750 
<a id='L26751' name='L26751'></a> 26751           <em class='comment'>/* Get supported styles and XIM values.  */</em>
<a id='L26752' name='L26752'></a> 26752           XGetIMValues (xim, XNQueryInputStyle, &amp;dpyinfo-&gt;xim_styles, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L26753' name='L26753'></a> 26753 
<a id='L26754' name='L26754'></a> 26754 <em class='sharp'>#ifdef</em> HAVE_X11R6_XIM
<a id='L26755' name='L26755'></a> 26755           <a href='../D/10432.html' title='Multiple defined in 2 places.'>destroy</a>.callback = xim_destroy_callback;
<a id='L26756' name='L26756'></a> 26756           <a href='../D/10432.html' title='Multiple defined in 2 places.'>destroy</a>.client_data = (XPointer)dpyinfo;
<a id='L26757' name='L26757'></a> 26757           XSetIMValues (xim, XNDestroyCallback, &amp;<a href='../D/10432.html' title='Multiple defined in 2 places.'>destroy</a>, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L26758' name='L26758'></a> 26758 <em class='sharp'>#endif</em>
<a id='L26759' name='L26759'></a> 26759 
<a id='L26760' name='L26760'></a> 26760           locale = XLocaleOfIM (xim);
<a id='L26761' name='L26761'></a> 26761 
<a id='L26762' name='L26762'></a> 26762           <em class='comment'>/* Now try to determine the coding system that should be</em>
<a id='L26763' name='L26763'></a> 26763 <em class='comment'>             used.  locale is in Host Portable Character Encoding, and</em>
<a id='L26764' name='L26764'></a> 26764 <em class='comment'>             as such can be passed to build_string as is.  */</em>
<a id='L26765' name='L26765'></a> 26765           dpyinfo-&gt;xim_coding = <a href='../S/2224.html#L3049' title='Defined at 3049 in src/xdisp.c.'>safe_call1</a> (Vx_input_coding_function,
<a id='L26766' name='L26766'></a> 26766                                             <a href='../D/9420.html' title='Multiple defined in 2 places.'>build_string</a> (locale));
<a id='L26767' name='L26767'></a> 26767         <em class='brace'>}</em>
<a id='L26768' name='L26768'></a> 26768     <em class='brace'>}</em>
<a id='L26769' name='L26769'></a> 26769   <strong class='reserved'>else</strong>
<a id='L26770' name='L26770'></a> 26770 <em class='sharp'>#endif</em> <em class='comment'>/* HAVE_XIM */</em>
<a id='L26771' name='L26771'></a> 26771     dpyinfo-&gt;xim = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L26772' name='L26772'></a> 26772 <em class='brace'>}</em>
<a id='L26773' name='L26773'></a> 26773 
<a id='L26774' name='L26774'></a> 26774 
<a id='L26775' name='L26775'></a> 26775 <em class='sharp'>#ifdef</em> HAVE_X11R6_XIM
<a id='L26776' name='L26776'></a> 26776 
<a id='L26777' name='L26777'></a> 26777 <em class='comment'>/* XIM instantiate callback function, which is called whenever an XIM</em>
<a id='L26778' name='L26778'></a> 26778 <em class='comment'>   server is available.  DISPLAY is the display of the XIM.</em>
<a id='L26779' name='L26779'></a> 26779 <em class='comment'>   CLIENT_DATA contains a pointer to an xim_inst_t structure created</em>
<a id='L26780' name='L26780'></a> 26780 <em class='comment'>   when the callback was registered.  */</em>
<a id='L26781' name='L26781'></a> 26781 
<a id='L26782' name='L26782'></a> 26782 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L26783' name='L26783'></a> 26783 xim_instantiate_callback (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, XPointer client_data, XPointer call_data)
<a id='L26784' name='L26784'></a> 26784 <em class='brace'>{</em>
<a id='L26785' name='L26785'></a> 26785   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L159' title='Defined at 159 in src/xterm.h.'>xim_inst_t</a> *xim_inst = (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L159' title='Defined at 159 in src/xterm.h.'>xim_inst_t</a> *) client_data;
<a id='L26786' name='L26786'></a> 26786   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo = xim_inst-&gt;dpyinfo;
<a id='L26787' name='L26787'></a> 26787 
<a id='L26788' name='L26788'></a> 26788   <strong class='reserved'>if</strong> (x_dnd_in_progress)
<a id='L26789' name='L26789'></a> 26789     <strong class='reserved'>return</strong>;
<a id='L26790' name='L26790'></a> 26790 
<a id='L26791' name='L26791'></a> 26791   <em class='comment'>/* We don't support multiple XIM connections. */</em>
<a id='L26792' name='L26792'></a> 26792   <strong class='reserved'>if</strong> (dpyinfo-&gt;xim)
<a id='L26793' name='L26793'></a> 26793     <strong class='reserved'>return</strong>;
<a id='L26794' name='L26794'></a> 26794 
<a id='L26795' name='L26795'></a> 26795   xim_open_dpy (dpyinfo, xim_inst-&gt;resource_name);
<a id='L26796' name='L26796'></a> 26796 
<a id='L26797' name='L26797'></a> 26797   <em class='comment'>/* Create XIC for the existing frames on the same display, as long</em>
<a id='L26798' name='L26798'></a> 26798 <em class='comment'>     as they have no XIC.  */</em>
<a id='L26799' name='L26799'></a> 26799   <strong class='reserved'>if</strong> (dpyinfo-&gt;xim &amp;&amp; dpyinfo-&gt;reference_count &gt; 0)
<a id='L26800' name='L26800'></a> 26800     <em class='brace'>{</em>
<a id='L26801' name='L26801'></a> 26801       <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>;
<a id='L26802' name='L26802'></a> 26802 
<a id='L26803' name='L26803'></a> 26803       <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L26804' name='L26804'></a> 26804       <a href='../S/2183.html#L1405' title='Defined at 1405 in src/frame.h.'>FOR_EACH_FRAME</a> (<a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)
<a id='L26805' name='L26805'></a> 26805         <em class='brace'>{</em>
<a id='L26806' name='L26806'></a> 26806           <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>);
<a id='L26807' name='L26807'></a> 26807 
<a id='L26808' name='L26808'></a> 26808           <strong class='reserved'>if</strong> (<a href='../S/2183.html#L919' title='Defined at 919 in src/frame.h.'>FRAME_X_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L26809' name='L26809'></a> 26809               &amp;&amp; <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) == xim_inst-&gt;dpyinfo)
<a id='L26810' name='L26810'></a> 26810             <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1470' title='Defined at 1470 in src/xterm.h.'>FRAME_XIC</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) == <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>)
<a id='L26811' name='L26811'></a> 26811               <em class='brace'>{</em>
<a id='L26812' name='L26812'></a> 26812                 <a href='../S/2296.html#L3057' title='Defined at 3057 in src/xfns.c.'>create_frame_xic</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L26813' name='L26813'></a> 26813                 <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1473' title='Defined at 1473 in src/xterm.h.'>FRAME_XIC_STYLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) &amp; XIMStatusArea)
<a id='L26814' name='L26814'></a> 26814                   <a href='../S/2296.html#L3269' title='Defined at 3269 in src/xfns.c.'>xic_set_statusarea</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L26815' name='L26815'></a> 26815                 <strong class='reserved'>struct</strong> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> *w = <a href='../D/7409.html' title='Multiple defined in 2 places.'>XWINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;selected_window);
<a id='L26816' name='L26816'></a> 26816                 <a href='../S/2296.html#L3218' title='Defined at 3218 in src/xfns.c.'>xic_set_preeditarea</a> (w, w-&gt;cursor.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, w-&gt;cursor.y);
<a id='L26817' name='L26817'></a> 26817               <em class='brace'>}</em>
<a id='L26818' name='L26818'></a> 26818         <em class='brace'>}</em>
<a id='L26819' name='L26819'></a> 26819 
<a id='L26820' name='L26820'></a> 26820       <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L26821' name='L26821'></a> 26821     <em class='brace'>}</em>
<a id='L26822' name='L26822'></a> 26822 <em class='brace'>}</em>
<a id='L26823' name='L26823'></a> 26823 
<a id='L26824' name='L26824'></a> 26824 <em class='sharp'>#endif</em> <em class='comment'>/* HAVE_X11R6_XIM */</em>
<a id='L26825' name='L26825'></a> 26825 
<a id='L26826' name='L26826'></a> 26826 
<a id='L26827' name='L26827'></a> 26827 <em class='comment'>/* Open a connection to the XIM server on display DPYINFO.</em>
<a id='L26828' name='L26828'></a> 26828 <em class='comment'>   RESOURCE_NAME is the resource name for Emacs.  On X11R5, open the</em>
<a id='L26829' name='L26829'></a> 26829 <em class='comment'>   connection only at the first time.  On X11R6, open the connection</em>
<a id='L26830' name='L26830'></a> 26830 <em class='comment'>   in the XIM instantiate callback function.  */</em>
<a id='L26831' name='L26831'></a> 26831 
<a id='L26832' name='L26832'></a> 26832 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L26833' name='L26833'></a> 26833 xim_initialize (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo, <strong class='reserved'>char</strong> *resource_name)
<a id='L26834' name='L26834'></a> 26834 <em class='brace'>{</em>
<a id='L26835' name='L26835'></a> 26835   dpyinfo-&gt;xim = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L26836' name='L26836'></a> 26836 <em class='sharp'>#ifdef</em> HAVE_XIM
<a id='L26837' name='L26837'></a> 26837   <strong class='reserved'>if</strong> (dpyinfo-&gt;use_xim)
<a id='L26838' name='L26838'></a> 26838     <em class='brace'>{</em>
<a id='L26839' name='L26839'></a> 26839 <em class='sharp'>#ifdef</em> HAVE_X11R6_XIM
<a id='L26840' name='L26840'></a> 26840       <strong class='reserved'>struct</strong> <a href='../S/2212.html#L159' title='Defined at 159 in src/xterm.h.'>xim_inst_t</a> *xim_inst = <a href='../D/20068.html' title='Multiple defined in 10 places.'>xmalloc</a> (<strong class='reserved'>sizeof</strong> *xim_inst);
<a id='L26841' name='L26841'></a> 26841       Bool ret;
<a id='L26842' name='L26842'></a> 26842 
<a id='L26843' name='L26843'></a> 26843       dpyinfo-&gt;xim_callback_data = xim_inst;
<a id='L26844' name='L26844'></a> 26844       xim_inst-&gt;dpyinfo = dpyinfo;
<a id='L26845' name='L26845'></a> 26845       xim_inst-&gt;resource_name = <a href='../D/20121.html' title='Multiple defined in 3 places.'>xstrdup</a> (resource_name);
<a id='L26846' name='L26846'></a> 26846 
<a id='L26847' name='L26847'></a> 26847       <em class='comment'>/* The last argument is XPointer in XFree86 but (XPointer *) on</em>
<a id='L26848' name='L26848'></a> 26848 <em class='comment'>         Tru64, at least, but the configure test doesn't work because</em>
<a id='L26849' name='L26849'></a> 26849 <em class='comment'>         xim_instantiate_callback can either be XIMProc or XIDProc, so</em>
<a id='L26850' name='L26850'></a> 26850 <em class='comment'>         just cast to void *.  */</em>
<a id='L26851' name='L26851'></a> 26851 
<a id='L26852' name='L26852'></a> 26852       ret = XRegisterIMInstantiateCallback (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L26853' name='L26853'></a> 26853                                             dpyinfo-&gt;rdb,
<a id='L26854' name='L26854'></a> 26854                                             xim_inst-&gt;resource_name,
<a id='L26855' name='L26855'></a> 26855                                             emacs_class,
<a id='L26856' name='L26856'></a> 26856                                             xim_instantiate_callback,
<a id='L26857' name='L26857'></a> 26857                                             (<strong class='reserved'>void</strong> *) xim_inst);
<a id='L26858' name='L26858'></a> 26858       <a href='../D/10871.html' title='Multiple defined in 5 places.'>eassert</a> (ret);
<a id='L26859' name='L26859'></a> 26859 <em class='sharp'>#else</em> <em class='comment'>/* not HAVE_X11R6_XIM */</em>
<a id='L26860' name='L26860'></a> 26860       xim_open_dpy (dpyinfo, resource_name);
<a id='L26861' name='L26861'></a> 26861 <em class='sharp'>#endif</em> <em class='comment'>/* not HAVE_X11R6_XIM */</em>
<a id='L26862' name='L26862'></a> 26862     <em class='brace'>}</em>
<a id='L26863' name='L26863'></a> 26863 <em class='sharp'>#endif</em> <em class='comment'>/* HAVE_XIM */</em>
<a id='L26864' name='L26864'></a> 26864 <em class='brace'>}</em>
<a id='L26865' name='L26865'></a> 26865 
<a id='L26866' name='L26866'></a> 26866 
<a id='L26867' name='L26867'></a> 26867 <em class='comment'>/* Close the connection to the XIM server on display DPYINFO.</em>
<a id='L26868' name='L26868'></a> 26868 <em class='comment'>   Unregister any IM instantiation callback previously installed,</em>
<a id='L26869' name='L26869'></a> 26869 <em class='comment'>   close the connection to the IM server if possible, and free any</em>
<a id='L26870' name='L26870'></a> 26870 <em class='comment'>   retrieved IM values.  */</em>
<a id='L26871' name='L26871'></a> 26871 
<a id='L26872' name='L26872'></a> 26872 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L26873' name='L26873'></a> 26873 xim_close_dpy (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo)
<a id='L26874' name='L26874'></a> 26874 <em class='brace'>{</em>
<a id='L26875' name='L26875'></a> 26875 <em class='sharp'>#ifdef</em> HAVE_XIM
<a id='L26876' name='L26876'></a> 26876 <em class='sharp'>#ifdef</em> HAVE_X11R6_XIM
<a id='L26877' name='L26877'></a> 26877   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L159' title='Defined at 159 in src/xterm.h.'>xim_inst_t</a> *xim_inst;
<a id='L26878' name='L26878'></a> 26878   Bool rc;
<a id='L26879' name='L26879'></a> 26879 
<a id='L26880' name='L26880'></a> 26880   <em class='comment'>/* If dpyinfo-&gt;xim_callback_data is not set, then IM support wasn't</em>
<a id='L26881' name='L26881'></a> 26881 <em class='comment'>     initialized, which can happen if Xlib doesn't understand the C</em>
<a id='L26882' name='L26882'></a> 26882 <em class='comment'>     locale being used.  */</em>
<a id='L26883' name='L26883'></a> 26883 
<a id='L26884' name='L26884'></a> 26884   <strong class='reserved'>if</strong> (dpyinfo-&gt;xim_callback_data)
<a id='L26885' name='L26885'></a> 26885     <em class='brace'>{</em>
<a id='L26886' name='L26886'></a> 26886       xim_inst = dpyinfo-&gt;xim_callback_data;
<a id='L26887' name='L26887'></a> 26887 
<a id='L26888' name='L26888'></a> 26888       <strong class='reserved'>if</strong> (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>)
<a id='L26889' name='L26889'></a> 26889         <em class='brace'>{</em>
<a id='L26890' name='L26890'></a> 26890           rc = XUnregisterIMInstantiateCallback (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L26891' name='L26891'></a> 26891                                                  dpyinfo-&gt;rdb,
<a id='L26892' name='L26892'></a> 26892                                                  xim_inst-&gt;resource_name,
<a id='L26893' name='L26893'></a> 26893                                                  emacs_class,
<a id='L26894' name='L26894'></a> 26894                                                  xim_instantiate_callback,
<a id='L26895' name='L26895'></a> 26895                                                  (<strong class='reserved'>void</strong> *) xim_inst);
<a id='L26896' name='L26896'></a> 26896           <a href='../D/10871.html' title='Multiple defined in 5 places.'>eassert</a> (rc);
<a id='L26897' name='L26897'></a> 26897         <em class='brace'>}</em>
<a id='L26898' name='L26898'></a> 26898 
<a id='L26899' name='L26899'></a> 26899       <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (xim_inst-&gt;resource_name);
<a id='L26900' name='L26900'></a> 26900       <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (xim_inst);
<a id='L26901' name='L26901'></a> 26901     <em class='brace'>}</em>
<a id='L26902' name='L26902'></a> 26902 <em class='sharp'>#endif</em> <em class='comment'>/* HAVE_X11R6_XIM */</em>
<a id='L26903' name='L26903'></a> 26903 
<a id='L26904' name='L26904'></a> 26904   <em class='comment'>/* Now close the connection to the input method server.  This may</em>
<a id='L26905' name='L26905'></a> 26905 <em class='comment'>     access the display connection, and isn't safe if the display has</em>
<a id='L26906' name='L26906'></a> 26906 <em class='comment'>     already been closed.  */</em>
<a id='L26907' name='L26907'></a> 26907 
<a id='L26908' name='L26908'></a> 26908   <strong class='reserved'>if</strong> (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> &amp;&amp; dpyinfo-&gt;xim)
<a id='L26909' name='L26909'></a> 26909     XCloseIM (dpyinfo-&gt;xim);
<a id='L26910' name='L26910'></a> 26910   dpyinfo-&gt;xim = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L26911' name='L26911'></a> 26911 
<a id='L26912' name='L26912'></a> 26912   <em class='comment'>/* Free the list of XIM styles retrieved.  */</em>
<a id='L26913' name='L26913'></a> 26913 
<a id='L26914' name='L26914'></a> 26914   <strong class='reserved'>if</strong> (dpyinfo-&gt;xim_styles)
<a id='L26915' name='L26915'></a> 26915     XFree (dpyinfo-&gt;xim_styles);
<a id='L26916' name='L26916'></a> 26916   dpyinfo-&gt;xim_styles = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L26917' name='L26917'></a> 26917 <em class='sharp'>#endif</em> <em class='comment'>/* HAVE_XIM */</em>
<a id='L26918' name='L26918'></a> 26918 <em class='brace'>}</em>
<a id='L26919' name='L26919'></a> 26919 
<a id='L26920' name='L26920'></a> 26920 <em class='sharp'>#endif</em> <em class='comment'>/* not HAVE_X11R6_XIM */</em>
<a id='L26921' name='L26921'></a> 26921 
<a id='L26922' name='L26922'></a> 26922 
<a id='L26923' name='L26923'></a> 26923 
<a id='L26924' name='L26924'></a> 26924 <em class='comment'>/* Calculate the absolute position in frame F</em>
<a id='L26925' name='L26925'></a> 26925 <em class='comment'>   from its current recorded position values and gravity.  */</em>
<a id='L26926' name='L26926'></a> 26926 
<a id='L26927' name='L26927'></a> 26927 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L26928' name='L26928'></a> 26928 x_calc_absolute_position (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L26929' name='L26929'></a> 26929 <em class='brace'>{</em>
<a id='L26930' name='L26930'></a> 26930   <strong class='reserved'>int</strong> flags = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;size_hint_flags;
<a id='L26931' name='L26931'></a> 26931   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *p = <a href='../D/2370.html' title='Multiple defined in 2 places.'>FRAME_PARENT_FRAME</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L26932' name='L26932'></a> 26932 
<a id='L26933' name='L26933'></a> 26933   <em class='comment'>/* We have nothing to do if the current position</em>
<a id='L26934' name='L26934'></a> 26934 <em class='comment'>     is already for the top-left corner.  */</em>
<a id='L26935' name='L26935'></a> 26935   <strong class='reserved'>if</strong> (! ((flags &amp; <a href='../D/7293.html' title='Multiple defined in 5 places.'>XNegative</a>) || (flags &amp; <a href='../D/7556.html' title='Multiple defined in 5 places.'>YNegative</a>)))
<a id='L26936' name='L26936'></a> 26936     <strong class='reserved'>return</strong>;
<a id='L26937' name='L26937'></a> 26937 
<a id='L26938' name='L26938'></a> 26938   <em class='comment'>/* Treat negative positions as relative to the leftmost bottommost</em>
<a id='L26939' name='L26939'></a> 26939 <em class='comment'>     position that fits on the screen.  */</em>
<a id='L26940' name='L26940'></a> 26940   <strong class='reserved'>if</strong> ((flags &amp; <a href='../D/7293.html' title='Multiple defined in 5 places.'>XNegative</a>) &amp;&amp; (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;left_pos &lt;= 0))
<a id='L26941' name='L26941'></a> 26941     <em class='brace'>{</em>
<a id='L26942' name='L26942'></a> 26942       <strong class='reserved'>int</strong> width = <a href='../S/2183.html#L1051' title='Defined at 1051 in src/frame.h.'>FRAME_PIXEL_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L26943' name='L26943'></a> 26943 
<a id='L26944' name='L26944'></a> 26944       <em class='comment'>/* A frame that has been visible at least once should have outer</em>
<a id='L26945' name='L26945'></a> 26945 <em class='comment'>         edges.  */</em>
<a id='L26946' name='L26946'></a> 26946       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;has_been_visible &amp;&amp; !p)
<a id='L26947' name='L26947'></a> 26947         <em class='brace'>{</em>
<a id='L26948' name='L26948'></a> 26948           <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>;
<a id='L26949' name='L26949'></a> 26949           <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> edges = Qnil;
<a id='L26950' name='L26950'></a> 26950 
<a id='L26951' name='L26951'></a> 26951           <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L26952' name='L26952'></a> 26952           edges = Fx_frame_edges (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, Qouter_edges);
<a id='L26953' name='L26953'></a> 26953           <strong class='reserved'>if</strong> (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (edges))
<a id='L26954' name='L26954'></a> 26954             width = (<a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (Fnth (<a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (2), edges))
<a id='L26955' name='L26955'></a> 26955                      - <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (Fnth (<a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (0), edges)));
<a id='L26956' name='L26956'></a> 26956         <em class='brace'>}</em>
<a id='L26957' name='L26957'></a> 26957 
<a id='L26958' name='L26958'></a> 26958       <strong class='reserved'>if</strong> (p)
<a id='L26959' name='L26959'></a> 26959         <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;left_pos = (<a href='../S/2183.html#L1051' title='Defined at 1051 in src/frame.h.'>FRAME_PIXEL_WIDTH</a> (p) - width - 2 * <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;border_width
<a id='L26960' name='L26960'></a> 26960                        + <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;left_pos);
<a id='L26961' name='L26961'></a> 26961       <strong class='reserved'>else</strong>
<a id='L26962' name='L26962'></a> 26962         <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;left_pos = (x_display_pixel_width (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L26963' name='L26963'></a> 26963                        - width + <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;left_pos);
<a id='L26964' name='L26964'></a> 26964 
<a id='L26965' name='L26965'></a> 26965     <em class='brace'>}</em>
<a id='L26966' name='L26966'></a> 26966 
<a id='L26967' name='L26967'></a> 26967   <strong class='reserved'>if</strong> ((flags &amp; <a href='../D/7556.html' title='Multiple defined in 5 places.'>YNegative</a>) &amp;&amp; (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;top_pos &lt;= 0))
<a id='L26968' name='L26968'></a> 26968     <em class='brace'>{</em>
<a id='L26969' name='L26969'></a> 26969       <strong class='reserved'>int</strong> height = <a href='../S/2183.html#L1052' title='Defined at 1052 in src/frame.h.'>FRAME_PIXEL_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L26970' name='L26970'></a> 26970 
<a id='L26971' name='L26971'></a> 26971 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> USE_X_TOOLKIT &amp;&amp; <strong class='reserved'>defined</strong> USE_MOTIF
<a id='L26972' name='L26972'></a> 26972       <em class='comment'>/* Something is fishy here.  When using Motif, starting Emacs with</em>
<a id='L26973' name='L26973'></a> 26973 <em class='comment'>         `-g -0-0', the frame appears too low by a few pixels.</em>
<a id='L26974' name='L26974'></a> 26974 <em class='comment'></em>
<a id='L26975' name='L26975'></a> 26975 <em class='comment'>         This seems to be so because initially, while Emacs is starting,</em>
<a id='L26976' name='L26976'></a> 26976 <em class='comment'>         the column widget's height and the frame's pixel height are</em>
<a id='L26977' name='L26977'></a> 26977 <em class='comment'>         different.  The column widget's height is the right one.  In</em>
<a id='L26978' name='L26978'></a> 26978 <em class='comment'>         later invocations, when Emacs is up, the frame's pixel height</em>
<a id='L26979' name='L26979'></a> 26979 <em class='comment'>         is right, though.</em>
<a id='L26980' name='L26980'></a> 26980 <em class='comment'></em>
<a id='L26981' name='L26981'></a> 26981 <em class='comment'>         It's not obvious where the initial small difference comes from.</em>
<a id='L26982' name='L26982'></a> 26982 <em class='comment'>         2000-12-01, gerd.  */</em>
<a id='L26983' name='L26983'></a> 26983 
<a id='L26984' name='L26984'></a> 26984       XtVaGetValues (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;column_widget, XtNheight, &amp;height, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L26985' name='L26985'></a> 26985 <em class='sharp'>#endif</em>
<a id='L26986' name='L26986'></a> 26986 
<a id='L26987' name='L26987'></a> 26987       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;has_been_visible &amp;&amp; !p)
<a id='L26988' name='L26988'></a> 26988         <em class='brace'>{</em>
<a id='L26989' name='L26989'></a> 26989           <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>;
<a id='L26990' name='L26990'></a> 26990           <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> edges = Qnil;
<a id='L26991' name='L26991'></a> 26991 
<a id='L26992' name='L26992'></a> 26992           <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L26993' name='L26993'></a> 26993           <strong class='reserved'>if</strong> (<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (edges))
<a id='L26994' name='L26994'></a> 26994             edges = Fx_frame_edges (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, Qouter_edges);
<a id='L26995' name='L26995'></a> 26995           <strong class='reserved'>if</strong> (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (edges))
<a id='L26996' name='L26996'></a> 26996             height = (<a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (Fnth (<a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (3), edges))
<a id='L26997' name='L26997'></a> 26997                       - <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (Fnth (<a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (1), edges)));
<a id='L26998' name='L26998'></a> 26998         <em class='brace'>}</em>
<a id='L26999' name='L26999'></a> 26999 
<a id='L27000' name='L27000'></a> 27000       <strong class='reserved'>if</strong> (p)
<a id='L27001' name='L27001'></a> 27001         <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;top_pos = (<a href='../S/2183.html#L1052' title='Defined at 1052 in src/frame.h.'>FRAME_PIXEL_HEIGHT</a> (p) - height - 2 * <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;border_width
<a id='L27002' name='L27002'></a> 27002                        + <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;top_pos);
<a id='L27003' name='L27003'></a> 27003       <strong class='reserved'>else</strong>
<a id='L27004' name='L27004'></a> 27004         <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;top_pos = (x_display_pixel_height (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L27005' name='L27005'></a> 27005                       - height + <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;top_pos);
<a id='L27006' name='L27006'></a> 27006   <em class='brace'>}</em>
<a id='L27007' name='L27007'></a> 27007 
<a id='L27008' name='L27008'></a> 27008   <em class='comment'>/* The left_pos and top_pos</em>
<a id='L27009' name='L27009'></a> 27009 <em class='comment'>     are now relative to the top and left screen edges,</em>
<a id='L27010' name='L27010'></a> 27010 <em class='comment'>     so the flags should correspond.  */</em>
<a id='L27011' name='L27011'></a> 27011   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;size_hint_flags &amp;= ~ (<a href='../D/7293.html' title='Multiple defined in 5 places.'>XNegative</a> | <a href='../D/7556.html' title='Multiple defined in 5 places.'>YNegative</a>);
<a id='L27012' name='L27012'></a> 27012 <em class='brace'>}</em>
<a id='L27013' name='L27013'></a> 27013 
<a id='L27014' name='L27014'></a> 27014 <em class='comment'>/* CHANGE_GRAVITY is 1 when calling from Fset_frame_position,</em>
<a id='L27015' name='L27015'></a> 27015 <em class='comment'>   to really change the position, and 0 when calling from</em>
<a id='L27016' name='L27016'></a> 27016 <em class='comment'>   x_make_frame_visible (in that case, XOFF and YOFF are the current</em>
<a id='L27017' name='L27017'></a> 27017 <em class='comment'>   position values).  It is -1 when calling from gui_set_frame_parameters,</em>
<a id='L27018' name='L27018'></a> 27018 <em class='comment'>   which means, do adjust for borders but don't change the gravity.  */</em>
<a id='L27019' name='L27019'></a> 27019 
<a id='L27020' name='L27020'></a> 27020 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L27021' name='L27021'></a> 27021 x_set_offset (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <strong class='reserved'>int</strong> xoff, <strong class='reserved'>int</strong> yoff, <strong class='reserved'>int</strong> change_gravity)
<a id='L27022' name='L27022'></a> 27022 <em class='brace'>{</em>
<a id='L27023' name='L27023'></a> 27023   <strong class='reserved'>int</strong> modified_top, modified_left;
<a id='L27024' name='L27024'></a> 27024 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L27025' name='L27025'></a> 27025   <strong class='reserved'>int</strong> scale = <a href='../S/2362.html#L284' title='Defined at 284 in src/gtkutil.c.'>xg_get_scale</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L27026' name='L27026'></a> 27026 <em class='sharp'>#endif</em>
<a id='L27027' name='L27027'></a> 27027 
<a id='L27028' name='L27028'></a> 27028   <strong class='reserved'>if</strong> (change_gravity &gt; 0)
<a id='L27029' name='L27029'></a> 27029     <em class='brace'>{</em>
<a id='L27030' name='L27030'></a> 27030       <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;top_pos = yoff;
<a id='L27031' name='L27031'></a> 27031       <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;left_pos = xoff;
<a id='L27032' name='L27032'></a> 27032       <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;size_hint_flags &amp;= ~ (<a href='../D/7293.html' title='Multiple defined in 5 places.'>XNegative</a> | <a href='../D/7556.html' title='Multiple defined in 5 places.'>YNegative</a>);
<a id='L27033' name='L27033'></a> 27033       <strong class='reserved'>if</strong> (xoff &lt; 0)
<a id='L27034' name='L27034'></a> 27034         <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;size_hint_flags |= <a href='../D/7293.html' title='Multiple defined in 5 places.'>XNegative</a>;
<a id='L27035' name='L27035'></a> 27035       <strong class='reserved'>if</strong> (yoff &lt; 0)
<a id='L27036' name='L27036'></a> 27036         <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;size_hint_flags |= <a href='../D/7556.html' title='Multiple defined in 5 places.'>YNegative</a>;
<a id='L27037' name='L27037'></a> 27037       <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;win_gravity = <a href='../D/4579.html' title='Multiple defined in 5 places.'>NorthWestGravity</a>;
<a id='L27038' name='L27038'></a> 27038     <em class='brace'>}</em>
<a id='L27039' name='L27039'></a> 27039 
<a id='L27040' name='L27040'></a> 27040   x_calc_absolute_position (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L27041' name='L27041'></a> 27041 
<a id='L27042' name='L27042'></a> 27042   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L27043' name='L27043'></a> 27043   x_wm_set_size_hint (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 0, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L27044' name='L27044'></a> 27044 
<a id='L27045' name='L27045'></a> 27045 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L27046' name='L27046'></a> 27046   <strong class='reserved'>if</strong> (x_gtk_use_window_move)
<a id='L27047' name='L27047'></a> 27047     <em class='brace'>{</em>
<a id='L27048' name='L27048'></a> 27048       <em class='comment'>/* When a position change was requested and the outer GTK widget</em>
<a id='L27049' name='L27049'></a> 27049 <em class='comment'>         has been realized already, leave it to gtk_window_move to</em>
<a id='L27050' name='L27050'></a> 27050 <em class='comment'>         DTRT and return.  Used for Bug#25851 and Bug#25943.  Convert</em>
<a id='L27051' name='L27051'></a> 27051 <em class='comment'>         from X pixels to GTK scaled pixels.  */</em>
<a id='L27052' name='L27052'></a> 27052       <strong class='reserved'>if</strong> (change_gravity != 0 &amp;&amp; <a href='../D/2309.html' title='Multiple defined in 2 places.'>FRAME_GTK_OUTER_WIDGET</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L27053' name='L27053'></a> 27053         gtk_window_move (GTK_WINDOW (<a href='../D/2309.html' title='Multiple defined in 2 places.'>FRAME_GTK_OUTER_WIDGET</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)),
<a id='L27054' name='L27054'></a> 27054                          <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;left_pos / scale, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;top_pos / scale);
<a id='L27055' name='L27055'></a> 27055       <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L27056' name='L27056'></a> 27056       <strong class='reserved'>return</strong>;
<a id='L27057' name='L27057'></a> 27057     <em class='brace'>}</em>
<a id='L27058' name='L27058'></a> 27058 <em class='sharp'>#endif</em> <em class='comment'>/* USE_GTK */</em>
<a id='L27059' name='L27059'></a> 27059 
<a id='L27060' name='L27060'></a> 27060   modified_left = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;left_pos;
<a id='L27061' name='L27061'></a> 27061   modified_top = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;top_pos;
<a id='L27062' name='L27062'></a> 27062 
<a id='L27063' name='L27063'></a> 27063   <strong class='reserved'>if</strong> (change_gravity != 0 &amp;&amp; <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;wm_type == <a href='../S/2212.html#L686' title='Defined at 686 in src/xterm.h.'>X_WMTYPE_A</a>)
<a id='L27064' name='L27064'></a> 27064     <em class='brace'>{</em>
<a id='L27065' name='L27065'></a> 27065       <em class='comment'>/* Some WMs (twm, wmaker at least) has an offset that is smaller</em>
<a id='L27066' name='L27066'></a> 27066 <em class='comment'>         than the WM decorations.  So we use the calculated offset instead</em>
<a id='L27067' name='L27067'></a> 27067 <em class='comment'>         of the WM decoration sizes here (x/y_pixels_outer_diff).  */</em>
<a id='L27068' name='L27068'></a> 27068       modified_left += <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;move_offset_left;
<a id='L27069' name='L27069'></a> 27069       modified_top += <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;move_offset_top;
<a id='L27070' name='L27070'></a> 27070     <em class='brace'>}</em>
<a id='L27071' name='L27071'></a> 27071 
<a id='L27072' name='L27072'></a> 27072 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L27073' name='L27073'></a> 27073   <em class='comment'>/* Make sure we adjust for possible scaling.  */</em>
<a id='L27074' name='L27074'></a> 27074   gtk_window_move (GTK_WINDOW (<a href='../D/2309.html' title='Multiple defined in 2 places.'>FRAME_GTK_OUTER_WIDGET</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)),
<a id='L27075' name='L27075'></a> 27075                    modified_left / scale, modified_top / scale);
<a id='L27076' name='L27076'></a> 27076 <em class='sharp'>#else</em>
<a id='L27077' name='L27077'></a> 27077   XMoveWindow (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L27078' name='L27078'></a> 27078                modified_left, modified_top);
<a id='L27079' name='L27079'></a> 27079 <em class='sharp'>#endif</em>
<a id='L27080' name='L27080'></a> 27080 
<a id='L27081' name='L27081'></a> 27081   <em class='comment'>/* The following code is too slow over a latent network</em>
<a id='L27082' name='L27082'></a> 27082 <em class='comment'>     connection.  */</em>
<a id='L27083' name='L27083'></a> 27083   <strong class='reserved'>if</strong> (<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (Vx_lax_frame_positioning))
<a id='L27084' name='L27084'></a> 27084     <em class='brace'>{</em>
<a id='L27085' name='L27085'></a> 27085       <em class='comment'>/* 'x_sync_with_move' is too costly for dragging child frames.  */</em>
<a id='L27086' name='L27086'></a> 27086       <strong class='reserved'>if</strong> (!<a href='../D/2370.html' title='Multiple defined in 2 places.'>FRAME_PARENT_FRAME</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L27087' name='L27087'></a> 27087           <em class='comment'>/* If no window manager exists, just calling XSync will be</em>
<a id='L27088' name='L27088'></a> 27088 <em class='comment'>             sufficient to ensure that the window geometry has been</em>
<a id='L27089' name='L27089'></a> 27089 <em class='comment'>             updated.  */</em>
<a id='L27090' name='L27090'></a> 27090           &amp;&amp; <a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (Vx_no_window_manager))
<a id='L27091' name='L27091'></a> 27091         <em class='brace'>{</em>
<a id='L27092' name='L27092'></a> 27092           x_sync_with_move (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;left_pos, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;top_pos,
<a id='L27093' name='L27093'></a> 27093                             <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;wm_type == <a href='../S/2212.html#L685' title='Defined at 685 in src/xterm.h.'>X_WMTYPE_UNKNOWN</a>);
<a id='L27094' name='L27094'></a> 27094 
<a id='L27095' name='L27095'></a> 27095           <em class='comment'>/* change_gravity is non-zero when this function is called from Lisp to</em>
<a id='L27096' name='L27096'></a> 27096 <em class='comment'>             programmatically move a frame.  In that case, we call</em>
<a id='L27097' name='L27097'></a> 27097 <em class='comment'>             x_check_expected_move to discover if we have a "Type A" or "Type B"</em>
<a id='L27098' name='L27098'></a> 27098 <em class='comment'>             window manager, and, for a "Type A" window manager, adjust the position</em>
<a id='L27099' name='L27099'></a> 27099 <em class='comment'>             of the frame.</em>
<a id='L27100' name='L27100'></a> 27100 <em class='comment'></em>
<a id='L27101' name='L27101'></a> 27101 <em class='comment'>             We call x_check_expected_move if a programmatic move occurred, and</em>
<a id='L27102' name='L27102'></a> 27102 <em class='comment'>             either the window manager type (A/B) is unknown or it is Type A but we</em>
<a id='L27103' name='L27103'></a> 27103 <em class='comment'>             need to compute the top/left offset adjustment for this frame.  */</em>
<a id='L27104' name='L27104'></a> 27104 
<a id='L27105' name='L27105'></a> 27105           <strong class='reserved'>if</strong> (change_gravity != 0
<a id='L27106' name='L27106'></a> 27106               &amp;&amp; (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;wm_type == <a href='../S/2212.html#L685' title='Defined at 685 in src/xterm.h.'>X_WMTYPE_UNKNOWN</a>
<a id='L27107' name='L27107'></a> 27107                   || (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;wm_type == <a href='../S/2212.html#L686' title='Defined at 686 in src/xterm.h.'>X_WMTYPE_A</a>
<a id='L27108' name='L27108'></a> 27108                       &amp;&amp; (<a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;move_offset_left == 0
<a id='L27109' name='L27109'></a> 27109                           &amp;&amp; <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;move_offset_top == 0))))
<a id='L27110' name='L27110'></a> 27110             x_check_expected_move (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, modified_left, modified_top);
<a id='L27111' name='L27111'></a> 27111         <em class='brace'>}</em>
<a id='L27112' name='L27112'></a> 27112       <em class='comment'>/* Instead, just wait for the last ConfigureWindow request to</em>
<a id='L27113' name='L27113'></a> 27113 <em class='comment'>         complete.  No window manager is involved when moving child</em>
<a id='L27114' name='L27114'></a> 27114 <em class='comment'>         frames.  */</em>
<a id='L27115' name='L27115'></a> 27115       <strong class='reserved'>else</strong>
<a id='L27116' name='L27116'></a> 27116         <a href='../D/7378.html' title='Multiple defined in 3 places.'>XSync</a> (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), False);
<a id='L27117' name='L27117'></a> 27117     <em class='brace'>}</em>
<a id='L27118' name='L27118'></a> 27118 
<a id='L27119' name='L27119'></a> 27119   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L27120' name='L27120'></a> 27120 <em class='brace'>}</em>
<a id='L27121' name='L27121'></a> 27121 
<a id='L27122' name='L27122'></a> 27122 <strong class='reserved'>static</strong> <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a>
<a id='L27123' name='L27123'></a> 27123 x_get_wm_check_window (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo)
<a id='L27124' name='L27124'></a> 27124 <em class='brace'>{</em>
<a id='L27125' name='L27125'></a> 27125   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> result;
<a id='L27126' name='L27126'></a> 27126   <strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *tmp_data = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L27127' name='L27127'></a> 27127   <strong class='reserved'>int</strong> rc, actual_format;
<a id='L27128' name='L27128'></a> 27128   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> actual_size, bytes_remaining;
<a id='L27129' name='L27129'></a> 27129   Atom actual_type;
<a id='L27130' name='L27130'></a> 27130 
<a id='L27131' name='L27131'></a> 27131   rc = XGetWindowProperty (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, dpyinfo-&gt;root_window,
<a id='L27132' name='L27132'></a> 27132                            dpyinfo-&gt;Xatom_net_supporting_wm_check,
<a id='L27133' name='L27133'></a> 27133                            0, 1, False, XA_WINDOW, &amp;actual_type,
<a id='L27134' name='L27134'></a> 27134                            &amp;actual_format, &amp;actual_size,
<a id='L27135' name='L27135'></a> 27135                            &amp;bytes_remaining, &amp;tmp_data);
<a id='L27136' name='L27136'></a> 27136 
<a id='L27137' name='L27137'></a> 27137   <strong class='reserved'>if</strong> (rc != Success || actual_type != XA_WINDOW
<a id='L27138' name='L27138'></a> 27138       || actual_format != 32 || actual_size != 1)
<a id='L27139' name='L27139'></a> 27139     <em class='brace'>{</em>
<a id='L27140' name='L27140'></a> 27140       <strong class='reserved'>if</strong> (tmp_data)
<a id='L27141' name='L27141'></a> 27141         XFree (tmp_data);
<a id='L27142' name='L27142'></a> 27142 
<a id='L27143' name='L27143'></a> 27143       <strong class='reserved'>return</strong> None;
<a id='L27144' name='L27144'></a> 27144     <em class='brace'>}</em>
<a id='L27145' name='L27145'></a> 27145 
<a id='L27146' name='L27146'></a> 27146   result = *(<a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> *) tmp_data;
<a id='L27147' name='L27147'></a> 27147   XFree (tmp_data);
<a id='L27148' name='L27148'></a> 27148 
<a id='L27149' name='L27149'></a> 27149   <strong class='reserved'>return</strong> result;
<a id='L27150' name='L27150'></a> 27150 <em class='brace'>}</em>
<a id='L27151' name='L27151'></a> 27151 
<a id='L27152' name='L27152'></a> 27152 <em class='comment'>/* Return true if _NET_SUPPORTING_WM_CHECK window exists and _NET_SUPPORTED</em>
<a id='L27153' name='L27153'></a> 27153 <em class='comment'>   on the root window for frame F contains ATOMNAME.</em>
<a id='L27154' name='L27154'></a> 27154 <em class='comment'>   This is how a WM check shall be done according to the Window Manager</em>
<a id='L27155' name='L27155'></a> 27155 <em class='comment'>   Specification/Extended Window Manager Hints at</em>
<a id='L27156' name='L27156'></a> 27156 <em class='comment'>   https://freedesktop.org/wiki/Specifications/wm-spec/.  */</em>
<a id='L27157' name='L27157'></a> 27157 
<a id='L27158' name='L27158'></a> 27158 <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L27159' name='L27159'></a> 27159 x_wm_supports_1 (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo, Atom want_atom)
<a id='L27160' name='L27160'></a> 27160 <em class='brace'>{</em>
<a id='L27161' name='L27161'></a> 27161   Atom actual_type;
<a id='L27162' name='L27162'></a> 27162   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> actual_size, bytes_remaining;
<a id='L27163' name='L27163'></a> 27163   <strong class='reserved'>int</strong> i, rc, actual_format;
<a id='L27164' name='L27164'></a> 27164   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> ret;
<a id='L27165' name='L27165'></a> 27165   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> wmcheck_window;
<a id='L27166' name='L27166'></a> 27166   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> target_window = dpyinfo-&gt;root_window;
<a id='L27167' name='L27167'></a> 27167   <strong class='reserved'>int</strong> max_len = 65536;
<a id='L27168' name='L27168'></a> 27168   <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy = dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>;
<a id='L27169' name='L27169'></a> 27169   <strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *tmp_data = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L27170' name='L27170'></a> 27170   Atom target_type = XA_WINDOW;
<a id='L27171' name='L27171'></a> 27171 
<a id='L27172' name='L27172'></a> 27172   <em class='comment'>/* The user says there's no window manager, so take him up on</em>
<a id='L27173' name='L27173'></a> 27173 <em class='comment'>     it.  */</em>
<a id='L27174' name='L27174'></a> 27174   <strong class='reserved'>if</strong> (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (Vx_no_window_manager))
<a id='L27175' name='L27175'></a> 27175     <strong class='reserved'>return</strong> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L27176' name='L27176'></a> 27176 
<a id='L27177' name='L27177'></a> 27177   <em class='comment'>/* If the window system says Emacs is untrusted, there will be no</em>
<a id='L27178' name='L27178'></a> 27178 <em class='comment'>     way to send any information to the window manager, making any</em>
<a id='L27179' name='L27179'></a> 27179 <em class='comment'>     hints useless.  */</em>
<a id='L27180' name='L27180'></a> 27180   <strong class='reserved'>if</strong> (dpyinfo-&gt;untrusted)
<a id='L27181' name='L27181'></a> 27181     <strong class='reserved'>return</strong> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L27182' name='L27182'></a> 27182 
<a id='L27183' name='L27183'></a> 27183   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L27184' name='L27184'></a> 27184 
<a id='L27185' name='L27185'></a> 27185   x_catch_errors (dpy);
<a id='L27186' name='L27186'></a> 27186 
<a id='L27187' name='L27187'></a> 27187   wmcheck_window = dpyinfo-&gt;net_supported_window;
<a id='L27188' name='L27188'></a> 27188 
<a id='L27189' name='L27189'></a> 27189   <strong class='reserved'>if</strong> (wmcheck_window == None)
<a id='L27190' name='L27190'></a> 27190     wmcheck_window = x_get_wm_check_window (dpyinfo);
<a id='L27191' name='L27191'></a> 27191 
<a id='L27192' name='L27192'></a> 27192   <strong class='reserved'>if</strong> (!<a href='../S/2289.html#L1982' title='Defined at 1982 in src/xterm.c.'>x_special_window_exists_p</a> (dpyinfo, wmcheck_window))
<a id='L27193' name='L27193'></a> 27193     <em class='brace'>{</em>
<a id='L27194' name='L27194'></a> 27194       <strong class='reserved'>if</strong> (dpyinfo-&gt;net_supported_window != None)
<a id='L27195' name='L27195'></a> 27195         <em class='brace'>{</em>
<a id='L27196' name='L27196'></a> 27196           dpyinfo-&gt;net_supported_window = None;
<a id='L27197' name='L27197'></a> 27197           wmcheck_window = x_get_wm_check_window (dpyinfo);
<a id='L27198' name='L27198'></a> 27198 
<a id='L27199' name='L27199'></a> 27199           <strong class='reserved'>if</strong> (!<a href='../S/2289.html#L1982' title='Defined at 1982 in src/xterm.c.'>x_special_window_exists_p</a> (dpyinfo, wmcheck_window))
<a id='L27200' name='L27200'></a> 27200             <em class='brace'>{</em>
<a id='L27201' name='L27201'></a> 27201               x_uncatch_errors ();
<a id='L27202' name='L27202'></a> 27202               <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L27203' name='L27203'></a> 27203               <strong class='reserved'>return</strong> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L27204' name='L27204'></a> 27204             <em class='brace'>}</em>
<a id='L27205' name='L27205'></a> 27205         <em class='brace'>}</em>
<a id='L27206' name='L27206'></a> 27206       <strong class='reserved'>else</strong>
<a id='L27207' name='L27207'></a> 27207         <em class='brace'>{</em>
<a id='L27208' name='L27208'></a> 27208           x_uncatch_errors ();
<a id='L27209' name='L27209'></a> 27209           <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L27210' name='L27210'></a> 27210           <strong class='reserved'>return</strong> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L27211' name='L27211'></a> 27211         <em class='brace'>}</em>
<a id='L27212' name='L27212'></a> 27212     <em class='brace'>}</em>
<a id='L27213' name='L27213'></a> 27213 
<a id='L27214' name='L27214'></a> 27214   <strong class='reserved'>if</strong> (dpyinfo-&gt;net_supported_window != wmcheck_window)
<a id='L27215' name='L27215'></a> 27215     <em class='brace'>{</em>
<a id='L27216' name='L27216'></a> 27216       <em class='comment'>/* Window changed, reload atoms */</em>
<a id='L27217' name='L27217'></a> 27217       <strong class='reserved'>if</strong> (dpyinfo-&gt;net_supported_atoms != <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>)
<a id='L27218' name='L27218'></a> 27218         XFree (dpyinfo-&gt;net_supported_atoms);
<a id='L27219' name='L27219'></a> 27219       dpyinfo-&gt;net_supported_atoms = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L27220' name='L27220'></a> 27220       dpyinfo-&gt;nr_net_supported_atoms = 0;
<a id='L27221' name='L27221'></a> 27221       dpyinfo-&gt;net_supported_window = 0;
<a id='L27222' name='L27222'></a> 27222 
<a id='L27223' name='L27223'></a> 27223       target_type = XA_ATOM;
<a id='L27224' name='L27224'></a> 27224       tmp_data = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L27225' name='L27225'></a> 27225       rc = XGetWindowProperty (dpy, target_window,
<a id='L27226' name='L27226'></a> 27226                                dpyinfo-&gt;Xatom_net_supported,
<a id='L27227' name='L27227'></a> 27227                                0, max_len, False, target_type,
<a id='L27228' name='L27228'></a> 27228                                &amp;actual_type, &amp;actual_format, &amp;actual_size,
<a id='L27229' name='L27229'></a> 27229                                &amp;bytes_remaining, &amp;tmp_data);
<a id='L27230' name='L27230'></a> 27230 
<a id='L27231' name='L27231'></a> 27231       <strong class='reserved'>if</strong> (rc != Success || actual_type != XA_ATOM || x_had_errors_p (dpy))
<a id='L27232' name='L27232'></a> 27232         <em class='brace'>{</em>
<a id='L27233' name='L27233'></a> 27233           <strong class='reserved'>if</strong> (tmp_data)
<a id='L27234' name='L27234'></a> 27234             XFree (tmp_data);
<a id='L27235' name='L27235'></a> 27235           x_uncatch_errors ();
<a id='L27236' name='L27236'></a> 27236           <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L27237' name='L27237'></a> 27237           <strong class='reserved'>return</strong> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L27238' name='L27238'></a> 27238         <em class='brace'>}</em>
<a id='L27239' name='L27239'></a> 27239 
<a id='L27240' name='L27240'></a> 27240       dpyinfo-&gt;net_supported_atoms = (Atom *) tmp_data;
<a id='L27241' name='L27241'></a> 27241       dpyinfo-&gt;nr_net_supported_atoms = actual_size;
<a id='L27242' name='L27242'></a> 27242       dpyinfo-&gt;net_supported_window = wmcheck_window;
<a id='L27243' name='L27243'></a> 27243     <em class='brace'>}</em>
<a id='L27244' name='L27244'></a> 27244 
<a id='L27245' name='L27245'></a> 27245   ret = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L27246' name='L27246'></a> 27246 
<a id='L27247' name='L27247'></a> 27247   <strong class='reserved'>for</strong> (i = 0; !ret &amp;&amp; i &lt; dpyinfo-&gt;nr_net_supported_atoms; ++i)
<a id='L27248' name='L27248'></a> 27248     ret = dpyinfo-&gt;net_supported_atoms[i] == want_atom;
<a id='L27249' name='L27249'></a> 27249 
<a id='L27250' name='L27250'></a> 27250   x_uncatch_errors ();
<a id='L27251' name='L27251'></a> 27251   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L27252' name='L27252'></a> 27252 
<a id='L27253' name='L27253'></a> 27253   <strong class='reserved'>return</strong> ret;
<a id='L27254' name='L27254'></a> 27254 <em class='brace'>}</em>
<a id='L27255' name='L27255'></a> 27255 
<a id='L27256' name='L27256'></a> 27256 <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L27257' name='L27257'></a> 27257 x_wm_supports (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, Atom want_atom)
<a id='L27258' name='L27258'></a> 27258 <em class='brace'>{</em>
<a id='L27259' name='L27259'></a> 27259   <strong class='reserved'>return</strong> x_wm_supports_1 (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L27260' name='L27260'></a> 27260                           want_atom);
<a id='L27261' name='L27261'></a> 27261 <em class='brace'>}</em>
<a id='L27262' name='L27262'></a> 27262 
<a id='L27263' name='L27263'></a> 27263 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L27264' name='L27264'></a> 27264 set_wm_state (<a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> <a href='../S/2741.html#L157' title='Defined at 157 in lib/nstrftime.c.'>add</a>, Atom atom, Atom <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>)
<a id='L27265' name='L27265'></a> 27265 <em class='brace'>{</em>
<a id='L27266' name='L27266'></a> 27266   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L27267' name='L27267'></a> 27267   XEvent msg;
<a id='L27268' name='L27268'></a> 27268 
<a id='L27269' name='L27269'></a> 27269   dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>));
<a id='L27270' name='L27270'></a> 27270   msg.xclient.type = ClientMessage;
<a id='L27271' name='L27271'></a> 27271   msg.xclient.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>));
<a id='L27272' name='L27272'></a> 27272   msg.xclient.message_type = dpyinfo-&gt;Xatom_net_wm_state;
<a id='L27273' name='L27273'></a> 27273   msg.xclient.format = 32;
<a id='L27274' name='L27274'></a> 27274 
<a id='L27275' name='L27275'></a> 27275   msg.xclient.data.l[0] = <a href='../S/2741.html#L157' title='Defined at 157 in lib/nstrftime.c.'>add</a> ? 1 : 0;
<a id='L27276' name='L27276'></a> 27276   msg.xclient.data.l[1] = atom;
<a id='L27277' name='L27277'></a> 27277   msg.xclient.data.l[2] = <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>;
<a id='L27278' name='L27278'></a> 27278   msg.xclient.data.l[3] = 1; <em class='comment'>/* Source indication.  */</em>
<a id='L27279' name='L27279'></a> 27279   msg.xclient.data.l[4] = 0;
<a id='L27280' name='L27280'></a> 27280 
<a id='L27281' name='L27281'></a> 27281   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L27282' name='L27282'></a> 27282   XSendEvent (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, dpyinfo-&gt;root_window,
<a id='L27283' name='L27283'></a> 27283               False, (SubstructureRedirectMask
<a id='L27284' name='L27284'></a> 27284                       | SubstructureNotifyMask), &amp;msg);
<a id='L27285' name='L27285'></a> 27285   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L27286' name='L27286'></a> 27286 <em class='brace'>}</em>
<a id='L27287' name='L27287'></a> 27287 
<a id='L27288' name='L27288'></a> 27288 <strong class='reserved'>void</strong>
<a id='L27289' name='L27289'></a> 27289 x_set_sticky (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> new_value, <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> old_value)
<a id='L27290' name='L27290'></a> 27290 <em class='brace'>{</em>
<a id='L27291' name='L27291'></a> 27291   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>;
<a id='L27292' name='L27292'></a> 27292   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L27293' name='L27293'></a> 27293 
<a id='L27294' name='L27294'></a> 27294   <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L27295' name='L27295'></a> 27295 
<a id='L27296' name='L27296'></a> 27296   set_wm_state (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, !<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (new_value),
<a id='L27297' name='L27297'></a> 27297                 dpyinfo-&gt;Xatom_net_wm_state_sticky, None);
<a id='L27298' name='L27298'></a> 27298 <em class='brace'>}</em>
<a id='L27299' name='L27299'></a> 27299 
<a id='L27300' name='L27300'></a> 27300 <strong class='reserved'>void</strong>
<a id='L27301' name='L27301'></a> 27301 x_set_shaded (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> new_value, <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> old_value)
<a id='L27302' name='L27302'></a> 27302 <em class='brace'>{</em>
<a id='L27303' name='L27303'></a> 27303   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>;
<a id='L27304' name='L27304'></a> 27304   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L27305' name='L27305'></a> 27305 
<a id='L27306' name='L27306'></a> 27306   <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L27307' name='L27307'></a> 27307 
<a id='L27308' name='L27308'></a> 27308   set_wm_state (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, !<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (new_value),
<a id='L27309' name='L27309'></a> 27309                 dpyinfo-&gt;Xatom_net_wm_state_shaded, None);
<a id='L27310' name='L27310'></a> 27310 <em class='brace'>}</em>
<a id='L27311' name='L27311'></a> 27311 
<a id='L27312' name='L27312'></a> 27312 <em class='comment'>/**</em>
<a id='L27313' name='L27313'></a> 27313 <em class='comment'> * x_set_skip_taskbar:</em>
<a id='L27314' name='L27314'></a> 27314 <em class='comment'> *</em>
<a id='L27315' name='L27315'></a> 27315 <em class='comment'> * Set frame F's `skip-taskbar' parameter.  If non-nil, this should</em>
<a id='L27316' name='L27316'></a> 27316 <em class='comment'> * remove F's icon from the taskbar associated with the display of F's</em>
<a id='L27317' name='L27317'></a> 27317 <em class='comment'> * window-system window and inhibit switching to F's window via</em>
<a id='L27318' name='L27318'></a> 27318 <em class='comment'> * &lt;Alt&gt;-&lt;TAB&gt;.  If nil, lift these restrictions.</em>
<a id='L27319' name='L27319'></a> 27319 <em class='comment'> *</em>
<a id='L27320' name='L27320'></a> 27320 <em class='comment'> * Some window managers may not honor this parameter.</em>
<a id='L27321' name='L27321'></a> 27321 <em class='comment'> */</em>
<a id='L27322' name='L27322'></a> 27322 <strong class='reserved'>void</strong>
<a id='L27323' name='L27323'></a> 27323 x_set_skip_taskbar (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> new_value, <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> old_value)
<a id='L27324' name='L27324'></a> 27324 <em class='brace'>{</em>
<a id='L27325' name='L27325'></a> 27325   <strong class='reserved'>if</strong> (!<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (new_value, old_value))
<a id='L27326' name='L27326'></a> 27326     <em class='brace'>{</em>
<a id='L27327' name='L27327'></a> 27327 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L27328' name='L27328'></a> 27328       <a href='../S/2362.html#L2117' title='Defined at 2117 in src/gtkutil.c.'>xg_set_skip_taskbar</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, new_value);
<a id='L27329' name='L27329'></a> 27329 <em class='sharp'>#else</em>
<a id='L27330' name='L27330'></a> 27330       <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>;
<a id='L27331' name='L27331'></a> 27331       <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L27332' name='L27332'></a> 27332 
<a id='L27333' name='L27333'></a> 27333       <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L27334' name='L27334'></a> 27334       set_wm_state (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, !<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (new_value),
<a id='L27335' name='L27335'></a> 27335                     dpyinfo-&gt;Xatom_net_wm_state_skip_taskbar, None);
<a id='L27336' name='L27336'></a> 27336 <em class='sharp'>#endif</em> <em class='comment'>/* USE_GTK */</em>
<a id='L27337' name='L27337'></a> 27337       <a href='../D/2405.html' title='Multiple defined in 2 places.'>FRAME_SKIP_TASKBAR</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = !<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (new_value);
<a id='L27338' name='L27338'></a> 27338     <em class='brace'>}</em>
<a id='L27339' name='L27339'></a> 27339 <em class='brace'>}</em>
<a id='L27340' name='L27340'></a> 27340 
<a id='L27341' name='L27341'></a> 27341 <em class='comment'>/**</em>
<a id='L27342' name='L27342'></a> 27342 <em class='comment'> * x_set_z_group:</em>
<a id='L27343' name='L27343'></a> 27343 <em class='comment'> *</em>
<a id='L27344' name='L27344'></a> 27344 <em class='comment'> * Set frame F's `z-group' parameter.  If `above', F's window-system</em>
<a id='L27345' name='L27345'></a> 27345 <em class='comment'> * window is displayed above all windows that do not have the `above'</em>
<a id='L27346' name='L27346'></a> 27346 <em class='comment'> * property set.  If nil, F's window is shown below all windows that</em>
<a id='L27347' name='L27347'></a> 27347 <em class='comment'> * have the `above' property set and above all windows that have the</em>
<a id='L27348' name='L27348'></a> 27348 <em class='comment'> * `below' property set.  If `below', F's window is displayed below all</em>
<a id='L27349' name='L27349'></a> 27349 <em class='comment'> * windows that do not have the `below' property set.</em>
<a id='L27350' name='L27350'></a> 27350 <em class='comment'> *</em>
<a id='L27351' name='L27351'></a> 27351 <em class='comment'> * Some window managers may not honor this parameter.</em>
<a id='L27352' name='L27352'></a> 27352 <em class='comment'> *</em>
<a id='L27353' name='L27353'></a> 27353 <em class='comment'> * Internally, this function also handles a value 'above-suspended'.</em>
<a id='L27354' name='L27354'></a> 27354 <em class='comment'> * That value is used to temporarily remove F from the 'above' group</em>
<a id='L27355' name='L27355'></a> 27355 <em class='comment'> * to make sure that it does not obscure a menu currently popped up.</em>
<a id='L27356' name='L27356'></a> 27356 <em class='comment'> */</em>
<a id='L27357' name='L27357'></a> 27357 <strong class='reserved'>void</strong>
<a id='L27358' name='L27358'></a> 27358 x_set_z_group (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> new_value, <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> old_value)
<a id='L27359' name='L27359'></a> 27359 <em class='brace'>{</em>
<a id='L27360' name='L27360'></a> 27360   <em class='comment'>/* We don't care about old_value.  The window manager might have</em>
<a id='L27361' name='L27361'></a> 27361 <em class='comment'>     reset the value without telling us.  */</em>
<a id='L27362' name='L27362'></a> 27362   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>;
<a id='L27363' name='L27363'></a> 27363   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L27364' name='L27364'></a> 27364 
<a id='L27365' name='L27365'></a> 27365   <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L27366' name='L27366'></a> 27366 
<a id='L27367' name='L27367'></a> 27367   <strong class='reserved'>if</strong> (<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (new_value))
<a id='L27368' name='L27368'></a> 27368     <em class='brace'>{</em>
<a id='L27369' name='L27369'></a> 27369       set_wm_state (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>,
<a id='L27370' name='L27370'></a> 27370                     dpyinfo-&gt;Xatom_net_wm_state_above, None);
<a id='L27371' name='L27371'></a> 27371       set_wm_state (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>,
<a id='L27372' name='L27372'></a> 27372                     dpyinfo-&gt;Xatom_net_wm_state_below, None);
<a id='L27373' name='L27373'></a> 27373       <a href='../D/2481.html' title='Multiple defined in 2 places.'>FRAME_Z_GROUP</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = <a href='../S/2183.html#L50' title='Defined at 50 in src/frame.h.'>z_group_none</a>;
<a id='L27374' name='L27374'></a> 27374     <em class='brace'>}</em>
<a id='L27375' name='L27375'></a> 27375   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (new_value, Qabove))
<a id='L27376' name='L27376'></a> 27376     <em class='brace'>{</em>
<a id='L27377' name='L27377'></a> 27377       set_wm_state (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>,
<a id='L27378' name='L27378'></a> 27378                     dpyinfo-&gt;Xatom_net_wm_state_above, None);
<a id='L27379' name='L27379'></a> 27379       set_wm_state (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>,
<a id='L27380' name='L27380'></a> 27380                     dpyinfo-&gt;Xatom_net_wm_state_below, None);
<a id='L27381' name='L27381'></a> 27381       <a href='../D/2481.html' title='Multiple defined in 2 places.'>FRAME_Z_GROUP</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = <a href='../S/2183.html#L51' title='Defined at 51 in src/frame.h.'>z_group_above</a>;
<a id='L27382' name='L27382'></a> 27382     <em class='brace'>}</em>
<a id='L27383' name='L27383'></a> 27383   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (new_value, Qbelow))
<a id='L27384' name='L27384'></a> 27384     <em class='brace'>{</em>
<a id='L27385' name='L27385'></a> 27385       set_wm_state (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>,
<a id='L27386' name='L27386'></a> 27386                     dpyinfo-&gt;Xatom_net_wm_state_above, None);
<a id='L27387' name='L27387'></a> 27387       set_wm_state (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>,
<a id='L27388' name='L27388'></a> 27388                     dpyinfo-&gt;Xatom_net_wm_state_below, None);
<a id='L27389' name='L27389'></a> 27389       <a href='../D/2481.html' title='Multiple defined in 2 places.'>FRAME_Z_GROUP</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = <a href='../S/2183.html#L52' title='Defined at 52 in src/frame.h.'>z_group_below</a>;
<a id='L27390' name='L27390'></a> 27390     <em class='brace'>}</em>
<a id='L27391' name='L27391'></a> 27391   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (new_value, Qabove_suspended))
<a id='L27392' name='L27392'></a> 27392     <em class='brace'>{</em>
<a id='L27393' name='L27393'></a> 27393       set_wm_state (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>,
<a id='L27394' name='L27394'></a> 27394                     dpyinfo-&gt;Xatom_net_wm_state_above, None);
<a id='L27395' name='L27395'></a> 27395       <a href='../D/2481.html' title='Multiple defined in 2 places.'>FRAME_Z_GROUP</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) = <a href='../S/2183.html#L53' title='Defined at 53 in src/frame.h.'>z_group_above_suspended</a>;
<a id='L27396' name='L27396'></a> 27396     <em class='brace'>}</em>
<a id='L27397' name='L27397'></a> 27397   <strong class='reserved'>else</strong>
<a id='L27398' name='L27398'></a> 27398     <a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a> ("Invalid z-group specification");
<a id='L27399' name='L27399'></a> 27399 <em class='brace'>}</em>
<a id='L27400' name='L27400'></a> 27400 
<a id='L27401' name='L27401'></a> 27401 
<a id='L27402' name='L27402'></a> 27402 <em class='comment'>/* Return the current _NET_WM_STATE.</em>
<a id='L27403' name='L27403'></a> 27403 <em class='comment'>   SIZE_STATE is set to one of the FULLSCREEN_* values.</em>
<a id='L27404' name='L27404'></a> 27404 <em class='comment'>   Set *STICKY to the sticky state.</em>
<a id='L27405' name='L27405'></a> 27405 <em class='comment'></em>
<a id='L27406' name='L27406'></a> 27406 <em class='comment'>   Return true iff we are not hidden.  */</em>
<a id='L27407' name='L27407'></a> 27407 
<a id='L27408' name='L27408'></a> 27408 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L27409' name='L27409'></a> 27409 x_get_current_wm_state (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>,
<a id='L27410' name='L27410'></a> 27410                         <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>,
<a id='L27411' name='L27411'></a> 27411                         <strong class='reserved'>int</strong> *size_state,
<a id='L27412' name='L27412'></a> 27412                         <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> *sticky,
<a id='L27413' name='L27413'></a> 27413                         <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> *shaded)
<a id='L27414' name='L27414'></a> 27414 <em class='brace'>{</em>
<a id='L27415' name='L27415'></a> 27415   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> actual_size;
<a id='L27416' name='L27416'></a> 27416   <strong class='reserved'>int</strong> i;
<a id='L27417' name='L27417'></a> 27417   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> is_hidden = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L27418' name='L27418'></a> 27418   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L27419' name='L27419'></a> 27419   <strong class='reserved'>long</strong> max_len = 65536;
<a id='L27420' name='L27420'></a> 27420   Atom target_type = XA_ATOM;
<a id='L27421' name='L27421'></a> 27421   <em class='comment'>/* If XCB is available, we can avoid three XSync calls.  */</em>
<a id='L27422' name='L27422'></a> 27422 <em class='sharp'>#ifdef</em> USE_XCB
<a id='L27423' name='L27423'></a> 27423   xcb_get_property_cookie_t prop_cookie;
<a id='L27424' name='L27424'></a> 27424   xcb_get_property_reply_t *prop;
<a id='L27425' name='L27425'></a> 27425   <strong class='reserved'>typedef</strong> xcb_atom_t <a href='../R/15089.html' title='Multiple referred from 2 places.'>reply_data_object</a>;
<a id='L27426' name='L27426'></a> 27426 <em class='sharp'>#else</em>
<a id='L27427' name='L27427'></a> 27427   <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy = <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L27428' name='L27428'></a> 27428   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> bytes_remaining;
<a id='L27429' name='L27429'></a> 27429   <strong class='reserved'>int</strong> rc, actual_format;
<a id='L27430' name='L27430'></a> 27430   Atom actual_type;
<a id='L27431' name='L27431'></a> 27431   <strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *tmp_data = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L27432' name='L27432'></a> 27432   <strong class='reserved'>typedef</strong> Atom <a href='../R/15089.html' title='Multiple referred from 2 places.'>reply_data_object</a>;
<a id='L27433' name='L27433'></a> 27433 <em class='sharp'>#endif</em>
<a id='L27434' name='L27434'></a> 27434   <a href='../D/16325.html' title='Multiple defined in 2 places.'>reply_data_object</a> *reply_data;
<a id='L27435' name='L27435'></a> 27435 <em class='sharp'># if</em> <strong class='reserved'>defined</strong> <a href='../S/2936.html#L45' title='Defined at 45 in lib/canonicalize-lgpl.c.'>GCC_LINT</a> || <strong class='reserved'>defined</strong> lint
<a id='L27436' name='L27436'></a> 27436   <a href='../D/16325.html' title='Multiple defined in 2 places.'>reply_data_object</a> reply_data_dummy;
<a id='L27437' name='L27437'></a> 27437   reply_data = &amp;reply_data_dummy;
<a id='L27438' name='L27438'></a> 27438 <em class='sharp'># endif</em>
<a id='L27439' name='L27439'></a> 27439 
<a id='L27440' name='L27440'></a> 27440   *sticky = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L27441' name='L27441'></a> 27441   *size_state = <a href='../S/2183.html#L38' title='Defined at 38 in src/frame.h.'>FULLSCREEN_NONE</a>;
<a id='L27442' name='L27442'></a> 27442   *shaded = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L27443' name='L27443'></a> 27443 
<a id='L27444' name='L27444'></a> 27444   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L27445' name='L27445'></a> 27445 
<a id='L27446' name='L27446'></a> 27446 <em class='sharp'>#ifdef</em> USE_XCB
<a id='L27447' name='L27447'></a> 27447   prop_cookie = xcb_get_property (dpyinfo-&gt;xcb_connection, 0, <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>,
<a id='L27448' name='L27448'></a> 27448                                   dpyinfo-&gt;Xatom_net_wm_state,
<a id='L27449' name='L27449'></a> 27449                                   target_type, 0, max_len);
<a id='L27450' name='L27450'></a> 27450   prop = xcb_get_property_reply (dpyinfo-&gt;xcb_connection, prop_cookie, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L27451' name='L27451'></a> 27451   <strong class='reserved'>if</strong> (prop &amp;&amp; prop-&gt;type == target_type)
<a id='L27452' name='L27452'></a> 27452     <em class='brace'>{</em>
<a id='L27453' name='L27453'></a> 27453       <strong class='reserved'>int</strong> actual_bytes = xcb_get_property_value_length (prop);
<a id='L27454' name='L27454'></a> 27454       <a href='../D/10872.html' title='Multiple defined in 5 places.'>eassume</a> (0 &lt;= actual_bytes);
<a id='L27455' name='L27455'></a> 27455       actual_size = actual_bytes / <strong class='reserved'>sizeof</strong> *reply_data;
<a id='L27456' name='L27456'></a> 27456       reply_data = xcb_get_property_value (prop);
<a id='L27457' name='L27457'></a> 27457     <em class='brace'>}</em>
<a id='L27458' name='L27458'></a> 27458   <strong class='reserved'>else</strong>
<a id='L27459' name='L27459'></a> 27459     <em class='brace'>{</em>
<a id='L27460' name='L27460'></a> 27460       actual_size = 0;
<a id='L27461' name='L27461'></a> 27461       is_hidden = <a href='../S/2183.html#L1172' title='Defined at 1172 in src/frame.h.'>FRAME_ICONIFIED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L27462' name='L27462'></a> 27462     <em class='brace'>}</em>
<a id='L27463' name='L27463'></a> 27463 <em class='sharp'>#else</em>
<a id='L27464' name='L27464'></a> 27464   x_catch_errors (dpy);
<a id='L27465' name='L27465'></a> 27465   rc = XGetWindowProperty (dpy, <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, dpyinfo-&gt;Xatom_net_wm_state,
<a id='L27466' name='L27466'></a> 27466                            0, max_len, False, target_type,
<a id='L27467' name='L27467'></a> 27467                            &amp;actual_type, &amp;actual_format, &amp;actual_size,
<a id='L27468' name='L27468'></a> 27468                            &amp;bytes_remaining, &amp;tmp_data);
<a id='L27469' name='L27469'></a> 27469 
<a id='L27470' name='L27470'></a> 27470   <strong class='reserved'>if</strong> (rc == Success &amp;&amp; actual_type == target_type &amp;&amp; ! x_had_errors_p (dpy))
<a id='L27471' name='L27471'></a> 27471     reply_data = (Atom *) tmp_data;
<a id='L27472' name='L27472'></a> 27472   <strong class='reserved'>else</strong>
<a id='L27473' name='L27473'></a> 27473     <em class='brace'>{</em>
<a id='L27474' name='L27474'></a> 27474       actual_size = 0;
<a id='L27475' name='L27475'></a> 27475       is_hidden = <a href='../S/2183.html#L1172' title='Defined at 1172 in src/frame.h.'>FRAME_ICONIFIED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L27476' name='L27476'></a> 27476     <em class='brace'>}</em>
<a id='L27477' name='L27477'></a> 27477 
<a id='L27478' name='L27478'></a> 27478   x_uncatch_errors ();
<a id='L27479' name='L27479'></a> 27479 <em class='sharp'>#endif</em>
<a id='L27480' name='L27480'></a> 27480 
<a id='L27481' name='L27481'></a> 27481   <strong class='reserved'>for</strong> (i = 0; i &lt; actual_size; ++i)
<a id='L27482' name='L27482'></a> 27482     <em class='brace'>{</em>
<a id='L27483' name='L27483'></a> 27483       Atom <a href='../D/8258.html' title='Multiple defined in 6 places.'>a</a> = reply_data[i];
<a id='L27484' name='L27484'></a> 27484       <strong class='reserved'>if</strong> (<a href='../D/8258.html' title='Multiple defined in 6 places.'>a</a> == dpyinfo-&gt;Xatom_net_wm_state_hidden)
<a id='L27485' name='L27485'></a> 27485         is_hidden = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L27486' name='L27486'></a> 27486       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (<a href='../D/8258.html' title='Multiple defined in 6 places.'>a</a> == dpyinfo-&gt;Xatom_net_wm_state_maximized_horz)
<a id='L27487' name='L27487'></a> 27487         <em class='brace'>{</em>
<a id='L27488' name='L27488'></a> 27488           <strong class='reserved'>if</strong> (*size_state == <a href='../S/2183.html#L40' title='Defined at 40 in src/frame.h.'>FULLSCREEN_HEIGHT</a>)
<a id='L27489' name='L27489'></a> 27489             *size_state = <a href='../S/2183.html#L42' title='Defined at 42 in src/frame.h.'>FULLSCREEN_MAXIMIZED</a>;
<a id='L27490' name='L27490'></a> 27490           <strong class='reserved'>else</strong>
<a id='L27491' name='L27491'></a> 27491             *size_state = <a href='../S/2183.html#L39' title='Defined at 39 in src/frame.h.'>FULLSCREEN_WIDTH</a>;
<a id='L27492' name='L27492'></a> 27492         <em class='brace'>}</em>
<a id='L27493' name='L27493'></a> 27493       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (<a href='../D/8258.html' title='Multiple defined in 6 places.'>a</a> == dpyinfo-&gt;Xatom_net_wm_state_maximized_vert)
<a id='L27494' name='L27494'></a> 27494         <em class='brace'>{</em>
<a id='L27495' name='L27495'></a> 27495           <strong class='reserved'>if</strong> (*size_state == <a href='../S/2183.html#L39' title='Defined at 39 in src/frame.h.'>FULLSCREEN_WIDTH</a>)
<a id='L27496' name='L27496'></a> 27496             *size_state = <a href='../S/2183.html#L42' title='Defined at 42 in src/frame.h.'>FULLSCREEN_MAXIMIZED</a>;
<a id='L27497' name='L27497'></a> 27497           <strong class='reserved'>else</strong>
<a id='L27498' name='L27498'></a> 27498             *size_state = <a href='../S/2183.html#L40' title='Defined at 40 in src/frame.h.'>FULLSCREEN_HEIGHT</a>;
<a id='L27499' name='L27499'></a> 27499         <em class='brace'>}</em>
<a id='L27500' name='L27500'></a> 27500       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (<a href='../D/8258.html' title='Multiple defined in 6 places.'>a</a> == dpyinfo-&gt;Xatom_net_wm_state_fullscreen)
<a id='L27501' name='L27501'></a> 27501         *size_state = <a href='../S/2183.html#L41' title='Defined at 41 in src/frame.h.'>FULLSCREEN_BOTH</a>;
<a id='L27502' name='L27502'></a> 27502       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (<a href='../D/8258.html' title='Multiple defined in 6 places.'>a</a> == dpyinfo-&gt;Xatom_net_wm_state_sticky)
<a id='L27503' name='L27503'></a> 27503         *sticky = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L27504' name='L27504'></a> 27504       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (<a href='../D/8258.html' title='Multiple defined in 6 places.'>a</a> == dpyinfo-&gt;Xatom_net_wm_state_shaded)
<a id='L27505' name='L27505'></a> 27505         *shaded = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L27506' name='L27506'></a> 27506     <em class='brace'>}</em>
<a id='L27507' name='L27507'></a> 27507 
<a id='L27508' name='L27508'></a> 27508 <em class='sharp'>#ifdef</em> USE_XCB
<a id='L27509' name='L27509'></a> 27509   <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (prop);
<a id='L27510' name='L27510'></a> 27510 <em class='sharp'>#else</em>
<a id='L27511' name='L27511'></a> 27511   <strong class='reserved'>if</strong> (tmp_data) XFree (tmp_data);
<a id='L27512' name='L27512'></a> 27512 <em class='sharp'>#endif</em>
<a id='L27513' name='L27513'></a> 27513 
<a id='L27514' name='L27514'></a> 27514   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L27515' name='L27515'></a> 27515   <strong class='reserved'>return</strong> ! is_hidden;
<a id='L27516' name='L27516'></a> 27516 <em class='brace'>}</em>
<a id='L27517' name='L27517'></a> 27517 
<a id='L27518' name='L27518'></a> 27518 <em class='comment'>/* Do fullscreen as specified in extended window manager hints */</em>
<a id='L27519' name='L27519'></a> 27519 
<a id='L27520' name='L27520'></a> 27520 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L27521' name='L27521'></a> 27521 do_ewmh_fullscreen (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L27522' name='L27522'></a> 27522 <em class='brace'>{</em>
<a id='L27523' name='L27523'></a> 27523   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L27524' name='L27524'></a> 27524   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> have_net_atom = x_wm_supports (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, dpyinfo-&gt;Xatom_net_wm_state);
<a id='L27525' name='L27525'></a> 27525   <strong class='reserved'>int</strong> cur;
<a id='L27526' name='L27526'></a> 27526   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> <a href='../D/10645.html' title='Multiple defined in 5 places.'>dummy</a>;
<a id='L27527' name='L27527'></a> 27527 
<a id='L27528' name='L27528'></a> 27528   x_get_current_wm_state (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), &amp;cur, &amp;<a href='../D/10645.html' title='Multiple defined in 5 places.'>dummy</a>, &amp;<a href='../D/10645.html' title='Multiple defined in 5 places.'>dummy</a>);
<a id='L27529' name='L27529'></a> 27529 
<a id='L27530' name='L27530'></a> 27530   <em class='comment'>/* Some window managers don't say they support _NET_WM_STATE, but they do say</em>
<a id='L27531' name='L27531'></a> 27531 <em class='comment'>     they support _NET_WM_STATE_FULLSCREEN.  Try that also.  */</em>
<a id='L27532' name='L27532'></a> 27532   <strong class='reserved'>if</strong> (!have_net_atom)
<a id='L27533' name='L27533'></a> 27533     have_net_atom = x_wm_supports (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, dpyinfo-&gt;Xatom_net_wm_state_fullscreen);
<a id='L27534' name='L27534'></a> 27534 
<a id='L27535' name='L27535'></a> 27535   <strong class='reserved'>if</strong> (have_net_atom &amp;&amp; cur != <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;want_fullscreen)
<a id='L27536' name='L27536'></a> 27536     <em class='brace'>{</em>
<a id='L27537' name='L27537'></a> 27537       <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>;
<a id='L27538' name='L27538'></a> 27538 
<a id='L27539' name='L27539'></a> 27539       <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L27540' name='L27540'></a> 27540 
<a id='L27541' name='L27541'></a> 27541       <em class='comment'>/* Keep number of calls to set_wm_state as low as possible.</em>
<a id='L27542' name='L27542'></a> 27542 <em class='comment'>         Some window managers, or possible Gtk+, hangs when too many</em>
<a id='L27543' name='L27543'></a> 27543 <em class='comment'>         are sent at once.  */</em>
<a id='L27544' name='L27544'></a> 27544       <strong class='reserved'>switch</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;want_fullscreen)
<a id='L27545' name='L27545'></a> 27545         <em class='brace'>{</em>
<a id='L27546' name='L27546'></a> 27546         <strong class='reserved'>case</strong> <a href='../S/2183.html#L41' title='Defined at 41 in src/frame.h.'>FULLSCREEN_BOTH</a>:
<a id='L27547' name='L27547'></a> 27547           <strong class='reserved'>if</strong> (cur != <a href='../S/2183.html#L41' title='Defined at 41 in src/frame.h.'>FULLSCREEN_BOTH</a>)
<a id='L27548' name='L27548'></a> 27548             set_wm_state (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>, dpyinfo-&gt;Xatom_net_wm_state_fullscreen,
<a id='L27549' name='L27549'></a> 27549                           None);
<a id='L27550' name='L27550'></a> 27550           <strong class='reserved'>break</strong>;
<a id='L27551' name='L27551'></a> 27551         <strong class='reserved'>case</strong> <a href='../S/2183.html#L39' title='Defined at 39 in src/frame.h.'>FULLSCREEN_WIDTH</a>:
<a id='L27552' name='L27552'></a> 27552           <strong class='reserved'>if</strong> (x_frame_normalize_before_maximize &amp;&amp; cur == <a href='../S/2183.html#L42' title='Defined at 42 in src/frame.h.'>FULLSCREEN_MAXIMIZED</a>)
<a id='L27553' name='L27553'></a> 27553             <em class='brace'>{</em>
<a id='L27554' name='L27554'></a> 27554               set_wm_state (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>,
<a id='L27555' name='L27555'></a> 27555                             dpyinfo-&gt;Xatom_net_wm_state_maximized_horz,
<a id='L27556' name='L27556'></a> 27556                             dpyinfo-&gt;Xatom_net_wm_state_maximized_vert);
<a id='L27557' name='L27557'></a> 27557               set_wm_state (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>,
<a id='L27558' name='L27558'></a> 27558                             dpyinfo-&gt;Xatom_net_wm_state_maximized_horz, None);
<a id='L27559' name='L27559'></a> 27559             <em class='brace'>}</em>
<a id='L27560' name='L27560'></a> 27560           <strong class='reserved'>else</strong>
<a id='L27561' name='L27561'></a> 27561             <em class='brace'>{</em>
<a id='L27562' name='L27562'></a> 27562               <strong class='reserved'>if</strong> (cur == <a href='../S/2183.html#L41' title='Defined at 41 in src/frame.h.'>FULLSCREEN_BOTH</a> || cur == <a href='../S/2183.html#L40' title='Defined at 40 in src/frame.h.'>FULLSCREEN_HEIGHT</a>
<a id='L27563' name='L27563'></a> 27563                   || cur == <a href='../S/2183.html#L42' title='Defined at 42 in src/frame.h.'>FULLSCREEN_MAXIMIZED</a>)
<a id='L27564' name='L27564'></a> 27564                 set_wm_state (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>, dpyinfo-&gt;Xatom_net_wm_state_fullscreen,
<a id='L27565' name='L27565'></a> 27565                               dpyinfo-&gt;Xatom_net_wm_state_maximized_vert);
<a id='L27566' name='L27566'></a> 27566               <strong class='reserved'>if</strong> (cur != <a href='../S/2183.html#L42' title='Defined at 42 in src/frame.h.'>FULLSCREEN_MAXIMIZED</a> || x_frame_normalize_before_maximize)
<a id='L27567' name='L27567'></a> 27567                 set_wm_state (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>,
<a id='L27568' name='L27568'></a> 27568                               dpyinfo-&gt;Xatom_net_wm_state_maximized_horz, None);
<a id='L27569' name='L27569'></a> 27569             <em class='brace'>}</em>
<a id='L27570' name='L27570'></a> 27570           <strong class='reserved'>break</strong>;
<a id='L27571' name='L27571'></a> 27571         <strong class='reserved'>case</strong> <a href='../S/2183.html#L40' title='Defined at 40 in src/frame.h.'>FULLSCREEN_HEIGHT</a>:
<a id='L27572' name='L27572'></a> 27572           <strong class='reserved'>if</strong> (x_frame_normalize_before_maximize &amp;&amp; cur == <a href='../S/2183.html#L42' title='Defined at 42 in src/frame.h.'>FULLSCREEN_MAXIMIZED</a>)
<a id='L27573' name='L27573'></a> 27573             <em class='brace'>{</em>
<a id='L27574' name='L27574'></a> 27574               set_wm_state (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>,
<a id='L27575' name='L27575'></a> 27575                             dpyinfo-&gt;Xatom_net_wm_state_maximized_horz,
<a id='L27576' name='L27576'></a> 27576                             dpyinfo-&gt;Xatom_net_wm_state_maximized_vert);
<a id='L27577' name='L27577'></a> 27577               set_wm_state (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>,
<a id='L27578' name='L27578'></a> 27578                             dpyinfo-&gt;Xatom_net_wm_state_maximized_vert, None);
<a id='L27579' name='L27579'></a> 27579             <em class='brace'>}</em>
<a id='L27580' name='L27580'></a> 27580           <strong class='reserved'>else</strong>
<a id='L27581' name='L27581'></a> 27581             <em class='brace'>{</em>
<a id='L27582' name='L27582'></a> 27582               <strong class='reserved'>if</strong> (cur == <a href='../S/2183.html#L41' title='Defined at 41 in src/frame.h.'>FULLSCREEN_BOTH</a> || cur == <a href='../S/2183.html#L39' title='Defined at 39 in src/frame.h.'>FULLSCREEN_WIDTH</a>
<a id='L27583' name='L27583'></a> 27583                   || cur == <a href='../S/2183.html#L42' title='Defined at 42 in src/frame.h.'>FULLSCREEN_MAXIMIZED</a>)
<a id='L27584' name='L27584'></a> 27584                 set_wm_state (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>, dpyinfo-&gt;Xatom_net_wm_state_fullscreen,
<a id='L27585' name='L27585'></a> 27585                               dpyinfo-&gt;Xatom_net_wm_state_maximized_horz);
<a id='L27586' name='L27586'></a> 27586               <strong class='reserved'>if</strong> (cur != <a href='../S/2183.html#L42' title='Defined at 42 in src/frame.h.'>FULLSCREEN_MAXIMIZED</a> || x_frame_normalize_before_maximize)
<a id='L27587' name='L27587'></a> 27587                 set_wm_state (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>,
<a id='L27588' name='L27588'></a> 27588                               dpyinfo-&gt;Xatom_net_wm_state_maximized_vert, None);
<a id='L27589' name='L27589'></a> 27589             <em class='brace'>}</em>
<a id='L27590' name='L27590'></a> 27590           <strong class='reserved'>break</strong>;
<a id='L27591' name='L27591'></a> 27591         <strong class='reserved'>case</strong> <a href='../S/2183.html#L42' title='Defined at 42 in src/frame.h.'>FULLSCREEN_MAXIMIZED</a>:
<a id='L27592' name='L27592'></a> 27592           <strong class='reserved'>if</strong> (x_frame_normalize_before_maximize &amp;&amp; cur == <a href='../S/2183.html#L41' title='Defined at 41 in src/frame.h.'>FULLSCREEN_BOTH</a>)
<a id='L27593' name='L27593'></a> 27593             <em class='brace'>{</em>
<a id='L27594' name='L27594'></a> 27594               set_wm_state (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>,
<a id='L27595' name='L27595'></a> 27595                             dpyinfo-&gt;Xatom_net_wm_state_fullscreen, None);
<a id='L27596' name='L27596'></a> 27596               set_wm_state (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>,
<a id='L27597' name='L27597'></a> 27597                             dpyinfo-&gt;Xatom_net_wm_state_maximized_horz,
<a id='L27598' name='L27598'></a> 27598                             dpyinfo-&gt;Xatom_net_wm_state_maximized_vert);
<a id='L27599' name='L27599'></a> 27599             <em class='brace'>}</em>
<a id='L27600' name='L27600'></a> 27600           <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (x_frame_normalize_before_maximize &amp;&amp; cur == <a href='../S/2183.html#L39' title='Defined at 39 in src/frame.h.'>FULLSCREEN_WIDTH</a>)
<a id='L27601' name='L27601'></a> 27601             <em class='brace'>{</em>
<a id='L27602' name='L27602'></a> 27602               set_wm_state (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>,
<a id='L27603' name='L27603'></a> 27603                             dpyinfo-&gt;Xatom_net_wm_state_maximized_horz, None);
<a id='L27604' name='L27604'></a> 27604               set_wm_state (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>,
<a id='L27605' name='L27605'></a> 27605                             dpyinfo-&gt;Xatom_net_wm_state_maximized_horz,
<a id='L27606' name='L27606'></a> 27606                             dpyinfo-&gt;Xatom_net_wm_state_maximized_vert);
<a id='L27607' name='L27607'></a> 27607             <em class='brace'>}</em>
<a id='L27608' name='L27608'></a> 27608           <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (x_frame_normalize_before_maximize &amp;&amp; cur == <a href='../S/2183.html#L40' title='Defined at 40 in src/frame.h.'>FULLSCREEN_HEIGHT</a>)
<a id='L27609' name='L27609'></a> 27609             <em class='brace'>{</em>
<a id='L27610' name='L27610'></a> 27610               set_wm_state (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>,
<a id='L27611' name='L27611'></a> 27611                             dpyinfo-&gt;Xatom_net_wm_state_maximized_vert, None);
<a id='L27612' name='L27612'></a> 27612               set_wm_state (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>,
<a id='L27613' name='L27613'></a> 27613                             dpyinfo-&gt;Xatom_net_wm_state_maximized_horz,
<a id='L27614' name='L27614'></a> 27614                             dpyinfo-&gt;Xatom_net_wm_state_maximized_vert);
<a id='L27615' name='L27615'></a> 27615             <em class='brace'>}</em>
<a id='L27616' name='L27616'></a> 27616           <strong class='reserved'>else</strong>
<a id='L27617' name='L27617'></a> 27617             <em class='brace'>{</em>
<a id='L27618' name='L27618'></a> 27618               <strong class='reserved'>if</strong> (cur == <a href='../S/2183.html#L41' title='Defined at 41 in src/frame.h.'>FULLSCREEN_BOTH</a>)
<a id='L27619' name='L27619'></a> 27619                 set_wm_state (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>, dpyinfo-&gt;Xatom_net_wm_state_fullscreen,
<a id='L27620' name='L27620'></a> 27620                               None);
<a id='L27621' name='L27621'></a> 27621               <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (cur == <a href='../S/2183.html#L40' title='Defined at 40 in src/frame.h.'>FULLSCREEN_HEIGHT</a>)
<a id='L27622' name='L27622'></a> 27622                 set_wm_state (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>,
<a id='L27623' name='L27623'></a> 27623                               dpyinfo-&gt;Xatom_net_wm_state_maximized_horz, None);
<a id='L27624' name='L27624'></a> 27624               <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (cur == <a href='../S/2183.html#L39' title='Defined at 39 in src/frame.h.'>FULLSCREEN_WIDTH</a>)
<a id='L27625' name='L27625'></a> 27625                 set_wm_state (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>, None,
<a id='L27626' name='L27626'></a> 27626                               dpyinfo-&gt;Xatom_net_wm_state_maximized_vert);
<a id='L27627' name='L27627'></a> 27627               <strong class='reserved'>else</strong>
<a id='L27628' name='L27628'></a> 27628                 set_wm_state (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>,
<a id='L27629' name='L27629'></a> 27629                               dpyinfo-&gt;Xatom_net_wm_state_maximized_horz,
<a id='L27630' name='L27630'></a> 27630                               dpyinfo-&gt;Xatom_net_wm_state_maximized_vert);
<a id='L27631' name='L27631'></a> 27631             <em class='brace'>}</em>
<a id='L27632' name='L27632'></a> 27632           <strong class='reserved'>break</strong>;
<a id='L27633' name='L27633'></a> 27633         <strong class='reserved'>case</strong> <a href='../S/2183.html#L38' title='Defined at 38 in src/frame.h.'>FULLSCREEN_NONE</a>:
<a id='L27634' name='L27634'></a> 27634           <strong class='reserved'>if</strong> (cur == <a href='../S/2183.html#L41' title='Defined at 41 in src/frame.h.'>FULLSCREEN_BOTH</a>)
<a id='L27635' name='L27635'></a> 27635             set_wm_state (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>, dpyinfo-&gt;Xatom_net_wm_state_fullscreen,
<a id='L27636' name='L27636'></a> 27636                           None);
<a id='L27637' name='L27637'></a> 27637           <strong class='reserved'>else</strong>
<a id='L27638' name='L27638'></a> 27638             set_wm_state (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>,
<a id='L27639' name='L27639'></a> 27639                           dpyinfo-&gt;Xatom_net_wm_state_maximized_horz,
<a id='L27640' name='L27640'></a> 27640                           dpyinfo-&gt;Xatom_net_wm_state_maximized_vert);
<a id='L27641' name='L27641'></a> 27641         <em class='brace'>}</em>
<a id='L27642' name='L27642'></a> 27642 
<a id='L27643' name='L27643'></a> 27643       <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;want_fullscreen = <a href='../S/2183.html#L38' title='Defined at 38 in src/frame.h.'>FULLSCREEN_NONE</a>;
<a id='L27644' name='L27644'></a> 27644 
<a id='L27645' name='L27645'></a> 27645     <em class='brace'>}</em>
<a id='L27646' name='L27646'></a> 27646 
<a id='L27647' name='L27647'></a> 27647   <strong class='reserved'>return</strong> have_net_atom;
<a id='L27648' name='L27648'></a> 27648 <em class='brace'>}</em>
<a id='L27649' name='L27649'></a> 27649 
<a id='L27650' name='L27650'></a> 27650 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L27651' name='L27651'></a> 27651 XTfullscreen_hook (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L27652' name='L27652'></a> 27652 <em class='brace'>{</em>
<a id='L27653' name='L27653'></a> 27653   <strong class='reserved'>if</strong> (!<a href='../S/2183.html#L1152' title='Defined at 1152 in src/frame.h.'>FRAME_VISIBLE_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L27654' name='L27654'></a> 27654     <strong class='reserved'>return</strong>;
<a id='L27655' name='L27655'></a> 27655 
<a id='L27656' name='L27656'></a> 27656   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L27657' name='L27657'></a> 27657   x_check_fullscreen (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L27658' name='L27658'></a> 27658   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L27659' name='L27659'></a> 27659 <em class='brace'>}</em>
<a id='L27660' name='L27660'></a> 27660 
<a id='L27661' name='L27661'></a> 27661 
<a id='L27662' name='L27662'></a> 27662 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L27663' name='L27663'></a> 27663 x_handle_net_wm_state (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <strong class='reserved'>const</strong> XPropertyEvent *event)
<a id='L27664' name='L27664'></a> 27664 <em class='brace'>{</em>
<a id='L27665' name='L27665'></a> 27665   <strong class='reserved'>int</strong> <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a> = <a href='../S/2183.html#L38' title='Defined at 38 in src/frame.h.'>FULLSCREEN_NONE</a>;
<a id='L27666' name='L27666'></a> 27666   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> lval;
<a id='L27667' name='L27667'></a> 27667   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> sticky = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>, shaded = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L27668' name='L27668'></a> 27668   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> not_hidden = x_get_current_wm_state (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, event-&gt;<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>,
<a id='L27669' name='L27669'></a> 27669                                             &amp;<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>, &amp;sticky,
<a id='L27670' name='L27670'></a> 27670                                             &amp;shaded);
<a id='L27671' name='L27671'></a> 27671 
<a id='L27672' name='L27672'></a> 27672   lval = Qnil;
<a id='L27673' name='L27673'></a> 27673   <strong class='reserved'>switch</strong> (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>)
<a id='L27674' name='L27674'></a> 27674     <em class='brace'>{</em>
<a id='L27675' name='L27675'></a> 27675     <strong class='reserved'>case</strong> <a href='../S/2183.html#L39' title='Defined at 39 in src/frame.h.'>FULLSCREEN_WIDTH</a>:
<a id='L27676' name='L27676'></a> 27676       lval = Qfullwidth;
<a id='L27677' name='L27677'></a> 27677       <strong class='reserved'>break</strong>;
<a id='L27678' name='L27678'></a> 27678     <strong class='reserved'>case</strong> <a href='../S/2183.html#L40' title='Defined at 40 in src/frame.h.'>FULLSCREEN_HEIGHT</a>:
<a id='L27679' name='L27679'></a> 27679       lval = Qfullheight;
<a id='L27680' name='L27680'></a> 27680       <strong class='reserved'>break</strong>;
<a id='L27681' name='L27681'></a> 27681     <strong class='reserved'>case</strong> <a href='../S/2183.html#L41' title='Defined at 41 in src/frame.h.'>FULLSCREEN_BOTH</a>:
<a id='L27682' name='L27682'></a> 27682       lval = Qfullboth;
<a id='L27683' name='L27683'></a> 27683       <strong class='reserved'>break</strong>;
<a id='L27684' name='L27684'></a> 27684     <strong class='reserved'>case</strong> <a href='../S/2183.html#L42' title='Defined at 42 in src/frame.h.'>FULLSCREEN_MAXIMIZED</a>:
<a id='L27685' name='L27685'></a> 27685       lval = Qmaximized;
<a id='L27686' name='L27686'></a> 27686       <strong class='reserved'>break</strong>;
<a id='L27687' name='L27687'></a> 27687     <em class='brace'>}</em>
<a id='L27688' name='L27688'></a> 27688 
<a id='L27689' name='L27689'></a> 27689   <a href='../S/2247.html#L3214' title='Defined at 3214 in src/frame.c.'>store_frame_param</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, Qfullscreen, lval);
<a id='L27690' name='L27690'></a> 27690   <a href='../S/2247.html#L3214' title='Defined at 3214 in src/frame.c.'>store_frame_param</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, Qsticky, sticky ? Qt : Qnil);
<a id='L27691' name='L27691'></a> 27691   <a href='../S/2247.html#L3214' title='Defined at 3214 in src/frame.c.'>store_frame_param</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, Qshaded, shaded ? Qt : Qnil);
<a id='L27692' name='L27692'></a> 27692 
<a id='L27693' name='L27693'></a> 27693   <strong class='reserved'>return</strong> not_hidden;
<a id='L27694' name='L27694'></a> 27694 <em class='brace'>}</em>
<a id='L27695' name='L27695'></a> 27695 
<a id='L27696' name='L27696'></a> 27696 <em class='comment'>/* Check if we need to resize the frame due to a fullscreen request.</em>
<a id='L27697' name='L27697'></a> 27697 <em class='comment'>   If so needed, resize the frame. */</em>
<a id='L27698' name='L27698'></a> 27698 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L27699' name='L27699'></a> 27699 x_check_fullscreen (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L27700' name='L27700'></a> 27700 <em class='brace'>{</em>
<a id='L27701' name='L27701'></a> 27701   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> lval = Qnil;
<a id='L27702' name='L27702'></a> 27702 
<a id='L27703' name='L27703'></a> 27703   <strong class='reserved'>if</strong> (do_ewmh_fullscreen (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L27704' name='L27704'></a> 27704     <strong class='reserved'>return</strong>;
<a id='L27705' name='L27705'></a> 27705 
<a id='L27706' name='L27706'></a> 27706   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;parent_desc != <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;root_window)
<a id='L27707' name='L27707'></a> 27707     <strong class='reserved'>return</strong>; <em class='comment'>/* Only fullscreen without WM or with EWM hints (above). */</em>
<a id='L27708' name='L27708'></a> 27708 
<a id='L27709' name='L27709'></a> 27709   <em class='comment'>/* Setting fullscreen to nil doesn't do anything.  We could save the</em>
<a id='L27710' name='L27710'></a> 27710 <em class='comment'>     last non-fullscreen size and restore it, but it seems like a</em>
<a id='L27711' name='L27711'></a> 27711 <em class='comment'>     lot of work for this unusual case (no window manager running).  */</em>
<a id='L27712' name='L27712'></a> 27712 
<a id='L27713' name='L27713'></a> 27713   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;want_fullscreen != <a href='../S/2183.html#L38' title='Defined at 38 in src/frame.h.'>FULLSCREEN_NONE</a>)
<a id='L27714' name='L27714'></a> 27714     <em class='brace'>{</em>
<a id='L27715' name='L27715'></a> 27715       <strong class='reserved'>int</strong> width = <a href='../S/2183.html#L1051' title='Defined at 1051 in src/frame.h.'>FRAME_PIXEL_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), height = <a href='../S/2183.html#L1052' title='Defined at 1052 in src/frame.h.'>FRAME_PIXEL_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L27716' name='L27716'></a> 27716       <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L27717' name='L27717'></a> 27717 
<a id='L27718' name='L27718'></a> 27718       <strong class='reserved'>switch</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;want_fullscreen)
<a id='L27719' name='L27719'></a> 27719         <em class='brace'>{</em>
<a id='L27720' name='L27720'></a> 27720           <em class='comment'>/* No difference between these two when there is no WM */</em>
<a id='L27721' name='L27721'></a> 27721         <strong class='reserved'>case</strong> <a href='../S/2183.html#L42' title='Defined at 42 in src/frame.h.'>FULLSCREEN_MAXIMIZED</a>:
<a id='L27722' name='L27722'></a> 27722           lval = Qmaximized;
<a id='L27723' name='L27723'></a> 27723           width = x_display_pixel_width (dpyinfo);
<a id='L27724' name='L27724'></a> 27724           height = x_display_pixel_height (dpyinfo);
<a id='L27725' name='L27725'></a> 27725           <strong class='reserved'>break</strong>;
<a id='L27726' name='L27726'></a> 27726         <strong class='reserved'>case</strong> <a href='../S/2183.html#L41' title='Defined at 41 in src/frame.h.'>FULLSCREEN_BOTH</a>:
<a id='L27727' name='L27727'></a> 27727           lval = Qfullboth;
<a id='L27728' name='L27728'></a> 27728           width = x_display_pixel_width (dpyinfo);
<a id='L27729' name='L27729'></a> 27729           height = x_display_pixel_height (dpyinfo);
<a id='L27730' name='L27730'></a> 27730           <strong class='reserved'>break</strong>;
<a id='L27731' name='L27731'></a> 27731         <strong class='reserved'>case</strong> <a href='../S/2183.html#L39' title='Defined at 39 in src/frame.h.'>FULLSCREEN_WIDTH</a>:
<a id='L27732' name='L27732'></a> 27732           lval = Qfullwidth;
<a id='L27733' name='L27733'></a> 27733           width = x_display_pixel_width (dpyinfo);
<a id='L27734' name='L27734'></a> 27734           height = height + <a href='../D/2342.html' title='Multiple defined in 3 places.'>FRAME_MENUBAR_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L27735' name='L27735'></a> 27735           <strong class='reserved'>break</strong>;
<a id='L27736' name='L27736'></a> 27736         <strong class='reserved'>case</strong> <a href='../S/2183.html#L40' title='Defined at 40 in src/frame.h.'>FULLSCREEN_HEIGHT</a>:
<a id='L27737' name='L27737'></a> 27737           lval = Qfullheight;
<a id='L27738' name='L27738'></a> 27738           height = x_display_pixel_height (dpyinfo);
<a id='L27739' name='L27739'></a> 27739           <strong class='reserved'>break</strong>;
<a id='L27740' name='L27740'></a> 27740         <strong class='reserved'>default</strong>:
<a id='L27741' name='L27741'></a> 27741           <a href='../D/10893.html' title='Multiple defined in 6 places.'>emacs_abort</a> ();
<a id='L27742' name='L27742'></a> 27742         <em class='brace'>}</em>
<a id='L27743' name='L27743'></a> 27743 
<a id='L27744' name='L27744'></a> 27744       x_wm_set_size_hint (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 0, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L27745' name='L27745'></a> 27745 
<a id='L27746' name='L27746'></a> 27746       XResizeWindow (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L27747' name='L27747'></a> 27747                      width, height);
<a id='L27748' name='L27748'></a> 27748 
<a id='L27749' name='L27749'></a> 27749       <strong class='reserved'>if</strong> (<a href='../S/2183.html#L1152' title='Defined at 1152 in src/frame.h.'>FRAME_VISIBLE_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L27750' name='L27750'></a> 27750         x_wait_for_event (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, ConfigureNotify);
<a id='L27751' name='L27751'></a> 27751       <strong class='reserved'>else</strong>
<a id='L27752' name='L27752'></a> 27752         <a href='../S/2140.html#L6054' title='Defined at 6054 in src/dispnew.c.'>change_frame_size</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, width, height, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L27753' name='L27753'></a> 27753     <em class='brace'>}</em>
<a id='L27754' name='L27754'></a> 27754 
<a id='L27755' name='L27755'></a> 27755   <em class='comment'>/* `x_net_wm_state' might have reset the fullscreen frame parameter,</em>
<a id='L27756' name='L27756'></a> 27756 <em class='comment'>     restore it. */</em>
<a id='L27757' name='L27757'></a> 27757   <a href='../S/2247.html#L3214' title='Defined at 3214 in src/frame.c.'>store_frame_param</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, Qfullscreen, lval);
<a id='L27758' name='L27758'></a> 27758 <em class='brace'>}</em>
<a id='L27759' name='L27759'></a> 27759 
<a id='L27760' name='L27760'></a> 27760 <em class='comment'>/* This function is called by x_set_offset to determine whether the window</em>
<a id='L27761' name='L27761'></a> 27761 <em class='comment'>   manager interfered with the positioning of the frame.  Type A window</em>
<a id='L27762' name='L27762'></a> 27762 <em class='comment'>   managers position the surrounding window manager decorations a small</em>
<a id='L27763' name='L27763'></a> 27763 <em class='comment'>   amount above and left of the user-supplied position.  Type B window</em>
<a id='L27764' name='L27764'></a> 27764 <em class='comment'>   managers position the surrounding window manager decorations at the</em>
<a id='L27765' name='L27765'></a> 27765 <em class='comment'>   user-specified position.  If we detect a Type A window manager, we</em>
<a id='L27766' name='L27766'></a> 27766 <em class='comment'>   compensate by moving the window right and down by the proper amount.  */</em>
<a id='L27767' name='L27767'></a> 27767 
<a id='L27768' name='L27768'></a> 27768 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L27769' name='L27769'></a> 27769 x_check_expected_move (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <strong class='reserved'>int</strong> expected_left, <strong class='reserved'>int</strong> expected_top)
<a id='L27770' name='L27770'></a> 27770 <em class='brace'>{</em>
<a id='L27771' name='L27771'></a> 27771   <strong class='reserved'>int</strong> current_left = 0, current_top = 0;
<a id='L27772' name='L27772'></a> 27772 
<a id='L27773' name='L27773'></a> 27773   <em class='comment'>/* x_real_positions returns the left and top offsets of the outermost</em>
<a id='L27774' name='L27774'></a> 27774 <em class='comment'>     window manager window around the frame.  */</em>
<a id='L27775' name='L27775'></a> 27775 
<a id='L27776' name='L27776'></a> 27776   <a href='../S/2296.html#L596' title='Defined at 596 in src/xfns.c.'>x_real_positions</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, &amp;current_left, &amp;current_top);
<a id='L27777' name='L27777'></a> 27777 
<a id='L27778' name='L27778'></a> 27778   <strong class='reserved'>if</strong> (current_left != expected_left || current_top != expected_top)
<a id='L27779' name='L27779'></a> 27779     <em class='brace'>{</em>
<a id='L27780' name='L27780'></a> 27780       <em class='comment'>/* It's a "Type A" window manager. */</em>
<a id='L27781' name='L27781'></a> 27781 
<a id='L27782' name='L27782'></a> 27782       <strong class='reserved'>int</strong> adjusted_left;
<a id='L27783' name='L27783'></a> 27783       <strong class='reserved'>int</strong> adjusted_top;
<a id='L27784' name='L27784'></a> 27784 
<a id='L27785' name='L27785'></a> 27785       <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;wm_type = <a href='../S/2212.html#L686' title='Defined at 686 in src/xterm.h.'>X_WMTYPE_A</a>;
<a id='L27786' name='L27786'></a> 27786       <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;move_offset_left = expected_left - current_left;
<a id='L27787' name='L27787'></a> 27787       <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;move_offset_top = expected_top - current_top;
<a id='L27788' name='L27788'></a> 27788 
<a id='L27789' name='L27789'></a> 27789       <em class='comment'>/* Now fix the mispositioned frame's location. */</em>
<a id='L27790' name='L27790'></a> 27790 
<a id='L27791' name='L27791'></a> 27791       adjusted_left = expected_left + <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;move_offset_left;
<a id='L27792' name='L27792'></a> 27792       adjusted_top = expected_top + <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;move_offset_top;
<a id='L27793' name='L27793'></a> 27793 
<a id='L27794' name='L27794'></a> 27794       XMoveWindow (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L27795' name='L27795'></a> 27795                    adjusted_left, adjusted_top);
<a id='L27796' name='L27796'></a> 27796 
<a id='L27797' name='L27797'></a> 27797       x_sync_with_move (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, expected_left, expected_top, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L27798' name='L27798'></a> 27798     <em class='brace'>}</em>
<a id='L27799' name='L27799'></a> 27799   <strong class='reserved'>else</strong>
<a id='L27800' name='L27800'></a> 27800     <em class='comment'>/* It's a "Type B" window manager.  We don't have to adjust the</em>
<a id='L27801' name='L27801'></a> 27801 <em class='comment'>       frame's position. */</em>
<a id='L27802' name='L27802'></a> 27802       <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;wm_type = <a href='../S/2212.html#L687' title='Defined at 687 in src/xterm.h.'>X_WMTYPE_B</a>;
<a id='L27803' name='L27803'></a> 27803 <em class='brace'>}</em>
<a id='L27804' name='L27804'></a> 27804 
<a id='L27805' name='L27805'></a> 27805 
<a id='L27806' name='L27806'></a> 27806 <em class='comment'>/* Wait for XGetGeometry to return up-to-date position information for a</em>
<a id='L27807' name='L27807'></a> 27807 <em class='comment'>   recently-moved frame.  Call this immediately after calling XMoveWindow.</em>
<a id='L27808' name='L27808'></a> 27808 <em class='comment'>   If FUZZY is non-zero, then LEFT and TOP are just estimates of where the</em>
<a id='L27809' name='L27809'></a> 27809 <em class='comment'>   frame has been moved to, so we use a fuzzy position comparison instead</em>
<a id='L27810' name='L27810'></a> 27810 <em class='comment'>   of an exact comparison.  */</em>
<a id='L27811' name='L27811'></a> 27811 
<a id='L27812' name='L27812'></a> 27812 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L27813' name='L27813'></a> 27813 x_sync_with_move (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <strong class='reserved'>int</strong> left, <strong class='reserved'>int</strong> top, <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> fuzzy)
<a id='L27814' name='L27814'></a> 27814 <em class='brace'>{</em>
<a id='L27815' name='L27815'></a> 27815   <a href='../D/17467.html' title='Multiple defined in 3 places.'>sigset_t</a> emptyset;
<a id='L27816' name='L27816'></a> 27816   <strong class='reserved'>int</strong> count, current_left, current_top;
<a id='L27817' name='L27817'></a> 27817   <strong class='reserved'>struct</strong> <a href='../D/18278.html' title='Multiple defined in 3 places.'>timespec</a> fallback;
<a id='L27818' name='L27818'></a> 27818 
<a id='L27819' name='L27819'></a> 27819   <a href='../D/17449.html' title='Multiple defined in 4 places.'>sigemptyset</a> (&amp;emptyset);
<a id='L27820' name='L27820'></a> 27820   count = 0;
<a id='L27821' name='L27821'></a> 27821 
<a id='L27822' name='L27822'></a> 27822   <strong class='reserved'>while</strong> (count++ &lt; 50)
<a id='L27823' name='L27823'></a> 27823     <em class='brace'>{</em>
<a id='L27824' name='L27824'></a> 27824       current_left = 0;
<a id='L27825' name='L27825'></a> 27825       current_top = 0;
<a id='L27826' name='L27826'></a> 27826 
<a id='L27827' name='L27827'></a> 27827       <em class='comment'>/* There is no need to call XSync (even when no window manager</em>
<a id='L27828' name='L27828'></a> 27828 <em class='comment'>         is present) because x_real_positions already does that</em>
<a id='L27829' name='L27829'></a> 27829 <em class='comment'>         implicitly.  */</em>
<a id='L27830' name='L27830'></a> 27830       <a href='../S/2296.html#L596' title='Defined at 596 in src/xfns.c.'>x_real_positions</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, &amp;current_left, &amp;current_top);
<a id='L27831' name='L27831'></a> 27831 
<a id='L27832' name='L27832'></a> 27832       <strong class='reserved'>if</strong> (fuzzy)
<a id='L27833' name='L27833'></a> 27833         <em class='brace'>{</em>
<a id='L27834' name='L27834'></a> 27834           <em class='comment'>/* The left fuzz-factor is 10 pixels.  The top fuzz-factor is 40</em>
<a id='L27835' name='L27835'></a> 27835 <em class='comment'>             pixels.  */</em>
<a id='L27836' name='L27836'></a> 27836 
<a id='L27837' name='L27837'></a> 27837           <strong class='reserved'>if</strong> (<a href='../D/10870.html' title='Multiple defined in 2 places.'>eabs</a> (current_left - left) &lt;= 10
<a id='L27838' name='L27838'></a> 27838               &amp;&amp; <a href='../D/10870.html' title='Multiple defined in 2 places.'>eabs</a> (current_top - top) &lt;= 40)
<a id='L27839' name='L27839'></a> 27839             <strong class='reserved'>return</strong>;
<a id='L27840' name='L27840'></a> 27840         <em class='brace'>}</em>
<a id='L27841' name='L27841'></a> 27841       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (current_left == left &amp;&amp; current_top == top)
<a id='L27842' name='L27842'></a> 27842         <strong class='reserved'>return</strong>;
<a id='L27843' name='L27843'></a> 27843     <em class='brace'>}</em>
<a id='L27844' name='L27844'></a> 27844 
<a id='L27845' name='L27845'></a> 27845   <em class='comment'>/* As a last resort, just wait 0.5 seconds and hope that XGetGeometry</em>
<a id='L27846' name='L27846'></a> 27846 <em class='comment'>     will then return up-to-date position info. */</em>
<a id='L27847' name='L27847'></a> 27847 
<a id='L27848' name='L27848'></a> 27848   fallback = <a href='../S/2868.html#L30' title='Defined at 30 in lib/dtotimespec.c.'>dtotimespec</a> (0.5);
<a id='L27849' name='L27849'></a> 27849 
<a id='L27850' name='L27850'></a> 27850   <em class='comment'>/* This will hang if input is blocked, so use pselect to wait</em>
<a id='L27851' name='L27851'></a> 27851 <em class='comment'>     instead.  */</em>
<a id='L27852' name='L27852'></a> 27852   <strong class='reserved'>if</strong> (<a href='../S/2089.html#L65' title='Defined at 65 in src/blockinput.h.'>input_blocked_p</a> ())
<a id='L27853' name='L27853'></a> 27853     <a href='../D/15844.html' title='Multiple defined in 7 places.'>pselect</a> (0, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, &amp;fallback, &amp;emptyset);
<a id='L27854' name='L27854'></a> 27854   <strong class='reserved'>else</strong>
<a id='L27855' name='L27855'></a> 27855     <a href='../D/19224.html' title='Multiple defined in 2 places.'>wait_reading_process_output</a> (0, 500000000, 0, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>, Qnil, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, 0);
<a id='L27856' name='L27856'></a> 27856 <em class='brace'>}</em>
<a id='L27857' name='L27857'></a> 27857 
<a id='L27858' name='L27858'></a> 27858 <em class='comment'>/* Wait for an event on frame F matching EVENTTYPE.  */</em>
<a id='L27859' name='L27859'></a> 27859 <strong class='reserved'>void</strong>
<a id='L27860' name='L27860'></a> 27860 x_wait_for_event (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <strong class='reserved'>int</strong> eventtype)
<a id='L27861' name='L27861'></a> 27861 <em class='brace'>{</em>
<a id='L27862' name='L27862'></a> 27862   <strong class='reserved'>if</strong> (!<a href='../D/2123.html' title='Multiple defined in 2 places.'>FLOATP</a> (Vx_wait_for_event_timeout))
<a id='L27863' name='L27863'></a> 27863     <strong class='reserved'>return</strong>;
<a id='L27864' name='L27864'></a> 27864 
<a id='L27865' name='L27865'></a> 27865   <strong class='reserved'>int</strong> <a href='../S/2314.html#L3162' title='Defined at 3162 in src/syntax.c.'>level</a> = interrupt_input_blocked;
<a id='L27866' name='L27866'></a> 27866   <a href='../D/11311.html' title='Multiple defined in 3 places.'>fd_set</a> fds;
<a id='L27867' name='L27867'></a> 27867   <strong class='reserved'>struct</strong> <a href='../D/18278.html' title='Multiple defined in 3 places.'>timespec</a> tmo, tmo_at, time_now;
<a id='L27868' name='L27868'></a> 27868   <strong class='reserved'>int</strong> fd = ConnectionNumber (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L27869' name='L27869'></a> 27869 
<a id='L27870' name='L27870'></a> 27870   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;wait_event_type = eventtype;
<a id='L27871' name='L27871'></a> 27871 
<a id='L27872' name='L27872'></a> 27872   <em class='comment'>/* Default timeout is 0.1 second.  Hopefully not noticeable.  */</em>
<a id='L27873' name='L27873'></a> 27873   <strong class='reserved'>double</strong> timeout = <a href='../D/7090.html' title='Multiple defined in 2 places.'>XFLOAT_DATA</a> (Vx_wait_for_event_timeout);
<a id='L27874' name='L27874'></a> 27874   time_t timeout_seconds = (time_t) timeout;
<a id='L27875' name='L27875'></a> 27875   tmo = <a href='../S/2788.html#L56' title='Defined at 56 in lib/timespec.h.'>make_timespec</a>
<a id='L27876' name='L27876'></a> 27876     (timeout_seconds, (<strong class='reserved'>long</strong> <strong class='reserved'>int</strong>) ((timeout - timeout_seconds)
<a id='L27877' name='L27877'></a> 27877                                   * 1000 * 1000 * 1000));
<a id='L27878' name='L27878'></a> 27878   tmo_at = <a href='../D/18279.html' title='Multiple defined in 2 places.'>timespec_add</a> (<a href='../S/2947.html#L46' title='Defined at 46 in lib/gettime.c.'>current_timespec</a> (), tmo);
<a id='L27879' name='L27879'></a> 27879 
<a id='L27880' name='L27880'></a> 27880   <strong class='reserved'>while</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;wait_event_type)
<a id='L27881' name='L27881'></a> 27881     <em class='brace'>{</em>
<a id='L27882' name='L27882'></a> 27882       pending_signals = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L27883' name='L27883'></a> 27883       <a href='../D/18322.html' title='Multiple defined in 2 places.'>totally_unblock_input</a> ();
<a id='L27884' name='L27884'></a> 27884       <em class='comment'>/* XTread_socket is called after unblock.  */</em>
<a id='L27885' name='L27885'></a> 27885       <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L27886' name='L27886'></a> 27886       interrupt_input_blocked = <a href='../S/2314.html#L3162' title='Defined at 3162 in src/syntax.c.'>level</a>;
<a id='L27887' name='L27887'></a> 27887 
<a id='L27888' name='L27888'></a> 27888       <a href='../D/2046.html' title='Multiple defined in 4 places.'>FD_ZERO</a> (&amp;fds);
<a id='L27889' name='L27889'></a> 27889       <a href='../D/2044.html' title='Multiple defined in 6 places.'>FD_SET</a> (fd, &amp;fds);
<a id='L27890' name='L27890'></a> 27890 
<a id='L27891' name='L27891'></a> 27891       time_now = <a href='../S/2947.html#L46' title='Defined at 46 in lib/gettime.c.'>current_timespec</a> ();
<a id='L27892' name='L27892'></a> 27892       <strong class='reserved'>if</strong> (<a href='../S/2788.html#L64' title='Defined at 64 in lib/timespec.h.'>timespec_cmp</a> (tmo_at, time_now) &lt; 0)
<a id='L27893' name='L27893'></a> 27893         <strong class='reserved'>break</strong>;
<a id='L27894' name='L27894'></a> 27894 
<a id='L27895' name='L27895'></a> 27895       tmo = <a href='../S/2890.html#L31' title='Defined at 31 in lib/timespec-sub.c.'>timespec_sub</a> (tmo_at, time_now);
<a id='L27896' name='L27896'></a> 27896       <strong class='reserved'>if</strong> (<a href='../D/15844.html' title='Multiple defined in 7 places.'>pselect</a> (fd + 1, &amp;fds, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, &amp;tmo, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>) == 0)
<a id='L27897' name='L27897'></a> 27897         <strong class='reserved'>break</strong>; <em class='comment'>/* Timeout */</em>
<a id='L27898' name='L27898'></a> 27898     <em class='brace'>}</em>
<a id='L27899' name='L27899'></a> 27899 
<a id='L27900' name='L27900'></a> 27900   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;wait_event_type = 0;
<a id='L27901' name='L27901'></a> 27901 <em class='brace'>}</em>
<a id='L27902' name='L27902'></a> 27902 
<a id='L27903' name='L27903'></a> 27903 
<a id='L27904' name='L27904'></a> 27904 <em class='comment'>/* Change the size of frame F's X window to WIDTH/HEIGHT in the case F</em>
<a id='L27905' name='L27905'></a> 27905 <em class='comment'>   doesn't have a widget.  If CHANGE_GRAVITY, change to</em>
<a id='L27906' name='L27906'></a> 27906 <em class='comment'>   top-left-corner window gravity for this size change and subsequent</em>
<a id='L27907' name='L27907'></a> 27907 <em class='comment'>   size changes.  Otherwise leave the window gravity unchanged.  */</em>
<a id='L27908' name='L27908'></a> 27908 
<a id='L27909' name='L27909'></a> 27909 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L27910' name='L27910'></a> 27910 x_set_window_size_1 (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> change_gravity,
<a id='L27911' name='L27911'></a> 27911                      <strong class='reserved'>int</strong> width, <strong class='reserved'>int</strong> height)
<a id='L27912' name='L27912'></a> 27912 <em class='brace'>{</em>
<a id='L27913' name='L27913'></a> 27913   <strong class='reserved'>if</strong> (change_gravity)
<a id='L27914' name='L27914'></a> 27914     <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;win_gravity = <a href='../D/4579.html' title='Multiple defined in 5 places.'>NorthWestGravity</a>;
<a id='L27915' name='L27915'></a> 27915   x_wm_set_size_hint (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 0, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L27916' name='L27916'></a> 27916 
<a id='L27917' name='L27917'></a> 27917   XResizeWindow (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L27918' name='L27918'></a> 27918                  width, height + <a href='../D/2342.html' title='Multiple defined in 3 places.'>FRAME_MENUBAR_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L27919' name='L27919'></a> 27919 
<a id='L27920' name='L27920'></a> 27920   <em class='comment'>/* We've set {FRAME,PIXEL}_{WIDTH,HEIGHT} to the values we hope to</em>
<a id='L27921' name='L27921'></a> 27921 <em class='comment'>     receive in the ConfigureNotify event; if we get what we asked</em>
<a id='L27922' name='L27922'></a> 27922 <em class='comment'>     for, then the event won't cause the screen to become garbaged, so</em>
<a id='L27923' name='L27923'></a> 27923 <em class='comment'>     we have to make sure to do it here.  */</em>
<a id='L27924' name='L27924'></a> 27924   <a href='../S/2183.html#L1175' title='Defined at 1175 in src/frame.h.'>SET_FRAME_GARBAGED</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L27925' name='L27925'></a> 27925 
<a id='L27926' name='L27926'></a> 27926   <em class='comment'>/* The following code is too slow over a latent network</em>
<a id='L27927' name='L27927'></a> 27927 <em class='comment'>     connection, so skip it when the user says so.  */</em>
<a id='L27928' name='L27928'></a> 27928 
<a id='L27929' name='L27929'></a> 27929   <strong class='reserved'>if</strong> (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (Vx_lax_frame_positioning))
<a id='L27930' name='L27930'></a> 27930     <strong class='reserved'>return</strong>;
<a id='L27931' name='L27931'></a> 27931 
<a id='L27932' name='L27932'></a> 27932   <em class='comment'>/* Now, strictly speaking, we can't be sure that this is accurate,</em>
<a id='L27933' name='L27933'></a> 27933 <em class='comment'>     but the window manager will get around to dealing with the size</em>
<a id='L27934' name='L27934'></a> 27934 <em class='comment'>     change request eventually, and we'll hear how it went when the</em>
<a id='L27935' name='L27935'></a> 27935 <em class='comment'>     ConfigureNotify event gets here.</em>
<a id='L27936' name='L27936'></a> 27936 <em class='comment'></em>
<a id='L27937' name='L27937'></a> 27937 <em class='comment'>     We could just not bother storing any of this information here,</em>
<a id='L27938' name='L27938'></a> 27938 <em class='comment'>     and let the ConfigureNotify event set everything up, but that</em>
<a id='L27939' name='L27939'></a> 27939 <em class='comment'>     might be kind of confusing to the Lisp code, since size changes</em>
<a id='L27940' name='L27940'></a> 27940 <em class='comment'>     wouldn't be reported in the frame parameters until some random</em>
<a id='L27941' name='L27941'></a> 27941 <em class='comment'>     point in the future when the ConfigureNotify event arrives.</em>
<a id='L27942' name='L27942'></a> 27942 <em class='comment'></em>
<a id='L27943' name='L27943'></a> 27943 <em class='comment'>     Pass true for DELAY since we can't run Lisp code inside of</em>
<a id='L27944' name='L27944'></a> 27944 <em class='comment'>     a BLOCK_INPUT.  */</em>
<a id='L27945' name='L27945'></a> 27945 
<a id='L27946' name='L27946'></a> 27946   <em class='comment'>/* But the ConfigureNotify may in fact never arrive, and then this is</em>
<a id='L27947' name='L27947'></a> 27947 <em class='comment'>     not right if the frame is visible.  Instead wait (with timeout)</em>
<a id='L27948' name='L27948'></a> 27948 <em class='comment'>     for the ConfigureNotify.  */</em>
<a id='L27949' name='L27949'></a> 27949   <strong class='reserved'>if</strong> (<a href='../S/2183.html#L1152' title='Defined at 1152 in src/frame.h.'>FRAME_VISIBLE_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L27950' name='L27950'></a> 27950     <em class='brace'>{</em>
<a id='L27951' name='L27951'></a> 27951       x_wait_for_event (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, ConfigureNotify);
<a id='L27952' name='L27952'></a> 27952 
<a id='L27953' name='L27953'></a> 27953       <strong class='reserved'>if</strong> (<a href='../D/1228.html' title='Multiple defined in 2 places.'>CONSP</a> (frame_size_history))
<a id='L27954' name='L27954'></a> 27954         <a href='../S/2247.html#L570' title='Defined at 570 in src/frame.c.'>frame_size_history_extra</a>
<a id='L27955' name='L27955'></a> 27955           (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9420.html' title='Multiple defined in 2 places.'>build_string</a> ("x_set_window_size_1, visible"),
<a id='L27956' name='L27956'></a> 27956            <a href='../S/2183.html#L1051' title='Defined at 1051 in src/frame.h.'>FRAME_PIXEL_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../S/2183.html#L1052' title='Defined at 1052 in src/frame.h.'>FRAME_PIXEL_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), width, height,
<a id='L27957' name='L27957'></a> 27957            <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;new_width, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;new_height);
<a id='L27958' name='L27958'></a> 27958     <em class='brace'>}</em>
<a id='L27959' name='L27959'></a> 27959   <strong class='reserved'>else</strong>
<a id='L27960' name='L27960'></a> 27960     <em class='brace'>{</em>
<a id='L27961' name='L27961'></a> 27961       <strong class='reserved'>if</strong> (<a href='../D/1228.html' title='Multiple defined in 2 places.'>CONSP</a> (frame_size_history))
<a id='L27962' name='L27962'></a> 27962         <a href='../S/2247.html#L570' title='Defined at 570 in src/frame.c.'>frame_size_history_extra</a>
<a id='L27963' name='L27963'></a> 27963           (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9420.html' title='Multiple defined in 2 places.'>build_string</a> ("x_set_window_size_1, invisible"),
<a id='L27964' name='L27964'></a> 27964            <a href='../S/2183.html#L1051' title='Defined at 1051 in src/frame.h.'>FRAME_PIXEL_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../S/2183.html#L1052' title='Defined at 1052 in src/frame.h.'>FRAME_PIXEL_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), width, height,
<a id='L27965' name='L27965'></a> 27965            <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;new_width, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;new_height);
<a id='L27966' name='L27966'></a> 27966 
<a id='L27967' name='L27967'></a> 27967       <em class='comment'>/* Call adjust_frame_size right away as with GTK.  It might be</em>
<a id='L27968' name='L27968'></a> 27968 <em class='comment'>         tempting to clear out f-&gt;new_width and f-&gt;new_height here.  */</em>
<a id='L27969' name='L27969'></a> 27969       <a href='../S/2247.html#L643' title='Defined at 643 in src/frame.c.'>adjust_frame_size</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/2183.html#L1790' title='Defined at 1790 in src/frame.h.'>FRAME_PIXEL_TO_TEXT_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, width),
<a id='L27970' name='L27970'></a> 27970                          <a href='../S/2183.html#L1796' title='Defined at 1796 in src/frame.h.'>FRAME_PIXEL_TO_TEXT_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, height),
<a id='L27971' name='L27971'></a> 27971                          5, 0, Qx_set_window_size_1);
<a id='L27972' name='L27972'></a> 27972     <em class='brace'>}</em>
<a id='L27973' name='L27973'></a> 27973 <em class='brace'>}</em>
<a id='L27974' name='L27974'></a> 27974 
<a id='L27975' name='L27975'></a> 27975 
<a id='L27976' name='L27976'></a> 27976 <em class='comment'>/* Change the size of frame F's X window to WIDTH and HEIGHT pixels.  If</em>
<a id='L27977' name='L27977'></a> 27977 <em class='comment'>   CHANGE_GRAVITY, change to top-left-corner window gravity for this</em>
<a id='L27978' name='L27978'></a> 27978 <em class='comment'>   size change and subsequent size changes.  Otherwise we leave the</em>
<a id='L27979' name='L27979'></a> 27979 <em class='comment'>   window gravity unchanged.  */</em>
<a id='L27980' name='L27980'></a> 27980 
<a id='L27981' name='L27981'></a> 27981 <strong class='reserved'>void</strong>
<a id='L27982' name='L27982'></a> 27982 x_set_window_size (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> change_gravity,
<a id='L27983' name='L27983'></a> 27983                    <strong class='reserved'>int</strong> width, <strong class='reserved'>int</strong> height)
<a id='L27984' name='L27984'></a> 27984 <em class='brace'>{</em>
<a id='L27985' name='L27985'></a> 27985   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L27986' name='L27986'></a> 27986 
<a id='L27987' name='L27987'></a> 27987 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L27988' name='L27988'></a> 27988   <strong class='reserved'>if</strong> (<a href='../D/2310.html' title='Multiple defined in 2 places.'>FRAME_GTK_WIDGET</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L27989' name='L27989'></a> 27989     <a href='../S/2362.html#L1168' title='Defined at 1168 in src/gtkutil.c.'>xg_frame_set_char_size</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, width, height);
<a id='L27990' name='L27990'></a> 27990   <strong class='reserved'>else</strong>
<a id='L27991' name='L27991'></a> 27991     x_set_window_size_1 (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, change_gravity, width, height);
<a id='L27992' name='L27992'></a> 27992 <em class='sharp'>#else</em> <em class='comment'>/* not USE_GTK */</em>
<a id='L27993' name='L27993'></a> 27993   x_set_window_size_1 (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, change_gravity, width, height);
<a id='L27994' name='L27994'></a> 27994   <a href='../S/2289.html#L7569' title='Defined at 7569 in src/xterm.c.'>x_clear_under_internal_border</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L27995' name='L27995'></a> 27995 <em class='sharp'>#endif</em> <em class='comment'>/* not USE_GTK */</em>
<a id='L27996' name='L27996'></a> 27996 
<a id='L27997' name='L27997'></a> 27997   <em class='comment'>/* If cursor was outside the new size, mark it as off.  */</em>
<a id='L27998' name='L27998'></a> 27998   <a href='../S/2108.html#L5434' title='Defined at 5434 in src/window.c.'>mark_window_cursors_off</a> (<a href='../D/7409.html' title='Multiple defined in 2 places.'>XWINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;root_window));
<a id='L27999' name='L27999'></a> 27999 
<a id='L28000' name='L28000'></a> 28000   <em class='comment'>/* Clear out any recollection of where the mouse highlighting was,</em>
<a id='L28001' name='L28001'></a> 28001 <em class='comment'>     since it might be in a place that's outside the new frame size.</em>
<a id='L28002' name='L28002'></a> 28002 <em class='comment'>     Actually checking whether it is outside is a pain in the neck,</em>
<a id='L28003' name='L28003'></a> 28003 <em class='comment'>     so don't try--just let the highlighting be done afresh with new size.  */</em>
<a id='L28004' name='L28004'></a> 28004   <a href='../S/2224.html#L35978' title='Defined at 35978 in src/xdisp.c.'>cancel_mouse_face</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28005' name='L28005'></a> 28005 
<a id='L28006' name='L28006'></a> 28006   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L28007' name='L28007'></a> 28007 
<a id='L28008' name='L28008'></a> 28008   <a href='../S/2140.html#L5976' title='Defined at 5976 in src/dispnew.c.'>do_pending_window_change</a> (<a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L28009' name='L28009'></a> 28009 <em class='brace'>}</em>
<a id='L28010' name='L28010'></a> 28010 
<a id='L28011' name='L28011'></a> 28011 <em class='comment'>/* Move the mouse to position pixel PIX_X, PIX_Y relative to frame F.  */</em>
<a id='L28012' name='L28012'></a> 28012 
<a id='L28013' name='L28013'></a> 28013 <strong class='reserved'>void</strong>
<a id='L28014' name='L28014'></a> 28014 <a href='../D/11701.html' title='Multiple defined in 4 places.'>frame_set_mouse_pixel_position</a> (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <strong class='reserved'>int</strong> pix_x, <strong class='reserved'>int</strong> pix_y)
<a id='L28015' name='L28015'></a> 28015 <em class='brace'>{</em>
<a id='L28016' name='L28016'></a> 28016 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L28017' name='L28017'></a> 28017   <strong class='reserved'>int</strong> deviceid;
<a id='L28018' name='L28018'></a> 28018 
<a id='L28019' name='L28019'></a> 28019   deviceid = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;client_pointer_device;
<a id='L28020' name='L28020'></a> 28020 
<a id='L28021' name='L28021'></a> 28021   <strong class='reserved'>if</strong> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;supports_xi2
<a id='L28022' name='L28022'></a> 28022       &amp;&amp; deviceid != -1)
<a id='L28023' name='L28023'></a> 28023     <em class='brace'>{</em>
<a id='L28024' name='L28024'></a> 28024       <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L28025' name='L28025'></a> 28025       x_ignore_errors_for_next_request (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), 0);
<a id='L28026' name='L28026'></a> 28026       XIWarpPointer (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), deviceid, None,
<a id='L28027' name='L28027'></a> 28027                      <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), 0, 0, 0, 0, pix_x, pix_y);
<a id='L28028' name='L28028'></a> 28028       x_stop_ignoring_errors (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L28029' name='L28029'></a> 28029       <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L28030' name='L28030'></a> 28030     <em class='brace'>}</em>
<a id='L28031' name='L28031'></a> 28031   <strong class='reserved'>else</strong>
<a id='L28032' name='L28032'></a> 28032 <em class='sharp'>#endif</em>
<a id='L28033' name='L28033'></a> 28033     XWarpPointer (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), None, <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L28034' name='L28034'></a> 28034                   0, 0, 0, 0, pix_x, pix_y);
<a id='L28035' name='L28035'></a> 28035 <em class='brace'>}</em>
<a id='L28036' name='L28036'></a> 28036 
<a id='L28037' name='L28037'></a> 28037 <em class='comment'>/* Raise frame F.  */</em>
<a id='L28038' name='L28038'></a> 28038 
<a id='L28039' name='L28039'></a> 28039 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L28040' name='L28040'></a> 28040 x_raise_frame (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L28041' name='L28041'></a> 28041 <em class='brace'>{</em>
<a id='L28042' name='L28042'></a> 28042   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L28043' name='L28043'></a> 28043 
<a id='L28044' name='L28044'></a> 28044   <strong class='reserved'>if</strong> (<a href='../S/2183.html#L1152' title='Defined at 1152 in src/frame.h.'>FRAME_VISIBLE_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L28045' name='L28045'></a> 28045     <em class='brace'>{</em>
<a id='L28046' name='L28046'></a> 28046       XRaiseWindow (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L28047' name='L28047'></a> 28047                     <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L28048' name='L28048'></a> 28048       XFlush (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L28049' name='L28049'></a> 28049     <em class='brace'>}</em>
<a id='L28050' name='L28050'></a> 28050 
<a id='L28051' name='L28051'></a> 28051   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L28052' name='L28052'></a> 28052 <em class='brace'>}</em>
<a id='L28053' name='L28053'></a> 28053 
<a id='L28054' name='L28054'></a> 28054 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L28055' name='L28055'></a> 28055 x_lower_frame_1 (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L28056' name='L28056'></a> 28056 <em class='brace'>{</em>
<a id='L28057' name='L28057'></a> 28057   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> *windows;
<a id='L28058' name='L28058'></a> 28058   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>;
<a id='L28059' name='L28059'></a> 28059   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *sibling;
<a id='L28060' name='L28060'></a> 28060 
<a id='L28061' name='L28061'></a> 28061   windows = <a href='../D/8439.html' title='Multiple defined in 8 places.'>alloca</a> (2 * <strong class='reserved'>sizeof</strong> *windows);
<a id='L28062' name='L28062'></a> 28062 
<a id='L28063' name='L28063'></a> 28063   <em class='comment'>/* Lowering a child frame leads to the window being put below any</em>
<a id='L28064' name='L28064'></a> 28064 <em class='comment'>     scroll bars on the parent.  To avoid that, restack the child</em>
<a id='L28065' name='L28065'></a> 28065 <em class='comment'>     frame below all of its siblings instead of just lowering it.  */</em>
<a id='L28066' name='L28066'></a> 28066 
<a id='L28067' name='L28067'></a> 28067   <a href='../S/2183.html#L1405' title='Defined at 1405 in src/frame.h.'>FOR_EACH_FRAME</a> (<a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)
<a id='L28068' name='L28068'></a> 28068     <em class='brace'>{</em>
<a id='L28069' name='L28069'></a> 28069       sibling = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>);
<a id='L28070' name='L28070'></a> 28070 
<a id='L28071' name='L28071'></a> 28071       <strong class='reserved'>if</strong> (sibling == <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L28072' name='L28072'></a> 28072         <strong class='reserved'>continue</strong>;
<a id='L28073' name='L28073'></a> 28073 
<a id='L28074' name='L28074'></a> 28074       <strong class='reserved'>if</strong> (<a href='../D/2370.html' title='Multiple defined in 2 places.'>FRAME_PARENT_FRAME</a> (sibling)
<a id='L28075' name='L28075'></a> 28075           != <a href='../D/2370.html' title='Multiple defined in 2 places.'>FRAME_PARENT_FRAME</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L28076' name='L28076'></a> 28076         <strong class='reserved'>continue</strong>;
<a id='L28077' name='L28077'></a> 28077 
<a id='L28078' name='L28078'></a> 28078       windows[0] = <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (sibling);
<a id='L28079' name='L28079'></a> 28079       windows[1] = <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28080' name='L28080'></a> 28080 
<a id='L28081' name='L28081'></a> 28081       XRestackWindows (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), windows, 2);
<a id='L28082' name='L28082'></a> 28082     <em class='brace'>}</em>
<a id='L28083' name='L28083'></a> 28083 <em class='brace'>}</em>
<a id='L28084' name='L28084'></a> 28084 
<a id='L28085' name='L28085'></a> 28085 <em class='comment'>/* Lower frame F.  */</em>
<a id='L28086' name='L28086'></a> 28086 
<a id='L28087' name='L28087'></a> 28087 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L28088' name='L28088'></a> 28088 x_lower_frame (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L28089' name='L28089'></a> 28089 <em class='brace'>{</em>
<a id='L28090' name='L28090'></a> 28090   <strong class='reserved'>if</strong> (<a href='../D/2370.html' title='Multiple defined in 2 places.'>FRAME_PARENT_FRAME</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L28091' name='L28091'></a> 28091       &amp;&amp; (<a href='../D/2318.html' title='Multiple defined in 2 places.'>FRAME_HAS_VERTICAL_SCROLL_BARS</a> (<a href='../D/2370.html' title='Multiple defined in 2 places.'>FRAME_PARENT_FRAME</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L28092' name='L28092'></a> 28092           || <a href='../D/2316.html' title='Multiple defined in 2 places.'>FRAME_HAS_HORIZONTAL_SCROLL_BARS</a> (<a href='../D/2370.html' title='Multiple defined in 2 places.'>FRAME_PARENT_FRAME</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))))
<a id='L28093' name='L28093'></a> 28093     x_lower_frame_1 (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28094' name='L28094'></a> 28094   <strong class='reserved'>else</strong>
<a id='L28095' name='L28095'></a> 28095     XLowerWindow (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L28096' name='L28096'></a> 28096                   <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L28097' name='L28097'></a> 28097 
<a id='L28098' name='L28098'></a> 28098 <em class='sharp'>#ifdef</em> HAVE_XWIDGETS
<a id='L28099' name='L28099'></a> 28099   <em class='comment'>/* Make sure any X windows owned by xwidget views of the parent</em>
<a id='L28100' name='L28100'></a> 28100 <em class='comment'>     still display below the lowered frame.  */</em>
<a id='L28101' name='L28101'></a> 28101 
<a id='L28102' name='L28102'></a> 28102   <strong class='reserved'>if</strong> (<a href='../D/2370.html' title='Multiple defined in 2 places.'>FRAME_PARENT_FRAME</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L28103' name='L28103'></a> 28103     <a href='../S/2334.html#L4183' title='Defined at 4183 in src/xwidget.c.'>lower_frame_xwidget_views</a> (<a href='../D/2370.html' title='Multiple defined in 2 places.'>FRAME_PARENT_FRAME</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L28104' name='L28104'></a> 28104 <em class='sharp'>#endif</em>
<a id='L28105' name='L28105'></a> 28105 
<a id='L28106' name='L28106'></a> 28106   XFlush (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L28107' name='L28107'></a> 28107 <em class='brace'>}</em>
<a id='L28108' name='L28108'></a> 28108 
<a id='L28109' name='L28109'></a> 28109 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L28110' name='L28110'></a> 28110 XTframe_raise_lower (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> raise_flag)
<a id='L28111' name='L28111'></a> 28111 <em class='brace'>{</em>
<a id='L28112' name='L28112'></a> 28112   <strong class='reserved'>if</strong> (raise_flag)
<a id='L28113' name='L28113'></a> 28113     x_raise_frame (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28114' name='L28114'></a> 28114   <strong class='reserved'>else</strong>
<a id='L28115' name='L28115'></a> 28115     x_lower_frame (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28116' name='L28116'></a> 28116 <em class='brace'>}</em>
<a id='L28117' name='L28117'></a> 28117 
<a id='L28118' name='L28118'></a> 28118 <em class='comment'>/* Request focus with XEmbed */</em>
<a id='L28119' name='L28119'></a> 28119 
<a id='L28120' name='L28120'></a> 28120 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L28121' name='L28121'></a> 28121 xembed_request_focus (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L28122' name='L28122'></a> 28122 <em class='brace'>{</em>
<a id='L28123' name='L28123'></a> 28123   <em class='comment'>/* See XEmbed Protocol Specification at</em>
<a id='L28124' name='L28124'></a> 28124 <em class='comment'>     https://freedesktop.org/wiki/Specifications/xembed-spec/  */</em>
<a id='L28125' name='L28125'></a> 28125   <strong class='reserved'>if</strong> (<a href='../S/2183.html#L1152' title='Defined at 1152 in src/frame.h.'>FRAME_VISIBLE_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L28126' name='L28126'></a> 28126     xembed_send_message (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, CurrentTime,
<a id='L28127' name='L28127'></a> 28127                          <a href='../S/2289.html#L1149' title='Defined at 1149 in src/xterm.c.'>XEMBED_REQUEST_FOCUS</a>, 0, 0, 0);
<a id='L28128' name='L28128'></a> 28128 <em class='brace'>}</em>
<a id='L28129' name='L28129'></a> 28129 
<a id='L28130' name='L28130'></a> 28130 <strong class='reserved'>static</strong> Bool
<a id='L28131' name='L28131'></a> 28131 <a href='../S/2106.html#L1709' title='Defined at 1709 in src/xmenu.c.'>server_timestamp_predicate</a> (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, XEvent *xevent,
<a id='L28132' name='L28132'></a> 28132                             XPointer arg)
<a id='L28133' name='L28133'></a> 28133 <em class='brace'>{</em>
<a id='L28134' name='L28134'></a> 28134   XID *<a href='../S/4038.html#L30' title='Defined at 30 in test/manual/etags/c-src/h.h.'>args</a> = (XID *) arg;
<a id='L28135' name='L28135'></a> 28135 
<a id='L28136' name='L28136'></a> 28136   <strong class='reserved'>if</strong> (xevent-&gt;type == PropertyNotify
<a id='L28137' name='L28137'></a> 28137       &amp;&amp; xevent-&gt;xproperty.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> == <a href='../S/4038.html#L30' title='Defined at 30 in test/manual/etags/c-src/h.h.'>args</a>[0]
<a id='L28138' name='L28138'></a> 28138       &amp;&amp; xevent-&gt;xproperty.atom == <a href='../S/4038.html#L30' title='Defined at 30 in test/manual/etags/c-src/h.h.'>args</a>[1])
<a id='L28139' name='L28139'></a> 28139     <strong class='reserved'>return</strong> True;
<a id='L28140' name='L28140'></a> 28140 
<a id='L28141' name='L28141'></a> 28141   <strong class='reserved'>return</strong> False;
<a id='L28142' name='L28142'></a> 28142 <em class='brace'>}</em>
<a id='L28143' name='L28143'></a> 28143 
<a id='L28144' name='L28144'></a> 28144 <em class='comment'>/* Get the server time.  The X server is guaranteed to deliver the</em>
<a id='L28145' name='L28145'></a> 28145 <em class='comment'>   PropertyNotify event, so there is no reason to use x_if_event.  */</em>
<a id='L28146' name='L28146'></a> 28146 
<a id='L28147' name='L28147'></a> 28147 <strong class='reserved'>static</strong> <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a>
<a id='L28148' name='L28148'></a> 28148 x_get_server_time (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L28149' name='L28149'></a> 28149 <em class='brace'>{</em>
<a id='L28150' name='L28150'></a> 28150   Atom property_atom;
<a id='L28151' name='L28151'></a> 28151   XEvent property_dummy;
<a id='L28152' name='L28152'></a> 28152   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L28153' name='L28153'></a> 28153   XID client_data[2];
<a id='L28154' name='L28154'></a> 28154 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XSYNC &amp;&amp; !<strong class='reserved'>defined</strong> USE_GTK &amp;&amp; <strong class='reserved'>defined</strong> HAVE_CLOCK_GETTIME
<a id='L28155' name='L28155'></a> 28155   <a href='../D/18597.html' title='Multiple defined in 2 places.'>uint_fast64_t</a> current_monotonic_time;
<a id='L28156' name='L28156'></a> 28156 <em class='sharp'>#endif</em>
<a id='L28157' name='L28157'></a> 28157 
<a id='L28158' name='L28158'></a> 28158   <em class='comment'>/* If the server time is the same as the monotonic time, avoid a</em>
<a id='L28159' name='L28159'></a> 28159 <em class='comment'>     roundtrip by using that instead.  */</em>
<a id='L28160' name='L28160'></a> 28160 
<a id='L28161' name='L28161'></a> 28161 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XSYNC &amp;&amp; !<strong class='reserved'>defined</strong> USE_GTK &amp;&amp; <strong class='reserved'>defined</strong> HAVE_CLOCK_GETTIME
<a id='L28162' name='L28162'></a> 28162   <strong class='reserved'>if</strong> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;server_time_monotonic_p)
<a id='L28163' name='L28163'></a> 28163     <em class='brace'>{</em>
<a id='L28164' name='L28164'></a> 28164       current_monotonic_time = <a href='../S/2289.html#L6953' title='Defined at 6953 in src/xterm.c.'>x_sync_current_monotonic_time</a> ();
<a id='L28165' name='L28165'></a> 28165 
<a id='L28166' name='L28166'></a> 28166       <strong class='reserved'>if</strong> (current_monotonic_time)
<a id='L28167' name='L28167'></a> 28167         <em class='comment'>/* Truncate the time to CARD32.  */</em>
<a id='L28168' name='L28168'></a> 28168         <strong class='reserved'>return</strong> (current_monotonic_time / 1000) &amp; <a href='../S/2212.html#L1276' title='Defined at 1276 in src/xterm.h.'>X_ULONG_MAX</a>;
<a id='L28169' name='L28169'></a> 28169     <em class='brace'>}</em>
<a id='L28170' name='L28170'></a> 28170 <em class='sharp'>#endif</em>
<a id='L28171' name='L28171'></a> 28171 
<a id='L28172' name='L28172'></a> 28172   dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28173' name='L28173'></a> 28173   property_atom = dpyinfo-&gt;Xatom_EMACS_SERVER_TIME_PROP;
<a id='L28174' name='L28174'></a> 28174   client_data[0] = <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28175' name='L28175'></a> 28175   client_data[1] = property_atom;
<a id='L28176' name='L28176'></a> 28176 
<a id='L28177' name='L28177'></a> 28177   XChangeProperty (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L28178' name='L28178'></a> 28178                    property_atom, XA_ATOM, 32,
<a id='L28179' name='L28179'></a> 28179                    PropModeReplace,
<a id='L28180' name='L28180'></a> 28180                    (<strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *) &amp;property_atom, 1);
<a id='L28181' name='L28181'></a> 28181 
<a id='L28182' name='L28182'></a> 28182   XIfEvent (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, &amp;property_dummy,
<a id='L28183' name='L28183'></a> 28183             <a href='../S/2106.html#L1709' title='Defined at 1709 in src/xmenu.c.'>server_timestamp_predicate</a>, (XPointer) client_data);
<a id='L28184' name='L28184'></a> 28184 
<a id='L28185' name='L28185'></a> 28185   <strong class='reserved'>return</strong> property_dummy.xproperty.<a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L28186' name='L28186'></a> 28186 <em class='brace'>}</em>
<a id='L28187' name='L28187'></a> 28187 
<a id='L28188' name='L28188'></a> 28188 <em class='comment'>/* Activate frame with Extended Window Manager Hints */</em>
<a id='L28189' name='L28189'></a> 28189 
<a id='L28190' name='L28190'></a> 28190 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L28191' name='L28191'></a> 28191 x_ewmh_activate_frame (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L28192' name='L28192'></a> 28192 <em class='brace'>{</em>
<a id='L28193' name='L28193'></a> 28193   XEvent msg;
<a id='L28194' name='L28194'></a> 28194   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L28195' name='L28195'></a> 28195   <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a> <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L28196' name='L28196'></a> 28196 
<a id='L28197' name='L28197'></a> 28197   dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28198' name='L28198'></a> 28198 
<a id='L28199' name='L28199'></a> 28199   <strong class='reserved'>if</strong> (<a href='../S/2183.html#L1152' title='Defined at 1152 in src/frame.h.'>FRAME_VISIBLE_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L28200' name='L28200'></a> 28200     <em class='brace'>{</em>
<a id='L28201' name='L28201'></a> 28201       <em class='comment'>/* See the documentation at</em>
<a id='L28202' name='L28202'></a> 28202 <em class='comment'>         https://specifications.freedesktop.org/wm-spec/wm-spec-latest.html</em>
<a id='L28203' name='L28203'></a> 28203 <em class='comment'>         for more details on the format of this message.  */</em>
<a id='L28204' name='L28204'></a> 28204       msg.xclient.type = ClientMessage;
<a id='L28205' name='L28205'></a> 28205       msg.xclient.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28206' name='L28206'></a> 28206       msg.xclient.message_type = dpyinfo-&gt;Xatom_net_active_window;
<a id='L28207' name='L28207'></a> 28207       msg.xclient.format = 32;
<a id='L28208' name='L28208'></a> 28208       msg.xclient.data.l[0] = 1;
<a id='L28209' name='L28209'></a> 28209       msg.xclient.data.l[1] = dpyinfo-&gt;last_user_time;
<a id='L28210' name='L28210'></a> 28210       msg.xclient.data.l[2] = (!dpyinfo-&gt;x_focus_frame
<a id='L28211' name='L28211'></a> 28211                                ? None
<a id='L28212' name='L28212'></a> 28212                                : <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (dpyinfo-&gt;x_focus_frame));
<a id='L28213' name='L28213'></a> 28213       msg.xclient.data.l[3] = 0;
<a id='L28214' name='L28214'></a> 28214       msg.xclient.data.l[4] = 0;
<a id='L28215' name='L28215'></a> 28215 
<a id='L28216' name='L28216'></a> 28216       <em class='comment'>/* No frame is currently focused on that display, so apply any</em>
<a id='L28217' name='L28217'></a> 28217 <em class='comment'>         bypass for focus stealing prevention that the user has</em>
<a id='L28218' name='L28218'></a> 28218 <em class='comment'>         specified.  */</em>
<a id='L28219' name='L28219'></a> 28219       <strong class='reserved'>if</strong> (!dpyinfo-&gt;x_focus_frame)
<a id='L28220' name='L28220'></a> 28220         <em class='brace'>{</em>
<a id='L28221' name='L28221'></a> 28221           <strong class='reserved'>if</strong> (<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (Vx_allow_focus_stealing, Qimitate_pager))
<a id='L28222' name='L28222'></a> 28222             msg.xclient.data.l[0] = 2;
<a id='L28223' name='L28223'></a> 28223           <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (Vx_allow_focus_stealing, Qnewer_time))
<a id='L28224' name='L28224'></a> 28224             <em class='brace'>{</em>
<a id='L28225' name='L28225'></a> 28225               <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L28226' name='L28226'></a> 28226               <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> = x_get_server_time (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28227' name='L28227'></a> 28227 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L28228' name='L28228'></a> 28228               <a href='../S/2289.html#L8023' title='Defined at 8023 in src/xterm.c.'>x_set_gtk_user_time</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>);
<a id='L28229' name='L28229'></a> 28229 <em class='sharp'>#endif</em>
<a id='L28230' name='L28230'></a> 28230               <em class='comment'>/* Temporarily override dpyinfo-&gt;x_focus_frame so the</em>
<a id='L28231' name='L28231'></a> 28231 <em class='comment'>                 user time property is set on the right window.  */</em>
<a id='L28232' name='L28232'></a> 28232               dpyinfo-&gt;x_focus_frame = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L28233' name='L28233'></a> 28233               <a href='../S/2289.html#L7929' title='Defined at 7929 in src/xterm.c.'>x_display_set_last_user_time</a> (dpyinfo, <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L28234' name='L28234'></a> 28234               dpyinfo-&gt;x_focus_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L28235' name='L28235'></a> 28235               <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L28236' name='L28236'></a> 28236 
<a id='L28237' name='L28237'></a> 28237               msg.xclient.data.l[1] = <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L28238' name='L28238'></a> 28238             <em class='brace'>}</em>
<a id='L28239' name='L28239'></a> 28239           <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (Vx_allow_focus_stealing, Qraise_and_focus))
<a id='L28240' name='L28240'></a> 28240             <em class='brace'>{</em>
<a id='L28241' name='L28241'></a> 28241               <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> = x_get_server_time (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28242' name='L28242'></a> 28242 
<a id='L28243' name='L28243'></a> 28243               x_set_input_focus (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L28244' name='L28244'></a> 28244                                  <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L28245' name='L28245'></a> 28245                                  <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>);
<a id='L28246' name='L28246'></a> 28246               XRaiseWindow (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L28247' name='L28247'></a> 28247 
<a id='L28248' name='L28248'></a> 28248               <strong class='reserved'>return</strong>;
<a id='L28249' name='L28249'></a> 28249             <em class='brace'>}</em>
<a id='L28250' name='L28250'></a> 28250         <em class='brace'>}</em>
<a id='L28251' name='L28251'></a> 28251 
<a id='L28252' name='L28252'></a> 28252       XSendEvent (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, dpyinfo-&gt;root_window,
<a id='L28253' name='L28253'></a> 28253                   False, (SubstructureRedirectMask
<a id='L28254' name='L28254'></a> 28254                           | SubstructureNotifyMask), &amp;msg);
<a id='L28255' name='L28255'></a> 28255     <em class='brace'>}</em>
<a id='L28256' name='L28256'></a> 28256 <em class='brace'>}</em>
<a id='L28257' name='L28257'></a> 28257 
<a id='L28258' name='L28258'></a> 28258 <strong class='reserved'>static</strong> <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a>
<a id='L28259' name='L28259'></a> 28259 x_get_focus_frame (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L28260' name='L28260'></a> 28260 <em class='brace'>{</em>
<a id='L28261' name='L28261'></a> 28261   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> lisp_focus;
<a id='L28262' name='L28262'></a> 28262 
<a id='L28263' name='L28263'></a> 28263   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *focus =  <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;x_focus_frame;
<a id='L28264' name='L28264'></a> 28264 
<a id='L28265' name='L28265'></a> 28265   <strong class='reserved'>if</strong> (!focus)
<a id='L28266' name='L28266'></a> 28266     <strong class='reserved'>return</strong> Qnil;
<a id='L28267' name='L28267'></a> 28267 
<a id='L28268' name='L28268'></a> 28268   <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (lisp_focus, focus);
<a id='L28269' name='L28269'></a> 28269   <strong class='reserved'>return</strong> lisp_focus;
<a id='L28270' name='L28270'></a> 28270 <em class='brace'>}</em>
<a id='L28271' name='L28271'></a> 28271 
<a id='L28272' name='L28272'></a> 28272 <em class='comment'>/* Return the toplevel parent of F, if it is a child frame.</em>
<a id='L28273' name='L28273'></a> 28273 <em class='comment'>   Otherwise, return NULL.  */</em>
<a id='L28274' name='L28274'></a> 28274 
<a id='L28275' name='L28275'></a> 28275 <strong class='reserved'>static</strong> <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *
<a id='L28276' name='L28276'></a> 28276 x_get_toplevel_parent (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L28277' name='L28277'></a> 28277 <em class='brace'>{</em>
<a id='L28278' name='L28278'></a> 28278   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/15236.html' title='Multiple defined in 2 places.'>parent</a>;
<a id='L28279' name='L28279'></a> 28279 
<a id='L28280' name='L28280'></a> 28280   <strong class='reserved'>if</strong> (!<a href='../D/2370.html' title='Multiple defined in 2 places.'>FRAME_PARENT_FRAME</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L28281' name='L28281'></a> 28281     <strong class='reserved'>return</strong> <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L28282' name='L28282'></a> 28282 
<a id='L28283' name='L28283'></a> 28283   <a href='../D/15236.html' title='Multiple defined in 2 places.'>parent</a> = <a href='../D/2370.html' title='Multiple defined in 2 places.'>FRAME_PARENT_FRAME</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28284' name='L28284'></a> 28284 
<a id='L28285' name='L28285'></a> 28285   <strong class='reserved'>while</strong> (<a href='../D/2370.html' title='Multiple defined in 2 places.'>FRAME_PARENT_FRAME</a> (<a href='../D/15236.html' title='Multiple defined in 2 places.'>parent</a>))
<a id='L28286' name='L28286'></a> 28286     <a href='../D/15236.html' title='Multiple defined in 2 places.'>parent</a> = <a href='../D/2370.html' title='Multiple defined in 2 places.'>FRAME_PARENT_FRAME</a> (<a href='../D/15236.html' title='Multiple defined in 2 places.'>parent</a>);
<a id='L28287' name='L28287'></a> 28287 
<a id='L28288' name='L28288'></a> 28288   <strong class='reserved'>return</strong> <a href='../D/15236.html' title='Multiple defined in 2 places.'>parent</a>;
<a id='L28289' name='L28289'></a> 28289 <em class='brace'>}</em>
<a id='L28290' name='L28290'></a> 28290 
<a id='L28291' name='L28291'></a> 28291 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L28292' name='L28292'></a> 28292 x_set_input_focus (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo, <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>,
<a id='L28293' name='L28293'></a> 28293                    <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a> <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>)
<a id='L28294' name='L28294'></a> 28294 <em class='brace'>{</em>
<a id='L28295' name='L28295'></a> 28295 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L28296' name='L28296'></a> 28296   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L275' title='Defined at 275 in src/xterm.h.'>xi_device_t</a> *device;
<a id='L28297' name='L28297'></a> 28297 <em class='sharp'>#endif</em>
<a id='L28298' name='L28298'></a> 28298 
<a id='L28299' name='L28299'></a> 28299   <em class='comment'>/* Do the equivalent of XSetInputFocus with the specified window and</em>
<a id='L28300' name='L28300'></a> 28300 <em class='comment'>     time, but use the attachment to the device that Emacs has</em>
<a id='L28301' name='L28301'></a> 28301 <em class='comment'>     designated the client pointer on X Input Extension builds.</em>
<a id='L28302' name='L28302'></a> 28302 <em class='comment'>     Asynchronously trap errors around the generated XI_SetFocus or</em>
<a id='L28303' name='L28303'></a> 28303 <em class='comment'>     SetInputFocus request, in case the device has been destroyed or</em>
<a id='L28304' name='L28304'></a> 28304 <em class='comment'>     the window obscured.</em>
<a id='L28305' name='L28305'></a> 28305 <em class='comment'></em>
<a id='L28306' name='L28306'></a> 28306 <em class='comment'>     The revert_to will be set to RevertToParent for generated</em>
<a id='L28307' name='L28307'></a> 28307 <em class='comment'>     SetInputFocus requests.  */</em>
<a id='L28308' name='L28308'></a> 28308 
<a id='L28309' name='L28309'></a> 28309 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L28310' name='L28310'></a> 28310   <strong class='reserved'>if</strong> (dpyinfo-&gt;supports_xi2
<a id='L28311' name='L28311'></a> 28311       &amp;&amp; dpyinfo-&gt;client_pointer_device != -1)
<a id='L28312' name='L28312'></a> 28312     <em class='brace'>{</em>
<a id='L28313' name='L28313'></a> 28313       device = <a href='../S/2289.html#L5732' title='Defined at 5732 in src/xterm.c.'>xi_device_from_id</a> (dpyinfo, dpyinfo-&gt;client_pointer_device);
<a id='L28314' name='L28314'></a> 28314 
<a id='L28315' name='L28315'></a> 28315       <em class='comment'>/* The device is a master pointer.  Use its attachment, which</em>
<a id='L28316' name='L28316'></a> 28316 <em class='comment'>         should be the master keyboard.  */</em>
<a id='L28317' name='L28317'></a> 28317 
<a id='L28318' name='L28318'></a> 28318       <strong class='reserved'>if</strong> (device)
<a id='L28319' name='L28319'></a> 28319         <em class='brace'>{</em>
<a id='L28320' name='L28320'></a> 28320           <a href='../D/10871.html' title='Multiple defined in 5 places.'>eassert</a> (device-&gt;use == XIMasterPointer);
<a id='L28321' name='L28321'></a> 28321 
<a id='L28322' name='L28322'></a> 28322           x_ignore_errors_for_next_request (dpyinfo, 0);
<a id='L28323' name='L28323'></a> 28323           XISetFocus (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, device-&gt;attachment,
<a id='L28324' name='L28324'></a> 28324                       <em class='comment'>/* Note that the input extension</em>
<a id='L28325' name='L28325'></a> 28325 <em class='comment'>                         only supports RevertToParent-type</em>
<a id='L28326' name='L28326'></a> 28326 <em class='comment'>                         behavior.  */</em>
<a id='L28327' name='L28327'></a> 28327                       <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>);
<a id='L28328' name='L28328'></a> 28328           x_stop_ignoring_errors (dpyinfo);
<a id='L28329' name='L28329'></a> 28329 
<a id='L28330' name='L28330'></a> 28330           <strong class='reserved'>return</strong>;
<a id='L28331' name='L28331'></a> 28331         <em class='brace'>}</em>
<a id='L28332' name='L28332'></a> 28332     <em class='brace'>}</em>
<a id='L28333' name='L28333'></a> 28333 <em class='sharp'>#endif</em>
<a id='L28334' name='L28334'></a> 28334 
<a id='L28335' name='L28335'></a> 28335   <em class='comment'>/* Otherwise, use the pointer device that the X server says is the</em>
<a id='L28336' name='L28336'></a> 28336 <em class='comment'>     client pointer.  */</em>
<a id='L28337' name='L28337'></a> 28337   x_ignore_errors_for_next_request (dpyinfo, 0);
<a id='L28338' name='L28338'></a> 28338   XSetInputFocus (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, RevertToParent, <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>);
<a id='L28339' name='L28339'></a> 28339   x_stop_ignoring_errors (dpyinfo);
<a id='L28340' name='L28340'></a> 28340 <em class='brace'>}</em>
<a id='L28341' name='L28341'></a> 28341 
<a id='L28342' name='L28342'></a> 28342 <em class='comment'>/* In certain situations, when the window manager follows a</em>
<a id='L28343' name='L28343'></a> 28343 <em class='comment'>   click-to-focus policy, there seems to be no way around calling</em>
<a id='L28344' name='L28344'></a> 28344 <em class='comment'>   XSetInputFocus to give another frame the input focus.</em>
<a id='L28345' name='L28345'></a> 28345 <em class='comment'></em>
<a id='L28346' name='L28346'></a> 28346 <em class='comment'>   In an ideal world, XSetInputFocus should generally be avoided so</em>
<a id='L28347' name='L28347'></a> 28347 <em class='comment'>   that applications don't interfere with the window manager's focus</em>
<a id='L28348' name='L28348'></a> 28348 <em class='comment'>   policy.  But I think it's okay to use when it's clearly done</em>
<a id='L28349' name='L28349'></a> 28349 <em class='comment'>   following a user-command.  */</em>
<a id='L28350' name='L28350'></a> 28350 
<a id='L28351' name='L28351'></a> 28351 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L28352' name='L28352'></a> 28352 x_focus_frame (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> noactivate)
<a id='L28353' name='L28353'></a> 28353 <em class='brace'>{</em>
<a id='L28354' name='L28354'></a> 28354   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L28355' name='L28355'></a> 28355   <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a> <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>;
<a id='L28356' name='L28356'></a> 28356 
<a id='L28357' name='L28357'></a> 28357   dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28358' name='L28358'></a> 28358 
<a id='L28359' name='L28359'></a> 28359   <strong class='reserved'>if</strong> (dpyinfo-&gt;untrusted)
<a id='L28360' name='L28360'></a> 28360     <em class='comment'>/* The X server ignores all input focus related requests from</em>
<a id='L28361' name='L28361'></a> 28361 <em class='comment'>       untrusted clients.  */</em>
<a id='L28362' name='L28362'></a> 28362     <strong class='reserved'>return</strong>;
<a id='L28363' name='L28363'></a> 28363 
<a id='L28364' name='L28364'></a> 28364   <em class='comment'>/* The code below is not reentrant wrt to dpyinfo-&gt;x_focus_frame and</em>
<a id='L28365' name='L28365'></a> 28365 <em class='comment'>     friends being set.  */</em>
<a id='L28366' name='L28366'></a> 28366   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L28367' name='L28367'></a> 28367 
<a id='L28368' name='L28368'></a> 28368   <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1979' title='Defined at 1979 in src/xterm.h.'>FRAME_X_EMBEDDED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L28369' name='L28369'></a> 28369     <em class='comment'>/* For Xembedded frames, normally the embedder forwards key</em>
<a id='L28370' name='L28370'></a> 28370 <em class='comment'>       events.  See XEmbed Protocol Specification at</em>
<a id='L28371' name='L28371'></a> 28371 <em class='comment'>       https://freedesktop.org/wiki/Specifications/xembed-spec/  */</em>
<a id='L28372' name='L28372'></a> 28372     xembed_request_focus (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28373' name='L28373'></a> 28373   <strong class='reserved'>else</strong>
<a id='L28374' name='L28374'></a> 28374     <em class='brace'>{</em>
<a id='L28375' name='L28375'></a> 28375       <strong class='reserved'>if</strong> (!noactivate
<a id='L28376' name='L28376'></a> 28376           <em class='comment'>/* If F is override-redirect, use SetInputFocus instead.</em>
<a id='L28377' name='L28377'></a> 28377 <em class='comment'>             Override-redirect frames are not subject to window</em>
<a id='L28378' name='L28378'></a> 28378 <em class='comment'>             management.  */</em>
<a id='L28379' name='L28379'></a> 28379           &amp;&amp; !<a href='../D/2369.html' title='Multiple defined in 3 places.'>FRAME_OVERRIDE_REDIRECT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L28380' name='L28380'></a> 28380           <em class='comment'>/* If F is a child frame, use SetInputFocus instead.  This</em>
<a id='L28381' name='L28381'></a> 28381 <em class='comment'>             may not work if its parent is not activated.  */</em>
<a id='L28382' name='L28382'></a> 28382           &amp;&amp; !<a href='../D/2370.html' title='Multiple defined in 2 places.'>FRAME_PARENT_FRAME</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L28383' name='L28383'></a> 28383           <em class='comment'>/* If the focus is being transferred from a child frame to</em>
<a id='L28384' name='L28384'></a> 28384 <em class='comment'>             its toplevel parent, also use SetInputFocus.  */</em>
<a id='L28385' name='L28385'></a> 28385           &amp;&amp; (!dpyinfo-&gt;x_focus_frame
<a id='L28386' name='L28386'></a> 28386               || (x_get_toplevel_parent (dpyinfo-&gt;x_focus_frame)
<a id='L28387' name='L28387'></a> 28387                   != <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L28388' name='L28388'></a> 28388           &amp;&amp; x_wm_supports (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, dpyinfo-&gt;Xatom_net_active_window))
<a id='L28389' name='L28389'></a> 28389         <em class='brace'>{</em>
<a id='L28390' name='L28390'></a> 28390           <em class='comment'>/* When window manager activation is possible, use it</em>
<a id='L28391' name='L28391'></a> 28391 <em class='comment'>             instead.  The window manager is expected to perform any</em>
<a id='L28392' name='L28392'></a> 28392 <em class='comment'>             necessary actions such as raising the frame, moving it to</em>
<a id='L28393' name='L28393'></a> 28393 <em class='comment'>             the current workspace, and mapping it, etc, before moving</em>
<a id='L28394' name='L28394'></a> 28394 <em class='comment'>             input focus to the frame.  */</em>
<a id='L28395' name='L28395'></a> 28395           x_ewmh_activate_frame (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28396' name='L28396'></a> 28396           <strong class='reserved'>goto</strong> out;
<a id='L28397' name='L28397'></a> 28397         <em class='brace'>}</em>
<a id='L28398' name='L28398'></a> 28398 
<a id='L28399' name='L28399'></a> 28399       <strong class='reserved'>if</strong> (<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (Vx_no_window_manager))
<a id='L28400' name='L28400'></a> 28400         <em class='brace'>{</em>
<a id='L28401' name='L28401'></a> 28401           <em class='comment'>/* Use the last user time.  It is invalid to use CurrentTime</em>
<a id='L28402' name='L28402'></a> 28402 <em class='comment'>             according to the ICCCM:</em>
<a id='L28403' name='L28403'></a> 28403 <em class='comment'></em>
<a id='L28404' name='L28404'></a> 28404 <em class='comment'>               Clients that use a SetInputFocus request must set the</em>
<a id='L28405' name='L28405'></a> 28405 <em class='comment'>               time field to the timestamp of the event that caused</em>
<a id='L28406' name='L28406'></a> 28406 <em class='comment'>               them to make the attempt. [...] Note that clients must</em>
<a id='L28407' name='L28407'></a> 28407 <em class='comment'>               not use CurrentTime in the time field.  */</em>
<a id='L28408' name='L28408'></a> 28408           <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> = dpyinfo-&gt;last_user_time;
<a id='L28409' name='L28409'></a> 28409 
<a id='L28410' name='L28410'></a> 28410           <em class='comment'>/* Unless the focus doesn't belong to Emacs anymore and</em>
<a id='L28411' name='L28411'></a> 28411 <em class='comment'>             `x-allow-focus-stealing' is set to Qnewer_time.  */</em>
<a id='L28412' name='L28412'></a> 28412           <strong class='reserved'>if</strong> (<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (Vx_allow_focus_stealing, Qnewer_time)
<a id='L28413' name='L28413'></a> 28413               &amp;&amp; !dpyinfo-&gt;x_focus_frame)
<a id='L28414' name='L28414'></a> 28414             <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a> = x_get_server_time (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28415' name='L28415'></a> 28415 
<a id='L28416' name='L28416'></a> 28416           <em class='comment'>/* Ignore any BadMatch error this request might result in.</em>
<a id='L28417' name='L28417'></a> 28417 <em class='comment'>             A BadMatch error can occur if the window was obscured</em>
<a id='L28418' name='L28418'></a> 28418 <em class='comment'>             after the time of the last user interaction without</em>
<a id='L28419' name='L28419'></a> 28419 <em class='comment'>             changing the last-focus-change-time.  */</em>
<a id='L28420' name='L28420'></a> 28420           x_set_input_focus (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L28421' name='L28421'></a> 28421                              <a href='../S/2902.html#L163' title='Defined at 163 in lib/time.in.h.'>time</a>);
<a id='L28422' name='L28422'></a> 28422         <em class='brace'>}</em>
<a id='L28423' name='L28423'></a> 28423       <strong class='reserved'>else</strong>
<a id='L28424' name='L28424'></a> 28424         x_set_input_focus (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L28425' name='L28425'></a> 28425                            <em class='comment'>/* But when no window manager is in use,</em>
<a id='L28426' name='L28426'></a> 28426 <em class='comment'>                              respecting the ICCCM doesn't really</em>
<a id='L28427' name='L28427'></a> 28427 <em class='comment'>                              matter.  */</em>
<a id='L28428' name='L28428'></a> 28428                            CurrentTime);
<a id='L28429' name='L28429'></a> 28429     <em class='brace'>}</em>
<a id='L28430' name='L28430'></a> 28430 
<a id='L28431' name='L28431'></a> 28431  out:
<a id='L28432' name='L28432'></a> 28432   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L28433' name='L28433'></a> 28433 <em class='brace'>}</em>
<a id='L28434' name='L28434'></a> 28434 
<a id='L28435' name='L28435'></a> 28435 
<a id='L28436' name='L28436'></a> 28436 <em class='comment'>/* XEmbed implementation.  */</em>
<a id='L28437' name='L28437'></a> 28437 
<a id='L28438' name='L28438'></a> 28438 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> USE_X_TOOLKIT || ! <strong class='reserved'>defined</strong> USE_GTK
<a id='L28439' name='L28439'></a> 28439 
<a id='L28440' name='L28440'></a> 28440 <em class='comment'>/* XEmbed implementation.  */</em>
<a id='L28441' name='L28441'></a> 28441 
<a id='L28442' name='L28442'></a> 28442 <em class='sharp'>#define</em> <a href='../S/2289.html#L28450' title='Referred from 28450 in src/xterm.c.'>XEMBED_VERSION</a> 0
<a id='L28443' name='L28443'></a> 28443 
<a id='L28444' name='L28444'></a> 28444 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L28445' name='L28445'></a> 28445 xembed_set_info (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <strong class='reserved'>enum</strong> <a href='../S/2289.html#L1139' title='Defined at 1139 in src/xterm.c.'>xembed_info</a> flags)
<a id='L28446' name='L28446'></a> 28446 <em class='brace'>{</em>
<a id='L28447' name='L28447'></a> 28447   <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> data[2];
<a id='L28448' name='L28448'></a> 28448   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28449' name='L28449'></a> 28449 
<a id='L28450' name='L28450'></a> 28450   data[0] = <a href='../S/2289.html#L28442' title='Defined at 28442 in src/xterm.c.'>XEMBED_VERSION</a>;
<a id='L28451' name='L28451'></a> 28451   data[1] = flags;
<a id='L28452' name='L28452'></a> 28452 
<a id='L28453' name='L28453'></a> 28453   XChangeProperty (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L28454' name='L28454'></a> 28454                    dpyinfo-&gt;Xatom_XEMBED_INFO, dpyinfo-&gt;Xatom_XEMBED_INFO,
<a id='L28455' name='L28455'></a> 28455                    32, PropModeReplace, (<strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *) data, 2);
<a id='L28456' name='L28456'></a> 28456 <em class='brace'>}</em>
<a id='L28457' name='L28457'></a> 28457 <em class='sharp'>#endif</em> <em class='comment'>/* defined USE_X_TOOLKIT || ! defined USE_GTK */</em>
<a id='L28458' name='L28458'></a> 28458 
<a id='L28459' name='L28459'></a> 28459 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L28460' name='L28460'></a> 28460 xembed_send_message (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a> t, <strong class='reserved'>enum</strong> <a href='../S/2289.html#L1144' title='Defined at 1144 in src/xterm.c.'>xembed_message</a> msg,
<a id='L28461' name='L28461'></a> 28461                      <strong class='reserved'>long</strong> <strong class='reserved'>int</strong> detail, <strong class='reserved'>long</strong> <strong class='reserved'>int</strong> data1, <strong class='reserved'>long</strong> <strong class='reserved'>int</strong> data2)
<a id='L28462' name='L28462'></a> 28462 <em class='brace'>{</em>
<a id='L28463' name='L28463'></a> 28463   XEvent event;
<a id='L28464' name='L28464'></a> 28464 
<a id='L28465' name='L28465'></a> 28465   event.xclient.type = ClientMessage;
<a id='L28466' name='L28466'></a> 28466   event.xclient.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;parent_desc;
<a id='L28467' name='L28467'></a> 28467   event.xclient.message_type = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;Xatom_XEMBED;
<a id='L28468' name='L28468'></a> 28468   event.xclient.format = 32;
<a id='L28469' name='L28469'></a> 28469   event.xclient.data.l[0] = t;
<a id='L28470' name='L28470'></a> 28470   event.xclient.data.l[1] = msg;
<a id='L28471' name='L28471'></a> 28471   event.xclient.data.l[2] = detail;
<a id='L28472' name='L28472'></a> 28472   event.xclient.data.l[3] = data1;
<a id='L28473' name='L28473'></a> 28473   event.xclient.data.l[4] = data2;
<a id='L28474' name='L28474'></a> 28474 
<a id='L28475' name='L28475'></a> 28475   <em class='comment'>/* XXX: the XEmbed spec tells us to trap errors around this request,</em>
<a id='L28476' name='L28476'></a> 28476 <em class='comment'>     but I don't understand why: there is no way for clients to</em>
<a id='L28477' name='L28477'></a> 28477 <em class='comment'>     survive the death of the parent anyway.  */</em>
<a id='L28478' name='L28478'></a> 28478 
<a id='L28479' name='L28479'></a> 28479   x_ignore_errors_for_next_request (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), 0);
<a id='L28480' name='L28480'></a> 28480   XSendEvent (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;parent_desc,
<a id='L28481' name='L28481'></a> 28481               False, NoEventMask, &amp;event);
<a id='L28482' name='L28482'></a> 28482   x_stop_ignoring_errors (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L28483' name='L28483'></a> 28483 <em class='brace'>}</em>
<a id='L28484' name='L28484'></a> 28484 
<a id='L28485' name='L28485'></a> 28485 <em class='comment'>/* Change of visibility.  */</em>
<a id='L28486' name='L28486'></a> 28486 
<a id='L28487' name='L28487'></a> 28487 <em class='comment'>/* This tries to wait until the frame is really visible, depending on</em>
<a id='L28488' name='L28488'></a> 28488 <em class='comment'>   the value of Vx_wait_for_event_timeout.</em>
<a id='L28489' name='L28489'></a> 28489 <em class='comment'>   However, if the window manager asks the user where to position</em>
<a id='L28490' name='L28490'></a> 28490 <em class='comment'>   the frame, this will return before the user finishes doing that.</em>
<a id='L28491' name='L28491'></a> 28491 <em class='comment'>   The frame will not actually be visible at that time,</em>
<a id='L28492' name='L28492'></a> 28492 <em class='comment'>   but it will become visible later when the window manager</em>
<a id='L28493' name='L28493'></a> 28493 <em class='comment'>   finishes with it.  */</em>
<a id='L28494' name='L28494'></a> 28494 
<a id='L28495' name='L28495'></a> 28495 <strong class='reserved'>void</strong>
<a id='L28496' name='L28496'></a> 28496 x_make_frame_visible (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L28497' name='L28497'></a> 28497 <em class='brace'>{</em>
<a id='L28498' name='L28498'></a> 28498 <em class='sharp'>#ifndef</em> USE_GTK
<a id='L28499' name='L28499'></a> 28499   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L28500' name='L28500'></a> 28500   <strong class='reserved'>struct</strong> <a href='../D/19627.html' title='Multiple defined in 5 places.'>x_output</a> *output;
<a id='L28501' name='L28501'></a> 28501 <em class='sharp'>#endif</em>
<a id='L28502' name='L28502'></a> 28502   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> output_flushed;
<a id='L28503' name='L28503'></a> 28503 
<a id='L28504' name='L28504'></a> 28504   <strong class='reserved'>if</strong> (<a href='../D/2370.html' title='Multiple defined in 2 places.'>FRAME_PARENT_FRAME</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L28505' name='L28505'></a> 28505     <em class='brace'>{</em>
<a id='L28506' name='L28506'></a> 28506       <strong class='reserved'>if</strong> (!<a href='../S/2183.html#L1152' title='Defined at 1152 in src/frame.h.'>FRAME_VISIBLE_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L28507' name='L28507'></a> 28507         <em class='brace'>{</em>
<a id='L28508' name='L28508'></a> 28508           <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L28509' name='L28509'></a> 28509 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L28510' name='L28510'></a> 28510           gtk_widget_show_all (<a href='../D/2309.html' title='Multiple defined in 2 places.'>FRAME_GTK_OUTER_WIDGET</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L28511' name='L28511'></a> 28511           XMoveWindow (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L28512' name='L28512'></a> 28512                        <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;left_pos, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;top_pos);
<a id='L28513' name='L28513'></a> 28513 <em class='sharp'>#else</em>
<a id='L28514' name='L28514'></a> 28514           XMapRaised (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L28515' name='L28515'></a> 28515 <em class='sharp'>#endif</em>
<a id='L28516' name='L28516'></a> 28516           <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L28517' name='L28517'></a> 28517 
<a id='L28518' name='L28518'></a> 28518           <a href='../S/2183.html#L1437' title='Defined at 1437 in src/frame.h.'>SET_FRAME_VISIBLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L28519' name='L28519'></a> 28519           <a href='../S/2183.html#L1452' title='Defined at 1452 in src/frame.h.'>SET_FRAME_ICONIFIED</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L28520' name='L28520'></a> 28520         <em class='brace'>}</em>
<a id='L28521' name='L28521'></a> 28521       <strong class='reserved'>return</strong>;
<a id='L28522' name='L28522'></a> 28522     <em class='brace'>}</em>
<a id='L28523' name='L28523'></a> 28523 
<a id='L28524' name='L28524'></a> 28524   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L28525' name='L28525'></a> 28525 
<a id='L28526' name='L28526'></a> 28526   <a href='../S/2183.html#L1883' title='Defined at 1883 in src/frame.h.'>gui_set_bitmap_icon</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28527' name='L28527'></a> 28527 
<a id='L28528' name='L28528'></a> 28528 <em class='sharp'>#ifndef</em> USE_GTK
<a id='L28529' name='L28529'></a> 28529   dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28530' name='L28530'></a> 28530 <em class='sharp'>#endif</em>
<a id='L28531' name='L28531'></a> 28531 
<a id='L28532' name='L28532'></a> 28532   <strong class='reserved'>if</strong> (! <a href='../S/2183.html#L1152' title='Defined at 1152 in src/frame.h.'>FRAME_VISIBLE_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L28533' name='L28533'></a> 28533     <em class='brace'>{</em>
<a id='L28534' name='L28534'></a> 28534       <em class='comment'>/* We test asked_for_visible here to make sure we don't</em>
<a id='L28535' name='L28535'></a> 28535 <em class='comment'>         call x_set_offset a second time</em>
<a id='L28536' name='L28536'></a> 28536 <em class='comment'>         if we get to x_make_frame_visible a second time</em>
<a id='L28537' name='L28537'></a> 28537 <em class='comment'>         before the window gets really visible.  */</em>
<a id='L28538' name='L28538'></a> 28538       <strong class='reserved'>if</strong> (! <a href='../S/2183.html#L1172' title='Defined at 1172 in src/frame.h.'>FRAME_ICONIFIED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L28539' name='L28539'></a> 28539           &amp;&amp; ! <a href='../S/2212.html#L1979' title='Defined at 1979 in src/xterm.h.'>FRAME_X_EMBEDDED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L28540' name='L28540'></a> 28540           &amp;&amp; ! <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;asked_for_visible)
<a id='L28541' name='L28541'></a> 28541         x_set_offset (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;left_pos, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;top_pos, 0);
<a id='L28542' name='L28542'></a> 28542 
<a id='L28543' name='L28543'></a> 28543 <em class='sharp'>#ifndef</em> USE_GTK
<a id='L28544' name='L28544'></a> 28544       output = <a href='../D/2466.html' title='Multiple defined in 2 places.'>FRAME_X_OUTPUT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28545' name='L28545'></a> 28545       <a href='../S/2289.html#L8068' title='Defined at 8068 in src/xterm.c.'>x_update_frame_user_time_window</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28546' name='L28546'></a> 28546 
<a id='L28547' name='L28547'></a> 28547       <em class='comment'>/* It's been a while since I wrote that code...  I don't</em>
<a id='L28548' name='L28548'></a> 28548 <em class='comment'>         remember if it can leave `user_time_window' unset or not.  */</em>
<a id='L28549' name='L28549'></a> 28549       <strong class='reserved'>if</strong> (output-&gt;user_time_window != None)
<a id='L28550' name='L28550'></a> 28550         <em class='brace'>{</em>
<a id='L28551' name='L28551'></a> 28551           <strong class='reserved'>if</strong> (dpyinfo-&gt;last_user_time)
<a id='L28552' name='L28552'></a> 28552             XChangeProperty (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, output-&gt;user_time_window,
<a id='L28553' name='L28553'></a> 28553                              dpyinfo-&gt;Xatom_net_wm_user_time,
<a id='L28554' name='L28554'></a> 28554                              XA_CARDINAL, 32, PropModeReplace,
<a id='L28555' name='L28555'></a> 28555                              (<strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *) &amp;dpyinfo-&gt;last_user_time, 1);
<a id='L28556' name='L28556'></a> 28556           <strong class='reserved'>else</strong>
<a id='L28557' name='L28557'></a> 28557             XDeleteProperty (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, output-&gt;user_time_window,
<a id='L28558' name='L28558'></a> 28558                              dpyinfo-&gt;Xatom_net_wm_user_time);
<a id='L28559' name='L28559'></a> 28559         <em class='brace'>}</em>
<a id='L28560' name='L28560'></a> 28560 <em class='sharp'>#endif</em>
<a id='L28561' name='L28561'></a> 28561 
<a id='L28562' name='L28562'></a> 28562       <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;asked_for_visible = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L28563' name='L28563'></a> 28563 
<a id='L28564' name='L28564'></a> 28564       <strong class='reserved'>if</strong> (! <a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (Vx_no_window_manager, Qt))
<a id='L28565' name='L28565'></a> 28565         x_wm_set_window_state (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, NormalState);
<a id='L28566' name='L28566'></a> 28566 <em class='sharp'>#ifdef</em> USE_X_TOOLKIT
<a id='L28567' name='L28567'></a> 28567       <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1979' title='Defined at 1979 in src/xterm.h.'>FRAME_X_EMBEDDED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L28568' name='L28568'></a> 28568         xembed_set_info (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/2289.html#L1141' title='Defined at 1141 in src/xterm.c.'>XEMBED_MAPPED</a>);
<a id='L28569' name='L28569'></a> 28569       <strong class='reserved'>else</strong>
<a id='L28570' name='L28570'></a> 28570         <em class='brace'>{</em>
<a id='L28571' name='L28571'></a> 28571           <em class='comment'>/* This was XtPopup, but that did nothing for an iconified frame.  */</em>
<a id='L28572' name='L28572'></a> 28572           XtMapWidget (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;widget);
<a id='L28573' name='L28573'></a> 28573         <em class='brace'>}</em>
<a id='L28574' name='L28574'></a> 28574 <em class='sharp'>#else</em> <em class='comment'>/* not USE_X_TOOLKIT */</em>
<a id='L28575' name='L28575'></a> 28575 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L28576' name='L28576'></a> 28576       gtk_widget_show_all (<a href='../D/2309.html' title='Multiple defined in 2 places.'>FRAME_GTK_OUTER_WIDGET</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L28577' name='L28577'></a> 28577       gtk_window_deiconify (GTK_WINDOW (<a href='../D/2309.html' title='Multiple defined in 2 places.'>FRAME_GTK_OUTER_WIDGET</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)));
<a id='L28578' name='L28578'></a> 28578 <em class='sharp'>#else</em>
<a id='L28579' name='L28579'></a> 28579       <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1979' title='Defined at 1979 in src/xterm.h.'>FRAME_X_EMBEDDED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L28580' name='L28580'></a> 28580         xembed_set_info (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/2289.html#L1141' title='Defined at 1141 in src/xterm.c.'>XEMBED_MAPPED</a>);
<a id='L28581' name='L28581'></a> 28581       <strong class='reserved'>else</strong>
<a id='L28582' name='L28582'></a> 28582         XMapRaised (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L28583' name='L28583'></a> 28583 <em class='sharp'>#endif</em> <em class='comment'>/* not USE_GTK */</em>
<a id='L28584' name='L28584'></a> 28584 <em class='sharp'>#endif</em> <em class='comment'>/* not USE_X_TOOLKIT */</em>
<a id='L28585' name='L28585'></a> 28585 
<a id='L28586' name='L28586'></a> 28586       <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1979' title='Defined at 1979 in src/xterm.h.'>FRAME_X_EMBEDDED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L28587' name='L28587'></a> 28587         <em class='brace'>{</em>
<a id='L28588' name='L28588'></a> 28588           <a href='../S/2183.html#L1437' title='Defined at 1437 in src/frame.h.'>SET_FRAME_VISIBLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L28589' name='L28589'></a> 28589           <a href='../S/2183.html#L1452' title='Defined at 1452 in src/frame.h.'>SET_FRAME_ICONIFIED</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L28590' name='L28590'></a> 28590         <em class='brace'>}</em>
<a id='L28591' name='L28591'></a> 28591     <em class='brace'>}</em>
<a id='L28592' name='L28592'></a> 28592 
<a id='L28593' name='L28593'></a> 28593   <em class='comment'>/* Synchronize to ensure Emacs knows the frame is visible</em>
<a id='L28594' name='L28594'></a> 28594 <em class='comment'>     before we do anything else.  We do this loop with input not blocked</em>
<a id='L28595' name='L28595'></a> 28595 <em class='comment'>     so that incoming events are handled.  */</em>
<a id='L28596' name='L28596'></a> 28596   <em class='brace'>{</em>
<a id='L28597' name='L28597'></a> 28597     <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>;
<a id='L28598' name='L28598'></a> 28598     <em class='comment'>/* This must be before UNBLOCK_INPUT</em>
<a id='L28599' name='L28599'></a> 28599 <em class='comment'>       since events that arrive in response to the actions above</em>
<a id='L28600' name='L28600'></a> 28600 <em class='comment'>       will set it when they are handled.  */</em>
<a id='L28601' name='L28601'></a> 28601     <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> previously_visible = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;has_been_visible;
<a id='L28602' name='L28602'></a> 28602 
<a id='L28603' name='L28603'></a> 28603     <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28604' name='L28604'></a> 28604 
<a id='L28605' name='L28605'></a> 28605     <strong class='reserved'>int</strong> original_left = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;left_pos;
<a id='L28606' name='L28606'></a> 28606     <strong class='reserved'>int</strong> original_top = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;top_pos;
<a id='L28607' name='L28607'></a> 28607 
<a id='L28608' name='L28608'></a> 28608     <em class='comment'>/* This must come after we set COUNT.  */</em>
<a id='L28609' name='L28609'></a> 28609     <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L28610' name='L28610'></a> 28610 
<a id='L28611' name='L28611'></a> 28611     <em class='comment'>/* Keep track of whether or not the output buffer was flushed, to</em>
<a id='L28612' name='L28612'></a> 28612 <em class='comment'>       avoid any extra flushes.  */</em>
<a id='L28613' name='L28613'></a> 28613     output_flushed = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L28614' name='L28614'></a> 28614 
<a id='L28615' name='L28615'></a> 28615     <em class='comment'>/* We unblock here so that arriving X events are processed.  */</em>
<a id='L28616' name='L28616'></a> 28616 
<a id='L28617' name='L28617'></a> 28617     <em class='comment'>/* Now move the window back to where it was "supposed to be".</em>
<a id='L28618' name='L28618'></a> 28618 <em class='comment'>       But don't do it if the gravity is negative.</em>
<a id='L28619' name='L28619'></a> 28619 <em class='comment'>       When the gravity is negative, this uses a position</em>
<a id='L28620' name='L28620'></a> 28620 <em class='comment'>       that is 3 pixels too low.  Perhaps that's really the border width.</em>
<a id='L28621' name='L28621'></a> 28621 <em class='comment'></em>
<a id='L28622' name='L28622'></a> 28622 <em class='comment'>       Don't do this if the window has never been visible before,</em>
<a id='L28623' name='L28623'></a> 28623 <em class='comment'>       because the window manager may choose the position</em>
<a id='L28624' name='L28624'></a> 28624 <em class='comment'>       and we don't want to override it.  */</em>
<a id='L28625' name='L28625'></a> 28625 
<a id='L28626' name='L28626'></a> 28626     <strong class='reserved'>if</strong> (!<a href='../S/2183.html#L1152' title='Defined at 1152 in src/frame.h.'>FRAME_VISIBLE_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L28627' name='L28627'></a> 28627         &amp;&amp; !<a href='../S/2183.html#L1172' title='Defined at 1172 in src/frame.h.'>FRAME_ICONIFIED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L28628' name='L28628'></a> 28628         &amp;&amp; !<a href='../S/2212.html#L1979' title='Defined at 1979 in src/xterm.h.'>FRAME_X_EMBEDDED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L28629' name='L28629'></a> 28629         &amp;&amp; !<a href='../D/2370.html' title='Multiple defined in 2 places.'>FRAME_PARENT_FRAME</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L28630' name='L28630'></a> 28630         &amp;&amp; <a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (Vx_lax_frame_positioning)
<a id='L28631' name='L28631'></a> 28631         &amp;&amp; <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;win_gravity == <a href='../D/4579.html' title='Multiple defined in 5 places.'>NorthWestGravity</a>
<a id='L28632' name='L28632'></a> 28632         &amp;&amp; previously_visible)
<a id='L28633' name='L28633'></a> 28633       <em class='brace'>{</em>
<a id='L28634' name='L28634'></a> 28634         <a href='../D/1653.html' title='Multiple defined in 2 places.'>Drawable</a> rootw;
<a id='L28635' name='L28635'></a> 28635         <strong class='reserved'>int</strong> <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, y;
<a id='L28636' name='L28636'></a> 28636         <strong class='reserved'>unsigned</strong> <strong class='reserved'>int</strong> width, height, border, depth;
<a id='L28637' name='L28637'></a> 28637 
<a id='L28638' name='L28638'></a> 28638         <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L28639' name='L28639'></a> 28639 
<a id='L28640' name='L28640'></a> 28640         <em class='comment'>/* On some window managers (such as FVWM) moving an existing</em>
<a id='L28641' name='L28641'></a> 28641 <em class='comment'>           window, even to the same place, causes the window manager</em>
<a id='L28642' name='L28642'></a> 28642 <em class='comment'>           to introduce an offset.  This can cause the window to move</em>
<a id='L28643' name='L28643'></a> 28643 <em class='comment'>           to an unexpected location.  Check the geometry (a little</em>
<a id='L28644' name='L28644'></a> 28644 <em class='comment'>           slow here) and then verify that the window is in the right</em>
<a id='L28645' name='L28645'></a> 28645 <em class='comment'>           place.  If the window is not in the right place, move it</em>
<a id='L28646' name='L28646'></a> 28646 <em class='comment'>           there, and take the potential window manager hit.  */</em>
<a id='L28647' name='L28647'></a> 28647         <a href='../S/2321.html#L123' title='Defined at 123 in src/msdos.h.'>XGetGeometry</a> (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L28648' name='L28648'></a> 28648                       &amp;rootw, &amp;<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>, &amp;y, &amp;width, &amp;height, &amp;border, &amp;depth);
<a id='L28649' name='L28649'></a> 28649         output_flushed = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L28650' name='L28650'></a> 28650 
<a id='L28651' name='L28651'></a> 28651         <strong class='reserved'>if</strong> (original_left != <a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> || original_top != y)
<a id='L28652' name='L28652'></a> 28652           XMoveWindow (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L28653' name='L28653'></a> 28653                        original_left, original_top);
<a id='L28654' name='L28654'></a> 28654 
<a id='L28655' name='L28655'></a> 28655         <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L28656' name='L28656'></a> 28656       <em class='brace'>}</em>
<a id='L28657' name='L28657'></a> 28657 
<a id='L28658' name='L28658'></a> 28658     <em class='comment'>/* Try to wait for a MapNotify event (that is what tells us when a</em>
<a id='L28659' name='L28659'></a> 28659 <em class='comment'>       frame becomes visible).  Unless `x-lax-frame-positioning' is</em>
<a id='L28660' name='L28660'></a> 28660 <em class='comment'>       non-nil: there, that is a little slow.  */</em>
<a id='L28661' name='L28661'></a> 28661 
<a id='L28662' name='L28662'></a> 28662 <em class='sharp'>#ifdef</em> CYGWIN
<a id='L28663' name='L28663'></a> 28663     <em class='comment'>/* On Cygwin, which uses input polling, we need to force input to</em>
<a id='L28664' name='L28664'></a> 28664 <em class='comment'>       be read.  See</em>
<a id='L28665' name='L28665'></a> 28665 <em class='comment'>       https://lists.gnu.org/r/emacs-devel/2013-12/msg00351.html</em>
<a id='L28666' name='L28666'></a> 28666 <em class='comment'>       and https://debbugs.gnu.org/cgi/bugreport.cgi?bug=24091#131.</em>
<a id='L28667' name='L28667'></a> 28667 <em class='comment'>       Fake an alarm signal to let the handler know that there's</em>
<a id='L28668' name='L28668'></a> 28668 <em class='comment'>       something to be read.</em>
<a id='L28669' name='L28669'></a> 28669 <em class='comment'></em>
<a id='L28670' name='L28670'></a> 28670 <em class='comment'>       It could be confusing if a real alarm arrives while processing</em>
<a id='L28671' name='L28671'></a> 28671 <em class='comment'>       the fake one.  Turn it off and let the handler reset it.  */</em>
<a id='L28672' name='L28672'></a> 28672     <strong class='reserved'>int</strong> old_poll_suppress_count = poll_suppress_count;
<a id='L28673' name='L28673'></a> 28673     poll_suppress_count = 1;
<a id='L28674' name='L28674'></a> 28674     <a href='../D/15632.html' title='Multiple defined in 2 places.'>poll_for_input_1</a> ();
<a id='L28675' name='L28675'></a> 28675     poll_suppress_count = old_poll_suppress_count;
<a id='L28676' name='L28676'></a> 28676 <em class='sharp'>#endif</em>
<a id='L28677' name='L28677'></a> 28677 
<a id='L28678' name='L28678'></a> 28678     <strong class='reserved'>if</strong> (!<a href='../S/2183.html#L1152' title='Defined at 1152 in src/frame.h.'>FRAME_VISIBLE_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L28679' name='L28679'></a> 28679         &amp;&amp; <a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (Vx_lax_frame_positioning))
<a id='L28680' name='L28680'></a> 28680       <em class='brace'>{</em>
<a id='L28681' name='L28681'></a> 28681         <strong class='reserved'>if</strong> (<a href='../D/1228.html' title='Multiple defined in 2 places.'>CONSP</a> (frame_size_history))
<a id='L28682' name='L28682'></a> 28682           <a href='../S/2247.html#L554' title='Defined at 554 in src/frame.c.'>frame_size_history_plain</a>
<a id='L28683' name='L28683'></a> 28683             (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9420.html' title='Multiple defined in 2 places.'>build_string</a> ("x_make_frame_visible"));
<a id='L28684' name='L28684'></a> 28684 
<a id='L28685' name='L28685'></a> 28685         x_wait_for_event (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, MapNotify);
<a id='L28686' name='L28686'></a> 28686         output_flushed = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L28687' name='L28687'></a> 28687       <em class='brace'>}</em>
<a id='L28688' name='L28688'></a> 28688 
<a id='L28689' name='L28689'></a> 28689     <strong class='reserved'>if</strong> (!output_flushed)
<a id='L28690' name='L28690'></a> 28690       <a href='../S/2289.html#L5056' title='Defined at 5056 in src/xterm.c.'>x_flush</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28691' name='L28691'></a> 28691   <em class='brace'>}</em>
<a id='L28692' name='L28692'></a> 28692 <em class='brace'>}</em>
<a id='L28693' name='L28693'></a> 28693 
<a id='L28694' name='L28694'></a> 28694 <em class='comment'>/* Change from mapped state to withdrawn state.  */</em>
<a id='L28695' name='L28695'></a> 28695 
<a id='L28696' name='L28696'></a> 28696 <em class='comment'>/* Make the frame visible (mapped and not iconified).  */</em>
<a id='L28697' name='L28697'></a> 28697 
<a id='L28698' name='L28698'></a> 28698 <strong class='reserved'>void</strong>
<a id='L28699' name='L28699'></a> 28699 x_make_frame_invisible (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L28700' name='L28700'></a> 28700 <em class='brace'>{</em>
<a id='L28701' name='L28701'></a> 28701   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>;
<a id='L28702' name='L28702'></a> 28702 
<a id='L28703' name='L28703'></a> 28703   <em class='comment'>/* Use the frame's outermost window, not the one we normally draw on.  */</em>
<a id='L28704' name='L28704'></a> 28704   <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28705' name='L28705'></a> 28705 
<a id='L28706' name='L28706'></a> 28706   <em class='comment'>/* Don't keep the highlight on an invisible frame.  */</em>
<a id='L28707' name='L28707'></a> 28707   <strong class='reserved'>if</strong> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;highlight_frame == <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L28708' name='L28708'></a> 28708     <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;highlight_frame = 0;
<a id='L28709' name='L28709'></a> 28709 
<a id='L28710' name='L28710'></a> 28710   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L28711' name='L28711'></a> 28711 
<a id='L28712' name='L28712'></a> 28712 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L171' title='Defined at 171 in src/xterm.h.'>HAVE_XINPUT2_2</a>
<a id='L28713' name='L28713'></a> 28713   <em class='comment'>/* Remove any touch points associated with F.  */</em>
<a id='L28714' name='L28714'></a> 28714   <a href='../S/2289.html#L5791' title='Defined at 5791 in src/xterm.c.'>xi_unlink_touch_points</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28715' name='L28715'></a> 28715 <em class='sharp'>#endif</em>
<a id='L28716' name='L28716'></a> 28716 
<a id='L28717' name='L28717'></a> 28717   <em class='comment'>/* Before unmapping the window, update the WM_SIZE_HINTS property to claim</em>
<a id='L28718' name='L28718'></a> 28718 <em class='comment'>     that the current position of the window is user-specified, rather than</em>
<a id='L28719' name='L28719'></a> 28719 <em class='comment'>     program-specified, so that when the window is mapped again, it will be</em>
<a id='L28720' name='L28720'></a> 28720 <em class='comment'>     placed at the same location, without forcing the user to position it</em>
<a id='L28721' name='L28721'></a> 28721 <em class='comment'>     by hand again (they have already done that once for this window.)  */</em>
<a id='L28722' name='L28722'></a> 28722   x_wm_set_size_hint (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 0, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L28723' name='L28723'></a> 28723 
<a id='L28724' name='L28724'></a> 28724 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L28725' name='L28725'></a> 28725   <strong class='reserved'>if</strong> (<a href='../D/2309.html' title='Multiple defined in 2 places.'>FRAME_GTK_OUTER_WIDGET</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L28726' name='L28726'></a> 28726     gtk_widget_hide (<a href='../D/2309.html' title='Multiple defined in 2 places.'>FRAME_GTK_OUTER_WIDGET</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L28727' name='L28727'></a> 28727   <strong class='reserved'>else</strong>
<a id='L28728' name='L28728'></a> 28728 <em class='sharp'>#else</em>
<a id='L28729' name='L28729'></a> 28729   <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1979' title='Defined at 1979 in src/xterm.h.'>FRAME_X_EMBEDDED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L28730' name='L28730'></a> 28730     xembed_set_info (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 0);
<a id='L28731' name='L28731'></a> 28731   <strong class='reserved'>else</strong>
<a id='L28732' name='L28732'></a> 28732 <em class='sharp'>#endif</em>
<a id='L28733' name='L28733'></a> 28733 
<a id='L28734' name='L28734'></a> 28734     <strong class='reserved'>if</strong> (! XWithdrawWindow (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>,
<a id='L28735' name='L28735'></a> 28735                            DefaultScreen (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))))
<a id='L28736' name='L28736'></a> 28736       <em class='brace'>{</em>
<a id='L28737' name='L28737'></a> 28737         <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L28738' name='L28738'></a> 28738         <a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a> ("Can't notify window manager of window withdrawal");
<a id='L28739' name='L28739'></a> 28739       <em class='brace'>}</em>
<a id='L28740' name='L28740'></a> 28740 
<a id='L28741' name='L28741'></a> 28741   <em class='comment'>/* Don't perform the synchronization if the network connection is</em>
<a id='L28742' name='L28742'></a> 28742 <em class='comment'>     slow, and the user says it is unwanted.  */</em>
<a id='L28743' name='L28743'></a> 28743   <strong class='reserved'>if</strong> (<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (Vx_lax_frame_positioning))
<a id='L28744' name='L28744'></a> 28744     <a href='../D/7378.html' title='Multiple defined in 3 places.'>XSync</a> (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), False);
<a id='L28745' name='L28745'></a> 28745 
<a id='L28746' name='L28746'></a> 28746   <em class='comment'>/* We can't distinguish this from iconification</em>
<a id='L28747' name='L28747'></a> 28747 <em class='comment'>     just by the event that we get from the server.</em>
<a id='L28748' name='L28748'></a> 28748 <em class='comment'>     So we can't win using the usual strategy of letting</em>
<a id='L28749' name='L28749'></a> 28749 <em class='comment'>     FRAME_SAMPLE_VISIBILITY set this.  So do it by hand,</em>
<a id='L28750' name='L28750'></a> 28750 <em class='comment'>     and synchronize with the server to make sure we agree.  */</em>
<a id='L28751' name='L28751'></a> 28751   <a href='../S/2183.html#L1437' title='Defined at 1437 in src/frame.h.'>SET_FRAME_VISIBLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 0);
<a id='L28752' name='L28752'></a> 28752   <a href='../S/2183.html#L1452' title='Defined at 1452 in src/frame.h.'>SET_FRAME_ICONIFIED</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L28753' name='L28753'></a> 28753 
<a id='L28754' name='L28754'></a> 28754   <strong class='reserved'>if</strong> (<a href='../D/1228.html' title='Multiple defined in 2 places.'>CONSP</a> (frame_size_history))
<a id='L28755' name='L28755'></a> 28755     <a href='../S/2247.html#L554' title='Defined at 554 in src/frame.c.'>frame_size_history_plain</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9420.html' title='Multiple defined in 2 places.'>build_string</a> ("x_make_frame_invisible"));
<a id='L28756' name='L28756'></a> 28756 
<a id='L28757' name='L28757'></a> 28757   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L28758' name='L28758'></a> 28758 <em class='brace'>}</em>
<a id='L28759' name='L28759'></a> 28759 
<a id='L28760' name='L28760'></a> 28760 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L28761' name='L28761'></a> 28761 x_make_frame_visible_invisible (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> visible)
<a id='L28762' name='L28762'></a> 28762 <em class='brace'>{</em>
<a id='L28763' name='L28763'></a> 28763   <strong class='reserved'>if</strong> (visible)
<a id='L28764' name='L28764'></a> 28764     x_make_frame_visible (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28765' name='L28765'></a> 28765   <strong class='reserved'>else</strong>
<a id='L28766' name='L28766'></a> 28766     x_make_frame_invisible (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28767' name='L28767'></a> 28767 <em class='brace'>}</em>
<a id='L28768' name='L28768'></a> 28768 
<a id='L28769' name='L28769'></a> 28769 <a href='../D/1354.html' title='Multiple defined in 2 places.'>Cursor</a>
<a id='L28770' name='L28770'></a> 28770 x_create_font_cursor (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo, <strong class='reserved'>int</strong> <a href='../S/2315.html#L454' title='Defined at 454 in src/dispextern.h.'>glyph</a>)
<a id='L28771' name='L28771'></a> 28771 <em class='brace'>{</em>
<a id='L28772' name='L28772'></a> 28772   <strong class='reserved'>if</strong> (<a href='../S/2315.html#L454' title='Defined at 454 in src/dispextern.h.'>glyph</a> &lt;= 65535)
<a id='L28773' name='L28773'></a> 28773     <strong class='reserved'>return</strong> XCreateFontCursor (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../S/2315.html#L454' title='Defined at 454 in src/dispextern.h.'>glyph</a>);
<a id='L28774' name='L28774'></a> 28774 
<a id='L28775' name='L28775'></a> 28775   <em class='comment'>/* x-pointer-invisible cannot fit in CARD16, and thus cannot be any</em>
<a id='L28776' name='L28776'></a> 28776 <em class='comment'>     existing cursor.  */</em>
<a id='L28777' name='L28777'></a> 28777   <strong class='reserved'>return</strong> <a href='../D/14122.html' title='Multiple defined in 2 places.'>make_invisible_cursor</a> (dpyinfo);
<a id='L28778' name='L28778'></a> 28778 <em class='brace'>}</em>
<a id='L28779' name='L28779'></a> 28779 
<a id='L28780' name='L28780'></a> 28780 
<a id='L28781' name='L28781'></a> 28781 <em class='comment'>/* Change window state from mapped to iconified.  */</em>
<a id='L28782' name='L28782'></a> 28782 
<a id='L28783' name='L28783'></a> 28783 <strong class='reserved'>void</strong>
<a id='L28784' name='L28784'></a> 28784 x_iconify_frame (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L28785' name='L28785'></a> 28785 <em class='brace'>{</em>
<a id='L28786' name='L28786'></a> 28786 <em class='sharp'>#ifdef</em> USE_X_TOOLKIT
<a id='L28787' name='L28787'></a> 28787   <strong class='reserved'>int</strong> result;
<a id='L28788' name='L28788'></a> 28788 <em class='sharp'>#endif</em>
<a id='L28789' name='L28789'></a> 28789 
<a id='L28790' name='L28790'></a> 28790   <em class='comment'>/* Don't keep the highlight on an invisible frame.  */</em>
<a id='L28791' name='L28791'></a> 28791   <strong class='reserved'>if</strong> (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;highlight_frame == <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L28792' name='L28792'></a> 28792     <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;highlight_frame = 0;
<a id='L28793' name='L28793'></a> 28793 
<a id='L28794' name='L28794'></a> 28794   <strong class='reserved'>if</strong> (<a href='../S/2183.html#L1172' title='Defined at 1172 in src/frame.h.'>FRAME_ICONIFIED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L28795' name='L28795'></a> 28795     <strong class='reserved'>return</strong>;
<a id='L28796' name='L28796'></a> 28796 
<a id='L28797' name='L28797'></a> 28797   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L28798' name='L28798'></a> 28798 
<a id='L28799' name='L28799'></a> 28799   <a href='../S/2183.html#L1883' title='Defined at 1883 in src/frame.h.'>gui_set_bitmap_icon</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28800' name='L28800'></a> 28800 
<a id='L28801' name='L28801'></a> 28801 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> (USE_GTK)
<a id='L28802' name='L28802'></a> 28802   <strong class='reserved'>if</strong> (<a href='../D/2309.html' title='Multiple defined in 2 places.'>FRAME_GTK_OUTER_WIDGET</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L28803' name='L28803'></a> 28803     <em class='brace'>{</em>
<a id='L28804' name='L28804'></a> 28804       <strong class='reserved'>if</strong> (! <a href='../S/2183.html#L1152' title='Defined at 1152 in src/frame.h.'>FRAME_VISIBLE_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L28805' name='L28805'></a> 28805         gtk_widget_show_all (<a href='../D/2309.html' title='Multiple defined in 2 places.'>FRAME_GTK_OUTER_WIDGET</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L28806' name='L28806'></a> 28806 
<a id='L28807' name='L28807'></a> 28807       gtk_window_iconify (GTK_WINDOW (<a href='../D/2309.html' title='Multiple defined in 2 places.'>FRAME_GTK_OUTER_WIDGET</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)));
<a id='L28808' name='L28808'></a> 28808       <a href='../S/2183.html#L1437' title='Defined at 1437 in src/frame.h.'>SET_FRAME_VISIBLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 0);
<a id='L28809' name='L28809'></a> 28809       <a href='../S/2183.html#L1452' title='Defined at 1452 in src/frame.h.'>SET_FRAME_ICONIFIED</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L28810' name='L28810'></a> 28810       <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L28811' name='L28811'></a> 28811       <strong class='reserved'>return</strong>;
<a id='L28812' name='L28812'></a> 28812     <em class='brace'>}</em>
<a id='L28813' name='L28813'></a> 28813 <em class='sharp'>#endif</em>
<a id='L28814' name='L28814'></a> 28814 
<a id='L28815' name='L28815'></a> 28815 <em class='sharp'>#ifdef</em> USE_X_TOOLKIT
<a id='L28816' name='L28816'></a> 28816 
<a id='L28817' name='L28817'></a> 28817   <strong class='reserved'>if</strong> (! <a href='../S/2183.html#L1152' title='Defined at 1152 in src/frame.h.'>FRAME_VISIBLE_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L28818' name='L28818'></a> 28818     <em class='brace'>{</em>
<a id='L28819' name='L28819'></a> 28819       <strong class='reserved'>if</strong> (! <a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (Vx_no_window_manager, Qt))
<a id='L28820' name='L28820'></a> 28820         x_wm_set_window_state (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, IconicState);
<a id='L28821' name='L28821'></a> 28821       <em class='comment'>/* This was XtPopup, but that did nothing for an iconified frame.  */</em>
<a id='L28822' name='L28822'></a> 28822       XtMapWidget (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;widget);
<a id='L28823' name='L28823'></a> 28823       <em class='comment'>/* The server won't give us any event to indicate</em>
<a id='L28824' name='L28824'></a> 28824 <em class='comment'>         that an invisible frame was changed to an icon,</em>
<a id='L28825' name='L28825'></a> 28825 <em class='comment'>         so we have to record it here.  */</em>
<a id='L28826' name='L28826'></a> 28826       <a href='../S/2183.html#L1437' title='Defined at 1437 in src/frame.h.'>SET_FRAME_VISIBLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 0);
<a id='L28827' name='L28827'></a> 28827       <a href='../S/2183.html#L1452' title='Defined at 1452 in src/frame.h.'>SET_FRAME_ICONIFIED</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L28828' name='L28828'></a> 28828       <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L28829' name='L28829'></a> 28829       <strong class='reserved'>return</strong>;
<a id='L28830' name='L28830'></a> 28830     <em class='brace'>}</em>
<a id='L28831' name='L28831'></a> 28831 
<a id='L28832' name='L28832'></a> 28832   result = XIconifyWindow (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L28833' name='L28833'></a> 28833                            XtWindow (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;widget),
<a id='L28834' name='L28834'></a> 28834                            DefaultScreen (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)));
<a id='L28835' name='L28835'></a> 28835   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L28836' name='L28836'></a> 28836 
<a id='L28837' name='L28837'></a> 28837   <strong class='reserved'>if</strong> (!result)
<a id='L28838' name='L28838'></a> 28838     <a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a> ("Can't notify window manager of iconification");
<a id='L28839' name='L28839'></a> 28839 
<a id='L28840' name='L28840'></a> 28840   <a href='../S/2183.html#L1452' title='Defined at 1452 in src/frame.h.'>SET_FRAME_ICONIFIED</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L28841' name='L28841'></a> 28841   <a href='../S/2183.html#L1437' title='Defined at 1437 in src/frame.h.'>SET_FRAME_VISIBLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 0);
<a id='L28842' name='L28842'></a> 28842 
<a id='L28843' name='L28843'></a> 28843   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L28844' name='L28844'></a> 28844   XFlush (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L28845' name='L28845'></a> 28845   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L28846' name='L28846'></a> 28846 <em class='sharp'>#else</em> <em class='comment'>/* not USE_X_TOOLKIT */</em>
<a id='L28847' name='L28847'></a> 28847 
<a id='L28848' name='L28848'></a> 28848   <em class='comment'>/* Make sure the X server knows where the window should be positioned,</em>
<a id='L28849' name='L28849'></a> 28849 <em class='comment'>     in case the user deiconifies with the window manager.  */</em>
<a id='L28850' name='L28850'></a> 28850   <strong class='reserved'>if</strong> (! <a href='../S/2183.html#L1152' title='Defined at 1152 in src/frame.h.'>FRAME_VISIBLE_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L28851' name='L28851'></a> 28851       &amp;&amp; ! <a href='../S/2183.html#L1172' title='Defined at 1172 in src/frame.h.'>FRAME_ICONIFIED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L28852' name='L28852'></a> 28852       &amp;&amp; ! <a href='../S/2212.html#L1979' title='Defined at 1979 in src/xterm.h.'>FRAME_X_EMBEDDED_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L28853' name='L28853'></a> 28853     x_set_offset (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;left_pos, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;top_pos, 0);
<a id='L28854' name='L28854'></a> 28854 
<a id='L28855' name='L28855'></a> 28855   <em class='comment'>/* Since we don't know which revision of X we're running, we'll use both</em>
<a id='L28856' name='L28856'></a> 28856 <em class='comment'>     the X11R3 and X11R4 techniques.  I don't know if this is a good idea.  */</em>
<a id='L28857' name='L28857'></a> 28857 
<a id='L28858' name='L28858'></a> 28858   <em class='comment'>/* X11R4: send a ClientMessage to the window manager using the</em>
<a id='L28859' name='L28859'></a> 28859 <em class='comment'>     WM_CHANGE_STATE type.  */</em>
<a id='L28860' name='L28860'></a> 28860   <em class='brace'>{</em>
<a id='L28861' name='L28861'></a> 28861     XEvent msg;
<a id='L28862' name='L28862'></a> 28862 
<a id='L28863' name='L28863'></a> 28863     msg.xclient.<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28864' name='L28864'></a> 28864     msg.xclient.type = ClientMessage;
<a id='L28865' name='L28865'></a> 28865     msg.xclient.message_type = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;Xatom_wm_change_state;
<a id='L28866' name='L28866'></a> 28866     msg.xclient.format = 32;
<a id='L28867' name='L28867'></a> 28867     msg.xclient.data.l[0] = IconicState;
<a id='L28868' name='L28868'></a> 28868     msg.xclient.data.l[1] = 0;
<a id='L28869' name='L28869'></a> 28869     msg.xclient.data.l[2] = 0;
<a id='L28870' name='L28870'></a> 28870     msg.xclient.data.l[3] = 0;
<a id='L28871' name='L28871'></a> 28871     msg.xclient.data.l[4] = 0;
<a id='L28872' name='L28872'></a> 28872 
<a id='L28873' name='L28873'></a> 28873     <strong class='reserved'>if</strong> (! XSendEvent (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L28874' name='L28874'></a> 28874                       <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;root_window,
<a id='L28875' name='L28875'></a> 28875                       False,
<a id='L28876' name='L28876'></a> 28876                       SubstructureRedirectMask | SubstructureNotifyMask,
<a id='L28877' name='L28877'></a> 28877                       &amp;msg))
<a id='L28878' name='L28878'></a> 28878       <em class='brace'>{</em>
<a id='L28879' name='L28879'></a> 28879         <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L28880' name='L28880'></a> 28880         <a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a> ("Can't notify window manager of iconification");
<a id='L28881' name='L28881'></a> 28881       <em class='brace'>}</em>
<a id='L28882' name='L28882'></a> 28882   <em class='brace'>}</em>
<a id='L28883' name='L28883'></a> 28883 
<a id='L28884' name='L28884'></a> 28884   <em class='comment'>/* X11R3: set the initial_state field of the window manager hints to</em>
<a id='L28885' name='L28885'></a> 28885 <em class='comment'>     IconicState.  */</em>
<a id='L28886' name='L28886'></a> 28886   x_wm_set_window_state (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, IconicState);
<a id='L28887' name='L28887'></a> 28887 
<a id='L28888' name='L28888'></a> 28888   <strong class='reserved'>if</strong> (!<a href='../S/2183.html#L1152' title='Defined at 1152 in src/frame.h.'>FRAME_VISIBLE_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L28889' name='L28889'></a> 28889     <em class='brace'>{</em>
<a id='L28890' name='L28890'></a> 28890       <em class='comment'>/* If the frame was withdrawn, before, we must map it.  */</em>
<a id='L28891' name='L28891'></a> 28891       XMapRaised (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L28892' name='L28892'></a> 28892     <em class='brace'>}</em>
<a id='L28893' name='L28893'></a> 28893 
<a id='L28894' name='L28894'></a> 28894   <a href='../S/2183.html#L1452' title='Defined at 1452 in src/frame.h.'>SET_FRAME_ICONIFIED</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L28895' name='L28895'></a> 28895   <a href='../S/2183.html#L1437' title='Defined at 1437 in src/frame.h.'>SET_FRAME_VISIBLE</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 0);
<a id='L28896' name='L28896'></a> 28896 
<a id='L28897' name='L28897'></a> 28897   XFlush (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L28898' name='L28898'></a> 28898   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L28899' name='L28899'></a> 28899 <em class='sharp'>#endif</em> <em class='comment'>/* not USE_X_TOOLKIT */</em>
<a id='L28900' name='L28900'></a> 28900 <em class='brace'>}</em>
<a id='L28901' name='L28901'></a> 28901 
<a id='L28902' name='L28902'></a> 28902 
<a id='L28903' name='L28903'></a> 28903 <em class='comment'>/* Free X resources of frame F.  */</em>
<a id='L28904' name='L28904'></a> 28904 
<a id='L28905' name='L28905'></a> 28905 <strong class='reserved'>void</strong>
<a id='L28906' name='L28906'></a> 28906 x_free_frame_resources (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L28907' name='L28907'></a> 28907 <em class='brace'>{</em>
<a id='L28908' name='L28908'></a> 28908   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28909' name='L28909'></a> 28909   <a href='../S/2315.html#L2919' title='Defined at 2919 in src/dispextern.h.'>Mouse_HLInfo</a> *hlinfo = &amp;dpyinfo-&gt;mouse_highlight;
<a id='L28910' name='L28910'></a> 28910 <em class='sharp'>#ifdef</em> USE_X_TOOLKIT
<a id='L28911' name='L28911'></a> 28911   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>;
<a id='L28912' name='L28912'></a> 28912   <strong class='reserved'>struct</strong> <a href='../D/16642.html' title='Multiple defined in 5 places.'>scroll_bar</a> *<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>;
<a id='L28913' name='L28913'></a> 28913 <em class='sharp'>#endif</em>
<a id='L28914' name='L28914'></a> 28914 
<a id='L28915' name='L28915'></a> 28915   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L28916' name='L28916'></a> 28916 
<a id='L28917' name='L28917'></a> 28917 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L28918' name='L28918'></a> 28918   <em class='comment'>/* Remove any record of this frame being focused.  */</em>
<a id='L28919' name='L28919'></a> 28919   xi_handle_delete_frame (dpyinfo, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28920' name='L28920'></a> 28920 <em class='sharp'>#endif</em>
<a id='L28921' name='L28921'></a> 28921 
<a id='L28922' name='L28922'></a> 28922 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L171' title='Defined at 171 in src/xterm.h.'>HAVE_XINPUT2_2</a>
<a id='L28923' name='L28923'></a> 28923   <em class='comment'>/* Remove any touch points associated with F.  */</em>
<a id='L28924' name='L28924'></a> 28924   <a href='../S/2289.html#L5791' title='Defined at 5791 in src/xterm.c.'>xi_unlink_touch_points</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28925' name='L28925'></a> 28925 <em class='sharp'>#endif</em>
<a id='L28926' name='L28926'></a> 28926 
<a id='L28927' name='L28927'></a> 28927   <em class='comment'>/* If a display connection is dead, don't try sending more</em>
<a id='L28928' name='L28928'></a> 28928 <em class='comment'>     commands to the X server.  */</em>
<a id='L28929' name='L28929'></a> 28929   <strong class='reserved'>if</strong> (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>)
<a id='L28930' name='L28930'></a> 28930     <em class='brace'>{</em>
<a id='L28931' name='L28931'></a> 28931       <em class='comment'>/* Always exit with visible pointer to avoid weird issue</em>
<a id='L28932' name='L28932'></a> 28932 <em class='comment'>         with Xfixes (Bug#17609).  */</em>
<a id='L28933' name='L28933'></a> 28933       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;pointer_invisible)
<a id='L28934' name='L28934'></a> 28934         <a href='../S/2289.html#L11867' title='Defined at 11867 in src/xterm.c.'>XTtoggle_invisible_pointer</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 0);
<a id='L28935' name='L28935'></a> 28935 
<a id='L28936' name='L28936'></a> 28936       <em class='comment'>/* We must free faces before destroying windows because some</em>
<a id='L28937' name='L28937'></a> 28937 <em class='comment'>         font-driver (e.g. xft) access a window while finishing a</em>
<a id='L28938' name='L28938'></a> 28938 <em class='comment'>         face.  */</em>
<a id='L28939' name='L28939'></a> 28939       <a href='../S/2239.html#L683' title='Defined at 683 in src/xfaces.c.'>free_frame_faces</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28940' name='L28940'></a> 28940       <a href='../S/2296.html#L3979' title='Defined at 3979 in src/xfns.c.'>tear_down_x_back_buffer</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28941' name='L28941'></a> 28941 
<a id='L28942' name='L28942'></a> 28942       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;icon_desc)
<a id='L28943' name='L28943'></a> 28943         XDestroyWindow (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;icon_desc);
<a id='L28944' name='L28944'></a> 28944 
<a id='L28945' name='L28945'></a> 28945 <em class='sharp'>#ifdef</em> USE_X_TOOLKIT
<a id='L28946' name='L28946'></a> 28946       <em class='comment'>/* Explicitly destroy the scroll bars of the frame.  Without</em>
<a id='L28947' name='L28947'></a> 28947 <em class='comment'>         this, we get "BadDrawable" errors from the toolkit later on,</em>
<a id='L28948' name='L28948'></a> 28948 <em class='comment'>         presumably from expose events generated for the disappearing</em>
<a id='L28949' name='L28949'></a> 28949 <em class='comment'>         toolkit scroll bars.  */</em>
<a id='L28950' name='L28950'></a> 28950       <strong class='reserved'>for</strong> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> = <a href='../S/2183.html#L1365' title='Defined at 1365 in src/frame.h.'>FRAME_SCROLL_BARS</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>); !<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>); <a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a> = <a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>-&gt;next)
<a id='L28951' name='L28951'></a> 28951         <em class='brace'>{</em>
<a id='L28952' name='L28952'></a> 28952           <a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a> = <a href='../D/7329.html' title='Multiple defined in 5 places.'>XSCROLL_BAR</a> (<a href='../D/9041.html' title='Multiple defined in 7 places.'>bar</a>);
<a id='L28953' name='L28953'></a> 28953           x_scroll_bar_remove (<a href='../D/9017.html' title='Multiple defined in 8 places.'>b</a>);
<a id='L28954' name='L28954'></a> 28954         <em class='brace'>}</em>
<a id='L28955' name='L28955'></a> 28955 <em class='sharp'>#endif</em>
<a id='L28956' name='L28956'></a> 28956 
<a id='L28957' name='L28957'></a> 28957 <em class='sharp'>#ifdef</em> HAVE_X_I18N
<a id='L28958' name='L28958'></a> 28958       <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1470' title='Defined at 1470 in src/xterm.h.'>FRAME_XIC</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L28959' name='L28959'></a> 28959         <a href='../S/2296.html#L3202' title='Defined at 3202 in src/xfns.c.'>free_frame_xic</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28960' name='L28960'></a> 28960 <em class='sharp'>#endif</em>
<a id='L28961' name='L28961'></a> 28961 
<a id='L28962' name='L28962'></a> 28962 <em class='sharp'>#ifdef</em> USE_CAIRO
<a id='L28963' name='L28963'></a> 28963       <a href='../S/2289.html#L5867' title='Defined at 5867 in src/xterm.c.'>x_cr_destroy_frame_context</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28964' name='L28964'></a> 28964 <em class='sharp'>#endif</em>
<a id='L28965' name='L28965'></a> 28965 <em class='sharp'>#ifdef</em> USE_X_TOOLKIT
<a id='L28966' name='L28966'></a> 28966       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;widget)
<a id='L28967' name='L28967'></a> 28967         <em class='brace'>{</em>
<a id='L28968' name='L28968'></a> 28968           XtDestroyWidget (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;widget);
<a id='L28969' name='L28969'></a> 28969           <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;widget = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L28970' name='L28970'></a> 28970         <em class='brace'>}</em>
<a id='L28971' name='L28971'></a> 28971       <em class='comment'>/* Tooltips don't have widgets, only a simple X window, even if</em>
<a id='L28972' name='L28972'></a> 28972 <em class='comment'>         we are using a toolkit.  */</em>
<a id='L28973' name='L28973'></a> 28973       <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (<a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L28974' name='L28974'></a> 28974         XDestroyWindow (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L28975' name='L28975'></a> 28975 
<a id='L28976' name='L28976'></a> 28976       <a href='../D/11739.html' title='Multiple defined in 4 places.'>free_frame_menubar</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28977' name='L28977'></a> 28977 
<a id='L28978' name='L28978'></a> 28978       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;shell_position)
<a id='L28979' name='L28979'></a> 28979         <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;shell_position);
<a id='L28980' name='L28980'></a> 28980 <em class='sharp'>#else</em>  <em class='comment'>/* !USE_X_TOOLKIT */</em>
<a id='L28981' name='L28981'></a> 28981 
<a id='L28982' name='L28982'></a> 28982 <em class='sharp'>#ifdef</em> HAVE_XWIDGETS
<a id='L28983' name='L28983'></a> 28983       <a href='../S/2334.html#L4199' title='Defined at 4199 in src/xwidget.c.'>kill_frame_xwidget_views</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28984' name='L28984'></a> 28984 <em class='sharp'>#endif</em>
<a id='L28985' name='L28985'></a> 28985 
<a id='L28986' name='L28986'></a> 28986 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L28987' name='L28987'></a> 28987       <a href='../S/2362.html#L1877' title='Defined at 1877 in src/gtkutil.c.'>xg_free_frame_widgets</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28988' name='L28988'></a> 28988 <em class='sharp'>#endif</em> <em class='comment'>/* USE_GTK */</em>
<a id='L28989' name='L28989'></a> 28989 
<a id='L28990' name='L28990'></a> 28990       <a href='../S/2296.html#L3979' title='Defined at 3979 in src/xfns.c.'>tear_down_x_back_buffer</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L28991' name='L28991'></a> 28991       <strong class='reserved'>if</strong> (<a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L28992' name='L28992'></a> 28992         XDestroyWindow (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L28993' name='L28993'></a> 28993 <em class='sharp'>#endif</em> <em class='comment'>/* !USE_X_TOOLKIT */</em>
<a id='L28994' name='L28994'></a> 28994 
<a id='L28995' name='L28995'></a> 28995 <em class='sharp'>#ifdef</em> HAVE_XSYNC
<a id='L28996' name='L28996'></a> 28996       <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1455' title='Defined at 1455 in src/xterm.h.'>FRAME_X_BASIC_COUNTER</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) != None)
<a id='L28997' name='L28997'></a> 28997         XSyncDestroyCounter (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L28998' name='L28998'></a> 28998                              <a href='../S/2212.html#L1455' title='Defined at 1455 in src/xterm.h.'>FRAME_X_BASIC_COUNTER</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L28999' name='L28999'></a> 28999 
<a id='L29000' name='L29000'></a> 29000       <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1457' title='Defined at 1457 in src/xterm.h.'>FRAME_X_EXTENDED_COUNTER</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) != None)
<a id='L29001' name='L29001'></a> 29001         XSyncDestroyCounter (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L29002' name='L29002'></a> 29002                              <a href='../S/2212.html#L1457' title='Defined at 1457 in src/xterm.h.'>FRAME_X_EXTENDED_COUNTER</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L29003' name='L29003'></a> 29003 <em class='sharp'>#endif</em>
<a id='L29004' name='L29004'></a> 29004 
<a id='L29005' name='L29005'></a> 29005       <a href='../S/2239.html#L1397' title='Defined at 1397 in src/xfaces.c.'>unload_color</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/2183.html#L1376' title='Defined at 1376 in src/frame.h.'>FRAME_FOREGROUND_PIXEL</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L29006' name='L29006'></a> 29006       <a href='../S/2239.html#L1397' title='Defined at 1397 in src/xfaces.c.'>unload_color</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/2183.html#L1377' title='Defined at 1377 in src/frame.h.'>FRAME_BACKGROUND_PIXEL</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L29007' name='L29007'></a> 29007       <a href='../S/2239.html#L1397' title='Defined at 1397 in src/xfaces.c.'>unload_color</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;cursor_pixel);
<a id='L29008' name='L29008'></a> 29008       <a href='../S/2239.html#L1397' title='Defined at 1397 in src/xfaces.c.'>unload_color</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;cursor_foreground_pixel);
<a id='L29009' name='L29009'></a> 29009       <a href='../S/2239.html#L1397' title='Defined at 1397 in src/xfaces.c.'>unload_color</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;border_pixel);
<a id='L29010' name='L29010'></a> 29010       <a href='../S/2239.html#L1397' title='Defined at 1397 in src/xfaces.c.'>unload_color</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;mouse_pixel);
<a id='L29011' name='L29011'></a> 29011 
<a id='L29012' name='L29012'></a> 29012       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_background_pixel != -1)
<a id='L29013' name='L29013'></a> 29013         <a href='../S/2239.html#L1397' title='Defined at 1397 in src/xfaces.c.'>unload_color</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_background_pixel);
<a id='L29014' name='L29014'></a> 29014       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_foreground_pixel != -1)
<a id='L29015' name='L29015'></a> 29015         <a href='../S/2239.html#L1397' title='Defined at 1397 in src/xfaces.c.'>unload_color</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_foreground_pixel);
<a id='L29016' name='L29016'></a> 29016 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> (USE_LUCID) &amp;&amp; <strong class='reserved'>defined</strong> (USE_TOOLKIT_SCROLL_BARS)
<a id='L29017' name='L29017'></a> 29017       <em class='comment'>/* Scrollbar shadow colors.  */</em>
<a id='L29018' name='L29018'></a> 29018       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_top_shadow_pixel != -1)
<a id='L29019' name='L29019'></a> 29019         <a href='../S/2239.html#L1397' title='Defined at 1397 in src/xfaces.c.'>unload_color</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_top_shadow_pixel);
<a id='L29020' name='L29020'></a> 29020       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_bottom_shadow_pixel != -1)
<a id='L29021' name='L29021'></a> 29021         <a href='../S/2239.html#L1397' title='Defined at 1397 in src/xfaces.c.'>unload_color</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;scroll_bar_bottom_shadow_pixel);
<a id='L29022' name='L29022'></a> 29022 <em class='sharp'>#endif</em> <em class='comment'>/* USE_LUCID &amp;&amp; USE_TOOLKIT_SCROLL_BARS */</em>
<a id='L29023' name='L29023'></a> 29023       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;white_relief.pixel != -1)
<a id='L29024' name='L29024'></a> 29024         <a href='../S/2239.html#L1397' title='Defined at 1397 in src/xfaces.c.'>unload_color</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;white_relief.pixel);
<a id='L29025' name='L29025'></a> 29025       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;black_relief.pixel != -1)
<a id='L29026' name='L29026'></a> 29026         <a href='../S/2239.html#L1397' title='Defined at 1397 in src/xfaces.c.'>unload_color</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;black_relief.pixel);
<a id='L29027' name='L29027'></a> 29027 
<a id='L29028' name='L29028'></a> 29028       <a href='../S/2296.html#L4678' title='Defined at 4678 in src/xfns.c.'>x_free_gcs</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L29029' name='L29029'></a> 29029 
<a id='L29030' name='L29030'></a> 29030       <em class='comment'>/* Free extra GCs allocated by x_setup_relief_colors.  */</em>
<a id='L29031' name='L29031'></a> 29031       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;white_relief.gc)
<a id='L29032' name='L29032'></a> 29032         <em class='brace'>{</em>
<a id='L29033' name='L29033'></a> 29033           <a href='../S/2321.html#L121' title='Defined at 121 in src/msdos.h.'>XFreeGC</a> (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;white_relief.gc);
<a id='L29034' name='L29034'></a> 29034           <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;white_relief.gc = 0;
<a id='L29035' name='L29035'></a> 29035         <em class='brace'>}</em>
<a id='L29036' name='L29036'></a> 29036       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;black_relief.gc)
<a id='L29037' name='L29037'></a> 29037         <em class='brace'>{</em>
<a id='L29038' name='L29038'></a> 29038           <a href='../S/2321.html#L121' title='Defined at 121 in src/msdos.h.'>XFreeGC</a> (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;black_relief.gc);
<a id='L29039' name='L29039'></a> 29039           <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;black_relief.gc = 0;
<a id='L29040' name='L29040'></a> 29040         <em class='brace'>}</em>
<a id='L29041' name='L29041'></a> 29041 
<a id='L29042' name='L29042'></a> 29042       <em class='comment'>/* Free cursors.  */</em>
<a id='L29043' name='L29043'></a> 29043       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;text_cursor != 0)
<a id='L29044' name='L29044'></a> 29044         XFreeCursor (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;text_cursor);
<a id='L29045' name='L29045'></a> 29045       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;nontext_cursor != 0)
<a id='L29046' name='L29046'></a> 29046         XFreeCursor (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;nontext_cursor);
<a id='L29047' name='L29047'></a> 29047       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;modeline_cursor != 0)
<a id='L29048' name='L29048'></a> 29048         XFreeCursor (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;modeline_cursor);
<a id='L29049' name='L29049'></a> 29049       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;hand_cursor != 0)
<a id='L29050' name='L29050'></a> 29050         XFreeCursor (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;hand_cursor);
<a id='L29051' name='L29051'></a> 29051       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;hourglass_cursor != 0)
<a id='L29052' name='L29052'></a> 29052         XFreeCursor (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;hourglass_cursor);
<a id='L29053' name='L29053'></a> 29053       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;horizontal_drag_cursor != 0)
<a id='L29054' name='L29054'></a> 29054         XFreeCursor (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;horizontal_drag_cursor);
<a id='L29055' name='L29055'></a> 29055       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;vertical_drag_cursor != 0)
<a id='L29056' name='L29056'></a> 29056         XFreeCursor (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;vertical_drag_cursor);
<a id='L29057' name='L29057'></a> 29057       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;left_edge_cursor != 0)
<a id='L29058' name='L29058'></a> 29058         XFreeCursor (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;left_edge_cursor);
<a id='L29059' name='L29059'></a> 29059       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;top_left_corner_cursor != 0)
<a id='L29060' name='L29060'></a> 29060         XFreeCursor (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;top_left_corner_cursor);
<a id='L29061' name='L29061'></a> 29061       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;top_edge_cursor != 0)
<a id='L29062' name='L29062'></a> 29062         XFreeCursor (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;top_edge_cursor);
<a id='L29063' name='L29063'></a> 29063       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;top_right_corner_cursor != 0)
<a id='L29064' name='L29064'></a> 29064         XFreeCursor (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;top_right_corner_cursor);
<a id='L29065' name='L29065'></a> 29065       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;right_edge_cursor != 0)
<a id='L29066' name='L29066'></a> 29066         XFreeCursor (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;right_edge_cursor);
<a id='L29067' name='L29067'></a> 29067       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;bottom_right_corner_cursor != 0)
<a id='L29068' name='L29068'></a> 29068         XFreeCursor (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;bottom_right_corner_cursor);
<a id='L29069' name='L29069'></a> 29069       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;bottom_edge_cursor != 0)
<a id='L29070' name='L29070'></a> 29070         XFreeCursor (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;bottom_edge_cursor);
<a id='L29071' name='L29071'></a> 29071       <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;bottom_left_corner_cursor != 0)
<a id='L29072' name='L29072'></a> 29072         XFreeCursor (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;bottom_left_corner_cursor);
<a id='L29073' name='L29073'></a> 29073 
<a id='L29074' name='L29074'></a> 29074       <em class='comment'>/* Free sync fences.  */</em>
<a id='L29075' name='L29075'></a> 29075 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XSYNCTRIGGERFENCE &amp;&amp; !<strong class='reserved'>defined</strong> USE_GTK &amp;&amp; <strong class='reserved'>defined</strong> HAVE_CLOCK_GETTIME
<a id='L29076' name='L29076'></a> 29076       <a href='../S/2289.html#L7199' title='Defined at 7199 in src/xterm.c.'>x_sync_free_fences</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L29077' name='L29077'></a> 29077 <em class='sharp'>#endif</em>
<a id='L29078' name='L29078'></a> 29078 
<a id='L29079' name='L29079'></a> 29079 <em class='sharp'>#ifdef</em> USE_TOOLKIT_SCROLL_BARS
<a id='L29080' name='L29080'></a> 29080       <em class='comment'>/* Since the frame was destroyed, we can no longer guarantee</em>
<a id='L29081' name='L29081'></a> 29081 <em class='comment'>         that scroll bar events will be received.  Clear</em>
<a id='L29082' name='L29082'></a> 29082 <em class='comment'>         protected_windows.  */</em>
<a id='L29083' name='L29083'></a> 29083       dpyinfo-&gt;n_protected_windows = 0;
<a id='L29084' name='L29084'></a> 29084 <em class='sharp'>#endif</em>
<a id='L29085' name='L29085'></a> 29085     <em class='brace'>}</em>
<a id='L29086' name='L29086'></a> 29086 
<a id='L29087' name='L29087'></a> 29087 <em class='sharp'>#ifdef</em> HAVE_GTK3
<a id='L29088' name='L29088'></a> 29088   <strong class='reserved'>if</strong> (<a href='../D/2368.html' title='Multiple defined in 7 places.'>FRAME_OUTPUT_DATA</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;scrollbar_background_css_provider)
<a id='L29089' name='L29089'></a> 29089     <a href='../D/11946.html' title='Multiple defined in 2 places.'>g_object_unref</a> (<a href='../D/2368.html' title='Multiple defined in 7 places.'>FRAME_OUTPUT_DATA</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;scrollbar_background_css_provider);
<a id='L29090' name='L29090'></a> 29090 
<a id='L29091' name='L29091'></a> 29091   <strong class='reserved'>if</strong> (<a href='../D/2368.html' title='Multiple defined in 7 places.'>FRAME_OUTPUT_DATA</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;scrollbar_foreground_css_provider)
<a id='L29092' name='L29092'></a> 29092     <a href='../D/11946.html' title='Multiple defined in 2 places.'>g_object_unref</a> (<a href='../D/2368.html' title='Multiple defined in 7 places.'>FRAME_OUTPUT_DATA</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;scrollbar_foreground_css_provider);
<a id='L29093' name='L29093'></a> 29093 <em class='sharp'>#endif</em>
<a id='L29094' name='L29094'></a> 29094 
<a id='L29095' name='L29095'></a> 29095   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> == dpyinfo-&gt;motif_drag_atom_owner)
<a id='L29096' name='L29096'></a> 29096     <em class='brace'>{</em>
<a id='L29097' name='L29097'></a> 29097       dpyinfo-&gt;motif_drag_atom_owner = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L29098' name='L29098'></a> 29098       dpyinfo-&gt;motif_drag_atom = None;
<a id='L29099' name='L29099'></a> 29099     <em class='brace'>}</em>
<a id='L29100' name='L29100'></a> 29100 
<a id='L29101' name='L29101'></a> 29101   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> == dpyinfo-&gt;x_focus_frame)
<a id='L29102' name='L29102'></a> 29102     dpyinfo-&gt;x_focus_frame = 0;
<a id='L29103' name='L29103'></a> 29103   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> == dpyinfo-&gt;x_focus_event_frame)
<a id='L29104' name='L29104'></a> 29104     dpyinfo-&gt;x_focus_event_frame = 0;
<a id='L29105' name='L29105'></a> 29105   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> == dpyinfo-&gt;highlight_frame)
<a id='L29106' name='L29106'></a> 29106     dpyinfo-&gt;highlight_frame = 0;
<a id='L29107' name='L29107'></a> 29107   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> == hlinfo-&gt;mouse_face_mouse_frame)
<a id='L29108' name='L29108'></a> 29108     <a href='../S/2315.html#L2922' title='Defined at 2922 in src/dispextern.h.'>reset_mouse_highlight</a> (hlinfo);
<a id='L29109' name='L29109'></a> 29109 
<a id='L29110' name='L29110'></a> 29110   <em class='comment'>/* These two need to be freed now that they are used to compute the</em>
<a id='L29111' name='L29111'></a> 29111 <em class='comment'>     mouse position, I think.  */</em>
<a id='L29112' name='L29112'></a> 29112   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> == dpyinfo-&gt;last_mouse_motion_frame)
<a id='L29113' name='L29113'></a> 29113     dpyinfo-&gt;last_mouse_motion_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L29114' name='L29114'></a> 29114   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> == dpyinfo-&gt;last_mouse_frame)
<a id='L29115' name='L29115'></a> 29115     dpyinfo-&gt;last_mouse_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L29116' name='L29116'></a> 29116 
<a id='L29117' name='L29117'></a> 29117 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L29118' name='L29118'></a> 29118   <em class='comment'>/* Consider a frame being unfocused with no following FocusIn event</em>
<a id='L29119' name='L29119'></a> 29119 <em class='comment'>     while an older focus from another seat exists.  The client</em>
<a id='L29120' name='L29120'></a> 29120 <em class='comment'>     pointer should then revert to the other seat, so handle potential</em>
<a id='L29121' name='L29121'></a> 29121 <em class='comment'>     focus changes.  */</em>
<a id='L29122' name='L29122'></a> 29122 
<a id='L29123' name='L29123'></a> 29123   <strong class='reserved'>if</strong> (dpyinfo-&gt;supports_xi2)
<a id='L29124' name='L29124'></a> 29124     xi_handle_focus_change (dpyinfo);
<a id='L29125' name='L29125'></a> 29125 <em class='sharp'>#endif</em>
<a id='L29126' name='L29126'></a> 29126 
<a id='L29127' name='L29127'></a> 29127   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L29128' name='L29128'></a> 29128 <em class='brace'>}</em>
<a id='L29129' name='L29129'></a> 29129 
<a id='L29130' name='L29130'></a> 29130 
<a id='L29131' name='L29131'></a> 29131 <em class='comment'>/* Destroy the X window of frame F.  */</em>
<a id='L29132' name='L29132'></a> 29132 
<a id='L29133' name='L29133'></a> 29133 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L29134' name='L29134'></a> 29134 x_destroy_window (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L29135' name='L29135'></a> 29135 <em class='brace'>{</em>
<a id='L29136' name='L29136'></a> 29136   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo = <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L29137' name='L29137'></a> 29137 
<a id='L29138' name='L29138'></a> 29138   <em class='comment'>/* If a display connection is dead, don't try sending more</em>
<a id='L29139' name='L29139'></a> 29139 <em class='comment'>     commands to the X server.  */</em>
<a id='L29140' name='L29140'></a> 29140   <strong class='reserved'>if</strong> (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> != 0)
<a id='L29141' name='L29141'></a> 29141     x_free_frame_resources (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L29142' name='L29142'></a> 29142 
<a id='L29143' name='L29143'></a> 29143   <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;saved_menu_event);
<a id='L29144' name='L29144'></a> 29144 
<a id='L29145' name='L29145'></a> 29145 <em class='sharp'>#ifdef</em> HAVE_X_I18N
<a id='L29146' name='L29146'></a> 29146   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;preedit_chars)
<a id='L29147' name='L29147'></a> 29147     <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;preedit_chars);
<a id='L29148' name='L29148'></a> 29148 <em class='sharp'>#endif</em>
<a id='L29149' name='L29149'></a> 29149 
<a id='L29150' name='L29150'></a> 29150 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L29151' name='L29151'></a> 29151 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L168' title='Defined at 168 in src/xterm.h.'>HAVE_XINPUT2_1</a>
<a id='L29152' name='L29152'></a> 29152   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;xi_masks)
<a id='L29153' name='L29153'></a> 29153     XFree (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;xi_masks);
<a id='L29154' name='L29154'></a> 29154 <em class='sharp'>#else</em>
<a id='L29155' name='L29155'></a> 29155   <em class='comment'>/* This is allocated by us under very old versions of libXi; see</em>
<a id='L29156' name='L29156'></a> 29156 <em class='comment'>     `setup_xi_event_mask'.  */</em>
<a id='L29157' name='L29157'></a> 29157   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;xi_masks)
<a id='L29158' name='L29158'></a> 29158     <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;xi_masks);
<a id='L29159' name='L29159'></a> 29159 <em class='sharp'>#endif</em>
<a id='L29160' name='L29160'></a> 29160 <em class='sharp'>#endif</em>
<a id='L29161' name='L29161'></a> 29161 
<a id='L29162' name='L29162'></a> 29162   <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>);
<a id='L29163' name='L29163'></a> 29163   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L29164' name='L29164'></a> 29164 
<a id='L29165' name='L29165'></a> 29165   dpyinfo-&gt;reference_count--;
<a id='L29166' name='L29166'></a> 29166 <em class='brace'>}</em>
<a id='L29167' name='L29167'></a> 29167 
<a id='L29168' name='L29168'></a> 29168 <em class='comment'>/* Intern NAME in DPYINFO, but check to see if the atom was already</em>
<a id='L29169' name='L29169'></a> 29169 <em class='comment'>   interned when the X connection was opened, and use that instead.</em>
<a id='L29170' name='L29170'></a> 29170 <em class='comment'></em>
<a id='L29171' name='L29171'></a> 29171 <em class='comment'>   If PREDEFINED_ONLY, return None if the atom was not interned during</em>
<a id='L29172' name='L29172'></a> 29172 <em class='comment'>   connection setup or is predefined.  */</em>
<a id='L29173' name='L29173'></a> 29173 Atom
<a id='L29174' name='L29174'></a> 29174 x_intern_cached_atom (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L29175' name='L29175'></a> 29175                       <strong class='reserved'>const</strong> <strong class='reserved'>char</strong> *<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>, <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> predefined_only)
<a id='L29176' name='L29176'></a> 29176 <em class='brace'>{</em>
<a id='L29177' name='L29177'></a> 29177   <strong class='reserved'>int</strong> i;
<a id='L29178' name='L29178'></a> 29178   <strong class='reserved'>char</strong> *ptr;
<a id='L29179' name='L29179'></a> 29179   Atom *atom;
<a id='L29180' name='L29180'></a> 29180 
<a id='L29181' name='L29181'></a> 29181   <em class='comment'>/* Special atoms that depend on the screen number.  */</em>
<a id='L29182' name='L29182'></a> 29182   <strong class='reserved'>char</strong> xsettings_atom_name[<strong class='reserved'>sizeof</strong> "_XSETTINGS_S%d" - 2
<a id='L29183' name='L29183'></a> 29183                            + <a href='../S/2707.html#L66' title='Defined at 66 in lib/intprops.h.'>INT_STRLEN_BOUND</a> (<strong class='reserved'>int</strong>)];
<a id='L29184' name='L29184'></a> 29184   <strong class='reserved'>char</strong> cm_atom_name[<strong class='reserved'>sizeof</strong> "_NET_WM_CM_S%d" - 2
<a id='L29185' name='L29185'></a> 29185                     + <a href='../S/2707.html#L66' title='Defined at 66 in lib/intprops.h.'>INT_STRLEN_BOUND</a> (<strong class='reserved'>int</strong>)];
<a id='L29186' name='L29186'></a> 29186 
<a id='L29187' name='L29187'></a> 29187   <a href='../D/17583.html' title='Multiple defined in 3 places.'>sprintf</a> (xsettings_atom_name, "_XSETTINGS_S%d",
<a id='L29188' name='L29188'></a> 29188            <a href='../S/2296.html#L7400' title='Defined at 7400 in src/xfns.c.'>XScreenNumberOfScreen</a> (dpyinfo-&gt;screen));
<a id='L29189' name='L29189'></a> 29189   <a href='../D/17583.html' title='Multiple defined in 3 places.'>sprintf</a> (cm_atom_name, "_NET_WM_CM_S%d",
<a id='L29190' name='L29190'></a> 29190            <a href='../S/2296.html#L7400' title='Defined at 7400 in src/xfns.c.'>XScreenNumberOfScreen</a> (dpyinfo-&gt;screen));
<a id='L29191' name='L29191'></a> 29191 
<a id='L29192' name='L29192'></a> 29192   <strong class='reserved'>if</strong> (!strcmp (<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>, xsettings_atom_name))
<a id='L29193' name='L29193'></a> 29193     <strong class='reserved'>return</strong> dpyinfo-&gt;Xatom_xsettings_sel;
<a id='L29194' name='L29194'></a> 29194 
<a id='L29195' name='L29195'></a> 29195   <strong class='reserved'>if</strong> (!strcmp (<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>, cm_atom_name))
<a id='L29196' name='L29196'></a> 29196     <strong class='reserved'>return</strong> dpyinfo-&gt;Xatom_NET_WM_CM_Sn;
<a id='L29197' name='L29197'></a> 29197 
<a id='L29198' name='L29198'></a> 29198   <em class='comment'>/* Now do some common predefined atoms.  */</em>
<a id='L29199' name='L29199'></a> 29199   <strong class='reserved'>if</strong> (!strcmp (<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>, "PRIMARY"))
<a id='L29200' name='L29200'></a> 29200     <strong class='reserved'>return</strong> XA_PRIMARY;
<a id='L29201' name='L29201'></a> 29201 
<a id='L29202' name='L29202'></a> 29202   <strong class='reserved'>if</strong> (!strcmp (<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>, "SECONDARY"))
<a id='L29203' name='L29203'></a> 29203     <strong class='reserved'>return</strong> XA_SECONDARY;
<a id='L29204' name='L29204'></a> 29204 
<a id='L29205' name='L29205'></a> 29205   <strong class='reserved'>if</strong> (!strcmp (<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>, "STRING"))
<a id='L29206' name='L29206'></a> 29206     <strong class='reserved'>return</strong> XA_STRING;
<a id='L29207' name='L29207'></a> 29207 
<a id='L29208' name='L29208'></a> 29208   <strong class='reserved'>if</strong> (!strcmp (<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>, "INTEGER"))
<a id='L29209' name='L29209'></a> 29209     <strong class='reserved'>return</strong> XA_INTEGER;
<a id='L29210' name='L29210'></a> 29210 
<a id='L29211' name='L29211'></a> 29211   <strong class='reserved'>if</strong> (!strcmp (<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>, "ATOM"))
<a id='L29212' name='L29212'></a> 29212     <strong class='reserved'>return</strong> XA_ATOM;
<a id='L29213' name='L29213'></a> 29213 
<a id='L29214' name='L29214'></a> 29214   <strong class='reserved'>if</strong> (!strcmp (<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>, "WINDOW"))
<a id='L29215' name='L29215'></a> 29215     <strong class='reserved'>return</strong> XA_WINDOW;
<a id='L29216' name='L29216'></a> 29216 
<a id='L29217' name='L29217'></a> 29217   <strong class='reserved'>if</strong> (!strcmp (<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>, "DRAWABLE"))
<a id='L29218' name='L29218'></a> 29218     <strong class='reserved'>return</strong> XA_DRAWABLE;
<a id='L29219' name='L29219'></a> 29219 
<a id='L29220' name='L29220'></a> 29220   <strong class='reserved'>if</strong> (!strcmp (<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>, "BITMAP"))
<a id='L29221' name='L29221'></a> 29221     <strong class='reserved'>return</strong> XA_BITMAP;
<a id='L29222' name='L29222'></a> 29222 
<a id='L29223' name='L29223'></a> 29223   <strong class='reserved'>if</strong> (!strcmp (<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>, "CARDINAL"))
<a id='L29224' name='L29224'></a> 29224     <strong class='reserved'>return</strong> XA_CARDINAL;
<a id='L29225' name='L29225'></a> 29225 
<a id='L29226' name='L29226'></a> 29226   <strong class='reserved'>if</strong> (!strcmp (<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>, "COLORMAP"))
<a id='L29227' name='L29227'></a> 29227     <strong class='reserved'>return</strong> XA_COLORMAP;
<a id='L29228' name='L29228'></a> 29228 
<a id='L29229' name='L29229'></a> 29229   <strong class='reserved'>if</strong> (!strcmp (<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>, "CURSOR"))
<a id='L29230' name='L29230'></a> 29230     <strong class='reserved'>return</strong> XA_CURSOR;
<a id='L29231' name='L29231'></a> 29231 
<a id='L29232' name='L29232'></a> 29232   <strong class='reserved'>if</strong> (!strcmp (<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>, "FONT"))
<a id='L29233' name='L29233'></a> 29233     <strong class='reserved'>return</strong> XA_FONT;
<a id='L29234' name='L29234'></a> 29234 
<a id='L29235' name='L29235'></a> 29235   <strong class='reserved'>if</strong> (dpyinfo-&gt;motif_drag_atom != None
<a id='L29236' name='L29236'></a> 29236       &amp;&amp; !strcmp (<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>, dpyinfo-&gt;motif_drag_atom_name))
<a id='L29237' name='L29237'></a> 29237     <strong class='reserved'>return</strong> dpyinfo-&gt;motif_drag_atom;
<a id='L29238' name='L29238'></a> 29238 
<a id='L29239' name='L29239'></a> 29239   <strong class='reserved'>for</strong> (i = 0; i &lt; <a href='../D/185.html' title='Multiple defined in 3 places.'>ARRAYELTS</a> (x_atom_refs); ++i)
<a id='L29240' name='L29240'></a> 29240     <em class='brace'>{</em>
<a id='L29241' name='L29241'></a> 29241       ptr = (<strong class='reserved'>char</strong> *) dpyinfo;
<a id='L29242' name='L29242'></a> 29242 
<a id='L29243' name='L29243'></a> 29243       <strong class='reserved'>if</strong> (!strcmp (x_atom_refs[i].<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>, <a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>))
<a id='L29244' name='L29244'></a> 29244         <em class='brace'>{</em>
<a id='L29245' name='L29245'></a> 29245           atom = (Atom *) (ptr + x_atom_refs[i].<a href='../D/15084.html' title='Multiple defined in 4 places.'>offset</a>);
<a id='L29246' name='L29246'></a> 29246 
<a id='L29247' name='L29247'></a> 29247           <strong class='reserved'>return</strong> *atom;
<a id='L29248' name='L29248'></a> 29248         <em class='brace'>}</em>
<a id='L29249' name='L29249'></a> 29249     <em class='brace'>}</em>
<a id='L29250' name='L29250'></a> 29250 
<a id='L29251' name='L29251'></a> 29251   <strong class='reserved'>if</strong> (predefined_only)
<a id='L29252' name='L29252'></a> 29252     <strong class='reserved'>return</strong> None;
<a id='L29253' name='L29253'></a> 29253 
<a id='L29254' name='L29254'></a> 29254   <strong class='reserved'>return</strong> XInternAtom (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>, False);
<a id='L29255' name='L29255'></a> 29255 <em class='brace'>}</em>
<a id='L29256' name='L29256'></a> 29256 
<a id='L29257' name='L29257'></a> 29257 <em class='comment'>/* Get the name of ATOM, but try not to make a request to the X</em>
<a id='L29258' name='L29258'></a> 29258 <em class='comment'>   server.  Whether or not a request to the X server happened is</em>
<a id='L29259' name='L29259'></a> 29259 <em class='comment'>   placed in NEED_SYNC.  */</em>
<a id='L29260' name='L29260'></a> 29260 <strong class='reserved'>char</strong> *
<a id='L29261' name='L29261'></a> 29261 x_get_atom_name (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo, Atom atom,
<a id='L29262' name='L29262'></a> 29262                  <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> *need_sync)
<a id='L29263' name='L29263'></a> 29263 <em class='brace'>{</em>
<a id='L29264' name='L29264'></a> 29264   <strong class='reserved'>char</strong> *dpyinfo_pointer, *<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>, *<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>, *<a href='../S/2130.html#L305' title='Defined at 305 in src/buffer.h.'>buffer</a>;
<a id='L29265' name='L29265'></a> 29265   <strong class='reserved'>int</strong> i;
<a id='L29266' name='L29266'></a> 29266   Atom ref_atom;
<a id='L29267' name='L29267'></a> 29267 
<a id='L29268' name='L29268'></a> 29268   dpyinfo_pointer = (<strong class='reserved'>char</strong> *) dpyinfo;
<a id='L29269' name='L29269'></a> 29269   <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a> = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L29270' name='L29270'></a> 29270 
<a id='L29271' name='L29271'></a> 29271   <strong class='reserved'>if</strong> (need_sync)
<a id='L29272' name='L29272'></a> 29272     *need_sync = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L29273' name='L29273'></a> 29273 
<a id='L29274' name='L29274'></a> 29274   <a href='../S/2130.html#L305' title='Defined at 305 in src/buffer.h.'>buffer</a> = <a href='../D/8439.html' title='Multiple defined in 8 places.'>alloca</a> (45 + <a href='../S/2707.html#L66' title='Defined at 66 in lib/intprops.h.'>INT_STRLEN_BOUND</a> (<strong class='reserved'>int</strong>));
<a id='L29275' name='L29275'></a> 29275 
<a id='L29276' name='L29276'></a> 29276   <strong class='reserved'>switch</strong> (atom)
<a id='L29277' name='L29277'></a> 29277     <em class='brace'>{</em>
<a id='L29278' name='L29278'></a> 29278     <strong class='reserved'>case</strong> XA_PRIMARY:
<a id='L29279' name='L29279'></a> 29279       <strong class='reserved'>return</strong> <a href='../D/20121.html' title='Multiple defined in 3 places.'>xstrdup</a> ("PRIMARY");
<a id='L29280' name='L29280'></a> 29280 
<a id='L29281' name='L29281'></a> 29281     <strong class='reserved'>case</strong> XA_SECONDARY:
<a id='L29282' name='L29282'></a> 29282       <strong class='reserved'>return</strong> <a href='../D/20121.html' title='Multiple defined in 3 places.'>xstrdup</a> ("SECONDARY");
<a id='L29283' name='L29283'></a> 29283 
<a id='L29284' name='L29284'></a> 29284     <strong class='reserved'>case</strong> XA_INTEGER:
<a id='L29285' name='L29285'></a> 29285       <strong class='reserved'>return</strong> <a href='../D/20121.html' title='Multiple defined in 3 places.'>xstrdup</a> ("INTEGER");
<a id='L29286' name='L29286'></a> 29286 
<a id='L29287' name='L29287'></a> 29287     <strong class='reserved'>case</strong> XA_ATOM:
<a id='L29288' name='L29288'></a> 29288       <strong class='reserved'>return</strong> <a href='../D/20121.html' title='Multiple defined in 3 places.'>xstrdup</a> ("ATOM");
<a id='L29289' name='L29289'></a> 29289 
<a id='L29290' name='L29290'></a> 29290     <strong class='reserved'>case</strong> XA_CARDINAL:
<a id='L29291' name='L29291'></a> 29291       <strong class='reserved'>return</strong> <a href='../D/20121.html' title='Multiple defined in 3 places.'>xstrdup</a> ("CARDINAL");
<a id='L29292' name='L29292'></a> 29292 
<a id='L29293' name='L29293'></a> 29293     <strong class='reserved'>case</strong> XA_WINDOW:
<a id='L29294' name='L29294'></a> 29294       <strong class='reserved'>return</strong> <a href='../D/20121.html' title='Multiple defined in 3 places.'>xstrdup</a> ("WINDOW");
<a id='L29295' name='L29295'></a> 29295 
<a id='L29296' name='L29296'></a> 29296     <strong class='reserved'>case</strong> XA_DRAWABLE:
<a id='L29297' name='L29297'></a> 29297       <strong class='reserved'>return</strong> <a href='../D/20121.html' title='Multiple defined in 3 places.'>xstrdup</a> ("DRAWABLE");
<a id='L29298' name='L29298'></a> 29298 
<a id='L29299' name='L29299'></a> 29299     <strong class='reserved'>case</strong> XA_BITMAP:
<a id='L29300' name='L29300'></a> 29300       <strong class='reserved'>return</strong> <a href='../D/20121.html' title='Multiple defined in 3 places.'>xstrdup</a> ("BITMAP");
<a id='L29301' name='L29301'></a> 29301 
<a id='L29302' name='L29302'></a> 29302     <strong class='reserved'>case</strong> XA_COLORMAP:
<a id='L29303' name='L29303'></a> 29303       <strong class='reserved'>return</strong> <a href='../D/20121.html' title='Multiple defined in 3 places.'>xstrdup</a> ("COLORMAP");
<a id='L29304' name='L29304'></a> 29304 
<a id='L29305' name='L29305'></a> 29305     <strong class='reserved'>case</strong> XA_FONT:
<a id='L29306' name='L29306'></a> 29306       <strong class='reserved'>return</strong> <a href='../D/20121.html' title='Multiple defined in 3 places.'>xstrdup</a> ("FONT");
<a id='L29307' name='L29307'></a> 29307 
<a id='L29308' name='L29308'></a> 29308     <strong class='reserved'>default</strong>:
<a id='L29309' name='L29309'></a> 29309       <strong class='reserved'>if</strong> (dpyinfo-&gt;motif_drag_atom
<a id='L29310' name='L29310'></a> 29310           &amp;&amp; atom == dpyinfo-&gt;motif_drag_atom)
<a id='L29311' name='L29311'></a> 29311         <strong class='reserved'>return</strong> <a href='../D/20121.html' title='Multiple defined in 3 places.'>xstrdup</a> (dpyinfo-&gt;motif_drag_atom_name);
<a id='L29312' name='L29312'></a> 29312 
<a id='L29313' name='L29313'></a> 29313       <strong class='reserved'>if</strong> (atom == dpyinfo-&gt;Xatom_xsettings_sel)
<a id='L29314' name='L29314'></a> 29314         <em class='brace'>{</em>
<a id='L29315' name='L29315'></a> 29315           <a href='../D/17583.html' title='Multiple defined in 3 places.'>sprintf</a> (<a href='../S/2130.html#L305' title='Defined at 305 in src/buffer.h.'>buffer</a>, "_XSETTINGS_S%d",
<a id='L29316' name='L29316'></a> 29316                    <a href='../S/2296.html#L7400' title='Defined at 7400 in src/xfns.c.'>XScreenNumberOfScreen</a> (dpyinfo-&gt;screen));
<a id='L29317' name='L29317'></a> 29317           <strong class='reserved'>return</strong> <a href='../D/20121.html' title='Multiple defined in 3 places.'>xstrdup</a> (<a href='../S/2130.html#L305' title='Defined at 305 in src/buffer.h.'>buffer</a>);
<a id='L29318' name='L29318'></a> 29318         <em class='brace'>}</em>
<a id='L29319' name='L29319'></a> 29319 
<a id='L29320' name='L29320'></a> 29320       <strong class='reserved'>if</strong> (atom == dpyinfo-&gt;Xatom_NET_WM_CM_Sn)
<a id='L29321' name='L29321'></a> 29321         <em class='brace'>{</em>
<a id='L29322' name='L29322'></a> 29322           <a href='../D/17583.html' title='Multiple defined in 3 places.'>sprintf</a> (<a href='../S/2130.html#L305' title='Defined at 305 in src/buffer.h.'>buffer</a>, "_NET_WM_CM_S%d",
<a id='L29323' name='L29323'></a> 29323                    <a href='../S/2296.html#L7400' title='Defined at 7400 in src/xfns.c.'>XScreenNumberOfScreen</a> (dpyinfo-&gt;screen));
<a id='L29324' name='L29324'></a> 29324           <strong class='reserved'>return</strong> <a href='../D/20121.html' title='Multiple defined in 3 places.'>xstrdup</a> (<a href='../S/2130.html#L305' title='Defined at 305 in src/buffer.h.'>buffer</a>);
<a id='L29325' name='L29325'></a> 29325         <em class='brace'>}</em>
<a id='L29326' name='L29326'></a> 29326 
<a id='L29327' name='L29327'></a> 29327       <strong class='reserved'>for</strong> (i = 0; i &lt; <a href='../D/185.html' title='Multiple defined in 3 places.'>ARRAYELTS</a> (x_atom_refs); ++i)
<a id='L29328' name='L29328'></a> 29328         <em class='brace'>{</em>
<a id='L29329' name='L29329'></a> 29329           ref_atom = *(Atom *) (dpyinfo_pointer
<a id='L29330' name='L29330'></a> 29330                                 + x_atom_refs[i].<a href='../D/15084.html' title='Multiple defined in 4 places.'>offset</a>);
<a id='L29331' name='L29331'></a> 29331 
<a id='L29332' name='L29332'></a> 29332           <strong class='reserved'>if</strong> (atom == ref_atom)
<a id='L29333' name='L29333'></a> 29333             <strong class='reserved'>return</strong> <a href='../D/20121.html' title='Multiple defined in 3 places.'>xstrdup</a> (x_atom_refs[i].<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>);
<a id='L29334' name='L29334'></a> 29334         <em class='brace'>}</em>
<a id='L29335' name='L29335'></a> 29335 
<a id='L29336' name='L29336'></a> 29336       <a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a> = XGetAtomName (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, atom);
<a id='L29337' name='L29337'></a> 29337 
<a id='L29338' name='L29338'></a> 29338       <strong class='reserved'>if</strong> (need_sync)
<a id='L29339' name='L29339'></a> 29339         *need_sync = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L29340' name='L29340'></a> 29340 
<a id='L29341' name='L29341'></a> 29341       <strong class='reserved'>if</strong> (<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>)
<a id='L29342' name='L29342'></a> 29342         <em class='brace'>{</em>
<a id='L29343' name='L29343'></a> 29343           <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a> = <a href='../D/20121.html' title='Multiple defined in 3 places.'>xstrdup</a> (<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>);
<a id='L29344' name='L29344'></a> 29344           XFree (<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>);
<a id='L29345' name='L29345'></a> 29345         <em class='brace'>}</em>
<a id='L29346' name='L29346'></a> 29346 
<a id='L29347' name='L29347'></a> 29347       <strong class='reserved'>break</strong>;
<a id='L29348' name='L29348'></a> 29348     <em class='brace'>}</em>
<a id='L29349' name='L29349'></a> 29349 
<a id='L29350' name='L29350'></a> 29350   <strong class='reserved'>return</strong> <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>;
<a id='L29351' name='L29351'></a> 29351 <em class='brace'>}</em>
<a id='L29352' name='L29352'></a> 29352 
<a id='L29353' name='L29353'></a> 29353 <em class='comment'>/* Intern an array of atoms, and do so quickly, avoiding extraneous</em>
<a id='L29354' name='L29354'></a> 29354 <em class='comment'>   roundtrips to the X server.</em>
<a id='L29355' name='L29355'></a> 29355 <em class='comment'></em>
<a id='L29356' name='L29356'></a> 29356 <em class='comment'>   Avoid sending atoms that have already been found to the X server.</em>
<a id='L29357' name='L29357'></a> 29357 <em class='comment'>   This cannot do anything that will end up triggering garbage</em>
<a id='L29358' name='L29358'></a> 29358 <em class='comment'>   collection.  */</em>
<a id='L29359' name='L29359'></a> 29359 
<a id='L29360' name='L29360'></a> 29360 <strong class='reserved'>void</strong>
<a id='L29361' name='L29361'></a> 29361 x_intern_atoms (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo, <strong class='reserved'>char</strong> **names, <strong class='reserved'>int</strong> count,
<a id='L29362' name='L29362'></a> 29362                 Atom *atoms_return)
<a id='L29363' name='L29363'></a> 29363 <em class='brace'>{</em>
<a id='L29364' name='L29364'></a> 29364   <strong class='reserved'>int</strong> i, j, indices[256];
<a id='L29365' name='L29365'></a> 29365   <strong class='reserved'>char</strong> *new_names[256];
<a id='L29366' name='L29366'></a> 29366   Atom results[256], <a href='../S/2266.html#L1232' title='Defined at 1232 in src/pdumper.c.'>candidate</a>;
<a id='L29367' name='L29367'></a> 29367 
<a id='L29368' name='L29368'></a> 29368   <strong class='reserved'>if</strong> (count &gt; 256)
<a id='L29369' name='L29369'></a> 29369     <em class='comment'>/* Atoms array too big to inspect reasonably, just send it to the</em>
<a id='L29370' name='L29370'></a> 29370 <em class='comment'>       server and back.  */</em>
<a id='L29371' name='L29371'></a> 29371     XInternAtoms (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, new_names, count, False, atoms_return);
<a id='L29372' name='L29372'></a> 29372   <strong class='reserved'>else</strong>
<a id='L29373' name='L29373'></a> 29373     <em class='brace'>{</em>
<a id='L29374' name='L29374'></a> 29374       <strong class='reserved'>for</strong> (i = 0, j = 0; i &lt; count; ++i)
<a id='L29375' name='L29375'></a> 29375         <em class='brace'>{</em>
<a id='L29376' name='L29376'></a> 29376           <a href='../S/2266.html#L1232' title='Defined at 1232 in src/pdumper.c.'>candidate</a> = x_intern_cached_atom (dpyinfo, names[i],
<a id='L29377' name='L29377'></a> 29377                                             <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L29378' name='L29378'></a> 29378 
<a id='L29379' name='L29379'></a> 29379           <strong class='reserved'>if</strong> (<a href='../S/2266.html#L1232' title='Defined at 1232 in src/pdumper.c.'>candidate</a>)
<a id='L29380' name='L29380'></a> 29380             atoms_return[i] = <a href='../S/2266.html#L1232' title='Defined at 1232 in src/pdumper.c.'>candidate</a>;
<a id='L29381' name='L29381'></a> 29381           <strong class='reserved'>else</strong>
<a id='L29382' name='L29382'></a> 29382             <em class='brace'>{</em>
<a id='L29383' name='L29383'></a> 29383               indices[j++] = i;
<a id='L29384' name='L29384'></a> 29384               new_names[j - 1] = names[i];
<a id='L29385' name='L29385'></a> 29385             <em class='brace'>}</em>
<a id='L29386' name='L29386'></a> 29386         <em class='brace'>}</em>
<a id='L29387' name='L29387'></a> 29387 
<a id='L29388' name='L29388'></a> 29388       <strong class='reserved'>if</strong> (!j)
<a id='L29389' name='L29389'></a> 29389         <strong class='reserved'>return</strong>;
<a id='L29390' name='L29390'></a> 29390 
<a id='L29391' name='L29391'></a> 29391       <em class='comment'>/* Now, get the results back from the X server.  */</em>
<a id='L29392' name='L29392'></a> 29392       XInternAtoms (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, new_names, j, False,
<a id='L29393' name='L29393'></a> 29393                     results);
<a id='L29394' name='L29394'></a> 29394 
<a id='L29395' name='L29395'></a> 29395       <strong class='reserved'>for</strong> (i = 0; i &lt; j; ++i)
<a id='L29396' name='L29396'></a> 29396         atoms_return[indices[i]] = results[i];
<a id='L29397' name='L29397'></a> 29397     <em class='brace'>}</em>
<a id='L29398' name='L29398'></a> 29398 <em class='brace'>}</em>
<a id='L29399' name='L29399'></a> 29399 
<a id='L29400' name='L29400'></a> 29400 <em class='sharp'>#ifndef</em> USE_GTK
<a id='L29401' name='L29401'></a> 29401 
<a id='L29402' name='L29402'></a> 29402 <em class='comment'>/* Set up XEmbed for F, and change its save set to handle the parent</em>
<a id='L29403' name='L29403'></a> 29403 <em class='comment'>   being destroyed.  */</em>
<a id='L29404' name='L29404'></a> 29404 
<a id='L29405' name='L29405'></a> 29405 <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L29406' name='L29406'></a> 29406 x_embed_frame (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo, <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L29407' name='L29407'></a> 29407 <em class='brace'>{</em>
<a id='L29408' name='L29408'></a> 29408   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> rc;
<a id='L29409' name='L29409'></a> 29409 
<a id='L29410' name='L29410'></a> 29410   x_catch_errors (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L29411' name='L29411'></a> 29411   <em class='comment'>/* Catch errors; the target window might no longer exist.  */</em>
<a id='L29412' name='L29412'></a> 29412   XReparentWindow (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>),
<a id='L29413' name='L29413'></a> 29413                    <a href='../D/2368.html' title='Multiple defined in 7 places.'>FRAME_OUTPUT_DATA</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)-&gt;parent_desc, 0, 0);
<a id='L29414' name='L29414'></a> 29414   rc = x_had_errors_p (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L29415' name='L29415'></a> 29415   x_uncatch_errors_after_check ();
<a id='L29416' name='L29416'></a> 29416 
<a id='L29417' name='L29417'></a> 29417   <strong class='reserved'>if</strong> (rc)
<a id='L29418' name='L29418'></a> 29418     <strong class='reserved'>return</strong> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L29419' name='L29419'></a> 29419 
<a id='L29420' name='L29420'></a> 29420   <strong class='reserved'>return</strong> <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L29421' name='L29421'></a> 29421 <em class='brace'>}</em>
<a id='L29422' name='L29422'></a> 29422 
<a id='L29423' name='L29423'></a> 29423 <em class='sharp'>#endif</em>
<a id='L29424' name='L29424'></a> 29424 
<a id='L29425' name='L29425'></a> 29425 
<a id='L29426' name='L29426'></a> 29426 <em class='comment'>/* Setting window manager hints.  */</em>
<a id='L29427' name='L29427'></a> 29427 
<a id='L29428' name='L29428'></a> 29428 <em class='comment'>/* Set the normal size hints for the window manager, for frame F.</em>
<a id='L29429' name='L29429'></a> 29429 <em class='comment'>   FLAGS is the flags word to use--or 0 meaning preserve the flags</em>
<a id='L29430' name='L29430'></a> 29430 <em class='comment'>   that the window now has.</em>
<a id='L29431' name='L29431'></a> 29431 <em class='comment'>   If USER_POSITION, set the USPosition</em>
<a id='L29432' name='L29432'></a> 29432 <em class='comment'>   flag (this is useful when FLAGS is 0).</em>
<a id='L29433' name='L29433'></a> 29433 <em class='comment'>   The GTK version is in gtkutils.c.  */</em>
<a id='L29434' name='L29434'></a> 29434 
<a id='L29435' name='L29435'></a> 29435 <strong class='reserved'>void</strong>
<a id='L29436' name='L29436'></a> 29436 x_wm_set_size_hint (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <strong class='reserved'>long</strong> flags, <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> user_position)
<a id='L29437' name='L29437'></a> 29437 <em class='brace'>{</em>
<a id='L29438' name='L29438'></a> 29438 <em class='sharp'>#ifndef</em> USE_GTK
<a id='L29439' name='L29439'></a> 29439   XSizeHints size_hints;
<a id='L29440' name='L29440'></a> 29440   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L29441' name='L29441'></a> 29441 <em class='sharp'>#ifdef</em> USE_X_TOOLKIT
<a id='L29442' name='L29442'></a> 29442   WMShellWidget shell;
<a id='L29443' name='L29443'></a> 29443 <em class='sharp'>#ifndef</em> USE_MOTIF
<a id='L29444' name='L29444'></a> 29444   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> hints_changed;
<a id='L29445' name='L29445'></a> 29445 <em class='sharp'>#endif</em>
<a id='L29446' name='L29446'></a> 29446 <em class='sharp'>#endif</em>
<a id='L29447' name='L29447'></a> 29447 
<a id='L29448' name='L29448'></a> 29448   <strong class='reserved'>if</strong> (!<a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>)
<a id='L29449' name='L29449'></a> 29449     <strong class='reserved'>return</strong>;
<a id='L29450' name='L29450'></a> 29450 
<a id='L29451' name='L29451'></a> 29451 <em class='sharp'>#ifdef</em> USE_X_TOOLKIT
<a id='L29452' name='L29452'></a> 29452   <strong class='reserved'>if</strong> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;widget)
<a id='L29453' name='L29453'></a> 29453     <em class='brace'>{</em>
<a id='L29454' name='L29454'></a> 29454       <em class='comment'>/* Do this dance in xterm.c because some stuff is not as easily</em>
<a id='L29455' name='L29455'></a> 29455 <em class='comment'>         available in widget.c.  */</em>
<a id='L29456' name='L29456'></a> 29456 
<a id='L29457' name='L29457'></a> 29457       <a href='../D/10871.html' title='Multiple defined in 5 places.'>eassert</a> (XtIsWMShell (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;widget));
<a id='L29458' name='L29458'></a> 29458       shell = (WMShellWidget) <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;widget;
<a id='L29459' name='L29459'></a> 29459 
<a id='L29460' name='L29460'></a> 29460       <strong class='reserved'>if</strong> (flags)
<a id='L29461' name='L29461'></a> 29461         <em class='brace'>{</em>
<a id='L29462' name='L29462'></a> 29462           shell-&gt;wm.size_hints.flags &amp;= ~(<a href='../D/4860.html' title='Multiple defined in 5 places.'>PPosition</a> | <a href='../D/6624.html' title='Multiple defined in 5 places.'>USPosition</a>);
<a id='L29463' name='L29463'></a> 29463           shell-&gt;wm.size_hints.flags |= flags &amp; (<a href='../D/4860.html' title='Multiple defined in 5 places.'>PPosition</a> | <a href='../D/6624.html' title='Multiple defined in 5 places.'>USPosition</a>);
<a id='L29464' name='L29464'></a> 29464         <em class='brace'>}</em>
<a id='L29465' name='L29465'></a> 29465 
<a id='L29466' name='L29466'></a> 29466       <strong class='reserved'>if</strong> (user_position)
<a id='L29467' name='L29467'></a> 29467         <em class='brace'>{</em>
<a id='L29468' name='L29468'></a> 29468           shell-&gt;wm.size_hints.flags &amp;= ~<a href='../D/4860.html' title='Multiple defined in 5 places.'>PPosition</a>;
<a id='L29469' name='L29469'></a> 29469           shell-&gt;wm.size_hints.flags |= <a href='../D/6624.html' title='Multiple defined in 5 places.'>USPosition</a>;
<a id='L29470' name='L29470'></a> 29470         <em class='brace'>}</em>
<a id='L29471' name='L29471'></a> 29471 
<a id='L29472' name='L29472'></a> 29472 <em class='sharp'>#ifndef</em> USE_MOTIF
<a id='L29473' name='L29473'></a> 29473       hints_changed
<a id='L29474' name='L29474'></a> 29474         = <a href='../S/2342.html#L321' title='Defined at 321 in src/widget.c.'>widget_update_wm_size_hints</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;widget,
<a id='L29475' name='L29475'></a> 29475                                        <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;edit_widget);
<a id='L29476' name='L29476'></a> 29476 <em class='sharp'>#else</em>
<a id='L29477' name='L29477'></a> 29477       <a href='../S/2342.html#L321' title='Defined at 321 in src/widget.c.'>widget_update_wm_size_hints</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;widget,
<a id='L29478' name='L29478'></a> 29478                                    <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;edit_widget);
<a id='L29479' name='L29479'></a> 29479 
<a id='L29480' name='L29480'></a> 29480       <em class='comment'>/* Do this all over again for the benefit of Motif, which always</em>
<a id='L29481' name='L29481'></a> 29481 <em class='comment'>         knows better than the programmer.  */</em>
<a id='L29482' name='L29482'></a> 29482       shell-&gt;wm.size_hints.flags &amp;= ~(<a href='../D/4860.html' title='Multiple defined in 5 places.'>PPosition</a> | <a href='../D/6624.html' title='Multiple defined in 5 places.'>USPosition</a>);
<a id='L29483' name='L29483'></a> 29483       shell-&gt;wm.size_hints.flags |= flags &amp; (<a href='../D/4860.html' title='Multiple defined in 5 places.'>PPosition</a> | <a href='../D/6624.html' title='Multiple defined in 5 places.'>USPosition</a>);
<a id='L29484' name='L29484'></a> 29484 
<a id='L29485' name='L29485'></a> 29485       <strong class='reserved'>if</strong> (user_position)
<a id='L29486' name='L29486'></a> 29486         <em class='brace'>{</em>
<a id='L29487' name='L29487'></a> 29487           shell-&gt;wm.size_hints.flags &amp;= ~<a href='../D/4860.html' title='Multiple defined in 5 places.'>PPosition</a>;
<a id='L29488' name='L29488'></a> 29488           shell-&gt;wm.size_hints.flags |= <a href='../D/6624.html' title='Multiple defined in 5 places.'>USPosition</a>;
<a id='L29489' name='L29489'></a> 29489         <em class='brace'>}</em>
<a id='L29490' name='L29490'></a> 29490 <em class='sharp'>#endif</em>
<a id='L29491' name='L29491'></a> 29491 
<a id='L29492' name='L29492'></a> 29492       <em class='comment'>/* Drill hints into Motif, since it keeps setting its own.  */</em>
<a id='L29493' name='L29493'></a> 29493       size_hints.flags = shell-&gt;wm.size_hints.flags;
<a id='L29494' name='L29494'></a> 29494       size_hints.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = shell-&gt;wm.size_hints.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L29495' name='L29495'></a> 29495       size_hints.y = shell-&gt;wm.size_hints.y;
<a id='L29496' name='L29496'></a> 29496       size_hints.width = shell-&gt;wm.size_hints.width;
<a id='L29497' name='L29497'></a> 29497       size_hints.height = shell-&gt;wm.size_hints.height;
<a id='L29498' name='L29498'></a> 29498       size_hints.min_width = shell-&gt;wm.size_hints.min_width;
<a id='L29499' name='L29499'></a> 29499       size_hints.min_height = shell-&gt;wm.size_hints.min_height;
<a id='L29500' name='L29500'></a> 29500       size_hints.max_width = shell-&gt;wm.size_hints.max_width;
<a id='L29501' name='L29501'></a> 29501       size_hints.max_height = shell-&gt;wm.size_hints.max_height;
<a id='L29502' name='L29502'></a> 29502       size_hints.width_inc = shell-&gt;wm.size_hints.width_inc;
<a id='L29503' name='L29503'></a> 29503       size_hints.height_inc = shell-&gt;wm.size_hints.height_inc;
<a id='L29504' name='L29504'></a> 29504       size_hints.min_aspect.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = shell-&gt;wm.size_hints.min_aspect.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L29505' name='L29505'></a> 29505       size_hints.min_aspect.y = shell-&gt;wm.size_hints.min_aspect.y;
<a id='L29506' name='L29506'></a> 29506       size_hints.max_aspect.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = shell-&gt;wm.size_hints.max_aspect.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L29507' name='L29507'></a> 29507       size_hints.max_aspect.y = shell-&gt;wm.size_hints.max_aspect.y;
<a id='L29508' name='L29508'></a> 29508       size_hints.base_width = shell-&gt;wm.base_width;
<a id='L29509' name='L29509'></a> 29509       size_hints.base_height = shell-&gt;wm.base_height;
<a id='L29510' name='L29510'></a> 29510       size_hints.win_gravity = shell-&gt;wm.win_gravity;
<a id='L29511' name='L29511'></a> 29511 
<a id='L29512' name='L29512'></a> 29512 <em class='sharp'>#ifdef</em> USE_MOTIF
<a id='L29513' name='L29513'></a> 29513       <a href='../S/2169.html#L205' title='Defined at 205 in src/emacsgtkfixed.c.'>XSetWMNormalHints</a> (XtDisplay (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;widget),
<a id='L29514' name='L29514'></a> 29514                          XtWindow (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;widget),
<a id='L29515' name='L29515'></a> 29515                          &amp;size_hints);
<a id='L29516' name='L29516'></a> 29516 <em class='sharp'>#else</em>
<a id='L29517' name='L29517'></a> 29517       <em class='comment'>/* In many cases, widget_update_wm_size_hints will not have</em>
<a id='L29518' name='L29518'></a> 29518 <em class='comment'>         updated the size hints if only flags changed.  When that</em>
<a id='L29519' name='L29519'></a> 29519 <em class='comment'>         happens, set the WM hints manually.  */</em>
<a id='L29520' name='L29520'></a> 29520 
<a id='L29521' name='L29521'></a> 29521       <strong class='reserved'>if</strong> (!hints_changed)
<a id='L29522' name='L29522'></a> 29522         <a href='../S/2169.html#L205' title='Defined at 205 in src/emacsgtkfixed.c.'>XSetWMNormalHints</a> (XtDisplay (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;widget),
<a id='L29523' name='L29523'></a> 29523                            XtWindow (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;widget),
<a id='L29524' name='L29524'></a> 29524                            &amp;size_hints);
<a id='L29525' name='L29525'></a> 29525 <em class='sharp'>#endif</em>
<a id='L29526' name='L29526'></a> 29526 
<a id='L29527' name='L29527'></a> 29527       <strong class='reserved'>return</strong>;
<a id='L29528' name='L29528'></a> 29528     <em class='brace'>}</em>
<a id='L29529' name='L29529'></a> 29529 <em class='sharp'>#endif</em>
<a id='L29530' name='L29530'></a> 29530 
<a id='L29531' name='L29531'></a> 29531   <em class='comment'>/* Setting PMaxSize caused various problems.  */</em>
<a id='L29532' name='L29532'></a> 29532   size_hints.flags = <a href='../D/4990.html' title='Multiple defined in 5 places.'>PResizeInc</a> | <a href='../D/4808.html' title='Multiple defined in 5 places.'>PMinSize</a> <em class='comment'>/* | PMaxSize */</em>;
<a id='L29533' name='L29533'></a> 29533 
<a id='L29534' name='L29534'></a> 29534   size_hints.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;left_pos;
<a id='L29535' name='L29535'></a> 29535   size_hints.y = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;top_pos;
<a id='L29536' name='L29536'></a> 29536 
<a id='L29537' name='L29537'></a> 29537   size_hints.width = <a href='../S/2183.html#L1051' title='Defined at 1051 in src/frame.h.'>FRAME_PIXEL_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L29538' name='L29538'></a> 29538   size_hints.height = <a href='../S/2183.html#L1052' title='Defined at 1052 in src/frame.h.'>FRAME_PIXEL_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L29539' name='L29539'></a> 29539 
<a id='L29540' name='L29540'></a> 29540   size_hints.width_inc = frame_resize_pixelwise ? 1 : <a href='../S/2183.html#L1547' title='Defined at 1547 in src/frame.h.'>FRAME_COLUMN_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L29541' name='L29541'></a> 29541   size_hints.height_inc = frame_resize_pixelwise ? 1 : <a href='../S/2183.html#L1543' title='Defined at 1543 in src/frame.h.'>FRAME_LINE_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L29542' name='L29542'></a> 29542 
<a id='L29543' name='L29543'></a> 29543   size_hints.max_width = x_display_pixel_width (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L29544' name='L29544'></a> 29544     - <a href='../S/2183.html#L1728' title='Defined at 1728 in src/frame.h.'>FRAME_TEXT_COLS_TO_PIXEL_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 0);
<a id='L29545' name='L29545'></a> 29545   size_hints.max_height = x_display_pixel_height (<a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L29546' name='L29546'></a> 29546     - <a href='../S/2183.html#L1734' title='Defined at 1734 in src/frame.h.'>FRAME_TEXT_LINES_TO_PIXEL_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 0);
<a id='L29547' name='L29547'></a> 29547 
<a id='L29548' name='L29548'></a> 29548   <em class='comment'>/* Calculate the base and minimum sizes.  */</em>
<a id='L29549' name='L29549'></a> 29549   <em class='brace'>{</em>
<a id='L29550' name='L29550'></a> 29550     <strong class='reserved'>int</strong> base_width, base_height;
<a id='L29551' name='L29551'></a> 29551 
<a id='L29552' name='L29552'></a> 29552     base_width = <a href='../S/2183.html#L1728' title='Defined at 1728 in src/frame.h.'>FRAME_TEXT_COLS_TO_PIXEL_WIDTH</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 0);
<a id='L29553' name='L29553'></a> 29553     base_height = <a href='../S/2183.html#L1734' title='Defined at 1734 in src/frame.h.'>FRAME_TEXT_LINES_TO_PIXEL_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, 0);
<a id='L29554' name='L29554'></a> 29554 
<a id='L29555' name='L29555'></a> 29555     <em class='comment'>/* The window manager uses the base width hints to calculate the</em>
<a id='L29556' name='L29556'></a> 29556 <em class='comment'>       current number of rows and columns in the frame while</em>
<a id='L29557' name='L29557'></a> 29557 <em class='comment'>       resizing; min_width and min_height aren't useful for this</em>
<a id='L29558' name='L29558'></a> 29558 <em class='comment'>       purpose, since they might not give the dimensions for a</em>
<a id='L29559' name='L29559'></a> 29559 <em class='comment'>       zero-row, zero-column frame.  */</em>
<a id='L29560' name='L29560'></a> 29560 
<a id='L29561' name='L29561'></a> 29561     size_hints.flags |= <a href='../D/4755.html' title='Multiple defined in 5 places.'>PBaseSize</a>;
<a id='L29562' name='L29562'></a> 29562     size_hints.base_width = base_width;
<a id='L29563' name='L29563'></a> 29563     size_hints.base_height = base_height + <a href='../D/2342.html' title='Multiple defined in 3 places.'>FRAME_MENUBAR_HEIGHT</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L29564' name='L29564'></a> 29564     size_hints.min_width  = base_width;
<a id='L29565' name='L29565'></a> 29565     size_hints.min_height = base_height;
<a id='L29566' name='L29566'></a> 29566   <em class='brace'>}</em>
<a id='L29567' name='L29567'></a> 29567 
<a id='L29568' name='L29568'></a> 29568   <em class='comment'>/* If we don't need the old flags, we don't need the old hint at all.  */</em>
<a id='L29569' name='L29569'></a> 29569   <strong class='reserved'>if</strong> (flags)
<a id='L29570' name='L29570'></a> 29570     <em class='brace'>{</em>
<a id='L29571' name='L29571'></a> 29571       size_hints.flags |= flags;
<a id='L29572' name='L29572'></a> 29572       <strong class='reserved'>goto</strong> no_read;
<a id='L29573' name='L29573'></a> 29573     <em class='brace'>}</em>
<a id='L29574' name='L29574'></a> 29574 
<a id='L29575' name='L29575'></a> 29575   <em class='brace'>{</em>
<a id='L29576' name='L29576'></a> 29576     XSizeHints hints;           <em class='comment'>/* Sometimes I hate X Windows... */</em>
<a id='L29577' name='L29577'></a> 29577     <strong class='reserved'>long</strong> supplied_return;
<a id='L29578' name='L29578'></a> 29578     <strong class='reserved'>int</strong> <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>;
<a id='L29579' name='L29579'></a> 29579 
<a id='L29580' name='L29580'></a> 29580     <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a> = XGetWMNormalHints (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, &amp;hints,
<a id='L29581' name='L29581'></a> 29581                                &amp;supplied_return);
<a id='L29582' name='L29582'></a> 29582 
<a id='L29583' name='L29583'></a> 29583     <strong class='reserved'>if</strong> (flags)
<a id='L29584' name='L29584'></a> 29584       size_hints.flags |= flags;
<a id='L29585' name='L29585'></a> 29585     <strong class='reserved'>else</strong>
<a id='L29586' name='L29586'></a> 29586       <em class='brace'>{</em>
<a id='L29587' name='L29587'></a> 29587         <strong class='reserved'>if</strong> (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a> == 0)
<a id='L29588' name='L29588'></a> 29588           hints.flags = 0;
<a id='L29589' name='L29589'></a> 29589         <strong class='reserved'>if</strong> (hints.flags &amp; <a href='../D/5004.html' title='Multiple defined in 5 places.'>PSize</a>)
<a id='L29590' name='L29590'></a> 29590           size_hints.flags |= <a href='../D/5004.html' title='Multiple defined in 5 places.'>PSize</a>;
<a id='L29591' name='L29591'></a> 29591         <strong class='reserved'>if</strong> (hints.flags &amp; <a href='../D/4860.html' title='Multiple defined in 5 places.'>PPosition</a>)
<a id='L29592' name='L29592'></a> 29592           size_hints.flags |= <a href='../D/4860.html' title='Multiple defined in 5 places.'>PPosition</a>;
<a id='L29593' name='L29593'></a> 29593         <strong class='reserved'>if</strong> (hints.flags &amp; <a href='../D/6624.html' title='Multiple defined in 5 places.'>USPosition</a>)
<a id='L29594' name='L29594'></a> 29594           size_hints.flags |= <a href='../D/6624.html' title='Multiple defined in 5 places.'>USPosition</a>;
<a id='L29595' name='L29595'></a> 29595         <strong class='reserved'>if</strong> (hints.flags &amp; <a href='../D/6625.html' title='Multiple defined in 5 places.'>USSize</a>)
<a id='L29596' name='L29596'></a> 29596           size_hints.flags |= <a href='../D/6625.html' title='Multiple defined in 5 places.'>USSize</a>;
<a id='L29597' name='L29597'></a> 29597       <em class='brace'>}</em>
<a id='L29598' name='L29598'></a> 29598   <em class='brace'>}</em>
<a id='L29599' name='L29599'></a> 29599 
<a id='L29600' name='L29600'></a> 29600  no_read:
<a id='L29601' name='L29601'></a> 29601 
<a id='L29602' name='L29602'></a> 29602 <em class='sharp'>#ifdef</em> <a href='../D/5045.html' title='Multiple defined in 5 places.'>PWinGravity</a>
<a id='L29603' name='L29603'></a> 29603   size_hints.win_gravity = <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;win_gravity;
<a id='L29604' name='L29604'></a> 29604   size_hints.flags |= <a href='../D/5045.html' title='Multiple defined in 5 places.'>PWinGravity</a>;
<a id='L29605' name='L29605'></a> 29605 
<a id='L29606' name='L29606'></a> 29606   <strong class='reserved'>if</strong> (user_position)
<a id='L29607' name='L29607'></a> 29607     <em class='brace'>{</em>
<a id='L29608' name='L29608'></a> 29608       size_hints.flags &amp;= ~ <a href='../D/4860.html' title='Multiple defined in 5 places.'>PPosition</a>;
<a id='L29609' name='L29609'></a> 29609       size_hints.flags |= <a href='../D/6624.html' title='Multiple defined in 5 places.'>USPosition</a>;
<a id='L29610' name='L29610'></a> 29610     <em class='brace'>}</em>
<a id='L29611' name='L29611'></a> 29611 <em class='sharp'>#endif</em> <em class='comment'>/* PWinGravity */</em>
<a id='L29612' name='L29612'></a> 29612 
<a id='L29613' name='L29613'></a> 29613   <a href='../S/2169.html#L205' title='Defined at 205 in src/emacsgtkfixed.c.'>XSetWMNormalHints</a> (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, &amp;size_hints);
<a id='L29614' name='L29614'></a> 29614 <em class='sharp'>#else</em>
<a id='L29615' name='L29615'></a> 29615   <a href='../S/2362.html#L1920' title='Defined at 1920 in src/gtkutil.c.'>xg_wm_set_size_hint</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, flags, user_position);
<a id='L29616' name='L29616'></a> 29616 <em class='sharp'>#endif</em> <em class='comment'>/* USE_GTK */</em>
<a id='L29617' name='L29617'></a> 29617 <em class='brace'>}</em>
<a id='L29618' name='L29618'></a> 29618 
<a id='L29619' name='L29619'></a> 29619 <em class='comment'>/* Used for IconicState or NormalState */</em>
<a id='L29620' name='L29620'></a> 29620 
<a id='L29621' name='L29621'></a> 29621 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L29622' name='L29622'></a> 29622 x_wm_set_window_state (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <strong class='reserved'>int</strong> state)
<a id='L29623' name='L29623'></a> 29623 <em class='brace'>{</em>
<a id='L29624' name='L29624'></a> 29624 <em class='sharp'>#ifdef</em> USE_X_TOOLKIT
<a id='L29625' name='L29625'></a> 29625   Arg al[1];
<a id='L29626' name='L29626'></a> 29626 
<a id='L29627' name='L29627'></a> 29627   XtSetArg (al[0], <a href='../S/2289.html#L777' title='Defined at 777 in src/xterm.c.'>XtNinitialState</a>, state);
<a id='L29628' name='L29628'></a> 29628   XtSetValues (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;widget, al, 1);
<a id='L29629' name='L29629'></a> 29629 <em class='sharp'>#else</em> <em class='comment'>/* not USE_X_TOOLKIT */</em>
<a id='L29630' name='L29630'></a> 29630   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L29631' name='L29631'></a> 29631 
<a id='L29632' name='L29632'></a> 29632   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;wm_hints.flags |= StateHint;
<a id='L29633' name='L29633'></a> 29633   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;wm_hints.initial_state = state;
<a id='L29634' name='L29634'></a> 29634 
<a id='L29635' name='L29635'></a> 29635   XSetWMHints (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, &amp;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;wm_hints);
<a id='L29636' name='L29636'></a> 29636 <em class='sharp'>#endif</em> <em class='comment'>/* not USE_X_TOOLKIT */</em>
<a id='L29637' name='L29637'></a> 29637 <em class='brace'>}</em>
<a id='L29638' name='L29638'></a> 29638 
<a id='L29639' name='L29639'></a> 29639 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L29640' name='L29640'></a> 29640 x_wm_set_icon_pixmap (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, ptrdiff_t pixmap_id)
<a id='L29641' name='L29641'></a> 29641 <em class='brace'>{</em>
<a id='L29642' name='L29642'></a> 29642   <a href='../D/5058.html' title='Multiple defined in 2 places.'>Pixmap</a> icon_pixmap, icon_mask;
<a id='L29643' name='L29643'></a> 29643 
<a id='L29644' name='L29644'></a> 29644 <em class='sharp'>#if</em> !<strong class='reserved'>defined</strong> USE_X_TOOLKIT &amp;&amp; !<strong class='reserved'>defined</strong> USE_GTK
<a id='L29645' name='L29645'></a> 29645   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L29646' name='L29646'></a> 29646 <em class='sharp'>#endif</em>
<a id='L29647' name='L29647'></a> 29647 
<a id='L29648' name='L29648'></a> 29648   <strong class='reserved'>if</strong> (pixmap_id &gt; 0)
<a id='L29649' name='L29649'></a> 29649     <em class='brace'>{</em>
<a id='L29650' name='L29650'></a> 29650       icon_pixmap = <a href='../S/2204.html#L424' title='Defined at 424 in src/image.c.'>image_bitmap_pixmap</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, pixmap_id);
<a id='L29651' name='L29651'></a> 29651       <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;wm_hints.icon_pixmap = icon_pixmap;
<a id='L29652' name='L29652'></a> 29652       icon_mask = <a href='../S/2204.html#L433' title='Defined at 433 in src/image.c.'>x_bitmap_mask</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, pixmap_id);
<a id='L29653' name='L29653'></a> 29653       <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;wm_hints.icon_mask = icon_mask;
<a id='L29654' name='L29654'></a> 29654     <em class='brace'>}</em>
<a id='L29655' name='L29655'></a> 29655   <strong class='reserved'>else</strong>
<a id='L29656' name='L29656'></a> 29656     <em class='brace'>{</em>
<a id='L29657' name='L29657'></a> 29657       <em class='comment'>/* It seems there is no way to turn off use of an icon</em>
<a id='L29658' name='L29658'></a> 29658 <em class='comment'>         pixmap.  */</em>
<a id='L29659' name='L29659'></a> 29659       <strong class='reserved'>return</strong>;
<a id='L29660' name='L29660'></a> 29660     <em class='brace'>}</em>
<a id='L29661' name='L29661'></a> 29661 
<a id='L29662' name='L29662'></a> 29662 
<a id='L29663' name='L29663'></a> 29663 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L29664' name='L29664'></a> 29664   <em class='brace'>{</em>
<a id='L29665' name='L29665'></a> 29665     <a href='../S/2362.html#L2196' title='Defined at 2196 in src/gtkutil.c.'>xg_set_frame_icon</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, icon_pixmap, icon_mask);
<a id='L29666' name='L29666'></a> 29666     <strong class='reserved'>return</strong>;
<a id='L29667' name='L29667'></a> 29667   <em class='brace'>}</em>
<a id='L29668' name='L29668'></a> 29668 
<a id='L29669' name='L29669'></a> 29669 <em class='sharp'>#elif</em> <strong class='reserved'>defined</strong> (USE_X_TOOLKIT) <em class='comment'>/* same as in x_wm_set_window_state.  */</em>
<a id='L29670' name='L29670'></a> 29670 
<a id='L29671' name='L29671'></a> 29671   <em class='brace'>{</em>
<a id='L29672' name='L29672'></a> 29672     Arg al[1];
<a id='L29673' name='L29673'></a> 29673     XtSetArg (al[0], XtNiconPixmap, icon_pixmap);
<a id='L29674' name='L29674'></a> 29674     XtSetValues (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;widget, al, 1);
<a id='L29675' name='L29675'></a> 29675     XtSetArg (al[0], XtNiconMask, icon_mask);
<a id='L29676' name='L29676'></a> 29676     XtSetValues (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;widget, al, 1);
<a id='L29677' name='L29677'></a> 29677   <em class='brace'>}</em>
<a id='L29678' name='L29678'></a> 29678 
<a id='L29679' name='L29679'></a> 29679 <em class='sharp'>#else</em> <em class='comment'>/* not USE_X_TOOLKIT &amp;&amp; not USE_GTK */</em>
<a id='L29680' name='L29680'></a> 29680 
<a id='L29681' name='L29681'></a> 29681   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;wm_hints.flags |= (IconPixmapHint | IconMaskHint);
<a id='L29682' name='L29682'></a> 29682   XSetWMHints (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, &amp;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;wm_hints);
<a id='L29683' name='L29683'></a> 29683 
<a id='L29684' name='L29684'></a> 29684 <em class='sharp'>#endif</em> <em class='comment'>/* not USE_X_TOOLKIT &amp;&amp; not USE_GTK */</em>
<a id='L29685' name='L29685'></a> 29685 <em class='brace'>}</em>
<a id='L29686' name='L29686'></a> 29686 
<a id='L29687' name='L29687'></a> 29687 <strong class='reserved'>void</strong>
<a id='L29688' name='L29688'></a> 29688 x_wm_set_icon_position (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <strong class='reserved'>int</strong> icon_x, <strong class='reserved'>int</strong> icon_y)
<a id='L29689' name='L29689'></a> 29689 <em class='brace'>{</em>
<a id='L29690' name='L29690'></a> 29690   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a> = <a href='../D/2367.html' title='Multiple defined in 3 places.'>FRAME_OUTER_WINDOW</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>);
<a id='L29691' name='L29691'></a> 29691 
<a id='L29692' name='L29692'></a> 29692   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;wm_hints.flags |= IconPositionHint;
<a id='L29693' name='L29693'></a> 29693   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;wm_hints.icon_x = icon_x;
<a id='L29694' name='L29694'></a> 29694   <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;wm_hints.icon_y = icon_y;
<a id='L29695' name='L29695'></a> 29695 
<a id='L29696' name='L29696'></a> 29696   XSetWMHints (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), <a href='../S/2317.html#L100' title='Defined at 100 in src/window.h.'>window</a>, &amp;<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2183.html#L648' title='Defined at 648 in src/frame.h.'>output_data</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>-&gt;wm_hints);
<a id='L29697' name='L29697'></a> 29697 <em class='brace'>}</em>
<a id='L29698' name='L29698'></a> 29698 
<a id='L29699' name='L29699'></a> 29699 
<a id='L29700' name='L29700'></a> 29700 <em class='comment'>/***********************************************************************</em>
<a id='L29701' name='L29701'></a> 29701 <em class='comment'>                                Fonts</em>
<a id='L29702' name='L29702'></a> 29702 <em class='comment'> ***********************************************************************/</em>
<a id='L29703' name='L29703'></a> 29703 
<a id='L29704' name='L29704'></a> 29704 <em class='sharp'>#ifdef</em> GLYPH_DEBUG
<a id='L29705' name='L29705'></a> 29705 
<a id='L29706' name='L29706'></a> 29706 <em class='comment'>/* Check that FONT is valid on frame F.  It is if it can be found in F's</em>
<a id='L29707' name='L29707'></a> 29707 <em class='comment'>   font table.  */</em>
<a id='L29708' name='L29708'></a> 29708 
<a id='L29709' name='L29709'></a> 29709 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L29710' name='L29710'></a> 29710 x_check_font (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <strong class='reserved'>struct</strong> <a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a> *<a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>)
<a id='L29711' name='L29711'></a> 29711 <em class='brace'>{</em>
<a id='L29712' name='L29712'></a> 29712   <a href='../D/10871.html' title='Multiple defined in 5 places.'>eassert</a> (<a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a> != <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a> &amp;&amp; ! <a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (<a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>-&gt;<a href='../S/2224.html#L951' title='Defined at 951 in src/xdisp.c.'>props</a>[<a href='../S/2293.html#L76' title='Defined at 76 in src/font.h.'>FONT_TYPE_INDEX</a>]));
<a id='L29713' name='L29713'></a> 29713   <strong class='reserved'>if</strong> (<a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>-&gt;driver-&gt;check)
<a id='L29714' name='L29714'></a> 29714     <a href='../D/10871.html' title='Multiple defined in 5 places.'>eassert</a> (<a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>-&gt;driver-&gt;check (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>) == 0);
<a id='L29715' name='L29715'></a> 29715 <em class='brace'>}</em>
<a id='L29716' name='L29716'></a> 29716 
<a id='L29717' name='L29717'></a> 29717 <em class='sharp'>#endif</em> <em class='comment'>/* GLYPH_DEBUG */</em>
<a id='L29718' name='L29718'></a> 29718 
<a id='L29719' name='L29719'></a> 29719 
<a id='L29720' name='L29720'></a> 29720 <em class='comment'>/***********************************************************************</em>
<a id='L29721' name='L29721'></a> 29721 <em class='comment'>                             Image Hooks</em>
<a id='L29722' name='L29722'></a> 29722 <em class='comment'> ***********************************************************************/</em>
<a id='L29723' name='L29723'></a> 29723 
<a id='L29724' name='L29724'></a> 29724 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L29725' name='L29725'></a> 29725 x_free_pixmap (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>, <a href='../D/1994.html' title='Multiple defined in 7 places.'>Emacs_Pixmap</a> pixmap)
<a id='L29726' name='L29726'></a> 29726 <em class='brace'>{</em>
<a id='L29727' name='L29727'></a> 29727 <em class='sharp'>#ifdef</em> USE_CAIRO
<a id='L29728' name='L29728'></a> 29728   <strong class='reserved'>if</strong> (pixmap)
<a id='L29729' name='L29729'></a> 29729     <em class='brace'>{</em>
<a id='L29730' name='L29730'></a> 29730       <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (pixmap-&gt;data);
<a id='L29731' name='L29731'></a> 29731       <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (pixmap);
<a id='L29732' name='L29732'></a> 29732     <em class='brace'>}</em>
<a id='L29733' name='L29733'></a> 29733 <em class='sharp'>#else</em>
<a id='L29734' name='L29734'></a> 29734   XFreePixmap (<a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>), pixmap);
<a id='L29735' name='L29735'></a> 29735 <em class='sharp'>#endif</em>
<a id='L29736' name='L29736'></a> 29736 <em class='brace'>}</em>
<a id='L29737' name='L29737'></a> 29737 
<a id='L29738' name='L29738'></a> 29738 
<a id='L29739' name='L29739'></a> 29739 <em class='comment'>/***********************************************************************</em>
<a id='L29740' name='L29740'></a> 29740 <em class='comment'>                            Initialization</em>
<a id='L29741' name='L29741'></a> 29741 <em class='comment'> ***********************************************************************/</em>
<a id='L29742' name='L29742'></a> 29742 
<a id='L29743' name='L29743'></a> 29743 <em class='sharp'>#ifdef</em> USE_X_TOOLKIT
<a id='L29744' name='L29744'></a> 29744 <strong class='reserved'>static</strong> XrmOptionDescRec emacs_options[] = <em class='brace'>{</em>
<a id='L29745' name='L29745'></a> 29745   <em class='brace'>{</em>(<strong class='reserved'>char</strong> *) "-geometry", (<strong class='reserved'>char</strong> *) ".geometry", XrmoptionSepArg, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a><em class='brace'>}</em>,
<a id='L29746' name='L29746'></a> 29746   <em class='brace'>{</em>(<strong class='reserved'>char</strong> *) "-iconic", (<strong class='reserved'>char</strong> *) ".iconic", XrmoptionNoArg, (XtPointer) "yes"<em class='brace'>}</em>,
<a id='L29747' name='L29747'></a> 29747 
<a id='L29748' name='L29748'></a> 29748   <em class='brace'>{</em>(<strong class='reserved'>char</strong> *) "-internal-border-width",
<a id='L29749' name='L29749'></a> 29749    (<strong class='reserved'>char</strong> *) "*EmacsScreen.internalBorderWidth", XrmoptionSepArg, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a><em class='brace'>}</em>,
<a id='L29750' name='L29750'></a> 29750   <em class='brace'>{</em>(<strong class='reserved'>char</strong> *) "-ib", (<strong class='reserved'>char</strong> *) "*EmacsScreen.internalBorderWidth",
<a id='L29751' name='L29751'></a> 29751    XrmoptionSepArg, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a><em class='brace'>}</em>,
<a id='L29752' name='L29752'></a> 29752   <em class='brace'>{</em>(<strong class='reserved'>char</strong> *) "-T", (<strong class='reserved'>char</strong> *) "*EmacsShell.title", XrmoptionSepArg, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a><em class='brace'>}</em>,
<a id='L29753' name='L29753'></a> 29753   <em class='brace'>{</em>(<strong class='reserved'>char</strong> *) "-wn", (<strong class='reserved'>char</strong> *) "*EmacsShell.title", XrmoptionSepArg, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a><em class='brace'>}</em>,
<a id='L29754' name='L29754'></a> 29754   <em class='brace'>{</em>(<strong class='reserved'>char</strong> *) "-title", (<strong class='reserved'>char</strong> *) "*EmacsShell.title", XrmoptionSepArg, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a><em class='brace'>}</em>,
<a id='L29755' name='L29755'></a> 29755   <em class='brace'>{</em>(<strong class='reserved'>char</strong> *) "-iconname", (<strong class='reserved'>char</strong> *) "*EmacsShell.iconName",
<a id='L29756' name='L29756'></a> 29756    XrmoptionSepArg, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a><em class='brace'>}</em>,
<a id='L29757' name='L29757'></a> 29757   <em class='brace'>{</em>(<strong class='reserved'>char</strong> *) "-in", (<strong class='reserved'>char</strong> *) "*EmacsShell.iconName", XrmoptionSepArg, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a><em class='brace'>}</em>,
<a id='L29758' name='L29758'></a> 29758   <em class='brace'>{</em>(<strong class='reserved'>char</strong> *) "-mc", (<strong class='reserved'>char</strong> *) "*pointerColor", XrmoptionSepArg, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a><em class='brace'>}</em>,
<a id='L29759' name='L29759'></a> 29759   <em class='brace'>{</em>(<strong class='reserved'>char</strong> *) "-cr", (<strong class='reserved'>char</strong> *) "*cursorColor", XrmoptionSepArg, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a><em class='brace'>}</em>
<a id='L29760' name='L29760'></a> 29760 <em class='brace'>}</em>;
<a id='L29761' name='L29761'></a> 29761 
<a id='L29762' name='L29762'></a> 29762 <em class='comment'>/* Whether atimer for Xt timeouts is activated or not.  */</em>
<a id='L29763' name='L29763'></a> 29763 
<a id='L29764' name='L29764'></a> 29764 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> x_timeout_atimer_activated_flag;
<a id='L29765' name='L29765'></a> 29765 
<a id='L29766' name='L29766'></a> 29766 <em class='sharp'>#endif</em> <em class='comment'>/* USE_X_TOOLKIT */</em>
<a id='L29767' name='L29767'></a> 29767 
<a id='L29768' name='L29768'></a> 29768 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong> x_initialized;
<a id='L29769' name='L29769'></a> 29769 
<a id='L29770' name='L29770'></a> 29770 <em class='comment'>/* Test whether two display-name strings agree up to the dot that separates</em>
<a id='L29771' name='L29771'></a> 29771 <em class='comment'>   the screen number from the server number.  */</em>
<a id='L29772' name='L29772'></a> 29772 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L29773' name='L29773'></a> 29773 <a href='../S/2355.html#L6551' title='Defined at 6551 in src/pgtkterm.c.'>same_x_server</a> (<strong class='reserved'>const</strong> <strong class='reserved'>char</strong> *name1, <strong class='reserved'>const</strong> <strong class='reserved'>char</strong> *name2)
<a id='L29774' name='L29774'></a> 29774 <em class='brace'>{</em>
<a id='L29775' name='L29775'></a> 29775   <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> seen_colon = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L29776' name='L29776'></a> 29776   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> sysname = Fsystem_name ();
<a id='L29777' name='L29777'></a> 29777   <strong class='reserved'>if</strong> (! <a href='../S/2267.html#L1597' title='Defined at 1597 in src/lisp.h.'>STRINGP</a> (sysname))
<a id='L29778' name='L29778'></a> 29778     sysname = empty_unibyte_string;
<a id='L29779' name='L29779'></a> 29779   <strong class='reserved'>const</strong> <strong class='reserved'>char</strong> *system_name = <a href='../D/5917.html' title='Multiple defined in 2 places.'>SSDATA</a> (sysname);
<a id='L29780' name='L29780'></a> 29780   ptrdiff_t system_name_length = <a href='../D/5431.html' title='Multiple defined in 2 places.'>SBYTES</a> (sysname);
<a id='L29781' name='L29781'></a> 29781   ptrdiff_t length_until_period = 0;
<a id='L29782' name='L29782'></a> 29782 
<a id='L29783' name='L29783'></a> 29783   <strong class='reserved'>while</strong> (system_name[length_until_period] != 0
<a id='L29784' name='L29784'></a> 29784          &amp;&amp; system_name[length_until_period] != '.')
<a id='L29785' name='L29785'></a> 29785     length_until_period++;
<a id='L29786' name='L29786'></a> 29786 
<a id='L29787' name='L29787'></a> 29787   <em class='comment'>/* Treat `unix' like an empty host name.  */</em>
<a id='L29788' name='L29788'></a> 29788   <strong class='reserved'>if</strong> (! strncmp (name1, "unix:", 5))
<a id='L29789' name='L29789'></a> 29789     name1 += 4;
<a id='L29790' name='L29790'></a> 29790   <strong class='reserved'>if</strong> (! strncmp (name2, "unix:", 5))
<a id='L29791' name='L29791'></a> 29791     name2 += 4;
<a id='L29792' name='L29792'></a> 29792   <em class='comment'>/* Treat this host's name like an empty host name.  */</em>
<a id='L29793' name='L29793'></a> 29793   <strong class='reserved'>if</strong> (! strncmp (name1, system_name, system_name_length)
<a id='L29794' name='L29794'></a> 29794       &amp;&amp; name1[system_name_length] == ':')
<a id='L29795' name='L29795'></a> 29795     name1 += system_name_length;
<a id='L29796' name='L29796'></a> 29796   <strong class='reserved'>if</strong> (! strncmp (name2, system_name, system_name_length)
<a id='L29797' name='L29797'></a> 29797       &amp;&amp; name2[system_name_length] == ':')
<a id='L29798' name='L29798'></a> 29798     name2 += system_name_length;
<a id='L29799' name='L29799'></a> 29799   <em class='comment'>/* Treat this host's domainless name like an empty host name.  */</em>
<a id='L29800' name='L29800'></a> 29800   <strong class='reserved'>if</strong> (! strncmp (name1, system_name, length_until_period)
<a id='L29801' name='L29801'></a> 29801       &amp;&amp; name1[length_until_period] == ':')
<a id='L29802' name='L29802'></a> 29802     name1 += length_until_period;
<a id='L29803' name='L29803'></a> 29803   <strong class='reserved'>if</strong> (! strncmp (name2, system_name, length_until_period)
<a id='L29804' name='L29804'></a> 29804       &amp;&amp; name2[length_until_period] == ':')
<a id='L29805' name='L29805'></a> 29805     name2 += length_until_period;
<a id='L29806' name='L29806'></a> 29806 
<a id='L29807' name='L29807'></a> 29807   <strong class='reserved'>for</strong> (; *name1 != '\0' &amp;&amp; *name1 == *name2; name1++, name2++)
<a id='L29808' name='L29808'></a> 29808     <em class='brace'>{</em>
<a id='L29809' name='L29809'></a> 29809       <strong class='reserved'>if</strong> (*name1 == ':')
<a id='L29810' name='L29810'></a> 29810         seen_colon = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L29811' name='L29811'></a> 29811       <strong class='reserved'>if</strong> (seen_colon &amp;&amp; *name1 == '.')
<a id='L29812' name='L29812'></a> 29812         <strong class='reserved'>return</strong> <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L29813' name='L29813'></a> 29813     <em class='brace'>}</em>
<a id='L29814' name='L29814'></a> 29814   <strong class='reserved'>return</strong> (seen_colon
<a id='L29815' name='L29815'></a> 29815           &amp;&amp; (*name1 == '.' || *name1 == '\0')
<a id='L29816' name='L29816'></a> 29816           &amp;&amp; (*name2 == '.' || *name2 == '\0'));
<a id='L29817' name='L29817'></a> 29817 <em class='brace'>}</em>
<a id='L29818' name='L29818'></a> 29818 
<a id='L29819' name='L29819'></a> 29819 <em class='comment'>/* Count number of set bits in mask and number of bits to shift to</em>
<a id='L29820' name='L29820'></a> 29820 <em class='comment'>   get to the first bit.  With MASK 0x7e0, *BITS is set to 6, and *OFFSET</em>
<a id='L29821' name='L29821'></a> 29821 <em class='comment'>   to 5.  */</em>
<a id='L29822' name='L29822'></a> 29822 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L29823' name='L29823'></a> 29823 get_bits_and_offset (<strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> mask, <strong class='reserved'>int</strong> *<a href='../S/2358.html#L1062' title='Defined at 1062 in src/emacs-module.c.'>bits</a>, <strong class='reserved'>int</strong> *<a href='../D/15084.html' title='Multiple defined in 4 places.'>offset</a>)
<a id='L29824' name='L29824'></a> 29824 <em class='brace'>{</em>
<a id='L29825' name='L29825'></a> 29825   <strong class='reserved'>int</strong> nr = 0;
<a id='L29826' name='L29826'></a> 29826   <strong class='reserved'>int</strong> <a href='../D/15081.html' title='Multiple defined in 3 places.'>off</a> = 0;
<a id='L29827' name='L29827'></a> 29827 
<a id='L29828' name='L29828'></a> 29828   <strong class='reserved'>while</strong> (!(mask &amp; 1))
<a id='L29829' name='L29829'></a> 29829     <em class='brace'>{</em>
<a id='L29830' name='L29830'></a> 29830       <a href='../D/15081.html' title='Multiple defined in 3 places.'>off</a>++;
<a id='L29831' name='L29831'></a> 29831       mask &gt;&gt;= 1;
<a id='L29832' name='L29832'></a> 29832     <em class='brace'>}</em>
<a id='L29833' name='L29833'></a> 29833 
<a id='L29834' name='L29834'></a> 29834   <strong class='reserved'>while</strong> (mask &amp; 1)
<a id='L29835' name='L29835'></a> 29835     <em class='brace'>{</em>
<a id='L29836' name='L29836'></a> 29836       nr++;
<a id='L29837' name='L29837'></a> 29837       mask &gt;&gt;= 1;
<a id='L29838' name='L29838'></a> 29838     <em class='brace'>}</em>
<a id='L29839' name='L29839'></a> 29839 
<a id='L29840' name='L29840'></a> 29840   *<a href='../D/15084.html' title='Multiple defined in 4 places.'>offset</a> = <a href='../D/15081.html' title='Multiple defined in 3 places.'>off</a>;
<a id='L29841' name='L29841'></a> 29841   *<a href='../S/2358.html#L1062' title='Defined at 1062 in src/emacs-module.c.'>bits</a> = nr;
<a id='L29842' name='L29842'></a> 29842 <em class='brace'>}</em>
<a id='L29843' name='L29843'></a> 29843 
<a id='L29844' name='L29844'></a> 29844 <em class='comment'>/* Return true iff display DISPLAY is available for use.</em>
<a id='L29845' name='L29845'></a> 29845 <em class='comment'>   But don't permanently open it, just test its availability.  */</em>
<a id='L29846' name='L29846'></a> 29846 
<a id='L29847' name='L29847'></a> 29847 <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L29848' name='L29848'></a> 29848 x_display_ok (<strong class='reserved'>const</strong> <strong class='reserved'>char</strong> *<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>)
<a id='L29849' name='L29849'></a> 29849 <em class='brace'>{</em>
<a id='L29850' name='L29850'></a> 29850   <em class='comment'>/* XOpenDisplay fails if it gets a signal.  Block SIGIO which may arrive.  */</em>
<a id='L29851' name='L29851'></a> 29851   <a href='../S/2286.html#L840' title='Defined at 840 in src/sysdep.c.'>unrequest_sigio</a> ();
<a id='L29852' name='L29852'></a> 29852   <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy = XOpenDisplay (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L29853' name='L29853'></a> 29853   <a href='../S/2286.html#L816' title='Defined at 816 in src/sysdep.c.'>request_sigio</a> ();
<a id='L29854' name='L29854'></a> 29854   <strong class='reserved'>if</strong> (!dpy)
<a id='L29855' name='L29855'></a> 29855     <strong class='reserved'>return</strong> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L29856' name='L29856'></a> 29856   XCloseDisplay (dpy);
<a id='L29857' name='L29857'></a> 29857   <strong class='reserved'>return</strong> <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L29858' name='L29858'></a> 29858 <em class='brace'>}</em>
<a id='L29859' name='L29859'></a> 29859 
<a id='L29860' name='L29860'></a> 29860 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L29861' name='L29861'></a> 29861 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L29862' name='L29862'></a> 29862 <a href='../D/14904.html' title='Multiple defined in 2 places.'>my_log_handler</a> (<strong class='reserved'>const</strong> gchar *log_domain, GLogLevelFlags log_level,
<a id='L29863' name='L29863'></a> 29863                 <strong class='reserved'>const</strong> gchar *msg, gpointer user_data)
<a id='L29864' name='L29864'></a> 29864 <em class='brace'>{</em>
<a id='L29865' name='L29865'></a> 29865   <strong class='reserved'>if</strong> (!<a href='../D/17790.html' title='Multiple defined in 2 places.'>strstr</a> (msg, "g_set_prgname"))
<a id='L29866' name='L29866'></a> 29866       <a href='../D/11675.html' title='Multiple defined in 4 places.'>fprintf</a> (<a href='../S/20.html#L50' title='Defined at 50 in nt/cmdproxy.c.'>stderr</a>, "%s-WARNING **: %s\n", log_domain, msg);
<a id='L29867' name='L29867'></a> 29867 <em class='brace'>}</em>
<a id='L29868' name='L29868'></a> 29868 <em class='sharp'>#endif</em>
<a id='L29869' name='L29869'></a> 29869 
<a id='L29870' name='L29870'></a> 29870 <em class='comment'>/* Current X display connection identifier.  Incremented for each next</em>
<a id='L29871' name='L29871'></a> 29871 <em class='comment'>   connection established.  */</em>
<a id='L29872' name='L29872'></a> 29872 <strong class='reserved'>static</strong> <strong class='reserved'>unsigned</strong> x_display_id;
<a id='L29873' name='L29873'></a> 29873 
<a id='L29874' name='L29874'></a> 29874 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XINPUT2 &amp;&amp; !<strong class='reserved'>defined</strong> HAVE_GTK3
<a id='L29875' name='L29875'></a> 29875 
<a id='L29876' name='L29876'></a> 29876 <em class='comment'>/* Select for device change events on the root window of DPYINFO.</em>
<a id='L29877' name='L29877'></a> 29877 <em class='comment'>   These include device change and hierarchy change notifications.  */</em>
<a id='L29878' name='L29878'></a> 29878 
<a id='L29879' name='L29879'></a> 29879 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L29880' name='L29880'></a> 29880 xi_select_hierarchy_events (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo)
<a id='L29881' name='L29881'></a> 29881 <em class='brace'>{</em>
<a id='L29882' name='L29882'></a> 29882   XIEventMask mask;
<a id='L29883' name='L29883'></a> 29883   ptrdiff_t l;
<a id='L29884' name='L29884'></a> 29884   <strong class='reserved'>unsigned</strong> <strong class='reserved'>char</strong> *m;
<a id='L29885' name='L29885'></a> 29885 
<a id='L29886' name='L29886'></a> 29886   l = XIMaskLen (XI_LASTEVENT);
<a id='L29887' name='L29887'></a> 29887   mask.mask = m = <a href='../D/8439.html' title='Multiple defined in 8 places.'>alloca</a> (l);
<a id='L29888' name='L29888'></a> 29888   memset (m, 0, l);
<a id='L29889' name='L29889'></a> 29889   mask.mask_len = l;
<a id='L29890' name='L29890'></a> 29890 
<a id='L29891' name='L29891'></a> 29891   mask.deviceid = XIAllDevices;
<a id='L29892' name='L29892'></a> 29892 
<a id='L29893' name='L29893'></a> 29893   XISetMask (m, XI_PropertyEvent);
<a id='L29894' name='L29894'></a> 29894   XISetMask (m, XI_HierarchyChanged);
<a id='L29895' name='L29895'></a> 29895   XISetMask (m, XI_DeviceChanged);
<a id='L29896' name='L29896'></a> 29896 
<a id='L29897' name='L29897'></a> 29897   XISelectEvents (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, dpyinfo-&gt;root_window,
<a id='L29898' name='L29898'></a> 29898                   &amp;mask, 1);
<a id='L29899' name='L29899'></a> 29899 <em class='brace'>}</em>
<a id='L29900' name='L29900'></a> 29900 
<a id='L29901' name='L29901'></a> 29901 <em class='sharp'>#endif</em>
<a id='L29902' name='L29902'></a> 29902 
<a id='L29903' name='L29903'></a> 29903 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XINPUT2 &amp;&amp; <strong class='reserved'>defined</strong> HAVE_GTK3
<a id='L29904' name='L29904'></a> 29904 
<a id='L29905' name='L29905'></a> 29905 <em class='comment'>/* Look up whether or not GTK already initialized the X input</em>
<a id='L29906' name='L29906'></a> 29906 <em class='comment'>   extension.</em>
<a id='L29907' name='L29907'></a> 29907 <em class='comment'></em>
<a id='L29908' name='L29908'></a> 29908 <em class='comment'>   Value is 0 if GTK was not built with the input extension, or if it</em>
<a id='L29909' name='L29909'></a> 29909 <em class='comment'>   was explicitly disabled, 1 if GTK enabled the input extension and</em>
<a id='L29910' name='L29910'></a> 29910 <em class='comment'>   the version was successfully determined, and 2 if that information</em>
<a id='L29911' name='L29911'></a> 29911 <em class='comment'>   could not be determined.  */</em>
<a id='L29912' name='L29912'></a> 29912 
<a id='L29913' name='L29913'></a> 29913 <strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L29914' name='L29914'></a> 29914 xi_check_toolkit (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>)
<a id='L29915' name='L29915'></a> 29915 <em class='brace'>{</em>
<a id='L29916' name='L29916'></a> 29916   GdkDisplay *gdpy;
<a id='L29917' name='L29917'></a> 29917   GdkDeviceManager *manager;
<a id='L29918' name='L29918'></a> 29918 
<a id='L29919' name='L29919'></a> 29919   gdpy = gdk_x11_lookup_xdisplay (<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L29920' name='L29920'></a> 29920   <a href='../D/10872.html' title='Multiple defined in 5 places.'>eassume</a> (gdpy);
<a id='L29921' name='L29921'></a> 29921   manager = gdk_display_get_device_manager (gdpy);
<a id='L29922' name='L29922'></a> 29922 
<a id='L29923' name='L29923'></a> 29923   <strong class='reserved'>if</strong> (!strcmp (G_OBJECT_TYPE_NAME (manager),
<a id='L29924' name='L29924'></a> 29924                "GdkX11DeviceManagerXI2"))
<a id='L29925' name='L29925'></a> 29925     <strong class='reserved'>return</strong> 1;
<a id='L29926' name='L29926'></a> 29926 
<a id='L29927' name='L29927'></a> 29927   <strong class='reserved'>if</strong> (!strcmp (G_OBJECT_TYPE_NAME (manager),
<a id='L29928' name='L29928'></a> 29928                "GdkX11DeviceManagerCore"))
<a id='L29929' name='L29929'></a> 29929     <strong class='reserved'>return</strong> 0;
<a id='L29930' name='L29930'></a> 29930 
<a id='L29931' name='L29931'></a> 29931   <em class='comment'>/* Something changed in GDK so this information is no longer</em>
<a id='L29932' name='L29932'></a> 29932 <em class='comment'>     available.  */</em>
<a id='L29933' name='L29933'></a> 29933 
<a id='L29934' name='L29934'></a> 29934   <strong class='reserved'>return</strong> 2;
<a id='L29935' name='L29935'></a> 29935 <em class='brace'>}</em>
<a id='L29936' name='L29936'></a> 29936 
<a id='L29937' name='L29937'></a> 29937 <em class='sharp'>#endif</em>
<a id='L29938' name='L29938'></a> 29938 
<a id='L29939' name='L29939'></a> 29939 <em class='comment'>/* Open a connection to X display DISPLAY_NAME, and return the</em>
<a id='L29940' name='L29940'></a> 29940 <em class='comment'>   structure that describes the open display.  If obtaining the XCB</em>
<a id='L29941' name='L29941'></a> 29941 <em class='comment'>   connection or toolkit-specific display fails, return NULL.  Signal</em>
<a id='L29942' name='L29942'></a> 29942 <em class='comment'>   an error if opening the display itself failed.  */</em>
<a id='L29943' name='L29943'></a> 29943 
<a id='L29944' name='L29944'></a> 29944 <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *
<a id='L29945' name='L29945'></a> 29945 x_term_init (<a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> display_name, <strong class='reserved'>char</strong> *xrm_option, <strong class='reserved'>char</strong> *resource_name)
<a id='L29946' name='L29946'></a> 29946 <em class='brace'>{</em>
<a id='L29947' name='L29947'></a> 29947   <a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *dpy;
<a id='L29948' name='L29948'></a> 29948   XKeyboardState keyboard_state;
<a id='L29949' name='L29949'></a> 29949   <strong class='reserved'>struct</strong> <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a> *<a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>;
<a id='L29950' name='L29950'></a> 29950   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L29951' name='L29951'></a> 29951   <a href='../S/2150.html#L53' title='Defined at 53 in src/pgtkgui.h.'>XrmDatabase</a> xrdb;
<a id='L29952' name='L29952'></a> 29952   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> tem, quit_keysym;
<a id='L29953' name='L29953'></a> 29953 <em class='sharp'>#ifdef</em> USE_XCB
<a id='L29954' name='L29954'></a> 29954   xcb_connection_t *xcb_conn;
<a id='L29955' name='L29955'></a> 29955 <em class='sharp'>#endif</em>
<a id='L29956' name='L29956'></a> 29956   <strong class='reserved'>static</strong> <strong class='reserved'>char</strong> <strong class='reserved'>const</strong> cm_atom_fmt[] = "_NET_WM_CM_S%d";
<a id='L29957' name='L29957'></a> 29957   <strong class='reserved'>char</strong> cm_atom_sprintf[<strong class='reserved'>sizeof</strong> cm_atom_fmt - 2 + <a href='../S/2707.html#L66' title='Defined at 66 in lib/intprops.h.'>INT_STRLEN_BOUND</a> (<strong class='reserved'>int</strong>)];
<a id='L29958' name='L29958'></a> 29958 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L29959' name='L29959'></a> 29959   GdkDisplay *gdpy;
<a id='L29960' name='L29960'></a> 29960   GdkScreen *gscr;
<a id='L29961' name='L29961'></a> 29961 <em class='sharp'>#endif</em>
<a id='L29962' name='L29962'></a> 29962 <em class='sharp'>#ifdef</em> HAVE_XFIXES
<a id='L29963' name='L29963'></a> 29963   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> lisp_name;
<a id='L29964' name='L29964'></a> 29964   <strong class='reserved'>int</strong> num_fast_selections;
<a id='L29965' name='L29965'></a> 29965   Atom selection_name;
<a id='L29966' name='L29966'></a> 29966 <em class='sharp'>#ifdef</em> USE_XCB
<a id='L29967' name='L29967'></a> 29967   xcb_get_selection_owner_cookie_t *selection_cookies;
<a id='L29968' name='L29968'></a> 29968   xcb_get_selection_owner_reply_t *selection_reply;
<a id='L29969' name='L29969'></a> 29969   xcb_generic_error_t *selection_error;
<a id='L29970' name='L29970'></a> 29970 <em class='sharp'>#endif</em>
<a id='L29971' name='L29971'></a> 29971 <em class='sharp'>#endif</em>
<a id='L29972' name='L29972'></a> 29972   <strong class='reserved'>int</strong> i;
<a id='L29973' name='L29973'></a> 29973 
<a id='L29974' name='L29974'></a> 29974 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XFIXES &amp;&amp; <strong class='reserved'>defined</strong> USE_XCB
<a id='L29975' name='L29975'></a> 29975   <a href='../D/6613.html' title='Multiple defined in 2 places.'>USE_SAFE_ALLOCA</a>;
<a id='L29976' name='L29976'></a> 29976 <em class='sharp'>#endif</em>
<a id='L29977' name='L29977'></a> 29977 
<a id='L29978' name='L29978'></a> 29978   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L29979' name='L29979'></a> 29979 
<a id='L29980' name='L29980'></a> 29980   <strong class='reserved'>if</strong> (!x_initialized)
<a id='L29981' name='L29981'></a> 29981     <em class='brace'>{</em>
<a id='L29982' name='L29982'></a> 29982       x_initialize ();
<a id='L29983' name='L29983'></a> 29983       ++x_initialized;
<a id='L29984' name='L29984'></a> 29984     <em class='brace'>}</em>
<a id='L29985' name='L29985'></a> 29985 
<a id='L29986' name='L29986'></a> 29986 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> USE_X_TOOLKIT || <strong class='reserved'>defined</strong> USE_GTK
<a id='L29987' name='L29987'></a> 29987 
<a id='L29988' name='L29988'></a> 29988   <strong class='reserved'>if</strong> (!x_display_ok (<a href='../D/5917.html' title='Multiple defined in 2 places.'>SSDATA</a> (display_name)))
<a id='L29989' name='L29989'></a> 29989     <a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a> ("Display %s can't be opened", <a href='../D/5917.html' title='Multiple defined in 2 places.'>SSDATA</a> (display_name));
<a id='L29990' name='L29990'></a> 29990 
<a id='L29991' name='L29991'></a> 29991 <em class='sharp'>#endif</em>
<a id='L29992' name='L29992'></a> 29992 
<a id='L29993' name='L29993'></a> 29993 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L29994' name='L29994'></a> 29994   <em class='brace'>{</em>
<a id='L29995' name='L29995'></a> 29995 <em class='sharp'>#define</em> <a href='../R/4091.html' title='Multiple referred from 4 places.'>NUM_ARGV</a> 10
<a id='L29996' name='L29996'></a> 29996     <strong class='reserved'>int</strong> argc;
<a id='L29997' name='L29997'></a> 29997     <strong class='reserved'>char</strong> *argv[<a href='../D/4550.html' title='Multiple defined in 2 places.'>NUM_ARGV</a>];
<a id='L29998' name='L29998'></a> 29998     <strong class='reserved'>char</strong> **argv2 = argv;
<a id='L29999' name='L29999'></a> 29999     guint id;
<a id='L30000' name='L30000'></a> 30000 
<a id='L30001' name='L30001'></a> 30001     <strong class='reserved'>if</strong> (x_initialized++ &gt; 1)
<a id='L30002' name='L30002'></a> 30002       <em class='brace'>{</em>
<a id='L30003' name='L30003'></a> 30003         <a href='../S/2362.html#L237' title='Defined at 237 in src/gtkutil.c.'>xg_display_open</a> (<a href='../D/5917.html' title='Multiple defined in 2 places.'>SSDATA</a> (display_name), &amp;dpy);
<a id='L30004' name='L30004'></a> 30004       <em class='brace'>}</em>
<a id='L30005' name='L30005'></a> 30005     <strong class='reserved'>else</strong>
<a id='L30006' name='L30006'></a> 30006       <em class='brace'>{</em>
<a id='L30007' name='L30007'></a> 30007         <strong class='reserved'>static</strong> <strong class='reserved'>char</strong> display_opt[] = "--display";
<a id='L30008' name='L30008'></a> 30008         <strong class='reserved'>static</strong> <strong class='reserved'>char</strong> name_opt[] = "--name";
<a id='L30009' name='L30009'></a> 30009 
<a id='L30010' name='L30010'></a> 30010         <strong class='reserved'>for</strong> (argc = 0; argc &lt; <a href='../D/4550.html' title='Multiple defined in 2 places.'>NUM_ARGV</a>; ++argc)
<a id='L30011' name='L30011'></a> 30011           argv[argc] = 0;
<a id='L30012' name='L30012'></a> 30012 
<a id='L30013' name='L30013'></a> 30013         argc = 0;
<a id='L30014' name='L30014'></a> 30014         argv[argc++] = initial_argv[0];
<a id='L30015' name='L30015'></a> 30015 
<a id='L30016' name='L30016'></a> 30016         <strong class='reserved'>if</strong> (! <a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (display_name))
<a id='L30017' name='L30017'></a> 30017           <em class='brace'>{</em>
<a id='L30018' name='L30018'></a> 30018             argv[argc++] = display_opt;
<a id='L30019' name='L30019'></a> 30019             argv[argc++] = <a href='../D/5917.html' title='Multiple defined in 2 places.'>SSDATA</a> (display_name);
<a id='L30020' name='L30020'></a> 30020           <em class='brace'>}</em>
<a id='L30021' name='L30021'></a> 30021 
<a id='L30022' name='L30022'></a> 30022         argv[argc++] = name_opt;
<a id='L30023' name='L30023'></a> 30023         argv[argc++] = resource_name;
<a id='L30024' name='L30024'></a> 30024 
<a id='L30025' name='L30025'></a> 30025         XSetLocaleModifiers ("");
<a id='L30026' name='L30026'></a> 30026 
<a id='L30027' name='L30027'></a> 30027         <em class='comment'>/* Work around GLib bug that outputs a faulty warning. See</em>
<a id='L30028' name='L30028'></a> 30028 <em class='comment'>           https://bugzilla.gnome.org/show_bug.cgi?id=563627.  */</em>
<a id='L30029' name='L30029'></a> 30029         id = g_log_set_handler ("GLib", G_LOG_LEVEL_WARNING | G_LOG_FLAG_FATAL
<a id='L30030' name='L30030'></a> 30030                                   | G_LOG_FLAG_RECURSION, <a href='../D/14904.html' title='Multiple defined in 2 places.'>my_log_handler</a>, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L30031' name='L30031'></a> 30031 
<a id='L30032' name='L30032'></a> 30032         <em class='comment'>/* NULL window -&gt; events for all windows go to our function.</em>
<a id='L30033' name='L30033'></a> 30033 <em class='comment'>           Call before gtk_init so Gtk+ event filters comes after our.  */</em>
<a id='L30034' name='L30034'></a> 30034         gdk_window_add_filter (<a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, event_handler_gdk, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L30035' name='L30035'></a> 30035 
<a id='L30036' name='L30036'></a> 30036         <em class='comment'>/* gtk_init does set_locale.  Fix locale before and after.  */</em>
<a id='L30037' name='L30037'></a> 30037         <a href='../D/11507.html' title='Multiple defined in 3 places.'>fixup_locale</a> ();
<a id='L30038' name='L30038'></a> 30038         <a href='../S/2286.html#L840' title='Defined at 840 in src/sysdep.c.'>unrequest_sigio</a> (); <em class='comment'>/* See comment in x_display_ok.  */</em>
<a id='L30039' name='L30039'></a> 30039         gtk_init (&amp;argc, &amp;argv2);
<a id='L30040' name='L30040'></a> 30040         <a href='../S/2286.html#L816' title='Defined at 816 in src/sysdep.c.'>request_sigio</a> ();
<a id='L30041' name='L30041'></a> 30041 
<a id='L30042' name='L30042'></a> 30042         g_log_remove_handler ("GLib", id);
<a id='L30043' name='L30043'></a> 30043 
<a id='L30044' name='L30044'></a> 30044         <a href='../S/2362.html#L6178' title='Defined at 6178 in src/gtkutil.c.'>xg_initialize</a> ();
<a id='L30045' name='L30045'></a> 30045 
<a id='L30046' name='L30046'></a> 30046         <em class='comment'>/* Do this after the call to xg_initialize, because when</em>
<a id='L30047' name='L30047'></a> 30047 <em class='comment'>           Fontconfig is used, xg_initialize calls its initialization</em>
<a id='L30048' name='L30048'></a> 30048 <em class='comment'>           function which in some versions of Fontconfig calls setlocale.  */</em>
<a id='L30049' name='L30049'></a> 30049         <a href='../D/11507.html' title='Multiple defined in 3 places.'>fixup_locale</a> ();
<a id='L30050' name='L30050'></a> 30050 
<a id='L30051' name='L30051'></a> 30051         dpy = <a href='../D/1427.html' title='Multiple defined in 3 places.'>DEFAULT_GDK_DISPLAY</a> ();
<a id='L30052' name='L30052'></a> 30052 
<a id='L30053' name='L30053'></a> 30053 <em class='sharp'>#ifndef</em> HAVE_GTK3
<a id='L30054' name='L30054'></a> 30054         <em class='comment'>/* Load our own gtkrc if it exists.  */</em>
<a id='L30055' name='L30055'></a> 30055         <em class='brace'>{</em>
<a id='L30056' name='L30056'></a> 30056           <strong class='reserved'>const</strong> <strong class='reserved'>char</strong> *file = "~/.emacs.d/gtkrc";
<a id='L30057' name='L30057'></a> 30057           <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> s, abs_file;
<a id='L30058' name='L30058'></a> 30058 
<a id='L30059' name='L30059'></a> 30059           s = <a href='../D/9420.html' title='Multiple defined in 2 places.'>build_string</a> (file);
<a id='L30060' name='L30060'></a> 30060           abs_file = Fexpand_file_name (s, Qnil);
<a id='L30061' name='L30061'></a> 30061 
<a id='L30062' name='L30062'></a> 30062           <strong class='reserved'>if</strong> (! <a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (abs_file) &amp;&amp; !<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (Ffile_readable_p (abs_file)))
<a id='L30063' name='L30063'></a> 30063             gtk_rc_parse (<a href='../D/5917.html' title='Multiple defined in 2 places.'>SSDATA</a> (abs_file));
<a id='L30064' name='L30064'></a> 30064         <em class='brace'>}</em>
<a id='L30065' name='L30065'></a> 30065 <em class='sharp'>#endif</em>
<a id='L30066' name='L30066'></a> 30066 
<a id='L30067' name='L30067'></a> 30067         XSetErrorHandler (x_error_handler);
<a id='L30068' name='L30068'></a> 30068         XSetIOErrorHandler (x_io_error_quitter);
<a id='L30069' name='L30069'></a> 30069       <em class='brace'>}</em>
<a id='L30070' name='L30070'></a> 30070   <em class='brace'>}</em>
<a id='L30071' name='L30071'></a> 30071 <em class='sharp'>#else</em> <em class='comment'>/* not USE_GTK */</em>
<a id='L30072' name='L30072'></a> 30072 <em class='sharp'>#ifdef</em> USE_X_TOOLKIT
<a id='L30073' name='L30073'></a> 30073   <em class='comment'>/* weiner@footloose.sps.mot.com reports that this causes</em>
<a id='L30074' name='L30074'></a> 30074 <em class='comment'>     errors with X11R5:</em>
<a id='L30075' name='L30075'></a> 30075 <em class='comment'>           X protocol error: BadAtom (invalid Atom parameter)</em>
<a id='L30076' name='L30076'></a> 30076 <em class='comment'>           on protocol request 18skiloaf.</em>
<a id='L30077' name='L30077'></a> 30077 <em class='comment'>     So let's not use it until R6.  */</em>
<a id='L30078' name='L30078'></a> 30078 <em class='sharp'>#ifdef</em> HAVE_X11XTR6
<a id='L30079' name='L30079'></a> 30079   XtSetLanguageProc (<a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L30080' name='L30080'></a> 30080 <em class='sharp'>#endif</em>
<a id='L30081' name='L30081'></a> 30081 
<a id='L30082' name='L30082'></a> 30082   <em class='brace'>{</em>
<a id='L30083' name='L30083'></a> 30083     <strong class='reserved'>int</strong> argc = 0;
<a id='L30084' name='L30084'></a> 30084     <strong class='reserved'>char</strong> *argv[3];
<a id='L30085' name='L30085'></a> 30085 
<a id='L30086' name='L30086'></a> 30086     argv[0] = (<strong class='reserved'>char</strong> *) "";
<a id='L30087' name='L30087'></a> 30087     argc = 1;
<a id='L30088' name='L30088'></a> 30088     <strong class='reserved'>if</strong> (xrm_option)
<a id='L30089' name='L30089'></a> 30089       <em class='brace'>{</em>
<a id='L30090' name='L30090'></a> 30090         argv[argc++] = (<strong class='reserved'>char</strong> *) "-xrm";
<a id='L30091' name='L30091'></a> 30091         argv[argc++] = xrm_option;
<a id='L30092' name='L30092'></a> 30092       <em class='brace'>}</em>
<a id='L30093' name='L30093'></a> 30093     <a href='../S/2123.html#L470' title='Defined at 470 in src/atimer.c.'>turn_on_atimers</a> (<a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L30094' name='L30094'></a> 30094     <a href='../S/2286.html#L840' title='Defined at 840 in src/sysdep.c.'>unrequest_sigio</a> ();  <em class='comment'>/* See comment in x_display_ok.  */</em>
<a id='L30095' name='L30095'></a> 30095     dpy = XtOpenDisplay (Xt_app_con, <a href='../D/5917.html' title='Multiple defined in 2 places.'>SSDATA</a> (display_name),
<a id='L30096' name='L30096'></a> 30096                          resource_name, <a href='../S/2183.html#L1826' title='Defined at 1826 in src/frame.h.'>EMACS_CLASS</a>,
<a id='L30097' name='L30097'></a> 30097                          emacs_options, XtNumber (emacs_options),
<a id='L30098' name='L30098'></a> 30098                          &amp;argc, argv);
<a id='L30099' name='L30099'></a> 30099     <a href='../S/2286.html#L816' title='Defined at 816 in src/sysdep.c.'>request_sigio</a> ();
<a id='L30100' name='L30100'></a> 30100     <a href='../S/2123.html#L470' title='Defined at 470 in src/atimer.c.'>turn_on_atimers</a> (<a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>);
<a id='L30101' name='L30101'></a> 30101 
<a id='L30102' name='L30102'></a> 30102 <em class='sharp'>#ifdef</em> HAVE_X11XTR6
<a id='L30103' name='L30103'></a> 30103     <em class='comment'>/* I think this is to compensate for XtSetLanguageProc.  */</em>
<a id='L30104' name='L30104'></a> 30104     <a href='../D/11507.html' title='Multiple defined in 3 places.'>fixup_locale</a> ();
<a id='L30105' name='L30105'></a> 30105 <em class='sharp'>#endif</em>
<a id='L30106' name='L30106'></a> 30106   <em class='brace'>}</em>
<a id='L30107' name='L30107'></a> 30107 
<a id='L30108' name='L30108'></a> 30108 <em class='sharp'>#else</em> <em class='comment'>/* not USE_X_TOOLKIT */</em>
<a id='L30109' name='L30109'></a> 30109   XSetLocaleModifiers ("");
<a id='L30110' name='L30110'></a> 30110   <a href='../S/2286.html#L840' title='Defined at 840 in src/sysdep.c.'>unrequest_sigio</a> ();  <em class='comment'>/* See comment in x_display_ok.  */</em>
<a id='L30111' name='L30111'></a> 30111   dpy = XOpenDisplay (<a href='../D/5917.html' title='Multiple defined in 2 places.'>SSDATA</a> (display_name));
<a id='L30112' name='L30112'></a> 30112   <a href='../S/2286.html#L816' title='Defined at 816 in src/sysdep.c.'>request_sigio</a> ();
<a id='L30113' name='L30113'></a> 30113 <em class='sharp'>#endif</em> <em class='comment'>/* not USE_X_TOOLKIT */</em>
<a id='L30114' name='L30114'></a> 30114 <em class='sharp'>#endif</em> <em class='comment'>/* not USE_GTK*/</em>
<a id='L30115' name='L30115'></a> 30115 
<a id='L30116' name='L30116'></a> 30116   <em class='comment'>/* Detect failure.  */</em>
<a id='L30117' name='L30117'></a> 30117   <strong class='reserved'>if</strong> (dpy == 0)
<a id='L30118' name='L30118'></a> 30118     <em class='brace'>{</em>
<a id='L30119' name='L30119'></a> 30119 <em class='sharp'>#if</em> !<strong class='reserved'>defined</strong> USE_X_TOOLKIT &amp;&amp; !<strong class='reserved'>defined</strong> USE_GTK
<a id='L30120' name='L30120'></a> 30120       <em class='comment'>/* Avoid opening a display three times (once in dispextern.c</em>
<a id='L30121' name='L30121'></a> 30121 <em class='comment'>         upon startup, once in x_display_ok, and once above) to</em>
<a id='L30122' name='L30122'></a> 30122 <em class='comment'>         determine whether or not the display is alive on no toolkit</em>
<a id='L30123' name='L30123'></a> 30123 <em class='comment'>         builds, where no toolkit initialization happens at all.  */</em>
<a id='L30124' name='L30124'></a> 30124 
<a id='L30125' name='L30125'></a> 30125       <a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a> ("Display %s can't be opened", <a href='../D/5917.html' title='Multiple defined in 2 places.'>SSDATA</a> (display_name));
<a id='L30126' name='L30126'></a> 30126 <em class='sharp'>#endif</em>
<a id='L30127' name='L30127'></a> 30127 
<a id='L30128' name='L30128'></a> 30128       <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L30129' name='L30129'></a> 30129 
<a id='L30130' name='L30130'></a> 30130 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XFIXES &amp;&amp; <strong class='reserved'>defined</strong> USE_XCB
<a id='L30131' name='L30131'></a> 30131       <a href='../D/5394.html' title='Multiple defined in 2 places.'>SAFE_FREE</a> ();
<a id='L30132' name='L30132'></a> 30132 <em class='sharp'>#endif</em>
<a id='L30133' name='L30133'></a> 30133       <strong class='reserved'>return</strong> 0;
<a id='L30134' name='L30134'></a> 30134     <em class='brace'>}</em>
<a id='L30135' name='L30135'></a> 30135 
<a id='L30136' name='L30136'></a> 30136 <em class='sharp'>#ifdef</em> USE_XCB
<a id='L30137' name='L30137'></a> 30137   xcb_conn = XGetXCBConnection (dpy);
<a id='L30138' name='L30138'></a> 30138   <strong class='reserved'>if</strong> (!xcb_conn)
<a id='L30139' name='L30139'></a> 30139     <em class='brace'>{</em>
<a id='L30140' name='L30140'></a> 30140 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L30141' name='L30141'></a> 30141       <a href='../S/2362.html#L300' title='Defined at 300 in src/gtkutil.c.'>xg_display_close</a> (dpy);
<a id='L30142' name='L30142'></a> 30142 <em class='sharp'>#else</em>
<a id='L30143' name='L30143'></a> 30143 <em class='sharp'>#ifdef</em> USE_X_TOOLKIT
<a id='L30144' name='L30144'></a> 30144       XtCloseDisplay (dpy);
<a id='L30145' name='L30145'></a> 30145 <em class='sharp'>#else</em>
<a id='L30146' name='L30146'></a> 30146       XCloseDisplay (dpy);
<a id='L30147' name='L30147'></a> 30147 <em class='sharp'>#endif</em>
<a id='L30148' name='L30148'></a> 30148 <em class='sharp'>#endif</em> <em class='comment'>/* ! USE_GTK */</em>
<a id='L30149' name='L30149'></a> 30149 
<a id='L30150' name='L30150'></a> 30150       <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L30151' name='L30151'></a> 30151 
<a id='L30152' name='L30152'></a> 30152 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XFIXES &amp;&amp; <strong class='reserved'>defined</strong> USE_XCB
<a id='L30153' name='L30153'></a> 30153       <a href='../D/5394.html' title='Multiple defined in 2 places.'>SAFE_FREE</a> ();
<a id='L30154' name='L30154'></a> 30154 <em class='sharp'>#endif</em>
<a id='L30155' name='L30155'></a> 30155       <strong class='reserved'>return</strong> 0;
<a id='L30156' name='L30156'></a> 30156     <em class='brace'>}</em>
<a id='L30157' name='L30157'></a> 30157 <em class='sharp'>#endif</em>
<a id='L30158' name='L30158'></a> 30158 
<a id='L30159' name='L30159'></a> 30159   <em class='comment'>/* Select for structure events on the root window, since this allows</em>
<a id='L30160' name='L30160'></a> 30160 <em class='comment'>     us to record changes to the size of the screen.  */</em>
<a id='L30161' name='L30161'></a> 30161 
<a id='L30162' name='L30162'></a> 30162   XSelectInput (dpy, DefaultRootWindow (dpy), StructureNotifyMask);
<a id='L30163' name='L30163'></a> 30163 
<a id='L30164' name='L30164'></a> 30164   <em class='comment'>/* We have definitely succeeded.  Record the new connection.  */</em>
<a id='L30165' name='L30165'></a> 30165 
<a id='L30166' name='L30166'></a> 30166   dpyinfo = <a href='../S/2350.html#L802' title='Defined at 802 in src/alloc.c.'>xzalloc</a> (<strong class='reserved'>sizeof</strong> *dpyinfo);
<a id='L30167' name='L30167'></a> 30167   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a> = x_create_terminal (dpyinfo);
<a id='L30168' name='L30168'></a> 30168 
<a id='L30169' name='L30169'></a> 30169   <strong class='reserved'>if</strong> (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (Vx_detect_server_trust))
<a id='L30170' name='L30170'></a> 30170     <em class='brace'>{</em>
<a id='L30171' name='L30171'></a> 30171       <em class='comment'>/* Detect whether or not the X server trusts this client, which</em>
<a id='L30172' name='L30172'></a> 30172 <em class='comment'>         is done by making a SetKeyboardControl request and checking</em>
<a id='L30173' name='L30173'></a> 30173 <em class='comment'>         for an Access error.  */</em>
<a id='L30174' name='L30174'></a> 30174       XGrabServer (dpy);
<a id='L30175' name='L30175'></a> 30175       XGetKeyboardControl (dpy, &amp;keyboard_state);
<a id='L30176' name='L30176'></a> 30176 
<a id='L30177' name='L30177'></a> 30177       x_catch_errors (dpy);
<a id='L30178' name='L30178'></a> 30178 
<a id='L30179' name='L30179'></a> 30179       <em class='comment'>/* At this point, the display is not on x_display_list, so</em>
<a id='L30180' name='L30180'></a> 30180 <em class='comment'>         x_uncatch_errors won't sync.  However, that's okay because</em>
<a id='L30181' name='L30181'></a> 30181 <em class='comment'>         x_had_errors_p will.  */</em>
<a id='L30182' name='L30182'></a> 30182 
<a id='L30183' name='L30183'></a> 30183       <strong class='reserved'>if</strong> (keyboard_state.global_auto_repeat
<a id='L30184' name='L30184'></a> 30184           == AutoRepeatModeOn)
<a id='L30185' name='L30185'></a> 30185         XAutoRepeatOn (dpy);
<a id='L30186' name='L30186'></a> 30186       <strong class='reserved'>else</strong>
<a id='L30187' name='L30187'></a> 30187         XAutoRepeatOff (dpy);
<a id='L30188' name='L30188'></a> 30188 
<a id='L30189' name='L30189'></a> 30189       <strong class='reserved'>if</strong> (x_had_errors_p (dpy))
<a id='L30190' name='L30190'></a> 30190         dpyinfo-&gt;untrusted = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L30191' name='L30191'></a> 30191       x_uncatch_errors_after_check ();
<a id='L30192' name='L30192'></a> 30192       XUngrabServer (dpy);
<a id='L30193' name='L30193'></a> 30193     <em class='brace'>}</em>
<a id='L30194' name='L30194'></a> 30194 
<a id='L30195' name='L30195'></a> 30195   dpyinfo-&gt;next_failable_request = dpyinfo-&gt;failable_requests;
<a id='L30196' name='L30196'></a> 30196 
<a id='L30197' name='L30197'></a> 30197   <em class='brace'>{</em>
<a id='L30198' name='L30198'></a> 30198     <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *share;
<a id='L30199' name='L30199'></a> 30199 
<a id='L30200' name='L30200'></a> 30200     <strong class='reserved'>for</strong> (share = x_display_list; share; share = share-&gt;next)
<a id='L30201' name='L30201'></a> 30201       <strong class='reserved'>if</strong> (<a href='../S/2355.html#L6551' title='Defined at 6551 in src/pgtkterm.c.'>same_x_server</a> (<a href='../D/5917.html' title='Multiple defined in 2 places.'>SSDATA</a> (<a href='../D/7021.html' title='Multiple defined in 2 places.'>XCAR</a> (share-&gt;name_list_element)),
<a id='L30202' name='L30202'></a> 30202                          <a href='../D/5917.html' title='Multiple defined in 2 places.'>SSDATA</a> (display_name)))
<a id='L30203' name='L30203'></a> 30203         <strong class='reserved'>break</strong>;
<a id='L30204' name='L30204'></a> 30204     <strong class='reserved'>if</strong> (share)
<a id='L30205' name='L30205'></a> 30205       <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;<a href='../S/2185.html#L82' title='Defined at 82 in src/keyboard.h.'>kboard</a> = share-&gt;<a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;<a href='../S/2185.html#L82' title='Defined at 82 in src/keyboard.h.'>kboard</a>;
<a id='L30206' name='L30206'></a> 30206     <strong class='reserved'>else</strong>
<a id='L30207' name='L30207'></a> 30207       <em class='brace'>{</em>
<a id='L30208' name='L30208'></a> 30208         <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;<a href='../S/2185.html#L82' title='Defined at 82 in src/keyboard.h.'>kboard</a> = <a href='../D/8445.html' title='Multiple defined in 2 places.'>allocate_kboard</a> (Qx);
<a id='L30209' name='L30209'></a> 30209 
<a id='L30210' name='L30210'></a> 30210         <strong class='reserved'>if</strong> (!<a href='../S/2267.html#L466' title='Defined at 466 in src/lisp.h.'>BASE_EQ</a> (<a href='../D/7373.html' title='Multiple defined in 2 places.'>XSYMBOL</a> (Qvendor_specific_keysyms)-&gt;u.s.function,
<a id='L30211' name='L30211'></a> 30211                       Qunbound))
<a id='L30212' name='L30212'></a> 30212           <em class='brace'>{</em>
<a id='L30213' name='L30213'></a> 30213             <strong class='reserved'>char</strong> *vendor = ServerVendor (dpy);
<a id='L30214' name='L30214'></a> 30214 
<a id='L30215' name='L30215'></a> 30215             <em class='comment'>/* Temporarily hide the partially initialized terminal.</em>
<a id='L30216' name='L30216'></a> 30216 <em class='comment'>               Use safe_call so that if a signal happens, a partially</em>
<a id='L30217' name='L30217'></a> 30217 <em class='comment'>               initialized display (and display connection) is not</em>
<a id='L30218' name='L30218'></a> 30218 <em class='comment'>               kept around.  */</em>
<a id='L30219' name='L30219'></a> 30219             terminal_list = <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;next_terminal;
<a id='L30220' name='L30220'></a> 30220             <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L30221' name='L30221'></a> 30221             <a href='../S/2185.html#L219' title='Defined at 219 in src/keyboard.h.'>kset_system_key_alist</a> (<a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;<a href='../S/2185.html#L82' title='Defined at 82 in src/keyboard.h.'>kboard</a>,
<a id='L30222' name='L30222'></a> 30222                                    <a href='../S/2224.html#L3049' title='Defined at 3049 in src/xdisp.c.'>safe_call1</a> (Qvendor_specific_keysyms,
<a id='L30223' name='L30223'></a> 30223                                                (vendor
<a id='L30224' name='L30224'></a> 30224                                                 ? <a href='../D/9420.html' title='Multiple defined in 2 places.'>build_string</a> (vendor)
<a id='L30225' name='L30225'></a> 30225                                                 : empty_unibyte_string)));
<a id='L30226' name='L30226'></a> 30226             <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L30227' name='L30227'></a> 30227             <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;next_terminal = terminal_list;
<a id='L30228' name='L30228'></a> 30228             terminal_list = <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>;
<a id='L30229' name='L30229'></a> 30229           <em class='brace'>}</em>
<a id='L30230' name='L30230'></a> 30230 
<a id='L30231' name='L30231'></a> 30231         <em class='comment'>/* Don't let the initial kboard remain current longer than necessary.</em>
<a id='L30232' name='L30232'></a> 30232 <em class='comment'>           That would cause problems if a file loaded on startup tries to</em>
<a id='L30233' name='L30233'></a> 30233 <em class='comment'>           prompt in the mini-buffer.  */</em>
<a id='L30234' name='L30234'></a> 30234         <strong class='reserved'>if</strong> (current_kboard == initial_kboard)
<a id='L30235' name='L30235'></a> 30235           current_kboard = <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;<a href='../S/2185.html#L82' title='Defined at 82 in src/keyboard.h.'>kboard</a>;
<a id='L30236' name='L30236'></a> 30236       <em class='brace'>}</em>
<a id='L30237' name='L30237'></a> 30237     <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;<a href='../S/2185.html#L82' title='Defined at 82 in src/keyboard.h.'>kboard</a>-&gt;reference_count++;
<a id='L30238' name='L30238'></a> 30238   <em class='brace'>}</em>
<a id='L30239' name='L30239'></a> 30239 
<a id='L30240' name='L30240'></a> 30240   <em class='comment'>/* Now look through Vx_quit_keysym for the quit keysym associated</em>
<a id='L30241' name='L30241'></a> 30241 <em class='comment'>     with this display.  */</em>
<a id='L30242' name='L30242'></a> 30242   tem = Vx_quit_keysym;
<a id='L30243' name='L30243'></a> 30243   <a href='../S/2267.html#L5578' title='Defined at 5578 in src/lisp.h.'>FOR_EACH_TAIL_SAFE</a> (tem)
<a id='L30244' name='L30244'></a> 30244     <em class='brace'>{</em>
<a id='L30245' name='L30245'></a> 30245       quit_keysym = <a href='../D/7021.html' title='Multiple defined in 2 places.'>XCAR</a> (tem);
<a id='L30246' name='L30246'></a> 30246 
<a id='L30247' name='L30247'></a> 30247       <em class='comment'>/* Check if its car is a string and its cdr a valid keysym.</em>
<a id='L30248' name='L30248'></a> 30248 <em class='comment'>         Skip if it is not.  */</em>
<a id='L30249' name='L30249'></a> 30249 
<a id='L30250' name='L30250'></a> 30250       <strong class='reserved'>if</strong> (!<a href='../D/1228.html' title='Multiple defined in 2 places.'>CONSP</a> (quit_keysym) || !<a href='../S/2267.html#L469' title='Defined at 469 in src/lisp.h.'>FIXNUMP</a> (<a href='../D/7022.html' title='Multiple defined in 2 places.'>XCDR</a> (quit_keysym))
<a id='L30251' name='L30251'></a> 30251           || !<a href='../S/2267.html#L1597' title='Defined at 1597 in src/lisp.h.'>STRINGP</a> (<a href='../D/7021.html' title='Multiple defined in 2 places.'>XCAR</a> (quit_keysym)))
<a id='L30252' name='L30252'></a> 30252         <strong class='reserved'>continue</strong>;
<a id='L30253' name='L30253'></a> 30253 
<a id='L30254' name='L30254'></a> 30254       <em class='comment'>/* Check if this is the keysym to be used.  */</em>
<a id='L30255' name='L30255'></a> 30255 
<a id='L30256' name='L30256'></a> 30256       <strong class='reserved'>if</strong> (strcmp (<a href='../D/5917.html' title='Multiple defined in 2 places.'>SSDATA</a> (<a href='../D/7021.html' title='Multiple defined in 2 places.'>XCAR</a> (quit_keysym)), ServerVendor (dpy)))
<a id='L30257' name='L30257'></a> 30257         <strong class='reserved'>continue</strong>;
<a id='L30258' name='L30258'></a> 30258 
<a id='L30259' name='L30259'></a> 30259       dpyinfo-&gt;quit_keysym = <a href='../S/2267.html#L1285' title='Defined at 1285 in src/lisp.h.'>XFIXNUM</a> (<a href='../D/7022.html' title='Multiple defined in 2 places.'>XCDR</a> (quit_keysym));
<a id='L30260' name='L30260'></a> 30260     <em class='brace'>}</em>
<a id='L30261' name='L30261'></a> 30261 
<a id='L30262' name='L30262'></a> 30262   <em class='comment'>/* Put this display on the chain.  */</em>
<a id='L30263' name='L30263'></a> 30263   dpyinfo-&gt;next = x_display_list;
<a id='L30264' name='L30264'></a> 30264   x_display_list = dpyinfo;
<a id='L30265' name='L30265'></a> 30265 
<a id='L30266' name='L30266'></a> 30266   dpyinfo-&gt;name_list_element = Fcons (display_name, Qnil);
<a id='L30267' name='L30267'></a> 30267   dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> = dpy;
<a id='L30268' name='L30268'></a> 30268   dpyinfo-&gt;connection = ConnectionNumber (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L30269' name='L30269'></a> 30269 <em class='sharp'>#ifdef</em> USE_XCB
<a id='L30270' name='L30270'></a> 30270   dpyinfo-&gt;xcb_connection = xcb_conn;
<a id='L30271' name='L30271'></a> 30271 <em class='sharp'>#endif</em>
<a id='L30272' name='L30272'></a> 30272 
<a id='L30273' name='L30273'></a> 30273   <em class='comment'>/* https://lists.gnu.org/r/emacs-devel/2015-11/msg00194.html  */</em>
<a id='L30274' name='L30274'></a> 30274   dpyinfo-&gt;smallest_font_height = 1;
<a id='L30275' name='L30275'></a> 30275   dpyinfo-&gt;smallest_char_width = 1;
<a id='L30276' name='L30276'></a> 30276 
<a id='L30277' name='L30277'></a> 30277   dpyinfo-&gt;color_names_size = 256;
<a id='L30278' name='L30278'></a> 30278   dpyinfo-&gt;color_names = <a href='../S/2350.html#L802' title='Defined at 802 in src/alloc.c.'>xzalloc</a> (dpyinfo-&gt;color_names_size
<a id='L30279' name='L30279'></a> 30279                                   * <strong class='reserved'>sizeof</strong> *dpyinfo-&gt;color_names);
<a id='L30280' name='L30280'></a> 30280   dpyinfo-&gt;color_names_length = <a href='../S/2350.html#L802' title='Defined at 802 in src/alloc.c.'>xzalloc</a> (dpyinfo-&gt;color_names_size
<a id='L30281' name='L30281'></a> 30281                                          * <strong class='reserved'>sizeof</strong> *dpyinfo-&gt;color_names_length);
<a id='L30282' name='L30282'></a> 30282 
<a id='L30283' name='L30283'></a> 30283   <em class='comment'>/* Set the name of the terminal. */</em>
<a id='L30284' name='L30284'></a> 30284   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a> = <a href='../S/2350.html#L973' title='Defined at 973 in src/alloc.c.'>xlispstrdup</a> (display_name);
<a id='L30285' name='L30285'></a> 30285 
<a id='L30286' name='L30286'></a> 30286 <em class='sharp'>#if</em> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>
<a id='L30287' name='L30287'></a> 30287   XSetAfterFunction (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, x_trace_wire);
<a id='L30288' name='L30288'></a> 30288 <em class='sharp'>#endif</em>
<a id='L30289' name='L30289'></a> 30289 
<a id='L30290' name='L30290'></a> 30290   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> system_name = Fsystem_name ();
<a id='L30291' name='L30291'></a> 30291   <strong class='reserved'>static</strong> <strong class='reserved'>char</strong> <strong class='reserved'>const</strong> title[] = "GNU Emacs";
<a id='L30292' name='L30292'></a> 30292   <strong class='reserved'>if</strong> (<a href='../S/2267.html#L1597' title='Defined at 1597 in src/lisp.h.'>STRINGP</a> (system_name))
<a id='L30293' name='L30293'></a> 30293     <em class='brace'>{</em>
<a id='L30294' name='L30294'></a> 30294       <strong class='reserved'>static</strong> <strong class='reserved'>char</strong> <strong class='reserved'>const</strong> <a href='../S/2325.html#L61' title='Defined at 61 in src/cm.c.'>at</a>[] = " at ";
<a id='L30295' name='L30295'></a> 30295       ptrdiff_t nbytes = <strong class='reserved'>sizeof</strong> (title) + <strong class='reserved'>sizeof</strong> (<a href='../S/2325.html#L61' title='Defined at 61 in src/cm.c.'>at</a>);
<a id='L30296' name='L30296'></a> 30296       <strong class='reserved'>if</strong> (<a href='../S/2699.html#L31' title='Defined at 31 in lib/stdckdint.in.h.'>ckd_add</a> (&amp;nbytes, nbytes, <a href='../D/5431.html' title='Multiple defined in 2 places.'>SBYTES</a> (system_name)))
<a id='L30297' name='L30297'></a> 30297         <a href='../D/14399.html' title='Multiple defined in 3 places.'>memory_full</a> (<a href='../D/5845.html' title='Multiple defined in 8 places.'>SIZE_MAX</a>);
<a id='L30298' name='L30298'></a> 30298       dpyinfo-&gt;x_id_name = <a href='../D/20068.html' title='Multiple defined in 10 places.'>xmalloc</a> (nbytes);
<a id='L30299' name='L30299'></a> 30299       <a href='../D/17583.html' title='Multiple defined in 3 places.'>sprintf</a> (dpyinfo-&gt;x_id_name, "%s%s%s", title, <a href='../S/2325.html#L61' title='Defined at 61 in src/cm.c.'>at</a>, <a href='../D/5540.html' title='Multiple defined in 2 places.'>SDATA</a> (system_name));
<a id='L30300' name='L30300'></a> 30300     <em class='brace'>}</em>
<a id='L30301' name='L30301'></a> 30301   <strong class='reserved'>else</strong>
<a id='L30302' name='L30302'></a> 30302     <em class='brace'>{</em>
<a id='L30303' name='L30303'></a> 30303       dpyinfo-&gt;x_id_name = <a href='../D/20068.html' title='Multiple defined in 10 places.'>xmalloc</a> (<strong class='reserved'>sizeof</strong> (title));
<a id='L30304' name='L30304'></a> 30304       strcpy (dpyinfo-&gt;x_id_name, title);
<a id='L30305' name='L30305'></a> 30305     <em class='brace'>}</em>
<a id='L30306' name='L30306'></a> 30306 
<a id='L30307' name='L30307'></a> 30307   dpyinfo-&gt;x_id = ++x_display_id;
<a id='L30308' name='L30308'></a> 30308 
<a id='L30309' name='L30309'></a> 30309 <em class='sharp'>#ifndef</em> HAVE_XKB
<a id='L30310' name='L30310'></a> 30310   <em class='comment'>/* Figure out which modifier bits mean what.  */</em>
<a id='L30311' name='L30311'></a> 30311   x_find_modifier_meanings (dpyinfo);
<a id='L30312' name='L30312'></a> 30312 <em class='sharp'>#endif</em>
<a id='L30313' name='L30313'></a> 30313 
<a id='L30314' name='L30314'></a> 30314   <em class='comment'>/* Get the scroll bar cursor.  */</em>
<a id='L30315' name='L30315'></a> 30315 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L30316' name='L30316'></a> 30316   <em class='comment'>/* We must create a GTK cursor, it is required for GTK widgets.  */</em>
<a id='L30317' name='L30317'></a> 30317   dpyinfo-&gt;xg_cursor = <a href='../S/2362.html#L366' title='Defined at 366 in src/gtkutil.c.'>xg_create_default_cursor</a> (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L30318' name='L30318'></a> 30318 <em class='sharp'>#endif</em> <em class='comment'>/* USE_GTK */</em>
<a id='L30319' name='L30319'></a> 30319 
<a id='L30320' name='L30320'></a> 30320   dpyinfo-&gt;vertical_scroll_bar_cursor
<a id='L30321' name='L30321'></a> 30321     = XCreateFontCursor (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, XC_sb_v_double_arrow);
<a id='L30322' name='L30322'></a> 30322 
<a id='L30323' name='L30323'></a> 30323   dpyinfo-&gt;horizontal_scroll_bar_cursor
<a id='L30324' name='L30324'></a> 30324     = XCreateFontCursor (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, XC_sb_h_double_arrow);
<a id='L30325' name='L30325'></a> 30325 
<a id='L30326' name='L30326'></a> 30326   xrdb = <a href='../S/2138.html#L378' title='Defined at 378 in src/xrdb.c.'>x_load_resources</a> (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, xrm_option,
<a id='L30327' name='L30327'></a> 30327                            resource_name, <a href='../S/2183.html#L1826' title='Defined at 1826 in src/frame.h.'>EMACS_CLASS</a>);
<a id='L30328' name='L30328'></a> 30328 <em class='sharp'>#ifdef</em> HAVE_XRMSETDATABASE
<a id='L30329' name='L30329'></a> 30329   XrmSetDatabase (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, xrdb);
<a id='L30330' name='L30330'></a> 30330 <em class='sharp'>#else</em>
<a id='L30331' name='L30331'></a> 30331   dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>-&gt;db = xrdb;
<a id='L30332' name='L30332'></a> 30332 <em class='sharp'>#endif</em>
<a id='L30333' name='L30333'></a> 30333 
<a id='L30334' name='L30334'></a> 30334 <em class='sharp'>#ifdef</em> HAVE_XRENDER
<a id='L30335' name='L30335'></a> 30335   <strong class='reserved'>int</strong> event_base, error_base;
<a id='L30336' name='L30336'></a> 30336   dpyinfo-&gt;xrender_supported_p
<a id='L30337' name='L30337'></a> 30337     = XRenderQueryExtension (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, &amp;event_base, &amp;error_base);
<a id='L30338' name='L30338'></a> 30338 
<a id='L30339' name='L30339'></a> 30339   <strong class='reserved'>if</strong> (dpyinfo-&gt;xrender_supported_p)
<a id='L30340' name='L30340'></a> 30340     dpyinfo-&gt;xrender_supported_p
<a id='L30341' name='L30341'></a> 30341       = XRenderQueryVersion (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, &amp;dpyinfo-&gt;xrender_major,
<a id='L30342' name='L30342'></a> 30342                              &amp;dpyinfo-&gt;xrender_minor);
<a id='L30343' name='L30343'></a> 30343 <em class='sharp'>#endif</em>
<a id='L30344' name='L30344'></a> 30344 
<a id='L30345' name='L30345'></a> 30345   <em class='comment'>/* This must come after XRenderQueryVersion! */</em>
<a id='L30346' name='L30346'></a> 30346 <em class='sharp'>#ifdef</em> HAVE_XCOMPOSITE
<a id='L30347' name='L30347'></a> 30347   <strong class='reserved'>int</strong> composite_event_base, composite_error_base;
<a id='L30348' name='L30348'></a> 30348   dpyinfo-&gt;composite_supported_p = XCompositeQueryExtension (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L30349' name='L30349'></a> 30349                                                              &amp;composite_event_base,
<a id='L30350' name='L30350'></a> 30350                                                              &amp;composite_error_base);
<a id='L30351' name='L30351'></a> 30351 
<a id='L30352' name='L30352'></a> 30352   <strong class='reserved'>if</strong> (dpyinfo-&gt;composite_supported_p)
<a id='L30353' name='L30353'></a> 30353     dpyinfo-&gt;composite_supported_p
<a id='L30354' name='L30354'></a> 30354       = XCompositeQueryVersion (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L30355' name='L30355'></a> 30355                                 &amp;dpyinfo-&gt;composite_major,
<a id='L30356' name='L30356'></a> 30356                                 &amp;dpyinfo-&gt;composite_minor);
<a id='L30357' name='L30357'></a> 30357 <em class='sharp'>#endif</em>
<a id='L30358' name='L30358'></a> 30358 
<a id='L30359' name='L30359'></a> 30359 <em class='sharp'>#ifdef</em> HAVE_XSHAPE
<a id='L30360' name='L30360'></a> 30360   dpyinfo-&gt;xshape_supported_p
<a id='L30361' name='L30361'></a> 30361     = XShapeQueryExtension (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L30362' name='L30362'></a> 30362                             &amp;dpyinfo-&gt;xshape_event_base,
<a id='L30363' name='L30363'></a> 30363                             &amp;dpyinfo-&gt;xshape_error_base);
<a id='L30364' name='L30364'></a> 30364 
<a id='L30365' name='L30365'></a> 30365   <strong class='reserved'>if</strong> (dpyinfo-&gt;xshape_supported_p)
<a id='L30366' name='L30366'></a> 30366     dpyinfo-&gt;xshape_supported_p
<a id='L30367' name='L30367'></a> 30367       = XShapeQueryVersion (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L30368' name='L30368'></a> 30368                             &amp;dpyinfo-&gt;xshape_major,
<a id='L30369' name='L30369'></a> 30369                             &amp;dpyinfo-&gt;xshape_minor);
<a id='L30370' name='L30370'></a> 30370 <em class='sharp'>#endif</em>
<a id='L30371' name='L30371'></a> 30371 
<a id='L30372' name='L30372'></a> 30372   <em class='comment'>/* Put the rdb where we can find it in a way that works on</em>
<a id='L30373' name='L30373'></a> 30373 <em class='comment'>     all versions.  */</em>
<a id='L30374' name='L30374'></a> 30374   dpyinfo-&gt;rdb = xrdb;
<a id='L30375' name='L30375'></a> 30375 
<a id='L30376' name='L30376'></a> 30376   dpyinfo-&gt;screen = ScreenOfDisplay (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L30377' name='L30377'></a> 30377                                      DefaultScreen (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>));
<a id='L30378' name='L30378'></a> 30378   <a href='../S/2296.html#L7419' title='Defined at 7419 in src/xfns.c.'>select_visual</a> (dpyinfo);
<a id='L30379' name='L30379'></a> 30379   dpyinfo-&gt;cmap = DefaultColormapOfScreen (dpyinfo-&gt;screen);
<a id='L30380' name='L30380'></a> 30380   dpyinfo-&gt;root_window = RootWindowOfScreen (dpyinfo-&gt;screen);
<a id='L30381' name='L30381'></a> 30381   dpyinfo-&gt;icon_bitmap_id = -1;
<a id='L30382' name='L30382'></a> 30382   dpyinfo-&gt;wm_type = <a href='../S/2212.html#L685' title='Defined at 685 in src/xterm.h.'>X_WMTYPE_UNKNOWN</a>;
<a id='L30383' name='L30383'></a> 30383 
<a id='L30384' name='L30384'></a> 30384   <a href='../S/2315.html#L2922' title='Defined at 2922 in src/dispextern.h.'>reset_mouse_highlight</a> (&amp;dpyinfo-&gt;mouse_highlight);
<a id='L30385' name='L30385'></a> 30385 
<a id='L30386' name='L30386'></a> 30386 <em class='sharp'>#ifdef</em> HAVE_XRENDER
<a id='L30387' name='L30387'></a> 30387   <strong class='reserved'>if</strong> (dpyinfo-&gt;xrender_supported_p
<a id='L30388' name='L30388'></a> 30388       <em class='comment'>/* This could already have been initialized by</em>
<a id='L30389' name='L30389'></a> 30389 <em class='comment'>         `select_visual'.  */</em>
<a id='L30390' name='L30390'></a> 30390       &amp;&amp; !dpyinfo-&gt;pict_format)
<a id='L30391' name='L30391'></a> 30391     dpyinfo-&gt;pict_format = XRenderFindVisualFormat (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L30392' name='L30392'></a> 30392                                                     dpyinfo-&gt;visual);
<a id='L30393' name='L30393'></a> 30393 <em class='sharp'>#endif</em>
<a id='L30394' name='L30394'></a> 30394 
<a id='L30395' name='L30395'></a> 30395 <em class='sharp'>#ifdef</em> HAVE_XSYNC
<a id='L30396' name='L30396'></a> 30396   <strong class='reserved'>int</strong> xsync_event_base, xsync_error_base;
<a id='L30397' name='L30397'></a> 30397   dpyinfo-&gt;xsync_supported_p
<a id='L30398' name='L30398'></a> 30398     = XSyncQueryExtension (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L30399' name='L30399'></a> 30399                            &amp;xsync_event_base,
<a id='L30400' name='L30400'></a> 30400                            &amp;xsync_error_base);
<a id='L30401' name='L30401'></a> 30401 
<a id='L30402' name='L30402'></a> 30402   <strong class='reserved'>if</strong> (dpyinfo-&gt;xsync_supported_p)
<a id='L30403' name='L30403'></a> 30403     dpyinfo-&gt;xsync_supported_p = XSyncInitialize (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L30404' name='L30404'></a> 30404                                                   &amp;dpyinfo-&gt;xsync_major,
<a id='L30405' name='L30405'></a> 30405                                                   &amp;dpyinfo-&gt;xsync_minor);
<a id='L30406' name='L30406'></a> 30406 
<a id='L30407' name='L30407'></a> 30407   <em class='brace'>{</em>
<a id='L30408' name='L30408'></a> 30408     <a href='../D/291.html' title='Multiple defined in 2 places.'>AUTO_STRING</a> (synchronizeResize, "synchronizeResize");
<a id='L30409' name='L30409'></a> 30409     <a href='../D/291.html' title='Multiple defined in 2 places.'>AUTO_STRING</a> (SynchronizeResize, "SynchronizeResize");
<a id='L30410' name='L30410'></a> 30410 
<a id='L30411' name='L30411'></a> 30411     <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a> = <a href='../S/2247.html#L5323' title='Defined at 5323 in src/frame.c.'>gui_display_get_resource</a> (dpyinfo,
<a id='L30412' name='L30412'></a> 30412                                                   synchronizeResize,
<a id='L30413' name='L30413'></a> 30413                                                   SynchronizeResize,
<a id='L30414' name='L30414'></a> 30414                                                   Qnil, Qnil);
<a id='L30415' name='L30415'></a> 30415 
<a id='L30416' name='L30416'></a> 30416     <strong class='reserved'>if</strong> (<a href='../S/2267.html#L1597' title='Defined at 1597 in src/lisp.h.'>STRINGP</a> (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>)
<a id='L30417' name='L30417'></a> 30417         &amp;&amp; (!strcmp (<a href='../D/5917.html' title='Multiple defined in 2 places.'>SSDATA</a> (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>), "false")
<a id='L30418' name='L30418'></a> 30418             || !strcmp (<a href='../D/5917.html' title='Multiple defined in 2 places.'>SSDATA</a> (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>), "off")))
<a id='L30419' name='L30419'></a> 30419       dpyinfo-&gt;xsync_supported_p = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L30420' name='L30420'></a> 30420   <em class='brace'>}</em>
<a id='L30421' name='L30421'></a> 30421 <em class='sharp'>#endif</em>
<a id='L30422' name='L30422'></a> 30422 
<a id='L30423' name='L30423'></a> 30423 <em class='sharp'>#ifdef</em> HAVE_XINERAMA
<a id='L30424' name='L30424'></a> 30424   <strong class='reserved'>int</strong> xin_event_base, xin_error_base;
<a id='L30425' name='L30425'></a> 30425   dpyinfo-&gt;xinerama_supported_p
<a id='L30426' name='L30426'></a> 30426     = XineramaQueryExtension (dpy, &amp;xin_event_base, &amp;xin_error_base);
<a id='L30427' name='L30427'></a> 30427 <em class='sharp'>#endif</em>
<a id='L30428' name='L30428'></a> 30428 
<a id='L30429' name='L30429'></a> 30429   <em class='comment'>/* See if a private colormap is requested.  */</em>
<a id='L30430' name='L30430'></a> 30430   <strong class='reserved'>if</strong> (dpyinfo-&gt;visual == DefaultVisualOfScreen (dpyinfo-&gt;screen))
<a id='L30431' name='L30431'></a> 30431     <em class='brace'>{</em>
<a id='L30432' name='L30432'></a> 30432       <strong class='reserved'>if</strong> (dpyinfo-&gt;visual_info.class == PseudoColor)
<a id='L30433' name='L30433'></a> 30433         <em class='brace'>{</em>
<a id='L30434' name='L30434'></a> 30434           <a href='../D/291.html' title='Multiple defined in 2 places.'>AUTO_STRING</a> (privateColormap, "privateColormap");
<a id='L30435' name='L30435'></a> 30435           <a href='../D/291.html' title='Multiple defined in 2 places.'>AUTO_STRING</a> (PrivateColormap, "PrivateColormap");
<a id='L30436' name='L30436'></a> 30436           <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>
<a id='L30437' name='L30437'></a> 30437             = <a href='../S/2247.html#L5323' title='Defined at 5323 in src/frame.c.'>gui_display_get_resource</a> (dpyinfo, privateColormap,
<a id='L30438' name='L30438'></a> 30438                                         PrivateColormap, Qnil, Qnil);
<a id='L30439' name='L30439'></a> 30439           <strong class='reserved'>if</strong> (<a href='../S/2267.html#L1597' title='Defined at 1597 in src/lisp.h.'>STRINGP</a> (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>)
<a id='L30440' name='L30440'></a> 30440               &amp;&amp; (!strcmp (<a href='../D/5917.html' title='Multiple defined in 2 places.'>SSDATA</a> (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>), "true")
<a id='L30441' name='L30441'></a> 30441                   || !strcmp (<a href='../D/5917.html' title='Multiple defined in 2 places.'>SSDATA</a> (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>), "on")))
<a id='L30442' name='L30442'></a> 30442             dpyinfo-&gt;cmap = XCopyColormapAndFree (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, dpyinfo-&gt;cmap);
<a id='L30443' name='L30443'></a> 30443         <em class='brace'>}</em>
<a id='L30444' name='L30444'></a> 30444     <em class='brace'>}</em>
<a id='L30445' name='L30445'></a> 30445   <strong class='reserved'>else</strong>
<a id='L30446' name='L30446'></a> 30446     dpyinfo-&gt;cmap = XCreateColormap (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, dpyinfo-&gt;root_window,
<a id='L30447' name='L30447'></a> 30447                                      dpyinfo-&gt;visual, AllocNone);
<a id='L30448' name='L30448'></a> 30448 
<a id='L30449' name='L30449'></a> 30449   <em class='comment'>/* See if we can construct pixel values from RGB values.  */</em>
<a id='L30450' name='L30450'></a> 30450   <strong class='reserved'>if</strong> (dpyinfo-&gt;visual_info.class == TrueColor)
<a id='L30451' name='L30451'></a> 30451     <em class='brace'>{</em>
<a id='L30452' name='L30452'></a> 30452       get_bits_and_offset (dpyinfo-&gt;visual_info.red_mask,
<a id='L30453' name='L30453'></a> 30453                            &amp;dpyinfo-&gt;red_bits, &amp;dpyinfo-&gt;red_offset);
<a id='L30454' name='L30454'></a> 30454       get_bits_and_offset (dpyinfo-&gt;visual_info.blue_mask,
<a id='L30455' name='L30455'></a> 30455                            &amp;dpyinfo-&gt;blue_bits, &amp;dpyinfo-&gt;blue_offset);
<a id='L30456' name='L30456'></a> 30456       get_bits_and_offset (dpyinfo-&gt;visual_info.green_mask,
<a id='L30457' name='L30457'></a> 30457                            &amp;dpyinfo-&gt;green_bits, &amp;dpyinfo-&gt;green_offset);
<a id='L30458' name='L30458'></a> 30458 
<a id='L30459' name='L30459'></a> 30459 <em class='sharp'>#ifdef</em> HAVE_XRENDER
<a id='L30460' name='L30460'></a> 30460       <strong class='reserved'>if</strong> (dpyinfo-&gt;pict_format)
<a id='L30461' name='L30461'></a> 30461         <em class='brace'>{</em>
<a id='L30462' name='L30462'></a> 30462           <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> channel_mask
<a id='L30463' name='L30463'></a> 30463             = ((<strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong>) dpyinfo-&gt;pict_format-&gt;direct.alphaMask
<a id='L30464' name='L30464'></a> 30464                &lt;&lt; dpyinfo-&gt;pict_format-&gt;direct.alpha);
<a id='L30465' name='L30465'></a> 30465 
<a id='L30466' name='L30466'></a> 30466           <strong class='reserved'>if</strong> (channel_mask)
<a id='L30467' name='L30467'></a> 30467             get_bits_and_offset (channel_mask, &amp;dpyinfo-&gt;alpha_bits,
<a id='L30468' name='L30468'></a> 30468                                  &amp;dpyinfo-&gt;alpha_offset);
<a id='L30469' name='L30469'></a> 30469           dpyinfo-&gt;alpha_mask = channel_mask;
<a id='L30470' name='L30470'></a> 30470         <em class='brace'>}</em>
<a id='L30471' name='L30471'></a> 30471       <strong class='reserved'>else</strong>
<a id='L30472' name='L30472'></a> 30472 <em class='sharp'>#endif</em>
<a id='L30473' name='L30473'></a> 30473         <em class='brace'>{</em>
<a id='L30474' name='L30474'></a> 30474           <a href='../D/7038.html' title='Multiple defined in 2 places.'>XColor</a> xc;
<a id='L30475' name='L30475'></a> 30475           <strong class='reserved'>unsigned</strong> <strong class='reserved'>long</strong> alpha_mask;
<a id='L30476' name='L30476'></a> 30476           xc.red = 65535;
<a id='L30477' name='L30477'></a> 30477           xc.green = 65535;
<a id='L30478' name='L30478'></a> 30478           xc.blue = 65535;
<a id='L30479' name='L30479'></a> 30479 
<a id='L30480' name='L30480'></a> 30480           <strong class='reserved'>if</strong> (XAllocColor (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L30481' name='L30481'></a> 30481                            dpyinfo-&gt;cmap, &amp;xc) != 0)
<a id='L30482' name='L30482'></a> 30482             <em class='brace'>{</em>
<a id='L30483' name='L30483'></a> 30483               alpha_mask = xc.pixel &amp; ~(dpyinfo-&gt;visual_info.red_mask
<a id='L30484' name='L30484'></a> 30484                                         | dpyinfo-&gt;visual_info.blue_mask
<a id='L30485' name='L30485'></a> 30485                                         | dpyinfo-&gt;visual_info.green_mask);
<a id='L30486' name='L30486'></a> 30486 
<a id='L30487' name='L30487'></a> 30487               <strong class='reserved'>if</strong> (alpha_mask)
<a id='L30488' name='L30488'></a> 30488                 get_bits_and_offset (alpha_mask, &amp;dpyinfo-&gt;alpha_bits,
<a id='L30489' name='L30489'></a> 30489                                      &amp;dpyinfo-&gt;alpha_offset);
<a id='L30490' name='L30490'></a> 30490               dpyinfo-&gt;alpha_mask = alpha_mask;
<a id='L30491' name='L30491'></a> 30491             <em class='brace'>}</em>
<a id='L30492' name='L30492'></a> 30492         <em class='brace'>}</em>
<a id='L30493' name='L30493'></a> 30493     <em class='brace'>}</em>
<a id='L30494' name='L30494'></a> 30494 
<a id='L30495' name='L30495'></a> 30495 <em class='sharp'>#ifdef</em> HAVE_XDBE
<a id='L30496' name='L30496'></a> 30496   dpyinfo-&gt;supports_xdbe = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L30497' name='L30497'></a> 30497   <strong class='reserved'>int</strong> xdbe_major;
<a id='L30498' name='L30498'></a> 30498   <strong class='reserved'>int</strong> xdbe_minor;
<a id='L30499' name='L30499'></a> 30499   <strong class='reserved'>if</strong> (XdbeQueryExtension (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, &amp;xdbe_major, &amp;xdbe_minor))
<a id='L30500' name='L30500'></a> 30500     dpyinfo-&gt;supports_xdbe = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L30501' name='L30501'></a> 30501 <em class='sharp'>#endif</em>
<a id='L30502' name='L30502'></a> 30502 
<a id='L30503' name='L30503'></a> 30503 <em class='sharp'>#ifdef</em> USE_XCB
<a id='L30504' name='L30504'></a> 30504   xcb_screen_t *xcb_screen = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L30505' name='L30505'></a> 30505   xcb_screen_iterator_t iter;
<a id='L30506' name='L30506'></a> 30506   xcb_visualid_t wanted = <em class='brace'>{</em> XVisualIDFromVisual (dpyinfo-&gt;visual) <em class='brace'>}</em>;
<a id='L30507' name='L30507'></a> 30507   xcb_depth_iterator_t depth_iter;
<a id='L30508' name='L30508'></a> 30508   xcb_visualtype_iterator_t visual_iter;
<a id='L30509' name='L30509'></a> 30509 
<a id='L30510' name='L30510'></a> 30510   <strong class='reserved'>int</strong> screen = DefaultScreen (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L30511' name='L30511'></a> 30511 
<a id='L30512' name='L30512'></a> 30512   iter = xcb_setup_roots_iterator (xcb_get_setup (dpyinfo-&gt;xcb_connection));
<a id='L30513' name='L30513'></a> 30513   <strong class='reserved'>for</strong> (; iter.rem; --screen, xcb_screen_next (&amp;iter))
<a id='L30514' name='L30514'></a> 30514     <em class='brace'>{</em>
<a id='L30515' name='L30515'></a> 30515       <strong class='reserved'>if</strong> (!screen)
<a id='L30516' name='L30516'></a> 30516         xcb_screen = iter.data;
<a id='L30517' name='L30517'></a> 30517     <em class='brace'>}</em>
<a id='L30518' name='L30518'></a> 30518 
<a id='L30519' name='L30519'></a> 30519   <strong class='reserved'>if</strong> (xcb_screen)
<a id='L30520' name='L30520'></a> 30520     <em class='brace'>{</em>
<a id='L30521' name='L30521'></a> 30521       depth_iter = xcb_screen_allowed_depths_iterator (xcb_screen);
<a id='L30522' name='L30522'></a> 30522       <strong class='reserved'>for</strong> (; depth_iter.rem; xcb_depth_next (&amp;depth_iter))
<a id='L30523' name='L30523'></a> 30523         <em class='brace'>{</em>
<a id='L30524' name='L30524'></a> 30524           visual_iter = xcb_depth_visuals_iterator (depth_iter.data);
<a id='L30525' name='L30525'></a> 30525           <strong class='reserved'>for</strong> (; visual_iter.rem; xcb_visualtype_next (&amp;visual_iter))
<a id='L30526' name='L30526'></a> 30526             <em class='brace'>{</em>
<a id='L30527' name='L30527'></a> 30527               <strong class='reserved'>if</strong> (wanted == visual_iter.data-&gt;visual_id)
<a id='L30528' name='L30528'></a> 30528                 <em class='brace'>{</em>
<a id='L30529' name='L30529'></a> 30529                   dpyinfo-&gt;xcb_visual = visual_iter.data;
<a id='L30530' name='L30530'></a> 30530                   <strong class='reserved'>break</strong>;
<a id='L30531' name='L30531'></a> 30531                 <em class='brace'>}</em>
<a id='L30532' name='L30532'></a> 30532             <em class='brace'>}</em>
<a id='L30533' name='L30533'></a> 30533         <em class='brace'>}</em>
<a id='L30534' name='L30534'></a> 30534     <em class='brace'>}</em>
<a id='L30535' name='L30535'></a> 30535 <em class='sharp'>#endif</em>
<a id='L30536' name='L30536'></a> 30536 
<a id='L30537' name='L30537'></a> 30537 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L30538' name='L30538'></a> 30538   dpyinfo-&gt;supports_xi2 = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L30539' name='L30539'></a> 30539   <strong class='reserved'>int</strong> rc;
<a id='L30540' name='L30540'></a> 30540   <strong class='reserved'>int</strong> major = 2;
<a id='L30541' name='L30541'></a> 30541   <strong class='reserved'>int</strong> xi_first_event, xi_first_error;
<a id='L30542' name='L30542'></a> 30542 
<a id='L30543' name='L30543'></a> 30543 <em class='sharp'>#ifndef</em> HAVE_GTK3
<a id='L30544' name='L30544'></a> 30544   <em class='brace'>{</em>
<a id='L30545' name='L30545'></a> 30545     <a href='../D/291.html' title='Multiple defined in 2 places.'>AUTO_STRING</a> (disableInputExtension, "disableInputExtension");
<a id='L30546' name='L30546'></a> 30546     <a href='../D/291.html' title='Multiple defined in 2 places.'>AUTO_STRING</a> (DisableInputExtension, "DisableInputExtension");
<a id='L30547' name='L30547'></a> 30547 
<a id='L30548' name='L30548'></a> 30548     <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a> = <a href='../S/2247.html#L5323' title='Defined at 5323 in src/frame.c.'>gui_display_get_resource</a> (dpyinfo,
<a id='L30549' name='L30549'></a> 30549                                                   disableInputExtension,
<a id='L30550' name='L30550'></a> 30550                                                   DisableInputExtension,
<a id='L30551' name='L30551'></a> 30551                                                   Qnil, Qnil);
<a id='L30552' name='L30552'></a> 30552 
<a id='L30553' name='L30553'></a> 30553     <strong class='reserved'>if</strong> (<a href='../S/2267.html#L1597' title='Defined at 1597 in src/lisp.h.'>STRINGP</a> (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>)
<a id='L30554' name='L30554'></a> 30554         &amp;&amp; (!strcmp (<a href='../D/5917.html' title='Multiple defined in 2 places.'>SSDATA</a> (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>), "on")
<a id='L30555' name='L30555'></a> 30555             || !strcmp (<a href='../D/5917.html' title='Multiple defined in 2 places.'>SSDATA</a> (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>), "true")))
<a id='L30556' name='L30556'></a> 30556       <strong class='reserved'>goto</strong> skip_xi_setup;
<a id='L30557' name='L30557'></a> 30557   <em class='brace'>}</em>
<a id='L30558' name='L30558'></a> 30558 <em class='sharp'>#endif</em>
<a id='L30559' name='L30559'></a> 30559 
<a id='L30560' name='L30560'></a> 30560 <em class='sharp'>#ifdef</em> <a href='../S/2212.html#L177' title='Defined at 177 in src/xterm.h.'>HAVE_XINPUT2_4</a>
<a id='L30561' name='L30561'></a> 30561   <strong class='reserved'>int</strong> minor = 4;
<a id='L30562' name='L30562'></a> 30562 <em class='sharp'>#elif</em> <strong class='reserved'>defined</strong> <a href='../S/2212.html#L174' title='Defined at 174 in src/xterm.h.'>HAVE_XINPUT2_3</a> <em class='comment'>/* XInput 2.3 */</em>
<a id='L30563' name='L30563'></a> 30563   <strong class='reserved'>int</strong> minor = 3;
<a id='L30564' name='L30564'></a> 30564 <em class='sharp'>#elif</em> <strong class='reserved'>defined</strong> <a href='../S/2212.html#L171' title='Defined at 171 in src/xterm.h.'>HAVE_XINPUT2_2</a> <em class='comment'>/* XInput 2.2 */</em>
<a id='L30565' name='L30565'></a> 30565   <strong class='reserved'>int</strong> minor = 2;
<a id='L30566' name='L30566'></a> 30566 <em class='sharp'>#elif</em> <strong class='reserved'>defined</strong> <a href='../S/2212.html#L168' title='Defined at 168 in src/xterm.h.'>HAVE_XINPUT2_1</a> <em class='comment'>/* XInput 2.1 */</em>
<a id='L30567' name='L30567'></a> 30567   <strong class='reserved'>int</strong> minor = 1;
<a id='L30568' name='L30568'></a> 30568 <em class='sharp'>#else</em> <em class='comment'>/* Some old version of XI2 we're not interested in. */</em>
<a id='L30569' name='L30569'></a> 30569   <strong class='reserved'>int</strong> minor = 0;
<a id='L30570' name='L30570'></a> 30570 <em class='sharp'>#endif</em>
<a id='L30571' name='L30571'></a> 30571 
<a id='L30572' name='L30572'></a> 30572   dpyinfo-&gt;client_pointer_device = -1;
<a id='L30573' name='L30573'></a> 30573 
<a id='L30574' name='L30574'></a> 30574 <em class='sharp'>#ifdef</em> HAVE_GTK3
<a id='L30575' name='L30575'></a> 30575   <em class='comment'>/* GTK gets a chance to request use of the input extension first.</em>
<a id='L30576' name='L30576'></a> 30576 <em class='comment'>     If we later try to enable it if GDK did not, then GTK will not</em>
<a id='L30577' name='L30577'></a> 30577 <em class='comment'>     get the resulting extension events.  */</em>
<a id='L30578' name='L30578'></a> 30578 
<a id='L30579' name='L30579'></a> 30579   rc = xi_check_toolkit (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L30580' name='L30580'></a> 30580 
<a id='L30581' name='L30581'></a> 30581   <strong class='reserved'>if</strong> (!rc)
<a id='L30582' name='L30582'></a> 30582     <strong class='reserved'>goto</strong> skip_xi_setup;
<a id='L30583' name='L30583'></a> 30583 <em class='sharp'>#endif</em>
<a id='L30584' name='L30584'></a> 30584 
<a id='L30585' name='L30585'></a> 30585   <strong class='reserved'>if</strong> (XQueryExtension (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, "XInputExtension",
<a id='L30586' name='L30586'></a> 30586                        &amp;dpyinfo-&gt;xi2_opcode, &amp;xi_first_event,
<a id='L30587' name='L30587'></a> 30587                        &amp;xi_first_error))
<a id='L30588' name='L30588'></a> 30588     <em class='brace'>{</em>
<a id='L30589' name='L30589'></a> 30589 <em class='sharp'>#ifdef</em> HAVE_GTK3
<a id='L30590' name='L30590'></a> 30590       <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a> move_backwards = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L30591' name='L30591'></a> 30591       <strong class='reserved'>int</strong> original_minor = minor;
<a id='L30592' name='L30592'></a> 30592 
<a id='L30593' name='L30593'></a> 30593     query:
<a id='L30594' name='L30594'></a> 30594 
<a id='L30595' name='L30595'></a> 30595       <em class='comment'>/* Catch errors caused by GTK requesting a different version of</em>
<a id='L30596' name='L30596'></a> 30596 <em class='comment'>         XInput 2 than what Emacs was built with.  Usually, the X</em>
<a id='L30597' name='L30597'></a> 30597 <em class='comment'>         server tolerates these mistakes, but a BadValue error can</em>
<a id='L30598' name='L30598'></a> 30598 <em class='comment'>         result if only one of GTK or Emacs wasn't built with support</em>
<a id='L30599' name='L30599'></a> 30599 <em class='comment'>         for XInput 2.2.</em>
<a id='L30600' name='L30600'></a> 30600 <em class='comment'></em>
<a id='L30601' name='L30601'></a> 30601 <em class='comment'>         To work around the first, it suffices to increase the minor</em>
<a id='L30602' name='L30602'></a> 30602 <em class='comment'>         version until the X server is happy if the XIQueryVersion</em>
<a id='L30603' name='L30603'></a> 30603 <em class='comment'>         request results in an error.  If that doesn't work, however,</em>
<a id='L30604' name='L30604'></a> 30604 <em class='comment'>         then it's the latter, so decrease the minor until the version</em>
<a id='L30605' name='L30605'></a> 30605 <em class='comment'>         that GTK requested is found.  */</em>
<a id='L30606' name='L30606'></a> 30606 <em class='sharp'>#endif</em>
<a id='L30607' name='L30607'></a> 30607 
<a id='L30608' name='L30608'></a> 30608       x_catch_errors (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L30609' name='L30609'></a> 30609 
<a id='L30610' name='L30610'></a> 30610       rc = XIQueryVersion (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, &amp;major, &amp;minor);
<a id='L30611' name='L30611'></a> 30611 
<a id='L30612' name='L30612'></a> 30612 <em class='sharp'>#ifdef</em> HAVE_GTK3
<a id='L30613' name='L30613'></a> 30613       <em class='comment'>/* Increase the minor version until we find one the X</em>
<a id='L30614' name='L30614'></a> 30614 <em class='comment'>         server agrees with.  If that didn't work, then</em>
<a id='L30615' name='L30615'></a> 30615 <em class='comment'>         decrease the version until it either hits zero or</em>
<a id='L30616' name='L30616'></a> 30616 <em class='comment'>         becomes agreeable to the X server.  */</em>
<a id='L30617' name='L30617'></a> 30617 
<a id='L30618' name='L30618'></a> 30618       <strong class='reserved'>if</strong> (x_had_errors_p (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>))
<a id='L30619' name='L30619'></a> 30619         <em class='brace'>{</em>
<a id='L30620' name='L30620'></a> 30620           x_uncatch_errors_after_check ();
<a id='L30621' name='L30621'></a> 30621 
<a id='L30622' name='L30622'></a> 30622           <em class='comment'>/* Since BadValue errors can't be generated if both the</em>
<a id='L30623' name='L30623'></a> 30623 <em class='comment'>             prior and current requests specify a version of 2.2 or</em>
<a id='L30624' name='L30624'></a> 30624 <em class='comment'>             later, this means the prior request specified a version</em>
<a id='L30625' name='L30625'></a> 30625 <em class='comment'>             of the input extension less than 2.2.  */</em>
<a id='L30626' name='L30626'></a> 30626           <strong class='reserved'>if</strong> (minor &gt;= 2)
<a id='L30627' name='L30627'></a> 30627             <em class='brace'>{</em>
<a id='L30628' name='L30628'></a> 30628               move_backwards = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L30629' name='L30629'></a> 30629               minor = original_minor;
<a id='L30630' name='L30630'></a> 30630 
<a id='L30631' name='L30631'></a> 30631               <strong class='reserved'>if</strong> (--minor &lt; 0)
<a id='L30632' name='L30632'></a> 30632                 rc = BadRequest;
<a id='L30633' name='L30633'></a> 30633               <strong class='reserved'>else</strong>
<a id='L30634' name='L30634'></a> 30634                 <strong class='reserved'>goto</strong> query;
<a id='L30635' name='L30635'></a> 30635             <em class='brace'>}</em>
<a id='L30636' name='L30636'></a> 30636           <strong class='reserved'>else</strong>
<a id='L30637' name='L30637'></a> 30637             <em class='brace'>{</em>
<a id='L30638' name='L30638'></a> 30638               <strong class='reserved'>if</strong> (!move_backwards)
<a id='L30639' name='L30639'></a> 30639                 <em class='brace'>{</em>
<a id='L30640' name='L30640'></a> 30640                   minor++;
<a id='L30641' name='L30641'></a> 30641                   <strong class='reserved'>goto</strong> query;
<a id='L30642' name='L30642'></a> 30642                 <em class='brace'>}</em>
<a id='L30643' name='L30643'></a> 30643 
<a id='L30644' name='L30644'></a> 30644               <strong class='reserved'>if</strong> (--minor &lt; 0)
<a id='L30645' name='L30645'></a> 30645                 rc = BadRequest;
<a id='L30646' name='L30646'></a> 30646               <strong class='reserved'>else</strong>
<a id='L30647' name='L30647'></a> 30647                 <strong class='reserved'>goto</strong> query;
<a id='L30648' name='L30648'></a> 30648 
<a id='L30649' name='L30649'></a> 30649             <em class='brace'>}</em>
<a id='L30650' name='L30650'></a> 30650         <em class='brace'>}</em>
<a id='L30651' name='L30651'></a> 30651       <strong class='reserved'>else</strong>
<a id='L30652' name='L30652'></a> 30652         x_uncatch_errors_after_check ();
<a id='L30653' name='L30653'></a> 30653 
<a id='L30654' name='L30654'></a> 30654       <em class='comment'>/* But don't delude ourselves into thinking that we can use</em>
<a id='L30655' name='L30655'></a> 30655 <em class='comment'>         features provided by a version of the input extension that</em>
<a id='L30656' name='L30656'></a> 30656 <em class='comment'>         libXi itself doesn't support.  */</em>
<a id='L30657' name='L30657'></a> 30657 
<a id='L30658' name='L30658'></a> 30658       <strong class='reserved'>if</strong> (minor &gt; original_minor)
<a id='L30659' name='L30659'></a> 30659         minor = original_minor;
<a id='L30660' name='L30660'></a> 30660 <em class='sharp'>#else</em>
<a id='L30661' name='L30661'></a> 30661       <strong class='reserved'>if</strong> (x_had_errors_p (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>))
<a id='L30662' name='L30662'></a> 30662         rc = BadRequest;
<a id='L30663' name='L30663'></a> 30663 
<a id='L30664' name='L30664'></a> 30664       x_uncatch_errors_after_check ();
<a id='L30665' name='L30665'></a> 30665 <em class='sharp'>#endif</em>
<a id='L30666' name='L30666'></a> 30666 
<a id='L30667' name='L30667'></a> 30667       <strong class='reserved'>if</strong> (rc == Success)
<a id='L30668' name='L30668'></a> 30668         <em class='brace'>{</em>
<a id='L30669' name='L30669'></a> 30669           dpyinfo-&gt;supports_xi2 = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L30670' name='L30670'></a> 30670 <em class='sharp'>#ifndef</em> HAVE_GTK3
<a id='L30671' name='L30671'></a> 30671           <em class='comment'>/* Select for hierarchy events on the root window.  GTK 3.x</em>
<a id='L30672' name='L30672'></a> 30672 <em class='comment'>             does this itself.  */</em>
<a id='L30673' name='L30673'></a> 30673           xi_select_hierarchy_events (dpyinfo);
<a id='L30674' name='L30674'></a> 30674 <em class='sharp'>#endif</em>
<a id='L30675' name='L30675'></a> 30675 
<a id='L30676' name='L30676'></a> 30676           dpyinfo-&gt;xi2_version = minor;
<a id='L30677' name='L30677'></a> 30677           <a href='../S/2289.html#L5646' title='Defined at 5646 in src/xterm.c.'>x_cache_xi_devices</a> (dpyinfo);
<a id='L30678' name='L30678'></a> 30678         <em class='brace'>}</em>
<a id='L30679' name='L30679'></a> 30679     <em class='brace'>}</em>
<a id='L30680' name='L30680'></a> 30680  skip_xi_setup:
<a id='L30681' name='L30681'></a> 30681   ;
<a id='L30682' name='L30682'></a> 30682 <em class='sharp'>#endif</em>
<a id='L30683' name='L30683'></a> 30683 
<a id='L30684' name='L30684'></a> 30684 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XRANDR || <strong class='reserved'>defined</strong> USE_GTK
<a id='L30685' name='L30685'></a> 30685   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> term;
<a id='L30686' name='L30686'></a> 30686 
<a id='L30687' name='L30687'></a> 30687   <a href='../D/7354.html' title='Multiple defined in 2 places.'>XSETTERMINAL</a> (term, <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>);
<a id='L30688' name='L30688'></a> 30688 <em class='sharp'>#endif</em>
<a id='L30689' name='L30689'></a> 30689 
<a id='L30690' name='L30690'></a> 30690 <em class='sharp'>#ifdef</em> HAVE_XRANDR
<a id='L30691' name='L30691'></a> 30691   dpyinfo-&gt;xrandr_supported_p
<a id='L30692' name='L30692'></a> 30692     = XRRQueryExtension (dpy, &amp;dpyinfo-&gt;xrandr_event_base,
<a id='L30693' name='L30693'></a> 30693                          &amp;dpyinfo-&gt;xrandr_error_base);
<a id='L30694' name='L30694'></a> 30694 
<a id='L30695' name='L30695'></a> 30695 <em class='sharp'>#ifndef</em> USE_GTK
<a id='L30696' name='L30696'></a> 30696   dpyinfo-&gt;last_monitor_attributes_list = Qnil;
<a id='L30697' name='L30697'></a> 30697 <em class='sharp'>#endif</em>
<a id='L30698' name='L30698'></a> 30698 
<a id='L30699' name='L30699'></a> 30699   <strong class='reserved'>if</strong> (dpyinfo-&gt;xrandr_supported_p)
<a id='L30700' name='L30700'></a> 30700     <em class='brace'>{</em>
<a id='L30701' name='L30701'></a> 30701       XRRQueryVersion (dpy, &amp;dpyinfo-&gt;xrandr_major_version,
<a id='L30702' name='L30702'></a> 30702                        &amp;dpyinfo-&gt;xrandr_minor_version);
<a id='L30703' name='L30703'></a> 30703 
<a id='L30704' name='L30704'></a> 30704 <em class='sharp'>#ifndef</em> USE_GTK
<a id='L30705' name='L30705'></a> 30705       <strong class='reserved'>if</strong> (dpyinfo-&gt;xrandr_major_version == 1
<a id='L30706' name='L30706'></a> 30706           &amp;&amp; dpyinfo-&gt;xrandr_minor_version &gt;= 2)
<a id='L30707' name='L30707'></a> 30707         <em class='brace'>{</em>
<a id='L30708' name='L30708'></a> 30708           XRRSelectInput (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L30709' name='L30709'></a> 30709                           dpyinfo-&gt;root_window,
<a id='L30710' name='L30710'></a> 30710                           (RRScreenChangeNotifyMask
<a id='L30711' name='L30711'></a> 30711                            | RRCrtcChangeNotifyMask
<a id='L30712' name='L30712'></a> 30712                            | RROutputChangeNotifyMask
<a id='L30713' name='L30713'></a> 30713 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L30714' name='L30714'></a> 30714                            <em class='comment'>/* Emacs doesn't actually need this, but</em>
<a id='L30715' name='L30715'></a> 30715 <em class='comment'>                              GTK selects for it when the display is</em>
<a id='L30716' name='L30716'></a> 30716 <em class='comment'>                              initialized.  */</em>
<a id='L30717' name='L30717'></a> 30717                            | RROutputPropertyNotifyMask
<a id='L30718' name='L30718'></a> 30718 <em class='sharp'>#endif</em>
<a id='L30719' name='L30719'></a> 30719                            ));
<a id='L30720' name='L30720'></a> 30720 
<a id='L30721' name='L30721'></a> 30721           dpyinfo-&gt;last_monitor_attributes_list
<a id='L30722' name='L30722'></a> 30722             = Fx_display_monitor_attributes_list (term);
<a id='L30723' name='L30723'></a> 30723         <em class='brace'>}</em>
<a id='L30724' name='L30724'></a> 30724 <em class='sharp'>#endif</em>
<a id='L30725' name='L30725'></a> 30725     <em class='brace'>}</em>
<a id='L30726' name='L30726'></a> 30726 <em class='sharp'>#endif</em>
<a id='L30727' name='L30727'></a> 30727 
<a id='L30728' name='L30728'></a> 30728 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L30729' name='L30729'></a> 30729   dpyinfo-&gt;last_monitor_attributes_list
<a id='L30730' name='L30730'></a> 30730     = Fx_display_monitor_attributes_list (term);
<a id='L30731' name='L30731'></a> 30731 
<a id='L30732' name='L30732'></a> 30732   gdpy = gdk_x11_lookup_xdisplay (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L30733' name='L30733'></a> 30733   gscr = gdk_display_get_default_screen (gdpy);
<a id='L30734' name='L30734'></a> 30734 
<a id='L30735' name='L30735'></a> 30735   g_signal_connect (G_OBJECT (gscr), "monitors-changed",
<a id='L30736' name='L30736'></a> 30736                     G_CALLBACK (x_monitors_changed_cb),
<a id='L30737' name='L30737'></a> 30737                     <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L30738' name='L30738'></a> 30738 <em class='sharp'>#endif</em>
<a id='L30739' name='L30739'></a> 30739 
<a id='L30740' name='L30740'></a> 30740 <em class='sharp'>#ifdef</em> HAVE_XKB
<a id='L30741' name='L30741'></a> 30741   <strong class='reserved'>int</strong> xkb_major, xkb_minor, xkb_op, xkb_error_code;
<a id='L30742' name='L30742'></a> 30742   xkb_major = XkbMajorVersion;
<a id='L30743' name='L30743'></a> 30743   xkb_minor = XkbMinorVersion;
<a id='L30744' name='L30744'></a> 30744 
<a id='L30745' name='L30745'></a> 30745   <strong class='reserved'>if</strong> (XkbLibraryVersion (&amp;xkb_major, &amp;xkb_minor)
<a id='L30746' name='L30746'></a> 30746       &amp;&amp; XkbQueryExtension (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, &amp;xkb_op, &amp;dpyinfo-&gt;xkb_event_type,
<a id='L30747' name='L30747'></a> 30747                             &amp;xkb_error_code, &amp;xkb_major, &amp;xkb_minor))
<a id='L30748' name='L30748'></a> 30748     <em class='brace'>{</em>
<a id='L30749' name='L30749'></a> 30749       dpyinfo-&gt;supports_xkb = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L30750' name='L30750'></a> 30750       dpyinfo-&gt;xkb_desc = XkbGetMap (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L30751' name='L30751'></a> 30751                                      (XkbKeySymsMask
<a id='L30752' name='L30752'></a> 30752                                       | XkbKeyTypesMask
<a id='L30753' name='L30753'></a> 30753                                       | XkbModifierMapMask
<a id='L30754' name='L30754'></a> 30754                                       | XkbVirtualModsMask),
<a id='L30755' name='L30755'></a> 30755                                      XkbUseCoreKbd);
<a id='L30756' name='L30756'></a> 30756 
<a id='L30757' name='L30757'></a> 30757       <strong class='reserved'>if</strong> (dpyinfo-&gt;xkb_desc)
<a id='L30758' name='L30758'></a> 30758         XkbGetNames (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, XkbAllNamesMask,
<a id='L30759' name='L30759'></a> 30759                      dpyinfo-&gt;xkb_desc);
<a id='L30760' name='L30760'></a> 30760 
<a id='L30761' name='L30761'></a> 30761       XkbSelectEvents (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, XkbUseCoreKbd,
<a id='L30762' name='L30762'></a> 30762                        XkbNewKeyboardNotifyMask | XkbMapNotifyMask,
<a id='L30763' name='L30763'></a> 30763                        XkbNewKeyboardNotifyMask | XkbMapNotifyMask);
<a id='L30764' name='L30764'></a> 30764     <em class='brace'>}</em>
<a id='L30765' name='L30765'></a> 30765 <em class='sharp'>#endif</em>
<a id='L30766' name='L30766'></a> 30766 
<a id='L30767' name='L30767'></a> 30767 <em class='sharp'>#ifdef</em> HAVE_XFIXES
<a id='L30768' name='L30768'></a> 30768   <strong class='reserved'>int</strong> xfixes_error_base;
<a id='L30769' name='L30769'></a> 30769   dpyinfo-&gt;xfixes_supported_p
<a id='L30770' name='L30770'></a> 30770     = XFixesQueryExtension (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L30771' name='L30771'></a> 30771                             &amp;dpyinfo-&gt;xfixes_event_base,
<a id='L30772' name='L30772'></a> 30772                             &amp;xfixes_error_base);
<a id='L30773' name='L30773'></a> 30773 
<a id='L30774' name='L30774'></a> 30774   <strong class='reserved'>if</strong> (dpyinfo-&gt;xfixes_supported_p)
<a id='L30775' name='L30775'></a> 30775     <em class='brace'>{</em>
<a id='L30776' name='L30776'></a> 30776       <strong class='reserved'>if</strong> (!XFixesQueryVersion (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, &amp;dpyinfo-&gt;xfixes_major,
<a id='L30777' name='L30777'></a> 30777                                &amp;dpyinfo-&gt;xfixes_minor))
<a id='L30778' name='L30778'></a> 30778         dpyinfo-&gt;xfixes_supported_p = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L30779' name='L30779'></a> 30779     <em class='brace'>}</em>
<a id='L30780' name='L30780'></a> 30780 <em class='sharp'>#endif</em>
<a id='L30781' name='L30781'></a> 30781 
<a id='L30782' name='L30782'></a> 30782 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> USE_CAIRO || <strong class='reserved'>defined</strong> HAVE_XFT
<a id='L30783' name='L30783'></a> 30783   <em class='brace'>{</em>
<a id='L30784' name='L30784'></a> 30784     <em class='comment'>/* If we are using Xft, the following precautions should be made:</em>
<a id='L30785' name='L30785'></a> 30785 <em class='comment'></em>
<a id='L30786' name='L30786'></a> 30786 <em class='comment'>       1. Make sure that the Xrender extension is added before the Xft one.</em>
<a id='L30787' name='L30787'></a> 30787 <em class='comment'>       Otherwise, the close-display hook set by Xft is called after the one</em>
<a id='L30788' name='L30788'></a> 30788 <em class='comment'>       for Xrender, and the former tries to re-add the latter.  This results</em>
<a id='L30789' name='L30789'></a> 30789 <em class='comment'>       in inconsistency of internal states and leads to X protocol error when</em>
<a id='L30790' name='L30790'></a> 30790 <em class='comment'>       one reconnects to the same X server (Bug#1696).</em>
<a id='L30791' name='L30791'></a> 30791 <em class='comment'></em>
<a id='L30792' name='L30792'></a> 30792 <em class='comment'>       2. Check dpi value in X resources.  It is better we use it as well,</em>
<a id='L30793' name='L30793'></a> 30793 <em class='comment'>       since Xft will use it, as will all Gnome applications.  If our real DPI</em>
<a id='L30794' name='L30794'></a> 30794 <em class='comment'>       is smaller or larger than the one Xft uses, our font will look smaller</em>
<a id='L30795' name='L30795'></a> 30795 <em class='comment'>       or larger than other for other applications, even if it is the same</em>
<a id='L30796' name='L30796'></a> 30796 <em class='comment'>       font name (monospace-10 for example).  */</em>
<a id='L30797' name='L30797'></a> 30797 
<a id='L30798' name='L30798'></a> 30798     <strong class='reserved'>char</strong> *v = XGetDefault (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, "Xft", "dpi");
<a id='L30799' name='L30799'></a> 30799     <strong class='reserved'>double</strong> <a href='../D/10238.html' title='Multiple defined in 2 places.'>d</a>;
<a id='L30800' name='L30800'></a> 30800     <strong class='reserved'>if</strong> (v != <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a> &amp;&amp; sscanf (v, "%lf", &amp;<a href='../D/10238.html' title='Multiple defined in 2 places.'>d</a>) == 1)
<a id='L30801' name='L30801'></a> 30801       dpyinfo-&gt;resy = dpyinfo-&gt;resx = <a href='../D/10238.html' title='Multiple defined in 2 places.'>d</a>;
<a id='L30802' name='L30802'></a> 30802   <em class='brace'>}</em>
<a id='L30803' name='L30803'></a> 30803 <em class='sharp'>#endif</em>
<a id='L30804' name='L30804'></a> 30804 
<a id='L30805' name='L30805'></a> 30805   <strong class='reserved'>if</strong> (dpyinfo-&gt;resy &lt; 1)
<a id='L30806' name='L30806'></a> 30806     <em class='brace'>{</em>
<a id='L30807' name='L30807'></a> 30807       <strong class='reserved'>int</strong> screen_number = <a href='../S/2296.html#L7400' title='Defined at 7400 in src/xfns.c.'>XScreenNumberOfScreen</a> (dpyinfo-&gt;screen);
<a id='L30808' name='L30808'></a> 30808       <strong class='reserved'>double</strong> pixels = <a href='../S/2321.html#L125' title='Defined at 125 in src/msdos.h.'>DisplayHeight</a> (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, screen_number);
<a id='L30809' name='L30809'></a> 30809       <strong class='reserved'>double</strong> mm = DisplayHeightMM (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, screen_number);
<a id='L30810' name='L30810'></a> 30810       <em class='comment'>/* Mac OS X 10.3's Xserver sometimes reports 0.0mm.  */</em>
<a id='L30811' name='L30811'></a> 30811       dpyinfo-&gt;resy = (mm &lt; 1) ? 100 : pixels * 25.4 / mm;
<a id='L30812' name='L30812'></a> 30812       pixels = <a href='../S/2321.html#L124' title='Defined at 124 in src/msdos.h.'>DisplayWidth</a> (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, screen_number);
<a id='L30813' name='L30813'></a> 30813       mm = DisplayWidthMM (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, screen_number);
<a id='L30814' name='L30814'></a> 30814       <em class='comment'>/* Mac OS X 10.3's Xserver sometimes reports 0.0mm.  */</em>
<a id='L30815' name='L30815'></a> 30815       dpyinfo-&gt;resx = (mm &lt; 1) ? 100 : pixels * 25.4 / mm;
<a id='L30816' name='L30816'></a> 30816     <em class='brace'>}</em>
<a id='L30817' name='L30817'></a> 30817 
<a id='L30818' name='L30818'></a> 30818   <a href='../D/17583.html' title='Multiple defined in 3 places.'>sprintf</a> (cm_atom_sprintf, cm_atom_fmt,
<a id='L30819' name='L30819'></a> 30819            <a href='../S/2296.html#L7400' title='Defined at 7400 in src/xfns.c.'>XScreenNumberOfScreen</a> (dpyinfo-&gt;screen));
<a id='L30820' name='L30820'></a> 30820 
<a id='L30821' name='L30821'></a> 30821   <em class='brace'>{</em>
<a id='L30822' name='L30822'></a> 30822     <strong class='reserved'>enum</strong> <em class='brace'>{</em> <a href='../R/8099.html' title='Multiple referred from 3 places.'>atom_count</a> = <a href='../D/185.html' title='Multiple defined in 3 places.'>ARRAYELTS</a> (x_atom_refs) <em class='brace'>}</em>;
<a id='L30823' name='L30823'></a> 30823     <em class='comment'>/* 1 for _XSETTINGS_SN.  */</em>
<a id='L30824' name='L30824'></a> 30824     <strong class='reserved'>enum</strong> <em class='brace'>{</em> <a href='../R/16984.html' title='Multiple referred from 3 places.'>total_atom_count</a> = 2 + <a href='../S/2289.html#L30822' title='Defined at 30822 in src/xterm.c.'>atom_count</a> <em class='brace'>}</em>;
<a id='L30825' name='L30825'></a> 30825     Atom atoms_return[<a href='../S/2289.html#L30824' title='Defined at 30824 in src/xterm.c.'>total_atom_count</a>];
<a id='L30826' name='L30826'></a> 30826     <strong class='reserved'>char</strong> *atom_names[<a href='../S/2289.html#L30824' title='Defined at 30824 in src/xterm.c.'>total_atom_count</a>];
<a id='L30827' name='L30827'></a> 30827     <strong class='reserved'>static</strong> <strong class='reserved'>char</strong> <strong class='reserved'>const</strong> xsettings_fmt[] = "_XSETTINGS_S%d";
<a id='L30828' name='L30828'></a> 30828     <strong class='reserved'>char</strong> xsettings_atom_name[<strong class='reserved'>sizeof</strong> xsettings_fmt - 2
<a id='L30829' name='L30829'></a> 30829                              + <a href='../S/2707.html#L66' title='Defined at 66 in lib/intprops.h.'>INT_STRLEN_BOUND</a> (<strong class='reserved'>int</strong>)];
<a id='L30830' name='L30830'></a> 30830 
<a id='L30831' name='L30831'></a> 30831     <strong class='reserved'>for</strong> (i = 0; i &lt; <a href='../S/2289.html#L30822' title='Defined at 30822 in src/xterm.c.'>atom_count</a>; i++)
<a id='L30832' name='L30832'></a> 30832       atom_names[i] = (<strong class='reserved'>char</strong> *) x_atom_refs[i].<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>;
<a id='L30833' name='L30833'></a> 30833 
<a id='L30834' name='L30834'></a> 30834     <em class='comment'>/* Build _XSETTINGS_SN atom name.  */</em>
<a id='L30835' name='L30835'></a> 30835     <a href='../D/17583.html' title='Multiple defined in 3 places.'>sprintf</a> (xsettings_atom_name, xsettings_fmt,
<a id='L30836' name='L30836'></a> 30836              <a href='../S/2296.html#L7400' title='Defined at 7400 in src/xfns.c.'>XScreenNumberOfScreen</a> (dpyinfo-&gt;screen));
<a id='L30837' name='L30837'></a> 30837     atom_names[i] = xsettings_atom_name;
<a id='L30838' name='L30838'></a> 30838     atom_names[i + 1] = cm_atom_sprintf;
<a id='L30839' name='L30839'></a> 30839 
<a id='L30840' name='L30840'></a> 30840     XInternAtoms (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, atom_names, <a href='../S/2289.html#L30824' title='Defined at 30824 in src/xterm.c.'>total_atom_count</a>,
<a id='L30841' name='L30841'></a> 30841                   False, atoms_return);
<a id='L30842' name='L30842'></a> 30842 
<a id='L30843' name='L30843'></a> 30843     <strong class='reserved'>for</strong> (i = 0; i &lt; <a href='../S/2289.html#L30822' title='Defined at 30822 in src/xterm.c.'>atom_count</a>; i++)
<a id='L30844' name='L30844'></a> 30844       *(Atom *) ((<strong class='reserved'>char</strong> *) dpyinfo + x_atom_refs[i].<a href='../D/15084.html' title='Multiple defined in 4 places.'>offset</a>) = atoms_return[i];
<a id='L30845' name='L30845'></a> 30845 
<a id='L30846' name='L30846'></a> 30846     <em class='comment'>/* Manually copy last two atoms.  */</em>
<a id='L30847' name='L30847'></a> 30847     dpyinfo-&gt;Xatom_xsettings_sel = atoms_return[i];
<a id='L30848' name='L30848'></a> 30848     dpyinfo-&gt;Xatom_NET_WM_CM_Sn = atoms_return[i + 1];
<a id='L30849' name='L30849'></a> 30849   <em class='brace'>}</em>
<a id='L30850' name='L30850'></a> 30850 
<a id='L30851' name='L30851'></a> 30851 <em class='sharp'>#ifdef</em> HAVE_XKB
<a id='L30852' name='L30852'></a> 30852   <em class='comment'>/* Figure out which modifier bits mean what.  */</em>
<a id='L30853' name='L30853'></a> 30853   x_find_modifier_meanings (dpyinfo);
<a id='L30854' name='L30854'></a> 30854 <em class='sharp'>#endif</em>
<a id='L30855' name='L30855'></a> 30855 
<a id='L30856' name='L30856'></a> 30856   dpyinfo-&gt;x_dnd_atoms_size = 16;
<a id='L30857' name='L30857'></a> 30857   dpyinfo-&gt;x_dnd_atoms = <a href='../D/20068.html' title='Multiple defined in 10 places.'>xmalloc</a> (<strong class='reserved'>sizeof</strong> *dpyinfo-&gt;x_dnd_atoms
<a id='L30858' name='L30858'></a> 30858                                   * dpyinfo-&gt;x_dnd_atoms_size);
<a id='L30859' name='L30859'></a> 30859   dpyinfo-&gt;gray
<a id='L30860' name='L30860'></a> 30860     = XCreatePixmapFromBitmapData (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, dpyinfo-&gt;root_window,
<a id='L30861' name='L30861'></a> 30861                                    gray_bits, gray_width, gray_height,
<a id='L30862' name='L30862'></a> 30862                                    1, 0, 1);
<a id='L30863' name='L30863'></a> 30863 
<a id='L30864' name='L30864'></a> 30864   dpyinfo-&gt;invisible_cursor = <a href='../D/14122.html' title='Multiple defined in 2 places.'>make_invisible_cursor</a> (dpyinfo);
<a id='L30865' name='L30865'></a> 30865 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XFIXES &amp;&amp; XFIXES_VERSION &gt;= 40000
<a id='L30866' name='L30866'></a> 30866   dpyinfo-&gt;fixes_pointer_blanking = (<a href='../D/10883.html' title='Multiple defined in 4 places.'>egetenv</a> ("EMACS_XFIXES") != <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L30867' name='L30867'></a> 30867 <em class='sharp'>#endif</em>
<a id='L30868' name='L30868'></a> 30868 
<a id='L30869' name='L30869'></a> 30869   <a href='../S/2158.html#L1209' title='Defined at 1209 in src/xsettings.c.'>xsettings_initialize</a> (dpyinfo);
<a id='L30870' name='L30870'></a> 30870 
<a id='L30871' name='L30871'></a> 30871   <em class='comment'>/* This is only needed for distinguishing keyboard and process input.  */</em>
<a id='L30872' name='L30872'></a> 30872   <strong class='reserved'>if</strong> (dpyinfo-&gt;connection != 0)
<a id='L30873' name='L30873'></a> 30873     <a href='../S/2235.html#L8096' title='Defined at 8096 in src/process.c.'>add_keyboard_wait_descriptor</a> (dpyinfo-&gt;connection);
<a id='L30874' name='L30874'></a> 30874 
<a id='L30875' name='L30875'></a> 30875 <em class='sharp'>#ifdef</em> F_SETOWN
<a id='L30876' name='L30876'></a> 30876   <a href='../D/11303.html' title='Multiple defined in 6 places.'>fcntl</a> (dpyinfo-&gt;connection, F_SETOWN, <a href='../D/12306.html' title='Multiple defined in 4 places.'>getpid</a> ());
<a id='L30877' name='L30877'></a> 30877 <em class='sharp'>#endif</em> <em class='comment'>/* ! defined (F_SETOWN) */</em>
<a id='L30878' name='L30878'></a> 30878 
<a id='L30879' name='L30879'></a> 30879   <strong class='reserved'>if</strong> (interrupt_input)
<a id='L30880' name='L30880'></a> 30880     <a href='../S/2286.html#L792' title='Defined at 792 in src/sysdep.c.'>init_sigio</a> (dpyinfo-&gt;connection);
<a id='L30881' name='L30881'></a> 30881 
<a id='L30882' name='L30882'></a> 30882 <em class='sharp'>#ifdef</em> USE_LUCID
<a id='L30883' name='L30883'></a> 30883   <em class='brace'>{</em>
<a id='L30884' name='L30884'></a> 30884     XrmValue <a href='../D/10238.html' title='Multiple defined in 2 places.'>d</a>, fr, to;
<a id='L30885' name='L30885'></a> 30885     Font <a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>;
<a id='L30886' name='L30886'></a> 30886     <a href='../S/2321.html#L93' title='Defined at 93 in src/msdos.h.'>XFontStruct</a> *query_result;
<a id='L30887' name='L30887'></a> 30887 
<a id='L30888' name='L30888'></a> 30888     dpy = dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>;
<a id='L30889' name='L30889'></a> 30889     <a href='../D/10238.html' title='Multiple defined in 2 places.'>d</a>.addr = (XPointer) &amp;dpy;
<a id='L30890' name='L30890'></a> 30890     <a href='../D/10238.html' title='Multiple defined in 2 places.'>d</a>.<a href='../D/17482.html' title='Multiple defined in 5 places.'>size</a> = <strong class='reserved'>sizeof</strong> (<a href='../D/1639.html' title='Multiple defined in 6 places.'>Display</a> *);
<a id='L30891' name='L30891'></a> 30891     fr.addr = (<strong class='reserved'>char</strong> *) XtDefaultFont;
<a id='L30892' name='L30892'></a> 30892     fr.<a href='../D/17482.html' title='Multiple defined in 5 places.'>size</a> = <strong class='reserved'>sizeof</strong> (XtDefaultFont);
<a id='L30893' name='L30893'></a> 30893     to.<a href='../D/17482.html' title='Multiple defined in 5 places.'>size</a> = <strong class='reserved'>sizeof</strong> (Font *);
<a id='L30894' name='L30894'></a> 30894     to.addr = (XPointer) &amp;<a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>;
<a id='L30895' name='L30895'></a> 30895     x_catch_errors (dpy);
<a id='L30896' name='L30896'></a> 30896     <strong class='reserved'>if</strong> (!XtCallConverter (dpy, XtCvtStringToFont, &amp;<a href='../D/10238.html' title='Multiple defined in 2 places.'>d</a>, 1, &amp;fr, &amp;to, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>))
<a id='L30897' name='L30897'></a> 30897       <a href='../D/10893.html' title='Multiple defined in 6 places.'>emacs_abort</a> ();
<a id='L30898' name='L30898'></a> 30898     query_result = XQueryFont (dpy, <a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>);
<a id='L30899' name='L30899'></a> 30899 
<a id='L30900' name='L30900'></a> 30900     <em class='comment'>/* Set the dialog font to some fallback (here, 9x15) if the font</em>
<a id='L30901' name='L30901'></a> 30901 <em class='comment'>       specified is invalid.  */</em>
<a id='L30902' name='L30902'></a> 30902     <strong class='reserved'>if</strong> (x_had_errors_p (dpy) || !<a href='../S/2293.html#L277' title='Defined at 277 in src/font.h.'>font</a>)
<a id='L30903' name='L30903'></a> 30903       XrmPutLineResource (&amp;xrdb, "Emacs.dialog.*.font: 9x15");
<a id='L30904' name='L30904'></a> 30904 
<a id='L30905' name='L30905'></a> 30905     <em class='comment'>/* Do not destroy the font struct returned above with XFreeFont;</em>
<a id='L30906' name='L30906'></a> 30906 <em class='comment'>       that also destroys the font, leading to X protocol errors at</em>
<a id='L30907' name='L30907'></a> 30907 <em class='comment'>       XtCloseDisplay.  Just free the font info structure.</em>
<a id='L30908' name='L30908'></a> 30908 <em class='comment'>       (Bug#18403) */</em>
<a id='L30909' name='L30909'></a> 30909     XFreeFontInfo (<a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, query_result, 1);
<a id='L30910' name='L30910'></a> 30910     x_uncatch_errors ();
<a id='L30911' name='L30911'></a> 30911   <em class='brace'>}</em>
<a id='L30912' name='L30912'></a> 30912 <em class='sharp'>#endif</em>
<a id='L30913' name='L30913'></a> 30913 
<a id='L30914' name='L30914'></a> 30914   <em class='comment'>/* See if we should run in synchronous mode.  This is useful</em>
<a id='L30915' name='L30915'></a> 30915 <em class='comment'>     for debugging X code.  */</em>
<a id='L30916' name='L30916'></a> 30916   <em class='brace'>{</em>
<a id='L30917' name='L30917'></a> 30917     <a href='../D/291.html' title='Multiple defined in 2 places.'>AUTO_STRING</a> (synchronous, "synchronous");
<a id='L30918' name='L30918'></a> 30918     <a href='../D/291.html' title='Multiple defined in 2 places.'>AUTO_STRING</a> (Synchronous, "Synchronous");
<a id='L30919' name='L30919'></a> 30919     <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a> = <a href='../S/2247.html#L5323' title='Defined at 5323 in src/frame.c.'>gui_display_get_resource</a> (dpyinfo, synchronous,
<a id='L30920' name='L30920'></a> 30920                                                   Synchronous, Qnil, Qnil);
<a id='L30921' name='L30921'></a> 30921     <strong class='reserved'>if</strong> (<a href='../S/2267.html#L1597' title='Defined at 1597 in src/lisp.h.'>STRINGP</a> (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>)
<a id='L30922' name='L30922'></a> 30922         &amp;&amp; (!strcmp (<a href='../D/5917.html' title='Multiple defined in 2 places.'>SSDATA</a> (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>), "true")
<a id='L30923' name='L30923'></a> 30923             || !strcmp (<a href='../D/5917.html' title='Multiple defined in 2 places.'>SSDATA</a> (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>), "on")))
<a id='L30924' name='L30924'></a> 30924       XSynchronize (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, True);
<a id='L30925' name='L30925'></a> 30925   <em class='brace'>}</em>
<a id='L30926' name='L30926'></a> 30926 
<a id='L30927' name='L30927'></a> 30927 <em class='sharp'>#ifdef</em> HAVE_X_I18N
<a id='L30928' name='L30928'></a> 30928   <em class='brace'>{</em>
<a id='L30929' name='L30929'></a> 30929     <a href='../D/291.html' title='Multiple defined in 2 places.'>AUTO_STRING</a> (useXIM, "useXIM");
<a id='L30930' name='L30930'></a> 30930     <a href='../D/291.html' title='Multiple defined in 2 places.'>AUTO_STRING</a> (UseXIM, "UseXIM");
<a id='L30931' name='L30931'></a> 30931     <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a> = <a href='../S/2247.html#L5323' title='Defined at 5323 in src/frame.c.'>gui_display_get_resource</a> (dpyinfo, useXIM, UseXIM,
<a id='L30932' name='L30932'></a> 30932                                                   Qnil, Qnil);
<a id='L30933' name='L30933'></a> 30933 
<a id='L30934' name='L30934'></a> 30934     <em class='comment'>/* `USE_XIM' controls whether Emacs should use X input methods by</em>
<a id='L30935' name='L30935'></a> 30935 <em class='comment'>       default, not whether or not XIM is available.  */</em>
<a id='L30936' name='L30936'></a> 30936 
<a id='L30937' name='L30937'></a> 30937 <em class='sharp'>#ifdef</em> USE_XIM
<a id='L30938' name='L30938'></a> 30938     dpyinfo-&gt;use_xim = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L30939' name='L30939'></a> 30939 
<a id='L30940' name='L30940'></a> 30940     <strong class='reserved'>if</strong> (<a href='../S/2267.html#L1597' title='Defined at 1597 in src/lisp.h.'>STRINGP</a> (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>)
<a id='L30941' name='L30941'></a> 30941         &amp;&amp; (!strcmp (<a href='../D/5917.html' title='Multiple defined in 2 places.'>SSDATA</a> (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>), "false")
<a id='L30942' name='L30942'></a> 30942             || !strcmp (<a href='../D/5917.html' title='Multiple defined in 2 places.'>SSDATA</a> (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>), "off")))
<a id='L30943' name='L30943'></a> 30943       dpyinfo-&gt;use_xim = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L30944' name='L30944'></a> 30944 <em class='sharp'>#else</em> <em class='comment'>/* !USE_XIM */</em>
<a id='L30945' name='L30945'></a> 30945     dpyinfo-&gt;use_xim = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L30946' name='L30946'></a> 30946 
<a id='L30947' name='L30947'></a> 30947     <strong class='reserved'>if</strong> (<a href='../S/2267.html#L1597' title='Defined at 1597 in src/lisp.h.'>STRINGP</a> (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>)
<a id='L30948' name='L30948'></a> 30948         &amp;&amp; (!strcmp (<a href='../D/5917.html' title='Multiple defined in 2 places.'>SSDATA</a> (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>), "true")
<a id='L30949' name='L30949'></a> 30949             || !strcmp (<a href='../D/5917.html' title='Multiple defined in 2 places.'>SSDATA</a> (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>), "on")))
<a id='L30950' name='L30950'></a> 30950       dpyinfo-&gt;use_xim = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L30951' name='L30951'></a> 30951 <em class='sharp'>#endif</em> <em class='comment'>/* USE_XIM */</em>
<a id='L30952' name='L30952'></a> 30952   <em class='brace'>}</em>
<a id='L30953' name='L30953'></a> 30953 
<a id='L30954' name='L30954'></a> 30954   <em class='brace'>{</em>
<a id='L30955' name='L30955'></a> 30955     <a href='../D/291.html' title='Multiple defined in 2 places.'>AUTO_STRING</a> (inputStyle, "inputStyle");
<a id='L30956' name='L30956'></a> 30956     <a href='../D/291.html' title='Multiple defined in 2 places.'>AUTO_STRING</a> (InputStyle, "InputStyle");
<a id='L30957' name='L30957'></a> 30957     <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a> = <a href='../S/2247.html#L5323' title='Defined at 5323 in src/frame.c.'>gui_display_get_resource</a> (dpyinfo, inputStyle, InputStyle,
<a id='L30958' name='L30958'></a> 30958                                                   Qnil, Qnil);
<a id='L30959' name='L30959'></a> 30959 
<a id='L30960' name='L30960'></a> 30960     <strong class='reserved'>if</strong> (<a href='../S/2267.html#L1597' title='Defined at 1597 in src/lisp.h.'>STRINGP</a> (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>))
<a id='L30961' name='L30961'></a> 30961       <em class='brace'>{</em>
<a id='L30962' name='L30962'></a> 30962         <strong class='reserved'>if</strong> (!strcmp (<a href='../D/5917.html' title='Multiple defined in 2 places.'>SSDATA</a> (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>), "callback"))
<a id='L30963' name='L30963'></a> 30963           dpyinfo-&gt;preferred_xim_style = <a href='../S/2212.html#L1953' title='Defined at 1953 in src/xterm.h.'>STYLE_CALLBACK</a>;
<a id='L30964' name='L30964'></a> 30964         <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (!strcmp (<a href='../D/5917.html' title='Multiple defined in 2 places.'>SSDATA</a> (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>), "none"))
<a id='L30965' name='L30965'></a> 30965           dpyinfo-&gt;preferred_xim_style = <a href='../S/2212.html#L1954' title='Defined at 1954 in src/xterm.h.'>STYLE_NONE</a>;
<a id='L30966' name='L30966'></a> 30966         <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (!strcmp (<a href='../D/5917.html' title='Multiple defined in 2 places.'>SSDATA</a> (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>), "overthespot"))
<a id='L30967' name='L30967'></a> 30967           dpyinfo-&gt;preferred_xim_style = <a href='../S/2212.html#L1951' title='Defined at 1951 in src/xterm.h.'>STYLE_OVERTHESPOT</a>;
<a id='L30968' name='L30968'></a> 30968         <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (!strcmp (<a href='../D/5917.html' title='Multiple defined in 2 places.'>SSDATA</a> (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>), "offthespot"))
<a id='L30969' name='L30969'></a> 30969           dpyinfo-&gt;preferred_xim_style = <a href='../S/2212.html#L1950' title='Defined at 1950 in src/xterm.h.'>STYLE_OFFTHESPOT</a>;
<a id='L30970' name='L30970'></a> 30970         <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (!strcmp (<a href='../D/5917.html' title='Multiple defined in 2 places.'>SSDATA</a> (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>), "root"))
<a id='L30971' name='L30971'></a> 30971           dpyinfo-&gt;preferred_xim_style = <a href='../S/2212.html#L1952' title='Defined at 1952 in src/xterm.h.'>STYLE_ROOT</a>;
<a id='L30972' name='L30972'></a> 30972 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L30973' name='L30973'></a> 30973         <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (!strcmp (<a href='../D/5917.html' title='Multiple defined in 2 places.'>SSDATA</a> (<a href='../S/2332.html#L276' title='Defined at 276 in src/bytecode.c.'>value</a>), "native"))
<a id='L30974' name='L30974'></a> 30974           dpyinfo-&gt;prefer_native_input = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L30975' name='L30975'></a> 30975 <em class='sharp'>#endif</em> <em class='comment'>/* HAVE_GTK */</em>
<a id='L30976' name='L30976'></a> 30976       <em class='brace'>}</em>
<a id='L30977' name='L30977'></a> 30977   <em class='brace'>}</em>
<a id='L30978' name='L30978'></a> 30978 
<a id='L30979' name='L30979'></a> 30979   <em class='comment'>/* Now that defaults have been set up, initialize input method</em>
<a id='L30980' name='L30980'></a> 30980 <em class='comment'>     support.  */</em>
<a id='L30981' name='L30981'></a> 30981 
<a id='L30982' name='L30982'></a> 30982   <em class='comment'>/* Avoid initializing input methods if the X library does not</em>
<a id='L30983' name='L30983'></a> 30983 <em class='comment'>     support Emacs's locale.  When the current locale is not</em>
<a id='L30984' name='L30984'></a> 30984 <em class='comment'>     supported, decoding input method strings becomes undefined.  */</em>
<a id='L30985' name='L30985'></a> 30985   <strong class='reserved'>if</strong> (XSupportsLocale ())
<a id='L30986' name='L30986'></a> 30986     xim_initialize (dpyinfo, resource_name);
<a id='L30987' name='L30987'></a> 30987 <em class='sharp'>#endif</em> <em class='comment'>/* HAVE_X_I18N */</em>
<a id='L30988' name='L30988'></a> 30988 
<a id='L30989' name='L30989'></a> 30989 <em class='sharp'>#ifdef</em> HAVE_X_SM
<a id='L30990' name='L30990'></a> 30990   <em class='comment'>/* Only do this for the very first display in the Emacs session.</em>
<a id='L30991' name='L30991'></a> 30991 <em class='comment'>     Ignore X session management when Emacs was first started on a</em>
<a id='L30992' name='L30992'></a> 30992 <em class='comment'>     tty or started as a daemon.  */</em>
<a id='L30993' name='L30993'></a> 30993   <strong class='reserved'>if</strong> (!dpyinfo-&gt;next &amp;&amp; ! <a href='../D/3359.html' title='Multiple defined in 4 places.'>IS_DAEMON</a>)
<a id='L30994' name='L30994'></a> 30994     <a href='../S/2294.html#L395' title='Defined at 395 in src/xsmfns.c.'>x_session_initialize</a> (dpyinfo);
<a id='L30995' name='L30995'></a> 30995 <em class='sharp'>#endif</em>
<a id='L30996' name='L30996'></a> 30996 
<a id='L30997' name='L30997'></a> 30997 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> USE_CAIRO || <strong class='reserved'>defined</strong> HAVE_XRENDER
<a id='L30998' name='L30998'></a> 30998   <a href='../S/2289.html#L5285' title='Defined at 5285 in src/xterm.c.'>x_extension_initialize</a> (dpyinfo);
<a id='L30999' name='L30999'></a> 30999 <em class='sharp'>#endif</em>
<a id='L31000' name='L31000'></a> 31000 
<a id='L31001' name='L31001'></a> 31001 <em class='sharp'>#ifdef</em> USE_TOOLKIT_SCROLL_BARS
<a id='L31002' name='L31002'></a> 31002   dpyinfo-&gt;protected_windows = <a href='../D/20068.html' title='Multiple defined in 10 places.'>xmalloc</a> (<strong class='reserved'>sizeof</strong> (<a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a>) * 256);
<a id='L31003' name='L31003'></a> 31003   dpyinfo-&gt;n_protected_windows = 0;
<a id='L31004' name='L31004'></a> 31004   dpyinfo-&gt;protected_windows_max = 256;
<a id='L31005' name='L31005'></a> 31005 <em class='sharp'>#endif</em>
<a id='L31006' name='L31006'></a> 31006 
<a id='L31007' name='L31007'></a> 31007 <em class='sharp'>#ifdef</em> HAVE_XFIXES
<a id='L31008' name='L31008'></a> 31008   <em class='comment'>/* Initialize selection tracking for the selections in</em>
<a id='L31009' name='L31009'></a> 31009 <em class='comment'>     x-fast-selection-list.  */</em>
<a id='L31010' name='L31010'></a> 31010 
<a id='L31011' name='L31011'></a> 31011   <strong class='reserved'>if</strong> (<a href='../D/1228.html' title='Multiple defined in 2 places.'>CONSP</a> (Vx_fast_selection_list)
<a id='L31012' name='L31012'></a> 31012       &amp;&amp; dpyinfo-&gt;xfixes_supported_p
<a id='L31013' name='L31013'></a> 31013       &amp;&amp; dpyinfo-&gt;xfixes_major &gt;= 1)
<a id='L31014' name='L31014'></a> 31014     <em class='brace'>{</em>
<a id='L31015' name='L31015'></a> 31015       num_fast_selections = 0;
<a id='L31016' name='L31016'></a> 31016       tem = Vx_fast_selection_list;
<a id='L31017' name='L31017'></a> 31017 
<a id='L31018' name='L31018'></a> 31018       <a href='../S/2267.html#L5578' title='Defined at 5578 in src/lisp.h.'>FOR_EACH_TAIL_SAFE</a> (tem)
<a id='L31019' name='L31019'></a> 31019         <em class='brace'>{</em>
<a id='L31020' name='L31020'></a> 31020           <strong class='reserved'>if</strong> (!<a href='../S/4044.html#L397' title='Defined at 397 in test/manual/etags/c-src/emacs/src/lisp.h.'>SYMBOLP</a> (<a href='../D/7021.html' title='Multiple defined in 2 places.'>XCAR</a> (tem)))
<a id='L31021' name='L31021'></a> 31021             <strong class='reserved'>continue</strong>;
<a id='L31022' name='L31022'></a> 31022 
<a id='L31023' name='L31023'></a> 31023           num_fast_selections++;
<a id='L31024' name='L31024'></a> 31024         <em class='brace'>}</em>
<a id='L31025' name='L31025'></a> 31025 
<a id='L31026' name='L31026'></a> 31026       dpyinfo-&gt;n_monitored_selections = num_fast_selections;
<a id='L31027' name='L31027'></a> 31027       dpyinfo-&gt;selection_tracking_window
<a id='L31028' name='L31028'></a> 31028         = <a href='../S/2289.html#L8048' title='Defined at 8048 in src/xterm.c.'>x_create_special_window</a> (dpyinfo, dpyinfo-&gt;root_window);
<a id='L31029' name='L31029'></a> 31029       dpyinfo-&gt;monitored_selections
<a id='L31030' name='L31030'></a> 31030         = <a href='../D/20068.html' title='Multiple defined in 10 places.'>xmalloc</a> (num_fast_selections
<a id='L31031' name='L31031'></a> 31031                    * <strong class='reserved'>sizeof</strong> *dpyinfo-&gt;monitored_selections);
<a id='L31032' name='L31032'></a> 31032 
<a id='L31033' name='L31033'></a> 31033       num_fast_selections = 0;
<a id='L31034' name='L31034'></a> 31034       tem = Vx_fast_selection_list;
<a id='L31035' name='L31035'></a> 31035 
<a id='L31036' name='L31036'></a> 31036       <a href='../S/2267.html#L5578' title='Defined at 5578 in src/lisp.h.'>FOR_EACH_TAIL_SAFE</a> (tem)
<a id='L31037' name='L31037'></a> 31037         <em class='brace'>{</em>
<a id='L31038' name='L31038'></a> 31038           lisp_name = <a href='../D/7021.html' title='Multiple defined in 2 places.'>XCAR</a> (tem);
<a id='L31039' name='L31039'></a> 31039 
<a id='L31040' name='L31040'></a> 31040           <strong class='reserved'>if</strong> (!<a href='../S/4044.html#L397' title='Defined at 397 in test/manual/etags/c-src/emacs/src/lisp.h.'>SYMBOLP</a> (lisp_name))
<a id='L31041' name='L31041'></a> 31041             <strong class='reserved'>continue</strong>;
<a id='L31042' name='L31042'></a> 31042 
<a id='L31043' name='L31043'></a> 31043           selection_name = <a href='../S/2281.html#L126' title='Defined at 126 in src/xselect.c.'>symbol_to_x_atom</a> (dpyinfo, lisp_name);
<a id='L31044' name='L31044'></a> 31044           dpyinfo-&gt;monitored_selections[num_fast_selections++].<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>
<a id='L31045' name='L31045'></a> 31045             = selection_name;
<a id='L31046' name='L31046'></a> 31046           dpyinfo-&gt;monitored_selections[num_fast_selections - 1].owner
<a id='L31047' name='L31047'></a> 31047             = <a href='../S/2212.html#L361' title='Defined at 361 in src/xterm.h.'>X_INVALID_WINDOW</a>;
<a id='L31048' name='L31048'></a> 31048 
<a id='L31049' name='L31049'></a> 31049           <em class='comment'>/* Select for selection input.  */</em>
<a id='L31050' name='L31050'></a> 31050           XFixesSelectSelectionInput (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L31051' name='L31051'></a> 31051                                       dpyinfo-&gt;selection_tracking_window,
<a id='L31052' name='L31052'></a> 31052                                       selection_name,
<a id='L31053' name='L31053'></a> 31053                                       (XFixesSetSelectionOwnerNotifyMask
<a id='L31054' name='L31054'></a> 31054                                        | XFixesSetSelectionOwnerNotifyMask
<a id='L31055' name='L31055'></a> 31055                                        | XFixesSelectionClientCloseNotifyMask));
<a id='L31056' name='L31056'></a> 31056         <em class='brace'>}</em>
<a id='L31057' name='L31057'></a> 31057 
<a id='L31058' name='L31058'></a> 31058 <em class='sharp'>#ifdef</em> USE_XCB
<a id='L31059' name='L31059'></a> 31059       selection_cookies = <a href='../D/5389.html' title='Multiple defined in 2 places.'>SAFE_ALLOCA</a> (<strong class='reserved'>sizeof</strong> *selection_cookies
<a id='L31060' name='L31060'></a> 31060                                        * num_fast_selections);
<a id='L31061' name='L31061'></a> 31061 <em class='sharp'>#endif</em>
<a id='L31062' name='L31062'></a> 31062 
<a id='L31063' name='L31063'></a> 31063       <em class='comment'>/* Now, ask for the current owners of all those selections.  */</em>
<a id='L31064' name='L31064'></a> 31064       <strong class='reserved'>for</strong> (i = 0; i &lt; num_fast_selections; ++i)
<a id='L31065' name='L31065'></a> 31065         <em class='brace'>{</em>
<a id='L31066' name='L31066'></a> 31066 <em class='sharp'>#ifdef</em> USE_XCB
<a id='L31067' name='L31067'></a> 31067           selection_cookies[i]
<a id='L31068' name='L31068'></a> 31068             = xcb_get_selection_owner (dpyinfo-&gt;xcb_connection,
<a id='L31069' name='L31069'></a> 31069                                        dpyinfo-&gt;monitored_selections[i].<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>);
<a id='L31070' name='L31070'></a> 31070 <em class='sharp'>#else</em>
<a id='L31071' name='L31071'></a> 31071           dpyinfo-&gt;monitored_selections[i].owner
<a id='L31072' name='L31072'></a> 31072             = XGetSelectionOwner (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L31073' name='L31073'></a> 31073                                   dpyinfo-&gt;monitored_selections[i].<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>);
<a id='L31074' name='L31074'></a> 31074 <em class='sharp'>#endif</em>
<a id='L31075' name='L31075'></a> 31075         <em class='brace'>}</em>
<a id='L31076' name='L31076'></a> 31076 
<a id='L31077' name='L31077'></a> 31077 <em class='sharp'>#ifdef</em> USE_XCB
<a id='L31078' name='L31078'></a> 31078       <strong class='reserved'>for</strong> (i = 0; i &lt; num_fast_selections; ++i)
<a id='L31079' name='L31079'></a> 31079         <em class='brace'>{</em>
<a id='L31080' name='L31080'></a> 31080           selection_reply
<a id='L31081' name='L31081'></a> 31081             = xcb_get_selection_owner_reply (dpyinfo-&gt;xcb_connection,
<a id='L31082' name='L31082'></a> 31082                                              selection_cookies[i],
<a id='L31083' name='L31083'></a> 31083                                              &amp;selection_error);
<a id='L31084' name='L31084'></a> 31084 
<a id='L31085' name='L31085'></a> 31085           <strong class='reserved'>if</strong> (selection_reply)
<a id='L31086' name='L31086'></a> 31086             <em class='brace'>{</em>
<a id='L31087' name='L31087'></a> 31087               dpyinfo-&gt;monitored_selections[i].owner
<a id='L31088' name='L31088'></a> 31088                 = selection_reply-&gt;owner;
<a id='L31089' name='L31089'></a> 31089               <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (selection_reply);
<a id='L31090' name='L31090'></a> 31090             <em class='brace'>}</em>
<a id='L31091' name='L31091'></a> 31091           <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (selection_error)
<a id='L31092' name='L31092'></a> 31092             <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (selection_error);
<a id='L31093' name='L31093'></a> 31093         <em class='brace'>}</em>
<a id='L31094' name='L31094'></a> 31094 <em class='sharp'>#endif</em>
<a id='L31095' name='L31095'></a> 31095     <em class='brace'>}</em>
<a id='L31096' name='L31096'></a> 31096 <em class='sharp'>#endif</em>
<a id='L31097' name='L31097'></a> 31097 
<a id='L31098' name='L31098'></a> 31098   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L31099' name='L31099'></a> 31099 
<a id='L31100' name='L31100'></a> 31100 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XFIXES &amp;&amp; <strong class='reserved'>defined</strong> USE_XCB
<a id='L31101' name='L31101'></a> 31101   <a href='../D/5394.html' title='Multiple defined in 2 places.'>SAFE_FREE</a> ();
<a id='L31102' name='L31102'></a> 31102 <em class='sharp'>#endif</em>
<a id='L31103' name='L31103'></a> 31103   <strong class='reserved'>return</strong> dpyinfo;
<a id='L31104' name='L31104'></a> 31104 <em class='brace'>}</em>
<a id='L31105' name='L31105'></a> 31105 
<a id='L31106' name='L31106'></a> 31106 
<a id='L31107' name='L31107'></a> 31107 
<a id='L31108' name='L31108'></a> 31108 <em class='comment'>/* Remove all the selection input events on the keyboard buffer</em>
<a id='L31109' name='L31109'></a> 31109 <em class='comment'>   intended for DPYINFO.  */</em>
<a id='L31110' name='L31110'></a> 31110 
<a id='L31111' name='L31111'></a> 31111 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L31112' name='L31112'></a> 31112 x_delete_selection_requests (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo)
<a id='L31113' name='L31113'></a> 31113 <em class='brace'>{</em>
<a id='L31114' name='L31114'></a> 31114   <strong class='reserved'>union</strong> <a href='../S/2185.html#L229' title='Defined at 229 in src/keyboard.h.'>buffered_input_event</a> *event;
<a id='L31115' name='L31115'></a> 31115   <strong class='reserved'>int</strong> moved_events;
<a id='L31116' name='L31116'></a> 31116 
<a id='L31117' name='L31117'></a> 31117   <strong class='reserved'>for</strong> (event = kbd_fetch_ptr; event != kbd_store_ptr;
<a id='L31118' name='L31118'></a> 31118        event = <a href='../S/2289.html#L888' title='Defined at 888 in src/xterm.c.'>X_NEXT_KBD_EVENT</a> (event))
<a id='L31119' name='L31119'></a> 31119     <em class='brace'>{</em>
<a id='L31120' name='L31120'></a> 31120       <strong class='reserved'>if</strong> (event-&gt;kind == <a href='../S/2231.html#L185' title='Defined at 185 in src/termhooks.h.'>SELECTION_REQUEST_EVENT</a>
<a id='L31121' name='L31121'></a> 31121           || event-&gt;kind == <a href='../S/2231.html#L187' title='Defined at 187 in src/termhooks.h.'>SELECTION_CLEAR_EVENT</a>)
<a id='L31122' name='L31122'></a> 31122         <em class='brace'>{</em>
<a id='L31123' name='L31123'></a> 31123           <strong class='reserved'>if</strong> (<a href='../D/5566.html' title='Multiple defined in 2 places.'>SELECTION_EVENT_DPYINFO</a> (&amp;event-&gt;sie) != dpyinfo)
<a id='L31124' name='L31124'></a> 31124             <strong class='reserved'>continue</strong>;
<a id='L31125' name='L31125'></a> 31125 
<a id='L31126' name='L31126'></a> 31126           <em class='comment'>/* Remove the event from the fifo buffer before processing;</em>
<a id='L31127' name='L31127'></a> 31127 <em class='comment'>             otherwise swallow_events called recursively could see it</em>
<a id='L31128' name='L31128'></a> 31128 <em class='comment'>             and process it again.  To do this, we move the events</em>
<a id='L31129' name='L31129'></a> 31129 <em class='comment'>             between kbd_fetch_ptr and EVENT one slot to the right,</em>
<a id='L31130' name='L31130'></a> 31130 <em class='comment'>             cyclically.  */</em>
<a id='L31131' name='L31131'></a> 31131 
<a id='L31132' name='L31132'></a> 31132           <strong class='reserved'>if</strong> (event &lt; kbd_fetch_ptr)
<a id='L31133' name='L31133'></a> 31133             <em class='brace'>{</em>
<a id='L31134' name='L31134'></a> 31134               <a href='../S/2936.html#L81' title='Defined at 81 in lib/canonicalize-lgpl.c.'>memmove</a> (kbd_buffer + 1, kbd_buffer,
<a id='L31135' name='L31135'></a> 31135                        (event - kbd_buffer) * <strong class='reserved'>sizeof</strong> *kbd_buffer);
<a id='L31136' name='L31136'></a> 31136               kbd_buffer[0] = kbd_buffer[<a href='../D/3480.html' title='Multiple defined in 2 places.'>KBD_BUFFER_SIZE</a> - 1];
<a id='L31137' name='L31137'></a> 31137               moved_events = kbd_buffer + <a href='../D/3480.html' title='Multiple defined in 2 places.'>KBD_BUFFER_SIZE</a> - 1 - kbd_fetch_ptr;
<a id='L31138' name='L31138'></a> 31138             <em class='brace'>}</em>
<a id='L31139' name='L31139'></a> 31139           <strong class='reserved'>else</strong>
<a id='L31140' name='L31140'></a> 31140             moved_events = event - kbd_fetch_ptr;
<a id='L31141' name='L31141'></a> 31141 
<a id='L31142' name='L31142'></a> 31142           <a href='../S/2936.html#L81' title='Defined at 81 in lib/canonicalize-lgpl.c.'>memmove</a> (kbd_fetch_ptr + 1, kbd_fetch_ptr,
<a id='L31143' name='L31143'></a> 31143                    moved_events * <strong class='reserved'>sizeof</strong> *kbd_fetch_ptr);
<a id='L31144' name='L31144'></a> 31144           kbd_fetch_ptr = <a href='../S/2289.html#L888' title='Defined at 888 in src/xterm.c.'>X_NEXT_KBD_EVENT</a> (kbd_fetch_ptr);
<a id='L31145' name='L31145'></a> 31145 
<a id='L31146' name='L31146'></a> 31146           <em class='comment'>/* `detect_input_pending' will then recompute whether or not</em>
<a id='L31147' name='L31147'></a> 31147 <em class='comment'>             pending input events exist.  */</em>
<a id='L31148' name='L31148'></a> 31148           input_pending = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L31149' name='L31149'></a> 31149         <em class='brace'>}</em>
<a id='L31150' name='L31150'></a> 31150     <em class='brace'>}</em>
<a id='L31151' name='L31151'></a> 31151 <em class='brace'>}</em>
<a id='L31152' name='L31152'></a> 31152 
<a id='L31153' name='L31153'></a> 31153 <em class='comment'>/* Get rid of display DPYINFO, deleting all frames on it,</em>
<a id='L31154' name='L31154'></a> 31154 <em class='comment'>   and without sending any more commands to the X server.  */</em>
<a id='L31155' name='L31155'></a> 31155 
<a id='L31156' name='L31156'></a> 31156 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L31157' name='L31157'></a> 31157 x_delete_display (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo)
<a id='L31158' name='L31158'></a> 31158 <em class='brace'>{</em>
<a id='L31159' name='L31159'></a> 31159   <strong class='reserved'>struct</strong> <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a> *t;
<a id='L31160' name='L31160'></a> 31160   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L215' title='Defined at 215 in src/xterm.h.'>color_name_cache_entry</a> *color_entry, *next_color_entry;
<a id='L31161' name='L31161'></a> 31161   <strong class='reserved'>int</strong> i;
<a id='L31162' name='L31162'></a> 31162   <strong class='reserved'>struct</strong> <a href='../S/2289.html#L961' title='Defined at 961 in src/xterm.c.'>x_selection_request_event</a> *ie, *last, *temp;
<a id='L31163' name='L31163'></a> 31163 
<a id='L31164' name='L31164'></a> 31164   <em class='comment'>/* Close all frames and delete the generic struct terminal for this</em>
<a id='L31165' name='L31165'></a> 31165 <em class='comment'>     X display.  */</em>
<a id='L31166' name='L31166'></a> 31166   <strong class='reserved'>for</strong> (t = terminal_list; t; t = t-&gt;next_terminal)
<a id='L31167' name='L31167'></a> 31167     <strong class='reserved'>if</strong> (t-&gt;type == <a href='../S/2231.html#L61' title='Defined at 61 in src/termhooks.h.'>output_x_window</a> &amp;&amp; t-&gt;<a href='../S/2231.html#L518' title='Defined at 518 in src/termhooks.h.'>display_info</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> == dpyinfo)
<a id='L31168' name='L31168'></a> 31168       <em class='brace'>{</em>
<a id='L31169' name='L31169'></a> 31169 <em class='sharp'>#ifdef</em> HAVE_X_SM
<a id='L31170' name='L31170'></a> 31170         <em class='comment'>/* Close X session management when we close its display.  */</em>
<a id='L31171' name='L31171'></a> 31171         <strong class='reserved'>if</strong> (t-&gt;id == 1 &amp;&amp; <a href='../S/2294.html#L128' title='Defined at 128 in src/xsmfns.c.'>x_session_have_connection</a> ())
<a id='L31172' name='L31172'></a> 31172           <a href='../S/2294.html#L487' title='Defined at 487 in src/xsmfns.c.'>x_session_close</a> ();
<a id='L31173' name='L31173'></a> 31173 <em class='sharp'>#endif</em>
<a id='L31174' name='L31174'></a> 31174         <a href='../S/2199.html#L313' title='Defined at 313 in src/terminal.c.'>delete_terminal</a> (t);
<a id='L31175' name='L31175'></a> 31175         <strong class='reserved'>break</strong>;
<a id='L31176' name='L31176'></a> 31176       <em class='brace'>}</em>
<a id='L31177' name='L31177'></a> 31177 
<a id='L31178' name='L31178'></a> 31178   <em class='comment'>/* Find any pending selection requests for this display and unchain</em>
<a id='L31179' name='L31179'></a> 31179 <em class='comment'>     them.  */</em>
<a id='L31180' name='L31180'></a> 31180 
<a id='L31181' name='L31181'></a> 31181   last = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L31182' name='L31182'></a> 31182 
<a id='L31183' name='L31183'></a> 31183   <strong class='reserved'>for</strong> (ie = pending_selection_requests; ie; ie = ie-&gt;next)
<a id='L31184' name='L31184'></a> 31184     <em class='brace'>{</em>
<a id='L31185' name='L31185'></a> 31185     again:
<a id='L31186' name='L31186'></a> 31186 
<a id='L31187' name='L31187'></a> 31187       <strong class='reserved'>if</strong> (<a href='../D/5566.html' title='Multiple defined in 2 places.'>SELECTION_EVENT_DPYINFO</a> (&amp;ie-&gt;se) == dpyinfo)
<a id='L31188' name='L31188'></a> 31188         <em class='brace'>{</em>
<a id='L31189' name='L31189'></a> 31189           <strong class='reserved'>if</strong> (last)
<a id='L31190' name='L31190'></a> 31190             last-&gt;next = ie-&gt;next;
<a id='L31191' name='L31191'></a> 31191 
<a id='L31192' name='L31192'></a> 31192           temp = ie;
<a id='L31193' name='L31193'></a> 31193           ie = ie-&gt;next;
<a id='L31194' name='L31194'></a> 31194           <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (temp);
<a id='L31195' name='L31195'></a> 31195 
<a id='L31196' name='L31196'></a> 31196           <strong class='reserved'>goto</strong> again;
<a id='L31197' name='L31197'></a> 31197         <em class='brace'>}</em>
<a id='L31198' name='L31198'></a> 31198 
<a id='L31199' name='L31199'></a> 31199       last = ie;
<a id='L31200' name='L31200'></a> 31200     <em class='brace'>}</em>
<a id='L31201' name='L31201'></a> 31201 
<a id='L31202' name='L31202'></a> 31202   <em class='comment'>/* Delete selection requests bound for dpyinfo from the keyboard</em>
<a id='L31203' name='L31203'></a> 31203 <em class='comment'>     buffer.  */</em>
<a id='L31204' name='L31204'></a> 31204   x_delete_selection_requests (dpyinfo);
<a id='L31205' name='L31205'></a> 31205 
<a id='L31206' name='L31206'></a> 31206   <em class='comment'>/* And remove any outstanding selection transfers.  */</em>
<a id='L31207' name='L31207'></a> 31207   <a href='../S/2281.html#L1009' title='Defined at 1009 in src/xselect.c.'>x_remove_selection_transfers</a> (dpyinfo);
<a id='L31208' name='L31208'></a> 31208 
<a id='L31209' name='L31209'></a> 31209   <strong class='reserved'>if</strong> (next_noop_dpyinfo == dpyinfo)
<a id='L31210' name='L31210'></a> 31210     next_noop_dpyinfo = dpyinfo-&gt;next;
<a id='L31211' name='L31211'></a> 31211 
<a id='L31212' name='L31212'></a> 31212   <strong class='reserved'>if</strong> (mouse_click_timeout_display == dpyinfo)
<a id='L31213' name='L31213'></a> 31213     mouse_click_timeout_display = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L31214' name='L31214'></a> 31214 
<a id='L31215' name='L31215'></a> 31215   <strong class='reserved'>if</strong> (x_display_list == dpyinfo)
<a id='L31216' name='L31216'></a> 31216     x_display_list = dpyinfo-&gt;next;
<a id='L31217' name='L31217'></a> 31217   <strong class='reserved'>else</strong>
<a id='L31218' name='L31218'></a> 31218     <em class='brace'>{</em>
<a id='L31219' name='L31219'></a> 31219       <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *<a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>;
<a id='L31220' name='L31220'></a> 31220 
<a id='L31221' name='L31221'></a> 31221       <strong class='reserved'>for</strong> (<a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a> = x_display_list; <a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>; <a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a> = <a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>-&gt;next)
<a id='L31222' name='L31222'></a> 31222         <strong class='reserved'>if</strong> (<a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>-&gt;next == dpyinfo)
<a id='L31223' name='L31223'></a> 31223           <a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>-&gt;next = <a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>-&gt;next-&gt;next;
<a id='L31224' name='L31224'></a> 31224     <em class='brace'>}</em>
<a id='L31225' name='L31225'></a> 31225 
<a id='L31226' name='L31226'></a> 31226   <strong class='reserved'>for</strong> (i = 0; i &lt; dpyinfo-&gt;color_names_size; ++i)
<a id='L31227' name='L31227'></a> 31227     <em class='brace'>{</em>
<a id='L31228' name='L31228'></a> 31228       <strong class='reserved'>for</strong> (color_entry = dpyinfo-&gt;color_names[i];
<a id='L31229' name='L31229'></a> 31229            color_entry; color_entry = next_color_entry)
<a id='L31230' name='L31230'></a> 31230         <em class='brace'>{</em>
<a id='L31231' name='L31231'></a> 31231           next_color_entry = color_entry-&gt;next;
<a id='L31232' name='L31232'></a> 31232 
<a id='L31233' name='L31233'></a> 31233           <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (color_entry-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>);
<a id='L31234' name='L31234'></a> 31234           <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (color_entry);
<a id='L31235' name='L31235'></a> 31235         <em class='brace'>}</em>
<a id='L31236' name='L31236'></a> 31236     <em class='brace'>}</em>
<a id='L31237' name='L31237'></a> 31237 
<a id='L31238' name='L31238'></a> 31238   <strong class='reserved'>if</strong> (dpyinfo-&gt;net_supported_atoms)
<a id='L31239' name='L31239'></a> 31239     XFree (dpyinfo-&gt;net_supported_atoms);
<a id='L31240' name='L31240'></a> 31240 
<a id='L31241' name='L31241'></a> 31241   <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (dpyinfo-&gt;color_names);
<a id='L31242' name='L31242'></a> 31242   <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (dpyinfo-&gt;color_names_length);
<a id='L31243' name='L31243'></a> 31243   <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (dpyinfo-&gt;x_id_name);
<a id='L31244' name='L31244'></a> 31244   <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (dpyinfo-&gt;x_dnd_atoms);
<a id='L31245' name='L31245'></a> 31245   <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (dpyinfo-&gt;color_cells);
<a id='L31246' name='L31246'></a> 31246 <em class='sharp'>#ifdef</em> HAVE_XFIXES
<a id='L31247' name='L31247'></a> 31247   <strong class='reserved'>if</strong> (dpyinfo-&gt;monitored_selections)
<a id='L31248' name='L31248'></a> 31248     <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (dpyinfo-&gt;monitored_selections);
<a id='L31249' name='L31249'></a> 31249 <em class='sharp'>#endif</em>
<a id='L31250' name='L31250'></a> 31250 <em class='sharp'>#ifdef</em> USE_TOOLKIT_SCROLL_BARS
<a id='L31251' name='L31251'></a> 31251   <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (dpyinfo-&gt;protected_windows);
<a id='L31252' name='L31252'></a> 31252 <em class='sharp'>#endif</em>
<a id='L31253' name='L31253'></a> 31253 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L31254' name='L31254'></a> 31254   <strong class='reserved'>if</strong> (dpyinfo-&gt;supports_xi2)
<a id='L31255' name='L31255'></a> 31255     <a href='../S/2289.html#L5355' title='Defined at 5355 in src/xterm.c.'>x_free_xi_devices</a> (dpyinfo);
<a id='L31256' name='L31256'></a> 31256 <em class='sharp'>#endif</em>
<a id='L31257' name='L31257'></a> 31257   <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (dpyinfo);
<a id='L31258' name='L31258'></a> 31258 <em class='brace'>}</em>
<a id='L31259' name='L31259'></a> 31259 
<a id='L31260' name='L31260'></a> 31260 <em class='sharp'>#ifdef</em> USE_X_TOOLKIT
<a id='L31261' name='L31261'></a> 31261 
<a id='L31262' name='L31262'></a> 31262 <em class='comment'>/* Atimer callback function for TIMER.  Called every 0.1s to process</em>
<a id='L31263' name='L31263'></a> 31263 <em class='comment'>   Xt timeouts, if needed.  We must avoid calling XtAppPending as</em>
<a id='L31264' name='L31264'></a> 31264 <em class='comment'>   much as possible because that function does an implicit XFlush</em>
<a id='L31265' name='L31265'></a> 31265 <em class='comment'>   that slows us down.  */</em>
<a id='L31266' name='L31266'></a> 31266 
<a id='L31267' name='L31267'></a> 31267 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L31268' name='L31268'></a> 31268 x_process_timeouts (<strong class='reserved'>struct</strong> <a href='../S/2141.html#L48' title='Defined at 48 in src/atimer.h.'>atimer</a> *timer)
<a id='L31269' name='L31269'></a> 31269 <em class='brace'>{</em>
<a id='L31270' name='L31270'></a> 31270   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L31271' name='L31271'></a> 31271   x_timeout_atimer_activated_flag = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L31272' name='L31272'></a> 31272   <strong class='reserved'>if</strong> (toolkit_scroll_bar_interaction || <a href='../D/15672.html' title='Multiple defined in 5 places.'>popup_activated</a> ())
<a id='L31273' name='L31273'></a> 31273     <em class='brace'>{</em>
<a id='L31274' name='L31274'></a> 31274       <strong class='reserved'>while</strong> (XtAppPending (Xt_app_con) &amp; XtIMTimer)
<a id='L31275' name='L31275'></a> 31275         XtAppProcessEvent (Xt_app_con, XtIMTimer);
<a id='L31276' name='L31276'></a> 31276       <em class='comment'>/* Reactivate the atimer for next time.  */</em>
<a id='L31277' name='L31277'></a> 31277       x_activate_timeout_atimer ();
<a id='L31278' name='L31278'></a> 31278     <em class='brace'>}</em>
<a id='L31279' name='L31279'></a> 31279   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L31280' name='L31280'></a> 31280 <em class='brace'>}</em>
<a id='L31281' name='L31281'></a> 31281 
<a id='L31282' name='L31282'></a> 31282 <em class='comment'>/* Install an asynchronous timer that processes Xt timeout events</em>
<a id='L31283' name='L31283'></a> 31283 <em class='comment'>   every 0.1s as long as either `toolkit_scroll_bar_interaction' or</em>
<a id='L31284' name='L31284'></a> 31284 <em class='comment'>   `popup_activated_flag' (in xmenu.c) is set.  Make sure to call this</em>
<a id='L31285' name='L31285'></a> 31285 <em class='comment'>   function whenever these variables are set.  This is necessary</em>
<a id='L31286' name='L31286'></a> 31286 <em class='comment'>   because some widget sets use timeouts internally, for example the</em>
<a id='L31287' name='L31287'></a> 31287 <em class='comment'>   LessTif menu bar, or the Xaw3d scroll bar.  When Xt timeouts aren't</em>
<a id='L31288' name='L31288'></a> 31288 <em class='comment'>   processed, these widgets don't behave normally.  */</em>
<a id='L31289' name='L31289'></a> 31289 
<a id='L31290' name='L31290'></a> 31290 <strong class='reserved'>void</strong>
<a id='L31291' name='L31291'></a> 31291 x_activate_timeout_atimer (<strong class='reserved'>void</strong>)
<a id='L31292' name='L31292'></a> 31292 <em class='brace'>{</em>
<a id='L31293' name='L31293'></a> 31293   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L31294' name='L31294'></a> 31294   <strong class='reserved'>if</strong> (!x_timeout_atimer_activated_flag)
<a id='L31295' name='L31295'></a> 31295     <em class='brace'>{</em>
<a id='L31296' name='L31296'></a> 31296       <strong class='reserved'>struct</strong> <a href='../D/18278.html' title='Multiple defined in 3 places.'>timespec</a> <a href='../S/2228.html#L29' title='Defined at 29 in src/intervals.h.'>interval</a> = <a href='../S/2788.html#L56' title='Defined at 56 in lib/timespec.h.'>make_timespec</a> (0, 100 * 1000 * 1000);
<a id='L31297' name='L31297'></a> 31297       <a href='../S/2123.html#L115' title='Defined at 115 in src/atimer.c.'>start_atimer</a> (<a href='../S/2141.html#L36' title='Defined at 36 in src/atimer.h.'>ATIMER_RELATIVE</a>, <a href='../S/2228.html#L29' title='Defined at 29 in src/intervals.h.'>interval</a>, x_process_timeouts, 0);
<a id='L31298' name='L31298'></a> 31298       x_timeout_atimer_activated_flag = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L31299' name='L31299'></a> 31299     <em class='brace'>}</em>
<a id='L31300' name='L31300'></a> 31300   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L31301' name='L31301'></a> 31301 <em class='brace'>}</em>
<a id='L31302' name='L31302'></a> 31302 
<a id='L31303' name='L31303'></a> 31303 <em class='sharp'>#endif</em> <em class='comment'>/* USE_X_TOOLKIT */</em>
<a id='L31304' name='L31304'></a> 31304 
<a id='L31305' name='L31305'></a> 31305 
<a id='L31306' name='L31306'></a> 31306 <em class='comment'>/* Set up use of X before we make the first connection.  */</em>
<a id='L31307' name='L31307'></a> 31307 
<a id='L31308' name='L31308'></a> 31308 <strong class='reserved'>extern</strong> frame_parm_handler x_frame_parm_handlers[];
<a id='L31309' name='L31309'></a> 31309 
<a id='L31310' name='L31310'></a> 31310 <strong class='reserved'>static</strong> <strong class='reserved'>struct</strong> <a href='../S/2315.html#L2964' title='Defined at 2964 in src/dispextern.h.'>redisplay_interface</a> x_redisplay_interface =
<a id='L31311' name='L31311'></a> 31311   <em class='brace'>{</em>
<a id='L31312' name='L31312'></a> 31312     x_frame_parm_handlers,
<a id='L31313' name='L31313'></a> 31313     <a href='../S/2224.html#L32187' title='Defined at 32187 in src/xdisp.c.'>gui_produce_glyphs</a>,
<a id='L31314' name='L31314'></a> 31314     <a href='../S/2224.html#L32920' title='Defined at 32920 in src/xdisp.c.'>gui_write_glyphs</a>,
<a id='L31315' name='L31315'></a> 31315     <a href='../S/2224.html#L32964' title='Defined at 32964 in src/xdisp.c.'>gui_insert_glyphs</a>,
<a id='L31316' name='L31316'></a> 31316     <a href='../S/2224.html#L33021' title='Defined at 33021 in src/xdisp.c.'>gui_clear_end_of_line</a>,
<a id='L31317' name='L31317'></a> 31317     <a href='../S/2289.html#L11448' title='Defined at 11448 in src/xterm.c.'>x_scroll_run</a>,
<a id='L31318' name='L31318'></a> 31318     <a href='../S/2289.html#L7621' title='Defined at 7621 in src/xterm.c.'>x_after_update_window_line</a>,
<a id='L31319' name='L31319'></a> 31319     <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, <em class='comment'>/* update_window_begin */</em>
<a id='L31320' name='L31320'></a> 31320     <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>, <em class='comment'>/* update_window_end   */</em>
<a id='L31321' name='L31321'></a> 31321     <a href='../S/2289.html#L7445' title='Defined at 7445 in src/xterm.c.'>x_flip_and_flush</a>,
<a id='L31322' name='L31322'></a> 31322     <a href='../S/2224.html#L35960' title='Defined at 35960 in src/xdisp.c.'>gui_clear_window_mouse_face</a>,
<a id='L31323' name='L31323'></a> 31323     <a href='../S/2224.html#L30094' title='Defined at 30094 in src/xdisp.c.'>gui_get_glyph_overhangs</a>,
<a id='L31324' name='L31324'></a> 31324     <a href='../S/2224.html#L33417' title='Defined at 33417 in src/xdisp.c.'>gui_fix_overlapping_area</a>,
<a id='L31325' name='L31325'></a> 31325     <a href='../S/2289.html#L7721' title='Defined at 7721 in src/xterm.c.'>x_draw_fringe_bitmap</a>,
<a id='L31326' name='L31326'></a> 31326 <em class='sharp'>#ifdef</em> USE_CAIRO
<a id='L31327' name='L31327'></a> 31327     <a href='../S/2289.html#L6130' title='Defined at 6130 in src/xterm.c.'>x_cr_define_fringe_bitmap</a>,
<a id='L31328' name='L31328'></a> 31328     <a href='../S/2289.html#L6168' title='Defined at 6168 in src/xterm.c.'>x_cr_destroy_fringe_bitmap</a>,
<a id='L31329' name='L31329'></a> 31329 <em class='sharp'>#else</em>
<a id='L31330' name='L31330'></a> 31330     0, <em class='comment'>/* define_fringe_bitmap */</em>
<a id='L31331' name='L31331'></a> 31331     0, <em class='comment'>/* destroy_fringe_bitmap */</em>
<a id='L31332' name='L31332'></a> 31332 <em class='sharp'>#endif</em>
<a id='L31333' name='L31333'></a> 31333     <a href='../S/2289.html#L8330' title='Defined at 8330 in src/xterm.c.'>x_compute_glyph_string_overhangs</a>,
<a id='L31334' name='L31334'></a> 31334     <a href='../S/2289.html#L10686' title='Defined at 10686 in src/xterm.c.'>x_draw_glyph_string</a>,
<a id='L31335' name='L31335'></a> 31335     x_define_frame_cursor,
<a id='L31336' name='L31336'></a> 31336     x_clear_frame_area,
<a id='L31337' name='L31337'></a> 31337     <a href='../S/2289.html#L7569' title='Defined at 7569 in src/xterm.c.'>x_clear_under_internal_border</a>,
<a id='L31338' name='L31338'></a> 31338     x_draw_window_cursor,
<a id='L31339' name='L31339'></a> 31339     <a href='../S/2289.html#L7319' title='Defined at 7319 in src/xterm.c.'>x_draw_vertical_window_border</a>,
<a id='L31340' name='L31340'></a> 31340     <a href='../S/2289.html#L7340' title='Defined at 7340 in src/xterm.c.'>x_draw_window_divider</a>,
<a id='L31341' name='L31341'></a> 31341     <a href='../S/2289.html#L11041' title='Defined at 11041 in src/xterm.c.'>x_shift_glyphs_for_insert</a>, <em class='comment'>/* Never called; see comment in function.  */</em>
<a id='L31342' name='L31342'></a> 31342     <a href='../S/2289.html#L11181' title='Defined at 11181 in src/xterm.c.'>x_show_hourglass</a>,
<a id='L31343' name='L31343'></a> 31343     <a href='../S/2289.html#L11263' title='Defined at 11263 in src/xterm.c.'>x_hide_hourglass</a>,
<a id='L31344' name='L31344'></a> 31344     <a href='../S/2296.html#L4766' title='Defined at 4766 in src/xfns.c.'>x_default_font_parameter</a>
<a id='L31345' name='L31345'></a> 31345   <em class='brace'>}</em>;
<a id='L31346' name='L31346'></a> 31346 
<a id='L31347' name='L31347'></a> 31347 
<a id='L31348' name='L31348'></a> 31348 <em class='comment'>/* This function is called when the last frame on a display is deleted. */</em>
<a id='L31349' name='L31349'></a> 31349 <strong class='reserved'>void</strong>
<a id='L31350' name='L31350'></a> 31350 x_delete_terminal (<strong class='reserved'>struct</strong> <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a> *<a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>)
<a id='L31351' name='L31351'></a> 31351 <em class='brace'>{</em>
<a id='L31352' name='L31352'></a> 31352   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L31353' name='L31353'></a> 31353   <strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>;
<a id='L31354' name='L31354'></a> 31354   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>;
<a id='L31355' name='L31355'></a> 31355 
<a id='L31356' name='L31356'></a> 31356   dpyinfo = <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;<a href='../S/2231.html#L518' title='Defined at 518 in src/termhooks.h.'>display_info</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a>;
<a id='L31357' name='L31357'></a> 31357 
<a id='L31358' name='L31358'></a> 31358   <em class='comment'>/* Protect against recursive calls.  delete_frame in</em>
<a id='L31359' name='L31359'></a> 31359 <em class='comment'>     delete_terminal calls us back when it deletes our last frame.  */</em>
<a id='L31360' name='L31360'></a> 31360   <strong class='reserved'>if</strong> (!<a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>)
<a id='L31361' name='L31361'></a> 31361     <strong class='reserved'>return</strong>;
<a id='L31362' name='L31362'></a> 31362 
<a id='L31363' name='L31363'></a> 31363   <a href='../S/2089.html#L53' title='Defined at 53 in src/blockinput.h.'>block_input</a> ();
<a id='L31364' name='L31364'></a> 31364 
<a id='L31365' name='L31365'></a> 31365   <em class='comment'>/* Delete all remaining frames on the display that is going away.</em>
<a id='L31366' name='L31366'></a> 31366 <em class='comment'>     Otherwise, font backends assume the display is still up, and</em>
<a id='L31367' name='L31367'></a> 31367 <em class='comment'>     xftfont_end_for_frame crashes.  */</em>
<a id='L31368' name='L31368'></a> 31368   <a href='../S/2183.html#L1405' title='Defined at 1405 in src/frame.h.'>FOR_EACH_FRAME</a> (<a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)
<a id='L31369' name='L31369'></a> 31369     <em class='brace'>{</em>
<a id='L31370' name='L31370'></a> 31370       <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a> = <a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>);
<a id='L31371' name='L31371'></a> 31371 
<a id='L31372' name='L31372'></a> 31372       <strong class='reserved'>if</strong> (<a href='../S/2183.html#L1028' title='Defined at 1028 in src/frame.h.'>FRAME_LIVE_P</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>) &amp;&amp; <a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>-&gt;<a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a> == <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>)
<a id='L31373' name='L31373'></a> 31373         <em class='comment'>/* Pass Qnoelisp rather than Qt.  */</em>
<a id='L31374' name='L31374'></a> 31374         <a href='../S/2247.html#L2043' title='Defined at 2043 in src/frame.c.'>delete_frame</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, Qnoelisp);
<a id='L31375' name='L31375'></a> 31375     <em class='brace'>}</em>
<a id='L31376' name='L31376'></a> 31376 
<a id='L31377' name='L31377'></a> 31377 <em class='sharp'>#ifdef</em> HAVE_X_I18N
<a id='L31378' name='L31378'></a> 31378   <em class='comment'>/* We must close our connection to the XIM server before closing the</em>
<a id='L31379' name='L31379'></a> 31379 <em class='comment'>     X display.  */</em>
<a id='L31380' name='L31380'></a> 31380   xim_close_dpy (dpyinfo);
<a id='L31381' name='L31381'></a> 31381 <em class='sharp'>#endif</em>
<a id='L31382' name='L31382'></a> 31382 
<a id='L31383' name='L31383'></a> 31383   <em class='comment'>/* Destroy all bitmap images created on the display.  */</em>
<a id='L31384' name='L31384'></a> 31384   <a href='../S/2204.html#L1035' title='Defined at 1035 in src/image.c.'>image_destroy_all_bitmaps</a> (dpyinfo);
<a id='L31385' name='L31385'></a> 31385 
<a id='L31386' name='L31386'></a> 31386   <em class='comment'>/* Free the storage allocated to hold bitmap records.  */</em>
<a id='L31387' name='L31387'></a> 31387   <a href='../D/19814.html' title='Multiple defined in 3 places.'>xfree</a> (dpyinfo-&gt;bitmaps);
<a id='L31388' name='L31388'></a> 31388 
<a id='L31389' name='L31389'></a> 31389   <em class='comment'>/* In case someone decides to use `bitmaps' again... */</em>
<a id='L31390' name='L31390'></a> 31390   dpyinfo-&gt;bitmaps = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L31391' name='L31391'></a> 31391   dpyinfo-&gt;bitmaps_last = 0;
<a id='L31392' name='L31392'></a> 31392 
<a id='L31393' name='L31393'></a> 31393   <em class='comment'>/* Normally, the display is available...  */</em>
<a id='L31394' name='L31394'></a> 31394   <strong class='reserved'>if</strong> (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>)
<a id='L31395' name='L31395'></a> 31395     <em class='brace'>{</em>
<a id='L31396' name='L31396'></a> 31396       XSetCloseDownMode (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, DestroyAll);
<a id='L31397' name='L31397'></a> 31397 
<a id='L31398' name='L31398'></a> 31398       <em class='comment'>/* Delete the scratch cursor GC, should it exist.  */</em>
<a id='L31399' name='L31399'></a> 31399       <strong class='reserved'>if</strong> (dpyinfo-&gt;scratch_cursor_gc)
<a id='L31400' name='L31400'></a> 31400         <a href='../S/2321.html#L121' title='Defined at 121 in src/msdos.h.'>XFreeGC</a> (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, dpyinfo-&gt;scratch_cursor_gc);
<a id='L31401' name='L31401'></a> 31401 
<a id='L31402' name='L31402'></a> 31402       <em class='comment'>/* Get rid of any drag-and-drop operation that might be in</em>
<a id='L31403' name='L31403'></a> 31403 <em class='comment'>         progress as well.  */</em>
<a id='L31404' name='L31404'></a> 31404       <strong class='reserved'>if</strong> ((x_dnd_in_progress || x_dnd_waiting_for_finish)
<a id='L31405' name='L31405'></a> 31405           &amp;&amp; dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> == (x_dnd_waiting_for_finish
<a id='L31406' name='L31406'></a> 31406                                   ? x_dnd_finish_display
<a id='L31407' name='L31407'></a> 31407                                   : <a href='../D/2459.html' title='Multiple defined in 3 places.'>FRAME_X_DISPLAY</a> (x_dnd_frame)))
<a id='L31408' name='L31408'></a> 31408         <em class='brace'>{</em>
<a id='L31409' name='L31409'></a> 31409           x_dnd_last_seen_window = None;
<a id='L31410' name='L31410'></a> 31410           x_dnd_last_seen_toplevel = None;
<a id='L31411' name='L31411'></a> 31411           x_dnd_in_progress = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L31412' name='L31412'></a> 31412           x_dnd_waiting_for_finish = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L31413' name='L31413'></a> 31413 
<a id='L31414' name='L31414'></a> 31414           <em class='comment'>/* The display is going away, so there's no point in</em>
<a id='L31415' name='L31415'></a> 31415 <em class='comment'>             de-selecting for input on the DND toplevels.  */</em>
<a id='L31416' name='L31416'></a> 31416           <strong class='reserved'>if</strong> (x_dnd_use_toplevels)
<a id='L31417' name='L31417'></a> 31417             <a href='../S/2289.html#L2918' title='Defined at 2918 in src/xterm.c.'>x_dnd_free_toplevels</a> (<a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L31418' name='L31418'></a> 31418 
<a id='L31419' name='L31419'></a> 31419           x_dnd_return_frame_object = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L31420' name='L31420'></a> 31420           x_dnd_movement_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L31421' name='L31421'></a> 31421           x_dnd_wheel_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L31422' name='L31422'></a> 31422           x_dnd_frame = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L31423' name='L31423'></a> 31423         <em class='brace'>}</em>
<a id='L31424' name='L31424'></a> 31424 
<a id='L31425' name='L31425'></a> 31425       <em class='comment'>/* Whether or not XCloseDisplay destroys the associated resource</em>
<a id='L31426' name='L31426'></a> 31426 <em class='comment'>         database depends on the version of libX11.  To avoid both</em>
<a id='L31427' name='L31427'></a> 31427 <em class='comment'>         crash and memory leak, we dissociate the database from the</em>
<a id='L31428' name='L31428'></a> 31428 <em class='comment'>         display and then destroy dpyinfo-&gt;rdb ourselves.</em>
<a id='L31429' name='L31429'></a> 31429 <em class='comment'></em>
<a id='L31430' name='L31430'></a> 31430 <em class='comment'>         Unfortunately, the above strategy does not work in some</em>
<a id='L31431' name='L31431'></a> 31431 <em class='comment'>         situations due to a bug in newer versions of libX11: because</em>
<a id='L31432' name='L31432'></a> 31432 <em class='comment'>         XrmSetDatabase doesn't clear the flag XlibDisplayDfltRMDB if</em>
<a id='L31433' name='L31433'></a> 31433 <em class='comment'>         dpy-&gt;db is NULL, XCloseDisplay destroys the associated</em>
<a id='L31434' name='L31434'></a> 31434 <em class='comment'>         database whereas it has not been created by XGetDefault</em>
<a id='L31435' name='L31435'></a> 31435 <em class='comment'>         (Bug#21974 in freedesktop.org Bugzilla).  As a workaround, we</em>
<a id='L31436' name='L31436'></a> 31436 <em class='comment'>         don't destroy the database here in order to avoid the crash</em>
<a id='L31437' name='L31437'></a> 31437 <em class='comment'>         in the above situations for now, though that may cause memory</em>
<a id='L31438' name='L31438'></a> 31438 <em class='comment'>         leaks in other situations.  */</em>
<a id='L31439' name='L31439'></a> 31439 <em class='sharp'>#if</em> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>
<a id='L31440' name='L31440'></a> 31440 <em class='sharp'>#ifdef</em> HAVE_XRMSETDATABASE
<a id='L31441' name='L31441'></a> 31441       XrmSetDatabase (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>);
<a id='L31442' name='L31442'></a> 31442 <em class='sharp'>#else</em>
<a id='L31443' name='L31443'></a> 31443       dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>-&gt;db = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L31444' name='L31444'></a> 31444 <em class='sharp'>#endif</em>
<a id='L31445' name='L31445'></a> 31445       <em class='comment'>/* We used to call XrmDestroyDatabase from x_delete_display, but</em>
<a id='L31446' name='L31446'></a> 31446 <em class='comment'>         some older versions of libX11 crash if we call it after</em>
<a id='L31447' name='L31447'></a> 31447 <em class='comment'>         closing all the displays.  */</em>
<a id='L31448' name='L31448'></a> 31448       XrmDestroyDatabase (dpyinfo-&gt;rdb);
<a id='L31449' name='L31449'></a> 31449 <em class='sharp'>#endif</em>
<a id='L31450' name='L31450'></a> 31450 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L31451' name='L31451'></a> 31451       <a href='../S/2362.html#L300' title='Defined at 300 in src/gtkutil.c.'>xg_display_close</a> (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L31452' name='L31452'></a> 31452 <em class='sharp'>#else</em>
<a id='L31453' name='L31453'></a> 31453 <em class='sharp'>#ifdef</em> USE_X_TOOLKIT
<a id='L31454' name='L31454'></a> 31454       XtCloseDisplay (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L31455' name='L31455'></a> 31455 <em class='sharp'>#else</em>
<a id='L31456' name='L31456'></a> 31456       XCloseDisplay (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L31457' name='L31457'></a> 31457 <em class='sharp'>#endif</em>
<a id='L31458' name='L31458'></a> 31458 <em class='sharp'>#endif</em> <em class='comment'>/* ! USE_GTK */</em>
<a id='L31459' name='L31459'></a> 31459       <em class='comment'>/* Do not close the connection here because it's already closed</em>
<a id='L31460' name='L31460'></a> 31460 <em class='comment'>         by X(t)CloseDisplay (Bug#18403).  */</em>
<a id='L31461' name='L31461'></a> 31461       dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a> = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L31462' name='L31462'></a> 31462     <em class='brace'>}</em>
<a id='L31463' name='L31463'></a> 31463 
<a id='L31464' name='L31464'></a> 31464   <em class='comment'>/* ...but if called from x_connection_closed, the display may already</em>
<a id='L31465' name='L31465'></a> 31465 <em class='comment'>     be closed and dpyinfo-&gt;display was set to 0 to indicate that.  Since</em>
<a id='L31466' name='L31466'></a> 31466 <em class='comment'>     X server is most likely gone, explicit close is the only reliable</em>
<a id='L31467' name='L31467'></a> 31467 <em class='comment'>     way to continue and avoid Bug#19147.  */</em>
<a id='L31468' name='L31468'></a> 31468   <strong class='reserved'>else</strong> <strong class='reserved'>if</strong> (dpyinfo-&gt;connection &gt;= 0)
<a id='L31469' name='L31469'></a> 31469     <a href='../S/2286.html#L2607' title='Defined at 2607 in src/sysdep.c.'>emacs_close</a> (dpyinfo-&gt;connection);
<a id='L31470' name='L31470'></a> 31470 
<a id='L31471' name='L31471'></a> 31471   <em class='comment'>/* Free the keyboard and modifier maps here; that is safe to do</em>
<a id='L31472' name='L31472'></a> 31472 <em class='comment'>     without a display, and not doing so leads to a lot of data being</em>
<a id='L31473' name='L31473'></a> 31473 <em class='comment'>     leaked upon IO error.  */</em>
<a id='L31474' name='L31474'></a> 31474 
<a id='L31475' name='L31475'></a> 31475 <em class='sharp'>#ifdef</em> HAVE_XKB
<a id='L31476' name='L31476'></a> 31476   <strong class='reserved'>if</strong> (dpyinfo-&gt;xkb_desc)
<a id='L31477' name='L31477'></a> 31477     XkbFreeKeyboard (dpyinfo-&gt;xkb_desc, XkbAllComponentsMask, True);
<a id='L31478' name='L31478'></a> 31478 <em class='sharp'>#endif</em>
<a id='L31479' name='L31479'></a> 31479 
<a id='L31480' name='L31480'></a> 31480   <strong class='reserved'>if</strong> (dpyinfo-&gt;modmap)
<a id='L31481' name='L31481'></a> 31481     XFreeModifiermap (dpyinfo-&gt;modmap);
<a id='L31482' name='L31482'></a> 31482 
<a id='L31483' name='L31483'></a> 31483   <em class='comment'>/* No more input on this descriptor.  */</em>
<a id='L31484' name='L31484'></a> 31484   <a href='../S/2235.html#L8110' title='Defined at 8110 in src/process.c.'>delete_keyboard_wait_descriptor</a> (dpyinfo-&gt;connection);
<a id='L31485' name='L31485'></a> 31485   <em class='comment'>/* Mark as dead. */</em>
<a id='L31486' name='L31486'></a> 31486   dpyinfo-&gt;connection = -1;
<a id='L31487' name='L31487'></a> 31487 
<a id='L31488' name='L31488'></a> 31488   x_delete_display (dpyinfo);
<a id='L31489' name='L31489'></a> 31489   <a href='../D/18612.html' title='Multiple defined in 2 places.'>unblock_input</a> ();
<a id='L31490' name='L31490'></a> 31490 <em class='brace'>}</em>
<a id='L31491' name='L31491'></a> 31491 
<a id='L31492' name='L31492'></a> 31492 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L31493' name='L31493'></a> 31493 <strong class='reserved'>static</strong> <a href='../D/9263.html' title='Multiple defined in 11 places.'>bool</a>
<a id='L31494' name='L31494'></a> 31494 x_have_any_grab (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo)
<a id='L31495' name='L31495'></a> 31495 <em class='brace'>{</em>
<a id='L31496' name='L31496'></a> 31496   <strong class='reserved'>int</strong> i;
<a id='L31497' name='L31497'></a> 31497 
<a id='L31498' name='L31498'></a> 31498   <strong class='reserved'>if</strong> (!dpyinfo-&gt;supports_xi2)
<a id='L31499' name='L31499'></a> 31499     <strong class='reserved'>return</strong> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L31500' name='L31500'></a> 31500 
<a id='L31501' name='L31501'></a> 31501   <strong class='reserved'>for</strong> (i = 0; i &lt; dpyinfo-&gt;num_devices; ++i)
<a id='L31502' name='L31502'></a> 31502     <em class='brace'>{</em>
<a id='L31503' name='L31503'></a> 31503       <strong class='reserved'>if</strong> (dpyinfo-&gt;devices[i].grab)
<a id='L31504' name='L31504'></a> 31504         <strong class='reserved'>return</strong> <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L31505' name='L31505'></a> 31505     <em class='brace'>}</em>
<a id='L31506' name='L31506'></a> 31506 
<a id='L31507' name='L31507'></a> 31507   <strong class='reserved'>return</strong> <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L31508' name='L31508'></a> 31508 <em class='brace'>}</em>
<a id='L31509' name='L31509'></a> 31509 <em class='sharp'>#endif</em>
<a id='L31510' name='L31510'></a> 31510 
<a id='L31511' name='L31511'></a> 31511 <em class='comment'>/* Create a struct terminal, initialize it with the X11 specific</em>
<a id='L31512' name='L31512'></a> 31512 <em class='comment'>   functions and make DISPLAY-&gt;TERMINAL point to it.  */</em>
<a id='L31513' name='L31513'></a> 31513 
<a id='L31514' name='L31514'></a> 31514 <strong class='reserved'>static</strong> <strong class='reserved'>struct</strong> <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a> *
<a id='L31515' name='L31515'></a> 31515 x_create_terminal (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo)
<a id='L31516' name='L31516'></a> 31516 <em class='brace'>{</em>
<a id='L31517' name='L31517'></a> 31517   <strong class='reserved'>struct</strong> <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a> *<a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>;
<a id='L31518' name='L31518'></a> 31518 
<a id='L31519' name='L31519'></a> 31519   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a> = <a href='../S/2199.html#L273' title='Defined at 273 in src/terminal.c.'>create_terminal</a> (<a href='../S/2231.html#L61' title='Defined at 61 in src/termhooks.h.'>output_x_window</a>, &amp;x_redisplay_interface);
<a id='L31520' name='L31520'></a> 31520 
<a id='L31521' name='L31521'></a> 31521   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;<a href='../S/2231.html#L518' title='Defined at 518 in src/termhooks.h.'>display_info</a>.<a href='../S/4099.html#L43' title='Defined at 43 in test/manual/etags/cp-src/fail.C.'>x</a> = dpyinfo;
<a id='L31522' name='L31522'></a> 31522   dpyinfo-&gt;<a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a> = <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>;
<a id='L31523' name='L31523'></a> 31523 
<a id='L31524' name='L31524'></a> 31524   <em class='comment'>/* kboard is initialized in x_term_init. */</em>
<a id='L31525' name='L31525'></a> 31525 
<a id='L31526' name='L31526'></a> 31526   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;clear_frame_hook = <a href='../S/2289.html#L11136' title='Defined at 11136 in src/xterm.c.'>x_clear_frame</a>;
<a id='L31527' name='L31527'></a> 31527   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;ins_del_lines_hook = <a href='../S/2289.html#L11439' title='Defined at 11439 in src/xterm.c.'>x_ins_del_lines</a>;
<a id='L31528' name='L31528'></a> 31528   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;delete_glyphs_hook = <a href='../S/2289.html#L11056' title='Defined at 11056 in src/xterm.c.'>x_delete_glyphs</a>;
<a id='L31529' name='L31529'></a> 31529   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;ring_bell_hook = <a href='../S/2289.html#L11400' title='Defined at 11400 in src/xterm.c.'>XTring_bell</a>;
<a id='L31530' name='L31530'></a> 31530   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;toggle_invisible_pointer_hook = <a href='../S/2289.html#L11867' title='Defined at 11867 in src/xterm.c.'>XTtoggle_invisible_pointer</a>;
<a id='L31531' name='L31531'></a> 31531   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;update_begin_hook = <a href='../S/2289.html#L7295' title='Defined at 7295 in src/xterm.c.'>x_update_begin</a>;
<a id='L31532' name='L31532'></a> 31532   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;update_end_hook = <a href='../S/2289.html#L7473' title='Defined at 7473 in src/xterm.c.'>x_update_end</a>;
<a id='L31533' name='L31533'></a> 31533   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;read_socket_hook = XTread_socket;
<a id='L31534' name='L31534'></a> 31534   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;frame_up_to_date_hook = <a href='../S/2289.html#L7500' title='Defined at 7500 in src/xterm.c.'>XTframe_up_to_date</a>;
<a id='L31535' name='L31535'></a> 31535 <em class='sharp'>#ifdef</em> HAVE_XDBE
<a id='L31536' name='L31536'></a> 31536   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;buffer_flipping_unblocked_hook = <a href='../S/2289.html#L7551' title='Defined at 7551 in src/xterm.c.'>XTbuffer_flipping_unblocked_hook</a>;
<a id='L31537' name='L31537'></a> 31537 <em class='sharp'>#endif</em>
<a id='L31538' name='L31538'></a> 31538   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;defined_color_hook = <a href='../S/2296.html#L669' title='Defined at 669 in src/xfns.c.'>x_defined_color</a>;
<a id='L31539' name='L31539'></a> 31539   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;query_frame_background_color = <a href='../S/2289.html#L9040' title='Defined at 9040 in src/xterm.c.'>x_query_frame_background_color</a>;
<a id='L31540' name='L31540'></a> 31540   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;query_colors = <a href='../S/2289.html#L8972' title='Defined at 8972 in src/xterm.c.'>x_query_colors</a>;
<a id='L31541' name='L31541'></a> 31541   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;mouse_position_hook = XTmouse_position;
<a id='L31542' name='L31542'></a> 31542   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;get_focus_frame = x_get_focus_frame;
<a id='L31543' name='L31543'></a> 31543   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;focus_frame_hook = x_focus_frame;
<a id='L31544' name='L31544'></a> 31544   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;frame_rehighlight_hook = XTframe_rehighlight;
<a id='L31545' name='L31545'></a> 31545   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;frame_raise_lower_hook = XTframe_raise_lower;
<a id='L31546' name='L31546'></a> 31546   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;frame_visible_invisible_hook = x_make_frame_visible_invisible;
<a id='L31547' name='L31547'></a> 31547   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;fullscreen_hook = XTfullscreen_hook;
<a id='L31548' name='L31548'></a> 31548   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;iconify_frame_hook = x_iconify_frame;
<a id='L31549' name='L31549'></a> 31549   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;set_window_size_hook = x_set_window_size;
<a id='L31550' name='L31550'></a> 31550   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;set_frame_offset_hook = x_set_offset;
<a id='L31551' name='L31551'></a> 31551   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;set_frame_alpha_hook = <a href='../S/2289.html#L6811' title='Defined at 6811 in src/xterm.c.'>x_set_frame_alpha</a>;
<a id='L31552' name='L31552'></a> 31552   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;set_new_font_hook = x_new_font;
<a id='L31553' name='L31553'></a> 31553   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;set_bitmap_icon_hook = x_bitmap_icon;
<a id='L31554' name='L31554'></a> 31554   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;implicit_set_name_hook = <a href='../S/2296.html#L2334' title='Defined at 2334 in src/xfns.c.'>x_implicitly_set_name</a>;
<a id='L31555' name='L31555'></a> 31555   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;menu_show_hook = <a href='../D/19618.html' title='Multiple defined in 2 places.'>x_menu_show</a>;
<a id='L31556' name='L31556'></a> 31556 <em class='sharp'>#ifdef</em> <a href='../S/2267.html#L3719' title='Defined at 3719 in src/lisp.h.'>HAVE_EXT_MENU_BAR</a>
<a id='L31557' name='L31557'></a> 31557   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;activate_menubar_hook = <a href='../S/2106.html#L647' title='Defined at 647 in src/xmenu.c.'>x_activate_menubar</a>;
<a id='L31558' name='L31558'></a> 31558 <em class='sharp'>#endif</em>
<a id='L31559' name='L31559'></a> 31559 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> (USE_X_TOOLKIT) || <strong class='reserved'>defined</strong> (USE_GTK)
<a id='L31560' name='L31560'></a> 31560   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;popup_dialog_hook = <a href='../S/2106.html#L2424' title='Defined at 2424 in src/xmenu.c.'>xw_popup_dialog</a>;
<a id='L31561' name='L31561'></a> 31561 <em class='sharp'>#endif</em>
<a id='L31562' name='L31562'></a> 31562   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;change_tab_bar_height_hook = <a href='../S/2296.html#L1784' title='Defined at 1784 in src/xfns.c.'>x_change_tab_bar_height</a>;
<a id='L31563' name='L31563'></a> 31563 <em class='sharp'>#ifndef</em> <a href='../S/2267.html#L3724' title='Defined at 3724 in src/lisp.h.'>HAVE_EXT_TOOL_BAR</a>
<a id='L31564' name='L31564'></a> 31564   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;change_tool_bar_height_hook = <a href='../D/19430.html' title='Multiple defined in 2 places.'>x_change_tool_bar_height</a>;
<a id='L31565' name='L31565'></a> 31565 <em class='sharp'>#endif</em>
<a id='L31566' name='L31566'></a> 31566   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;set_vertical_scroll_bar_hook = XTset_vertical_scroll_bar;
<a id='L31567' name='L31567'></a> 31567   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;set_horizontal_scroll_bar_hook = XTset_horizontal_scroll_bar;
<a id='L31568' name='L31568'></a> 31568   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;set_scroll_bar_default_width_hook = <a href='../S/2296.html#L2362' title='Defined at 2362 in src/xfns.c.'>x_set_scroll_bar_default_width</a>;
<a id='L31569' name='L31569'></a> 31569   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;set_scroll_bar_default_height_hook = <a href='../S/2296.html#L2383' title='Defined at 2383 in src/xfns.c.'>x_set_scroll_bar_default_height</a>;
<a id='L31570' name='L31570'></a> 31570   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;condemn_scroll_bars_hook = XTcondemn_scroll_bars;
<a id='L31571' name='L31571'></a> 31571   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;redeem_scroll_bar_hook = XTredeem_scroll_bar;
<a id='L31572' name='L31572'></a> 31572   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;judge_scroll_bars_hook = XTjudge_scroll_bars;
<a id='L31573' name='L31573'></a> 31573   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;get_string_resource_hook = <a href='../S/2138.html#L500' title='Defined at 500 in src/xrdb.c.'>x_get_string_resource</a>;
<a id='L31574' name='L31574'></a> 31574   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;free_pixmap = x_free_pixmap;
<a id='L31575' name='L31575'></a> 31575   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;delete_frame_hook = x_destroy_window;
<a id='L31576' name='L31576'></a> 31576   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;delete_terminal_hook = x_delete_terminal;
<a id='L31577' name='L31577'></a> 31577   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;toolkit_position_hook = <a href='../S/2289.html#L5161' title='Defined at 5161 in src/xterm.c.'>x_toolkit_position</a>;
<a id='L31578' name='L31578'></a> 31578 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L31579' name='L31579'></a> 31579   <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>-&gt;any_grab_hook = x_have_any_grab;
<a id='L31580' name='L31580'></a> 31580 <em class='sharp'>#endif</em>
<a id='L31581' name='L31581'></a> 31581   <em class='comment'>/* Other hooks are NULL by default.  */</em>
<a id='L31582' name='L31582'></a> 31582 
<a id='L31583' name='L31583'></a> 31583   <strong class='reserved'>return</strong> <a href='../S/2231.html#L455' title='Defined at 455 in src/termhooks.h.'>terminal</a>;
<a id='L31584' name='L31584'></a> 31584 <em class='brace'>}</em>
<a id='L31585' name='L31585'></a> 31585 
<a id='L31586' name='L31586'></a> 31586 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L31587' name='L31587'></a> 31587 x_initialize (<strong class='reserved'>void</strong>)
<a id='L31588' name='L31588'></a> 31588 <em class='brace'>{</em>
<a id='L31589' name='L31589'></a> 31589   baud_rate = 19200;
<a id='L31590' name='L31590'></a> 31590 
<a id='L31591' name='L31591'></a> 31591   x_noop_count = 0;
<a id='L31592' name='L31592'></a> 31592   any_help_event_p = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L31593' name='L31593'></a> 31593   ignore_next_mouse_click_timeout = 0;
<a id='L31594' name='L31594'></a> 31594   mouse_click_timeout_display = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L31595' name='L31595'></a> 31595 
<a id='L31596' name='L31596'></a> 31596 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L31597' name='L31597'></a> 31597   current_count = -1;
<a id='L31598' name='L31598'></a> 31598 <em class='sharp'>#endif</em>
<a id='L31599' name='L31599'></a> 31599 
<a id='L31600' name='L31600'></a> 31600   <em class='comment'>/* Try to use interrupt input; if we can't, then start polling.  */</em>
<a id='L31601' name='L31601'></a> 31601   Fset_input_interrupt_mode (Qt);
<a id='L31602' name='L31602'></a> 31602 
<a id='L31603' name='L31603'></a> 31603 <em class='sharp'>#if</em> THREADS_ENABLED
<a id='L31604' name='L31604'></a> 31604   <em class='comment'>/* This must be called before any other Xlib routines.  */</em>
<a id='L31605' name='L31605'></a> 31605   <strong class='reserved'>if</strong> (XInitThreads () == 0)
<a id='L31606' name='L31606'></a> 31606     <a href='../D/11680.html' title='Multiple defined in 4 places.'>fputs</a> ("Warning: An error occurred initializing X11 thread support!\n",
<a id='L31607' name='L31607'></a> 31607            <a href='../S/20.html#L50' title='Defined at 50 in nt/cmdproxy.c.'>stderr</a>);
<a id='L31608' name='L31608'></a> 31608 <em class='sharp'>#endif</em>
<a id='L31609' name='L31609'></a> 31609 
<a id='L31610' name='L31610'></a> 31610 <em class='sharp'>#ifdef</em> USE_X_TOOLKIT
<a id='L31611' name='L31611'></a> 31611   XtToolkitInitialize ();
<a id='L31612' name='L31612'></a> 31612 
<a id='L31613' name='L31613'></a> 31613   Xt_app_con = XtCreateApplicationContext ();
<a id='L31614' name='L31614'></a> 31614 
<a id='L31615' name='L31615'></a> 31615   <em class='comment'>/* Register a converter from strings to pixels, which uses</em>
<a id='L31616' name='L31616'></a> 31616 <em class='comment'>     Emacs' color allocation infrastructure.  */</em>
<a id='L31617' name='L31617'></a> 31617   XtAppSetTypeConverter (Xt_app_con,
<a id='L31618' name='L31618'></a> 31618                          XtRString, XtRPixel, <a href='../S/2289.html#L8822' title='Defined at 8822 in src/xterm.c.'>cvt_string_to_pixel</a>,
<a id='L31619' name='L31619'></a> 31619                          cvt_string_to_pixel_args,
<a id='L31620' name='L31620'></a> 31620                          XtNumber (cvt_string_to_pixel_args),
<a id='L31621' name='L31621'></a> 31621                          XtCacheByDisplay, <a href='../S/2289.html#L8908' title='Defined at 8908 in src/xterm.c.'>cvt_pixel_dtor</a>);
<a id='L31622' name='L31622'></a> 31622 
<a id='L31623' name='L31623'></a> 31623   XtAppSetFallbackResources (Xt_app_con, Xt_default_resources);
<a id='L31624' name='L31624'></a> 31624 <em class='sharp'>#endif</em>
<a id='L31625' name='L31625'></a> 31625 
<a id='L31626' name='L31626'></a> 31626 <em class='sharp'>#ifdef</em> USE_TOOLKIT_SCROLL_BARS
<a id='L31627' name='L31627'></a> 31627 <em class='sharp'>#ifndef</em> USE_GTK
<a id='L31628' name='L31628'></a> 31628   xaw3d_arrow_scroll = False;
<a id='L31629' name='L31629'></a> 31629   xaw3d_pick_top = True;
<a id='L31630' name='L31630'></a> 31630 <em class='sharp'>#endif</em>
<a id='L31631' name='L31631'></a> 31631 <em class='sharp'>#endif</em>
<a id='L31632' name='L31632'></a> 31632 
<a id='L31633' name='L31633'></a> 31633 <em class='sharp'>#ifdef</em> USE_CAIRO
<a id='L31634' name='L31634'></a> 31634   <a href='../S/2354.html#L1821' title='Defined at 1821 in src/fringe.c.'>gui_init_fringe</a> (&amp;x_redisplay_interface);
<a id='L31635' name='L31635'></a> 31635 <em class='sharp'>#endif</em>
<a id='L31636' name='L31636'></a> 31636 
<a id='L31637' name='L31637'></a> 31637   <em class='comment'>/* Note that there is no real way portable across R3/R4 to get the</em>
<a id='L31638' name='L31638'></a> 31638 <em class='comment'>     original error handler.  */</em>
<a id='L31639' name='L31639'></a> 31639   XSetErrorHandler (x_error_handler);
<a id='L31640' name='L31640'></a> 31640   XSetIOErrorHandler (x_io_error_quitter);
<a id='L31641' name='L31641'></a> 31641 <em class='brace'>}</em>
<a id='L31642' name='L31642'></a> 31642 
<a id='L31643' name='L31643'></a> 31643 <em class='sharp'>#ifdef</em> HAVE_X_I18N
<a id='L31644' name='L31644'></a> 31644 
<a id='L31645' name='L31645'></a> 31645 <em class='comment'>/* Notice that a change has occured on F that requires its input</em>
<a id='L31646' name='L31646'></a> 31646 <em class='comment'>   method state to be reset.  */</em>
<a id='L31647' name='L31647'></a> 31647 
<a id='L31648' name='L31648'></a> 31648 <strong class='reserved'>static</strong> <strong class='reserved'>void</strong>
<a id='L31649' name='L31649'></a> 31649 x_reset_conversion (<strong class='reserved'>struct</strong> <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a> *<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>)
<a id='L31650' name='L31650'></a> 31650 <em class='brace'>{</em>
<a id='L31651' name='L31651'></a> 31651   <strong class='reserved'>char</strong> *string;
<a id='L31652' name='L31652'></a> 31652 
<a id='L31653' name='L31653'></a> 31653   <strong class='reserved'>if</strong> (<a href='../S/2212.html#L1470' title='Defined at 1470 in src/xterm.h.'>FRAME_XIC</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>))
<a id='L31654' name='L31654'></a> 31654     <em class='brace'>{</em>
<a id='L31655' name='L31655'></a> 31655       string = XmbResetIC (<a href='../S/2212.html#L1470' title='Defined at 1470 in src/xterm.h.'>FRAME_XIC</a> (<a href='../D/11241.html' title='Multiple defined in 12 places.'>f</a>));
<a id='L31656' name='L31656'></a> 31656 
<a id='L31657' name='L31657'></a> 31657       <em class='comment'>/* string is actually any string that was being composed at the</em>
<a id='L31658' name='L31658'></a> 31658 <em class='comment'>         time of the reset.  */</em>
<a id='L31659' name='L31659'></a> 31659 
<a id='L31660' name='L31660'></a> 31660       <strong class='reserved'>if</strong> (string)
<a id='L31661' name='L31661'></a> 31661         XFree (string);
<a id='L31662' name='L31662'></a> 31662     <em class='brace'>}</em>
<a id='L31663' name='L31663'></a> 31663 <em class='brace'>}</em>
<a id='L31664' name='L31664'></a> 31664 
<a id='L31665' name='L31665'></a> 31665 <em class='comment'>/* Interface used to control input method ``text conversion''.  */</em>
<a id='L31666' name='L31666'></a> 31666 
<a id='L31667' name='L31667'></a> 31667 <strong class='reserved'>static</strong> <strong class='reserved'>struct</strong> <a href='../S/2319.html#L31' title='Defined at 31 in src/textconv.h.'>textconv_interface</a> text_conversion_interface =
<a id='L31668' name='L31668'></a> 31668   <em class='brace'>{</em>
<a id='L31669' name='L31669'></a> 31669     x_reset_conversion,
<a id='L31670' name='L31670'></a> 31670   <em class='brace'>}</em>;
<a id='L31671' name='L31671'></a> 31671 
<a id='L31672' name='L31672'></a> 31672 <em class='sharp'>#endif</em>
<a id='L31673' name='L31673'></a> 31673 
<a id='L31674' name='L31674'></a> 31674 <strong class='reserved'>void</strong>
<a id='L31675' name='L31675'></a> 31675 init_xterm (<strong class='reserved'>void</strong>)
<a id='L31676' name='L31676'></a> 31676 <em class='brace'>{</em>
<a id='L31677' name='L31677'></a> 31677 <em class='sharp'>#ifndef</em> HAVE_XINPUT2
<a id='L31678' name='L31678'></a> 31678   <em class='comment'>/* Emacs can handle only core input events when built without XI2</em>
<a id='L31679' name='L31679'></a> 31679 <em class='comment'>     support, so make sure Gtk doesn't use Xinput or Xinput2</em>
<a id='L31680' name='L31680'></a> 31680 <em class='comment'>     extensions.  */</em>
<a id='L31681' name='L31681'></a> 31681 <em class='sharp'>#ifndef</em> HAVE_GTK3
<a id='L31682' name='L31682'></a> 31682   <a href='../S/2350.html#L997' title='Defined at 997 in src/alloc.c.'>xputenv</a> ("GDK_CORE_DEVICE_EVENTS=1");
<a id='L31683' name='L31683'></a> 31683 <em class='sharp'>#else</em>
<a id='L31684' name='L31684'></a> 31684   gdk_disable_multidevice ();
<a id='L31685' name='L31685'></a> 31685 <em class='sharp'>#endif</em>
<a id='L31686' name='L31686'></a> 31686 <em class='sharp'>#endif</em>
<a id='L31687' name='L31687'></a> 31687 
<a id='L31688' name='L31688'></a> 31688 <em class='sharp'>#ifdef</em> HAVE_X_I18N
<a id='L31689' name='L31689'></a> 31689   <a href='../S/2097.html#L2016' title='Defined at 2016 in src/textconv.c.'>register_textconv_interface</a> (&amp;text_conversion_interface);
<a id='L31690' name='L31690'></a> 31690 <em class='sharp'>#endif</em>
<a id='L31691' name='L31691'></a> 31691 <em class='brace'>}</em>
<a id='L31692' name='L31692'></a> 31692 
<a id='L31693' name='L31693'></a> 31693 <strong class='reserved'>void</strong>
<a id='L31694' name='L31694'></a> 31694 mark_xterm (<strong class='reserved'>void</strong>)
<a id='L31695' name='L31695'></a> 31695 <em class='brace'>{</em>
<a id='L31696' name='L31696'></a> 31696   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> val;
<a id='L31697' name='L31697'></a> 31697 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XINPUT2 || <strong class='reserved'>defined</strong> USE_TOOLKIT_SCROLL_BARS \
<a id='L31698' name='L31698'></a> 31698   || <strong class='reserved'>defined</strong> HAVE_XRANDR || <strong class='reserved'>defined</strong> USE_GTK || <strong class='reserved'>defined</strong> HAVE_X_I18N
<a id='L31699' name='L31699'></a> 31699   <strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo;
<a id='L31700' name='L31700'></a> 31700 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XINPUT2 || <strong class='reserved'>defined</strong> USE_TOOLKIT_SCROLL_BARS
<a id='L31701' name='L31701'></a> 31701   <strong class='reserved'>int</strong> i;
<a id='L31702' name='L31702'></a> 31702 <em class='sharp'>#endif</em>
<a id='L31703' name='L31703'></a> 31703 <em class='sharp'>#endif</em>
<a id='L31704' name='L31704'></a> 31704 
<a id='L31705' name='L31705'></a> 31705   <strong class='reserved'>if</strong> (x_dnd_return_frame_object)
<a id='L31706' name='L31706'></a> 31706     <em class='brace'>{</em>
<a id='L31707' name='L31707'></a> 31707       <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (val, x_dnd_return_frame_object);
<a id='L31708' name='L31708'></a> 31708       <a href='../S/2350.html#L7376' title='Defined at 7376 in src/alloc.c.'>mark_object</a> (val);
<a id='L31709' name='L31709'></a> 31709     <em class='brace'>}</em>
<a id='L31710' name='L31710'></a> 31710 
<a id='L31711' name='L31711'></a> 31711   <strong class='reserved'>if</strong> (x_dnd_movement_frame)
<a id='L31712' name='L31712'></a> 31712     <em class='brace'>{</em>
<a id='L31713' name='L31713'></a> 31713       <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (val, x_dnd_movement_frame);
<a id='L31714' name='L31714'></a> 31714       <a href='../S/2350.html#L7376' title='Defined at 7376 in src/alloc.c.'>mark_object</a> (val);
<a id='L31715' name='L31715'></a> 31715     <em class='brace'>}</em>
<a id='L31716' name='L31716'></a> 31716 
<a id='L31717' name='L31717'></a> 31717   <strong class='reserved'>if</strong> (x_dnd_wheel_frame)
<a id='L31718' name='L31718'></a> 31718     <em class='brace'>{</em>
<a id='L31719' name='L31719'></a> 31719       <a href='../S/2183.html#L911' title='Defined at 911 in src/frame.h.'>XSETFRAME</a> (val, x_dnd_wheel_frame);
<a id='L31720' name='L31720'></a> 31720       <a href='../S/2350.html#L7376' title='Defined at 7376 in src/alloc.c.'>mark_object</a> (val);
<a id='L31721' name='L31721'></a> 31721     <em class='brace'>}</em>
<a id='L31722' name='L31722'></a> 31722 
<a id='L31723' name='L31723'></a> 31723 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XINPUT2 || <strong class='reserved'>defined</strong> USE_TOOLKIT_SCROLL_BARS \
<a id='L31724' name='L31724'></a> 31724   || <strong class='reserved'>defined</strong> HAVE_XRANDR || <strong class='reserved'>defined</strong> USE_GTK || <strong class='reserved'>defined</strong> HAVE_X_I18N
<a id='L31725' name='L31725'></a> 31725   <strong class='reserved'>for</strong> (dpyinfo = x_display_list; dpyinfo; dpyinfo = dpyinfo-&gt;next)
<a id='L31726' name='L31726'></a> 31726     <em class='brace'>{</em>
<a id='L31727' name='L31727'></a> 31727 <em class='sharp'>#ifdef</em> HAVE_XINPUT2
<a id='L31728' name='L31728'></a> 31728       <strong class='reserved'>for</strong> (i = 0; i &lt; dpyinfo-&gt;num_devices; ++i)
<a id='L31729' name='L31729'></a> 31729         <a href='../S/2350.html#L7376' title='Defined at 7376 in src/alloc.c.'>mark_object</a> (dpyinfo-&gt;devices[i].<a href='../D/14928.html' title='Multiple defined in 4 places.'>name</a>);
<a id='L31730' name='L31730'></a> 31730 <em class='sharp'>#endif</em>
<a id='L31731' name='L31731'></a> 31731 <em class='sharp'>#ifdef</em> USE_TOOLKIT_SCROLL_BARS
<a id='L31732' name='L31732'></a> 31732       <strong class='reserved'>for</strong> (i = 0; i &lt; dpyinfo-&gt;n_protected_windows; ++i)
<a id='L31733' name='L31733'></a> 31733         <a href='../S/2350.html#L7376' title='Defined at 7376 in src/alloc.c.'>mark_object</a> (dpyinfo-&gt;protected_windows[i]);
<a id='L31734' name='L31734'></a> 31734 <em class='sharp'>#endif</em>
<a id='L31735' name='L31735'></a> 31735 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_XRANDR || <strong class='reserved'>defined</strong> USE_GTK
<a id='L31736' name='L31736'></a> 31736       <a href='../S/2350.html#L7376' title='Defined at 7376 in src/alloc.c.'>mark_object</a> (dpyinfo-&gt;last_monitor_attributes_list);
<a id='L31737' name='L31737'></a> 31737 <em class='sharp'>#endif</em>
<a id='L31738' name='L31738'></a> 31738 <em class='sharp'>#if</em> <strong class='reserved'>defined</strong> HAVE_X_I18N
<a id='L31739' name='L31739'></a> 31739       <a href='../S/2350.html#L7376' title='Defined at 7376 in src/alloc.c.'>mark_object</a> (dpyinfo-&gt;xim_coding);
<a id='L31740' name='L31740'></a> 31740 <em class='sharp'>#endif</em>
<a id='L31741' name='L31741'></a> 31741     <em class='brace'>}</em>
<a id='L31742' name='L31742'></a> 31742 <em class='sharp'>#endif</em>
<a id='L31743' name='L31743'></a> 31743 <em class='brace'>}</em>
<a id='L31744' name='L31744'></a> 31744 
<a id='L31745' name='L31745'></a> 31745 <em class='comment'>/* Error handling functions for Lisp functions that expose X protocol</em>
<a id='L31746' name='L31746'></a> 31746 <em class='comment'>   requests.  They are mostly like `x_catch_errors' and friends, but</em>
<a id='L31747' name='L31747'></a> 31747 <em class='comment'>   respect `x-fast-protocol-requests'.  */</em>
<a id='L31748' name='L31748'></a> 31748 
<a id='L31749' name='L31749'></a> 31749 <strong class='reserved'>void</strong>
<a id='L31750' name='L31750'></a> 31750 x_catch_errors_for_lisp (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo)
<a id='L31751' name='L31751'></a> 31751 <em class='brace'>{</em>
<a id='L31752' name='L31752'></a> 31752   <strong class='reserved'>if</strong> (!x_fast_protocol_requests)
<a id='L31753' name='L31753'></a> 31753     x_catch_errors (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>);
<a id='L31754' name='L31754'></a> 31754   <strong class='reserved'>else</strong>
<a id='L31755' name='L31755'></a> 31755     x_ignore_errors_for_next_request (dpyinfo, 0);
<a id='L31756' name='L31756'></a> 31756 <em class='brace'>}</em>
<a id='L31757' name='L31757'></a> 31757 
<a id='L31758' name='L31758'></a> 31758 <strong class='reserved'>void</strong>
<a id='L31759' name='L31759'></a> 31759 x_check_errors_for_lisp (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo,
<a id='L31760' name='L31760'></a> 31760                          <strong class='reserved'>const</strong> <strong class='reserved'>char</strong> *format)
<a id='L31761' name='L31761'></a> 31761 <em class='brace'>{</em>
<a id='L31762' name='L31762'></a> 31762   <strong class='reserved'>if</strong> (!x_fast_protocol_requests)
<a id='L31763' name='L31763'></a> 31763     x_check_errors (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>, format);
<a id='L31764' name='L31764'></a> 31764 <em class='brace'>}</em>
<a id='L31765' name='L31765'></a> 31765 
<a id='L31766' name='L31766'></a> 31766 <strong class='reserved'>void</strong>
<a id='L31767' name='L31767'></a> 31767 x_uncatch_errors_for_lisp (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo)
<a id='L31768' name='L31768'></a> 31768 <em class='brace'>{</em>
<a id='L31769' name='L31769'></a> 31769   <strong class='reserved'>if</strong> (!x_fast_protocol_requests)
<a id='L31770' name='L31770'></a> 31770     x_uncatch_errors ();
<a id='L31771' name='L31771'></a> 31771   <strong class='reserved'>else</strong>
<a id='L31772' name='L31772'></a> 31772     x_stop_ignoring_errors (dpyinfo);
<a id='L31773' name='L31773'></a> 31773 <em class='brace'>}</em>
<a id='L31774' name='L31774'></a> 31774 
<a id='L31775' name='L31775'></a> 31775 <em class='comment'>/* Preserve the selections in LOST in another frame on DPYINFO.  LOST</em>
<a id='L31776' name='L31776'></a> 31776 <em class='comment'>   is a list of local selections that were lost, due to their frame</em>
<a id='L31777' name='L31777'></a> 31777 <em class='comment'>   being deleted.  */</em>
<a id='L31778' name='L31778'></a> 31778 
<a id='L31779' name='L31779'></a> 31779 <strong class='reserved'>void</strong>
<a id='L31780' name='L31780'></a> 31780 x_preserve_selections (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo, <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> lost,
<a id='L31781' name='L31781'></a> 31781                        <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> current_owner)
<a id='L31782' name='L31782'></a> 31782 <em class='brace'>{</em>
<a id='L31783' name='L31783'></a> 31783   <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> <a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, new_owner;
<a id='L31784' name='L31784'></a> 31784   <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a> timestamp;
<a id='L31785' name='L31785'></a> 31785   <a href='../D/6982.html' title='Multiple defined in 5 places.'>Window</a> *owners;
<a id='L31786' name='L31786'></a> 31786   Atom *names;
<a id='L31787' name='L31787'></a> 31787   ptrdiff_t nowners, counter;
<a id='L31788' name='L31788'></a> 31788   <strong class='reserved'>struct</strong> <a href='../D/16706.html' title='Multiple defined in 2 places.'>selection_input_event</a> <a href='../S/4097.html#L14' title='Defined at 14 in test/manual/etags/cp-src/conway.hpp.'>clear</a>;
<a id='L31789' name='L31789'></a> 31789 <em class='sharp'>#ifdef</em> USE_XCB
<a id='L31790' name='L31790'></a> 31790   xcb_get_selection_owner_cookie_t *cookies;
<a id='L31791' name='L31791'></a> 31791   xcb_generic_error_t *<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>;
<a id='L31792' name='L31792'></a> 31792   xcb_get_selection_owner_reply_t *reply;
<a id='L31793' name='L31793'></a> 31793 <em class='sharp'>#endif</em>
<a id='L31794' name='L31794'></a> 31794 
<a id='L31795' name='L31795'></a> 31795   new_owner = Qnil;
<a id='L31796' name='L31796'></a> 31796 
<a id='L31797' name='L31797'></a> 31797   <a href='../S/2183.html#L1405' title='Defined at 1405 in src/frame.h.'>FOR_EACH_FRAME</a> (<a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>, <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)
<a id='L31798' name='L31798'></a> 31798     <em class='brace'>{</em>
<a id='L31799' name='L31799'></a> 31799       <strong class='reserved'>if</strong> (<a href='../S/2183.html#L919' title='Defined at 919 in src/frame.h.'>FRAME_X_P</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>))
<a id='L31800' name='L31800'></a> 31800           &amp;&amp; !<a href='../D/1840.html' title='Multiple defined in 3 places.'>EQ</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>, current_owner)
<a id='L31801' name='L31801'></a> 31801           &amp;&amp; <a href='../D/2292.html' title='Multiple defined in 7 places.'>FRAME_DISPLAY_INFO</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (<a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>)) == dpyinfo)
<a id='L31802' name='L31802'></a> 31802         <em class='brace'>{</em>
<a id='L31803' name='L31803'></a> 31803           new_owner = <a href='../D/11683.html' title='Multiple defined in 3 places.'>frame</a>;
<a id='L31804' name='L31804'></a> 31804           <strong class='reserved'>break</strong>;
<a id='L31805' name='L31805'></a> 31805         <em class='brace'>}</em>
<a id='L31806' name='L31806'></a> 31806     <em class='brace'>}</em>
<a id='L31807' name='L31807'></a> 31807 
<a id='L31808' name='L31808'></a> 31808   <a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a> = lost;
<a id='L31809' name='L31809'></a> 31809   nowners = 0;
<a id='L31810' name='L31810'></a> 31810 
<a id='L31811' name='L31811'></a> 31811   <a href='../S/2267.html#L5578' title='Defined at 5578 in src/lisp.h.'>FOR_EACH_TAIL_SAFE</a> (<a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>)
<a id='L31812' name='L31812'></a> 31812     <em class='brace'>{</em>
<a id='L31813' name='L31813'></a> 31813       <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> tem = <a href='../D/7021.html' title='Multiple defined in 2 places.'>XCAR</a> (<a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>);
<a id='L31814' name='L31814'></a> 31814       ++nowners;
<a id='L31815' name='L31815'></a> 31815 
<a id='L31816' name='L31816'></a> 31816       <em class='comment'>/* The selection is really lost (since we cannot find a new</em>
<a id='L31817' name='L31817'></a> 31817 <em class='comment'>         owner), so run the appropriate hooks.  */</em>
<a id='L31818' name='L31818'></a> 31818       <strong class='reserved'>if</strong> (<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (new_owner))
<a id='L31819' name='L31819'></a> 31819         <a href='../D/652.html' title='Multiple defined in 2 places.'>CALLN</a> (Frun_hook_with_args, Qx_lost_selection_functions,
<a id='L31820' name='L31820'></a> 31820                <a href='../D/7021.html' title='Multiple defined in 2 places.'>XCAR</a> (tem));
<a id='L31821' name='L31821'></a> 31821       <strong class='reserved'>else</strong>
<a id='L31822' name='L31822'></a> 31822         <em class='brace'>{</em>
<a id='L31823' name='L31823'></a> 31823           <a href='../D/1234.html' title='Multiple defined in 2 places.'>CONS_TO_INTEGER</a> (<a href='../D/7021.html' title='Multiple defined in 2 places.'>XCAR</a> (<a href='../D/7022.html' title='Multiple defined in 2 places.'>XCDR</a> (<a href='../D/7022.html' title='Multiple defined in 2 places.'>XCDR</a> (tem))), <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a>, timestamp);
<a id='L31824' name='L31824'></a> 31824 
<a id='L31825' name='L31825'></a> 31825           <em class='comment'>/* This shouldn't be able to signal any errors, despite the</em>
<a id='L31826' name='L31826'></a> 31826 <em class='comment'>             call to `x_check_errors' inside.  */</em>
<a id='L31827' name='L31827'></a> 31827           <a href='../S/2281.html#L274' title='Defined at 274 in src/xselect.c.'>x_own_selection</a> (<a href='../D/7021.html' title='Multiple defined in 2 places.'>XCAR</a> (tem), <a href='../D/7021.html' title='Multiple defined in 2 places.'>XCAR</a> (<a href='../D/7022.html' title='Multiple defined in 2 places.'>XCDR</a> (tem)),
<a id='L31828' name='L31828'></a> 31828                            new_owner, <a href='../D/7021.html' title='Multiple defined in 2 places.'>XCAR</a> (<a href='../D/7022.html' title='Multiple defined in 2 places.'>XCDR</a> (<a href='../D/7022.html' title='Multiple defined in 2 places.'>XCDR</a> (<a href='../D/7022.html' title='Multiple defined in 2 places.'>XCDR</a> (<a href='../D/7022.html' title='Multiple defined in 2 places.'>XCDR</a> (tem))))),
<a id='L31829' name='L31829'></a> 31829                            timestamp);
<a id='L31830' name='L31830'></a> 31830         <em class='brace'>}</em>
<a id='L31831' name='L31831'></a> 31831     <em class='brace'>}</em>
<a id='L31832' name='L31832'></a> 31832 
<a id='L31833' name='L31833'></a> 31833   <strong class='reserved'>if</strong> (!<a href='../D/4349.html' title='Multiple defined in 2 places.'>NILP</a> (new_owner))
<a id='L31834' name='L31834'></a> 31834     <em class='brace'>{</em>
<a id='L31835' name='L31835'></a> 31835       owners = <a href='../D/8439.html' title='Multiple defined in 8 places.'>alloca</a> (<strong class='reserved'>sizeof</strong> *owners * nowners);
<a id='L31836' name='L31836'></a> 31836       names = <a href='../D/8439.html' title='Multiple defined in 8 places.'>alloca</a> (<strong class='reserved'>sizeof</strong> *names * nowners);
<a id='L31837' name='L31837'></a> 31837 <em class='sharp'>#ifdef</em> USE_XCB
<a id='L31838' name='L31838'></a> 31838       cookies = <a href='../D/8439.html' title='Multiple defined in 8 places.'>alloca</a> (<strong class='reserved'>sizeof</strong> *cookies * nowners);
<a id='L31839' name='L31839'></a> 31839 <em class='sharp'>#endif</em>
<a id='L31840' name='L31840'></a> 31840 
<a id='L31841' name='L31841'></a> 31841       <a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a> = lost;
<a id='L31842' name='L31842'></a> 31842       nowners = 0;
<a id='L31843' name='L31843'></a> 31843       counter = 0;
<a id='L31844' name='L31844'></a> 31844 
<a id='L31845' name='L31845'></a> 31845       <a href='../S/2267.html#L5578' title='Defined at 5578 in src/lisp.h.'>FOR_EACH_TAIL_SAFE</a> (<a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>)
<a id='L31846' name='L31846'></a> 31846         <em class='brace'>{</em>
<a id='L31847' name='L31847'></a> 31847           <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> tem = <a href='../D/7021.html' title='Multiple defined in 2 places.'>XCAR</a> (<a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>);
<a id='L31848' name='L31848'></a> 31848 
<a id='L31849' name='L31849'></a> 31849           <em class='comment'>/* Now check if we still don't own that selection, which can</em>
<a id='L31850' name='L31850'></a> 31850 <em class='comment'>             happen if another program set itself as the owner.  */</em>
<a id='L31851' name='L31851'></a> 31851           names[counter++] = <a href='../S/2281.html#L126' title='Defined at 126 in src/xselect.c.'>symbol_to_x_atom</a> (dpyinfo, <a href='../D/7021.html' title='Multiple defined in 2 places.'>XCAR</a> (tem));
<a id='L31852' name='L31852'></a> 31852 
<a id='L31853' name='L31853'></a> 31853 <em class='sharp'>#ifndef</em> USE_XCB
<a id='L31854' name='L31854'></a> 31854           owners[nowners++] = XGetSelectionOwner (dpyinfo-&gt;<a href='../D/10495.html' title='Multiple defined in 3 places.'>display</a>,
<a id='L31855' name='L31855'></a> 31855                                                   names[counter - 1]);
<a id='L31856' name='L31856'></a> 31856 <em class='sharp'>#else</em>
<a id='L31857' name='L31857'></a> 31857           cookies[nowners++]
<a id='L31858' name='L31858'></a> 31858             = xcb_get_selection_owner (dpyinfo-&gt;xcb_connection,
<a id='L31859' name='L31859'></a> 31859                                        names[counter - 1]);
<a id='L31860' name='L31860'></a> 31860         <em class='brace'>}</em>
<a id='L31861' name='L31861'></a> 31861 
<a id='L31862' name='L31862'></a> 31862       nowners = 0;
<a id='L31863' name='L31863'></a> 31863       <a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a> = lost;
<a id='L31864' name='L31864'></a> 31864 
<a id='L31865' name='L31865'></a> 31865       <a href='../S/2267.html#L5578' title='Defined at 5578 in src/lisp.h.'>FOR_EACH_TAIL_SAFE</a> (<a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>)
<a id='L31866' name='L31866'></a> 31866         <em class='brace'>{</em>
<a id='L31867' name='L31867'></a> 31867           <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> tem = <a href='../D/7021.html' title='Multiple defined in 2 places.'>XCAR</a> (<a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>);
<a id='L31868' name='L31868'></a> 31868 
<a id='L31869' name='L31869'></a> 31869           reply = xcb_get_selection_owner_reply (dpyinfo-&gt;xcb_connection,
<a id='L31870' name='L31870'></a> 31870                                                  cookies[nowners++], &amp;<a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L31871' name='L31871'></a> 31871           <strong class='reserved'>if</strong> (reply)
<a id='L31872' name='L31872'></a> 31872             owners[nowners - 1] = reply-&gt;owner;
<a id='L31873' name='L31873'></a> 31873           <strong class='reserved'>else</strong>
<a id='L31874' name='L31874'></a> 31874             owners[nowners - 1] = None;
<a id='L31875' name='L31875'></a> 31875 
<a id='L31876' name='L31876'></a> 31876           <a href='../D/11713.html' title='Multiple defined in 19 places.'>free</a> (reply ? (<strong class='reserved'>void</strong> *) reply : (<strong class='reserved'>void</strong> *) <a href='../D/11145.html' title='Multiple defined in 7 places.'>error</a>);
<a id='L31877' name='L31877'></a> 31877 <em class='sharp'>#endif</em>
<a id='L31878' name='L31878'></a> 31878 
<a id='L31879' name='L31879'></a> 31879           <strong class='reserved'>if</strong> (owners[nowners - 1] != <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (new_owner)))
<a id='L31880' name='L31880'></a> 31880             <em class='brace'>{</em>
<a id='L31881' name='L31881'></a> 31881               <em class='comment'>/* Clear the local selection, since we know we don't own</em>
<a id='L31882' name='L31882'></a> 31882 <em class='comment'>                 it any longer.  */</em>
<a id='L31883' name='L31883'></a> 31883               <a href='../D/1234.html' title='Multiple defined in 2 places.'>CONS_TO_INTEGER</a> (<a href='../D/7021.html' title='Multiple defined in 2 places.'>XCAR</a> (<a href='../D/7022.html' title='Multiple defined in 2 places.'>XCDR</a> (<a href='../D/7022.html' title='Multiple defined in 2 places.'>XCDR</a> (tem))), <a href='../D/6474.html' title='Multiple defined in 2 places.'>Time</a>, timestamp);
<a id='L31884' name='L31884'></a> 31884 
<a id='L31885' name='L31885'></a> 31885               <a href='../S/4097.html#L14' title='Defined at 14 in test/manual/etags/cp-src/conway.hpp.'>clear</a>.kind = <a href='../S/2231.html#L187' title='Defined at 187 in src/termhooks.h.'>SELECTION_CLEAR_EVENT</a>;
<a id='L31886' name='L31886'></a> 31886 
<a id='L31887' name='L31887'></a> 31887               <a href='../D/5566.html' title='Multiple defined in 2 places.'>SELECTION_EVENT_DPYINFO</a> (&amp;<a href='../S/4097.html#L14' title='Defined at 14 in test/manual/etags/cp-src/conway.hpp.'>clear</a>) = dpyinfo;
<a id='L31888' name='L31888'></a> 31888               <a href='../D/5569.html' title='Multiple defined in 2 places.'>SELECTION_EVENT_SELECTION</a> (&amp;<a href='../S/4097.html#L14' title='Defined at 14 in test/manual/etags/cp-src/conway.hpp.'>clear</a>) = names[nowners - 1];
<a id='L31889' name='L31889'></a> 31889               <a href='../D/5571.html' title='Multiple defined in 2 places.'>SELECTION_EVENT_TIME</a> (&amp;<a href='../S/4097.html#L14' title='Defined at 14 in test/manual/etags/cp-src/conway.hpp.'>clear</a>) = timestamp;
<a id='L31890' name='L31890'></a> 31890 
<a id='L31891' name='L31891'></a> 31891               <a href='../S/2281.html#L1362' title='Defined at 1362 in src/xselect.c.'>x_handle_selection_event</a> (&amp;<a href='../S/4097.html#L14' title='Defined at 14 in test/manual/etags/cp-src/conway.hpp.'>clear</a>);
<a id='L31892' name='L31892'></a> 31892             <em class='brace'>}</em>
<a id='L31893' name='L31893'></a> 31893         <em class='brace'>}</em>
<a id='L31894' name='L31894'></a> 31894 
<a id='L31895' name='L31895'></a> 31895       <a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a> = lost;
<a id='L31896' name='L31896'></a> 31896       nowners = 0;
<a id='L31897' name='L31897'></a> 31897 
<a id='L31898' name='L31898'></a> 31898       <a href='../S/2267.html#L5578' title='Defined at 5578 in src/lisp.h.'>FOR_EACH_TAIL_SAFE</a> (<a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>)
<a id='L31899' name='L31899'></a> 31899         <em class='brace'>{</em>
<a id='L31900' name='L31900'></a> 31900           <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a> tem = <a href='../D/7021.html' title='Multiple defined in 2 places.'>XCAR</a> (<a href='../S/4025.html#L70' title='Defined at 70 in test/manual/cedet/tests/testsppreplaced.c.'>tail</a>);
<a id='L31901' name='L31901'></a> 31901 
<a id='L31902' name='L31902'></a> 31902           <em class='comment'>/* If the selection isn't owned by us anymore, note that the</em>
<a id='L31903' name='L31903'></a> 31903 <em class='comment'>             selection was lost.  */</em>
<a id='L31904' name='L31904'></a> 31904           <strong class='reserved'>if</strong> (owners[nowners++] != <a href='../D/2477.html' title='Multiple defined in 2 places.'>FRAME_X_WINDOW</a> (<a href='../S/2183.html#L909' title='Defined at 909 in src/frame.h.'>XFRAME</a> (new_owner)))
<a id='L31905' name='L31905'></a> 31905             <a href='../D/652.html' title='Multiple defined in 2 places.'>CALLN</a> (Frun_hook_with_args, Qx_lost_selection_functions,
<a id='L31906' name='L31906'></a> 31906                    <a href='../D/7021.html' title='Multiple defined in 2 places.'>XCAR</a> (tem));
<a id='L31907' name='L31907'></a> 31907         <em class='brace'>}</em>
<a id='L31908' name='L31908'></a> 31908     <em class='brace'>}</em>
<a id='L31909' name='L31909'></a> 31909 <em class='brace'>}</em>
<a id='L31910' name='L31910'></a> 31910 
<a id='L31911' name='L31911'></a> 31911 <em class='comment'>/* Return a list of the keyboard modifier masks in DPYINFO.</em>
<a id='L31912' name='L31912'></a> 31912 <em class='comment'></em>
<a id='L31913' name='L31913'></a> 31913 <em class='comment'>   Value is a list of (HYPER SUPER ALT SHIFT-LOCK META), each element</em>
<a id='L31914' name='L31914'></a> 31914 <em class='comment'>   being the appropriate modifier mask.  */</em>
<a id='L31915' name='L31915'></a> 31915 
<a id='L31916' name='L31916'></a> 31916 <a href='../D/3834.html' title='Multiple defined in 11 places.'>Lisp_Object</a>
<a id='L31917' name='L31917'></a> 31917 x_get_keyboard_modifiers (<strong class='reserved'>struct</strong> <a href='../S/2212.html#L369' title='Defined at 369 in src/xterm.h.'>x_display_info</a> *dpyinfo)
<a id='L31918' name='L31918'></a> 31918 <em class='brace'>{</em>
<a id='L31919' name='L31919'></a> 31919   <em class='comment'>/* This sometimes happens when the function is called during display</em>
<a id='L31920' name='L31920'></a> 31920 <em class='comment'>     initialization, which can happen while obtaining vendor specific</em>
<a id='L31921' name='L31921'></a> 31921 <em class='comment'>     keysyms.  */</em>
<a id='L31922' name='L31922'></a> 31922 
<a id='L31923' name='L31923'></a> 31923 <em class='sharp'>#ifdef</em> HAVE_XKB
<a id='L31924' name='L31924'></a> 31924   <strong class='reserved'>if</strong> (!dpyinfo-&gt;xkb_desc &amp;&amp; !dpyinfo-&gt;modmap)
<a id='L31925' name='L31925'></a> 31925     x_find_modifier_meanings (dpyinfo);
<a id='L31926' name='L31926'></a> 31926 <em class='sharp'>#else</em>
<a id='L31927' name='L31927'></a> 31927   <strong class='reserved'>if</strong> (!dpyinfo-&gt;modmap)
<a id='L31928' name='L31928'></a> 31928     x_find_modifier_meanings (dpyinfo);
<a id='L31929' name='L31929'></a> 31929 <em class='sharp'>#endif</em>
<a id='L31930' name='L31930'></a> 31930 
<a id='L31931' name='L31931'></a> 31931   <strong class='reserved'>return</strong> <a href='../S/2350.html#L2944' title='Defined at 2944 in src/alloc.c.'>list5</a> (<a href='../S/2267.html#L2807' title='Defined at 2807 in src/lisp.h.'>make_uint</a> (dpyinfo-&gt;hyper_mod_mask),
<a id='L31932' name='L31932'></a> 31932                 <a href='../S/2267.html#L2807' title='Defined at 2807 in src/lisp.h.'>make_uint</a> (dpyinfo-&gt;super_mod_mask),
<a id='L31933' name='L31933'></a> 31933                 <a href='../S/2267.html#L2807' title='Defined at 2807 in src/lisp.h.'>make_uint</a> (dpyinfo-&gt;alt_mod_mask),
<a id='L31934' name='L31934'></a> 31934                 <a href='../S/2267.html#L2807' title='Defined at 2807 in src/lisp.h.'>make_uint</a> (dpyinfo-&gt;shift_lock_mask),
<a id='L31935' name='L31935'></a> 31935                 <a href='../S/2267.html#L2807' title='Defined at 2807 in src/lisp.h.'>make_uint</a> (dpyinfo-&gt;meta_mod_mask));
<a id='L31936' name='L31936'></a> 31936 <em class='brace'>}</em>
<a id='L31937' name='L31937'></a> 31937 
<a id='L31938' name='L31938'></a> 31938 <strong class='reserved'>void</strong>
<a id='L31939' name='L31939'></a> 31939 syms_of_xterm (<strong class='reserved'>void</strong>)
<a id='L31940' name='L31940'></a> 31940 <em class='brace'>{</em>
<a id='L31941' name='L31941'></a> 31941   x_error_message = <a href='../D/4537.html' title='Multiple defined in 11 places.'>NULL</a>;
<a id='L31942' name='L31942'></a> 31942   <a href='../S/2324.html#L34' title='Defined at 34 in src/pdumper.h.'>PDUMPER_IGNORE</a> (x_error_message);
<a id='L31943' name='L31943'></a> 31943 
<a id='L31944' name='L31944'></a> 31944   x_dnd_monitors = Qnil;
<a id='L31945' name='L31945'></a> 31945   <a href='../S/2350.html#L5999' title='Defined at 5999 in src/alloc.c.'>staticpro</a> (&amp;x_dnd_monitors);
<a id='L31946' name='L31946'></a> 31946 
<a id='L31947' name='L31947'></a> 31947   x_dnd_action_symbol = Qnil;
<a id='L31948' name='L31948'></a> 31948   <a href='../S/2350.html#L5999' title='Defined at 5999 in src/alloc.c.'>staticpro</a> (&amp;x_dnd_action_symbol);
<a id='L31949' name='L31949'></a> 31949 
<a id='L31950' name='L31950'></a> 31950   x_dnd_selection_alias_cell = Fcons (Qnil, Qnil);
<a id='L31951' name='L31951'></a> 31951   <a href='../S/2350.html#L5999' title='Defined at 5999 in src/alloc.c.'>staticpro</a> (&amp;x_dnd_selection_alias_cell);
<a id='L31952' name='L31952'></a> 31952 
<a id='L31953' name='L31953'></a> 31953   x_dnd_unsupported_drop_data = Qnil;
<a id='L31954' name='L31954'></a> 31954   <a href='../S/2350.html#L5999' title='Defined at 5999 in src/alloc.c.'>staticpro</a> (&amp;x_dnd_unsupported_drop_data);
<a id='L31955' name='L31955'></a> 31955 
<a id='L31956' name='L31956'></a> 31956   <em class='comment'>/* Used by x_cr_export_frames.  */</em>
<a id='L31957' name='L31957'></a> 31957   <a href='../D/1455.html' title='Multiple defined in 2 places.'>DEFSYM</a> (Qconcat, "concat");
<a id='L31958' name='L31958'></a> 31958 
<a id='L31959' name='L31959'></a> 31959   <a href='../D/1455.html' title='Multiple defined in 2 places.'>DEFSYM</a> (Qvendor_specific_keysyms, "vendor-specific-keysyms");
<a id='L31960' name='L31960'></a> 31960   <a href='../D/1455.html' title='Multiple defined in 2 places.'>DEFSYM</a> (Qlatin_1, "latin-1");
<a id='L31961' name='L31961'></a> 31961   <a href='../D/1455.html' title='Multiple defined in 2 places.'>DEFSYM</a> (Qnow, "now");
<a id='L31962' name='L31962'></a> 31962   <a href='../D/1455.html' title='Multiple defined in 2 places.'>DEFSYM</a> (Qx_dnd_targets_list, "x-dnd-targets-list");
<a id='L31963' name='L31963'></a> 31963   <a href='../D/1455.html' title='Multiple defined in 2 places.'>DEFSYM</a> (Qx_auto_preserve_selections, "x-auto-preserve-selections");
<a id='L31964' name='L31964'></a> 31964   <a href='../D/1455.html' title='Multiple defined in 2 places.'>DEFSYM</a> (Qexpose, "expose");
<a id='L31965' name='L31965'></a> 31965   <a href='../D/1455.html' title='Multiple defined in 2 places.'>DEFSYM</a> (Qdont_save, "dont-save");
<a id='L31966' name='L31966'></a> 31966 
<a id='L31967' name='L31967'></a> 31967 <em class='sharp'>#ifdef</em> USE_GTK
<a id='L31968' name='L31968'></a> 31968   xg_default_icon_file = <a href='../D/9416.html' title='Multiple defined in 2 places.'>build_pure_c_string</a> ("icons/hicolor/scalable/apps/emacs.svg");
<a id='L31969' name='L31969'></a> 31969   <a href='../S/2350.html#L5999' title='Defined at 5999 in src/alloc.c.'>staticpro</a> (&amp;xg_default_icon_file);
<a id='L31970' name='L31970'></a> 31970 
<a id='L31971' name='L31971'></a> 31971   <a href='../D/1455.html' title='Multiple defined in 2 places.'>DEFSYM</a> (Qx_gtk_map_stock, "x-gtk-map-stock");
<a id='L31972' name='L31972'></a> 31972 <em class='sharp'>#endif</em>
<a id='L31973' name='L31973'></a> 31973 
<a id='L31974' name='L31974'></a> 31974   <a href='../D/1472.html' title='Multiple defined in 2 places.'>DEFVAR_BOOL</a> ("x-use-underline-position-properties",
<a id='L31975' name='L31975'></a> 31975                x_use_underline_position_properties,
<a id='L31976' name='L31976'></a> 31976      doc: <em class='comment'>/* Non-nil means make use of UNDERLINE_POSITION font properties.</em>
<a id='L31977' name='L31977'></a> 31977 <em class='comment'>A value of nil means ignore them.  If you encounter fonts with bogus</em>
<a id='L31978' name='L31978'></a> 31978 <em class='comment'>UNDERLINE_POSITION font properties, set this to nil.  You can also use</em>
<a id='L31979' name='L31979'></a> 31979 <em class='comment'>`underline-minimum-offset' to override the font's UNDERLINE_POSITION for</em>
<a id='L31980' name='L31980'></a> 31980 <em class='comment'>small font display sizes.  */</em>);
<a id='L31981' name='L31981'></a> 31981   x_use_underline_position_properties = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L31982' name='L31982'></a> 31982   <a href='../D/1455.html' title='Multiple defined in 2 places.'>DEFSYM</a> (Qx_use_underline_position_properties,
<a id='L31983' name='L31983'></a> 31983           "x-use-underline-position-properties");
<a id='L31984' name='L31984'></a> 31984 
<a id='L31985' name='L31985'></a> 31985   <a href='../D/1472.html' title='Multiple defined in 2 places.'>DEFVAR_BOOL</a> ("x-underline-at-descent-line",
<a id='L31986' name='L31986'></a> 31986                x_underline_at_descent_line,
<a id='L31987' name='L31987'></a> 31987      doc: <em class='comment'>/* Non-nil means to draw the underline at the same place as the descent line.</em>
<a id='L31988' name='L31988'></a> 31988 <em class='comment'>(If `line-spacing' is in effect, that moves the underline lower by</em>
<a id='L31989' name='L31989'></a> 31989 <em class='comment'>that many pixels.)</em>
<a id='L31990' name='L31990'></a> 31990 <em class='comment'>A value of nil means to draw the underline according to the value of the</em>
<a id='L31991' name='L31991'></a> 31991 <em class='comment'>variable `x-use-underline-position-properties', which is usually at the</em>
<a id='L31992' name='L31992'></a> 31992 <em class='comment'>baseline level.  The default value is nil.  */</em>);
<a id='L31993' name='L31993'></a> 31993   x_underline_at_descent_line = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L31994' name='L31994'></a> 31994   <a href='../D/1455.html' title='Multiple defined in 2 places.'>DEFSYM</a> (Qx_underline_at_descent_line, "x-underline-at-descent-line");
<a id='L31995' name='L31995'></a> 31995 
<a id='L31996' name='L31996'></a> 31996   <a href='../D/1472.html' title='Multiple defined in 2 places.'>DEFVAR_BOOL</a> ("x-mouse-click-focus-ignore-position",
<a id='L31997' name='L31997'></a> 31997                x_mouse_click_focus_ignore_position,
<a id='L31998' name='L31998'></a> 31998     doc: <em class='comment'>/* Non-nil means that a mouse click to focus a frame does not move point.</em>
<a id='L31999' name='L31999'></a> 31999 <em class='comment'>This variable is used only when the window manager requires that you</em>
<a id='L32000' name='L32000'></a> 32000 <em class='comment'>click on a frame to select it (give it focus).  In that case, a value</em>
<a id='L32001' name='L32001'></a> 32001 <em class='comment'>of nil, means that the selected window and cursor position changes to</em>
<a id='L32002' name='L32002'></a> 32002 <em class='comment'>reflect the mouse click position, while a non-nil value means that the</em>
<a id='L32003' name='L32003'></a> 32003 <em class='comment'>selected window or cursor position is preserved.</em>
<a id='L32004' name='L32004'></a> 32004 <em class='comment'></em>
<a id='L32005' name='L32005'></a> 32005 <em class='comment'>This option works by ignoring button press events for a given amount</em>
<a id='L32006' name='L32006'></a> 32006 <em class='comment'>of time after a frame might've been focused.  If it does not work for</em>
<a id='L32007' name='L32007'></a> 32007 <em class='comment'>you, try increasing the value of</em>
<a id='L32008' name='L32008'></a> 32008 <em class='comment'>`x-mouse-click-focus-ignore-time'.  */</em>);
<a id='L32009' name='L32009'></a> 32009   x_mouse_click_focus_ignore_position = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L32010' name='L32010'></a> 32010 
<a id='L32011' name='L32011'></a> 32011   <a href='../D/1474.html' title='Multiple defined in 2 places.'>DEFVAR_INT</a> ("x-mouse-click-focus-ignore-time", x_mouse_click_focus_ignore_time,
<a id='L32012' name='L32012'></a> 32012     doc: <em class='comment'>/* Number of milliseconds for which to ignore buttons after focus change.</em>
<a id='L32013' name='L32013'></a> 32013 <em class='comment'>This variable only takes effect if</em>
<a id='L32014' name='L32014'></a> 32014 <em class='comment'>`x-mouse-click-focus-ignore-position' is non-nil, and should be</em>
<a id='L32015' name='L32015'></a> 32015 <em class='comment'>adjusted if the default value does not work for whatever reason.  */</em>);
<a id='L32016' name='L32016'></a> 32016   x_mouse_click_focus_ignore_time = 200;
<a id='L32017' name='L32017'></a> 32017 
<a id='L32018' name='L32018'></a> 32018   <a href='../D/1476.html' title='Multiple defined in 2 places.'>DEFVAR_LISP</a> ("x-toolkit-scroll-bars", Vx_toolkit_scroll_bars,
<a id='L32019' name='L32019'></a> 32019     doc: <em class='comment'>/* Which toolkit scroll bars Emacs uses, if any.</em>
<a id='L32020' name='L32020'></a> 32020 <em class='comment'>A value of nil means Emacs doesn't use toolkit scroll bars.</em>
<a id='L32021' name='L32021'></a> 32021 <em class='comment'>With the X Window system, the value is a symbol describing the</em>
<a id='L32022' name='L32022'></a> 32022 <em class='comment'>X toolkit.  Possible values are: gtk, motif, xaw, or xaw3d.</em>
<a id='L32023' name='L32023'></a> 32023 <em class='comment'>With MS Windows, Haiku windowing or Nextstep, the value is t.</em>
<a id='L32024' name='L32024'></a> 32024 <em class='comment'>With Android, the value is nil, but that is because Emacs on</em>
<a id='L32025' name='L32025'></a> 32025 <em class='comment'>Android does not support scroll bars at all.  */</em>);
<a id='L32026' name='L32026'></a> 32026 <em class='sharp'>#ifdef</em> USE_TOOLKIT_SCROLL_BARS
<a id='L32027' name='L32027'></a> 32027 <em class='sharp'>#ifdef</em> USE_MOTIF
<a id='L32028' name='L32028'></a> 32028   Vx_toolkit_scroll_bars = <a href='../D/13390.html' title='Multiple defined in 2 places.'>intern_c_string</a> ("motif");
<a id='L32029' name='L32029'></a> 32029 <em class='sharp'>#elif</em> <strong class='reserved'>defined</strong> HAVE_XAW3D
<a id='L32030' name='L32030'></a> 32030   Vx_toolkit_scroll_bars = <a href='../D/13390.html' title='Multiple defined in 2 places.'>intern_c_string</a> ("xaw3d");
<a id='L32031' name='L32031'></a> 32031 <em class='sharp'>#elif</em> USE_GTK
<a id='L32032' name='L32032'></a> 32032   Vx_toolkit_scroll_bars = <a href='../D/13390.html' title='Multiple defined in 2 places.'>intern_c_string</a> ("gtk");
<a id='L32033' name='L32033'></a> 32033 <em class='sharp'>#else</em>
<a id='L32034' name='L32034'></a> 32034   Vx_toolkit_scroll_bars = <a href='../D/13390.html' title='Multiple defined in 2 places.'>intern_c_string</a> ("xaw");
<a id='L32035' name='L32035'></a> 32035 <em class='sharp'>#endif</em>
<a id='L32036' name='L32036'></a> 32036 <em class='sharp'>#else</em>
<a id='L32037' name='L32037'></a> 32037   Vx_toolkit_scroll_bars = Qnil;
<a id='L32038' name='L32038'></a> 32038 <em class='sharp'>#endif</em>
<a id='L32039' name='L32039'></a> 32039 
<a id='L32040' name='L32040'></a> 32040   <a href='../D/1455.html' title='Multiple defined in 2 places.'>DEFSYM</a> (Qmodifier_value, "modifier-value");
<a id='L32041' name='L32041'></a> 32041   <a href='../D/1455.html' title='Multiple defined in 2 places.'>DEFSYM</a> (Qctrl, "ctrl");
<a id='L32042' name='L32042'></a> 32042   Fput (Qctrl, Qmodifier_value, <a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (<a href='../S/2231.html#L441' title='Defined at 441 in src/termhooks.h.'>ctrl_modifier</a>));
<a id='L32043' name='L32043'></a> 32043   <a href='../D/1455.html' title='Multiple defined in 2 places.'>DEFSYM</a> (Qalt, "alt");
<a id='L32044' name='L32044'></a> 32044   Fput (Qalt, Qmodifier_value, <a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (<a href='../S/2231.html#L437' title='Defined at 437 in src/termhooks.h.'>alt_modifier</a>));
<a id='L32045' name='L32045'></a> 32045   <a href='../D/1455.html' title='Multiple defined in 2 places.'>DEFSYM</a> (Qhyper, "hyper");
<a id='L32046' name='L32046'></a> 32046   Fput (Qhyper, Qmodifier_value, <a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (<a href='../S/2231.html#L439' title='Defined at 439 in src/termhooks.h.'>hyper_modifier</a>));
<a id='L32047' name='L32047'></a> 32047   <a href='../D/1455.html' title='Multiple defined in 2 places.'>DEFSYM</a> (Qmeta, "meta");
<a id='L32048' name='L32048'></a> 32048   Fput (Qmeta, Qmodifier_value, <a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (<a href='../S/2231.html#L442' title='Defined at 442 in src/termhooks.h.'>meta_modifier</a>));
<a id='L32049' name='L32049'></a> 32049   <a href='../D/1455.html' title='Multiple defined in 2 places.'>DEFSYM</a> (Qsuper, "super");
<a id='L32050' name='L32050'></a> 32050   Fput (Qsuper, Qmodifier_value, <a href='../D/14100.html' title='Multiple defined in 2 places.'>make_fixnum</a> (<a href='../S/2231.html#L438' title='Defined at 438 in src/termhooks.h.'>super_modifier</a>));
<a id='L32051' name='L32051'></a> 32051   <a href='../D/1455.html' title='Multiple defined in 2 places.'>DEFSYM</a> (QXdndSelection, "XdndSelection");
<a id='L32052' name='L32052'></a> 32052   <a href='../D/1455.html' title='Multiple defined in 2 places.'>DEFSYM</a> (Qx_selection_alias_alist, "x-selection-alias-alist");
<a id='L32053' name='L32053'></a> 32053   <a href='../D/1455.html' title='Multiple defined in 2 places.'>DEFSYM</a> (Qimitate_pager, "imitate-pager");
<a id='L32054' name='L32054'></a> 32054   <a href='../D/1455.html' title='Multiple defined in 2 places.'>DEFSYM</a> (Qnewer_time, "newer-time");
<a id='L32055' name='L32055'></a> 32055   <a href='../D/1455.html' title='Multiple defined in 2 places.'>DEFSYM</a> (Qraise_and_focus, "raise-and-focus");
<a id='L32056' name='L32056'></a> 32056   <a href='../D/1455.html' title='Multiple defined in 2 places.'>DEFSYM</a> (Qreally_fast, "really-fast");
<a id='L32057' name='L32057'></a> 32057 
<a id='L32058' name='L32058'></a> 32058   <a href='../D/1476.html' title='Multiple defined in 2 places.'>DEFVAR_LISP</a> ("x-ctrl-keysym", Vx_ctrl_keysym,
<a id='L32059' name='L32059'></a> 32059     doc: <em class='comment'>/* Which keys Emacs uses for the ctrl modifier.</em>
<a id='L32060' name='L32060'></a> 32060 <em class='comment'>This should be one of the symbols `ctrl', `alt', `hyper', `meta',</em>
<a id='L32061' name='L32061'></a> 32061 <em class='comment'>`super'.  For example, `ctrl' means use the Ctrl_L and Ctrl_R keysyms.</em>
<a id='L32062' name='L32062'></a> 32062 <em class='comment'>The default is nil, which is the same as `ctrl'.  */</em>);
<a id='L32063' name='L32063'></a> 32063   Vx_ctrl_keysym = Qnil;
<a id='L32064' name='L32064'></a> 32064 
<a id='L32065' name='L32065'></a> 32065   <a href='../D/1476.html' title='Multiple defined in 2 places.'>DEFVAR_LISP</a> ("x-alt-keysym", Vx_alt_keysym,
<a id='L32066' name='L32066'></a> 32066     doc: <em class='comment'>/* Which keys Emacs uses for the alt modifier.</em>
<a id='L32067' name='L32067'></a> 32067 <em class='comment'>This should be one of the symbols `ctrl', `alt', `hyper', `meta',</em>
<a id='L32068' name='L32068'></a> 32068 <em class='comment'>`super'.  For example, `alt' means use the Alt_L and Alt_R keysyms.</em>
<a id='L32069' name='L32069'></a> 32069 <em class='comment'>The default is nil, which is the same as `alt'.  */</em>);
<a id='L32070' name='L32070'></a> 32070   Vx_alt_keysym = Qnil;
<a id='L32071' name='L32071'></a> 32071 
<a id='L32072' name='L32072'></a> 32072   <a href='../D/1476.html' title='Multiple defined in 2 places.'>DEFVAR_LISP</a> ("x-hyper-keysym", Vx_hyper_keysym,
<a id='L32073' name='L32073'></a> 32073     doc: <em class='comment'>/* Which keys Emacs uses for the hyper modifier.</em>
<a id='L32074' name='L32074'></a> 32074 <em class='comment'>This should be one of the symbols `ctrl', `alt', `hyper', `meta',</em>
<a id='L32075' name='L32075'></a> 32075 <em class='comment'>`super'.  For example, `hyper' means use the Hyper_L and Hyper_R</em>
<a id='L32076' name='L32076'></a> 32076 <em class='comment'>keysyms.  The default is nil, which is the same as `hyper'.  */</em>);
<a id='L32077' name='L32077'></a> 32077   Vx_hyper_keysym = Qnil;
<a id='L32078' name='L32078'></a> 32078 
<a id='L32079' name='L32079'></a> 32079   <a href='../D/1476.html' title='Multiple defined in 2 places.'>DEFVAR_LISP</a> ("x-meta-keysym", Vx_meta_keysym,
<a id='L32080' name='L32080'></a> 32080     doc: <em class='comment'>/* Which keys Emacs uses for the meta modifier.</em>
<a id='L32081' name='L32081'></a> 32081 <em class='comment'>This should be one of the symbols `ctrl', `alt', `hyper', `meta',</em>
<a id='L32082' name='L32082'></a> 32082 <em class='comment'>`super'.  For example, `meta' means use the Meta_L and Meta_R keysyms.</em>
<a id='L32083' name='L32083'></a> 32083 <em class='comment'>The default is nil, which is the same as `meta'.  */</em>);
<a id='L32084' name='L32084'></a> 32084   Vx_meta_keysym = Qnil;
<a id='L32085' name='L32085'></a> 32085 
<a id='L32086' name='L32086'></a> 32086   <a href='../D/1476.html' title='Multiple defined in 2 places.'>DEFVAR_LISP</a> ("x-super-keysym", Vx_super_keysym,
<a id='L32087' name='L32087'></a> 32087     doc: <em class='comment'>/* Which keys Emacs uses for the super modifier.</em>
<a id='L32088' name='L32088'></a> 32088 <em class='comment'>This should be one of the symbols `ctrl', `alt', `hyper', `meta',</em>
<a id='L32089' name='L32089'></a> 32089 <em class='comment'>`super'.  For example, `super' means use the Super_L and Super_R</em>
<a id='L32090' name='L32090'></a> 32090 <em class='comment'>keysyms.  The default is nil, which is the same as `super'.  */</em>);
<a id='L32091' name='L32091'></a> 32091   Vx_super_keysym = Qnil;
<a id='L32092' name='L32092'></a> 32092 
<a id='L32093' name='L32093'></a> 32093   <a href='../D/1476.html' title='Multiple defined in 2 places.'>DEFVAR_LISP</a> ("x-wait-for-event-timeout", Vx_wait_for_event_timeout,
<a id='L32094' name='L32094'></a> 32094     doc: <em class='comment'>/* How long to wait for X events.</em>
<a id='L32095' name='L32095'></a> 32095 <em class='comment'></em>
<a id='L32096' name='L32096'></a> 32096 <em class='comment'>Emacs will wait up to this many seconds to receive X events after</em>
<a id='L32097' name='L32097'></a> 32097 <em class='comment'>making changes which affect the state of the graphical interface.</em>
<a id='L32098' name='L32098'></a> 32098 <em class='comment'>Under some window managers this can take an indefinite amount of time,</em>
<a id='L32099' name='L32099'></a> 32099 <em class='comment'>so it is important to limit the wait.</em>
<a id='L32100' name='L32100'></a> 32100 <em class='comment'></em>
<a id='L32101' name='L32101'></a> 32101 <em class='comment'>If set to a non-float value, there will be no wait at all.  */</em>);
<a id='L32102' name='L32102'></a> 32102   Vx_wait_for_event_timeout = <a href='../S/2350.html#L2753' title='Defined at 2753 in src/alloc.c.'>make_float</a> (0.1);
<a id='L32103' name='L32103'></a> 32103 
<a id='L32104' name='L32104'></a> 32104   <a href='../D/1476.html' title='Multiple defined in 2 places.'>DEFVAR_LISP</a> ("x-keysym-table", Vx_keysym_table,
<a id='L32105' name='L32105'></a> 32105     doc: <em class='comment'>/* Hash table of character codes indexed by X keysym codes.  */</em>);
<a id='L32106' name='L32106'></a> 32106   Vx_keysym_table = <a href='../S/2320.html#L4552' title='Defined at 4552 in src/fns.c.'>make_hash_table</a> (hashtest_eql, 900,
<a id='L32107' name='L32107'></a> 32107                                      DEFAULT_REHASH_SIZE,
<a id='L32108' name='L32108'></a> 32108                                      DEFAULT_REHASH_THRESHOLD,
<a id='L32109' name='L32109'></a> 32109                                      Qnil, <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>);
<a id='L32110' name='L32110'></a> 32110 
<a id='L32111' name='L32111'></a> 32111   <a href='../D/1472.html' title='Multiple defined in 2 places.'>DEFVAR_BOOL</a> ("x-frame-normalize-before-maximize",
<a id='L32112' name='L32112'></a> 32112                x_frame_normalize_before_maximize,
<a id='L32113' name='L32113'></a> 32113     doc: <em class='comment'>/* Non-nil means normalize frame before maximizing.</em>
<a id='L32114' name='L32114'></a> 32114 <em class='comment'>If this variable is t, Emacs first asks the window manager to give the</em>
<a id='L32115' name='L32115'></a> 32115 <em class='comment'>frame its normal size, and only then the final state, whenever changing</em>
<a id='L32116' name='L32116'></a> 32116 <em class='comment'>from a full-height, full-width or full-both state to the maximized one</em>
<a id='L32117' name='L32117'></a> 32117 <em class='comment'>or when changing from the maximized to the full-height or full-width</em>
<a id='L32118' name='L32118'></a> 32118 <em class='comment'>state.</em>
<a id='L32119' name='L32119'></a> 32119 <em class='comment'></em>
<a id='L32120' name='L32120'></a> 32120 <em class='comment'>Set this variable only if your window manager cannot handle the</em>
<a id='L32121' name='L32121'></a> 32121 <em class='comment'>transition between the various maximization states.  */</em>);
<a id='L32122' name='L32122'></a> 32122   x_frame_normalize_before_maximize = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L32123' name='L32123'></a> 32123 
<a id='L32124' name='L32124'></a> 32124   <a href='../D/1472.html' title='Multiple defined in 2 places.'>DEFVAR_BOOL</a> ("x-gtk-use-window-move", x_gtk_use_window_move,
<a id='L32125' name='L32125'></a> 32125     doc: <em class='comment'>/* Non-nil means rely on gtk_window_move to set frame positions.</em>
<a id='L32126' name='L32126'></a> 32126 <em class='comment'>If this variable is t (the default), the GTK build uses the function</em>
<a id='L32127' name='L32127'></a> 32127 <em class='comment'>gtk_window_move to set or store frame positions and disables some time</em>
<a id='L32128' name='L32128'></a> 32128 <em class='comment'>consuming frame position adjustments.  In newer versions of GTK, Emacs</em>
<a id='L32129' name='L32129'></a> 32129 <em class='comment'>always uses gtk_window_move and ignores the value of this variable.  */</em>);
<a id='L32130' name='L32130'></a> 32130   x_gtk_use_window_move = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L32131' name='L32131'></a> 32131 
<a id='L32132' name='L32132'></a> 32132   <a href='../D/1476.html' title='Multiple defined in 2 places.'>DEFVAR_LISP</a> ("x-scroll-event-delta-factor", Vx_scroll_event_delta_factor,
<a id='L32133' name='L32133'></a> 32133                doc: <em class='comment'>/* A scale to apply to pixel deltas reported in scroll events.</em>
<a id='L32134' name='L32134'></a> 32134 <em class='comment'>This option is only effective when Emacs is built with XInput 2</em>
<a id='L32135' name='L32135'></a> 32135 <em class='comment'>support. */</em>);
<a id='L32136' name='L32136'></a> 32136   Vx_scroll_event_delta_factor = <a href='../S/2350.html#L2753' title='Defined at 2753 in src/alloc.c.'>make_float</a> (1.0);
<a id='L32137' name='L32137'></a> 32137 
<a id='L32138' name='L32138'></a> 32138   <a href='../D/1472.html' title='Multiple defined in 2 places.'>DEFVAR_BOOL</a> ("x-gtk-use-native-input", x_gtk_use_native_input,
<a id='L32139' name='L32139'></a> 32139                doc: <em class='comment'>/* Non-nil means to use GTK for input method support.</em>
<a id='L32140' name='L32140'></a> 32140 <em class='comment'>This provides better support for some modern input methods, and is</em>
<a id='L32141' name='L32141'></a> 32141 <em class='comment'>only effective when Emacs is built with GTK.  */</em>);
<a id='L32142' name='L32142'></a> 32142   x_gtk_use_native_input = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L32143' name='L32143'></a> 32143 
<a id='L32144' name='L32144'></a> 32144   <a href='../D/1476.html' title='Multiple defined in 2 places.'>DEFVAR_LISP</a> ("x-set-frame-visibility-more-laxly",
<a id='L32145' name='L32145'></a> 32145                x_set_frame_visibility_more_laxly,
<a id='L32146' name='L32146'></a> 32146     doc: <em class='comment'>/* Non-nil means set frame visibility more laxly.</em>
<a id='L32147' name='L32147'></a> 32147 <em class='comment'>If this is nil, Emacs is more strict when marking a frame as visible.</em>
<a id='L32148' name='L32148'></a> 32148 <em class='comment'>Since this may cause problems on some window managers, this variable can</em>
<a id='L32149' name='L32149'></a> 32149 <em class='comment'>be also set as follows: The value `focus-in' means to mark a frame as</em>
<a id='L32150' name='L32150'></a> 32150 <em class='comment'>visible also when a FocusIn event is received for it on GTK builds.  The</em>
<a id='L32151' name='L32151'></a> 32151 <em class='comment'>value `expose' means to mark a frame as visible also when an Expose</em>
<a id='L32152' name='L32152'></a> 32152 <em class='comment'>event is received for it on any X build.  The value `t' means to mark a</em>
<a id='L32153' name='L32153'></a> 32153 <em class='comment'>frame as visible in either of these two cases.</em>
<a id='L32154' name='L32154'></a> 32154 <em class='comment'></em>
<a id='L32155' name='L32155'></a> 32155 <em class='comment'>Note that any non-nil setting may cause invisible frames get erroneously</em>
<a id='L32156' name='L32156'></a> 32156 <em class='comment'>reported as iconified.  */</em>);
<a id='L32157' name='L32157'></a> 32157   x_set_frame_visibility_more_laxly = Qnil;
<a id='L32158' name='L32158'></a> 32158 
<a id='L32159' name='L32159'></a> 32159   <a href='../D/1472.html' title='Multiple defined in 2 places.'>DEFVAR_BOOL</a> ("x-input-grab-touch-events", x_input_grab_touch_events,
<a id='L32160' name='L32160'></a> 32160                doc: <em class='comment'>/* Non-nil means to actively grab touch events.</em>
<a id='L32161' name='L32161'></a> 32161 <em class='comment'>This means touch sequences that started on an Emacs frame will</em>
<a id='L32162' name='L32162'></a> 32162 <em class='comment'>reliably continue to receive updates even if the finger moves off the</em>
<a id='L32163' name='L32163'></a> 32163 <em class='comment'>frame, but may cause crashes with some window managers and/or external</em>
<a id='L32164' name='L32164'></a> 32164 <em class='comment'>programs.  */</em>);
<a id='L32165' name='L32165'></a> 32165   x_input_grab_touch_events = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L32166' name='L32166'></a> 32166 
<a id='L32167' name='L32167'></a> 32167   <a href='../D/1472.html' title='Multiple defined in 2 places.'>DEFVAR_BOOL</a> ("x-dnd-fix-motif-leave", x_dnd_fix_motif_leave,
<a id='L32168' name='L32168'></a> 32168                doc: <em class='comment'>/* Work around Motif bug during drag-and-drop.</em>
<a id='L32169' name='L32169'></a> 32169 <em class='comment'>When non-nil, Emacs will send a motion event containing impossible</em>
<a id='L32170' name='L32170'></a> 32170 <em class='comment'>coordinates to a Motif drop receiver when the mouse moves outside it</em>
<a id='L32171' name='L32171'></a> 32171 <em class='comment'>during a drag-and-drop session, to work around broken implementations</em>
<a id='L32172' name='L32172'></a> 32172 <em class='comment'>of Motif.  */</em>);
<a id='L32173' name='L32173'></a> 32173   x_dnd_fix_motif_leave = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L32174' name='L32174'></a> 32174 
<a id='L32175' name='L32175'></a> 32175   <a href='../D/1472.html' title='Multiple defined in 2 places.'>DEFVAR_BOOL</a> ("x-dnd-disable-motif-drag", x_dnd_disable_motif_drag,
<a id='L32176' name='L32176'></a> 32176                doc: <em class='comment'>/* Disable the Motif drag protocol during DND.</em>
<a id='L32177' name='L32177'></a> 32177 <em class='comment'>This reduces network usage, but also means you can no longer scroll</em>
<a id='L32178' name='L32178'></a> 32178 <em class='comment'>around inside the Motif window underneath the cursor during</em>
<a id='L32179' name='L32179'></a> 32179 <em class='comment'>drag-and-drop.  */</em>);
<a id='L32180' name='L32180'></a> 32180   x_dnd_disable_motif_drag = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L32181' name='L32181'></a> 32181 
<a id='L32182' name='L32182'></a> 32182   <a href='../D/1476.html' title='Multiple defined in 2 places.'>DEFVAR_LISP</a> ("x-dnd-movement-function", Vx_dnd_movement_function,
<a id='L32183' name='L32183'></a> 32183     doc: <em class='comment'>/* Function called upon mouse movement on a frame during drag-and-drop.</em>
<a id='L32184' name='L32184'></a> 32184 <em class='comment'>It should either be nil, or accept two arguments FRAME and POSITION,</em>
<a id='L32185' name='L32185'></a> 32185 <em class='comment'>where FRAME is the frame the mouse is on top of, and POSITION is a</em>
<a id='L32186' name='L32186'></a> 32186 <em class='comment'>mouse position list.  */</em>);
<a id='L32187' name='L32187'></a> 32187   Vx_dnd_movement_function = Qnil;
<a id='L32188' name='L32188'></a> 32188 
<a id='L32189' name='L32189'></a> 32189   <a href='../D/1476.html' title='Multiple defined in 2 places.'>DEFVAR_LISP</a> ("x-dnd-wheel-function", Vx_dnd_wheel_function,
<a id='L32190' name='L32190'></a> 32190     doc: <em class='comment'>/* Function called upon wheel movement on a frame during drag-and-drop.</em>
<a id='L32191' name='L32191'></a> 32191 <em class='comment'>It should either be nil, or accept four arguments POSITION, BUTTON,</em>
<a id='L32192' name='L32192'></a> 32192 <em class='comment'>STATE and TIME, where POSITION is a mouse position list describing</em>
<a id='L32193' name='L32193'></a> 32193 <em class='comment'>where the wheel moved, BUTTON is the wheel button that was pressed,</em>
<a id='L32194' name='L32194'></a> 32194 <em class='comment'>STATE is the X modifier state at the time of the wheel movement, and</em>
<a id='L32195' name='L32195'></a> 32195 <em class='comment'>TIME is the X server time at which the wheel moved.  */</em>);
<a id='L32196' name='L32196'></a> 32196   Vx_dnd_wheel_function = Qnil;
<a id='L32197' name='L32197'></a> 32197 
<a id='L32198' name='L32198'></a> 32198   <a href='../D/1476.html' title='Multiple defined in 2 places.'>DEFVAR_LISP</a> ("x-dnd-unsupported-drop-function", Vx_dnd_unsupported_drop_function,
<a id='L32199' name='L32199'></a> 32199     doc: <em class='comment'>/* Function called when trying to drop on an unsupported window.</em>
<a id='L32200' name='L32200'></a> 32200 <em class='comment'>This function is called whenever the user tries to drop something on a</em>
<a id='L32201' name='L32201'></a> 32201 <em class='comment'>window that does not support either the XDND or Motif protocols for</em>
<a id='L32202' name='L32202'></a> 32202 <em class='comment'>drag-and-drop.  It should return a non-nil value if the drop was</em>
<a id='L32203' name='L32203'></a> 32203 <em class='comment'>handled by the function, and nil if it was not.  It should accept</em>
<a id='L32204' name='L32204'></a> 32204 <em class='comment'>several arguments TARGETS, X, Y, ACTION, WINDOW-ID, FRAME, TIME and</em>
<a id='L32205' name='L32205'></a> 32205 <em class='comment'>LOCAL-SELECTION, where TARGETS is the list of targets that was passed</em>
<a id='L32206' name='L32206'></a> 32206 <em class='comment'>to `x-begin-drag', WINDOW-ID is the numeric XID of the window that is</em>
<a id='L32207' name='L32207'></a> 32207 <em class='comment'>being dropped on, X and Y are the root window-relative coordinates</em>
<a id='L32208' name='L32208'></a> 32208 <em class='comment'>where the drop happened, ACTION is the action that was passed to</em>
<a id='L32209' name='L32209'></a> 32209 <em class='comment'>`x-begin-drag', FRAME is the frame which initiated the drag-and-drop</em>
<a id='L32210' name='L32210'></a> 32210 <em class='comment'>operation, TIME is the X server time when the drop happened, and</em>
<a id='L32211' name='L32211'></a> 32211 <em class='comment'>LOCAL-SELECTION is the contents of the `XdndSelection' when</em>
<a id='L32212' name='L32212'></a> 32212 <em class='comment'>`x-begin-drag' was run; its contents can be retrieved by calling the</em>
<a id='L32213' name='L32213'></a> 32213 <em class='comment'>function `x-get-local-selection'.</em>
<a id='L32214' name='L32214'></a> 32214 <em class='comment'></em>
<a id='L32215' name='L32215'></a> 32215 <em class='comment'>If a symbol is returned, then it will be used as the return value of</em>
<a id='L32216' name='L32216'></a> 32216 <em class='comment'>`x-begin-drag'.  */</em>);
<a id='L32217' name='L32217'></a> 32217   Vx_dnd_unsupported_drop_function = Qnil;
<a id='L32218' name='L32218'></a> 32218 
<a id='L32219' name='L32219'></a> 32219   <a href='../D/1474.html' title='Multiple defined in 2 places.'>DEFVAR_INT</a> ("x-color-cache-bucket-size", x_color_cache_bucket_size,
<a id='L32220' name='L32220'></a> 32220     doc: <em class='comment'>/* Max number of buckets allowed per display in the internal color cache.</em>
<a id='L32221' name='L32221'></a> 32221 <em class='comment'>Values less than 1 mean 128.  This option is for debugging only.  */</em>);
<a id='L32222' name='L32222'></a> 32222   x_color_cache_bucket_size = 128;
<a id='L32223' name='L32223'></a> 32223 
<a id='L32224' name='L32224'></a> 32224   <a href='../D/1476.html' title='Multiple defined in 2 places.'>DEFVAR_LISP</a> ("x-dnd-targets-list", Vx_dnd_targets_list,
<a id='L32225' name='L32225'></a> 32225     doc: <em class='comment'>/* List of drag-and-drop targets.</em>
<a id='L32226' name='L32226'></a> 32226 <em class='comment'>This variable contains the list of drag-and-drop selection targets</em>
<a id='L32227' name='L32227'></a> 32227 <em class='comment'>during a drag-and-drop operation, in the same format as the TARGET</em>
<a id='L32228' name='L32228'></a> 32228 <em class='comment'>argument to `x-begin-drag'.  */</em>);
<a id='L32229' name='L32229'></a> 32229   Vx_dnd_targets_list = Qnil;
<a id='L32230' name='L32230'></a> 32230 
<a id='L32231' name='L32231'></a> 32231   <a href='../D/1476.html' title='Multiple defined in 2 places.'>DEFVAR_LISP</a> ("x-dnd-native-test-function", Vx_dnd_native_test_function,
<a id='L32232' name='L32232'></a> 32232     doc: <em class='comment'>/* Function that determines return value of drag-and-drop on Emacs frames.</em>
<a id='L32233' name='L32233'></a> 32233 <em class='comment'>If the value is a function, `x-begin-drag' will call it with two</em>
<a id='L32234' name='L32234'></a> 32234 <em class='comment'>arguments, POS and ACTION, where POS is a mouse position list</em>
<a id='L32235' name='L32235'></a> 32235 <em class='comment'>that specifies the location of the drop, and ACTION is the</em>
<a id='L32236' name='L32236'></a> 32236 <em class='comment'>action specified by the caller of `x-begin-drag'.  The function</em>
<a id='L32237' name='L32237'></a> 32237 <em class='comment'>should return a symbol describing what to return from</em>
<a id='L32238' name='L32238'></a> 32238 <em class='comment'>`x-begin-drag' if the drop happens on an Emacs frame.</em>
<a id='L32239' name='L32239'></a> 32239 <em class='comment'></em>
<a id='L32240' name='L32240'></a> 32240 <em class='comment'>If the value is nil, or the function returns a value that is not</em>
<a id='L32241' name='L32241'></a> 32241 <em class='comment'>a symbol, a drop on an Emacs frame will be canceled.  */</em>);
<a id='L32242' name='L32242'></a> 32242   Vx_dnd_native_test_function = Qnil;
<a id='L32243' name='L32243'></a> 32243 
<a id='L32244' name='L32244'></a> 32244   <a href='../D/1472.html' title='Multiple defined in 2 places.'>DEFVAR_BOOL</a> ("x-dnd-preserve-selection-data", x_dnd_preserve_selection_data,
<a id='L32245' name='L32245'></a> 32245     doc: <em class='comment'>/* Preserve selection data after `x-begin-drag' returns.</em>
<a id='L32246' name='L32246'></a> 32246 <em class='comment'>This lets you inspect the contents of `XdndSelection' after a</em>
<a id='L32247' name='L32247'></a> 32247 <em class='comment'>drag-and-drop operation, which is useful when writing tests for</em>
<a id='L32248' name='L32248'></a> 32248 <em class='comment'>drag-and-drop code.  */</em>);
<a id='L32249' name='L32249'></a> 32249   x_dnd_preserve_selection_data = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L32250' name='L32250'></a> 32250 
<a id='L32251' name='L32251'></a> 32251   <a href='../D/1472.html' title='Multiple defined in 2 places.'>DEFVAR_BOOL</a> ("x-dnd-disable-motif-protocol", x_dnd_disable_motif_protocol,
<a id='L32252' name='L32252'></a> 32252     doc: <em class='comment'>/* Disable the Motif drag-and-drop protocols.</em>
<a id='L32253' name='L32253'></a> 32253 <em class='comment'>When non-nil, `x-begin-drag' will not drop onto any window that only</em>
<a id='L32254' name='L32254'></a> 32254 <em class='comment'>supports the Motif drag-and-drop protocols.  */</em>);
<a id='L32255' name='L32255'></a> 32255   x_dnd_disable_motif_protocol = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L32256' name='L32256'></a> 32256 
<a id='L32257' name='L32257'></a> 32257   <a href='../D/1472.html' title='Multiple defined in 2 places.'>DEFVAR_BOOL</a> ("x-dnd-use-unsupported-drop", x_dnd_use_unsupported_drop,
<a id='L32258' name='L32258'></a> 32258     doc: <em class='comment'>/* Enable the emulation of drag-and-drop based on the primary selection.</em>
<a id='L32259' name='L32259'></a> 32259 <em class='comment'>When nil, do not use the primary selection and synthetic mouse clicks</em>
<a id='L32260' name='L32260'></a> 32260 <em class='comment'>to emulate the drag-and-drop of `STRING', `UTF8_STRING',</em>
<a id='L32261' name='L32261'></a> 32261 <em class='comment'>`COMPOUND_TEXT' or `TEXT'.  */</em>);
<a id='L32262' name='L32262'></a> 32262   x_dnd_use_unsupported_drop = <a href='../S/52.html#L13' title='Defined at 13 in nt/inc/stdbool.h.'>true</a>;
<a id='L32263' name='L32263'></a> 32263 
<a id='L32264' name='L32264'></a> 32264   <a href='../D/1472.html' title='Multiple defined in 2 places.'>DEFVAR_BOOL</a> ("x-fast-protocol-requests", x_fast_protocol_requests,
<a id='L32265' name='L32265'></a> 32265     doc: <em class='comment'>/* Whether or not X protocol-related functions should wait for errors.</em>
<a id='L32266' name='L32266'></a> 32266 <em class='comment'>When this is nil, functions such as `x-delete-window-property',</em>
<a id='L32267' name='L32267'></a> 32267 <em class='comment'>`x-change-window-property' and `x-send-client-message' will wait for a</em>
<a id='L32268' name='L32268'></a> 32268 <em class='comment'>reply from the X server, and signal any errors that occurred while</em>
<a id='L32269' name='L32269'></a> 32269 <em class='comment'>executing the protocol request.  Otherwise, errors will be silently</em>
<a id='L32270' name='L32270'></a> 32270 <em class='comment'>ignored without waiting, which is generally faster.  */</em>);
<a id='L32271' name='L32271'></a> 32271   x_fast_protocol_requests = <a href='../S/52.html#L12' title='Defined at 12 in nt/inc/stdbool.h.'>false</a>;
<a id='L32272' name='L32272'></a> 32272 
<a id='L32273' name='L32273'></a> 32273   <a href='../D/1476.html' title='Multiple defined in 2 places.'>DEFVAR_LISP</a> ("x-auto-preserve-selections", Vx_auto_preserve_selections,
<a id='L32274' name='L32274'></a> 32274     doc: <em class='comment'>/* Whether or not to transfer selection ownership when deleting a frame.</em>
<a id='L32275' name='L32275'></a> 32275 <em class='comment'>When non-nil, deleting a frame that is currently the owner of a</em>
<a id='L32276' name='L32276'></a> 32276 <em class='comment'>selection will cause its ownership to be transferred to another frame</em>
<a id='L32277' name='L32277'></a> 32277 <em class='comment'>on the same display.</em>
<a id='L32278' name='L32278'></a> 32278 <em class='comment'></em>
<a id='L32279' name='L32279'></a> 32279 <em class='comment'>In addition, when this variable is a list, only preserve the</em>
<a id='L32280' name='L32280'></a> 32280 <em class='comment'>selections whose names are contained within.  */</em>);
<a id='L32281' name='L32281'></a> 32281   Vx_auto_preserve_selections = <a href='../S/2350.html#L2925' title='Defined at 2925 in src/alloc.c.'>list2</a> (QCLIPBOARD, QPRIMARY);
<a id='L32282' name='L32282'></a> 32282 
<a id='L32283' name='L32283'></a> 32283   <a href='../D/1476.html' title='Multiple defined in 2 places.'>DEFVAR_LISP</a> ("x-input-coding-system", Vx_input_coding_system,
<a id='L32284' name='L32284'></a> 32284     doc: <em class='comment'>/* Coding system used for input from X input methods.</em>
<a id='L32285' name='L32285'></a> 32285 <em class='comment'>If a symbol and non-nil, this is the coding system that will be used</em>
<a id='L32286' name='L32286'></a> 32286 <em class='comment'>to decode input from X input methods.  It does not affect input from</em>
<a id='L32287' name='L32287'></a> 32287 <em class='comment'>GTK native input methods enabled through `x-gtk-use-native-input'.  */</em>);
<a id='L32288' name='L32288'></a> 32288   Vx_input_coding_system = Qnil;
<a id='L32289' name='L32289'></a> 32289 
<a id='L32290' name='L32290'></a> 32290   <a href='../D/1476.html' title='Multiple defined in 2 places.'>DEFVAR_LISP</a> ("x-input-coding-function", Vx_input_coding_function,
<a id='L32291' name='L32291'></a> 32291     doc: <em class='comment'>/* Function used to determine the coding system used by input methods.</em>
<a id='L32292' name='L32292'></a> 32292 <em class='comment'>It should accept a single argument, a string describing the locale of</em>
<a id='L32293' name='L32293'></a> 32293 <em class='comment'>the input method, and return a coding system that can decode keyboard</em>
<a id='L32294' name='L32294'></a> 32294 <em class='comment'>input generated by said input method.  */</em>);
<a id='L32295' name='L32295'></a> 32295   Vx_input_coding_function = Qnil;
<a id='L32296' name='L32296'></a> 32296 
<a id='L32297' name='L32297'></a> 32297   <a href='../D/1476.html' title='Multiple defined in 2 places.'>DEFVAR_LISP</a> ("x-fast-selection-list", Vx_fast_selection_list,
<a id='L32298' name='L32298'></a> 32298     doc: <em class='comment'>/* List of selections for which `x-selection-exists-p' should be fast.</em>
<a id='L32299' name='L32299'></a> 32299 <em class='comment'></em>
<a id='L32300' name='L32300'></a> 32300 <em class='comment'>List of selection names as atoms that will be monitored by Emacs for</em>
<a id='L32301' name='L32301'></a> 32301 <em class='comment'>ownership changes when the X server supports the XFIXES extension.</em>
<a id='L32302' name='L32302'></a> 32302 <em class='comment'>The result of the monitoring is then used by `x-selection-exists-p' to</em>
<a id='L32303' name='L32303'></a> 32303 <em class='comment'>avoid a server round trip, which is important as it is called while</em>
<a id='L32304' name='L32304'></a> 32304 <em class='comment'>updating the tool bar.  The value of this variable is only read upon</em>
<a id='L32305' name='L32305'></a> 32305 <em class='comment'>connection setup.  */</em>);
<a id='L32306' name='L32306'></a> 32306   <em class='comment'>/* The default value of this variable is chosen so that updating the</em>
<a id='L32307' name='L32307'></a> 32307 <em class='comment'>     tool bar does not require a call to _XReply.  */</em>
<a id='L32308' name='L32308'></a> 32308   Vx_fast_selection_list = <a href='../S/2350.html#L2919' title='Defined at 2919 in src/alloc.c.'>list1</a> (QCLIPBOARD);
<a id='L32309' name='L32309'></a> 32309 
<a id='L32310' name='L32310'></a> 32310   <a href='../D/1476.html' title='Multiple defined in 2 places.'>DEFVAR_LISP</a> ("x-allow-focus-stealing", Vx_allow_focus_stealing,
<a id='L32311' name='L32311'></a> 32311     doc: <em class='comment'>/* How to bypass window manager focus stealing prevention.</em>
<a id='L32312' name='L32312'></a> 32312 <em class='comment'></em>
<a id='L32313' name='L32313'></a> 32313 <em class='comment'>Some window managers prevent `x-focus-frame' from activating the given</em>
<a id='L32314' name='L32314'></a> 32314 <em class='comment'>frame when Emacs is in the background, which is especially prone to</em>
<a id='L32315' name='L32315'></a> 32315 <em class='comment'>cause problems when the Emacs server wants to activate itself.</em>
<a id='L32316' name='L32316'></a> 32316 <em class='comment'></em>
<a id='L32317' name='L32317'></a> 32317 <em class='comment'>In addition, when an old-fashioned (pre-EWMH) window manager is being</em>
<a id='L32318' name='L32318'></a> 32318 <em class='comment'>run and `x-no-window-manager' is nil, the X server will not let Emacs</em>
<a id='L32319' name='L32319'></a> 32319 <em class='comment'>focus itself if another program was focused after the last time Emacs</em>
<a id='L32320' name='L32320'></a> 32320 <em class='comment'>obtained the input focus.</em>
<a id='L32321' name='L32321'></a> 32321 <em class='comment'></em>
<a id='L32322' name='L32322'></a> 32322 <em class='comment'>This variable specifies the strategy used to activate frames when that</em>
<a id='L32323' name='L32323'></a> 32323 <em class='comment'>is the case, and has several valid values (any other value means to</em>
<a id='L32324' name='L32324'></a> 32324 <em class='comment'>not bypass window manager focus stealing prevention):</em>
<a id='L32325' name='L32325'></a> 32325 <em class='comment'></em>
<a id='L32326' name='L32326'></a> 32326 <em class='comment'>  - The symbol `imitate-pager', which means to pretend that Emacs is a</em>
<a id='L32327' name='L32327'></a> 32327 <em class='comment'>    pager.</em>
<a id='L32328' name='L32328'></a> 32328 <em class='comment'></em>
<a id='L32329' name='L32329'></a> 32329 <em class='comment'>  - The symbol `newer-time', which means to fetch the current time</em>
<a id='L32330' name='L32330'></a> 32330 <em class='comment'>    from the X server and use it to activate the frame.</em>
<a id='L32331' name='L32331'></a> 32331 <em class='comment'></em>
<a id='L32332' name='L32332'></a> 32332 <em class='comment'>  - The symbol `raise-and-focus', which means to raise the window and</em>
<a id='L32333' name='L32333'></a> 32333 <em class='comment'>    focus it manually.  */</em>);
<a id='L32334' name='L32334'></a> 32334   Vx_allow_focus_stealing = Qnewer_time;
<a id='L32335' name='L32335'></a> 32335 
<a id='L32336' name='L32336'></a> 32336   <a href='../D/1476.html' title='Multiple defined in 2 places.'>DEFVAR_LISP</a> ("x-use-fast-mouse-position", Vx_use_fast_mouse_position,
<a id='L32337' name='L32337'></a> 32337     doc: <em class='comment'>/* How to make `mouse-position' faster.</em>
<a id='L32338' name='L32338'></a> 32338 <em class='comment'></em>
<a id='L32339' name='L32339'></a> 32339 <em class='comment'>`mouse-position' and `mouse-pixel-position' default to querying the X</em>
<a id='L32340' name='L32340'></a> 32340 <em class='comment'>server for the window under the mouse pointer.  This results in</em>
<a id='L32341' name='L32341'></a> 32341 <em class='comment'>accurate results, but is also very slow when the X connection has</em>
<a id='L32342' name='L32342'></a> 32342 <em class='comment'>moderate to high latency.  Setting this variable to a non-nil value</em>
<a id='L32343' name='L32343'></a> 32343 <em class='comment'>makes Emacs query only for the position of the pointer, which is</em>
<a id='L32344' name='L32344'></a> 32344 <em class='comment'>usually faster.  Doing so improves the performance of dragging to</em>
<a id='L32345' name='L32345'></a> 32345 <em class='comment'>select text over slow X connections.</em>
<a id='L32346' name='L32346'></a> 32346 <em class='comment'></em>
<a id='L32347' name='L32347'></a> 32347 <em class='comment'>If that is still too slow, setting this variable to the symbol</em>
<a id='L32348' name='L32348'></a> 32348 <em class='comment'>`really-fast' will make Emacs return only cached values.  */</em>);
<a id='L32349' name='L32349'></a> 32349   Vx_use_fast_mouse_position = Qnil;
<a id='L32350' name='L32350'></a> 32350 
<a id='L32351' name='L32351'></a> 32351   <a href='../D/1476.html' title='Multiple defined in 2 places.'>DEFVAR_LISP</a> ("x-detect-server-trust", Vx_detect_server_trust,
<a id='L32352' name='L32352'></a> 32352     doc: <em class='comment'>/* If non-nil, Emacs should detect whether or not it is trusted by X.</em>
<a id='L32353' name='L32353'></a> 32353 <em class='comment'></em>
<a id='L32354' name='L32354'></a> 32354 <em class='comment'>If non-nil, Emacs will make an X request at connection startup that is</em>
<a id='L32355' name='L32355'></a> 32355 <em class='comment'>prohibited to untrusted clients under the X Security Extension and</em>
<a id='L32356' name='L32356'></a> 32356 <em class='comment'>check whether or not a resulting Access error is generated by the X</em>
<a id='L32357' name='L32357'></a> 32357 <em class='comment'>server.  If the X server reports the error, Emacs will disable certain</em>
<a id='L32358' name='L32358'></a> 32358 <em class='comment'>features that do not work for untrusted clients.  */</em>);
<a id='L32359' name='L32359'></a> 32359   Vx_detect_server_trust = Qnil;
<a id='L32360' name='L32360'></a> 32360 
<a id='L32361' name='L32361'></a> 32361   <a href='../D/1476.html' title='Multiple defined in 2 places.'>DEFVAR_LISP</a> ("x-lax-frame-positioning", Vx_lax_frame_positioning,
<a id='L32362' name='L32362'></a> 32362     doc: <em class='comment'>/* If non-nil, Emacs won't compensate for WM geometry behavior.</em>
<a id='L32363' name='L32363'></a> 32363 <em class='comment'></em>
<a id='L32364' name='L32364'></a> 32364 <em class='comment'>Setting this to non-nil is useful when the compensation proves to be</em>
<a id='L32365' name='L32365'></a> 32365 <em class='comment'>too slow, which is usually true when the X server is located over a</em>
<a id='L32366' name='L32366'></a> 32366 <em class='comment'>network connection with high latency.  Doing so will make frame</em>
<a id='L32367' name='L32367'></a> 32367 <em class='comment'>creation and placement faster at the cost of reducing the accuracy of</em>
<a id='L32368' name='L32368'></a> 32368 <em class='comment'>frame placement via frame parameters, `set-frame-position', and</em>
<a id='L32369' name='L32369'></a> 32369 <em class='comment'>`set-frame-size', along with the actual state of a frame after</em>
<a id='L32370' name='L32370'></a> 32370 <em class='comment'>`x_make_frame_invisible'.  */</em>);
<a id='L32371' name='L32371'></a> 32371   Vx_lax_frame_positioning = Qnil;
<a id='L32372' name='L32372'></a> 32372 
<a id='L32373' name='L32373'></a> 32373   <a href='../D/1476.html' title='Multiple defined in 2 places.'>DEFVAR_LISP</a> ("x-quit-keysym", Vx_quit_keysym,
<a id='L32374' name='L32374'></a> 32374     doc: <em class='comment'>/* Keysyms which will cause Emacs to quit if rapidly pressed twice.</em>
<a id='L32375' name='L32375'></a> 32375 <em class='comment'></em>
<a id='L32376' name='L32376'></a> 32376 <em class='comment'>This is used to support quitting on devices that do not have any kind</em>
<a id='L32377' name='L32377'></a> 32377 <em class='comment'>of physical keyboard, or where the physical keyboard is incapable of</em>
<a id='L32378' name='L32378'></a> 32378 <em class='comment'>entering `C-g'.  It defaults to `XF86XK_AudioLowerVolume' on XFree86</em>
<a id='L32379' name='L32379'></a> 32379 <em class='comment'>and X.Org servers, and is unset.</em>
<a id='L32380' name='L32380'></a> 32380 <em class='comment'></em>
<a id='L32381' name='L32381'></a> 32381 <em class='comment'>The value is an alist associating between strings, describing X server</em>
<a id='L32382' name='L32382'></a> 32382 <em class='comment'>vendor names, and a single number describing the keysym to use.  The</em>
<a id='L32383' name='L32383'></a> 32383 <em class='comment'>keysym to use for each display connection is determined upon</em>
<a id='L32384' name='L32384'></a> 32384 <em class='comment'>connection setup, and does not reflect further changes to this</em>
<a id='L32385' name='L32385'></a> 32385 <em class='comment'>variable.  */</em>);
<a id='L32386' name='L32386'></a> 32386   Vx_quit_keysym
<a id='L32387' name='L32387'></a> 32387     = <a href='../S/2350.html#L2925' title='Defined at 2925 in src/alloc.c.'>list2</a> (Fcons (<a href='../D/9420.html' title='Multiple defined in 2 places.'>build_string</a> ("The X.Org Foundation"),
<a id='L32388' name='L32388'></a> 32388                     <a href='../S/2267.html#L2802' title='Defined at 2802 in src/lisp.h.'>make_int</a> (269025041)),
<a id='L32389' name='L32389'></a> 32389              Fcons (<a href='../D/9420.html' title='Multiple defined in 2 places.'>build_string</a> ("The XFree86 Project, Inc."),
<a id='L32390' name='L32390'></a> 32390                     <a href='../S/2267.html#L2802' title='Defined at 2802 in src/lisp.h.'>make_int</a> (269025041)));
<a id='L32391' name='L32391'></a> 32391 <em class='brace'>}</em>
</pre>
<hr />
<a id='BOTTOM' name='BOTTOM'></a>
<em class='comment'>/* [&lt;][&gt;]<a href='#L900'>[^]</a><a href='#L12428'>[v]</a><a href='#TOP'>[top]</a>[bottom]<a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</em>
</body>
</html>
