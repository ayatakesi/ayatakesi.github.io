<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 26.3.

Copyright (C) 1990-1996, 1998-2019 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.3 or any later
version published by the Free Software Foundation; with the Invariant
Sections being "GNU General Public License," with the Front-Cover Texts
being "A GNU Manual," and with the Back-Cover Texts as in (a) below.  A
copy of the license is included in the section entitled "GNU Free
Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and modify
this GNU manual.  Buying copies from the FSF supports it in developing GNU
and promoting software freedom." -->
<!-- Created by GNU Texinfo 6.6, http://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Asynchronous Processes (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Asynchronous Processes (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Asynchronous Processes (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Index.html#Index" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Processes.html#Processes" rel="up" title="Processes">
<link href="Deleting-Processes.html#Deleting-Processes" rel="next" title="Deleting Processes">
<link href="Synchronous-Processes.html#Synchronous-Processes" rel="prev" title="Synchronous Processes">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="en">
<span id="Asynchronous-Processes"></span><div class="header">
<p>
Next: <a href="Deleting-Processes.html#Deleting-Processes" accesskey="n" rel="next">Deleting Processes</a>, Previous: <a href="Synchronous-Processes.html#Synchronous-Processes" accesskey="p" rel="prev">Synchronous Processes</a>, Up: <a href="Processes.html#Processes" accesskey="u" rel="up">Processes</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html#Index" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="Fei-Tong-Qi-purosesunoZuo-Cheng-"></span><h3 class="section">38.4 非同期プロセスの作成</h3>
<span id="index-asynchronous-subprocess"></span>

<p>In this section, we describe how to create an <em>asynchronous process</em>.
After an asynchronous process is created, it runs in parallel with Emacs,
and Emacs can communicate with it using the functions described in the
following sections (see <a href="Input-to-Processes.html#Input-to-Processes">Input to Processes</a>, and see <a href="Output-from-Processes.html#Output-from-Processes">Output from Processes</a>).  Note that process communication is only partially
asynchronous: Emacs sends and receives data to and from a process only when
those functions are called.
</p>
<span id="index-pty_002c-when-to-use-for-subprocess-communications"></span>
<span id="index-pipe_002c-when-to-use-for-subprocess-communications"></span>
<p>An asynchronous process is controlled either via a <em>pty</em>
(pseudo-terminal) or a <em>pipe</em>.  The choice of pty or pipe is made when
creating the process, by default based on the value of the variable
<code>process-connection-type</code> (see below).  If available, ptys are usually
preferable for processes visible to the user, as in Shell mode, because they
allow for job control (<kbd>C-c</kbd>, <kbd>C-z</kbd>, etc.) between the process and
its children, and because interactive programs treat ptys as terminal
devices, whereas pipes don&rsquo;t support these features.  However, for
subprocesses used by Lisp programs for internal purposes (i.e., no user
interaction with the subprocess is required), where significant amounts of
data need to be exchanged between the subprocess and the Lisp program, it is
often better to use a pipe, because pipes are more efficient.  Also, the
total number of ptys is limited on many systems, and it is good not to waste
them unnecessarily.
</p>
<dl>
<dt id="index-make_002dprocess">Function: <strong>make-process</strong> <em>&amp;rest args</em></dt>
<dd><p>この関数は非同期サブプロセスを開始するための基本的な低レベルなプリミティブである。これはサブプロセスを表すプロセスオブジェクトをリターンする。以下で説明するより高レベルな<code>start-process</code>と比較すると、この関数はキーワード引数を受け取り、より柔軟であり、単独の呼び出しでプロセスフィルターやセンチネルを指定できる。
</p>
<p>引数<var>args</var>はkeyword/argumentペアのリスト。キーワードの省略は値<code>nil</code>でそれを指定することと常に等価。以下は意味のあるキーワード:
</p>
<dl compact="compact">
<dt>:name <var>name</var></dt>
<dd><p>プロセス名として文字列<var>name</var>を使用する。その名前のプロセスがすでに存在すれば、(&lsquo;<samp>&lt;1&gt;</samp>&rsquo;、...の追加により)一意となるように<var>name</var>を修正する。
</p>
</dd>
<dt>:buffer <var>buffer</var></dt>
<dd><p>プロセスバッファーとして<var>buffer</var>を使用する。値が<code>nil</code>なら、そのサブプロセスには何のバッファーも関連付けられない。
</p>
</dd>
<dt>:command <var>command</var></dt>
<dd><p>プロセスのコマドラインとして<var>command</var>を使用する。値はプログラムの実行可能ファイル名で始まり、後にプログラムの引数として与える文字列が続くリストであること。リストの最初の要素が<code>nil</code>なら、Emacsは新たな擬似端末(pty)を作成して、実際には何もプログラムを実行せずに入出力を<var>buffer</var>に関連付ける。この場合には残りのリスト要素は無視される。
</p>
</dd>
<dt>:coding <var>coding</var></dt>
<dd><p><var>coding</var>がシンボルなら、それはその接続にたいする読み取りと書き込みの両方で使用するコーディングシステムを指定する。<var>coding</var>がコンスセル<code>(<var>decoding</var>&nbsp;.&nbsp;<var>encoding</var>)</code><!-- /@w -->なら読み取りに<var>decoding</var>、書き込みに<var>encoding</var>が使用される。プログラムに書き込むデータのエンコーディングに使用されるコーディングシステムは、コマンドライン引数のエンコーディングにも使用される(しかしプログラム自身にたいしてファイル名を別のファイル名にエンコードすることはない。<a href="Encoding-and-I_002fO.html#Encoding-and-I_002fO">file-name-coding-system</a>を参照)。
</p>
<p><var>coding</var>が<code>nil</code>なら、デフォルトのコーディングシステム検出ルールを適用する。<a href="Default-Coding-Systems.html#Default-Coding-Systems">Default Coding Systems</a>を参照のこと。
</p>
</dd>
<dt>:connection-type <var>type</var></dt>
<dd><p>Initialize the type of device used to communicate with the subprocess.
Possible values are <code>pty</code> to use a pty, <code>pipe</code> to use a pipe, or
<code>nil</code> to use the default derived from the value of the
<code>process-connection-type</code> variable.  This parameter and the value of
<code>process-connection-type</code> are ignored if a non-<code>nil</code> value is
specified for the <code>:stderr</code> parameter; in that case, the type will
always be <code>pipe</code>.  On systems where ptys are not available
(MS-Windows), this parameter is likewise ignored, and pipes are used
unconditionally.
</p>
</dd>
<dt>:noquery <var>query-flag</var></dt>
<dd><p>プロセスqueryフラグを<var>query-flag</var>に初期化する。<a href="Query-Before-Exit.html#Query-Before-Exit">Query Before Exit</a>を参照のこと。
</p>
</dd>
<dt>:stop <var>stopped</var></dt>
<dd><p><var>stopped</var>が非<code>nil</code>なら、停止状態でプロセスを開始する。
</p>
</dd>
<dt>:filter <var>filter</var></dt>
<dd><p>プロセスフィルターを<var>filter</var>に初期化する。未指定ならデフォルトフィルターが提供されるが、これは後からオーバーライドできる。<a href="Filter-Functions.html#Filter-Functions">Filter Functions</a>を参照のこと。
</p>
</dd>
<dt>:sentinel <var>sentinel</var></dt>
<dd><p>プロセスセンチネルを<var>sentinel</var>に初期化する。未指定ならデフォルトセンチネルが使用されるが、これは後からオーバーライドできる。<a href="Sentinels.html#Sentinels">Sentinels</a>を参照のこと。
</p>
</dd>
<dt>:stderr <var>stderr</var></dt>
<dd><p>プロセスの標準エラーに<var>stderr</var>を割り当てる。値が非<code>nil</code>ならバッファー、または以下で説明する<code>make-pipe-process</code>で作成されたpipeのいずれかであること。
</p></dd>
</dl>

<p>実際の接続情報で修正されたオリジナルの引数リストは<code>process-contact</code>を通じて利用できる。
</p>
<p>The current working directory of the subprocess is set to the current
buffer&rsquo;s value of <code>default-directory</code> if that is local (as determined
by &lsquo;unhandled-file-name-directory&rsquo;), or &quot;~&quot; otherwise.  If you want to run a
process in a remote directory use <code>start-file-process</code>.
</p></dd></dl>

<dl>
<dt id="index-make_002dpipe_002dprocess">Function: <strong>make-pipe-process</strong> <em>&amp;rest args</em></dt>
<dd><p>この関数は子プロセスにアタッチ可能な双方向のpipeを作成する。これは<code>make-process</code>の<code>:stderr</code>キーワードと併用することで有用。この関数はプロセスオブジェクトをリターンする。
</p>
<p>引数<var>args</var>はkeyword/argumentペアのリスト。キーワードの省略はそのキーワードに値<code>nil</code>を指定することと常に等価。
</p>
<p>以下は意味のあるキーワード。
</p>
<dl compact="compact">
<dt>:name <var>name</var></dt>
<dd><p>プロセス名として文字列<var>name</var>を使用する。<code>make-process</code>の場合のように、一意にするために必要に応じて変更され得る。
</p>
</dd>
<dt>:buffer <var>buffer</var></dt>
<dd><p>プロセスバッファーとして<var>buffer</var>を使用する。
</p>
</dd>
<dt>:coding <var>coding</var></dt>
<dd><p><var>coding</var>がシンボルなら、それはその接続にたいする読み取りと書き込みの両方で使用するコーディングシステムを指定する。<var>coding</var>がコンスセル<code>(<var>decoding</var>&nbsp;.&nbsp;<var>encoding</var>)</code><!-- /@w -->なら読み取りに<var>decoding</var>、書き込みに<var>encoding</var>が使用される。
</p>
<p><var>coding</var>が<code>nil</code>なら、デフォルトのコーディングシステム検出ルールを適用する。<a href="Default-Coding-Systems.html#Default-Coding-Systems">Default Coding Systems</a>を参照のこと。
</p>
</dd>
<dt>:noquery <var>query-flag</var></dt>
<dd><p>プロセスqueryフラグを<var>query-flag</var>に初期化する。<a href="Query-Before-Exit.html#Query-Before-Exit">Query Before Exit</a>を参照のこと。
</p>
</dd>
<dt>:stop <var>stopped</var></dt>
<dd><p>If <var>stopped</var> is non-<code>nil</code>, start the process in the stopped state.
In the stopped state, a pipe process does not accept incoming data, but you
can send outgoing data.  The stopped state is set by <code>stop-process</code> and
cleared by <code>continue-process</code> (see <a href="Signals-to-Processes.html#Signals-to-Processes">Signals to Processes</a>).
</p>
</dd>
<dt>:filter <var>filter</var></dt>
<dd><p>プロセスフィルターを<var>filter</var>に初期化する。未指定ならデフォルトフィルターが提供されるが後で変更できる。<a href="Filter-Functions.html#Filter-Functions">Filter Functions</a>を参照のこと。
</p>
</dd>
<dt>:sentinel <var>sentinel</var></dt>
<dd><p>プロセスセンチネルを<var>sentinel</var>に初期化する。未指定ならデフォルトセンチネルが使用されるが後で変更できる。<a href="Sentinels.html#Sentinels">Sentinels</a>を参照のこと。
</p></dd>
</dl>

<p>実際の接続情報で修正されたオリジナルの引数リストは<code>process-contact</code>を通じて利用できる。
</p></dd></dl>

<dl>
<dt id="index-start_002dprocess">Function: <strong>start-process</strong> <em>name buffer-or-name program &amp;rest args</em></dt>
<dd><p>この関数は<code>call-process</code>の類似したインターフェースを提供する、<code>make-process</code>周辺の高レベルのラッパー。これは新たに非同期サブプロセスを作成して、指定された<var>program</var>の実行をその内部で開始する。これはLispで新たなサブプロセスを意味するプロセスオブジェクトをリターンする。引数<var>name</var>はプロセスオブジェクトの名前を指定する。<code>make-process</code>の場合のように、一意な名前となるように必要に応じて修正する。バッファー<var>buffer-or-name</var>はそのプロセスに関連付けるバッファー。
</p>
<p><var>program</var>が<code>nil</code>ならEmacsは疑似端末(pty)を新たにオープンして、サブプロセスを新たに作成することなくptyの入力と出力を<var>buffer-or-name</var>に関連付ける。この場合には残りの引数<var>args</var>は無視される。
</p>
<p>残りの<var>args</var>はサブプロセスにコマンドライン引数を指定する文字列。
</p>
<p>以下の例では1つ目のプロセスを開始して100秒間実行(というよりはsleep)される。その間に2つ目のプロセスを開始して、一意性を保つために&lsquo;<samp>my-process&lt;1&gt;</samp>&rsquo;という名前が与えられる。これは1つ目のプロセスが終了する前にバッファー&lsquo;<samp>foo</samp>&rsquo;の最後にディレクトリーのリストを挿入する。その後に2つ目のプロセスは終了して、その旨のメッセージがバッファーに挿入される。さらに遅れて1つ目のプロセスが終了して、バッファーに別のメッセージが挿入される。
</p>
<div class="example">
<pre class="example">(start-process &quot;my-process&quot; &quot;foo&quot; &quot;sleep&quot; &quot;100&quot;)
     &rArr; #&lt;process my-process&gt;
</pre><pre class="example">

</pre><pre class="example">(start-process &quot;my-process&quot; &quot;foo&quot; &quot;ls&quot; &quot;-l&quot; &quot;/bin&quot;)
     &rArr; #&lt;process my-process&lt;1&gt;&gt;

---------- Buffer: foo ----------
total 8336
-rwxr-xr-x 1 root root 971384 Mar 30 10:14 bash
-rwxr-xr-x 1 root root 146920 Jul  5  2011 bsd-csh
&hellip;
-rwxr-xr-x 1 root root 696880 Feb 28 15:55 zsh4

Process my-process&lt;1&gt; finished

Process my-process finished
---------- Buffer: foo ----------
</pre></div>
</dd></dl>

<dl>
<dt id="index-start_002dfile_002dprocess">Function: <strong>start-file-process</strong> <em>name buffer-or-name program &amp;rest args</em></dt>
<dd><p><code>start-process</code>と同じようにこの関数は非同期サブプロセスを開始して、その内部で<var>program</var>を実行してそのプロセスオブジェクトをリターンする。
</p>
<p><code>start-process</code>との違いは、この関数が<code>default-directory</code>の値にもとづいてファイルハンドラーを呼び出すかもしれないという点である。このハンドラーはローカルホスト上、あるいは<code>default-directory</code>に応じたリモートホスト上で<var>program</var>を実行すること。後者の場合には、<code>default-directory</code>のローカル部分はそのプロセスのワーキングディレクトリーになる。
</p>
<p>This function does not try to invoke file name handlers for <var>program</var> or
for the rest of <var>args</var>.  For that reason, if <var>program</var> or any of
<var>args</var> use the remote-file syntax (see <a href="Magic-File-Names.html#Magic-File-Names">Magic File Names</a>), they must
be converted either to file names relative to <code>default-directory</code>, or
to names that identify the files locally on the remote host, by running them
through <code>file-local-name</code>.
</p>
<p>そのファイルハンドラーの実装によっては、リターン結果のプロセスオブジェクトに<code>process-filter</code>や<code>process-sentinel</code>を適用することができないかもしれない。<a href="Filter-Functions.html#Filter-Functions">Filter Functions</a>と<a href="Sentinels.html#Sentinels">Sentinels</a>を参照のこと。
</p>
<p>いくつかのファイルハンドラーは<code>start-file-process</code>をサポートしないかもしれない(たとえば<code>ange-ftp-hook-function</code>関数)。そのような場合には、この関数は何も行わずに<code>nil</code>をリターンする。
</p></dd></dl>

<dl>
<dt id="index-start_002dprocess_002dshell_002dcommand">Function: <strong>start-process-shell-command</strong> <em>name buffer-or-name command</em></dt>
<dd><p>この関数は<code>start-process</code>と同様だが、指定された<var>command</var>の実行にshellを使用する点が異なる。引数<var>command</var>はshellコマンド文字列。変数<code>shell-file-name</code>はどのshellを使用するかを指定する。
</p>
<p><code>make-process</code>や<code>start-process</code>でプログラムを実行せずにshellを通じて実行することの要点は、引数内のワイルドカード展開のようなshell機能を利用可能にするためである。そのためにはコマンド内に任意のユーザー指定引数を含めるなら、任意の特別なshell文字がshellでの特別な意味を<em>もたない</em>ように、まず<code>shell-quote-argument</code>でそれらをクォートするべきである。<a href="Shell-Arguments.html#Shell-Arguments">Shell Arguments</a>を参照のこと。ユーザー入力にもとづいたコマンド実行時には当然セキュリティ上の影響も考慮するべきである。
</p></dd></dl>

<dl>
<dt id="index-start_002dfile_002dprocess_002dshell_002dcommand">Function: <strong>start-file-process-shell-command</strong> <em>name buffer-or-name command</em></dt>
<dd><p>この関数は<code>start-process-shell-command</code>と似ているが、内部的に<code>start-file-process</code>を使用する点が異なる。これにより<code>default-directory</code>に応じてリモートホスト上でも<var>command</var>を実行できる。
</p></dd></dl>

<dl>
<dt id="index-process_002dconnection_002dtype">Variable: <strong>process-connection-type</strong></dt>
<dd><p>この変数は非同期サブプロセスと対話するために使用するデバイスタイプを制御する。これが非<code>nil</code>の場合には利用可能ならpty、それ以外ならpipeが使用される。
</p>
<p><code>process-connection-type</code>の値は<code>make-process</code>や<code>start-process</code>の呼び出し時に効果を発揮する。そのためにこれらの関数の呼び出し前後でこの変数をバインドすることにより、サブプロセスとやり取りする方法を指定できる。
</p>
<p>Note that the value of this variable is ignored when <code>make-process</code> is
called with a non-<code>nil</code> value of the <code>:stderr</code> parameter; in that
case, Emacs will communicate with the process using pipes.  It is also
ignored if ptys are unavailable (MS-Windows).
</p>
<div class="example">
<pre class="example">(let ((process-connection-type nil))  ; <span class="roman">pipeを使用</span>
  (start-process &hellip;))
</pre></div>

<p>与えられたサブプロセスが実際にはpipeとptyのどちらを取得したかを判断するには関数<code>process-tty-name</code>を使用する(<a href="Process-Information.html#Process-Information">Process Information</a>を参照)。
</p></dd></dl>

<hr>
<div class="header">
<p>
Next: <a href="Deleting-Processes.html#Deleting-Processes" accesskey="n" rel="next">Deleting Processes</a>, Previous: <a href="Synchronous-Processes.html#Synchronous-Processes" accesskey="p" rel="prev">Synchronous Processes</a>, Up: <a href="Processes.html#Processes" accesskey="u" rel="up">Processes</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html#Index" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
