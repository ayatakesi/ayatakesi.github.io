<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 26.1.

Copyright (C) 1990-1996, 1998-2018 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.3 or any later
version published by the Free Software Foundation; with the Invariant
Sections being "GNU General Public License," with the Front-Cover Texts
being "A GNU Manual," and with the Back-Cover Texts as in (a) below.  A
copy of the license is included in the section entitled "GNU Free
Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and modify
this GNU manual.  Buying copies from the FSF supports it in developing GNU
and promoting software freedom." -->
<!-- Created by GNU Texinfo 6.6, http://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Changing Files (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Changing Files (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Changing Files (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Index.html#Index" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Files.html#Files" rel="up" title="Files">
<link href="Files-and-Storage.html#Files-and-Storage" rel="next" title="Files and Storage">
<link href="Locating-Files.html#Locating-Files" rel="prev" title="Locating Files">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="en">
<span id="Changing-Files"></span><div class="header">
<p>
Next: <a href="Files-and-Storage.html#Files-and-Storage" accesskey="n" rel="next">Files and Storage</a>, Previous: <a href="Information-about-Files.html#Information-about-Files" accesskey="p" rel="prev">Information about Files</a>, Up: <a href="Files.html#Files" accesskey="u" rel="up">Files</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html#Index" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="huairunoMing-Qian-toShu-Xing-noBian-Geng-"></span><h3 class="section">25.7 ファイルの名前と属性の変更</h3>
<span id="index-copying-files"></span>
<span id="index-deleting-files"></span>
<span id="index-linking-files"></span>
<span id="index-setting-modes-of-files"></span>

<p>The functions in this section rename, copy, delete, link, and set the modes
(permissions) of files.  Typically, they signal a <code>file-error</code> error if
they fail to perform their function, reporting the system-dependent error
message that describes the reason for the failure.  If they fail because a
file is missing, they signal a <code>file-missing</code> error instead.
</p>
<p>For performance, the operating system may cache or alias changes made by
these functions instead of writing them immediately to secondary storage.
See <a href="Files-and-Storage.html#Files-and-Storage">Files and Storage</a>.
</p>
<p>In the functions that have an argument <var>newname</var>, if this argument is a
directory name it is treated as if the nondirectory part of the source name
were appended.  Typically, a directory name is one that ends in &lsquo;<samp>/</samp>&rsquo;
(see <a href="Directory-Names.html#Directory-Names">Directory Names</a>).  For example, if the old name is <samp>a/b/c</samp>,
the <var>newname</var> <samp>d/e/f/</samp> is treated as if it were <samp>d/e/f/c</samp>.
This special treatment does not apply if <var>newname</var> is not a directory
name but names a file that is a directory; for example, the <var>newname</var>
<samp>d/e/f</samp> is left as-is even if <samp>d/e/f</samp> happens to be a directory.
</p>
<p><var>newname</var>という引数をもつ関数では、<var>newname</var>という名前のファイルが既に存在する場合の振る舞いは、引数<var>ok-if-already-exists</var>の値に依存します。
</p>
<ul>
<li> <var>ok-if-already-exists</var>が<code>nil</code>の場合は、<code>file-already-exists</code>エラーがシグナルされる。

</li><li> <var>ok-if-already-exists</var>が数字の場合は、確認を求める。

</li><li> <var>ok-if-already-exists</var>が他の値の場合は、確認なしで古いファイルを置き換える。
</li></ul>

<dl>
<dt id="index-add_002dname_002dto_002dfile">Command: <strong>add-name-to-file</strong> <em>oldname newname &amp;optional ok-if-already-exists</em></dt>
<dd><span id="index-file-with-multiple-names"></span>
<span id="index-file-hard-link"></span>
<p>This function gives the file named <var>oldname</var> the additional name
<var>newname</var>.  This means that <var>newname</var> becomes a new hard link to
<var>oldname</var>.
</p>
<p>If <var>newname</var> is a symbolic link, its directory entry is replaced, not
the directory entry it points to.  If <var>oldname</var> is a symbolic link, this
function might or might not follow the link; it does not follow the link on
GNU platforms.  If <var>oldname</var> is a directory, this function typically
fails, although for the superuser on a few old-fashioned non-GNU platforms
it can succeed and create a filesystem that is not tree-structured.
</p>
<p>以下の例の最初の部分として、2つのファイル<samp>foo</samp>と<samp>foo3</samp>をリストする。
</p>
<div class="example">
<pre class="example">$ ls -li fo*
81908 -rw-rw-rw- 1 rms rms 29 Aug 18 20:32 foo
84302 -rw-rw-rw- 1 rms rms 24 Aug 18 20:31 foo3
</pre></div>

<p>ここで、<code>add-name-to-file</code>を呼び出してハードリンクを作成し、再度ファイルをリストする。このリストには、1つのファイルにたいして2つの名前<samp>foo</samp>と<samp>foo2</samp>が表示される。
</p>
<div class="example">
<pre class="example">(add-name-to-file &quot;foo&quot; &quot;foo2&quot;)
     &rArr; nil
</pre><pre class="example">

</pre><pre class="example">$ ls -li fo*
81908 -rw-rw-rw- 2 rms rms 29 Aug 18 20:32 foo
81908 -rw-rw-rw- 2 rms rms 29 Aug 18 20:32 foo2
84302 -rw-rw-rw- 1 rms rms 24 Aug 18 20:31 foo3
</pre></div>

<p>最後に以下を評価する:
</p>
<div class="example">
<pre class="example">(add-name-to-file &quot;foo&quot; &quot;foo3&quot; t)
</pre></div>

<p>そして、ファイルを再度リストする。今度は1つのファイルにたいして3つの名前<samp>foo</samp>、<samp>foo2</samp>、<samp>foo3</samp>がある。<samp>foo3</samp>の古いコンテンツは失われた。
</p>
<div class="example">
<pre class="example">(add-name-to-file &quot;foo1&quot; &quot;foo3&quot;)
     &rArr; nil
</pre><pre class="example">

</pre><pre class="example">$ ls -li fo*
81908 -rw-rw-rw- 3 rms rms 29 Aug 18 20:32 foo
81908 -rw-rw-rw- 3 rms rms 29 Aug 18 20:32 foo2
81908 -rw-rw-rw- 3 rms rms 29 Aug 18 20:32 foo3
</pre></div>

<p>この関数は、1つのファイルにたいして複数の名前をもつことが許されないオペレーティングシステムでは無意味である。いくつかのシステムでは、かわりにファイルをコピーすることにより複数の名前を実装している。
</p>
<p><a href="File-Attributes.html#File-Attributes">File Attributes</a>の<code>file-nlinks</code>も参照のこと。
</p></dd></dl>

<dl>
<dt id="index-rename_002dfile">Command: <strong>rename-file</strong> <em>filename newname &amp;optional ok-if-already-exists</em></dt>
<dd><p>このコマンドは、<var>filename</var>を<var>newname</var>にリネームする。
</p>
<p>If <var>filename</var> has additional names aside from <var>filename</var>, it
continues to have those names.  In fact, adding the name <var>newname</var> with
<code>add-name-to-file</code> and then deleting <var>filename</var> has the same effect
as renaming, aside from momentary intermediate states and treatment of
errors, directories and symbolic links.
</p>
<p>This command does not follow symbolic links.  If <var>filename</var> is a
symbolic link, this command renames the symbolic link, not the file it
points to.  If <var>newname</var> is a symbolic link, its directory entry is
replaced, not the directory entry it points to.
</p>
<p>This command does nothing if <var>filename</var> and <var>newname</var> are the same
directory entry, i.e., if they refer to the same parent directory and give
the same name within that directory.  Otherwise, if <var>filename</var> and
<var>newname</var> name the same file, this command does nothing on
POSIX-conforming systems, and removes <var>filename</var> on some non-POSIX
systems.
</p>
<p>If <var>newname</var> exists, then it must be an empty directory if <var>oldname</var>
is a directory and a non-directory otherwise.
</p></dd></dl>

<dl>
<dt id="index-copy_002dfile">Command: <strong>copy-file</strong> <em>oldname newname &amp;optional ok-if-already-exists time preserve-uid-gid preserve-extended-attributes</em></dt>
<dd><p>This command copies the file <var>oldname</var> to <var>newname</var>.  An error is
signaled if <var>oldname</var> is not a regular file.  If <var>newname</var> names a
directory, it copies <var>oldname</var> into that directory, preserving its final
name component.
</p>
<p>This function follows symbolic links, except that it does not follow a
dangling symbolic link to create <var>newname</var>.
</p>
<p><var>time</var>が非<code>nil</code>の場合、この関数は新たなファイルにたいして、古いファイルと同じ最終変更時刻を与える(これはいくつかの限られたオペレーティングシステムでのみ機能する)。時刻のセットでエラーが発生した場合、<code>copy-file</code>は<code>file-date-error</code>エラーをシグナルする。インタラクティブに呼び出された場合、プレフィックス引数は<var>time</var>にたいして非<code>nil</code>値を指定する。
</p>
<p>引数<var>preserve-uid-gid</var>が<code>nil</code>の場合は、新たなファイルのユーザーおよびグループの所有権の決定を、オペレーティングシステムに委ねる(通常はEmacsを実行中のユーザーである)。<var>preserve-uid-gid</var>が非<code>nil</code>の場合は、そのファイルのユーザーとグループの所有権のコピーを試みる。これはいくつかのオペレーティングシステムで、かつそれを行うための正しいパーミッションをもつ場合のみ機能する。
</p>
<p>オプション引数<var>preserve-permissions</var>が非<code>nil</code>の場合、この関数は<var>oldname</var>のファイルモード(または&ldquo;パーミッション&rdquo;)、同様にACL(Access
Control List)とSELinuxコンテキストを<var>newname</var>にコピーする。<a href="Information-about-Files.html#Information-about-Files">Information about Files</a>を参照のこと。
</p>
<p>それ以外では、<var>newname</var>が既存ファイルならファイルモードは変更されず、新たに作成された場合はデフォルトのファイルパーミッション(以下の<code>set-default-file-modes</code>を参照)によりマスクされる。どちらの場合も、ACLまたはSELinuxコンテキストはコピーされない。
</p></dd></dl>

<dl>
<dt id="index-make_002dsymbolic_002dlink">Command: <strong>make-symbolic-link</strong> <em>target newname &amp;optional ok-if-already-exists</em></dt>
<dd><span id="index-ln"></span>
<span id="index-file_002dalready_002dexists"></span>
<p>This command makes a symbolic link to <var>target</var>, named <var>newname</var>.
This is like the shell command &lsquo;<samp>ln -s <var>target</var> <var>newname</var></samp>&rsquo;.  The
<var>target</var> argument is treated only as a string; it need not name an
existing file.  If <var>ok-if-already-exists</var> is an integer, indicating
interactive use, then leading &lsquo;<samp>~</samp>&rsquo; is expanded and leading &lsquo;<samp>/:</samp>&rsquo; is
stripped in the <var>target</var> string.
</p>
<p>If <var>target</var> is a relative file name, the resulting symbolic link is
interpreted relative to the directory containing the symbolic link.
See <a href="Relative-File-Names.html#Relative-File-Names">Relative File Names</a>.
</p>
<p>If both <var>target</var> and <var>newname</var> have remote file name syntax, and if
both remote identifications are equal, the symbolic link points to the local
file name part of <var>target</var>.
</p>
<p>この関数は、シンボリックリンクをサポートしないシステムでは利用できない。
</p></dd></dl>

<span id="index-trash"></span>
<span id="index-delete_002dby_002dmoving_002dto_002dtrash"></span>
<dl>
<dt id="index-delete_002dfile">Command: <strong>delete-file</strong> <em>filename &amp;optional trash</em></dt>
<dd><span id="index-rm"></span>
<p>This command deletes the file <var>filename</var>.  If the file has multiple
names, it continues to exist under the other names.  If <var>filename</var> is a
symbolic link, <code>delete-file</code> deletes only the symbolic link and not its
target.
</p>
<p>A suitable kind of <code>file-error</code> error is signaled if the file does not
exist, or is not deletable.  (On GNU and other POSIX-like systems, a file is
deletable if its directory is writable.)
</p>
<p>オプション引数<var>trash</var>が非<code>nil</code>、かつ変数<code>delete-by-moving-to-trash</code>が非<code>nil</code>の場合、このコマンドはファイルを削除するかわりに、システムのTrash(ゴミ箱)にファイルを移動する。<a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Misc-File-Ops.html#Misc-File-Ops">Miscellaneous File Operations</a> in <cite>The GNU Emacs
Manual</cite>を参照のこと。インタラクティブに呼び出された際は、プレフィックス引数がない場合<var>trash</var>は<code>t</code>、それ以外は<code>nil</code>である。
</p>
<p><a href="Create_002fDelete-Dirs.html#Create_002fDelete-Dirs">Create/Delete Dirs</a>の<code>delete-directory</code>も参照のこと。
</p></dd></dl>

<span id="index-file-permissions_002c-setting"></span>
<span id="index-permissions_002c-file-1"></span>
<span id="index-file-modes_002c-setting"></span>
<dl>
<dt id="index-set_002dfile_002dmodes">Command: <strong>set-file-modes</strong> <em>filename mode</em></dt>
<dd><p>This function sets the <em>file mode</em> (or <em>permissions</em>) of
<var>filename</var> to <var>mode</var>.  This function follows symbolic links.
</p>
<p>非インタラクティブに呼び出された場合、<var>mode</var>は整数でなければならない。その整数の下位12ビットだけが使用される。ほとんどのシステムでは、意味があるのは下位9ビットだけである。<var>mode</var>を入力刷る、Lisp構文を使用できる。たとえば、
</p>
<div class="example">
<pre class="example">(set-file-modes #o644)
</pre></div>

<p>これは、そのファイルが所有者により読み取りと書き込み、グループメンバーにより読み取り、その他のユーザーにより読み取り可能であることを指定する。モードビットの仕様の説明は、<a href="https://www.gnu.org/software/coreutils/manual/html_node/File-permissions.html#File-permissions">File
permissions</a> in <cite>The <small>GNU</small> <code>Coreutils</code> Manual</cite>を参照のこと。
</p>
<p>インタラクティブに呼び出された場合、<var>mode</var>は<code>read-file-modes</code>(以下参照)を使用してミニバッファーから読み取られる。この場合、ユーザーは整数、またはパーミッションをシンボルで表現する文字列をタイプできる。
</p>
<p>ファイルのパーミッションをリターンする関数<code>file-modes</code>については、<a href="File-Attributes.html#File-Attributes">File Attributes</a>を参照のこと。
</p></dd></dl>

<dl>
<dt id="index-set_002ddefault_002dfile_002dmodes">Function: <strong>set-default-file-modes</strong> <em>mode</em></dt>
<dd><span id="index-umask"></span>
<p>This function sets the default permissions for new files created by Emacs
and its subprocesses.  Every file created with Emacs initially has these
permissions, or a subset of them (<code>write-region</code> will not grant execute
permissions even if the default file permissions allow execution).  On GNU
and other POSIX-like systems, the default permissions are given by the
bitwise complement of the &lsquo;<samp>umask</samp>&rsquo; value, i.e. each bit that is set in
the argument <var>mode</var> will be <em>reset</em> in the default permissions with
which Emacs creates files.
</p>
<p>引数<var>mode</var>は上記の<code>set-file-modes</code>と同様、パーミッションを指定する整数であること。下位9ビットだけに意味がある。
</p>
<p>デフォルトのファイルパーミッションは、既存ファイルの変更されたバージョンを保存する際は効果がない。ファイルの保存では、既存のパーミッションが保持される。
</p></dd></dl>

<dl>
<dt id="index-with_002dfile_002dmodes">Macro: <strong>with-file-modes</strong> <em>mode body&hellip;</em></dt>
<dd><p>This macro evaluates the <var>body</var> forms with the default permissions for
new files temporarily set to <var>modes</var> (whose value is as for
<code>set-file-modes</code> above).  When finished, it restores the original
default file permissions, and returns the value of the last form in
<var>body</var>.
</p>
<p>This is useful for creating private files, for example.
</p></dd></dl>

<dl>
<dt id="index-default_002dfile_002dmodes">Function: <strong>default-file-modes</strong></dt>
<dd><p>この関数は、デフォルトのファイルモードを整数でリターンする。
</p></dd></dl>

<dl>
<dt id="index-read_002dfile_002dmodes">Function: <strong>read-file-modes</strong> <em>&amp;optional prompt base-file</em></dt>
<dd><p>この関数は、ミニバッファーからファイルモードビットのセットを読み取る。1つ目のオプション引数<var>prompt</var>は非デフォルトのプロンプトを指定する。2つ目のオプション引数<var>base-file</var>は、ユーザーが既存ファイルのパーミッションに相対的なモードビット指定をタイプした場合に、この関数がリターンするモードビッの元となる権限をもつファイルの名前を指定する。
</p>
<p>ユーザー入力が8進数で表される場合、この関数はその数字をリターンする。それが<code>&quot;u=rwx&quot;</code>のようなモードビットの完全なシンボル指定の場合、この関数は<code>file-modes-symbolic-to-number</code>を使用して、それを等価な数字に変換し、結果をリターンする。<code>&quot;o+g&quot;</code>のように相対的な指定の場合、その指定の元となるパーミッションは、<var>base-file</var>のモードビットから取得される。<var>base-file</var>が省略、または<code>nil</code>の場合、この関数は元となるモードビットとして<code>0</code>を使用する。完全指定および相対指定は、<code>&quot;u+r,g+rx,o+r,g-w&quot;</code>のように組み合わせることができる。ファイルモード指定の説明は、<a href="https://www.gnu.org/software/coreutils/manual/html_node/File-permissions.html#File-permissions">File
permissions</a> in <cite>The <small>GNU</small> <code>Coreutils</code> Manual</cite>を参照のこと。
</p></dd></dl>

<dl>
<dt id="index-file_002dmodes_002dsymbolic_002dto_002dnumber">Function: <strong>file-modes-symbolic-to-number</strong> <em>modes &amp;optional base-modes</em></dt>
<dd><p>この関数は、<var>modes</var>内のシンボルによるファイルモード指定を、等価な整数に変換する。シンボル指定が既存ファイルにもとづく場合は、オプション引数<var>base-modes</var>からそのファイルのモードビットが取得される。その引数が省略、または<code>nil</code>の場合は、0(すべてのアクセスが許可されない)がデフォルトになる。
</p></dd></dl>

<dl>
<dt id="index-set_002dfile_002dtimes">Function: <strong>set-file-times</strong> <em>filename &amp;optional time</em></dt>
<dd><p>This function sets the access and modification times of <var>filename</var> to
<var>time</var>.  The return value is <code>t</code> if the times are successfully set,
otherwise it is <code>nil</code>.  <var>time</var> defaults to the current time and
must be a time value (see <a href="Time-of-Day.html#Time-of-Day">Time of Day</a>).
</p></dd></dl>

<dl>
<dt id="index-set_002dfile_002dextended_002dattributes">Function: <strong>set-file-extended-attributes</strong> <em>filename attribute-alist</em></dt>
<dd><p>This function sets the Emacs-recognized extended file attributes for
<code>filename</code>.  The second argument <var>attribute-alist</var> should be an
alist of the same form returned by <code>file-extended-attributes</code>.  The
return value is <code>t</code> if the attributes are successfully set, otherwise
it is <code>nil</code>.  See <a href="Extended-Attributes.html#Extended-Attributes">Extended Attributes</a>.
</p></dd></dl>

<dl>
<dt id="index-set_002dfile_002dselinux_002dcontext">Function: <strong>set-file-selinux-context</strong> <em>filename context</em></dt>
<dd><p>この関数は、<var>filename</var>にたいするSELinuxセキュリティコンテキストに<var>context</var>をセットする。<var>context</var>引数は、各要素が文字列であるような<code>(<var>user</var>
<var>role</var> <var>type</var> <var>range</var>)</code>というリストであること。<a href="Extended-Attributes.html#Extended-Attributes">Extended Attributes</a>を参照されたい。
</p>
<p>この関数は、<var>filename</var>のSELinuxコンテキストのセットに成功した場合は<code>t</code>をリターンする。コンテキストがセットされなかった場合(SELinuxが無効、またはEmacsがSELinuxサポートなしでコンパイルされた場合等)は、<code>nil</code>をリターンする。
</p></dd></dl>

<dl>
<dt id="index-set_002dfile_002dacl">Function: <strong>set-file-acl</strong> <em>filename acl</em></dt>
<dd><p>この関数は、<var>filename</var>にたいするACLに<var>acl</var>をセットする。<var>acl</var>引数は、関数<code>file-acl</code>がリターンするのと同じ形式であること。<a href="Extended-Attributes.html#Extended-Attributes">Extended Attributes</a>を参照されたい。
</p>
<p>この関数は<var>filename</var>のACLのセットに成功したら<code>t</code>、それ以外は<code>nil</code>をリターンする。
</p></dd></dl>

<hr>
<div class="header">
<p>
Next: <a href="Files-and-Storage.html#Files-and-Storage" accesskey="n" rel="next">Files and Storage</a>, Previous: <a href="Information-about-Files.html#Information-about-Files" accesskey="p" rel="prev">Information about Files</a>, Up: <a href="Files.html#Files" accesskey="u" rel="up">Files</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html#Index" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
