<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 27.1.

Copyright (C) 1990-1996, 1998-2020 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.3 or any later
version published by the Free Software Foundation; with the Invariant
Sections being "GNU General Public License," with the Front-Cover Texts
being "A GNU Manual," and with the Back-Cover Texts as in (a) below.  A
copy of the license is included in the section entitled "GNU Free
Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and modify
this GNU manual.  Buying copies from the FSF supports it in developing GNU
and promoting software freedom." -->
<!-- Created by GNU Texinfo 6.7, http://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Window Hooks (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Window Hooks (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Window Hooks (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Windows.html" rel="up" title="Windows">
<link href="Frames.html" rel="next" title="Frames">
<link href="Window-Parameters.html" rel="prev" title="Window Parameters">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="en">
<span id="Window-Hooks"></span><div class="header">
<p>
Previous: <a href="Window-Parameters.html" accesskey="p" rel="prev">Window Parameters</a>, Up: <a href="Windows.html" accesskey="u" rel="up">Windows</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="uindounosukurorutoBian-Geng-notamenohutuku"></span><h3 class="section">28.28 ウィンドウのスクロールと変更のためのフック</h3>
<span id="index-hooks-for-window-operations"></span>

<p>This section describes how Lisp programs can take action after a window has
been scrolled or other window modifications occurred.  We first consider the
case where a window shows a different part of its buffer.
</p>
<dl>
<dt id="index-window_002dscroll_002dfunctions">Variable: <strong>window-scroll-functions</strong></dt>
<dd><p>This variable holds a list of functions that Emacs should call before
redisplaying a window with scrolling.  Displaying a different buffer in a
window and making a new window also call these functions.
</p>
<p>This variable is not a normal hook, because each function is called with two
arguments: the window, and its new display-start position.  At the time of
the call, the display-start position of the argument window is already set
to its new value, and the buffer to be displayed in the window is set as the
current buffer.
</p>
<p>これらの関数は<code>window-end</code> (<a href="Window-Start-and-End.html">Window Start and End</a>を参照)を使用する際には気をつけなければならない。最新の値が必要なら、それを確実に入力するために<var>update</var>引数を使用しなければならない。
</p>
<p><strong>警告:</strong>
ウィンドウのスクロール方法を変更するためにこの機能を使用してはならない。これはそのような用途のためにデザインされておらず、そのような使用では機能しないだろう。
</p></dd></dl>

<p>加えてFont Lockフォント表示関数(Font Lock fontification
function)を登録するために<code>jit-lock-register</code>を使用できる。バッファーの一部が(再)フォント表示されたときは、ウィンドウがスクロールまたはサイズ変更されたという理由で、これが常に呼び出されるだろう。<a href="Other-Font-Lock-Variables.html">Other Font Lock Variables</a>を参照のこと。
</p>
<span id="index-window-change-functions"></span>
<p>The remainder of this section covers six hooks that are called during
redisplay provided a significant, non-scrolling change of a window has been
detected.  For simplicity, these hooks and the functions they call will be
collectively referred to as <em>window change functions</em>.
</p>
<span id="index-window-buffer-change"></span>
<p>The first of these hooks is run after a <em>window buffer change</em> is
detected, which means that a window was created, deleted or assigned another
buffer.
</p>
<dl>
<dt id="index-window_002dbuffer_002dchange_002dfunctions">Variable: <strong>window-buffer-change-functions</strong></dt>
<dd><p>This variable specifies functions called during redisplay when window
buffers have changed.  The value should be a list of functions that take one
argument.
</p>
<p>Functions specified buffer-locally are called for any window showing the
corresponding buffer if that window has been created or assigned that buffer
since the last time window change functions were run.  In this case the
window is passed as argument.
</p>
<p>Functions specified by the default value are called for a frame if at least
one window on that frame has been added, deleted or assigned another buffer
since the last time window change functions were run.  In this case the
frame is passed as argument.
</p></dd></dl>

<span id="index-window-size-change"></span>
<p>The second of these hooks is run when a <em>window size change</em> has been
detected which means that a window was created, assigned another buffer, or
changed its total size or that of its text area.
</p>
<dl>
<dt id="index-window_002dsize_002dchange_002dfunctions">Variable: <strong>window-size-change-functions</strong></dt>
<dd><p>This variable specifies functions called during redisplay when a window size
change occurred.  The value should be a list of functions that take one
argument.
</p>
<p>Functions specified buffer-locally are called for any window showing the
corresponding buffer if that window has been added or assigned another
buffer or changed its total or body size since the last time window change
functions were run.  In this case the window is passed as argument.
</p>
<p>Functions specified by the default value are called for a frame if at least
one window on that frame has been added or assigned another buffer or
changed its total or body size since the last time window change functions
were run.  In this case the frame is passed as argument.
</p></dd></dl>

<span id="index-window-selection-change"></span>
<p>The third of these hooks is run when a <em>window selection change</em> has
selected another window since the last redisplay.
</p>
<dl>
<dt id="index-window_002dselection_002dchange_002dfunctions">Variable: <strong>window-selection-change-functions</strong></dt>
<dd><p>This variable specifies functions called during redisplay when the selected
window or a frame&rsquo;s selected window has changed.  The value should be a list
of functions that take one argument.
</p>
<p>Functions specified buffer-locally are called for any window showing the
corresponding buffer if that window has been selected or deselected (among
all windows or among all windows on its frame) since the last time window
change functions were run.  In this case the window is passed as argument.
</p>
<p>Functions specified by the default value are called for a frame if that
frame has been selected or deselected or the frame&rsquo;s selected window has
changed since the last time window change functions were run.  In this case
the frame is passed as argument.
</p></dd></dl>

<span id="index-window-state-change"></span>
<p>The fourth of these hooks is run when a <em>window state change</em> has been
detected, which means that at least one of the three preceding window
changes has occurred.
</p>
<dl>
<dt id="index-window_002dstate_002dchange_002dfunctions">Variable: <strong>window-state-change-functions</strong></dt>
<dd><p>This variable specifies functions called during redisplay when a window
buffer or size change occurred or the selected window or a frame&rsquo;s selected
window has changed.  The value should be a list of functions that take one
argument.
</p>
<p>Functions specified buffer-locally are called for any window showing the
corresponding buffer if that window has been added or assigned another
buffer, changed its total or body size or has been selected or deselected
(among all windows or among all windows on its frame) since the last time
window change functions were run.  In this case the window is passed as
argument.
</p>
<p>Functions specified by the default value are called for a frame if at least
one window on that frame has been added, deleted or assigned another buffer,
changed its total or body size or that frame has been selected or deselected
or the frame&rsquo;s selected window has changed since the last time window change
functions were run.  In this case the frame is passed as argument.
</p>
<p>Functions specified by the default value are also run for a frame when that
frame&rsquo;s window state change flag (see below) has been set since last
redisplay.
</p></dd></dl>

<span id="index-window-configuration-change"></span>
<p>The fifth of these hooks is run when a <em>window configuration change</em> has
been detected which means that either the buffer or the size of a window
changed.  It differs from the four preceding hooks in the way it is run.
</p>
<dl>
<dt id="index-window_002dconfiguration_002dchange_002dhook">Variable: <strong>window-configuration-change-hook</strong></dt>
<dd><p>This variable specifies functions called during redisplay when either the
buffer or the size of a window has changed.  The value should be a list of
functions that take no argument.
</p>
<p>Functions specified buffer-locally are called for any window showing the
corresponding buffer if at least one window on that frame has been added,
deleted or assigned another buffer or changed its total or body size since
the last time window change functions were run.  Each call is performed with
the window showing the buffer temporarily selected and its buffer current.
</p>
<p>Functions specified by the default value are called for each frame if at
least one window on that frame has been added, deleted or assigned another
buffer or changed its total or body size since the last time window change
functions were run.  Each call is performed with the frame temporarily
selected and the selected window&rsquo;s buffer current.
</p></dd></dl>

<p>Finally, Emacs runs a normal hook that generalizes the behavior of
<code>window-state-change-functions</code>.
</p>
<dl>
<dt id="index-window_002dstate_002dchange_002dhook">Variable: <strong>window-state-change-hook</strong></dt>
<dd><p>The default value of this variable specifies functions called during
redisplay when a window state change has been detected or the window state
change flag has been set on at least one frame.  The value should be a list
of functions that take no argument.
</p>
<p>Applications should put a function on this hook only if they want to react
to changes that happened on (or have been signaled for) two or more frames
since last redisplay.  In every other case, putting the function on
<code>window-state-change-functions</code> should be preferred.
</p></dd></dl>

<p>Window change functions are called during redisplay for each frame as
follows: First, any buffer-local window buffer change function, window size
change function, selected window change and window state change functions
are called in this order.  Next, the default values for these functions are
called in the same order.  Then any buffer-local window configuration change
functions are called followed by functions specified by the default value of
those functions.  Finally, functions on <code>window-state-change-hook</code> are
run.
</p>
<p>Window change functions are run for a specific frame only if a corresponding
change was registered for that frame earlier.  Such changes include the
creation or deletion of a window or the assignment of another buffer or size
to a window.  Note that even when such a change has been registered, this
does not mean that any of the hooks described above is run.  If, for
example, a change was registered within the scope of a window excursion
(see <a href="Window-Configurations.html">Window Configurations</a>), this will trigger a call of window change
functions only if that excursion still persists at the time change functions
are run.  If it is exited earlier, hooks will be run only if registered by a
change outside the scope of that excursion.
</p>
<span id="index-window-state-change-flag"></span>
<p>The <em>window state change flag</em> of a frame, if set, will cause the
default values of <code>window-state-change-functions</code> (for that frame) and
<code>window-state-change-hook</code> to be run during next redisplay regardless
of whether a window state change actually occurred for that frame or not.
After running any functions on these hooks, the flag is reset for each
frame.  Applications can set that flag and inspect its value using the
following functions.
</p>
<dl>
<dt id="index-set_002dframe_002dwindow_002dstate_002dchange">Function: <strong>set-frame-window-state-change</strong> <em>&amp;optional frame arg</em></dt>
<dd><p>This function sets <var>frame</var>&rsquo;s window state change flag if <var>arg</var> is
non-<code>nil</code> and resets it otherwise.  <var>frame</var> must be a live frame
and defaults to the selected one.
</p></dd></dl>

<dl>
<dt id="index-frame_002dwindow_002dstate_002dchange">Function: <strong>frame-window-state-change</strong> <em>&amp;optional frame</em></dt>
<dd><p>This functions returns <code>t</code> if <var>frame</var>&rsquo;s window state change flag is
set and <code>nil</code> otherwise.  <var>frame</var> must be a live frame and defaults
to the selected one.
</p></dd></dl>

<p>While window change functions are run, the functions described next can be
called to get more insight into what has changed for a specific window or
frame since the last redisplay.  All these functions take a live window as
single, optional argument, defaulting to the selected window.
</p>
<dl>
<dt id="index-window_002dold_002dbuffer">Function: <strong>window-old-buffer</strong> <em>&amp;optional window</em></dt>
<dd><p>This function returns the buffer shown in <var>window</var> at the last time
window change functions were run for <var>window</var>&rsquo;s frame.  If it returns
<code>nil</code>, <var>window</var> has been created after that.  If it returns
<code>t</code>, <var>window</var> was not shown at that time but has been restored from
a previously saved window configuration afterwards.  Otherwise, the return
value is the buffer shown by <code>window</code> at that time.
</p></dd></dl>

<dl>
<dt id="index-window_002dold_002dpixel_002dwidth">Function: <strong>window-old-pixel-width</strong> <em>&amp;optional window</em></dt>
<dd><p>This function returns the total pixel width of <var>window</var> the last time
window change functions found <code>window</code> live on its frame.  It is zero
if <code>window</code> was created after that.
</p></dd></dl>

<dl>
<dt id="index-window_002dold_002dpixel_002dheight">Function: <strong>window-old-pixel-height</strong> <em>&amp;optional window</em></dt>
<dd><p>This function returns the total pixel height of <var>window</var> the last time
window change functions found <code>window</code> live on its frame.  It is zero
if <code>window</code> was created after that.
</p></dd></dl>

<dl>
<dt id="index-window_002dold_002dbody_002dpixel_002dwidth">Function: <strong>window-old-body-pixel-width</strong> <em>&amp;optional window</em></dt>
<dd><p>This function returns the pixel width of <var>window</var>&rsquo;s text area the last
time window change functions found <code>window</code> live on its frame.  It is
zero if <code>window</code> was created after that.
</p></dd></dl>

<dl>
<dt id="index-window_002dold_002dbody_002dpixel_002dheight">Function: <strong>window-old-body-pixel-height</strong> <em>&amp;optional window</em></dt>
<dd><p>This function returns the pixel height of <var>window</var>&rsquo;s text area the last
time window change functions found <code>window</code> live on its frame.  It is
zero if <code>window</code> was created after that.
</p></dd></dl>

<p>In order to find out which window or frame was selected the last time window
change functions were run, the following functions can be used:
</p>
<dl>
<dt id="index-frame_002dold_002dselected_002dwindow">Function: <strong>frame-old-selected-window</strong> <em>&amp;optional frame</em></dt>
<dd><p>This function returns the selected window of <var>frame</var> at the last time
window change functions were run.  If omitted or <code>nil</code> <var>frame</var>
defaults to the selected frame.
</p></dd></dl>

<dl>
<dt id="index-old_002dselected_002dwindow">Function: <strong>old-selected-window</strong></dt>
<dd><p>This function returns the selected window at the last time window change
functions were run.
</p></dd></dl>

<dl>
<dt id="index-old_002dselected_002dframe">Function: <strong>old-selected-frame</strong></dt>
<dd><p>This function returns the selected frame at the last time window change
functions were run.
</p></dd></dl>

<p>Note that window change functions provide no information about which windows
have been deleted since the last time they were run.  If necessary,
applications should remember any window showing a specific buffer in a local
variable of that buffer and update it in a function run by the default
values of any of the hooks that are run when a window buffer change was
detected.
</p>
<p>The following caveats should be considered when adding a function to window
change functions:
</p>
<ul>
<li> Some operations will not trigger a call of window change functions.  These
include showing another buffer in a minibuffer window or any change of a
tooltip window.

</li><li> Window change functions should not create or delete windows or change the
buffer, size or selection status of any window because there is no guarantee
that the information about such a change will be propagated to other window
change functions.  If at all, any such change should be executed only by the
last function listed by the default value of
<code>window-state-change-hook</code>.

</li><li> Macros like <code>save-window-excursion</code>, <code>with-selected-window</code> or
<code>with-current-buffer</code> can be used when running window change functions.

</li><li> Running window change functions does not save and restore match data.
Unless running <code>window-configuration-change-hook</code> it does not save or
restore the selected window or frame or the current buffer either.

</li><li> Any redisplay triggering the run of window change functions may be aborted.
If the abort occurs before window change functions have run to their
completion, they will be run again with the previous values, that is, as if
redisplay had not been performed.  If aborted later, they will be run with
the new values, that is, as if redisplay had been actually performed.
</li></ul>
<hr>
<div class="header">
<p>
Previous: <a href="Window-Parameters.html" accesskey="p" rel="prev">Window Parameters</a>, Up: <a href="Windows.html" accesskey="u" rel="up">Windows</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
