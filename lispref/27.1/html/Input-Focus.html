<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 27.1.

Copyright (C) 1990-1996, 1998-2020 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.3 or any later
version published by the Free Software Foundation; with the Invariant
Sections being "GNU General Public License," with the Front-Cover Texts
being "A GNU Manual," and with the Back-Cover Texts as in (a) below.  A
copy of the license is included in the section entitled "GNU Free
Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and modify
this GNU manual.  Buying copies from the FSF supports it in developing GNU
and promoting software freedom." -->
<!-- Created by GNU Texinfo 6.7, http://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Input Focus (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Input Focus (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Input Focus (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Frames.html" rel="up" title="Frames">
<link href="Visibility-of-Frames.html" rel="next" title="Visibility of Frames">
<link href="Minibuffers-and-Frames.html" rel="prev" title="Minibuffers and Frames">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="en">
<span id="Input-Focus"></span><div class="header">
<p>
Next: <a href="Visibility-of-Frames.html" accesskey="n" rel="next">Visibility of Frames</a>, Previous: <a href="Minibuffers-and-Frames.html" accesskey="p" rel="prev">Minibuffers and Frames</a>, Up: <a href="Frames.html" accesskey="u" rel="up">Frames</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="Ru-Li-nohuokasu"></span><h3 class="section">29.10 入力のフォーカス</h3>
<span id="index-input-focus"></span>
<span id="index-selected-frame"></span>

<p>どんなときでもEmacs内のただ1つのフレームが<em>選択されたフレーム(selected
frame)</em>です。選択されたウィンドウは常に選択されたフレーム上にあります。
</p>
<p>Emacsがフレームを複数端末(<a href="Multiple-Terminals.html">Multiple Terminals</a>を参照)上に表示する際には、各端末は自身の選択されたフレームをもちます。しかしそれらのうち1つだけが、<em>いわゆる</em>選択されたフレームであり、それはもっとも最近に入力があった端末に属すフレームです。つまり特定の端末からのコマンドをEmacsが実行する際には、その端末上の1つが選択されたフレームです。Emacsが実行するコマンドは常に1つだけなので、選択されたフレームは常に1つだけだと考える必要があります。このフレームこそが、このマニュアルで<em>選択されたフレーム</em>と呼ぶフレームです。選択されたフレームを表示するディスプレイは、<em>選択されたフレームのディスプレイ(selected
frame&rsquo;s display)</em>です。
</p>
<dl>
<dt id="index-selected_002dframe">Function: <strong>selected-frame</strong></dt>
<dd><p>この関数は選択されたフレームをリターンする。
</p></dd></dl>

<p>Some window systems and window managers direct keyboard input to the window
object that the mouse is in; others require explicit clicks or commands to
<em>shift the focus</em> to various window objects.  Either way, Emacs
automatically keeps track of which frames have focus.  To explicitly switch
to a different frame from a Lisp function, call
<code>select-frame-set-input-focus</code>.
</p>
<p>The plural &ldquo;frames&rdquo; in the previous paragraph is deliberate: while Emacs
itself has only one selected frame, Emacs can have frames on many different
terminals (recall that a connection to a window system counts as a
terminal), and each terminal has its own idea of which frame has input
focus.  When you set the input focus to a frame, you set the focus for that
frame&rsquo;s terminal, but frames on other terminals may still remain focused.
</p>
<p>Lisp programs can switch frames temporarily by calling the function
<code>select-frame</code>.  This does not alter the window system&rsquo;s concept of
focus; rather, it escapes from the window manager&rsquo;s control until that
control is somehow reasserted.
</p>
<p>テキスト端末使用時はその端末上で一度に表示できるフレームは1つだけなので、<code>select-frame</code>呼び出し後に次回の再表示で新たに選択されたフレームが実際に表示されます。このフレームは次の<code>select-frame</code>呼び出しまで選択されたままです。テキスト端末上の各フレームはバッファー名の前に表示される番号をもちます(<a href="Mode-Line-Variables.html">Mode Line Variables</a>を参照)。
</p>
<dl>
<dt id="index-select_002dframe_002dset_002dinput_002dfocus">Function: <strong>select-frame-set-input-focus</strong> <em>frame &amp;optional norecord</em></dt>
<dd><p>This function selects <var>frame</var>, raises it (should it happen to be
obscured by other frames) and tries to give it the window system&rsquo;s focus.
On a text terminal, the next redisplay displays the new frame on the entire
terminal screen.  The optional argument <var>norecord</var> has the same meaning
as for <code>select-frame</code> (see below).  The return value of this function
is not significant.
</p></dd></dl>

<p>以下で説明する関数は理想的には他のフレームを前面にレイズすることなくフレームにフォーカスするべきです。残念ながらウィンドウシステムやウィンドウマネージャーの多くはこの要求を拒絶するかもしれません。
</p>
<dl>
<dt id="index-x_002dfocus_002dframe">Function: <strong>x-focus-frame</strong> <em>frame &amp;optional noactivate</em></dt>
<dd><p>この関数は<var>frame</var>のレイズを要さずに<var>frame</var>にXサーバーのフォーカスを与える。<var>frame</var>が<code>nil</code>なら選択されたフレームを意味する。Xの配下ではオプション引数<var>noactivate</var>が非<code>nil</code>なら、<var>frame</var>のウィンドウシステムのウィンドウが&ldquo;アクティブ&rdquo;なウィンドウになることを防ぐことを意味する。これは<var>frame</var>が他のフレームの前面にならないようさらに強く主張する。
</p>
<p>MS-Windowsでは<var>noactivate</var>引数に効果はない。しかし<var>frame</var>が子フレーム(<a href="Child-Frames.html">Child Frames</a>を参照)なら、この関数は通常は他の子レームの前面にレイズすることなく<var>frame</var>にフォーカスする。
</p>
<p>この関数はウィンドウシステムのサポートがなければ何もしない。
</p></dd></dl>

<dl>
<dt id="index-select_002dframe">Command: <strong>select-frame</strong> <em>frame &amp;optional norecord</em></dt>
<dd><p>この関数はフレーム<var>frame</var>を選択して、Xサーバーのフォーカスがあればそれを一時的に無視する。<var>frame</var>にたいする選択は次回ユーザーが別フレームに何かを行うか、この関数の次回呼び出しまで継続する(ウィンドウシステムを使用する場合には以前に選択されていたフレームに依然としてウィンドウシステムの入力フォーカスがあるかもしれないので、コマンドループからリターン後にそのフレームが選択されたフレームとしてリストアされるかもしれない)。
</p>
<p>指定された<var>frame</var>は選択されたフレームとなり、その端末が選択された端末になる。この関数はその後に<var>frame</var>内で選択されていたウィンドウを第1引数、<var>norecord</var>を第2引数にして<code>select-window</code>をサブルーチンとして呼び出す(したがって<var>norecord</var>が非<code>nil</code>なら、もっとも最近に選択されたウィンドウとバッファーリストの変更を避ける)。<a href="Selecting-Windows.html">Selecting Windows</a>を参照のこと。
</p>
<p>この関数は<var>frame</var>、<var>frame</var>が削除されていれば<code>nil</code>をリターンする。
</p>
<p>一般的には実行後に端末を戻すよう切り替えることなく、別の端末に切り替えるのが可能な手段として<code>select-frame</code>を決して使用しないこと。
</p></dd></dl>

<span id="index-text_002dterminal-focus-notification"></span>
<p>Emacs cooperates with the window system by arranging to select frames as the
server and window manager request.  When a window system informs Emacs that
one of its frames has been selected, Emacs internally generates a
<em>focus-in</em> event.  When an Emacs frame is displayed on a text-terminal
emulator, such as <code>xterm</code>, which supports reporting of focus-change
notification, the focus-in and focus-out events are available even for
text-mode frames.  Focus events are normally handled by
<code>handle-focus-in</code>.
</p>
<dl>
<dt id="index-handle_002dfocus_002din">Command: <strong>handle-focus-in</strong> <em>event</em></dt>
<dd><p>This function handles focus-in events from window systems and terminals that
support explicit focus notifications.  It updates the per-frame focus flags
that <code>frame-focus-state</code> queries and calls
<code>after-focus-change-function</code>.  In addition, it generates a
<code>switch-frame</code> event in order to switch the Emacs notion of the
selected frame to the frame most recently focused in some terminal.  It&rsquo;s
important to note that this switching of the Emacs selected frame to the
most recently focused frame does not mean that other frames do not continue
to have the focus in their respective terminals.  Do not invoke this
function yourself: instead, attach logic to
<code>after-focus-change-function</code>.
</p></dd></dl>

<dl>
<dt id="index-handle_002dswitch_002dframe">Command: <strong>handle-switch-frame</strong> <em>frame</em></dt>
<dd><p>This function handles a switch-frame event, which Emacs generates for itself
upon focus notification or under various other circumstances involving an
input event arriving at a different frame from the last event.  Do not
invoke this function yourself.
</p></dd></dl>

<dl>
<dt id="index-redirect_002dframe_002dfocus">Function: <strong>redirect-frame-focus</strong> <em>frame &amp;optional focus-frame</em></dt>
<dd><p>この関数は<var>frame</var>から<var>focus-frame</var>にフォーカスをリダイレクトする。これは<var>frame</var>にかわって<var>focus-frame</var>が以降のキーストロークとイベントを受け取るであろうことを意味する。そのようなイベント後には<code>last-event-frame</code>の値は<var>focus-frame</var>になるだろう。また<var>frame</var>を指定したswitch-frameイベントも、かわりに<var>focus-frame</var>を選択するだろう。
</p>
<p><var>focus-frame</var>が省略または<code>nil</code>なら、<var>frame</var>にたいするすべての既存のリダイレクションがキャンセルされるので、<var>frame</var>が自身のイベントを再度受け取ることになる。
</p>
<p>フォーカスリダイレクトの用途の1つは、ミニバッファーをもたないフレームにたいしてである。これらのフレームは別フレーム上のミニバッファーを使用する。別フレーム上のミニバッファーをアクティブにすることは、そのフレームにフォーカスをリダイレクトすることである。これはたとえマウスがミニバッファーをアクティブにしたフレーム内に留まっていても、ミニバッファーが属すフレームにフォーカスを置く。
</p>
<p>フレーム選択はフォーカスリダイレクションの変更も可能にする。<code>foo</code>が選択されているときにフレーム<code>bar</code>を選択することにより、<code>foo</code>を指すすべてのリダイレクションはかわりに<code>bar</code>を指す。これはユーザーが<code>select-window</code>を使用してあるフレームから別のフレームに切り替えた際に、フォーカスのリダイレクトが正しく機能することを可能にする。
</p>
<p>これはフォーカスが自身にリダイレクトされたフレームが、フォーカスがリダイレクトされていないフレームとは異なる扱いを受けることを意味する。前者にたいして<code>select-frame</code>は影響するが、後者には影響がない。
</p>
<p>このリダイレクションは、それを変更するために<code>redirect-frame-focus</code>が呼び出されるまで継続する。
</p></dd></dl>

<dl>
<dt id="index-frame_002dfocus_002dstate">Function: <strong>frame-focus-state</strong> <em>frame</em></dt>
<dd><p>This function retrieves the last known focus state of <var>frame</var>.
</p>
<p>It returns <code>nil</code> if the frame is known not to be focused, <code>t</code> if
the frame is known to be focused, or <code>unknown</code> if Emacs does not know
the focus state of the frame.  (You may see this last state in TTY frames
running on terminals that do not support explicit focus notifications.)
</p></dd></dl>

<dl>
<dt id="index-after_002dfocus_002dchange_002dfunction">Variable: <strong>after-focus-change-function</strong></dt>
<dd><p>This function is an extension point that code can use to receive a
notification that focus has changed.
</p>
<p>This function is called with no arguments when Emacs notices that the set of
focused frames may have changed.  Code wanting to do something when frame
focus changes should use <code>add-function</code> to add a function to this one,
and in this added function, re-scan the set of focused frames, calling
<code>frame-focus-state</code> to retrieve the last known focus state of each
frame.  Focus events are delivered asynchronously, and frame input focus
according to an external system may not correspond to the notion of the
Emacs selected frame.  Multiple frames may appear to have input focus
simultaneously due to focus event delivery differences, the presence of
multiple Emacs terminals, and other factors, and code should be robust in
the face of this situation.
</p>
<p>Depending on window system, focus events may also be delivered repeatedly
and with different focus states before settling to the expected values.
Code relying on focus notifications should &ldquo;debounce&rdquo; any user-visible
updates arising from focus changes, perhaps by deferring work until
redisplay.
</p>
<p>This function may be called in arbitrary contexts, including from inside
<code>read-event</code>, so take the same care as you might when writing a process
filter.
</p></dd></dl>

<dl>
<dt id="index-focus_002dfollows_002dmouse">User Option: <strong>focus-follows-mouse</strong></dt>
<dd><p>このオプションはフレーム内にマウスポインターを移動した際にウィンドウマネージャーがフォーカスを転送するかどうかと、その方法についてEmacsに知らせる。意味がある値は以下の3つ:
</p>
<dl compact="compact">
<dt><code>nil</code></dt>
<dd><p>デフォルト値<code>nil</code>はウィンドウマネージャーが&ldquo;click-to-focus(フレームがフォーカスを取得するためにフレーム内部でマウスをクリックする必要がある)&rdquo;のポリシーにしたがう際に使用すること。
</p>
</dd>
<dt><code>t</code></dt>
<dd><p>値<code>t</code>はマウスポインターの位置にしたがってウィンドウマネージャーが自動的にフォーカスするが、フォーカスを得たフレームは自動的にレイズされず別のウィンドウシステムのウィンドウに隠されたままかもしれないときに使用すること。
</p>
</dd>
<dt><code>auto-raise</code></dt>
<dd><p>値<code>auto-raise</code>はマウスポインターの位置にしたがってウィンドウマネージャーが自動的にフォーカスして、フォーカスを得たフレームは自動的にレイズされる際に使用すること。
</p></dd>
</dl>

<p>このオプションが非<code>nil</code>なら、Emacsは<code>select-frame-set-input-focus</code>が選択したフレームにマウスポインターを移動する。この関数は<code>other-frame</code>や<code>pop-to-buffer</code>などいくつかのコマンドで使用される。
</p>
<p>ウィンドウマネージャーは&ldquo;通常&rdquo;のフレームのレイズには通常は配慮するので、値<code>t</code>と<code>auto-raise</code>を区別する必要はない。これは<code>mouse-autoselect-window</code>
(<a href="Mouse-Window-Auto_002dselection.html">Mouse Window Auto-selection</a>を参照)を通じて子フレームをレイズするために有用。
</p>
<p>このオオプションは&ldquo;sloppy&rdquo;なフォーカス(別のウィンドウマネージャーウィンドウにマウスポインターが移動しないかぎり以前にフォーカスのあったフレームがフォーカスを保持する)と&ldquo;strict&rdquo;なフォーカス(マウスポインターが去るとフレームは即座にフォーカスを失う)を区別しないことに注意。ウィンドウマネージャーがフォーカスや自動レイズの遅延をサポートしていなくても、新たなフレームがフォーカスを取得(あるいは自動レイズ)するまでの時間を明示的に指定できる。
</p>
<p>変数<code>mouse-autoselect-window</code> (<a href="Mouse-Window-Auto_002dselection.html">Mouse Window Auto-selection</a>を参照)をカスタマイズすることにより、個別のEmacsウィンドウにたいして&ldquo;focus follows
mouse&rdquo;ポリシーを提供できる。
</p></dd></dl>


<hr>
<div class="header">
<p>
Next: <a href="Visibility-of-Frames.html" accesskey="n" rel="next">Visibility of Frames</a>, Previous: <a href="Minibuffers-and-Frames.html" accesskey="p" rel="prev">Minibuffers and Frames</a>, Up: <a href="Frames.html" accesskey="u" rel="up">Frames</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
