<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 27.1.

Copyright (C) 1990-1996, 1998-2022 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.3 or any later
version published by the Free Software Foundation; with the Invariant
Sections being "GNU General Public License," with the Front-Cover Texts
being "A GNU Manual," and with the Back-Cover Texts as in (a) below.  A
copy of the license is included in the section entitled "GNU Free
Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and modify
this GNU manual.  Buying copies from the FSF supports it in developing GNU
and promoting software freedom." -->
<!-- Created by GNU Texinfo 6.7, http://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Bindat Types (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Bindat Types (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Bindat Types (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="texi2any">
<meta name="date" content="November 30, 2022">
<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Byte-Packing.html" rel="up" title="Byte Packing">
<link href="Bindat-Functions.html" rel="next" title="Bindat Functions">
<link href="Byte-Packing.html" rel="prev" title="Byte Packing">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="en">
<span id="Bindat-Types"></span><div class="header">
<p>
Next: <a href="Bindat-Functions.html" accesskey="n" rel="next">Bindat Functions</a>, Up: <a href="Byte-Packing.html" accesskey="u" rel="up">Byte Packing</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="detareiautonoJi-Shu-"></span><h4 class="subsection">40.20.1 データレイアウトの記述</h4>
<span id="index-bindat-types"></span>

<span id="index-data-layout-specification"></span>
<span id="index-bindat-type-expression"></span>
<span id="index-base-type_002c-in-bindat-specification"></span>
<span id="index-composite-type_002c-in-bindat-specification"></span>
<p>unpackとpackを制御するためには、<em>データレイアウト仕様(data layout
specification)</em>を記述します(<em>Bindatタイプ式(Bindat type
expression)</em>とも呼ばれる)。これには<em>ベースタイプ(base
type)</em>と複数フィールドからなる<em>コンポジットタイプ(composite
type)</em>があり、処理するフィールドそれぞれの長さ、packやunpackを行う方法をこの仕様が制御します。わたしたちはbindatタイプの値を、通常は<code>-bindat-spec</code>で終わる名前の変数に保持しています。このような種類の名前は、自動的に危険(risky)だと認識されます(<a href="File-Local-Variables.html">File Local Variables</a>を参照)。
</p>
<dl>
<dt id="index-bindat_002dtype">Macro: <strong>bindat-type</strong> <em>&amp;rest type</em></dt>
<dd><p>Bindatタイプの<em>式</em>である<var>type</var>に応じて、Bindatタイプの<em>値</em>オブジェクトを作成する。
</p></dd></dl>

<span id="index-endianness_002c-in-bindat-specification"></span>
<span id="index-big-endian_002c-in-bindat-specification"></span>
<span id="index-little-endian_002c-in-bindat-specification"></span>
<span id="index-network-byte-ordering_002c-in-Bindat-specification"></span>
<p>フィールドの<em>タイプ(type)</em>はフィールドが表すオブジェクトのサイズ(バイト単位)、およびそれがマルチバイトフィールドならフィールがバイトオーダーされる方法を記述します。可能なオーダーはビッグエンディアン(big
endian。ネットワークバイトオーダーとも呼ばれる)、およびリトルエンディアン(little
endian)の2つです。たとえば数字<code>#x23cd</code> (10進の9165)のビッグエンディアンは<code>#x23</code>
<code>#xcd</code>の2バイト、リトルエンディアンは<code>#xcd</code> <code>#x23</code>になるでしょう。以下は可能なタイプの値です:
</p>
<dl compact="compact">
<dt><code>u8</code></dt>
<dt><code>byte</code></dt>
<dd><p>長さ1の符号なしタイプ。
</p>
</dd>
<dt><code>uint <var>bitlen</var> &amp;optional <var>le</var></code></dt>
<dd><p>Unsigned integer in network byte order (big-endian), with <var>bitlen</var>
bits.  <var>bitlen</var> has to be a multiple of 8.  If <var>le</var> is
non-<code>nil</code>, then use little-endian byte order.
</p>
</dd>
<dt><code>sint <var>bitlen</var> <var>le</var></code></dt>
<dd><p>Signed integer in network byte order (big-endian), with <var>bitlen</var> bits.
<var>bitlen</var> has to be a multiple of 8.  If <var>le</var> is non-<code>nil</code>, then
use little-endian byte order.
</p>
</dd>
<dt><code>str <var>len</var></code></dt>
<dd><p>Unibyte string (see <a href="Text-Representations.html">Text Representations</a>) of length <var>len</var> bytes.
When packing, the first <var>len</var> bytes of the input string are copied to
the packed output.  If the input string is shorter than <var>len</var>, the
remaining bytes will be null (zero) unless a pre-allocated string was
provided to <code>bindat-pack</code>, in which case the remaining bytes are left
unmodified.  If the input string is multibyte with only ASCII and
<code>eight-bit</code> characters, it is converted to unibyte before it is packed;
other multibyte strings signal an error.  When unpacking, any null bytes in
the packed input string will appear in the unpacked output.
</p>
</dd>
<dt><code>strz &amp;optional <var>len</var></code></dt>
<dd><p>If <var>len</var> is not provided, this is a variable-length null-terminated
unibyte string (see <a href="Text-Representations.html">Text Representations</a>).  When packing into
<code>strz</code>, the entire input string is copied to the packed output followed
by a null (zero) byte.  (If pre-allocated string is provided for packing
into <code>strz</code>, that pre-allocated string should have enough space for the
additional null byte appended to the output string contents, see <a href="Bindat-Functions.html">Bindat Functions</a>).  The length of the packed output is the length of the input
string plus one (for the null terminator).  The input string must not
contain any null bytes.  If the input string is multibyte with only ASCII
and <code>eight-bit</code> characters, it is converted to unibyte before it is
packed; other multibyte strings signal an error.  When unpacking a
<code>strz</code>, the resulting output string will contain all bytes up to (but
excluding) the null byte that terminated the input string.
</p>
<p>If <var>len</var> is provided, <code>strz</code> behaves the same as <code>str</code>, but
with a couple of differences:
</p>
<ul>
<li> When packing, a null terminator is written after the packed input string if
the number of characters in the input string is less than <var>len</var>.

</li><li> When unpacking, the first null byte encountered in the packed string is
interpreted as the terminating byte, and it and all subsequent bytes are
excluded from the result of the unpacking.
</li></ul>

<blockquote>
<p><b>Caution:</b> The packed output will not be null-terminated unless the input string is
shorter than <var>len</var> bytes or it contains a null byte within the first
<var>len</var> bytes.
</p></blockquote>

</dd>
<dt><code>vec <var>len</var> [<var>type</var>]</code></dt>
<dd><p><var>len</var>要素のベクター。要素のタイプは<var>type</var>により与えられる(デフォルトはバイト)。<var>type</var>は任意のBindatタイプ式を指定できる。
</p>
</dd>
<dt><code>repeat <var>len</var> [<var>type</var>]</code></dt>
<dd><p><code>vec</code>と同様だがリストから双方向にunpack/packする(<code>vec</code>はunpackするベクター)。
</p>
</dd>
<dt><code>bits <var>len</var></code></dt>
<dd><p><var>len</var>バイト内で1にセットされたビットのリスト。バイトはビッグエンディアンオーダーで、ビットは<code>8 * <var>len</var>
- 1</code>で始まり0で終わるよう番号が付けされる。たとえば<code>bits 2</code>では、<code>#x28</code>
<code>#x1c</code>は<code>(2 3 4 11 13)</code>、<code>#x1c</code> <code>#x28</code>は<code>(3 5 10 11
12)</code>にunpackされる。
</p>
</dd>
<dt><code>fill <var>len</var></code></dt>
<dd><p><var>len</var> bytes used as a mere filler.  In packing, these bytes are left
unchanged, which normally means they remain zero.  When unpacking, this just
returns nil.
</p>
</dd>
<dt><code>align <var>len</var></code></dt>
<dd><p><code>fill</code>と同様だが、次の<var>len</var>の倍数バイトまでスキップを要するバイト数である点が異なる。
</p>
</dd>
<dt><code>type <var>exp</var></code></dt>
<dd><p>これによりタイプを間接的に参照できる。<var>exp</var>はBindatタイプ<em>value</em>をリターンするLisp式であること。
</p>
</dd>
<dt><code>unit <var>exp</var></code></dt>
<dd><p>これは0ビットのスペースを使用する簡易タイプ。<var>exp</var>はそのようなフィールドの&ldquo;unpack&rdquo;を試みた際にリターンされる値を記述する。
</p>
</dd>
<dt><code>struct <var>fields</var>...</code></dt>
<dd><p>複数フィールドから構成されるコンポジットタイプ(composite typex: 複合型)。フィールドはそれぞれ<code>(<var>name</var>
<var>type</var>)</code>という形式をもち、<var>type</var>には任意のBindatタイプ式を指定できる。<code>align</code>や<code>fill</code>のフィールドのように、そのフィールド値が命名に値しない場合には、<var>name</var>は<code>_</code>でもよい。コンテキストによりBindatタイプ式であることが明確なら、シンボル<code>struct</code>は省略可。
</p></dd>
</dl>

<p>上述のタイプの中で、<var>len</var>と<var>bitlen</var>はフィールド内のバイト数(またはビット数)を指定する整数として与えられます。そのフィールドが固定長でなければ、通常は値は先行するフィールドの値に依存します。この理由により、<var>len</var>の長さは定数である必要がないので任意のLisp式を指定することができ、フィールド名から先行するフィールドの値を通じて参照することができるのです。
</p>
<p>たとえば先頭のバイトが16ビット整数の後続ベクターにサイズを与えるデータレイアウトの仕様は、以下のようになります:
</p><div class="example">
<pre class="example">(bindat-type
  (len      u8)
  (payload  vec (1+ len) uint 16))
</pre></div>

<hr>
<div class="header">
<p>
Next: <a href="Bindat-Functions.html" accesskey="n" rel="next">Bindat Functions</a>, Up: <a href="Byte-Packing.html" accesskey="u" rel="up">Byte Packing</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>


This page has generated for branch:work/emacs-29_edd64e64a389e0f0e6ce670846d4fae79a9d8b35, commit:5328ab0453143d448a33f93c0e020634a62c6c6e to check Japanese translation.
</body>
</html>
