<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by GNU Texinfo 6.8, https://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- This is the GNU Emacs Lisp Reference Manual
corresponding to Emacs version 27.1.

Copyright (C) 1990-1996, 1998-2022 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document under
the terms of the GNU Free Documentation License, Version 1.3 or any later
version published by the Free Software Foundation; with the Invariant
Sections being "GNU General Public License," with the Front-Cover Texts
being "A GNU Manual," and with the Back-Cover Texts as in (a) below.  A
copy of the license is included in the section entitled "GNU Free
Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and modify
this GNU manual.  Buying copies from the FSF supports it in developing GNU
and promoting software freedom." -->
<title>Multisession Variables (GNU Emacs Lisp Reference Manual)</title>

<meta name="description" content="Multisession Variables (GNU Emacs Lisp Reference Manual)">
<meta name="keywords" content="Multisession Variables (GNU Emacs Lisp Reference Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="texi2any">
<meta name="date" content="March 5, 2023">
<meta name="viewport" content="width=device-width,initial-scale=1">

<link href="index.html" rel="start" title="Top">
<link href="Index.html" rel="index" title="Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Variables.html" rel="up" title="Variables">
<link href="Generalized-Variables.html" rel="prev" title="Generalized Variables">
<style type="text/css">
<!--
a.copiable-anchor {visibility: hidden; text-decoration: none; line-height: 0em}
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
span:hover a.copiable-anchor {visibility: visible}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="en">
<div class="section" id="Multisession-Variables">
<div class="header">
<p>
Previous: <a href="Generalized-Variables.html" accesskey="p" rel="prev">ジェネリック変数</a>, Up: <a href="Variables.html" accesskey="u" rel="up">変数</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="Multisession-Variables-1"></span><h3 class="section">12.18 Multisession Variables</h3>

<span id="index-multisession-variable"></span>
<p>When you set a variable to a value and then close Emacs and restart it, that
value won&rsquo;t be automatically restored.  Users usually set normal variables
in their startup files, or use Customize (see <a href="Customization.html">カスタマイゼーション設定</a>) to set user
options permanently, and various packages have various files where they
store the data (e.g., Gnus stores this in <samp>.newsrc.eld</samp> and the URL
library stores cookies in <samp>~/.emacs.d/url/cookies</samp>).
</p>
<p>For things in between these two extremes (i.e., configuration which goes in
the startup file, and massive application state that goes into separate
files), Emacs provides a facility to replicate data between sessions called
<em>multisession variables</em>.  (This facility may not be available on all
systems.)  To give you an idea of how these are meant to be used, here&rsquo;s a
small example:
</p>
<div class="example lisp">
<pre class="lisp">(define-multisession-variable foo-var 0)
(defun my-adder (num)
  (interactive &quot;nAdd number: &quot;)
  (setf (multisession-value foo)
        (+ (multisession-value foo) num))
  (message &quot;The new number is: %s&quot; (multisession-value foo)))
</pre></div>

<p>This defines the variable <code>foo-var</code> and binds it to a special
multisession object which is initialized with the value &lsquo;<samp>0</samp>&rsquo; (if the
variable doesn&rsquo;t already exist from a previous session).  The
<code>my-adder</code> command queries the user for a number, adds this to the old
(possibly saved value), and then saves the new value.
</p>
<p>This facility isn&rsquo;t meant to be used for huge data structures, but should be
performant for most values.
</p>
<dl class="def">
<dt id="index-define_002dmultisession_002dvariable"><span class="category">Macro: </span><span><strong>define-multisession-variable</strong> <em>name initial-value &amp;optional doc &amp;rest args</em><a href='#index-define_002dmultisession_002dvariable' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>This macro defines <var>name</var> as a multisession variable, and gives it the
<var>initial-value</var> if this variable hasn&rsquo;t been assigned a value earlier.
<var>doc</var> is the doc string, and several keyword arguments can be used in
<var>args</var>:
</p>
<dl compact="compact">
<dt><span><code>:package <var>package-symbol</var></code></span></dt>
<dd><p>This keyword says that a multisession variable belongs to the package
specified by <var>package-symbol</var>.  The combination of <var>package-symbol</var>
and <var>name</var> has to be unique.  If <var>package-symbol</var> isn&rsquo;t given, this
will default to the first &ldquo;segment&rdquo; of the <var>name</var> symbol&rsquo;s name, which
is the part of its name up to and excluding the first &lsquo;<samp>-</samp>&rsquo;.  For
instance, if <var>name</var> is <code>foo-var</code> and <var>package-symbol</var> isn&rsquo;t
given, <var>package-symbol</var> will default to <code>foo</code>.
</p>
<span id="index-synchronized-multisession-variables"></span>
</dd>
<dt><span><code>:synchronized <var>bool</var></code></span></dt>
<dd><p>Multisession variables can be <em>synchronized</em> if <var>bool</var> is
non-<code>nil</code>.  This means that if there&rsquo;re two concurrent Emacs instances
running, and the other Emacs changes the multisession variable
<code>foo-var</code>, the current Emacs instance will retrieve that modified data
when accessing the value.  If <var>synchronized</var> is <code>nil</code> or missing,
this won&rsquo;t happen, and the values in all Emacs sessions using the variable
will be independent of each other.
</p>
</dd>
<dt><span><code>:storage <var>storage</var></code></span></dt>
<dd><p>Use the specified <var>storage</var> method.  This can be either <code>sqlite</code>
(in Emacs compiled with SQLite support) or <code>files</code>.  If not given, this
defaults to the value of the <code>multisession-storage</code> variable, described
below.
</p></dd>
</dl>
</dd></dl>

<dl class="def">
<dt id="index-multisession_002dvalue"><span class="category">Function: </span><span><strong>multisession-value</strong> <em>variable</em><a href='#index-multisession_002dvalue' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>This function returns the current value of <var>variable</var>.  If this variable
hasn&rsquo;t been accessed before in this Emacs session, or if it&rsquo;s changed
externally, it will be read in from external storage.  If not, the current
value in this session is returned as is.  It is an error to call this
function for a <var>variable</var> that is not a multisession variable.
</p>
<p>Values retrieved via <code>multisession-value</code> may or may not be <code>eq</code>
to each other, but they will always be <code>equal</code>.
</p>
<p>This is a generalized variable (see <a href="Generalized-Variables.html">ジェネリック変数</a>), so the way
to update such a variable is to say, for instance:
</p>
<div class="example lisp">
<pre class="lisp">(setf (multisession-value foo-bar) 'zot)
</pre></div>

<p>Only Emacs Lisp values that have a readable print syntax (see <a href="Printed-Representation.html">プリント表現と読み取り構文</a>) can be saved this way.
</p>
<p>If the multisession variable is synchronized, setting it may update the
value first.  For instance:
</p>
<div class="example lisp">
<pre class="lisp">(cl-incf (multisession-value foo-bar))
</pre></div>

<p>This first checks whether the value has changed in a different Emacs
instance, retrieves that value, and then adds 1 to that value and stores
it.  But note that this is done without locking, so if many instances are
updating the value at the same time, it&rsquo;s unpredictable which instance
&ldquo;wins&rdquo;.
</p></dd></dl>

<dl class="def">
<dt id="index-multisession_002ddelete"><span class="category">Function: </span><span><strong>multisession-delete</strong> <em>object</em><a href='#index-multisession_002ddelete' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>This function deletes <var>object</var> and its value from its persistent
storage.
</p></dd></dl>

<dl class="def">
<dt id="index-make_002dmultisession"><span class="category">Function: </span><span><strong>make-multisession</strong><a href='#index-make_002dmultisession' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>You can also make persistent values that aren&rsquo;t tied to a specific variable,
but are tied to an explicit package and key.
</p>
<div class="example">
<pre class="example">(setq foo (make-multisession :package &quot;mail&quot;
                             :key &quot;friends&quot;))
(setf (multisession-value foo) 'everybody)
</pre></div>

<p>This supports the same keywords as <code>define-multisession-variable</code>, but
also supports a <code>:initial-value</code> keyword, which specifies the default
value.
</p></dd></dl>

<dl class="def">
<dt id="index-multisession_002dstorage"><span class="category">User Option: </span><span><strong>multisession-storage</strong><a href='#index-multisession_002dstorage' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>This variable controls how the multisession variables are stored.  It value
defaults to <code>files</code>, which means that the values are stored in a
one-file-per-variable structure inside the directory specified by
<code>multisession-directory</code>.  If this value is <code>sqlite</code> instead, the
values are stored in an SQLite database; this is only available if Emacs was
built with SQLite support.
</p></dd></dl>

<dl class="def">
<dt id="index-multisession_002ddirectory"><span class="category">User Option: </span><span><strong>multisession-directory</strong><a href='#index-multisession_002ddirectory' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>The multisession variables are stored under this directory, which defaults
to <samp>multisession/</samp> subdirectory of the <code>user-emacs-directory</code>,
which is typically <samp>~/.emacs.d/multisession/</samp>.
</p></dd></dl>

<span id="index-multisession_002dedit_002dmode"></span>
<dl class="def">
<dt id="index-list_002dmultisession_002dvalues"><span class="category">Command: </span><span><strong>list-multisession-values</strong><a href='#index-list_002dmultisession_002dvalues' class='copiable-anchor'> &para;</a></span></dt>
<dd><p>This command pops up a buffer listing all the multisession variables, and
enters a special mode <code>multisession-edit-mode</code> which allows you to
delete them and edit their values.
</p></dd></dl>

</div>
<hr>
<div class="header">
<p>
Previous: <a href="Generalized-Variables.html">ジェネリック変数</a>, Up: <a href="Variables.html">変数</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index.html" title="Index" rel="index">Index</a>]</p>
</div>


This page has generated for branch:work/emacs-29_edd64e64a389e0f0e6ce670846d4fae79a9d8b35, commit:d88c14976b24958e1225ddf0bf6fa8c024e6e21d to check Japanese translation.
</body>
</html>
